<div class="app-container">
  <header class="app-header">
    <div class="container">
      <div class="header-content">
        <a class="app-title" routerLink="/home">
          <img [src]="logoSource()" alt="REX Logo" class="app-logo"/>
          <h1>{{ translate('auth.app') }}</h1>
        </a>

        <div class="header-actions">
          <app-theme-toggle></app-theme-toggle>

          <div class="language-selector">
            <ui-button variant="ghost" size="small" className="language-toggle" (clicked)="toggleLanguageDropdown()"
                    [attr.aria-label]="translate('language.select')">
              <span class="flag">{{ currentLanguageOption().flag }}</span>
              <span class="lang-code">{{ currentLanguageOption().code.toUpperCase() }}</span>
              <ui-icon name="chevron-down" [size]="12"></ui-icon>
            </ui-button>

            @if (showLanguageDropdown) {
              <div class="language-dropdown">
                @for (language of availableLanguages; track language.code) {
                  <ui-button
                      variant="ghost"
                      size="small"
                      className="language-option"
                      [class.active]="language.code === currentLanguage()"
                      (clicked)="selectLanguage(language.code)"
                  >
                    <span class="flag">{{ language.flag }}</span>
                    <span class="name">{{ language.name }}</span>
                  </ui-button>
                }
              </div>
            }
          </div>

          <!-- Desktop Navigation -->
          <nav class="main-nav desktop-nav">
            @if (!isAuthenticated()) {
              <a routerLink="/login" routerLinkActive="active" class="nav-link">{{ translate('nav.login') }}</a>
            } @else {
              <div class="user-nav">
                <a routerLink="/arbitrage/funding" routerLinkActive="active" class="nav-link">{{ translate('Funding') }}</a>
                <a routerLink="/arbitrage/opportunities" routerLinkActive="active" class="nav-link">{{ translate('Opportunities') }}</a>
                <a routerLink="/farm" routerLinkActive="active" class="nav-link">{{ translate('Farm') }}</a>
                <!--<a routerLink="/trading" routerLinkActive="active" class="nav-link">ðŸ¤– {{ translate('nav.gridTrading') }}</a>
                <a routerLink="/trading/manual" routerLinkActive="active" class="nav-link">ðŸ“Š {{ translate('nav.manualTrading') }}</a>
                <a routerLink="/testing/api-tester" routerLinkActive="active" class="nav-link">ðŸ§ª {{ translate('nav.apiTester') }}</a>-->
                <a routerLink="/profile" routerLinkActive="active" class="nav-link">{{ translate('nav.profile') }}</a>
              </div>
            }
          </nav>

          <!-- Mobile Hamburger Menu -->
          @if (isAuthenticated()) {
            <ui-button variant="ghost" size="medium" className="hamburger-menu" (clicked)="toggleMobileMenu()" [attr.aria-label]="'Menu'">
              <div class="hamburger-line" [class.active]="showMobileMenu"></div>
              <div class="hamburger-line" [class.active]="showMobileMenu"></div>
              <div class="hamburger-line" [class.active]="showMobileMenu"></div>
            </ui-button>
          }
        </div>
      </div>
    </div>
  </header>

  <!-- Mobile Menu Overlay -->
  @if (showMobileMenu && isAuthenticated()) {
    <div class="mobile-menu-overlay" (click)="closeMobileMenu()" (keydown.escape)="closeMobileMenu()" tabindex="0" role="button" aria-label="Close menu">
      <nav class="mobile-menu" (click)="$event.stopPropagation()" (keydown)="$event.stopPropagation()" tabindex="-1">
        <div class="mobile-menu-header">
          <h3>Menu</h3>
          <ui-button variant="ghost" size="medium" className="close-menu" (clicked)="closeMobileMenu()">
            <ui-icon name="close" [size]="24"></ui-icon>
          </ui-button>
        </div>

        <div class="mobile-menu-content">
          <a routerLink="/trading" routerLinkActive="active" class="mobile-nav-link" (click)="closeMobileMenu()">
            <ui-icon name="chart" [size]="20"></ui-icon>
            ðŸ¤– {{ translate('nav.gridTrading') }}
          </a>

          <a routerLink="/trading/manual" routerLinkActive="active" class="mobile-nav-link" (click)="closeMobileMenu()">
            <ui-icon name="list" [size]="20"></ui-icon>
            ðŸ“Š {{ translate('nav.manualTrading') }}
          </a>

          <a routerLink="/testing/api-tester" routerLinkActive="active" class="mobile-nav-link" (click)="closeMobileMenu()">
            <ui-icon name="clipboard" [size]="20"></ui-icon>
            ðŸ§ª {{ translate('nav.apiTester') }}
          </a>

          <a routerLink="/profile" routerLinkActive="active" class="mobile-nav-link" (click)="closeMobileMenu()">
            <ui-icon name="user" [size]="20"></ui-icon>
            {{ translate('nav.profile') }}
          </a>

          @if (currentUser(); as user) {
            <div class="mobile-user-info">
              <img
                  [src]="user.avatar || '/placeholder/48'"
                  [alt]="user.name || user.email"
                  class="mobile-user-avatar"
              />
              <div class="mobile-user-details">
                <span class="mobile-user-name">{{ user.name || user.email }}</span>
                <span class="mobile-user-role" [class]="'role-' + user.role.toLowerCase()">
                  {{ user.role }}
                </span>
              </div>
            </div>
          }
        </div>
      </nav>
    </div>
  }

  <main class="main-content">
    <div class="container">
      @if (isLoading()) {
        <div class="loading-indicator">
          <div class="spinner"></div>
          <span>{{ translate('loading') }}</span>
        </div>
      }

      <router-outlet></router-outlet>
    </div>
  </main>

  <!-- Toast notifications container -->
  <ui-toast-container></ui-toast-container>

</div>
