<div class="price-arbitrage-opportunities-container">
  <!-- Header -->
  <div class="page-header">
    <h1 class="page-title">Price Arbitrage Opportunities</h1>
    <p class="page-subtitle">Combined price spread + funding rate arbitrage strategy</p>
  </div>

  <!-- Controls and Header -->
  <div class="controls-section">
    <div class="filters">
      <div class="header-info">
        <h2 class="section-title">Opportunities</h2>
      </div>
    </div>

    <div class="status-section">
      <div class="last-updated">
        <ui-icon name="schedule" [size]="18"></ui-icon>
        <span>{{ timeSinceUpdate() }}</span>
      </div>
      <ui-button
        (clicked)="refresh()"
        [disabled]="isLoading()"
        variant="primary"
        size="medium"
      >
        <ui-icon name="refresh" [size]="20" [class]="isLoading() ? 'spinning' : ''"></ui-icon>
        Refresh
      </ui-button>
    </div>
  </div>

  <!-- Filters -->
      <div class="filters-section">
        <div class="filter-group">
          <ui-input
            type="text"
            label="Symbol Search"
            [(ngModel)]="searchQuery"
            placeholder="e.g., BTC, ETH, COAI"
            size="medium"
            [fullWidth]="true">
          </ui-input>
        </div>

        <div class="filter-group">
          <ui-dropdown
            label="Strategy"
            [options]="strategyTypeOptions"
            [ngModel]="strategyTypeFilter()"
            (ngModelChange)="onStrategyTypeChange($event)"
            [searchable]="false"
            placeholder="Strategy Type"
            size="medium"
            width="medium">
          </ui-dropdown>
        </div>

        <div class="filter-group">
          <ui-input
            type="number"
            label="Min Score (%)"
            [(ngModel)]="minCombinedScore"
            placeholder="e.g., 1.0"
            [step]="0.1"
            [min]="0"
            size="medium"
            [fullWidth]="true">
          </ui-input>
        </div>

        <div class="filter-group">
          <ui-input
            type="number"
            label="Min Funding (%)"
            [(ngModel)]="minFundingRate"
            placeholder="e.g., 0.05"
            [step]="0.01"
            [min]="0"
            size="medium"
            [fullWidth]="true">
          </ui-input>
        </div>

        <div class="filter-group">
          <ui-input
            type="number"
            label="Min Spread (%)"
            [(ngModel)]="minPriceSpread"
            placeholder="e.g., 0.1"
            [step]="0.01"
            [min]="0"
            size="medium"
            [fullWidth]="true">
          </ui-input>
        </div>

        <div class="filter-actions">
          <ui-button (clicked)="clearFilters()" variant="danger" size="medium">
            <ui-icon name="clear" [size]="18"></ui-icon>
            Clear Filters
          </ui-button>
        </div>
      </div>

      <!-- Price Only Strategy Filters (Conditional) -->
      @if (strategyTypeFilter() === 'price_only') {
        <div class="price-only-filters-section">
          <div class="price-only-filters-header">
            <h3 class="price-only-filters-title">
              <ui-icon name="tune" [size]="20"></ui-icon>
              Price Only Strategy Filters
            </h3>
          </div>
          <div class="price-only-filters-content">
            <div class="filter-group checkbox-group">
              <label class="checkbox-label">
                <input
                  type="checkbox"
                  [(ngModel)]="filterByMaxFunding"
                  class="filter-checkbox"
                />
                <span class="checkbox-text">Filter by Max Funding Rate</span>
              </label>
              <span class="filter-hint">Exclude opportunities with funding rates above the threshold</span>
            </div>

            <div class="filter-group slider-group">
              <ui-slider
                [(ngModel)]="maxFundingValue"
                [min]="0"
                [max]="0.01"
                [step]="0.0001"
                [disabled]="!filterByMaxFunding()"
                [label]="'Max Funding Rate'"
                [showValue]="true"
                [showLabels]="false"
                [formatValue]="formatSliderValue"
                size="medium"
              ></ui-slider>
              <div class="slider-custom-labels">
                <span>0%</span>
                <span>0.5%</span>
                <span>1%</span>
              </div>
            </div>
          </div>
        </div>
      }

      <!-- Exchanges Filter Panel -->
      <div class="exchanges-panel">
        <div class="exchanges-panel-header">
          <h3 class="exchanges-panel-title">
            <ui-icon name="swap_horiz" [size]="20"></ui-icon>
            Filter by Exchanges
          </h3>
          <span class="exchanges-count">{{ selectedExchanges().length }} / {{ availableExchanges.length }} selected</span>
        </div>
        <div class="exchanges-panel-content">
          <div class="exchange-chips">
            @for (exchange of availableExchanges; track exchange) {
              <button
                type="button"
                class="exchange-chip"
                [class.active]="isExchangeSelected(exchange)"
                (click)="toggleExchange(exchange)"
                [title]="isExchangeSelected(exchange) ? 'Click to hide ' + exchange : 'Click to show ' + exchange"
              >
                <span class="exchange-name">{{ exchange }}</span>
                <span class="exchange-indicator" [class.selected]="isExchangeSelected(exchange)">
                  {{ isExchangeSelected(exchange) ? '‚úì' : '' }}
                </span>
              </button>
            }
          </div>
          @if (availableExchanges.length > 0) {
            <div class="exchange-actions">
              <ui-button
                type="button"
                variant="secondary"
                size="small"
                (clicked)="selectAllExchanges()"
              >
                <ui-icon name="done_all" [size]="16"></ui-icon>
                Select All
              </ui-button>
              <ui-button
                type="button"
                variant="secondary"
                size="small"
                (clicked)="deselectAllExchanges()"
              >
                <ui-icon name="clear_all" [size]="16"></ui-icon>
                Deselect All
              </ui-button>
            </div>
          }
        </div>
      </div>

      <!-- Loading State -->
      @if (isLoading() && opportunities().length === 0) {
        <div class="loading-state">
          <ui-icon name="spinner" class="spinning"></ui-icon>
          <p>Loading opportunities...</p>
        </div>
      }

      <!-- Error State -->
      @if (error()) {
        <div class="error-state">
          <ui-icon name="alert-circle"></ui-icon>
          <p>{{ error() }}</p>
          <ui-button (clicked)="refresh()" variant="primary" size="medium">Try Again</ui-button>
        </div>
      }

      <!-- Opportunities Table -->
      @if (!isLoading() || opportunities().length > 0) {
        <div class="table-container">
          <div class="results-count">
            Found {{ filteredOpportunities().length }} opportunities
          </div>

          <table class="opportunities-table">
            <thead>
              <tr>
                <th (click)="setSortColumn('symbol')" class="sortable">
                  Symbol
                  <ui-icon
                    *ngIf="sortColumn() === 'symbol'"
                    [name]="sortDirection() === 'asc' ? 'arrow_upward' : 'arrow_downward'"
                    [size]="16"
                  ></ui-icon>
                </th>
                @if (!isFundingFarmMode()) {
                  <!-- Spot Price Column -->
                  <th>
                    Spot Price
                    <br><small>(Lower/Buy)</small>
                  </th>
                  <!-- Futures Price Column -->
                  <th>
                    Futures Price
                    <br><small>(Higher/Short)</small>
                  </th>
                  <!-- Price Spread Column (hidden for spot+futures strategy) -->
                  @if (!isSpotFuturesMode()) {
                    <th (click)="setSortColumn('spreadPercent')" class="sortable">
                      Price Spread
                      <br><small>(Short - Long)</small>
                      <ui-icon
                        *ngIf="sortColumn() === 'spreadPercent'"
                        [name]="sortDirection() === 'asc' ? 'arrow_upward' : 'arrow_downward'"
                        [size]="16"
                      ></ui-icon>
                    </th>
                  }
                } @else {
                  <th>Hedge Ratio<br><small>(Œî-Neutral)</small></th>
                }
                <th (click)="setSortColumn('fundingDifferential')" class="sortable">
                  Funding Diff
                  <ui-icon
                    *ngIf="sortColumn() === 'fundingDifferential'"
                    [name]="sortDirection() === 'asc' ? 'arrow_upward' : 'arrow_downward'"
                    [size]="16"
                  ></ui-icon>
                </th>
                <th (click)="setSortColumn('expectedDailyReturn')" class="sortable">
                  Daily Return
                  <ui-icon
                    *ngIf="sortColumn() === 'expectedDailyReturn'"
                    [name]="sortDirection() === 'asc' ? 'arrow_upward' : 'arrow_downward'"
                    [size]="16"
                  ></ui-icon>
                </th>
                <th (click)="setSortColumn('volatility')" class="sortable">
                  Volatility 24h
                  <ui-icon
                    *ngIf="sortColumn() === 'volatility'"
                    [name]="sortDirection() === 'asc' ? 'arrow_upward' : 'arrow_downward'"
                    [size]="16"
                  ></ui-icon>
                </th>
                @if (!isSpotFuturesMode() && !isSpotFuturesMode()) {
                  <th>Best Long</th>
                  <th>Best Short</th>
                } @else if (isSpotFuturesMode()) {
                  <th>Best Exchange<br><small>(Spot + Futures)</small></th>
                } @else {
                  <!-- Spot-Futures Mode: Show Best Funding and Best Short columns -->
                  <th>Best Funding<br><small>(Long Spot + Short Futures)</small></th>
                  <th>Best Short<br><small>(Short Only)</small></th>
                }
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <ng-container *ngFor="let opp of filteredOpportunities()">
                <tr class="opportunity-row" [class.highlight-combined]="opp.strategyType === 'combined'">
                  <!-- Symbol -->
                  <td class="symbol-cell">
                    <span class="symbol">{{ opp.symbol }}</span>
                  </td>

                  @if (!isFundingFarmMode()) {
                    <!-- Spot Price -->
                    <td class="spot-price-cell">
                      <div class="price-info">
                        <span class="price-value">{{ formatPrice(getSpotPrice(opp)) }}</span>
                        <span class="exchange-badge">{{ getExchangeLabel(opp, 'spot') }}</span>
                      </div>
                    </td>

                    <!-- Futures Price -->
                    <td class="futures-price-cell">
                      <div class="price-info">
                        <span class="price-value">{{ formatPrice(getFuturesPrice(opp)) }}</span>
                        <span class="exchange-badge">{{ getExchangeLabel(opp, 'futures') }}</span>
                      </div>
                    </td>

                    <!-- Price Spread with Visual Indicator (hidden for spot+futures strategy) -->
                    @if (!isSpotFuturesMode()) {
                      <td class="price-spread-cell">
                        <div class="price-spread-info" [class]="getPriceSpreadInfo(opp).colorClass">
                          <div class="spread-header">
                            <span class="spread-indicator">{{ getPriceSpreadInfo(opp).indicator }}</span>
                            <span class="spread-percent"
                                  [class.favorable]="getPriceSpreadInfo(opp).isFavorable"
                                  [class.unfavorable]="!getPriceSpreadInfo(opp).isFavorable">
                              {{ formatPercent(getPriceSpreadInfo(opp).spreadPercent, 2) }}
                            </span>
                          </div>
                          <span class="spread-usdt" [title]="'Absolute difference: $' + getPriceSpreadInfo(opp).spreadUsdt.toFixed(6)">
                            {{ getPriceSpreadInfo(opp).spreadUsdt >= 0 ? '+' : '' }}${{ getPriceSpreadInfo(opp).spreadUsdt.toFixed(6) }}
                          </span>
                        </div>
                      </td>
                    }
                  } @else {
                    <td class="hedge-ratio-cell">
                      @if (!isSpotFuturesStrategy(opp)) {
                        <div class="hedge-ratio-info">
                          <span class="ratio-value">{{ formatHedgeRatio(opp) }}</span>
                          <span class="ratio-label">Long/Short</span>
                        </div>
                      } @else {
                        <span>‚Äî</span>
                      }
                    </td>
                  }

                  <!-- Funding Differential -->
                  <td class="funding-spread-cell">
                    <span class="funding-spread" *ngIf="getRecalculatedMetrics(opp); let recalculated; else defaultFunding">
                      {{ recalculated.fundingSpreadPercent }}
                    </span>
                    <ng-template #defaultFunding>
                      <span class="funding-spread">{{ opp.maxFundingSpreadPercent }}</span>
                    </ng-template>
                  </td>

                  <!-- Daily Return -->
                  <td class="daily-return-cell">
                    <span class="metric-value" *ngIf="getRecalculatedMetrics(opp); let recalculated; else defaultDailyReturn">
                      {{ formatPercent(recalculated.dailyReturn) }}
                    </span>
                    <ng-template #defaultDailyReturn>
                      @if (opp.realisticMetrics) {
                        <div class="metric-realistic">
                          <span class="metric-value metric-highlight"
                                [title]="'Realistic: ' + formatPercent(opp.realisticMetrics.dailyReturn.realistic) + ' | Range: ' + formatPercent(opp.realisticMetrics.dailyReturn.pessimistic) + ' - ' + formatPercent(opp.realisticMetrics.dailyReturn.optimistic)">
                            {{ formatPercent(opp.realisticMetrics.dailyReturn.realistic) }}
                          </span>
                          <span class="metric-range"
                                [title]="'Based on ' + (opp.realisticMetrics.dataPoints || 0) + ' historical data points over ' + (opp.realisticMetrics.historicalPeriodDays || 7) + ' days'">
                            <small class="range-pessimistic">{{ formatPercent(opp.realisticMetrics.dailyReturn.pessimistic, 1) }}</small>
                            <small class="range-separator">-</small>
                            <small class="range-optimistic">{{ formatPercent(opp.realisticMetrics.dailyReturn.optimistic, 1) }}</small>
                          </span>
                          @if (opp.realisticMetrics.confidence) {
                            <span class="confidence-badge"
                                  [class.high]="opp.realisticMetrics.confidence >= 70"
                                  [class.medium]="opp.realisticMetrics.confidence >= 40 && opp.realisticMetrics.confidence < 70"
                                  [class.low]="opp.realisticMetrics.confidence < 40"
                                  [title]="'Confidence: ' + opp.realisticMetrics.confidence + '/100 (based on historical data quality)'">
                              {{ opp.realisticMetrics.confidence }}%
                            </span>
                          }
                        </div>
                      } @else if (opp.expectedDailyReturn !== undefined) {
                        <span class="metric-value">{{ formatPercent(opp.expectedDailyReturn) }}</span>
                      } @else {
                        <span class="metric-value">{{ formatPercent((opp.priceSpread || 0) * 100) }}</span>
                      }
                    </ng-template>
                  </td>

                  <!-- Volatility 24h -->
                  <td class="volatility-cell">
                    @if (opp.volatility24hFormatted) {
                      <span class="metric-value">{{ opp.volatility24hFormatted }}</span>
                    } @else if (opp.volatility24h !== undefined) {
                      <span class="metric-value">{{ formatPercent(opp.volatility24h * 100) }}</span>
                    } @else {
                      <span class="metric-value">‚Äî</span>
                    }
                  </td>

                  @if (!isSpotFuturesMode() && !isSpotFuturesMode()) {
                    <!-- Best Long (Lower Price) - Cross-Exchange -->
                    <td class="best-long-cell">
                      @if (asFundingRateOpportunity(opp); as fundingOpp) {
                        <div class="best-exchange">
                          <ui-dropdown
                            [options]="getLongExchangeOptions(opp)"
                            [ngModel]="getEffectiveLongExchange(opp).exchange"
                            (selectionChange)="onExchangeChange(opp.symbol, 'long', $event)"
                            [searchable]="false"
                            [showClearButton]="false"
                            size="small"
                            width="medium">
                          </ui-dropdown>
                        </div>
                      }
                    </td>

                    <!-- Best Short (Higher Price) - Cross-Exchange -->
                    <td class="best-short-cell">
                      @if (asFundingRateOpportunity(opp); as fundingOpp) {
                        <div class="best-exchange">
                          <ui-dropdown
                            [options]="getShortExchangeOptions(opp)"
                            [ngModel]="getEffectiveShortExchange(opp).exchange"
                            (selectionChange)="onExchangeChange(opp.symbol, 'short', $event)"
                            [searchable]="false"
                            [showClearButton]="false"
                            size="small"
                            width="medium">
                          </ui-dropdown>
                        </div>
                      }
                    </td>
                  } @else if (isSpotFuturesMode()) {
                    <!-- Single Exchange for Spot + Futures (Spot+Futures) -->
                    <td class="best-exchange-cell">
                      @if (asSpotFuturesOpportunity(opp); as gradOpp) {
                        <div class="best-exchange">
                          <span class="exchange-name">{{ gradOpp.bestShort.exchange || '‚Äî' }}</span>
                          <span class="funding-rate positive">{{ formatPercent(parseFundingRateToNumber(gradOpp.bestShort.fundingRate)) }}</span>
                          <span class="price">${{ getFuturesPrice(gradOpp) || '‚Äî' }}</span>
                          @if (gradOpp.bestShort.nextFundingTime && gradOpp.bestShort.fundingInterval) {
                            <span class="time-to-funding">{{ formatFundingTimeFromTimestamp(gradOpp.bestShort.nextFundingTime, gradOpp.bestShort.fundingInterval) }}</span>
                          }
                        </div>
                      } @else {
                        <span>‚Äî</span>
                      }
                    </td>
                  } @else {
                    <!-- Spot-Futures Mode: Show Best Funding and Best Short -->
                    <!-- Best Funding Exchange (positive funding - Long Spot + Short Futures) -->
                    <td class="best-funding-cell">
                      @if (opp.bestFundingExchange) {
                        <div class="best-exchange">
                          <span class="exchange-name">{{ opp.bestFundingExchange.exchange }}</span>
                          <span class="funding-rate" [ngClass]="getFundingRateColorClassFromNumber(opp.bestFundingExchange.fundingRate)">
                            {{ formatFundingRatePercent(opp.bestFundingExchange.fundingRate) }}
                          </span>
                          <span class="price">{{ formatPrice(opp.bestFundingExchange.currentPrice) }}</span>
                          <span class="time-to-funding">{{ formatTimeToNextFunding(opp.bestFundingExchange.nextFundingTime) }}</span>
                        </div>
                      } @else {
                        <span>‚Äî</span>
                      }
                    </td>

                    <!-- Best Short Exchange (negative funding - Short Only) -->
                    <td class="best-short-exchange-cell">
                      @if (opp.bestShortExchange) {
                        <div class="best-exchange">
                          <span class="exchange-name">{{ opp.bestShortExchange.exchange }}</span>
                          <span class="funding-rate" [ngClass]="getFundingRateColorClassFromNumber(opp.bestShortExchange.fundingRate)">
                            {{ formatFundingRatePercent(opp.bestShortExchange.fundingRate) }}
                          </span>
                          <span class="price">{{ formatPrice(opp.bestShortExchange.currentPrice) }}</span>
                          <span class="time-to-funding">{{ formatTimeToNextFunding(opp.bestShortExchange.nextFundingTime) }}</span>
                        </div>
                      } @else {
                        <span>‚Äî</span>
                      }
                    </td>
                  }

                  <!-- Actions -->
                  <td class="actions-cell">
                    <!-- Analytics button for spread stability modal (only for cross-exchange) -->
                    @if (!isSpotFuturesMode() && !isSpotFuturesStrategy(opp)) {
                      <ui-button
                        (clicked)="openDetailsModal(opp)"
                        variant="secondary"
                        size="small"
                        [iconOnly]="true"
                        [className]="'btn-analytics'"
                        [title]="'View historical stability metrics'"
                      >
                        <ui-icon name="analytics" [size]="20"></ui-icon>
                      </ui-button>
                    }
                    <!-- Start position button -->
                    <ui-button
                      (clicked)="startPosition(opp)"
                      variant="primary"
                      size="small"
                      [iconOnly]="true"
                      [className]="'btn-start-position'"
                    >
                      <ui-icon name="play_arrow" [size]="18"></ui-icon>
                    </ui-button>
                  </td>
                </tr>
              </ng-container>

              <!-- Empty state -->
              <tr *ngIf="filteredOpportunities().length === 0" class="empty-row">
                <td colspan="11" class="empty-cell">
                  <ui-icon name="info" [size]="48"></ui-icon>
                  <p>
                    @if (searchQuery() || minCombinedScore() || selectedExchanges().length > 0) {
                      No opportunities match your filters. Try adjusting your criteria.
                    } @else {
                      No arbitrage opportunities found for this strategy type. Try selecting a different strategy.
                    }
                  </p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      }

  <!-- Help Text -->
  <div class="help-section">
    <h3>Understanding Combined Strategy</h3>
    <ul>
      <li><strong>Spot Price:</strong> The lower price where you would BUY the asset (typically on the "long" exchange)</li>
      <li><strong>Futures Price:</strong> The higher price where you would SHORT the futures contract</li>
      <li><strong>Price Spread:</strong> The difference between futures and spot prices
        <ul>
          <li>üü¢ <strong>Green (Favorable):</strong> Futures > Spot - Good for spot+futures arbitrage (buy cheap spot, short expensive futures)</li>
          <li>üî¥ <strong>Red (Unfavorable):</strong> Spot > Futures - Not ideal for this strategy</li>
        </ul>
      </li>
      <li><strong>Funding Diff:</strong> Net funding rate you receive/pay every 8 hours (SHORT - LONG)</li>
      <li><strong>Combined Score:</strong> Price spread + projected funding for 7 days</li>
      <li><strong>Daily Return:</strong> Expected daily profit based on 7-day historical average funding rates (spread + funding √ó 3)</li>
      <li><strong>Monthly ROI:</strong> Estimated profit over 30 days based on historical data (spread + funding √ó 90)</li>
    </ul>

    <h3>üìä Realistic Metrics (NEW)</h3>
    <ul>
      <li><strong>Historical Analysis:</strong> Return estimates are now based on 7 days of historical funding rate data</li>
      <li><strong>Pessimistic Scenario:</strong> Lower bound (average - 1 standard deviation) - worst case from historical data</li>
      <li><strong>Realistic Scenario:</strong> Middle estimate (historical average) - most likely outcome</li>
      <li><strong>Optimistic Scenario:</strong> Upper bound (average + 1 standard deviation) - best case from historical data</li>
      <li><strong>Confidence Score:</strong> Data quality indicator (0-100%) - higher means more reliable historical data</li>
      <li><strong>Green badge (70%+):</strong> High confidence - lots of historical data, consistent rates</li>
      <li><strong>Orange badge (40-70%):</strong> Medium confidence - moderate data, some variance</li>
      <li><strong>Red badge (&lt;40%):</strong> Low confidence - limited data or high variance</li>
    </ul>

    <h3>üí° Spot-Futures Recommendation</h3>
    <ul>
      <li><strong>When both funding rates are positive</strong>, Spot-Futures arbitrage is more profitable</li>
      <li><strong>Spot-Futures:</strong> Buy spot asset + Short futures on same exchange = earn FULL funding rate</li>
      <li><strong>Cross-Exchange:</strong> Short high funding + Long low funding = earn only the DIFFERENCE</li>
      <li><strong>Example:</strong> If exchange has +0.15% funding, Spot-Futures earns 0.15%, Cross-Exchange earns 0.15% - 0.05% = 0.10%</li>
    </ul>

    <h3>üè¶ Spot + Futures (Spot+Futures)</h3>
    <ul>
      <li><strong>Strategy:</strong> Buy spot asset + Open SHORT futures on SAME exchange</li>
      <li><strong>Profit Source:</strong> Earn FULL funding rate when longs pay shorts (positive funding)</li>
      <li><strong>Comparison:</strong> Earns MORE than cross-exchange when funding is positive</li>
      <li><strong>Example:</strong> If funding is +0.15%, you earn full 0.15%, not just differential</li>
      <li><strong>Risk:</strong> No price spread profit - relies entirely on funding rates</li>
      <li><strong>Capital Efficiency:</strong> Requires capital for both spot purchase and futures margin</li>
      <li><strong>Best For:</strong> High positive funding rates (0.1%+ per 8h)</li>
    </ul>

    <h3>üìä Strategy Comparison</h3>
    <table style="width: 100%; border-collapse: collapse; margin-top: 1rem;">
      <thead>
        <tr style="background: #f5f5f5;">
          <th style="padding: 0.5rem; text-align: left; border: 1px solid #ddd;">Strategy</th>
          <th style="padding: 0.5rem; text-align: left; border: 1px solid #ddd;">Exchanges</th>
          <th style="padding: 0.5rem; text-align: left; border: 1px solid #ddd;">Profit Source</th>
          <th style="padding: 0.5rem; text-align: left; border: 1px solid #ddd;">Example Return</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td style="padding: 0.5rem; border: 1px solid #ddd;"><strong>Cross-Exchange</strong></td>
          <td style="padding: 0.5rem; border: 1px solid #ddd;">2 different exchanges</td>
          <td style="padding: 0.5rem; border: 1px solid #ddd;">Price spread + Funding differential</td>
          <td style="padding: 0.5rem; border: 1px solid #ddd;">0.05% spread + 0.10% funding diff</td>
        </tr>
        <tr>
          <td style="padding: 0.5rem; border: 1px solid #ddd;"><strong>Spot + Futures</strong></td>
          <td style="padding: 0.5rem; border: 1px solid #ddd;">1 exchange (spot + futures)</td>
          <td style="padding: 0.5rem; border: 1px solid #ddd;">FULL funding rate</td>
          <td style="padding: 0.5rem; border: 1px solid #ddd;">0.00% spread + 0.15% full funding</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Spread Stability Details Modal -->
<ui-dialog
  [open]="showDetailsModal()"
  [title]="selectedOpportunity() ? selectedOpportunity()!.symbol + ' - Spread Stability Analysis' : 'Loading...'"
  size="xlarge"
  [closable]="true"
  [closeOnBackdrop]="true"
  (close)="closeDetailsModal()"
>
  <ui-dialog-content>
    @if (selectedOpportunity(); as opp) {
      <app-funding-spread-details
        [opportunity]="mapToDetailsOpportunity(opp)"
      ></app-funding-spread-details>
    }
  </ui-dialog-content>
</ui-dialog>
