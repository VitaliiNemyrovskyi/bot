<div class="triangular-arbitrage-page">
  <!-- Page Header -->
  <div class="page-header">
    <h1 class="page-title">{{ translate('triangularArbitrage.title') }}</h1>
    <p class="page-description">{{ translate('triangularArbitrage.description') }}</p>
  </div>

  <!-- Connection Status Alert -->
  @if (!isConnected() || connectionError()) {
    <div class="alert alert-warning">
      <div class="alert-content">
        <svg class="alert-icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
          <path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <div class="alert-message">
          <strong>{{ translate('triangularArbitrage.connection.disconnected') }}</strong>
          <p>{{ connectionError() || translate('triangularArbitrage.connection.reconnecting') }}</p>
        </div>
        <button class="btn-reconnect" (click)="reconnect()">
          {{ translate('triangularArbitrage.connection.reconnect') }}
        </button>
      </div>
    </div>
  }

  <!-- Error Alert -->
  @if (error()) {
    <div class="alert alert-error">
      <div class="alert-content">
        <svg class="alert-icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
          <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
          <path d="M12 8v4m0 4h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <span>{{ error() }}</span>
      </div>
    </div>
  }

  <!-- Scanner Controls -->
  <ui-card>
    <ui-card-header>
      <ui-card-title>{{ translate('triangularArbitrage.scanner.title') }}</ui-card-title>
    </ui-card-header>
    <ui-card-content>
      <app-opportunity-scanner
        (startScanning)="onScannerStart($event)"
        (stopScanning)="onScannerStop($event)"
      />
    </ui-card-content>
  </ui-card>

  <!-- Active Positions Banner (if any) -->
  @if (hasActivePositions()) {
    <div class="active-positions-banner">
      <div class="banner-content">
        <svg class="banner-icon" width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <div>
          <strong>{{ activePositions().length }} {{ translate('triangularArbitrage.positions.activePositions') }}</strong>
          <p>{{ translate('triangularArbitrage.positions.executing') }}</p>
        </div>
      </div>
      <button class="btn-view-positions" (click)="setActiveTab('positions')">
        {{ translate('triangularArbitrage.positions.view') }}
      </button>
    </div>
  }

  <!-- Tabs -->
  <div class="tabs">
    <button
      class="tab"
      [class.active]="activeTab() === 'opportunities'"
      (click)="setActiveTab('opportunities')"
    >
      {{ translate('triangularArbitrage.tabs.opportunities') }}
      @if (opportunities().length > 0) {
        <span class="tab-badge">{{ opportunities().length }}</span>
      }
    </button>
    <button
      class="tab"
      [class.active]="activeTab() === 'positions'"
      (click)="setActiveTab('positions')"
    >
      {{ translate('triangularArbitrage.tabs.positions') }}
      @if (positions().length > 0) {
        <span class="tab-badge">{{ positions().length }}</span>
      }
    </button>
  </div>

  <!-- Tab Content -->
  <div class="tab-content">
    <!-- Opportunities Tab -->
    @if (activeTab() === 'opportunities') {
      <ui-card>
        <ui-card-header>
          <ui-card-title>{{ translate('triangularArbitrage.opportunities.title') }}</ui-card-title>
        </ui-card-header>
        <ui-card-content>
          <app-opportunity-list
            [opportunities]="opportunities()"
            [isLoading]="isLoadingOpportunities()"
            [scannerStatus]="scannerStatus()"
            (executeOpportunity)="onExecuteOpportunity($event)"
          />
        </ui-card-content>
      </ui-card>
    }

    <!-- Positions Tab -->
    @if (activeTab() === 'positions') {
      <ui-card>
        <ui-card-header>
          <ui-card-title>{{ translate('triangularArbitrage.positions.title') }}</ui-card-title>
        </ui-card-header>
        <ui-card-content>
          <app-position-history
            [positions]="positions()"
            [isLoading]="isLoadingPositions()"
            (filterChange)="onFilterChange($event)"
            (cancelPosition)="onCancelPosition($event)"
            (deletePosition)="onDeletePosition($event)"
          />
        </ui-card-content>
      </ui-card>
    }
  </div>
</div>
