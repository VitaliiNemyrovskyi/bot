<div class="triangle-visualizer">
  <svg [attr.width]="svgWidth" [attr.height]="svgHeight" viewBox="0 0 400 400">
    <!-- Defs for arrow markers -->
    <defs>
      <marker
        id="arrowhead"
        markerWidth="10"
        markerHeight="10"
        refX="9"
        refY="3"
        orient="auto"
      >
        <polygon points="0 0, 10 3, 0 6" fill="var(--primary-color, #2196f3)" />
      </marker>
    </defs>

    <!-- Triangle Edges (Arrows) -->
    <!-- Leg 1: A → B -->
    <path
      [attr.d]="getArrowPath(positions().assetA, positions().assetB)"
      class="leg-arrow"
      marker-end="url(#arrowhead)"
    />

    <!-- Leg 2: B → C -->
    <path
      [attr.d]="getArrowPath(positions().assetB, positions().assetC)"
      class="leg-arrow"
      marker-end="url(#arrowhead)"
    />

    <!-- Leg 3: C → A -->
    <path
      [attr.d]="getArrowPath(positions().assetC, positions().assetA)"
      class="leg-arrow"
      marker-end="url(#arrowhead)"
    />

    <!-- Asset Nodes -->
    <!-- Asset A -->
    <circle
      [attr.cx]="positions().assetA.x"
      [attr.cy]="positions().assetA.y"
      r="30"
      class="asset-node"
    />
    <text
      [attr.x]="positions().assetA.x"
      [attr.y]="positions().assetA.y"
      class="asset-label"
      text-anchor="middle"
      dominant-baseline="middle"
    >
      {{ opportunity.triangle.assetA }}
    </text>

    <!-- Asset B -->
    <circle
      [attr.cx]="positions().assetB.x"
      [attr.cy]="positions().assetB.y"
      r="30"
      class="asset-node"
    />
    <text
      [attr.x]="positions().assetB.x"
      [attr.y]="positions().assetB.y"
      class="asset-label"
      text-anchor="middle"
      dominant-baseline="middle"
    >
      {{ opportunity.triangle.assetB }}
    </text>

    <!-- Asset C -->
    <circle
      [attr.cx]="positions().assetC.x"
      [attr.cy]="positions().assetC.y"
      r="30"
      class="asset-node"
    />
    <text
      [attr.x]="positions().assetC.x"
      [attr.y]="positions().assetC.y"
      class="asset-label"
      text-anchor="middle"
      dominant-baseline="middle"
    >
      {{ opportunity.triangle.assetC }}
    </text>

    <!-- Leg Labels with Prices -->
    <!-- Leg 1 Label -->
    <g [attr.transform]="'translate(' + getLegLabelPosition(positions().assetA, positions().assetB).x + ',' + getLegLabelPosition(positions().assetA, positions().assetB).y + ')'">
      <rect
        x="-35"
        y="-15"
        width="70"
        height="30"
        rx="4"
        class="leg-label-bg"
      />
      <text
        x="0"
        y="-2"
        class="leg-price"
        text-anchor="middle"
        dominant-baseline="middle"
      >
        {{ opportunity.leg1.symbol }}
      </text>
      <text
        x="0"
        y="10"
        class="leg-price-value"
        text-anchor="middle"
        dominant-baseline="middle"
      >
        ${{ formatPrice(opportunity.leg1.askPrice) }}
      </text>
    </g>

    <!-- Leg 2 Label -->
    <g [attr.transform]="'translate(' + getLegLabelPosition(positions().assetB, positions().assetC).x + ',' + getLegLabelPosition(positions().assetB, positions().assetC).y + ')'">
      <rect
        x="-35"
        y="-15"
        width="70"
        height="30"
        rx="4"
        class="leg-label-bg"
      />
      <text
        x="0"
        y="-2"
        class="leg-price"
        text-anchor="middle"
        dominant-baseline="middle"
      >
        {{ opportunity.leg2.symbol }}
      </text>
      <text
        x="0"
        y="10"
        class="leg-price-value"
        text-anchor="middle"
        dominant-baseline="middle"
      >
        ${{ formatPrice(opportunity.leg2.askPrice) }}
      </text>
    </g>

    <!-- Leg 3 Label -->
    <g [attr.transform]="'translate(' + getLegLabelPosition(positions().assetC, positions().assetA).x + ',' + getLegLabelPosition(positions().assetC, positions().assetA).y + ')'">
      <rect
        x="-35"
        y="-15"
        width="70"
        height="30"
        rx="4"
        class="leg-label-bg"
      />
      <text
        x="0"
        y="-2"
        class="leg-price"
        text-anchor="middle"
        dominant-baseline="middle"
      >
        {{ opportunity.leg3.symbol }}
      </text>
      <text
        x="0"
        y="10"
        class="leg-price-value"
        text-anchor="middle"
        dominant-baseline="middle"
      >
        ${{ formatPrice(opportunity.leg3.bidPrice) }}
      </text>
    </g>

    <!-- Center Profit Display -->
    <circle
      [attr.cx]="centerX"
      [attr.cy]="centerY"
      r="50"
      class="profit-circle"
      [style.fill]="getProfitColor()"
    />
    <text
      [attr.x]="centerX"
      [attr.y]="centerY - 8"
      class="profit-label"
      text-anchor="middle"
      dominant-baseline="middle"
    >
      Profit
    </text>
    <text
      [attr.x]="centerX"
      [attr.y]="centerY + 10"
      class="profit-value"
      text-anchor="middle"
      dominant-baseline="middle"
    >
      {{ opportunity.profitPercentage.toFixed(3) }}%
    </text>
  </svg>
</div>
