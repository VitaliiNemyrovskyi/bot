<div class="profile-container">
  <!-- Profile Header -->
  <div class="profile-header">
    <div class="user-avatar-section">
      <div class="avatar-container">
        <img
          [src]="currentUser()?.avatar || '/placeholder/120'"
          [alt]="currentUser()?.name || currentUser()?.email"
          class="user-avatar-xl"
        />
        <ui-button variant="ghost" className="avatar-edit-btn" (clicked)="changeAvatar()">
          <ui-icon name="edit" [size]="16"></ui-icon>
        </ui-button>
      </div>
      <div class="user-basic-info">
        <h1 class="user-name">{{ currentUser()?.name || translate('profile.anonymous') }}</h1>
        <p class="user-email">{{ currentUser()?.email }}</p>
        <div class="user-status">
          <span class="status-badge" [class]="'status-' + (currentUser()?.subscriptionActive ? 'active' : 'inactive')">
            {{ currentUser()?.subscriptionActive ? translate('profile.premium') : translate('profile.free') }}
          </span>
          <span class="role-badge" [class]="'role-' + currentUser()?.role?.toLowerCase()">
            {{ currentUser()?.role }}
          </span>
        </div>
      </div>
    </div>
    <div class="profile-header-actions">
      <ui-button variant="tertiary" className="logout-btn" (clicked)="logout()">
        <ui-icon name="logout" [size]="16"></ui-icon>
        {{ translate('dashboard.logout') }}
      </ui-button>
    </div>
  </div>

  <!-- Profile Content -->
  <div class="profile-content">
    <!-- Navigation Tabs -->
    <div class="profile-tabs">
      @for (tab of tabs; track tab.id) {
        <ui-button
          variant="ghost"
          className="tab-button"
          [class.active]="activeTab() === tab.id"
          (clicked)="setActiveTab(tab.id)"
        >
          <span class="tab-icon">{{ tab.icon }}</span>
          <span class="tab-label">{{ translate(tab.label) }}</span>
        </ui-button>
      }
    </div>

    <!-- Tab Content -->
    <div class="tab-content">
      <!-- Settings Tab -->
      @if (activeTab() === 'settings') {
        <div class="settings-section">
          <div class="settings-group">
            <h3>{{ translate('profile.preferences') }}</h3>
            
            <div class="setting-item">
              <div class="setting-info">
                <label>{{ translate('profile.language') }}</label>
                <p>{{ translate('profile.languageDesc') }}</p>
              </div>
              <div class="setting-control">
                <select [(ngModel)]="selectedLanguage" (change)="changeLanguage($event)">
                  @for (lang of availableLanguages; track lang.code) {
                    <option [value]="lang.code">{{ lang.flag }} {{ lang.name }}</option>
                  }
                </select>
              </div>
            </div>

            <div class="setting-item">
              <div class="setting-info">
                <label>{{ translate('profile.theme') }}</label>
                <p>{{ translate('profile.themeDesc') }}</p>
              </div>
              <div class="setting-control">
                <ui-button variant="secondary" className="theme-toggle-btn" (clicked)="toggleTheme()">
                  {{ isDark() ? translate('theme.light') : translate('theme.dark') }}
                </ui-button>
              </div>
            </div>

            <div class="setting-item">
              <div class="setting-info">
                <label>{{ translate('profile.currency') }}</label>
                <p>{{ translate('profile.currencyDesc') }}</p>
              </div>
              <div class="setting-control">
                <select [(ngModel)]="selectedCurrency" (change)="changeCurrency($event)">
                  <option value="USD">üá∫üá∏ USD</option>
                  <option value="EUR">üá™üá∫ EUR</option>
                  <option value="GBP">üá¨üáß GBP</option>
                  <option value="JPY">üáØüáµ JPY</option>
                  <option value="CAD">üá®üá¶ CAD</option>
                  <option value="AUD">üá¶üá∫ AUD</option>
                  <option value="CHF">üá®üá≠ CHF</option>
                </select>
              </div>
            </div>
          </div>

          <div class="settings-group">
            <h3>{{ translate('profile.notifications') }}</h3>
            
            <div class="setting-item">
              <div class="setting-info">
                <label>{{ translate('profile.emailNotifications') }}</label>
                <p>{{ translate('profile.emailNotificationsDesc') }}</p>
              </div>
              <div class="setting-control">
                <label class="toggle-switch">
                  <input type="checkbox" [(ngModel)]="emailNotifications" (change)="updateNotificationSettings()">
                  <span class="slider"></span>
                </label>
              </div>
            </div>

            <div class="setting-item">
              <div class="setting-info">
                <label>{{ translate('profile.priceAlerts') }}</label>
                <p>{{ translate('profile.priceAlertsDesc') }}</p>
              </div>
              <div class="setting-control">
                <label class="toggle-switch">
                  <input type="checkbox" [(ngModel)]="priceAlerts" (change)="updateNotificationSettings()">
                  <span class="slider"></span>
                </label>
              </div>
            </div>

            <div class="setting-item">
              <div class="setting-info">
                <label>{{ translate('profile.tradingAlerts') }}</label>
                <p>{{ translate('profile.tradingAlertsDesc') }}</p>
              </div>
              <div class="setting-control">
                <label class="toggle-switch">
                  <input type="checkbox" [(ngModel)]="tradingAlerts" (change)="updateNotificationSettings()">
                  <span class="slider"></span>
                </label>
              </div>
            </div>
          </div>
        </div>
      }

      <!-- User Info Tab -->
      @if (activeTab() === 'userinfo') {
        <div class="userinfo-section">
          <div class="info-group">
            <h3>{{ translate('profile.personalInfo') }}</h3>
            
            <form [formGroup]="userInfoForm" (ngSubmit)="updateUserInfo()">
              <div class="form-row">
                <div class="form-field">
                  <label>{{ translate('profile.firstName') }}</label>
                  <input type="text" formControlName="firstName" />
                </div>
                <div class="form-field">
                  <label>{{ translate('profile.lastName') }}</label>
                  <input type="text" formControlName="lastName" />
                </div>
              </div>

              <div class="form-field">
                <label>{{ translate('profile.email') }}</label>
                <div class="email-input-group">
                  <input type="email" formControlName="email" />
                  @if (currentUser()?.googleLinked) {
                    <span class="google-badge">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                        <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                        <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                        <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                        <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                      </svg>
                      {{ translate('profile.googleLinked') }}
                    </span>
                  } @else {
                    <ui-button type="button" variant="secondary" className="link-google-btn" (clicked)="linkGoogleAccount()">
                      {{ translate('profile.linkGoogle') }}
                    </ui-button>
                  }
                </div>
              </div>

              <div class="form-field">
                <label>{{ translate('profile.phone') }}</label>
                <input type="tel" formControlName="phone" />
              </div>

              <div class="form-field">
                <label>{{ translate('profile.timezone') }}</label>
                <select formControlName="timezone">
                  <option value="UTC">UTC</option>
                  <option value="America/New_York">{{ translate('profile.timezoneET') }}</option>
                  <option value="America/Chicago">{{ translate('profile.timezoneCT') }}</option>
                  <option value="America/Denver">{{ translate('profile.timezoneMT') }}</option>
                  <option value="America/Los_Angeles">{{ translate('profile.timezonePT') }}</option>
                  <option value="Europe/London">{{ translate('profile.timezoneGMT') }}</option>
                  <option value="Europe/Paris">{{ translate('profile.timezoneCET') }}</option>
                  <option value="Europe/Moscow">{{ translate('profile.timezoneMSK') }}</option>
                  <option value="Asia/Tokyo">{{ translate('profile.timezoneJST') }}</option>
                  <option value="Asia/Shanghai">{{ translate('profile.timezoneCST') }}</option>
                  <option value="Asia/Dubai">{{ translate('profile.timezoneGST') }}</option>
                </select>
              </div>

              <div class="form-actions">
                <ui-button type="submit" variant="primary" [disabled]="!userInfoForm.dirty">
                  {{ translate('profile.saveChanges') }}
                </ui-button>
                <ui-button type="button" variant="secondary" (clicked)="resetUserInfo()">
                  {{ translate('profile.cancel') }}
                </ui-button>
              </div>
            </form>
          </div>
        </div>
      }

      <!-- Trading Platforms Tab -->
      @if (activeTab() === 'platforms') {
        <div class="platforms-section">
          <div class="platforms-header">
            <h3>{{ translate('profile.tradingPlatforms') }}</h3>
            <ui-button variant="primary" (clicked)="openAddCredentialModal()">
              <ui-icon name="plus" [size]="16"></ui-icon>
              {{ translate('profile.addNewCredential') }}
            </ui-button>
          </div>

          <!-- Credentials Table -->
          <div class="credentials-table-container">
            @if (exchangeCredentialsService.loading()) {
              <div class="loading-state">
                <div class="spinner"></div>
                <p>{{ translate('profile.loadingCredentials') }}</p>
              </div>
            } @else if (credentials().length > 0) {
              <table class="credentials-table">
                <thead>
                  <tr>
                    <th>{{ translate('profile.tradingPlatform') }}</th>
                    <th>{{ translate('profile.label') }}</th>
                    <th>{{ translate('profile.apiKey') }}</th>
                    <th>{{ translate('profile.apiSecret') }}</th>
                    <th>{{ translate('profile.status') }}</th>
                    <th>{{ translate('profile.actions') }}</th>
                  </tr>
                </thead>
                <tbody>
                  @for (credential of credentials(); track credential.id) {
                    <tr [class.editing]="editingCredentialId() === credential.id">
                      <!-- Trading Platform -->
                      <td class="platform-cell">
                        <div class="platform-name">
                          <span
                            class="platform-badge clickable"
                            [style.background-color]="EXCHANGE_METADATA[credential.exchange].color"
                            (click)="openPlatformInfoModal(credential)"
                            [attr.title]="translate('profile.clickToView') + ' ' + getExchangeName(credential.exchange) + ' ' + translate('profile.accountDetails')"
                          >
                            {{ getExchangeName(credential.exchange) }}
                          </span>
                        </div>
                      </td>

                      <!-- Label -->
                      <td class="label-cell">
                        @if (editingCredentialId() === credential.id) {
                          <input
                            type="text"
                            class="edit-input"
                            [value]="editFormData().label || ''"
                            (input)="updateEditField('label', $any($event.target).value)"
                            [placeholder]="translate('profile.enterLabel')"
                          />
                        } @else {
                          <span class="label-text">{{ credential.label || '-' }}</span>
                        }
                      </td>

                      <!-- API Key -->
                      <td class="api-key-cell">
                        @if (editingCredentialId() === credential.id) {
                          <div class="password-input-wrapper">
                            <input
                              [type]="showApiSecret()[credential.id + '_key'] ? 'text' : 'password'"
                              class="edit-input"
                              [value]="showApiSecret()[credential.id + '_key'] && revealedCredentials()[credential.id] ? revealedCredentials()[credential.id]!.apiKey : (editFormData().apiKey || '')"
                              (input)="updateEditField('apiKey', $any($event.target).value)"
                              [placeholder]="translate('profile.currentKey') + ': ' + credential.apiKeyPreview + ' (' + translate('profile.enterNewOrEmpty') + ')'"
                            />
                            <ui-button type="button" variant="ghost" className="toggle-visibility-btn-small"
                                    (clicked)="toggleApiKeyVisibility(credential.id)" tabindex="-1">
                              @if (showApiSecret()[credential.id + '_key']) {
                                <ui-icon name="eye" [size]="16"></ui-icon>
                              } @else {
                                <ui-icon name="eye-off" [size]="16"></ui-icon>
                              }
                            </ui-button>
                          </div>
                        } @else {
                          <span class="api-key-preview">{{ getMaskedValue(credential.apiKeyPreview) }}</span>
                        }
                      </td>

                      <!-- API Secret -->
                      <td class="api-secret-cell">
                        @if (editingCredentialId() === credential.id) {
                          <div class="edit-field-group">
                            <div class="password-input-wrapper">
                              <input
                                [type]="showApiSecret()[credential.id + '_secret'] ? 'text' : 'password'"
                                class="edit-input"
                                [value]="showApiSecret()[credential.id + '_secret'] && revealedCredentials()[credential.id] ? revealedCredentials()[credential.id]!.apiSecret : (editFormData().apiSecret || '')"
                                (input)="updateEditField('apiSecret', $any($event.target).value)"
                                [placeholder]="translate('profile.enterNewSecret')"
                              />
                              <ui-button type="button" variant="ghost" className="toggle-visibility-btn-small"
                                      (clicked)="toggleApiSecretVisibility(credential.id)" tabindex="-1">
                                @if (showApiSecret()[credential.id + '_secret']) {
                                  <ui-icon name="eye" [size]="16"></ui-icon>
                                } @else {
                                  <ui-icon name="eye-off" [size]="16"></ui-icon>
                                }
                              </ui-button>
                            </div>
                            @if (credential.exchange === 'MEXC') {
                              <div class="auth-token-field" style="margin-top: 8px;">
                                <label style="font-size: 11px; color: var(--text-secondary); display: block; margin-bottom: 4px;">
                                  {{ translate('profile.authToken') }} ({{ translate('profile.optional') }})
                                </label>
                                <textarea
                                  class="edit-input"
                                  [value]="$any(editFormData()).authToken || ''"
                                  (input)="updateEditField('authToken', $any($event.target).value)"
                                  [placeholder]="translate('profile.enterAuthToken')"
                                  rows="2"
                                  style="font-family: monospace; font-size: 11px; resize: vertical;"
                                ></textarea>
                              </div>
                            }
                            @if (credential.exchange === 'OKX' || credential.exchange === 'BITGET' || credential.exchange === 'KUCOIN') {
                              <div class="passphrase-field" style="margin-top: 8px;">
                                <label style="font-size: 11px; color: var(--text-secondary); display: block; margin-bottom: 4px;">
                                  {{ translate('profile.passphrase') }} <span class="required">*</span>
                                </label>
                                <input
                                  type="password"
                                  class="edit-input"
                                  [value]="$any(editFormData()).passphrase || ''"
                                  (input)="updateEditField('passphrase', $any($event.target).value)"
                                  [placeholder]="translate('profile.enterPassphrase')"
                                  style="font-family: monospace; font-size: 11px;"
                                />
                                <small style="font-size: 10px; color: var(--text-secondary); display: block; margin-top: 4px;">
                                  {{ credential.exchange }} API Passphrase (leave empty to keep current)
                                </small>
                              </div>
                            }
                          </div>
                        } @else {
                          <span class="api-secret-preview">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</span>
                        }
                      </td>

                      <!-- Status -->
                      <td class="status-cell">
                        <label class="toggle-switch-small">
                          <input
                            type="checkbox"
                            [checked]="credential.isActive"
                            (change)="toggleActive(credential, $event)"
                          >
                          <span class="slider-small"></span>
                        </label>
                        <span class="status-text">{{ credential.isActive ? translate('profile.active') : translate('profile.inactive') }}</span>
                      </td>

                      <!-- Actions -->
                      <td class="actions-cell">
                        @if (editingCredentialId() === credential.id) {
                          <div class="edit-actions">
                            <ui-button
                              size="small"
                              variant="secondary"
                              className="btn-info"
                              (clicked)="testEditConnection(credential)"
                              [disabled]="testingConnectionId() === credential.id || savingCredentialId() === credential.id"
                              [title]="translate('profile.testConnection')"
                            >
                              @if (testingConnectionId() === credential.id) {
                                <span class="spinner-small"></span>
                              } @else {
                                {{ translate('button.test') }}
                              }
                            </ui-button>
                            <ui-button
                              size="small"
                              variant="secondary"
                              className="btn-success"
                              (clicked)="saveCredential(credential.id)"
                              [disabled]="savingCredentialId() === credential.id"
                            >
                              @if (savingCredentialId() === credential.id) {
                                <span class="spinner-small"></span>
                              }
                              {{ translate('button.save') }}
                            </ui-button>
                            <ui-button
                              size="small"
                              variant="secondary"
                              (clicked)="cancelEdit()"
                              [disabled]="savingCredentialId() === credential.id"
                            >
                              {{ translate('button.cancel') }}
                            </ui-button>
                          </div>
                        } @else {
                          <div class="row-actions">
                            <ui-button
                              variant="ghost"
                              className="btn-icon"
                              (clicked)="startEditCredential(credential)"
                              [title]="translate('button.edit')"
                            >
                              <ui-icon name="edit" [size]="16"></ui-icon>
                            </ui-button>
                            <ui-button
                              variant="danger"
                              className="btn-icon"
                              (clicked)="deleteCredential(credential)"
                              [disabled]="deletingCredentialId() === credential.id"
                              [title]="translate('button.delete')"
                            >
                              <ui-icon name="trash" [size]="16"></ui-icon>
                            </ui-button>
                          </div>
                        }
                      </td>
                    </tr>
                  }
                </tbody>
              </table>
            } @else {
              <div class="empty-state">
                <ui-icon name="lock" [size]="64"></ui-icon>
                <h4>{{ translate('profile.noCredentials') }}</h4>
                <p>{{ translate('profile.noCredentialsDesc') }}</p>
                <ui-button variant="primary" (clicked)="openAddCredentialModal()">
                  {{ translate('profile.addCredential') }}
                </ui-button>
              </div>
            }
          </div>

          <!-- Platform Info -->
          <div class="platform-info-section">
            <div class="info-card">
              <div class="info-icon">üîê</div>
              <h4>{{ translate('profile.secureConnection') }}</h4>
              <p>{{ translate('profile.secureConnectionDesc') }}</p>
            </div>
            <div class="info-card">
              <div class="info-icon">‚ö°</div>
              <h4>{{ translate('profile.realTimeData') }}</h4>
              <p>{{ translate('profile.realTimeDataDesc') }}</p>
            </div>
            <div class="info-card">
              <div class="info-icon">üåê</div>
              <h4>{{ translate('profile.multiExchange') }}</h4>
              <p>{{ translate('profile.multiExchangeDesc') }}</p>
            </div>
          </div>

          <!-- Add Credential Modal -->
          @if (showAddCredentialModal()) {
            <div class="modal-overlay" (click)="closeAddCredentialModal()">
              <div class="modal-content" (click)="$event.stopPropagation()">
                <div class="modal-header">
                  <h3>{{ translate('profile.addNewCredential') }}</h3>
                  <ui-button variant="ghost" className="modal-close-btn" (clicked)="closeAddCredentialModal()">
                    <ui-icon name="close" [size]="24"></ui-icon>
                  </ui-button>
                </div>

                <form [formGroup]="newCredentialForm" (ngSubmit)="saveNewCredential()" class="modal-form">
                  <!-- Exchange Selection -->
                  <div class="form-field">
                    <label>{{ translate('bot.exchange') }} <span class="required">*</span></label>
                    <select formControlName="exchange">
                      <option value="">{{ translate('bot.selectExchange') }}</option>
                      @for (exchange of exchanges; track exchange) {
                        <option [value]="exchange">
                          {{ getExchangeName(exchange) }}
                        </option>
                      }
                    </select>
                    @if (newCredentialForm.get('exchange')?.invalid && newCredentialForm.get('exchange')?.touched) {
                      <span class="field-error">{{ translate('profile.exchangeRequired') }}</span>
                    }
                  </div>

                  <!-- Label -->
                  <div class="form-field">
                    <label>{{ translate('profile.label') }} ({{ translate('profile.optional') }})</label>
                    <input
                      type="text"
                      formControlName="label"
                      [placeholder]="translate('profile.labelPlaceholder')"
                      maxlength="50"
                    />
                    <small>{{ translate('profile.labelDesc') }}</small>
                  </div>

                  <!-- API Key -->
                  <div class="form-field">
                    <label>{{ translate('profile.apiKey') }} <span class="required">*</span></label>
                    <input
                      type="text"
                      formControlName="apiKey"
                      [placeholder]="translate('profile.enterApiKey')"
                    />
                    @if (newCredentialForm.get('apiKey')?.invalid && newCredentialForm.get('apiKey')?.touched) {
                      <span class="field-error">{{ translate('profile.apiKeyError') }}</span>
                    }
                  </div>

                  <!-- API Secret -->
                  <div class="form-field">
                    <label>{{ translate('profile.apiSecret') }} <span class="required">*</span></label>
                    <div class="password-input-wrapper">
                      <input
                        [type]="showApiSecret()['new'] ? 'text' : 'password'"
                        formControlName="apiSecret"
                        [placeholder]="translate('profile.enterApiSecret')"
                      />
                      <ui-button
                        type="button"
                        variant="ghost"
                        className="toggle-visibility-btn"
                        (clicked)="toggleNewFormApiSecretVisibility()"
                        tabindex="-1"
                      >
                        @if (showApiSecret()['new']) {
                          <ui-icon name="eye" [size]="20"></ui-icon>
                        } @else {
                          <ui-icon name="eye-off" [size]="20"></ui-icon>
                        }
                      </ui-button>
                    </div>
                    @if (newCredentialForm.get('apiSecret')?.invalid && newCredentialForm.get('apiSecret')?.touched) {
                      <span class="field-error">{{ translate('profile.apiSecretError') }}</span>
                    }
                  </div>

                  <!-- Browser Session Token (MEXC only) -->
                  @if (newCredentialForm.get('exchange')?.value === 'MEXC') {
                    <div class="form-field">
                      <label>{{ translate('profile.authToken') }} ({{ translate('profile.optional') }})</label>
                      <textarea
                        formControlName="authToken"
                        [placeholder]="translate('profile.enterAuthToken')"
                        rows="3"
                        style="font-family: monospace; font-size: 12px; resize: vertical;"
                      ></textarea>
                      <small class="field-hint">
                        <strong>{{ translate('profile.mexcAuthTokenInfo') }}</strong><br>
                        {{ translate('profile.mexcAuthTokenDesc') }}
                      </small>
                    </div>
                  }

                  <!-- Passphrase (OKX, BITGET, and KUCOIN) -->
                  @if (newCredentialForm.get('exchange')?.value === 'OKX' || newCredentialForm.get('exchange')?.value === 'BITGET' || newCredentialForm.get('exchange')?.value === 'KUCOIN') {
                    <div class="form-field">
                      <label>{{ translate('profile.passphrase') }} <span class="required">*</span></label>
                      <input
                        type="password"
                        formControlName="passphrase"
                        [placeholder]="translate('profile.enterPassphrase')"
                      />
                      <small class="field-hint">
                        <strong>{{ newCredentialForm.get('exchange')?.value }} API Passphrase</strong><br>
                        {{ newCredentialForm.get('exchange')?.value }} requires a passphrase in addition to API key and secret. You created this passphrase when generating your API keys.
                      </small>
                      @if (newCredentialForm.get('passphrase')?.invalid && newCredentialForm.get('passphrase')?.touched) {
                        <span class="field-error">{{ translate('profile.passphraseRequired') }}</span>
                      }
                    </div>
                  }

                  <!-- Modal Actions -->
                  <div class="modal-actions">
                    <ui-button
                      type="button"
                      variant="tertiary"
                      (clicked)="testNewConnection()"
                      [disabled]="testingConnectionId() === 'new'"
                    >
                      @if (testingConnectionId() === 'new') {
                        <span>{{ translate('profile.testing') }}</span>
                      } @else {
                        <span>{{ translate('profile.testConnection') }}</span>
                      }
                    </ui-button>
                    <div class="actions-right">
                      <ui-button type="button" variant="secondary" (clicked)="closeAddCredentialModal()">
                        {{ translate('button.cancel') }}
                      </ui-button>
                      <ui-button type="submit" variant="primary" [disabled]="newCredentialForm.invalid">
                        {{ translate('profile.saveCredential') }}
                      </ui-button>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          }
        </div>
      }

      <!-- Messages Tab -->
      @if (activeTab() === 'messages') {
        <div class="messages-section">
          <div class="messages-header">
            <h3>{{ translate('profile.messages') }}</h3>
            <ui-button variant="secondary" className="mark-all-read-btn" (clicked)="markAllAsRead()">
              {{ translate('profile.markAllRead') }}
            </ui-button>
          </div>

          <div class="messages-list">
            @for (message of messages; track message.id) {
              <div class="message-item" [class.unread]="!message.read">
                <div class="message-icon" [class]="'icon-' + message.type">
                  @switch (message.type) {
                    @case ('info') { <span>‚ÑπÔ∏è</span> }
                    @case ('warning') { <span>‚ö†Ô∏è</span> }
                    @case ('success') { <span>‚úÖ</span> }
                    @case ('error') { <span>‚ùå</span> }
                    @case ('trade') { <span>üìà</span> }
                    @default { <span>üìß</span> }
                  }
                </div>
                <div class="message-content">
                  <div class="message-header">
                    <h4>{{ message.title }}</h4>
                    <span class="message-time">{{ message.timestamp | date:'short' }}</span>
                  </div>
                  <p>{{ message.content }}</p>
                  @if (message.actions?.length) {
                    <div class="message-actions">
                      @for (action of message.actions; track action.label) {
                        <ui-button size="small" variant="secondary" [className]="'btn-' + action.type" (clicked)="executeMessageAction(action)">
                          {{ action.label }}
                        </ui-button>
                      }
                    </div>
                  }
                </div>
                @if (!message.read) {
                  <ui-button variant="ghost" className="mark-read-btn" (clicked)="markAsRead(message.id)">
                    <span class="unread-dot"></span>
                  </ui-button>
                }
              </div>
            }
            
            @if (messages.length === 0) {
              <div class="no-messages">
                <span class="no-messages-icon">üì≠</span>
                <p>{{ translate('profile.noMessages') }}</p>
              </div>
            }
          </div>
        </div>
      }

    </div>
  </div>
</div>

<!-- Toast Notification -->
@if (showToastSignal()) {
  <div class="toast-notification" [class]="'toast-' + toastType()">
    <span>{{ toastMessage() }}</span>
    <ui-button variant="ghost" (clicked)="showToastSignal.set(false)" className="toast-close">√ó</ui-button>
  </div>
}

<!-- Trading Platform Info Modal -->
@if (showPlatformInfoModal() && selectedCredentialForModal()) {
  <app-trading-platform-info-modal
    [credential]="selectedCredentialForModal()!"
    (closeModal)="closePlatformInfoModal()"
  />
}

<!-- Confirmation Modal -->
<ui-confirmation-modal
  [open]="showConfirmModal()"
  [title]="confirmModalTitle()"
  [message]="confirmModalMessage()"
  [confirmText]="confirmModalConfirmText()"
  [cancelText]="confirmModalCancelText()"
  [confirmVariant]="confirmModalVariant()"
  (confirm)="onConfirmModalConfirm()"
  (cancel)="onConfirmModalCancel()"
  [(open)]="showConfirmModal"
/>
