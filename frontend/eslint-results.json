
> frontend@0.0.0 lint
> ng lint --format json


Linting "frontend"...
[{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\login\\login.component.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":68,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":68,"endColumn":55},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":77,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":77,"endColumn":64}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, signal, computed, effect } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormBuilder, FormGroup, Validators, ReactiveFormsModule } from '@angular/forms';\r\nimport { Router, ActivatedRoute } from '@angular/router';\r\nimport { AuthService } from '../../services/auth.service';\r\nimport { TranslationService } from '../../services/translation.service';\r\nimport { ButtonComponent } from '../ui/button/button.component';\r\n\r\n@Component({\r\n  selector: 'app-login',\r\n  standalone: true,\r\n  imports: [CommonModule, ReactiveFormsModule, ButtonComponent],\r\n  templateUrl: './login.component.html',\r\n  styleUrl: './login.component.scss'\r\n})\r\nexport class LoginComponent {\r\n  // Signals for component state\r\n  private showRegisterSignal = signal(false);\r\n  \r\n  // Computed values\r\n  readonly showRegister = this.showRegisterSignal.asReadonly();\r\n  readonly isLoading = computed(() => this.authService.isLoading());\r\n  readonly authError = computed(() => this.authService.error());\r\n  readonly sessionMessage = computed(() => {\r\n    if (this.loginReason === 'session_expired') {\r\n      return this.translate('auth.sessionExpired');\r\n    }\r\n    return null;\r\n  });\r\n\r\n  // Form groups\r\n  loginForm: FormGroup;\r\n  registerForm: FormGroup;\r\n\r\n  private returnUrl: string;\r\n  private loginReason: string | null;\r\n\r\n  constructor(\r\n    private fb: FormBuilder,\r\n    private authService: AuthService,\r\n    private router: Router,\r\n    private route: ActivatedRoute,\r\n    private translationService: TranslationService\r\n  ) {\r\n    this.returnUrl = (this.route.snapshot.queryParams['returnUrl'] as string) || '/trading';\r\n    this.loginReason = (this.route.snapshot.queryParams['reason'] as string) || null;\r\n    this.loginForm = this.fb.group({\r\n      email: ['', [Validators.required, Validators.email]],\r\n      password: ['', Validators.required]\r\n    });\r\n\r\n    this.registerForm = this.fb.group({\r\n      name: [''],\r\n      email: ['', [Validators.required, Validators.email]],\r\n      password: ['', [Validators.required, Validators.minLength(6)]]\r\n    });\r\n\r\n    // Effect to navigate when authenticated\r\n    effect(() => {\r\n      if (this.authService.isAuthenticated()) {\r\n        this.router.navigate([this.returnUrl]);\r\n      }\r\n    });\r\n  }\r\n\r\n  onLogin() {\r\n    if (this.loginForm.valid) {\r\n      const { email, password } = this.loginForm.value;\r\n      if (email && password) {\r\n        this.authService.login(email, password).subscribe();\r\n      }\r\n    }\r\n  }\r\n\r\n  onRegister() {\r\n    if (this.registerForm.valid) {\r\n      const { email, password, name } = this.registerForm.value;\r\n      if (email && password) {\r\n        this.authService.register(email, password, name || undefined).subscribe();\r\n      }\r\n    }\r\n  }\r\n\r\n  loginWithGoogle() {\r\n    // Placeholder for Google login\r\n    // In a real app, this would integrate with Google Identity Services\r\n    console.log('Google login clicked');\r\n    alert('Google login would be implemented with Google Identity Services');\r\n  }\r\n\r\n  toggleMode() {\r\n    this.showRegisterSignal.update(value => !value);\r\n    this.clearError();\r\n    this.resetForms();\r\n  }\r\n\r\n  clearError() {\r\n    this.authService.clearError();\r\n  }\r\n\r\n  translate(key: string, params?: Record<string, string>): string {\r\n    return this.translationService.translate(key, params);\r\n  }\r\n\r\n  private resetForms() {\r\n    this.loginForm.reset();\r\n    this.registerForm.reset();\r\n    this.loginForm.markAsUntouched();\r\n    this.registerForm.markAsUntouched();\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\profile\\profile.component.html","messages":[{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":70,"column":17,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":70,"endColumn":67},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":84,"column":17,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":84,"endColumn":64},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":96,"column":17,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":96,"endColumn":67},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":118,"column":17,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":118,"endColumn":77},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":131,"column":17,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":131,"endColumn":70},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":144,"column":17,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":144,"endColumn":72},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":167,"column":19,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":167,"endColumn":70},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":171,"column":19,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":171,"endColumn":69},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":177,"column":17,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":177,"endColumn":64},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":199,"column":17,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":199,"endColumn":64},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":204,"column":17,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":204,"endColumn":67},{"ruleId":"@angular-eslint/template/click-events-have-key-events","severity":2,"message":"click must be accompanied by either keyup, keydown or keypress event for accessibility.","line":272,"column":27,"nodeType":null,"messageId":"clickEventsHaveKeyEvents","endLine":279,"endColumn":34},{"ruleId":"@angular-eslint/template/interactive-supports-focus","severity":2,"message":"Elements with interaction handlers must be focusable.","line":272,"column":27,"nodeType":null,"messageId":"interactiveSupportsFocus","endLine":279,"endColumn":34},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":352,"column":33,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":354,"endColumn":41},{"ruleId":"@angular-eslint/template/click-events-have-key-events","severity":2,"message":"click must be accompanied by either keyup, keydown or keypress event for accessibility.","line":490,"column":13,"nodeType":null,"messageId":"clickEventsHaveKeyEvents","endLine":620,"endColumn":19},{"ruleId":"@angular-eslint/template/interactive-supports-focus","severity":2,"message":"Elements with interaction handlers must be focusable.","line":490,"column":13,"nodeType":null,"messageId":"interactiveSupportsFocus","endLine":620,"endColumn":19},{"ruleId":"@angular-eslint/template/click-events-have-key-events","severity":2,"message":"click must be accompanied by either keyup, keydown or keypress event for accessibility.","line":491,"column":15,"nodeType":null,"messageId":"clickEventsHaveKeyEvents","endLine":619,"endColumn":21},{"ruleId":"@angular-eslint/template/interactive-supports-focus","severity":2,"message":"Elements with interaction handlers must be focusable.","line":491,"column":15,"nodeType":null,"messageId":"interactiveSupportsFocus","endLine":619,"endColumn":21},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":505,"column":21,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":505,"endColumn":99},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":521,"column":21,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":521,"endColumn":106},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":533,"column":21,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":533,"endColumn":101},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":546,"column":21,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":546,"endColumn":104},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":581,"column":23,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":581,"endColumn":112}],"suppressedMessages":[],"errorCount":23,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<div class=\"profile-container\">\r\n  <!-- Profile Header -->\r\n  <div class=\"profile-header\">\r\n    <div class=\"user-avatar-section\">\r\n      <div class=\"avatar-container\">\r\n        <img\r\n          [src]=\"currentUser()?.avatar || '/placeholder/120'\"\r\n          [alt]=\"currentUser()?.name || currentUser()?.email\"\r\n          class=\"user-avatar-xl\"\r\n        />\r\n        <ui-button variant=\"ghost\" className=\"avatar-edit-btn\" (clicked)=\"changeAvatar()\">\r\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n            <path d=\"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\" stroke=\"currentColor\" stroke-width=\"2\"/>\r\n            <path d=\"m18.5 2.5 a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z\" stroke=\"currentColor\" stroke-width=\"2\"/>\r\n          </svg>\r\n        </ui-button>\r\n      </div>\r\n      <div class=\"user-basic-info\">\r\n        <h1 class=\"user-name\">{{ currentUser()?.name || translate('profile.anonymous') }}</h1>\r\n        <p class=\"user-email\">{{ currentUser()?.email }}</p>\r\n        <div class=\"user-status\">\r\n          <span class=\"status-badge\" [class]=\"'status-' + (currentUser()?.subscriptionActive ? 'active' : 'inactive')\">\r\n            {{ currentUser()?.subscriptionActive ? translate('profile.premium') : translate('profile.free') }}\r\n          </span>\r\n          <span class=\"role-badge\" [class]=\"'role-' + currentUser()?.role?.toLowerCase()\">\r\n            {{ currentUser()?.role }}\r\n          </span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"profile-header-actions\">\r\n      <ui-button variant=\"tertiary\" className=\"logout-btn\" (clicked)=\"logout()\">\r\n        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n          <path d=\"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\"/>\r\n          <polyline points=\"16 17 21 12 16 7\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n          <line x1=\"21\" y1=\"12\" x2=\"9\" y2=\"12\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\"/>\r\n        </svg>\r\n        {{ translate('dashboard.logout') }}\r\n      </ui-button>\r\n    </div>\r\n  </div>\r\n\r\n  <!-- Profile Content -->\r\n  <div class=\"profile-content\">\r\n    <!-- Navigation Tabs -->\r\n    <div class=\"profile-tabs\">\r\n      @for (tab of tabs; track tab.id) {\r\n        <ui-button\r\n          variant=\"ghost\"\r\n          className=\"tab-button\"\r\n          [class.active]=\"activeTab() === tab.id\"\r\n          (clicked)=\"setActiveTab(tab.id)\"\r\n        >\r\n          <span class=\"tab-icon\">{{ tab.icon }}</span>\r\n          <span class=\"tab-label\">{{ translate(tab.label) }}</span>\r\n        </ui-button>\r\n      }\r\n    </div>\r\n\r\n    <!-- Tab Content -->\r\n    <div class=\"tab-content\">\r\n      <!-- Settings Tab -->\r\n      @if (activeTab() === 'settings') {\r\n        <div class=\"settings-section\">\r\n          <div class=\"settings-group\">\r\n            <h3>{{ translate('profile.preferences') }}</h3>\r\n            \r\n            <div class=\"setting-item\">\r\n              <div class=\"setting-info\">\r\n                <label>{{ translate('profile.language') }}</label>\r\n                <p>{{ translate('profile.languageDesc') }}</p>\r\n              </div>\r\n              <div class=\"setting-control\">\r\n                <select [(ngModel)]=\"selectedLanguage\" (change)=\"changeLanguage($event)\">\r\n                  @for (lang of availableLanguages; track lang.code) {\r\n                    <option [value]=\"lang.code\">{{ lang.flag }} {{ lang.name }}</option>\r\n                  }\r\n                </select>\r\n              </div>\r\n            </div>\r\n\r\n            <div class=\"setting-item\">\r\n              <div class=\"setting-info\">\r\n                <label>{{ translate('profile.theme') }}</label>\r\n                <p>{{ translate('profile.themeDesc') }}</p>\r\n              </div>\r\n              <div class=\"setting-control\">\r\n                <ui-button variant=\"secondary\" className=\"theme-toggle-btn\" (clicked)=\"toggleTheme()\">\r\n                  {{ isDark() ? translate('theme.light') : translate('theme.dark') }}\r\n                </ui-button>\r\n              </div>\r\n            </div>\r\n\r\n            <div class=\"setting-item\">\r\n              <div class=\"setting-info\">\r\n                <label>{{ translate('profile.currency') }}</label>\r\n                <p>{{ translate('profile.currencyDesc') }}</p>\r\n              </div>\r\n              <div class=\"setting-control\">\r\n                <select [(ngModel)]=\"selectedCurrency\" (change)=\"changeCurrency($event)\">\r\n                  <option value=\"USD\">üá∫üá∏ USD</option>\r\n                  <option value=\"EUR\">üá™üá∫ EUR</option>\r\n                  <option value=\"GBP\">üá¨üáß GBP</option>\r\n                  <option value=\"JPY\">üáØüáµ JPY</option>\r\n                  <option value=\"CAD\">üá®üá¶ CAD</option>\r\n                  <option value=\"AUD\">üá¶üá∫ AUD</option>\r\n                  <option value=\"CHF\">üá®üá≠ CHF</option>\r\n                </select>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"settings-group\">\r\n            <h3>{{ translate('profile.notifications') }}</h3>\r\n            \r\n            <div class=\"setting-item\">\r\n              <div class=\"setting-info\">\r\n                <label>{{ translate('profile.emailNotifications') }}</label>\r\n                <p>{{ translate('profile.emailNotificationsDesc') }}</p>\r\n              </div>\r\n              <div class=\"setting-control\">\r\n                <label class=\"toggle-switch\">\r\n                  <input type=\"checkbox\" [(ngModel)]=\"emailNotifications\" (change)=\"updateNotificationSettings()\">\r\n                  <span class=\"slider\"></span>\r\n                </label>\r\n              </div>\r\n            </div>\r\n\r\n            <div class=\"setting-item\">\r\n              <div class=\"setting-info\">\r\n                <label>{{ translate('profile.priceAlerts') }}</label>\r\n                <p>{{ translate('profile.priceAlertsDesc') }}</p>\r\n              </div>\r\n              <div class=\"setting-control\">\r\n                <label class=\"toggle-switch\">\r\n                  <input type=\"checkbox\" [(ngModel)]=\"priceAlerts\" (change)=\"updateNotificationSettings()\">\r\n                  <span class=\"slider\"></span>\r\n                </label>\r\n              </div>\r\n            </div>\r\n\r\n            <div class=\"setting-item\">\r\n              <div class=\"setting-info\">\r\n                <label>{{ translate('profile.tradingAlerts') }}</label>\r\n                <p>{{ translate('profile.tradingAlertsDesc') }}</p>\r\n              </div>\r\n              <div class=\"setting-control\">\r\n                <label class=\"toggle-switch\">\r\n                  <input type=\"checkbox\" [(ngModel)]=\"tradingAlerts\" (change)=\"updateNotificationSettings()\">\r\n                  <span class=\"slider\"></span>\r\n                </label>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      }\r\n\r\n      <!-- User Info Tab -->\r\n      @if (activeTab() === 'userinfo') {\r\n        <div class=\"userinfo-section\">\r\n          <div class=\"info-group\">\r\n            <h3>{{ translate('profile.personalInfo') }}</h3>\r\n            \r\n            <form [formGroup]=\"userInfoForm\" (ngSubmit)=\"updateUserInfo()\">\r\n              <div class=\"form-row\">\r\n                <div class=\"form-field\">\r\n                  <label>{{ translate('profile.firstName') }}</label>\r\n                  <input type=\"text\" formControlName=\"firstName\" />\r\n                </div>\r\n                <div class=\"form-field\">\r\n                  <label>{{ translate('profile.lastName') }}</label>\r\n                  <input type=\"text\" formControlName=\"lastName\" />\r\n                </div>\r\n              </div>\r\n\r\n              <div class=\"form-field\">\r\n                <label>{{ translate('profile.email') }}</label>\r\n                <div class=\"email-input-group\">\r\n                  <input type=\"email\" formControlName=\"email\" />\r\n                  @if (currentUser()?.googleLinked) {\r\n                    <span class=\"google-badge\">\r\n                      <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\">\r\n                        <path d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\" fill=\"#4285F4\"/>\r\n                        <path d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\" fill=\"#34A853\"/>\r\n                        <path d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z\" fill=\"#FBBC05\"/>\r\n                        <path d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\" fill=\"#EA4335\"/>\r\n                      </svg>\r\n                      {{ translate('profile.googleLinked') }}\r\n                    </span>\r\n                  } @else {\r\n                    <ui-button type=\"button\" variant=\"secondary\" className=\"link-google-btn\" (clicked)=\"linkGoogleAccount()\">\r\n                      {{ translate('profile.linkGoogle') }}\r\n                    </ui-button>\r\n                  }\r\n                </div>\r\n              </div>\r\n\r\n              <div class=\"form-field\">\r\n                <label>{{ translate('profile.phone') }}</label>\r\n                <input type=\"tel\" formControlName=\"phone\" />\r\n              </div>\r\n\r\n              <div class=\"form-field\">\r\n                <label>{{ translate('profile.timezone') }}</label>\r\n                <select formControlName=\"timezone\">\r\n                  <option value=\"UTC\">UTC</option>\r\n                  <option value=\"America/New_York\">{{ translate('profile.timezoneET') }}</option>\r\n                  <option value=\"America/Chicago\">{{ translate('profile.timezoneCT') }}</option>\r\n                  <option value=\"America/Denver\">{{ translate('profile.timezoneMT') }}</option>\r\n                  <option value=\"America/Los_Angeles\">{{ translate('profile.timezonePT') }}</option>\r\n                  <option value=\"Europe/London\">{{ translate('profile.timezoneGMT') }}</option>\r\n                  <option value=\"Europe/Paris\">{{ translate('profile.timezoneCET') }}</option>\r\n                  <option value=\"Europe/Moscow\">{{ translate('profile.timezoneMSK') }}</option>\r\n                  <option value=\"Asia/Tokyo\">{{ translate('profile.timezoneJST') }}</option>\r\n                  <option value=\"Asia/Shanghai\">{{ translate('profile.timezoneCST') }}</option>\r\n                  <option value=\"Asia/Dubai\">{{ translate('profile.timezoneGST') }}</option>\r\n                </select>\r\n              </div>\r\n\r\n              <div class=\"form-actions\">\r\n                <ui-button type=\"submit\" variant=\"primary\" [disabled]=\"!userInfoForm.dirty\">\r\n                  {{ translate('profile.saveChanges') }}\r\n                </ui-button>\r\n                <ui-button type=\"button\" variant=\"secondary\" (clicked)=\"resetUserInfo()\">\r\n                  {{ translate('profile.cancel') }}\r\n                </ui-button>\r\n              </div>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      }\r\n\r\n      <!-- Trading Platforms Tab -->\r\n      @if (activeTab() === 'platforms') {\r\n        <div class=\"platforms-section\">\r\n          <div class=\"platforms-header\">\r\n            <h3>{{ translate('profile.tradingPlatforms') }}</h3>\r\n            <ui-button variant=\"primary\" (clicked)=\"openAddCredentialModal()\">\r\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                <line x1=\"12\" y1=\"5\" x2=\"12\" y2=\"19\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\"/>\r\n                <line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\"/>\r\n              </svg>\r\n              {{ translate('profile.addNewCredential') }}\r\n            </ui-button>\r\n          </div>\r\n\r\n          <!-- Credentials Table -->\r\n          <div class=\"credentials-table-container\">\r\n            @if (exchangeCredentialsService.loading()) {\r\n              <div class=\"loading-state\">\r\n                <div class=\"spinner\"></div>\r\n                <p>{{ translate('profile.loadingCredentials') }}</p>\r\n              </div>\r\n            } @else if (credentials().length > 0) {\r\n              <table class=\"credentials-table\">\r\n                <thead>\r\n                  <tr>\r\n                    <th>{{ translate('profile.tradingPlatform') }}</th>\r\n                    <th>{{ translate('profile.label') }}</th>\r\n                    <th>{{ translate('profile.apiKey') }}</th>\r\n                    <th>{{ translate('profile.apiSecret') }}</th>\r\n                    <th>{{ translate('profile.status') }}</th>\r\n                    <th>{{ translate('profile.actions') }}</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  @for (credential of credentials(); track credential.id) {\r\n                    <tr [class.editing]=\"editingCredentialId() === credential.id\">\r\n                      <!-- Trading Platform -->\r\n                      <td class=\"platform-cell\">\r\n                        <div class=\"platform-name\">\r\n                          <span\r\n                            class=\"platform-badge clickable\"\r\n                            [style.background-color]=\"EXCHANGE_METADATA[credential.exchange].color\"\r\n                            (click)=\"openPlatformInfoModal(credential)\"\r\n                            [attr.title]=\"translate('profile.clickToView') + ' ' + getExchangeName(credential.exchange) + ' ' + translate('profile.accountDetails')\"\r\n                          >\r\n                            {{ getExchangeName(credential.exchange) }}\r\n                          </span>\r\n                        </div>\r\n                      </td>\r\n\r\n                      <!-- Label -->\r\n                      <td class=\"label-cell\">\r\n                        @if (editingCredentialId() === credential.id) {\r\n                          <input\r\n                            type=\"text\"\r\n                            class=\"edit-input\"\r\n                            [value]=\"editFormData().label || ''\"\r\n                            (input)=\"updateEditField('label', $any($event.target).value)\"\r\n                            [placeholder]=\"translate('profile.enterLabel')\"\r\n                          />\r\n                        } @else {\r\n                          <span class=\"label-text\">{{ credential.label || '-' }}</span>\r\n                        }\r\n                      </td>\r\n\r\n                      <!-- API Key -->\r\n                      <td class=\"api-key-cell\">\r\n                        @if (editingCredentialId() === credential.id) {\r\n                          <div class=\"password-input-wrapper\">\r\n                            <input\r\n                              [type]=\"showApiSecret()[credential.id + '_key'] ? 'text' : 'password'\"\r\n                              class=\"edit-input\"\r\n                              [value]=\"showApiSecret()[credential.id + '_key'] && revealedCredentials()[credential.id] ? revealedCredentials()[credential.id]!.apiKey : (editFormData().apiKey || '')\"\r\n                              (input)=\"updateEditField('apiKey', $any($event.target).value)\"\r\n                              [placeholder]=\"translate('profile.currentKey') + ': ' + credential.apiKeyPreview + ' (' + translate('profile.enterNewOrEmpty') + ')'\"\r\n                            />\r\n                            <ui-button type=\"button\" variant=\"ghost\" className=\"toggle-visibility-btn-small\"\r\n                                    (clicked)=\"toggleApiKeyVisibility(credential.id)\" tabindex=\"-1\">\r\n                              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\">\r\n                                @if (showApiSecret()[credential.id + '_key']) {\r\n                                  <path d=\"M12 5C7 5 2.73 8.11 1 12.5 2.73 16.89 7 20 12 20s9.27-3.11 11-7.5C21.27 8.11 17 5 12 5zm0 12.5c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z\" stroke=\"currentColor\" stroke-width=\"2\"/>\r\n                                  <circle cx=\"12\" cy=\"12.5\" r=\"2.5\" fill=\"currentColor\"/>\r\n                                } @else {\r\n                                  <path d=\"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46A11.804 11.804 0 001 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z\" fill=\"currentColor\"/>\r\n                                }\r\n                              </svg>\r\n                            </ui-button>\r\n                          </div>\r\n                        } @else {\r\n                          <span class=\"api-key-preview\">{{ getMaskedValue(credential.apiKeyPreview) }}</span>\r\n                        }\r\n                      </td>\r\n\r\n                      <!-- API Secret -->\r\n                      <td class=\"api-secret-cell\">\r\n                        @if (editingCredentialId() === credential.id) {\r\n                          <div class=\"edit-field-group\">\r\n                            <div class=\"password-input-wrapper\">\r\n                              <input\r\n                                [type]=\"showApiSecret()[credential.id + '_secret'] ? 'text' : 'password'\"\r\n                                class=\"edit-input\"\r\n                                [value]=\"showApiSecret()[credential.id + '_secret'] && revealedCredentials()[credential.id] ? revealedCredentials()[credential.id]!.apiSecret : (editFormData().apiSecret || '')\"\r\n                                (input)=\"updateEditField('apiSecret', $any($event.target).value)\"\r\n                                [placeholder]=\"translate('profile.enterNewSecret')\"\r\n                              />\r\n                              <ui-button type=\"button\" variant=\"ghost\" className=\"toggle-visibility-btn-small\"\r\n                                      (clicked)=\"toggleApiSecretVisibility(credential.id)\" tabindex=\"-1\">\r\n                                <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\">\r\n                                  @if (showApiSecret()[credential.id + '_secret']) {\r\n                                    <path d=\"M12 5C7 5 2.73 8.11 1 12.5 2.73 16.89 7 20 12 20s9.27-3.11 11-7.5C21.27 8.11 17 5 12 5zm0 12.5c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z\" stroke=\"currentColor\" stroke-width=\"2\"/>\r\n                                    <circle cx=\"12\" cy=\"12.5\" r=\"2.5\" fill=\"currentColor\"/>\r\n                                  } @else {\r\n                                    <path d=\"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46A11.804 11.804 0 001 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z\" fill=\"currentColor\"/>\r\n                                  }\r\n                                </svg>\r\n                              </ui-button>\r\n                            </div>\r\n                            @if (credential.exchange === 'MEXC') {\r\n                              <div class=\"auth-token-field\" style=\"margin-top: 8px;\">\r\n                                <label style=\"font-size: 11px; color: var(--text-secondary); display: block; margin-bottom: 4px;\">\r\n                                  {{ translate('profile.authToken') }} ({{ translate('profile.optional') }})\r\n                                </label>\r\n                                <textarea\r\n                                  class=\"edit-input\"\r\n                                  [value]=\"$any(editFormData()).authToken || ''\"\r\n                                  (input)=\"updateEditField('authToken', $any($event.target).value)\"\r\n                                  [placeholder]=\"translate('profile.enterAuthToken')\"\r\n                                  rows=\"2\"\r\n                                  style=\"font-family: monospace; font-size: 11px; resize: vertical;\"\r\n                                ></textarea>\r\n                              </div>\r\n                            }\r\n                          </div>\r\n                        } @else {\r\n                          <span class=\"api-secret-preview\">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</span>\r\n                        }\r\n                      </td>\r\n\r\n                      <!-- Status -->\r\n                      <td class=\"status-cell\">\r\n                        <label class=\"toggle-switch-small\">\r\n                          <input\r\n                            type=\"checkbox\"\r\n                            [checked]=\"credential.isActive\"\r\n                            (change)=\"toggleActive(credential, $event)\"\r\n                          >\r\n                          <span class=\"slider-small\"></span>\r\n                        </label>\r\n                        <span class=\"status-text\">{{ credential.isActive ? translate('profile.active') : translate('profile.inactive') }}</span>\r\n                      </td>\r\n\r\n                      <!-- Actions -->\r\n                      <td class=\"actions-cell\">\r\n                        @if (editingCredentialId() === credential.id) {\r\n                          <div class=\"edit-actions\">\r\n                            <ui-button\r\n                              size=\"small\"\r\n                              variant=\"secondary\"\r\n                              className=\"btn-info\"\r\n                              (clicked)=\"testEditConnection(credential)\"\r\n                              [disabled]=\"testingConnectionId() === credential.id || savingCredentialId() === credential.id\"\r\n                              [title]=\"translate('profile.testConnection')\"\r\n                            >\r\n                              @if (testingConnectionId() === credential.id) {\r\n                                <span class=\"spinner-small\"></span>\r\n                              } @else {\r\n                                {{ translate('button.test') }}\r\n                              }\r\n                            </ui-button>\r\n                            <ui-button\r\n                              size=\"small\"\r\n                              variant=\"secondary\"\r\n                              className=\"btn-success\"\r\n                              (clicked)=\"saveCredential(credential.id)\"\r\n                              [disabled]=\"savingCredentialId() === credential.id\"\r\n                            >\r\n                              @if (savingCredentialId() === credential.id) {\r\n                                <span class=\"spinner-small\"></span>\r\n                              }\r\n                              {{ translate('button.save') }}\r\n                            </ui-button>\r\n                            <ui-button\r\n                              size=\"small\"\r\n                              variant=\"secondary\"\r\n                              (clicked)=\"cancelEdit()\"\r\n                              [disabled]=\"savingCredentialId() === credential.id\"\r\n                            >\r\n                              {{ translate('button.cancel') }}\r\n                            </ui-button>\r\n                          </div>\r\n                        } @else {\r\n                          <div class=\"row-actions\">\r\n                            <ui-button\r\n                              variant=\"ghost\"\r\n                              className=\"btn-icon\"\r\n                              (clicked)=\"startEditCredential(credential)\"\r\n                              [title]=\"translate('button.edit')\"\r\n                            >\r\n                              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\">\r\n                                <path d=\"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\" stroke=\"currentColor\" stroke-width=\"2\"/>\r\n                                <path d=\"m18.5 2.5 a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z\" stroke=\"currentColor\" stroke-width=\"2\"/>\r\n                              </svg>\r\n                            </ui-button>\r\n                            <ui-button\r\n                              variant=\"danger\"\r\n                              className=\"btn-icon\"\r\n                              (clicked)=\"deleteCredential(credential)\"\r\n                              [disabled]=\"deletingCredentialId() === credential.id\"\r\n                              [title]=\"translate('button.delete')\"\r\n                            >\r\n                              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\">\r\n                                <polyline points=\"3 6 5 6 21 6\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\"/>\r\n                                <path d=\"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\" stroke=\"currentColor\" stroke-width=\"2\"/>\r\n                              </svg>\r\n                            </ui-button>\r\n                          </div>\r\n                        }\r\n                      </td>\r\n                    </tr>\r\n                  }\r\n                </tbody>\r\n              </table>\r\n            } @else {\r\n              <div class=\"empty-state\">\r\n                <svg width=\"64\" height=\"64\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                  <path d=\"M12 2a5 5 0 0 1 5 5v3h2a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2V7a5 5 0 0 1 5-5z\" stroke=\"currentColor\" stroke-width=\"2\"/>\r\n                </svg>\r\n                <h4>{{ translate('profile.noCredentials') }}</h4>\r\n                <p>{{ translate('profile.noCredentialsDesc') }}</p>\r\n                <ui-button variant=\"primary\" (clicked)=\"openAddCredentialModal()\">\r\n                  {{ translate('profile.addCredential') }}\r\n                </ui-button>\r\n              </div>\r\n            }\r\n          </div>\r\n\r\n          <!-- Platform Info -->\r\n          <div class=\"platform-info-section\">\r\n            <div class=\"info-card\">\r\n              <div class=\"info-icon\">üîê</div>\r\n              <h4>{{ translate('profile.secureConnection') }}</h4>\r\n              <p>{{ translate('profile.secureConnectionDesc') }}</p>\r\n            </div>\r\n            <div class=\"info-card\">\r\n              <div class=\"info-icon\">‚ö°</div>\r\n              <h4>{{ translate('profile.realTimeData') }}</h4>\r\n              <p>{{ translate('profile.realTimeDataDesc') }}</p>\r\n            </div>\r\n            <div class=\"info-card\">\r\n              <div class=\"info-icon\">üåê</div>\r\n              <h4>{{ translate('profile.multiExchange') }}</h4>\r\n              <p>{{ translate('profile.multiExchangeDesc') }}</p>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Add Credential Modal -->\r\n          @if (showAddCredentialModal()) {\r\n            <div class=\"modal-overlay\" (click)=\"closeAddCredentialModal()\">\r\n              <div class=\"modal-content\" (click)=\"$event.stopPropagation()\">\r\n                <div class=\"modal-header\">\r\n                  <h3>{{ translate('profile.addNewCredential') }}</h3>\r\n                  <ui-button variant=\"ghost\" className=\"modal-close-btn\" (clicked)=\"closeAddCredentialModal()\">\r\n                    <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\">\r\n                      <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\"/>\r\n                      <line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\"/>\r\n                    </svg>\r\n                  </ui-button>\r\n                </div>\r\n\r\n                <form [formGroup]=\"newCredentialForm\" (ngSubmit)=\"saveNewCredential()\" class=\"modal-form\">\r\n                  <!-- Exchange Selection -->\r\n                  <div class=\"form-field\">\r\n                    <label>{{ translate('bot.exchange') }} <span class=\"required\">*</span></label>\r\n                    <select formControlName=\"exchange\">\r\n                      <option value=\"\">{{ translate('bot.selectExchange') }}</option>\r\n                      @for (exchange of exchanges; track exchange) {\r\n                        <option [value]=\"exchange\">\r\n                          {{ getExchangeName(exchange) }}\r\n                        </option>\r\n                      }\r\n                    </select>\r\n                    @if (newCredentialForm.get('exchange')?.invalid && newCredentialForm.get('exchange')?.touched) {\r\n                      <span class=\"field-error\">{{ translate('profile.exchangeRequired') }}</span>\r\n                    }\r\n                  </div>\r\n\r\n                  <!-- Label -->\r\n                  <div class=\"form-field\">\r\n                    <label>{{ translate('profile.label') }} ({{ translate('profile.optional') }})</label>\r\n                    <input\r\n                      type=\"text\"\r\n                      formControlName=\"label\"\r\n                      [placeholder]=\"translate('profile.labelPlaceholder')\"\r\n                      maxlength=\"50\"\r\n                    />\r\n                    <small>{{ translate('profile.labelDesc') }}</small>\r\n                  </div>\r\n\r\n                  <!-- API Key -->\r\n                  <div class=\"form-field\">\r\n                    <label>{{ translate('profile.apiKey') }} <span class=\"required\">*</span></label>\r\n                    <input\r\n                      type=\"text\"\r\n                      formControlName=\"apiKey\"\r\n                      [placeholder]=\"translate('profile.enterApiKey')\"\r\n                    />\r\n                    @if (newCredentialForm.get('apiKey')?.invalid && newCredentialForm.get('apiKey')?.touched) {\r\n                      <span class=\"field-error\">{{ translate('profile.apiKeyError') }}</span>\r\n                    }\r\n                  </div>\r\n\r\n                  <!-- API Secret -->\r\n                  <div class=\"form-field\">\r\n                    <label>{{ translate('profile.apiSecret') }} <span class=\"required\">*</span></label>\r\n                    <div class=\"password-input-wrapper\">\r\n                      <input\r\n                        [type]=\"showApiSecret()['new'] ? 'text' : 'password'\"\r\n                        formControlName=\"apiSecret\"\r\n                        [placeholder]=\"translate('profile.enterApiSecret')\"\r\n                      />\r\n                      <ui-button\r\n                        type=\"button\"\r\n                        variant=\"ghost\"\r\n                        className=\"toggle-visibility-btn\"\r\n                        (clicked)=\"toggleNewFormApiSecretVisibility()\"\r\n                        tabindex=\"-1\"\r\n                      >\r\n                        @if (showApiSecret()['new']) {\r\n                          <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\">\r\n                            <path d=\"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z\" stroke=\"currentColor\" stroke-width=\"2\"/>\r\n                            <circle cx=\"12\" cy=\"12\" r=\"3\" stroke=\"currentColor\" stroke-width=\"2\"/>\r\n                          </svg>\r\n                        } @else {\r\n                          <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\">\r\n                            <path d=\"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24\" stroke=\"currentColor\" stroke-width=\"2\"/>\r\n                            <line x1=\"1\" y1=\"1\" x2=\"23\" y2=\"23\" stroke=\"currentColor\" stroke-width=\"2\"/>\r\n                          </svg>\r\n                        }\r\n                      </ui-button>\r\n                    </div>\r\n                    @if (newCredentialForm.get('apiSecret')?.invalid && newCredentialForm.get('apiSecret')?.touched) {\r\n                      <span class=\"field-error\">{{ translate('profile.apiSecretError') }}</span>\r\n                    }\r\n                  </div>\r\n\r\n                  <!-- Browser Session Token (MEXC only) -->\r\n                  @if (newCredentialForm.get('exchange')?.value === 'MEXC') {\r\n                    <div class=\"form-field\">\r\n                      <label>{{ translate('profile.authToken') }} ({{ translate('profile.optional') }})</label>\r\n                      <textarea\r\n                        formControlName=\"authToken\"\r\n                        [placeholder]=\"translate('profile.enterAuthToken')\"\r\n                        rows=\"3\"\r\n                        style=\"font-family: monospace; font-size: 12px; resize: vertical;\"\r\n                      ></textarea>\r\n                      <small class=\"field-hint\">\r\n                        <strong>{{ translate('profile.mexcAuthTokenInfo') }}</strong><br>\r\n                        {{ translate('profile.mexcAuthTokenDesc') }}\r\n                      </small>\r\n                    </div>\r\n                  }\r\n\r\n                  <!-- Modal Actions -->\r\n                  <div class=\"modal-actions\">\r\n                    <ui-button\r\n                      type=\"button\"\r\n                      variant=\"tertiary\"\r\n                      (clicked)=\"testNewConnection()\"\r\n                      [disabled]=\"testingConnectionId() === 'new'\"\r\n                    >\r\n                      @if (testingConnectionId() === 'new') {\r\n                        <span>{{ translate('profile.testing') }}</span>\r\n                      } @else {\r\n                        <span>{{ translate('profile.testConnection') }}</span>\r\n                      }\r\n                    </ui-button>\r\n                    <div class=\"actions-right\">\r\n                      <ui-button type=\"button\" variant=\"secondary\" (clicked)=\"closeAddCredentialModal()\">\r\n                        {{ translate('button.cancel') }}\r\n                      </ui-button>\r\n                      <ui-button type=\"submit\" variant=\"primary\" [disabled]=\"newCredentialForm.invalid\">\r\n                        {{ translate('profile.saveCredential') }}\r\n                      </ui-button>\r\n                    </div>\r\n                  </div>\r\n                </form>\r\n              </div>\r\n            </div>\r\n          }\r\n        </div>\r\n      }\r\n\r\n      <!-- Messages Tab -->\r\n      @if (activeTab() === 'messages') {\r\n        <div class=\"messages-section\">\r\n          <div class=\"messages-header\">\r\n            <h3>{{ translate('profile.messages') }}</h3>\r\n            <ui-button variant=\"secondary\" className=\"mark-all-read-btn\" (clicked)=\"markAllAsRead()\">\r\n              {{ translate('profile.markAllRead') }}\r\n            </ui-button>\r\n          </div>\r\n\r\n          <div class=\"messages-list\">\r\n            @for (message of messages; track message.id) {\r\n              <div class=\"message-item\" [class.unread]=\"!message.read\">\r\n                <div class=\"message-icon\" [class]=\"'icon-' + message.type\">\r\n                  @switch (message.type) {\r\n                    @case ('info') { <span>‚ÑπÔ∏è</span> }\r\n                    @case ('warning') { <span>‚ö†Ô∏è</span> }\r\n                    @case ('success') { <span>‚úÖ</span> }\r\n                    @case ('error') { <span>‚ùå</span> }\r\n                    @case ('trade') { <span>üìà</span> }\r\n                    @default { <span>üìß</span> }\r\n                  }\r\n                </div>\r\n                <div class=\"message-content\">\r\n                  <div class=\"message-header\">\r\n                    <h4>{{ message.title }}</h4>\r\n                    <span class=\"message-time\">{{ message.timestamp | date:'short' }}</span>\r\n                  </div>\r\n                  <p>{{ message.content }}</p>\r\n                  @if (message.actions?.length) {\r\n                    <div class=\"message-actions\">\r\n                      @for (action of message.actions; track action.label) {\r\n                        <ui-button size=\"small\" variant=\"secondary\" [className]=\"'btn-' + action.type\" (clicked)=\"executeMessageAction(action)\">\r\n                          {{ action.label }}\r\n                        </ui-button>\r\n                      }\r\n                    </div>\r\n                  }\r\n                </div>\r\n                @if (!message.read) {\r\n                  <ui-button variant=\"ghost\" className=\"mark-read-btn\" (clicked)=\"markAsRead(message.id)\">\r\n                    <span class=\"unread-dot\"></span>\r\n                  </ui-button>\r\n                }\r\n              </div>\r\n            }\r\n            \r\n            @if (messages.length === 0) {\r\n              <div class=\"no-messages\">\r\n                <span class=\"no-messages-icon\">üì≠</span>\r\n                <p>{{ translate('profile.noMessages') }}</p>\r\n              </div>\r\n            }\r\n          </div>\r\n        </div>\r\n      }\r\n\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<!-- Toast Notification -->\r\n@if (showToastSignal()) {\r\n  <div class=\"toast-notification\" [class]=\"'toast-' + toastType()\">\r\n    <span>{{ toastMessage() }}</span>\r\n    <ui-button variant=\"ghost\" (clicked)=\"showToastSignal.set(false)\" className=\"toast-close\">√ó</ui-button>\r\n  </div>\r\n}\r\n\r\n<!-- Trading Platform Info Modal -->\r\n@if (showPlatformInfoModal() && selectedCredentialForModal()) {\r\n  <app-trading-platform-info-modal\r\n    [credential]=\"selectedCredentialForModal()!\"\r\n    (closeModal)=\"closePlatformInfoModal()\"\r\n  />\r\n}\r\n\r\n<!-- Confirmation Modal -->\r\n<ui-confirmation-modal\r\n  [open]=\"showConfirmModal()\"\r\n  [title]=\"confirmModalTitle()\"\r\n  [message]=\"confirmModalMessage()\"\r\n  [confirmText]=\"confirmModalConfirmText()\"\r\n  [cancelText]=\"confirmModalCancelText()\"\r\n  [confirmVariant]=\"confirmModalVariant()\"\r\n  (confirm)=\"onConfirmModalConfirm()\"\r\n  (cancel)=\"onConfirmModalCancel()\"\r\n  [(open)]=\"showConfirmModal\"\r\n/>\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\profile\\profile.component.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":46,"column":5,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":48,"endColumn":7},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":49,"column":5,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":52,"endColumn":7},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":53,"column":5,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":55,"endColumn":7},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":56,"column":5,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":56,"endColumn":74},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":57,"column":5,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":57,"endColumn":93},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":58,"column":5,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":67,"endColumn":7},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'params' is defined but never used.","line":71,"column":65,"nodeType":null,"messageId":"unusedVar","endLine":71,"endColumn":71},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3085,3088],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3085,3088],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-empty-function","severity":2,"message":"Unexpected empty method 'onConfirm'.","line":171,"column":28,"nodeType":"ArrowFunctionExpression","messageId":"unexpected","endLine":171,"endColumn":30,"suggestions":[{"messageId":"suggestComment","data":{"name":"method 'onConfirm'"},"fix":{"range":[7093,7093],"text":" /* empty */ "},"desc":"Add comment inside empty method 'onConfirm'."}]},{"ruleId":"@typescript-eslint/no-empty-function","severity":2,"message":"Unexpected empty method 'onConfirm'.","line":181,"column":28,"nodeType":"ArrowFunctionExpression","messageId":"unexpected","endLine":181,"endColumn":30,"suggestions":[{"messageId":"suggestComment","data":{"name":"method 'onConfirm'"},"fix":{"range":[7370,7370],"text":" /* empty */ "},"desc":"Add comment inside empty method 'onConfirm'."}]},{"ruleId":"@typescript-eslint/no-empty-function","severity":2,"message":"Unexpected empty method 'onConfirm'.","line":191,"column":28,"nodeType":"ArrowFunctionExpression","messageId":"unexpected","endLine":191,"endColumn":30,"suggestions":[{"messageId":"suggestComment","data":{"name":"method 'onConfirm'"},"fix":{"range":[7655,7655],"text":" /* empty */ "},"desc":"Add comment inside empty method 'onConfirm'."}]},{"ruleId":"@typescript-eslint/no-empty-function","severity":2,"message":"Unexpected empty method 'onConfirm'.","line":205,"column":28,"nodeType":"ArrowFunctionExpression","messageId":"unexpected","endLine":205,"endColumn":30,"suggestions":[{"messageId":"suggestComment","data":{"name":"method 'onConfirm'"},"fix":{"range":[8094,8094],"text":" /* empty */ "},"desc":"Add comment inside empty method 'onConfirm'."}]},{"ruleId":"@typescript-eslint/no-empty-function","severity":2,"message":"Unexpected empty method 'onConfirm'.","line":220,"column":28,"nodeType":"ArrowFunctionExpression","messageId":"unexpected","endLine":220,"endColumn":30,"suggestions":[{"messageId":"suggestComment","data":{"name":"method 'onConfirm'"},"fix":{"range":[8640,8640],"text":" /* empty */ "},"desc":"Add comment inside empty method 'onConfirm'."}]},{"ruleId":"@typescript-eslint/no-empty-function","severity":2,"message":"Unexpected empty method 'onConfirm'.","line":235,"column":28,"nodeType":"ArrowFunctionExpression","messageId":"unexpected","endLine":235,"endColumn":30,"suggestions":[{"messageId":"suggestComment","data":{"name":"method 'onConfirm'"},"fix":{"range":[9184,9184],"text":" /* empty */ "},"desc":"Add comment inside empty method 'onConfirm'."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":306,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":306,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11617,11620],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11617,11620],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":307,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":307,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11674,11677],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11674,11677],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":308,"column":11,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":308,"endColumn":34},{"ruleId":"@typescript-eslint/no-this-alias","severity":2,"message":"Unexpected aliasing of 'this' to local variable.","line":308,"column":11,"nodeType":"Identifier","messageId":"thisAssignment","endLine":308,"endColumn":27},{"ruleId":"@typescript-eslint/no-empty-function","severity":2,"message":"Unexpected empty arrow function.","line":396,"column":50,"nodeType":"ArrowFunctionExpression","messageId":"unexpected","endLine":396,"endColumn":52,"suggestions":[{"messageId":"suggestComment","data":{"name":"arrow function"},"fix":{"range":[14569,14569],"text":" /* empty */ "},"desc":"Add comment inside empty arrow function."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":423,"column":78,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":423,"endColumn":81,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15584,15587],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15584,15587],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exchangeName on an `any` value.","line":426,"column":38,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":426,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .label on an `any` value.","line":426,"column":61,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":426,"endColumn":66},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":504,"column":78,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":504,"endColumn":81,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18809,18812],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18809,18812],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exchangeName on an `any` value.","line":506,"column":37,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":506,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .label on an `any` value.","line":506,"column":59,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":506,"endColumn":64},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":518,"column":78,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":518,"endColumn":81,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19389,19392],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19389,19392],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exchangeName on an `any` value.","line":520,"column":37,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":520,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .label on an `any` value.","line":520,"column":59,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":520,"endColumn":64},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .apiKey on an `any` value.","line":610,"column":50,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":610,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .apiSecret on an `any` value.","line":611,"column":50,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":611,"endColumn":59},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":653,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":653,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24661,24664],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24661,24664],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-empty-function","severity":2,"message":"Unexpected empty method 'onConfirm'.","line":716,"column":28,"nodeType":"ArrowFunctionExpression","messageId":"unexpected","endLine":716,"endColumn":30,"suggestions":[{"messageId":"suggestComment","data":{"name":"method 'onConfirm'"},"fix":{"range":[26771,26771],"text":" /* empty */ "},"desc":"Add comment inside empty method 'onConfirm'."}]},{"ruleId":"@typescript-eslint/no-empty-function","severity":2,"message":"Unexpected empty method 'onConfirm'.","line":727,"column":28,"nodeType":"ArrowFunctionExpression","messageId":"unexpected","endLine":727,"endColumn":30,"suggestions":[{"messageId":"suggestComment","data":{"name":"method 'onConfirm'"},"fix":{"range":[27082,27082],"text":" /* empty */ "},"desc":"Add comment inside empty method 'onConfirm'."}]},{"ruleId":"@typescript-eslint/no-empty-function","severity":2,"message":"Unexpected empty method 'onConfirm'.","line":798,"column":28,"nodeType":"ArrowFunctionExpression","messageId":"unexpected","endLine":798,"endColumn":30,"suggestions":[{"messageId":"suggestComment","data":{"name":"method 'onConfirm'"},"fix":{"range":[29817,29817],"text":" /* empty */ "},"desc":"Add comment inside empty method 'onConfirm'."}]},{"ruleId":"@typescript-eslint/no-empty-function","severity":2,"message":"Unexpected empty method 'onConfirm'.","line":840,"column":28,"nodeType":"ArrowFunctionExpression","messageId":"unexpected","endLine":840,"endColumn":30,"suggestions":[{"messageId":"suggestComment","data":{"name":"method 'onConfirm'"},"fix":{"range":[31167,31167],"text":" /* empty */ "},"desc":"Add comment inside empty method 'onConfirm'."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":849,"column":78,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":849,"endColumn":81,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31623,31626],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31623,31626],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":36,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { ComponentFixture, fakeAsync, TestBed, tick } from '@angular/core/testing';\r\nimport { ReactiveFormsModule, FormsModule } from '@angular/forms';\r\nimport { RouterTestingModule } from '@angular/router/testing';\r\nimport { of, throwError } from 'rxjs';\r\n\r\nimport { ProfileComponent } from './profile.component';\r\nimport { AuthService } from '../../services/auth.service';\r\nimport { TranslationService } from '../../services/translation.service';\r\nimport { ThemeService } from '../../services/theme.service';\r\nimport { UserService } from '../../services/user.service';\r\nimport { GoogleAuthService } from '../../services/google-auth.service';\r\nimport { ExchangeCredentialsService } from '../../services/exchange-credentials.service';\r\nimport { ExchangeCredential, ExchangeType } from '../../models/exchange-credentials.model';\r\n\r\ndescribe('ProfileComponent - Confirmation Modal Tests', () => {\r\n  let component: ProfileComponent;\r\n  let fixture: ComponentFixture<ProfileComponent>;\r\n  let mockAuthService: jasmine.SpyObj<AuthService>;\r\n  let mockTranslationService: jasmine.SpyObj<TranslationService>;\r\n  let mockThemeService: jasmine.SpyObj<ThemeService>;\r\n  let mockUserService: jasmine.SpyObj<UserService>;\r\n  let mockGoogleAuthService: jasmine.SpyObj<GoogleAuthService>;\r\n  let mockExchangeCredentialsService: jasmine.SpyObj<ExchangeCredentialsService>;\r\n\r\n  const mockUser = {\r\n    id: '123',\r\n    email: 'test@example.com',\r\n    firstName: 'Test',\r\n    lastName: 'User',\r\n    roles: ['USER']\r\n  };\r\n\r\n  const mockCredential: ExchangeCredential = {\r\n    id: 'cred-123',\r\n    exchange: ExchangeType.BINANCE,\r\n    apiKeyPreview: 'ABC...XYZ',\r\n    label: 'My Binance Account',\r\n    isActive: true,\r\n    userId: '123',\r\n    createdAt: new Date().toISOString(),\r\n    updatedAt: new Date().toISOString()\r\n  };\r\n\r\n  beforeEach(async () => {\r\n    // Create mock services\r\n    mockAuthService = jasmine.createSpyObj('AuthService', ['logout', 'hasRole'], {\r\n      currentUser: jasmine.createSpy().and.returnValue(mockUser)\r\n    });\r\n    mockTranslationService = jasmine.createSpyObj('TranslationService', ['translate', 'setLanguage'], {\r\n      currentLanguage: jasmine.createSpy().and.returnValue('en'),\r\n      availableLanguages: ['en', 'es', 'fr']\r\n    });\r\n    mockThemeService = jasmine.createSpyObj('ThemeService', ['toggleTheme'], {\r\n      currentTheme: jasmine.createSpy().and.returnValue('light')\r\n    });\r\n    mockUserService = jasmine.createSpyObj('UserService', ['updateUser']);\r\n    mockGoogleAuthService = jasmine.createSpyObj('GoogleAuthService', ['linkGoogleAccount']);\r\n    mockExchangeCredentialsService = jasmine.createSpyObj('ExchangeCredentialsService', [\r\n      'fetchCredentials',\r\n      'getCredentialById',\r\n      'createCredential',\r\n      'updateCredential',\r\n      'deleteCredential',\r\n      'testConnection'\r\n    ], {\r\n      credentials: jasmine.createSpy().and.returnValue([])\r\n    });\r\n\r\n    // Setup default mock return values\r\n    mockAuthService.logout.and.returnValue(of(void 0));\r\n    mockTranslationService.translate.and.callFake((key: string, params?: any) => key);\r\n    mockExchangeCredentialsService.fetchCredentials.and.returnValue(of([]));\r\n\r\n    await TestBed.configureTestingModule({\r\n      imports: [\r\n        ProfileComponent,\r\n        ReactiveFormsModule,\r\n        FormsModule,\r\n        RouterTestingModule\r\n      ],\r\n      providers: [\r\n        { provide: AuthService, useValue: mockAuthService },\r\n        { provide: TranslationService, useValue: mockTranslationService },\r\n        { provide: ThemeService, useValue: mockThemeService },\r\n        { provide: UserService, useValue: mockUserService },\r\n        { provide: GoogleAuthService, useValue: mockGoogleAuthService },\r\n        { provide: ExchangeCredentialsService, useValue: mockExchangeCredentialsService }\r\n      ]\r\n    }).compileComponents();\r\n\r\n    fixture = TestBed.createComponent(ProfileComponent);\r\n    component = fixture.componentInstance;\r\n    fixture.detectChanges();\r\n  });\r\n\r\n  it('should create', () => {\r\n    expect(component).toBeTruthy();\r\n  });\r\n\r\n  // ============================================================================\r\n  // CONFIRMATION MODAL TESTS\r\n  // ============================================================================\r\n\r\n  describe('Confirmation Modal', () => {\r\n    describe('showConfirmation()', () => {\r\n      it('should set all modal properties correctly with full config', () => {\r\n        const mockCallback = jasmine.createSpy('onConfirm');\r\n        const config = {\r\n          title: 'Delete Item',\r\n          message: 'Are you sure you want to delete this item?',\r\n          confirmText: 'Delete',\r\n          cancelText: 'Cancel',\r\n          variant: 'danger' as const,\r\n          onConfirm: mockCallback\r\n        };\r\n\r\n        component.showConfirmation(config);\r\n\r\n        expect(component.confirmModalTitle()).toBe('Delete Item');\r\n        expect(component.confirmModalMessage()).toBe('Are you sure you want to delete this item?');\r\n        expect(component.confirmModalConfirmText()).toBe('Delete');\r\n        expect(component.confirmModalCancelText()).toBe('Cancel');\r\n        expect(component.confirmModalVariant()).toBe('danger');\r\n        expect(component.confirmModalCallback()).toBe(mockCallback);\r\n        expect(component.showConfirmModal()).toBe(true);\r\n      });\r\n\r\n      it('should set default values when optional properties are not provided', () => {\r\n        const mockCallback = jasmine.createSpy('onConfirm');\r\n        mockTranslationService.translate.and.callFake((key: string) => {\r\n          const translations: Record<string, string> = {\r\n            'modal.confirmTitle': 'Confirm',\r\n            'modal.confirm': 'OK',\r\n            'modal.cancel': 'Cancel'\r\n          };\r\n          return translations[key] || key;\r\n        });\r\n\r\n        component.showConfirmation({\r\n          message: 'Proceed with action?',\r\n          onConfirm: mockCallback\r\n        });\r\n\r\n        expect(component.confirmModalTitle()).toBe('Confirm');\r\n        expect(component.confirmModalMessage()).toBe('Proceed with action?');\r\n        expect(component.confirmModalConfirmText()).toBe('OK');\r\n        expect(component.confirmModalCancelText()).toBe('Cancel');\r\n        expect(component.confirmModalVariant()).toBe('primary');\r\n        expect(component.confirmModalCallback()).toBe(mockCallback);\r\n        expect(component.showConfirmModal()).toBe(true);\r\n      });\r\n\r\n      it('should store the callback function directly without wrapping', () => {\r\n        const mockCallback = jasmine.createSpy('onConfirm');\r\n\r\n        component.showConfirmation({\r\n          message: 'Test message',\r\n          onConfirm: mockCallback\r\n        });\r\n\r\n        const storedCallback = component.confirmModalCallback();\r\n        expect(storedCallback).toBe(mockCallback);\r\n        expect(typeof storedCallback).toBe('function');\r\n      });\r\n\r\n      it('should open the confirmation modal', () => {\r\n        expect(component.showConfirmModal()).toBe(false);\r\n\r\n        component.showConfirmation({\r\n          message: 'Test',\r\n          onConfirm: () => {}\r\n        });\r\n\r\n        expect(component.showConfirmModal()).toBe(true);\r\n      });\r\n\r\n      it('should support warning variant', () => {\r\n        component.showConfirmation({\r\n          message: 'Warning message',\r\n          variant: 'warning',\r\n          onConfirm: () => {}\r\n        });\r\n\r\n        expect(component.confirmModalVariant()).toBe('warning');\r\n      });\r\n\r\n      it('should support primary variant', () => {\r\n        component.showConfirmation({\r\n          message: 'Primary message',\r\n          variant: 'primary',\r\n          onConfirm: () => {}\r\n        });\r\n\r\n        expect(component.confirmModalVariant()).toBe('primary');\r\n      });\r\n\r\n      it('should translate title when not provided', () => {\r\n        mockTranslationService.translate.and.callFake((key: string) => {\r\n          if (key === 'modal.confirmTitle') return 'Translated Confirm';\r\n          return key;\r\n        });\r\n\r\n        component.showConfirmation({\r\n          message: 'Test',\r\n          onConfirm: () => {}\r\n        });\r\n\r\n        expect(mockTranslationService.translate).toHaveBeenCalledWith('modal.confirmTitle');\r\n        expect(component.confirmModalTitle()).toBe('Translated Confirm');\r\n      });\r\n\r\n      it('should translate confirm button text when not provided', () => {\r\n        mockTranslationService.translate.and.callFake((key: string) => {\r\n          if (key === 'modal.confirm') return 'Translated OK';\r\n          return key;\r\n        });\r\n\r\n        component.showConfirmation({\r\n          message: 'Test',\r\n          onConfirm: () => {}\r\n        });\r\n\r\n        expect(mockTranslationService.translate).toHaveBeenCalledWith('modal.confirm');\r\n        expect(component.confirmModalConfirmText()).toBe('Translated OK');\r\n      });\r\n\r\n      it('should translate cancel button text when not provided', () => {\r\n        mockTranslationService.translate.and.callFake((key: string) => {\r\n          if (key === 'modal.cancel') return 'Translated Cancel';\r\n          return key;\r\n        });\r\n\r\n        component.showConfirmation({\r\n          message: 'Test',\r\n          onConfirm: () => {}\r\n        });\r\n\r\n        expect(mockTranslationService.translate).toHaveBeenCalledWith('modal.cancel');\r\n        expect(component.confirmModalCancelText()).toBe('Translated Cancel');\r\n      });\r\n    });\r\n\r\n    describe('onConfirmModalConfirm()', () => {\r\n      it('should close the confirmation modal', () => {\r\n        component.showConfirmModal.set(true);\r\n\r\n        component.onConfirmModalConfirm();\r\n\r\n        expect(component.showConfirmModal()).toBe(false);\r\n      });\r\n\r\n      it('should execute the stored callback after closing modal', fakeAsync(() => {\r\n        const mockCallback = jasmine.createSpy('onConfirm');\r\n        component.confirmModalCallback.set(mockCallback);\r\n        component.showConfirmModal.set(true);\r\n\r\n        component.onConfirmModalConfirm();\r\n\r\n        // Modal should close immediately\r\n        expect(component.showConfirmModal()).toBe(false);\r\n        // Callback should not be called yet\r\n        expect(mockCallback).not.toHaveBeenCalled();\r\n\r\n        // Callback should be called after timeout\r\n        tick(0);\r\n        expect(mockCallback).toHaveBeenCalledTimes(1);\r\n      }));\r\n\r\n      it('should handle case when no callback is set', fakeAsync(() => {\r\n        component.confirmModalCallback.set(null);\r\n        component.showConfirmModal.set(true);\r\n\r\n        expect(() => {\r\n          component.onConfirmModalConfirm();\r\n          tick(0);\r\n        }).not.toThrow();\r\n\r\n        expect(component.showConfirmModal()).toBe(false);\r\n      }));\r\n\r\n      it('should clear the callback after closing', () => {\r\n        const mockCallback = jasmine.createSpy('onConfirm');\r\n        component.confirmModalCallback.set(mockCallback);\r\n\r\n        component.onConfirmModalConfirm();\r\n\r\n        expect(component.confirmModalCallback()).toBeNull();\r\n      });\r\n\r\n      it('should use setTimeout for proper timing', fakeAsync(() => {\r\n        const mockCallback = jasmine.createSpy('onConfirm');\r\n        component.confirmModalCallback.set(mockCallback);\r\n        component.showConfirmModal.set(true);\r\n\r\n        const spySetTimeout = spyOn(window, 'setTimeout').and.callThrough();\r\n\r\n        component.onConfirmModalConfirm();\r\n\r\n        expect(spySetTimeout).toHaveBeenCalledWith(jasmine.any(Function), 0);\r\n\r\n        tick(0);\r\n        expect(mockCallback).toHaveBeenCalled();\r\n      }));\r\n\r\n      it('should execute callback with correct context', fakeAsync(() => {\r\n        let executionContext: any = null;\r\n        const mockCallback = function(this: any) {\r\n          executionContext = this;\r\n        };\r\n        component.confirmModalCallback.set(mockCallback);\r\n\r\n        component.onConfirmModalConfirm();\r\n        tick(0);\r\n\r\n        // Context should be preserved (will be undefined in strict mode or window in non-strict)\r\n        expect(executionContext).toBeDefined();\r\n      }));\r\n\r\n      it('should handle callback that throws an error', fakeAsync(() => {\r\n        const errorCallback = jasmine.createSpy('errorCallback').and.throwError('Test error');\r\n        component.confirmModalCallback.set(errorCallback);\r\n\r\n        component.onConfirmModalConfirm();\r\n\r\n        // Modal should still close\r\n        expect(component.showConfirmModal()).toBe(false);\r\n\r\n        // Error should be thrown when callback executes\r\n        expect(() => {\r\n          tick(0);\r\n        }).toThrowError('Test error');\r\n      }));\r\n    });\r\n\r\n    describe('onConfirmModalCancel()', () => {\r\n      it('should close the confirmation modal', () => {\r\n        component.showConfirmModal.set(true);\r\n\r\n        component.onConfirmModalCancel();\r\n\r\n        expect(component.showConfirmModal()).toBe(false);\r\n      });\r\n\r\n      it('should NOT execute the callback', fakeAsync(() => {\r\n        const mockCallback = jasmine.createSpy('onConfirm');\r\n        component.confirmModalCallback.set(mockCallback);\r\n        component.showConfirmModal.set(true);\r\n\r\n        component.onConfirmModalCancel();\r\n\r\n        tick(1000); // Wait for any potential timeouts\r\n\r\n        expect(mockCallback).not.toHaveBeenCalled();\r\n      }));\r\n\r\n      it('should clear the callback', () => {\r\n        const mockCallback = jasmine.createSpy('onConfirm');\r\n        component.confirmModalCallback.set(mockCallback);\r\n\r\n        component.onConfirmModalCancel();\r\n\r\n        expect(component.confirmModalCallback()).toBeNull();\r\n      });\r\n\r\n      it('should handle multiple cancel calls gracefully', () => {\r\n        component.showConfirmModal.set(true);\r\n\r\n        component.onConfirmModalCancel();\r\n        expect(component.showConfirmModal()).toBe(false);\r\n\r\n        component.onConfirmModalCancel();\r\n        expect(component.showConfirmModal()).toBe(false);\r\n      });\r\n    });\r\n\r\n    describe('closeConfirmModal()', () => {\r\n      it('should set showConfirmModal to false', () => {\r\n        component.showConfirmModal.set(true);\r\n\r\n        component.closeConfirmModal();\r\n\r\n        expect(component.showConfirmModal()).toBe(false);\r\n      });\r\n\r\n      it('should clear the callback', () => {\r\n        const mockCallback = jasmine.createSpy('onConfirm');\r\n        component.confirmModalCallback.set(mockCallback);\r\n\r\n        component.closeConfirmModal();\r\n\r\n        expect(component.confirmModalCallback()).toBeNull();\r\n      });\r\n\r\n      it('should clear all modal state', () => {\r\n        component.showConfirmModal.set(true);\r\n        component.confirmModalCallback.set(() => {});\r\n\r\n        component.closeConfirmModal();\r\n\r\n        expect(component.showConfirmModal()).toBe(false);\r\n        expect(component.confirmModalCallback()).toBeNull();\r\n      });\r\n\r\n      it('should be safe to call when modal is already closed', () => {\r\n        component.showConfirmModal.set(false);\r\n        component.confirmModalCallback.set(null);\r\n\r\n        expect(() => {\r\n          component.closeConfirmModal();\r\n        }).not.toThrow();\r\n\r\n        expect(component.showConfirmModal()).toBe(false);\r\n        expect(component.confirmModalCallback()).toBeNull();\r\n      });\r\n    });\r\n\r\n    // ============================================================================\r\n    // INTEGRATION TESTS\r\n    // ============================================================================\r\n\r\n    describe('Integration: Delete Credential Flow', () => {\r\n      it('should show confirmation modal when deleteCredential is called', () => {\r\n        mockTranslationService.translate.and.callFake((key: string, params?: any) => {\r\n          if (key === 'modal.deleteCredentialTitle') return 'Delete Credential';\r\n          if (key === 'modal.deleteCredentialMessage') {\r\n            return `Delete ${params?.exchangeName}${params?.label}?`;\r\n          }\r\n          if (key === 'button.delete') return 'Delete';\r\n          return key;\r\n        });\r\n\r\n        component.deleteCredential(mockCredential);\r\n\r\n        expect(component.showConfirmModal()).toBe(true);\r\n        expect(component.confirmModalTitle()).toBe('Delete Credential');\r\n        expect(component.confirmModalMessage()).toContain('Binance');\r\n        expect(component.confirmModalConfirmText()).toBe('Delete');\r\n        expect(component.confirmModalVariant()).toBe('danger');\r\n        expect(component.confirmModalCallback()).toBeTruthy();\r\n      });\r\n\r\n      it('should delete credential when user confirms', fakeAsync(() => {\r\n        mockExchangeCredentialsService.deleteCredential.and.returnValue(of(void 0));\r\n        mockExchangeCredentialsService.credentials.and.returnValue([]);\r\n        spyOn(component, 'showToast');\r\n\r\n        component.deleteCredential(mockCredential);\r\n\r\n        expect(component.showConfirmModal()).toBe(true);\r\n\r\n        // User confirms deletion\r\n        component.onConfirmModalConfirm();\r\n        tick(0);\r\n\r\n        expect(mockExchangeCredentialsService.deleteCredential).toHaveBeenCalledWith('cred-123');\r\n        expect(component.showToast).toHaveBeenCalledWith('Credential deleted successfully!', 'success');\r\n      }));\r\n\r\n      it('should NOT delete credential when user cancels', fakeAsync(() => {\r\n        component.deleteCredential(mockCredential);\r\n\r\n        expect(component.showConfirmModal()).toBe(true);\r\n\r\n        // User cancels deletion\r\n        component.onConfirmModalCancel();\r\n        tick(100);\r\n\r\n        expect(mockExchangeCredentialsService.deleteCredential).not.toHaveBeenCalled();\r\n      }));\r\n\r\n      it('should show error toast when deletion fails', fakeAsync(() => {\r\n        const errorMessage = 'Network error';\r\n        mockExchangeCredentialsService.deleteCredential.and.returnValue(\r\n          throwError(() => ({ message: errorMessage }))\r\n        );\r\n        spyOn(component, 'showToast');\r\n\r\n        component.deleteCredential(mockCredential);\r\n        component.onConfirmModalConfirm();\r\n        tick(0);\r\n\r\n        expect(component.showToast).toHaveBeenCalledWith(\r\n          `Failed to delete credential: ${errorMessage}`,\r\n          'error'\r\n        );\r\n      }));\r\n\r\n      it('should set deletingCredentialId during deletion', fakeAsync(() => {\r\n        mockExchangeCredentialsService.deleteCredential.and.returnValue(of(void 0));\r\n        mockExchangeCredentialsService.credentials.and.returnValue([]);\r\n\r\n        component.deleteCredential(mockCredential);\r\n        component.onConfirmModalConfirm();\r\n        tick(0);\r\n\r\n        expect(component.deletingCredentialId()).toBe('cred-123');\r\n\r\n        // After successful deletion, it should be cleared\r\n        tick(0);\r\n        expect(component.deletingCredentialId()).toBeNull();\r\n      }));\r\n\r\n      it('should include credential label in confirmation message', () => {\r\n        mockTranslationService.translate.and.callFake((key: string, params?: any) => {\r\n          if (key === 'modal.deleteCredentialMessage' && params) {\r\n            return `Delete ${params.exchangeName}${params.label}?`;\r\n          }\r\n          return key;\r\n        });\r\n\r\n        const credentialWithLabel = { ...mockCredential, label: 'My Trading Account' };\r\n        component.deleteCredential(credentialWithLabel);\r\n\r\n        expect(component.confirmModalMessage()).toContain('My Trading Account');\r\n      });\r\n\r\n      it('should handle credential without label', () => {\r\n        mockTranslationService.translate.and.callFake((key: string, params?: any) => {\r\n          if (key === 'modal.deleteCredentialMessage' && params) {\r\n            return `Delete ${params.exchangeName}${params.label}?`;\r\n          }\r\n          return key;\r\n        });\r\n\r\n        const credentialWithoutLabel = { ...mockCredential, label: '' };\r\n        component.deleteCredential(credentialWithoutLabel);\r\n\r\n        expect(component.confirmModalMessage()).toContain('Binance');\r\n      });\r\n    });\r\n\r\n    describe('Integration: Unsaved Changes Flow', () => {\r\n      it('should show confirmation modal when closing Add Credential modal with dirty form', () => {\r\n        mockTranslationService.translate.and.callFake((key: string) => {\r\n          const translations: Record<string, string> = {\r\n            'modal.unsavedChangesTitle': 'Unsaved Changes',\r\n            'modal.unsavedChangesMessage': 'You have unsaved changes. Discard?',\r\n            'modal.confirm': 'Discard'\r\n          };\r\n          return translations[key] || key;\r\n        });\r\n\r\n        component.newCredentialForm.markAsDirty();\r\n        component.showAddCredentialModal.set(true);\r\n\r\n        component.closeAddCredentialModal();\r\n\r\n        expect(component.showConfirmModal()).toBe(true);\r\n        expect(component.confirmModalTitle()).toBe('Unsaved Changes');\r\n        expect(component.confirmModalMessage()).toBe('You have unsaved changes. Discard?');\r\n        expect(component.confirmModalVariant()).toBe('warning');\r\n        expect(component.showAddCredentialModal()).toBe(true); // Should still be open\r\n      });\r\n\r\n      it('should close Add Credential modal when user confirms discarding changes', fakeAsync(() => {\r\n        component.newCredentialForm.markAsDirty();\r\n        component.showAddCredentialModal.set(true);\r\n\r\n        component.closeAddCredentialModal();\r\n        expect(component.showConfirmModal()).toBe(true);\r\n\r\n        // User confirms\r\n        component.onConfirmModalConfirm();\r\n        tick(0);\r\n\r\n        expect(component.showAddCredentialModal()).toBe(false);\r\n        expect(component.newCredentialForm.pristine).toBe(true);\r\n      }));\r\n\r\n      it('should NOT close Add Credential modal when user cancels', fakeAsync(() => {\r\n        component.newCredentialForm.markAsDirty();\r\n        component.showAddCredentialModal.set(true);\r\n\r\n        component.closeAddCredentialModal();\r\n        expect(component.showConfirmModal()).toBe(true);\r\n\r\n        // User cancels\r\n        component.onConfirmModalCancel();\r\n        tick(100);\r\n\r\n        expect(component.showAddCredentialModal()).toBe(true);\r\n        expect(component.newCredentialForm.dirty).toBe(true);\r\n      }));\r\n\r\n      it('should close Add Credential modal without confirmation when form is pristine', () => {\r\n        component.newCredentialForm.markAsPristine();\r\n        component.showAddCredentialModal.set(true);\r\n\r\n        component.closeAddCredentialModal();\r\n\r\n        expect(component.showConfirmModal()).toBe(false);\r\n        expect(component.showAddCredentialModal()).toBe(false);\r\n      });\r\n\r\n      it('should reset form after confirming discard', fakeAsync(() => {\r\n        component.newCredentialForm.setValue({\r\n          exchange: ExchangeType.BINANCE,\r\n          apiKey: 'test-key',\r\n          apiSecret: 'test-secret',\r\n          authToken: '',\r\n          label: 'Test'\r\n        });\r\n        component.newCredentialForm.markAsDirty();\r\n        component.showAddCredentialModal.set(true);\r\n\r\n        component.closeAddCredentialModal();\r\n        component.onConfirmModalConfirm();\r\n        tick(0);\r\n\r\n        expect(component.newCredentialForm.value.apiKey).toBe('');\r\n        expect(component.newCredentialForm.value.apiSecret).toBe('');\r\n      }));\r\n    });\r\n\r\n    describe('Edge Cases and Error Handling', () => {\r\n      it('should handle rapid open/close of confirmation modal', fakeAsync(() => {\r\n        const callback1 = jasmine.createSpy('callback1');\r\n        const callback2 = jasmine.createSpy('callback2');\r\n\r\n        component.showConfirmation({ message: 'First', onConfirm: callback1 });\r\n        component.closeConfirmModal();\r\n        component.showConfirmation({ message: 'Second', onConfirm: callback2 });\r\n        component.onConfirmModalConfirm();\r\n        tick(0);\r\n\r\n        expect(callback1).not.toHaveBeenCalled();\r\n        expect(callback2).toHaveBeenCalledTimes(1);\r\n      }));\r\n\r\n      it('should handle confirmation modal opened multiple times before confirming', fakeAsync(() => {\r\n        const callback1 = jasmine.createSpy('callback1');\r\n        const callback2 = jasmine.createSpy('callback2');\r\n\r\n        component.showConfirmation({ message: 'First', onConfirm: callback1 });\r\n        component.showConfirmation({ message: 'Second', onConfirm: callback2 });\r\n        component.onConfirmModalConfirm();\r\n        tick(0);\r\n\r\n        expect(callback1).not.toHaveBeenCalled();\r\n        expect(callback2).toHaveBeenCalledTimes(1);\r\n      }));\r\n\r\n      it('should handle null callback gracefully', fakeAsync(() => {\r\n        component.confirmModalCallback.set(null);\r\n\r\n        expect(() => {\r\n          component.onConfirmModalConfirm();\r\n          tick(0);\r\n        }).not.toThrow();\r\n      }));\r\n\r\n      it('should handle undefined callback gracefully', fakeAsync(() => {\r\n        component.confirmModalCallback.set(undefined as any);\r\n\r\n        expect(() => {\r\n          component.onConfirmModalConfirm();\r\n          tick(0);\r\n        }).not.toThrow();\r\n      }));\r\n\r\n      it('should maintain signal reactivity when updating modal state', () => {\r\n        const callback = jasmine.createSpy('callback');\r\n\r\n        component.showConfirmation({ message: 'Test', onConfirm: callback });\r\n        fixture.detectChanges();\r\n\r\n        expect(component.showConfirmModal()).toBe(true);\r\n\r\n        component.closeConfirmModal();\r\n        fixture.detectChanges();\r\n\r\n        expect(component.showConfirmModal()).toBe(false);\r\n      });\r\n\r\n      it('should handle confirmation callback that modifies component state', fakeAsync(() => {\r\n        let callbackExecuted = false;\r\n        const callback = () => {\r\n          callbackExecuted = true;\r\n          component.activeTab.set('platforms');\r\n        };\r\n\r\n        component.showConfirmation({ message: 'Test', onConfirm: callback });\r\n        component.onConfirmModalConfirm();\r\n        tick(0);\r\n\r\n        expect(callbackExecuted).toBe(true);\r\n        expect(component.activeTab()).toBe('platforms');\r\n      }));\r\n\r\n      it('should handle confirmation callback that triggers another confirmation', fakeAsync(() => {\r\n        const nestedCallback = jasmine.createSpy('nestedCallback');\r\n        const outerCallback = () => {\r\n          component.showConfirmation({\r\n            message: 'Nested confirmation',\r\n            onConfirm: nestedCallback\r\n          });\r\n        };\r\n\r\n        component.showConfirmation({ message: 'Outer', onConfirm: outerCallback });\r\n        component.onConfirmModalConfirm();\r\n        tick(0);\r\n\r\n        expect(component.showConfirmModal()).toBe(true);\r\n        expect(component.confirmModalMessage()).toBe('Nested confirmation');\r\n\r\n        component.onConfirmModalConfirm();\r\n        tick(0);\r\n\r\n        expect(nestedCallback).toHaveBeenCalled();\r\n      }));\r\n\r\n      it('should preserve variant type across modal lifecycle', () => {\r\n        component.showConfirmation({\r\n          message: 'Test',\r\n          variant: 'danger',\r\n          onConfirm: () => {}\r\n        });\r\n\r\n        expect(component.confirmModalVariant()).toBe('danger');\r\n\r\n        component.onConfirmModalCancel();\r\n\r\n        // Open another modal with different variant\r\n        component.showConfirmation({\r\n          message: 'Test 2',\r\n          variant: 'warning',\r\n          onConfirm: () => {}\r\n        });\r\n\r\n        expect(component.confirmModalVariant()).toBe('warning');\r\n      });\r\n\r\n      it('should handle callback that returns a value', fakeAsync(() => {\r\n        const callbackWithReturn = jasmine.createSpy('callbackWithReturn').and.returnValue('some value');\r\n        component.confirmModalCallback.set(callbackWithReturn);\r\n\r\n        component.onConfirmModalConfirm();\r\n        tick(0);\r\n\r\n        expect(callbackWithReturn).toHaveBeenCalled();\r\n      }));\r\n\r\n      it('should handle async callback', fakeAsync(() => {\r\n        let asyncCompleted = false;\r\n        const asyncCallback = async () => {\r\n          await new Promise(resolve => setTimeout(resolve, 100));\r\n          asyncCompleted = true;\r\n        };\r\n\r\n        component.confirmModalCallback.set(asyncCallback);\r\n        component.onConfirmModalConfirm();\r\n        tick(0);\r\n\r\n        // Callback should be called but might not complete yet\r\n        tick(100);\r\n        expect(asyncCompleted).toBe(true);\r\n      }));\r\n    });\r\n\r\n    describe('Modal State Management', () => {\r\n      it('should initialize all modal signals with correct default values', () => {\r\n        expect(component.showConfirmModal()).toBe(false);\r\n        expect(component.confirmModalTitle()).toBe('');\r\n        expect(component.confirmModalMessage()).toBe('');\r\n        expect(component.confirmModalConfirmText()).toBe('');\r\n        expect(component.confirmModalCancelText()).toBe('');\r\n        expect(component.confirmModalVariant()).toBe('primary');\r\n        expect(component.confirmModalCallback()).toBeNull();\r\n      });\r\n\r\n      it('should update all signals when showConfirmation is called', () => {\r\n        const callback = jasmine.createSpy('callback');\r\n        component.showConfirmation({\r\n          title: 'Custom Title',\r\n          message: 'Custom Message',\r\n          confirmText: 'Yes',\r\n          cancelText: 'No',\r\n          variant: 'danger',\r\n          onConfirm: callback\r\n        });\r\n\r\n        expect(component.showConfirmModal()).toBe(true);\r\n        expect(component.confirmModalTitle()).toBe('Custom Title');\r\n        expect(component.confirmModalMessage()).toBe('Custom Message');\r\n        expect(component.confirmModalConfirmText()).toBe('Yes');\r\n        expect(component.confirmModalCancelText()).toBe('No');\r\n        expect(component.confirmModalVariant()).toBe('danger');\r\n        expect(component.confirmModalCallback()).toBe(callback);\r\n      });\r\n\r\n      it('should only clear necessary signals when modal closes', () => {\r\n        component.showConfirmation({\r\n          title: 'Test',\r\n          message: 'Message',\r\n          confirmText: 'OK',\r\n          cancelText: 'Cancel',\r\n          variant: 'warning',\r\n          onConfirm: () => {}\r\n        });\r\n\r\n        component.closeConfirmModal();\r\n\r\n        expect(component.showConfirmModal()).toBe(false);\r\n        expect(component.confirmModalCallback()).toBeNull();\r\n        // Other signals may retain their values (implementation detail)\r\n      });\r\n\r\n      it('should handle signal updates in correct order during confirm', fakeAsync(() => {\r\n        const executionOrder: string[] = [];\r\n        const callback = () => {\r\n          executionOrder.push('callback');\r\n        };\r\n\r\n        component.showConfirmation({ message: 'Test', onConfirm: callback });\r\n        executionOrder.push('modal-opened');\r\n\r\n        component.onConfirmModalConfirm();\r\n        executionOrder.push('confirm-called');\r\n\r\n        expect(component.showConfirmModal()).toBe(false);\r\n        executionOrder.push('modal-closed');\r\n\r\n        tick(0);\r\n\r\n        expect(executionOrder).toEqual([\r\n          'modal-opened',\r\n          'confirm-called',\r\n          'modal-closed',\r\n          'callback'\r\n        ]);\r\n      }));\r\n    });\r\n\r\n    describe('Translation Integration', () => {\r\n      it('should use translation service for all default texts', () => {\r\n        mockTranslationService.translate.and.callFake((key: string) => `translated_${key}`);\r\n\r\n        component.showConfirmation({\r\n          message: 'Test message',\r\n          onConfirm: () => {}\r\n        });\r\n\r\n        expect(mockTranslationService.translate).toHaveBeenCalledWith('modal.confirmTitle');\r\n        expect(mockTranslationService.translate).toHaveBeenCalledWith('modal.confirm');\r\n        expect(mockTranslationService.translate).toHaveBeenCalledWith('modal.cancel');\r\n      });\r\n\r\n      it('should pass parameters to translation service correctly', () => {\r\n        mockTranslationService.translate.and.callFake((key: string, params?: any) => {\r\n          if (params) {\r\n            return `${key}:${JSON.stringify(params)}`;\r\n          }\r\n          return key;\r\n        });\r\n\r\n        const credentialWithLabel = { ...mockCredential, label: 'Test Label' };\r\n        component.deleteCredential(credentialWithLabel);\r\n\r\n        expect(mockTranslationService.translate).toHaveBeenCalledWith(\r\n          'modal.deleteCredentialMessage',\r\n          jasmine.objectContaining({\r\n            exchangeName: jasmine.any(String),\r\n            label: jasmine.any(String)\r\n          })\r\n        );\r\n      });\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\profile\\profile.component.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":350,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":350,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11860,11863],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11860,11863],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":409,"column":58,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":409,"endColumn":65},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":429,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":429,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14398,14401],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14398,14401],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .label on an `any` value.","line":433,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":433,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .apiKey on an `any` value.","line":438,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":438,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .apiSecret on an `any` value.","line":443,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":443,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .authToken on an `any` value.","line":448,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":448,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'updated' is defined but never used.","line":455,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":455,"endColumn":21},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":476,"column":62,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":476,"endColumn":69},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":484,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":484,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16431,16434],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16431,16434],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":487,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":487,"endColumn":21},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":532,"column":66,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":532,"endColumn":73},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'updated' is defined but never used.","line":547,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":547,"endColumn":21},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":555,"column":62,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":555,"endColumn":69},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":608,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":608,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exchange on an `any` value.","line":608,"column":46,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":608,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":609,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":609,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .apiKey on an `any` value.","line":609,"column":44,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":609,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":610,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":610,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .apiSecret on an `any` value.","line":610,"column":47,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":610,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":611,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":611,"endColumn":69},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .authToken on an `any` value.","line":611,"column":47,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":611,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":627,"column":57,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":627,"endColumn":64},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":645,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":645,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exchange on an `any` value.","line":645,"column":46,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":645,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":646,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":646,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .apiKey on an `any` value.","line":646,"column":44,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":646,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":647,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":647,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .apiSecret on an `any` value.","line":647,"column":47,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":647,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":648,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":648,"endColumn":69},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .authToken on an `any` value.","line":648,"column":47,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":648,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":649,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":649,"endColumn":61},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .label on an `any` value.","line":649,"column":43,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":649,"endColumn":48},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'newCred' is defined but never used.","line":654,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":654,"endColumn":21},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":666,"column":60,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":666,"endColumn":67},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":720,"column":13,"nodeType":"Property","messageId":"anyAssignment","endLine":720,"endColumn":75},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":720,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":720,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24310,24313],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24310,24313],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .apiKey on an `any` value.","line":720,"column":41,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":720,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":721,"column":13,"nodeType":"Property","messageId":"anyAssignment","endLine":721,"endColumn":90},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":721,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":721,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24390,24393],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24390,24393],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .apiSecret on an `any` value.","line":721,"column":44,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":721,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":727,"column":72,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":727,"endColumn":79}],"suppressedMessages":[],"errorCount":42,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, computed, OnInit, signal } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormBuilder, FormGroup, FormsModule, ReactiveFormsModule, Validators } from '@angular/forms';\r\nimport { Router, RouterLink } from '@angular/router';\r\nimport { AuthService } from '../../services/auth.service';\r\nimport { Language, TranslationService } from '../../services/translation.service';\r\nimport { ThemeService } from '../../services/theme.service';\r\nimport { UserService } from '../../services/user.service';\r\nimport { GoogleAuthService } from '../../services/google-auth.service';\r\nimport { ExchangeCredentialsService } from '../../services/exchange-credentials.service';\r\nimport {\r\n  CreateExchangeCredentialRequest,\r\n  EXCHANGE_METADATA,\r\n  ExchangeCredential,\r\n  ExchangeType,\r\n  getExchangeName,\r\n  TestConnectionRequest\r\n} from '../../models/exchange-credentials.model';\r\nimport { take } from 'rxjs/operators';\r\nimport { TradingPlatformInfoModalComponent } from '../trading-platform-info-modal/trading-platform-info-modal.component';\r\nimport { ConfirmationModalComponent } from '../ui/confirmation-modal/confirmation-modal.component';\r\nimport { ButtonComponent } from '../ui/button/button.component';\r\n\r\ninterface Tab {\r\n  id: string;\r\n  label: string;\r\n  icon: string;\r\n}\r\n\r\ninterface MessageLocal {\r\n  id: string;\r\n  type: 'info' | 'warning' | 'success' | 'error' | 'trade';\r\n  title: string;\r\n  content: string;\r\n  timestamp: Date;\r\n  read: boolean;\r\n  actions?: MessageActionLocal[];\r\n}\r\n\r\ninterface MessageActionLocal {\r\n  label: string;\r\n  type: 'primary' | 'secondary' | 'danger';\r\n  action: string;\r\n}\r\n\r\n@Component({\r\n  selector: 'app-profile',\r\n  standalone: true,\r\n  imports: [CommonModule, ReactiveFormsModule, FormsModule, RouterLink, TradingPlatformInfoModalComponent, ConfirmationModalComponent, ButtonComponent],\r\n  templateUrl: './profile.component.html',\r\n  styleUrl: './profile.component.scss'\r\n})\r\nexport class ProfileComponent implements OnInit {\r\n  // Signals and computed values\r\n  readonly currentUser = computed(() => this.authService.currentUser());\r\n  readonly isDark = computed(() => this.themeService.currentTheme() === 'dark');\r\n  readonly availableLanguages = this.translationService.availableLanguages;\r\n  readonly isAdmin = computed(() => this.authService.hasRole('ADMIN'));\r\n\r\n  // Component state\r\n  activeTab = signal<string>('settings');\r\n\r\n  // Tab configuration\r\n  tabs: Tab[] = [\r\n    { id: 'settings', label: 'profile.preferences', icon: '‚öôÔ∏è' },\r\n    { id: 'userinfo', label: 'profile.personalInfo', icon: 'üë§' },\r\n    { id: 'platforms', label: 'profile.tradingPlatforms', icon: 'üîó' },\r\n    { id: 'messages', label: 'profile.messages', icon: 'üìß' }\r\n  ];\r\n\r\n  // Settings\r\n  selectedLanguage: Language = 'en';\r\n  selectedCurrency = 'USD';\r\n  emailNotifications = true;\r\n  priceAlerts = true;\r\n  tradingAlerts = false;\r\n\r\n  // Forms\r\n  userInfoForm: FormGroup;\r\n  newCredentialForm: FormGroup;\r\n\r\n  // Exchange Credentials State\r\n  credentials = signal<ExchangeCredential[]>([]);\r\n  editingCredentialId = signal<string | null>(null);\r\n  editFormData = signal<Partial<ExchangeCredential> & { apiKey?: string; apiSecret?: string; authToken?: string }>({});\r\n  showAddCredentialModal = signal<boolean>(false);\r\n  testingConnectionId = signal<string | null>(null);\r\n  deletingCredentialId = signal<string | null>(null);\r\n  savingCredentialId = signal<string | null>(null);\r\n  showApiSecret = signal<Record<string, boolean>>({});\r\n  revealedCredentials = signal<Record<string, { apiKey?: string; apiSecret?: string }>>({});\r\n\r\n  // Toast notification state\r\n  toastMessage = signal<string>('');\r\n  toastType = signal<'success' | 'error' | 'warning' | 'info'>('info');\r\n  showToastSignal = signal<boolean>(false);\r\n\r\n  // Trading Platform Info Modal state\r\n  showPlatformInfoModal = signal<boolean>(false);\r\n  selectedCredentialForModal = signal<ExchangeCredential | null>(null);\r\n\r\n  // Confirmation Modal state\r\n  showConfirmModal = signal<boolean>(false);\r\n  confirmModalTitle = signal<string>('');\r\n  confirmModalMessage = signal<string>('');\r\n  confirmModalConfirmText = signal<string>('');\r\n  confirmModalCancelText = signal<string>('');\r\n  confirmModalVariant = signal<'primary' | 'danger' | 'warning'>('primary');\r\n  confirmModalCallback = signal<(() => void) | null>(null);\r\n\r\n  // Enum references for template\r\n  readonly ExchangeType = ExchangeType;\r\n  readonly EXCHANGE_METADATA = EXCHANGE_METADATA;\r\n  readonly getExchangeName = getExchangeName;\r\n  readonly exchanges = Object.values(ExchangeType);\r\n\r\n  // Data\r\n  messages: MessageLocal[] = [\r\n    {\r\n      id: '1',\r\n      type: 'trade',\r\n      title: 'Order Filled',\r\n      content: 'Your limit order for 0.5 BTC at $45,000 has been successfully filled.',\r\n      timestamp: new Date('2024-12-12T10:30:00'),\r\n      read: false,\r\n      actions: [\r\n        { label: 'View Order', type: 'primary', action: 'viewOrder' },\r\n        { label: 'Trade More', type: 'secondary', action: 'openTrading' }\r\n      ]\r\n    },\r\n    {\r\n      id: '2',\r\n      type: 'warning',\r\n      title: 'API Key Expiring Soon',\r\n      content: 'Your Binance API key will expire in 7 days. Please renew it to continue trading.',\r\n      timestamp: new Date('2024-12-11T14:15:00'),\r\n      read: false,\r\n      actions: [\r\n        { label: 'Renew Key', type: 'primary', action: 'renewApiKey' }\r\n      ]\r\n    },\r\n    {\r\n      id: '3',\r\n      type: 'success',\r\n      title: 'Security Update',\r\n      content: 'Your account security settings have been successfully updated.',\r\n      timestamp: new Date('2024-12-10T09:00:00'),\r\n      read: true\r\n    },\r\n    {\r\n      id: '4',\r\n      type: 'info',\r\n      title: 'New Feature Available',\r\n      content: 'Check out our new advanced charting tools in the trading dashboard.',\r\n      timestamp: new Date('2024-12-09T16:45:00'),\r\n      read: true,\r\n      actions: [\r\n        { label: 'Learn More', type: 'secondary', action: 'learnMore' }\r\n      ]\r\n    }\r\n  ];\r\n\r\n  constructor(\r\n    private fb: FormBuilder,\r\n    private authService: AuthService,\r\n    private translationService: TranslationService,\r\n    private themeService: ThemeService,\r\n    private userService: UserService,\r\n    private googleAuthService: GoogleAuthService,\r\n    public exchangeCredentialsService: ExchangeCredentialsService,\r\n    private router: Router\r\n  ) {\r\n    this.userInfoForm = this.fb.group({\r\n      firstName: ['John'],\r\n      lastName: ['Doe'],\r\n      email: [{ value: this.currentUser()?.email || '', disabled: true }],\r\n      phone: ['+1234567890'],\r\n      timezone: ['UTC']\r\n    });\r\n\r\n    this.newCredentialForm = this.fb.group({\r\n      exchange: ['', Validators.required],\r\n      apiKey: ['', Validators.required],\r\n      apiSecret: ['', Validators.required],\r\n      authToken: [''], // Browser session token for MEXC\r\n      label: ['', [Validators.maxLength(50)]]\r\n    });\r\n\r\n    this.selectedLanguage = this.translationService.currentLanguage();\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    // Initialize component\r\n  }\r\n\r\n  // Tab navigation\r\n  setActiveTab(tabId: string): void {\r\n    this.activeTab.set(tabId);\r\n\r\n    // Load credentials when switching to platforms tab\r\n    if (tabId === 'platforms') {\r\n      this.onPlatformsTabActivated();\r\n    }\r\n  }\r\n\r\n  // Translation helper\r\n  translate(key: string, params?: Record<string, string>): string {\r\n    return this.translationService.translate(key, params);\r\n  }\r\n\r\n  // Settings operations\r\n  changeLanguage(event: Event): void {\r\n    const target = event.target as HTMLSelectElement;\r\n    const newLanguage = target.value as Language;\r\n    this.translationService.setLanguage(newLanguage);\r\n    this.selectedLanguage = newLanguage;\r\n  }\r\n\r\n  toggleTheme(): void {\r\n    this.themeService.toggleTheme();\r\n  }\r\n\r\n  changeCurrency(event: Event): void {\r\n    const target = event.target as HTMLSelectElement;\r\n    this.selectedCurrency = target.value;\r\n    // Save currency preference\r\n    localStorage.setItem('preferred-currency', this.selectedCurrency);\r\n  }\r\n\r\n  updateNotificationSettings(): void {\r\n    // Save notification settings\r\n    const settings = {\r\n      email: this.emailNotifications,\r\n      priceAlerts: this.priceAlerts,\r\n      tradingAlerts: this.tradingAlerts\r\n    };\r\n    localStorage.setItem('notification-settings', JSON.stringify(settings));\r\n  }\r\n\r\n  // User info operations\r\n  updateUserInfo(): void {\r\n    if (this.userInfoForm.valid) {\r\n      console.log('Updating user info:', this.userInfoForm.value);\r\n      // Simulate API call\r\n      this.showToast('User information updated successfully!', 'success');\r\n      this.userInfoForm.markAsPristine();\r\n    }\r\n  }\r\n\r\n  resetUserInfo(): void {\r\n    this.userInfoForm.reset();\r\n  }\r\n\r\n  changeAvatar(): void {\r\n    // Open file picker or avatar selection modal\r\n    console.log('Change avatar clicked');\r\n    this.showToast('Avatar change functionality would be implemented here', 'info');\r\n  }\r\n\r\n  linkGoogleAccount(): void {\r\n    this.googleAuthService.linkGoogleAccount().subscribe({\r\n      next: (response) => {\r\n        if (response.success) {\r\n          this.showToast(`Google account linked successfully! ${response.message}`, 'success');\r\n          // Refresh user data or update UI as needed\r\n        } else {\r\n          this.showToast(`Failed to link Google account: ${response.message}`, 'error');\r\n        }\r\n      },\r\n      error: (error) => {\r\n        console.error('Error linking Google account:', error);\r\n        this.showToast('Failed to link Google account. Please try again.', 'error');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Messages operations\r\n  markAsRead(messageId: string): void {\r\n    const message = this.messages.find(m => m.id === messageId);\r\n    if (message) {\r\n      message.read = true;\r\n    }\r\n  }\r\n\r\n  markAllAsRead(): void {\r\n    this.messages.forEach(message => message.read = true);\r\n  }\r\n\r\n  executeMessageAction(action: MessageActionLocal): void {\r\n    console.log('Executing action:', action);\r\n    switch (action.action) {\r\n      case 'viewOrder':\r\n        this.showToast('Would navigate to order details', 'info');\r\n        break;\r\n      case 'openTrading':\r\n        this.showToast('Would open trading interface', 'info');\r\n        break;\r\n      case 'renewApiKey':\r\n        this.showToast('Would open API key renewal process', 'info');\r\n        break;\r\n      case 'learnMore':\r\n        this.showToast('Would show feature information', 'info');\r\n        break;\r\n    }\r\n  }\r\n\r\n  // Logout functionality\r\n  logout(): void {\r\n    this.authService.logout().pipe(take(1)).subscribe({\r\n      next: () => {\r\n        this.router.navigate(['/login']);\r\n      },\r\n      error: () => {\r\n        this.router.navigate(['/login']);\r\n      }\r\n    });\r\n  }\r\n\r\n  // ============================================================================\r\n  // EXCHANGE CREDENTIALS METHODS\r\n  // ============================================================================\r\n\r\n  /**\r\n   * Load credentials when tab opens\r\n   */\r\n  loadCredentials(): void {\r\n    this.exchangeCredentialsService.fetchCredentials().subscribe({\r\n      next: (creds) => {\r\n        this.credentials.set(creds);\r\n      },\r\n      error: (err) => {\r\n        console.error('Failed to load credentials:', err);\r\n        this.showToast('Failed to load exchange credentials. Please try again.', 'error');\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Start editing a credential row\r\n   */\r\n  startEditCredential(credential: ExchangeCredential): void {\r\n    this.editingCredentialId.set(credential.id);\r\n    this.editFormData.set({\r\n      label: credential.label,\r\n      apiKey: '',  // Empty string means \"keep current\"\r\n      apiSecret: '',  // Empty string means \"keep current\"\r\n      authToken: '',  // Empty string means \"keep current\"\r\n      // Store original values for canceling\r\n      _originalLabel: credential.label\r\n    } as any);\r\n  }\r\n\r\n  /**\r\n   * Test connection with edited values\r\n   */\r\n  testEditConnection(credential: ExchangeCredential): void {\r\n    const editData = this.editFormData();\r\n\r\n    // Get the revealed credentials\r\n    const revealed = this.revealedCredentials()[credential.id];\r\n\r\n    // Determine which API key and secret to use\r\n    let apiKey: string;\r\n    let apiSecret: string;\r\n\r\n    // If user entered new values, use those\r\n    if (editData.apiKey && editData.apiKey.trim() !== '') {\r\n      apiKey = editData.apiKey.trim();\r\n    } else if (revealed?.apiKey) {\r\n      // Use revealed stored value\r\n      apiKey = revealed.apiKey;\r\n    } else {\r\n      // Need to fetch the credential first\r\n      console.log('No API key available, need to reveal first');\r\n      this.showToast('Please click the eye icon to reveal the API Key first', 'warning');\r\n      return;\r\n    }\r\n\r\n    if (editData.apiSecret && editData.apiSecret.trim() !== '') {\r\n      apiSecret = editData.apiSecret.trim();\r\n    } else if (revealed?.apiSecret) {\r\n      apiSecret = revealed.apiSecret;\r\n    } else {\r\n      console.log('No API secret available, need to reveal first');\r\n      this.showToast('Please click the eye icon to reveal the API Secret first', 'warning');\r\n      return;\r\n    }\r\n\r\n    const testData: TestConnectionRequest = {\r\n      exchange: credential.exchange,\r\n      apiKey: apiKey,\r\n      apiSecret: apiSecret,\r\n      authToken: editData.authToken && editData.authToken.trim() !== '' ? editData.authToken.trim() : undefined\r\n    };\r\n\r\n    this.testingConnectionId.set(credential.id);\r\n\r\n    this.exchangeCredentialsService.testConnection(testData).subscribe({\r\n      next: (result) => {\r\n        this.testingConnectionId.set(null);\r\n        if (result.success) {\r\n          this.showToast('Connection successful! You can now save the credentials.', 'success');\r\n        } else {\r\n          this.showToast('Connection failed: ' + (result.message || 'Unknown error'), 'error');\r\n        }\r\n      },\r\n      error: (err) => {\r\n        this.testingConnectionId.set(null);\r\n        this.showToast('Connection test failed: ' + (err.message || 'Unknown error'), 'error');\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Cancel editing\r\n   */\r\n  cancelEdit(): void {\r\n    this.editingCredentialId.set(null);\r\n    this.editFormData.set({});\r\n  }\r\n\r\n  /**\r\n   * Save edited credential\r\n   */\r\n  saveCredential(credentialId: string): void {\r\n    const editData = this.editFormData();\r\n\r\n    // Build update request with only changed fields\r\n    const updateRequest: any = {};\r\n\r\n    // Always include label (even if empty)\r\n    if (editData.label !== undefined) {\r\n      updateRequest.label = editData.label || undefined;\r\n    }\r\n\r\n    // Include apiKey only if it was changed (non-empty)\r\n    if (editData.apiKey && editData.apiKey.trim() !== '') {\r\n      updateRequest.apiKey = editData.apiKey.trim();\r\n    }\r\n\r\n    // Include apiSecret only if it was changed (non-empty)\r\n    if (editData.apiSecret && editData.apiSecret.trim() !== '') {\r\n      updateRequest.apiSecret = editData.apiSecret.trim();\r\n    }\r\n\r\n    // Include authToken only if it was changed (non-empty)\r\n    if (editData.authToken && editData.authToken.trim() !== '') {\r\n      updateRequest.authToken = editData.authToken.trim();\r\n    }\r\n\r\n    // Set saving state\r\n    this.savingCredentialId.set(credentialId);\r\n\r\n    this.exchangeCredentialsService.updateCredential(credentialId, updateRequest).pipe(take(1)).subscribe({\r\n      next: (updated) => {\r\n        // Clear editing and saving state first\r\n        this.editingCredentialId.set(null);\r\n        this.editFormData.set({});\r\n        this.savingCredentialId.set(null);\r\n\r\n        // Clear visibility toggles for this credential\r\n        const currentVisibility = this.showApiSecret();\r\n        const updatedVisibility = { ...currentVisibility };\r\n        delete updatedVisibility[credentialId + '_key'];\r\n        delete updatedVisibility[credentialId + '_secret'];\r\n        this.showApiSecret.set(updatedVisibility);\r\n\r\n        // Service already updated the state - sync local component state\r\n        this.credentials.set(this.exchangeCredentialsService.credentials());\r\n\r\n        this.showToast('Credential updated successfully!', 'success');\r\n      },\r\n      error: (err) => {\r\n        console.error('Failed to update credential:', err);\r\n        this.savingCredentialId.set(null);\r\n        this.showToast('Failed to update credential: ' + err.message, 'error');\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Update edit form data\r\n   */\r\n  updateEditField(field: string, value: any): void {\r\n    this.editFormData.set({\r\n      ...this.editFormData(),\r\n      [field]: value\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Test connection for a credential\r\n   */\r\n  testConnection(credential: ExchangeCredential): void {\r\n    this.testingConnectionId.set(credential.id);\r\n\r\n    // Note: We can't test existing credentials without the secret\r\n    // We need to show a message about this\r\n    this.showToast('Connection testing requires API secret. Please use the \"Add New Credential\" form to test connections before saving.', 'info');\r\n    this.testingConnectionId.set(null);\r\n  }\r\n\r\n  /**\r\n   * Delete a credential\r\n   */\r\n  deleteCredential(credential: ExchangeCredential): void {\r\n    const exchangeName = this.getExchangeName(credential.exchange);\r\n    const labelPart = credential.label ? ` \"${credential.label}\"` : '';\r\n\r\n    this.showConfirmation({\r\n      title: this.translate('modal.deleteCredentialTitle'),\r\n      message: this.translate('modal.deleteCredentialMessage', {\r\n        exchangeName: exchangeName,\r\n        label: labelPart\r\n      }),\r\n      confirmText: this.translate('button.delete'),\r\n      variant: 'danger',\r\n      onConfirm: () => {\r\n        this.deletingCredentialId.set(credential.id);\r\n\r\n        this.exchangeCredentialsService.deleteCredential(credential.id).subscribe({\r\n          next: () => {\r\n            // Service already updated the state - sync local component state\r\n            this.credentials.set(this.exchangeCredentialsService.credentials());\r\n            this.deletingCredentialId.set(null);\r\n\r\n            this.showToast('Credential deleted successfully!', 'success');\r\n          },\r\n          error: (err) => {\r\n            console.error('Failed to delete credential:', err);\r\n            this.deletingCredentialId.set(null);\r\n            this.showToast('Failed to delete credential: ' + err.message, 'error');\r\n          }\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Toggle active status\r\n   */\r\n  toggleActive(credential: ExchangeCredential, e: Event): void {\r\n    const isChecked = (e.target as HTMLInputElement).checked;\r\n\r\n    this.exchangeCredentialsService.updateCredential(credential.id, { isActive: isChecked })\r\n      .pipe(take(1)).subscribe({\r\n      next: (updated) => {\r\n        // Service already updated the state - sync local component state\r\n        this.credentials.set(this.exchangeCredentialsService.credentials());\r\n\r\n        this.showToast(`Credential ${isChecked ? 'activated' : 'deactivated'} successfully!`, 'success');\r\n      },\r\n      error: (err) => {\r\n        console.error('Failed to toggle credential:', err);\r\n        this.showToast('Failed to toggle credential: ' + err.message, 'error');\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Open add credential modal\r\n   */\r\n  openAddCredentialModal(): void {\r\n    this.newCredentialForm.reset({\r\n      exchange: '',\r\n      apiKey: '',\r\n      apiSecret: '',\r\n      authToken: '',\r\n      label: ''\r\n    });\r\n    this.showAddCredentialModal.set(true);\r\n  }\r\n\r\n  /**\r\n   * Close add credential modal\r\n   */\r\n  closeAddCredentialModal(): void {\r\n    if (this.newCredentialForm.dirty) {\r\n      this.showConfirmation({\r\n        title: this.translate('modal.unsavedChangesTitle'),\r\n        message: this.translate('modal.unsavedChangesMessage'),\r\n        confirmText: this.translate('modal.confirm'),\r\n        variant: 'warning',\r\n        onConfirm: () => {\r\n          this.showAddCredentialModal.set(false);\r\n          this.newCredentialForm.reset();\r\n        }\r\n      });\r\n    } else {\r\n      this.showAddCredentialModal.set(false);\r\n      this.newCredentialForm.reset();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Test connection in the add form\r\n   */\r\n  testNewConnection(): void {\r\n    if (this.newCredentialForm.invalid) {\r\n      Object.keys(this.newCredentialForm.controls).forEach(key => {\r\n        this.newCredentialForm.get(key)?.markAsTouched();\r\n      });\r\n      this.showToast('Please fill in all required fields before testing connection.', 'warning');\r\n      return;\r\n    }\r\n\r\n    const testData: TestConnectionRequest = {\r\n      exchange: this.newCredentialForm.value.exchange,\r\n      apiKey: this.newCredentialForm.value.apiKey,\r\n      apiSecret: this.newCredentialForm.value.apiSecret,\r\n      authToken: this.newCredentialForm.value.authToken || undefined\r\n    };\r\n\r\n    this.testingConnectionId.set('new');\r\n\r\n    this.exchangeCredentialsService.testConnection(testData).subscribe({\r\n      next: (result) => {\r\n        this.testingConnectionId.set(null);\r\n        if (result.success) {\r\n          this.showToast('Connection successful! You can now save the credentials.', 'success');\r\n        } else {\r\n          this.showToast('Connection failed: ' + result.message, 'error');\r\n        }\r\n      },\r\n      error: (err) => {\r\n        this.testingConnectionId.set(null);\r\n        this.showToast('Connection test failed: ' + err.message, 'error');\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Save new credential\r\n   */\r\n  saveNewCredential(): void {\r\n    if (this.newCredentialForm.invalid) {\r\n      Object.keys(this.newCredentialForm.controls).forEach(key => {\r\n        this.newCredentialForm.get(key)?.markAsTouched();\r\n      });\r\n      this.showToast('Please fill in all required fields.', 'warning');\r\n      return;\r\n    }\r\n\r\n    const data: CreateExchangeCredentialRequest = {\r\n      exchange: this.newCredentialForm.value.exchange,\r\n      apiKey: this.newCredentialForm.value.apiKey,\r\n      apiSecret: this.newCredentialForm.value.apiSecret,\r\n      authToken: this.newCredentialForm.value.authToken || undefined,\r\n      label: this.newCredentialForm.value.label || undefined,\r\n      isActive: true // Set new credentials as active by default\r\n    };\r\n\r\n    this.exchangeCredentialsService.createCredential(data).subscribe({\r\n      next: (newCred) => {\r\n        // Service already updated the state - sync local component state\r\n        this.credentials.set(this.exchangeCredentialsService.credentials());\r\n\r\n        // Close modal\r\n        this.showAddCredentialModal.set(false);\r\n        this.newCredentialForm.reset();\r\n\r\n        this.showToast('Credential saved successfully!', 'success');\r\n      },\r\n      error: (err) => {\r\n        console.error('Failed to create credential:', err);\r\n        this.showToast('Failed to save credential: ' + err.message, 'error');\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Toggle API key visibility (in edit mode)\r\n   */\r\n  toggleApiKeyVisibility(credentialId: string): void {\r\n    const key = credentialId + '_key';\r\n    const current = this.showApiSecret();\r\n    const newVisibility = !current[key];\r\n\r\n    this.showApiSecret.set({\r\n      ...current,\r\n      [key]: newVisibility\r\n    });\r\n\r\n    // If revealing and we don't have the decrypted value yet, fetch it\r\n    if (newVisibility && !this.revealedCredentials()[credentialId]?.apiKey) {\r\n      this.fetchDecryptedCredential(credentialId);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Toggle API secret visibility (in edit mode)\r\n   */\r\n  toggleApiSecretVisibility(credentialId: string): void {\r\n    const key = credentialId + '_secret';\r\n    const current = this.showApiSecret();\r\n    const newVisibility = !current[key];\r\n\r\n    this.showApiSecret.set({\r\n      ...current,\r\n      [key]: newVisibility\r\n    });\r\n\r\n    // If revealing and we don't have the decrypted value yet, fetch it\r\n    if (newVisibility && !this.revealedCredentials()[credentialId]?.apiSecret) {\r\n      this.fetchDecryptedCredential(credentialId);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Fetch decrypted credential from backend\r\n   */\r\n  fetchDecryptedCredential(credentialId: string): void {\r\n    this.exchangeCredentialsService.getCredentialById(credentialId).subscribe({\r\n      next: (credential) => {\r\n        // Store the revealed credentials\r\n        const current = this.revealedCredentials();\r\n        this.revealedCredentials.set({\r\n          ...current,\r\n          [credentialId]: {\r\n            apiKey: (credential as any).apiKey || credential.apiKeyPreview,\r\n            apiSecret: (credential as any).apiSecret || '(Secret not returned by server)'\r\n          }\r\n        });\r\n      },\r\n      error: (err) => {\r\n        console.error('Failed to fetch decrypted credential:', err);\r\n        this.showToast('Failed to retrieve credential details: ' + err.message, 'error');\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Legacy method for modal form - toggle API secret visibility\r\n   */\r\n  toggleApiSecretVisibilityLegacy(credentialId: string): void {\r\n    const current = this.showApiSecret();\r\n    this.showApiSecret.set({\r\n      ...current,\r\n      [credentialId]: !current[credentialId]\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Toggle new form API secret visibility\r\n   */\r\n  toggleNewFormApiSecretVisibility(): void {\r\n    this.toggleApiSecretVisibility('new');\r\n  }\r\n\r\n  /**\r\n   * Get masked display for API key/secret\r\n   */\r\n  getMaskedValue(value: string): string {\r\n    if (!value || value.length <= 4) {\r\n      return '****';\r\n    }\r\n    return '...' + value.slice(-4);\r\n  }\r\n\r\n  /**\r\n   * Called when platforms tab is activated\r\n   */\r\n  onPlatformsTabActivated(): void {\r\n    this.loadCredentials();\r\n  }\r\n\r\n  /**\r\n   * Show toast notification\r\n   */\r\n  showToast(message: string, type: 'success' | 'error' | 'warning' | 'info' = 'info'): void {\r\n    this.toastMessage.set(message);\r\n    this.toastType.set(type);\r\n    this.showToastSignal.set(true);\r\n\r\n    // Auto-hide after 5 seconds\r\n    setTimeout(() => {\r\n      this.showToastSignal.set(false);\r\n    }, 5000);\r\n  }\r\n\r\n  /**\r\n   * Open trading platform info modal\r\n   * Shows detailed information about the selected exchange credential\r\n   */\r\n  openPlatformInfoModal(credential: ExchangeCredential): void {\r\n    this.selectedCredentialForModal.set(credential);\r\n    this.showPlatformInfoModal.set(true);\r\n  }\r\n\r\n  /**\r\n   * Close trading platform info modal\r\n   */\r\n  closePlatformInfoModal(): void {\r\n    this.showPlatformInfoModal.set(false);\r\n    this.selectedCredentialForModal.set(null);\r\n  }\r\n\r\n  /**\r\n   * Show confirmation modal\r\n   */\r\n  showConfirmation(config: {\r\n    title?: string;\r\n    message: string;\r\n    confirmText?: string;\r\n    cancelText?: string;\r\n    variant?: 'primary' | 'danger' | 'warning';\r\n    onConfirm: () => void;\r\n  }): void {\r\n    this.confirmModalTitle.set(config.title || this.translate('modal.confirmTitle'));\r\n    this.confirmModalMessage.set(config.message);\r\n    this.confirmModalConfirmText.set(config.confirmText || this.translate('modal.confirm'));\r\n    this.confirmModalCancelText.set(config.cancelText || this.translate('modal.cancel'));\r\n    this.confirmModalVariant.set(config.variant || 'primary');\r\n    this.confirmModalCallback.set(config.onConfirm);\r\n    this.showConfirmModal.set(true);\r\n  }\r\n\r\n  /**\r\n   * Handle confirmation modal confirm action\r\n   */\r\n  onConfirmModalConfirm(): void {\r\n    const callback = this.confirmModalCallback();\r\n    this.closeConfirmModal();\r\n    // Execute callback in next tick to ensure modal closes first\r\n    setTimeout(() => {\r\n      if (callback) {\r\n        callback();\r\n      }\r\n    }, 0);\r\n  }\r\n\r\n  /**\r\n   * Handle confirmation modal cancel action\r\n   */\r\n  onConfirmModalCancel(): void {\r\n    this.closeConfirmModal();\r\n  }\r\n\r\n  /**\r\n   * Close confirmation modal\r\n   */\r\n  closeConfirmModal(): void {\r\n    this.showConfirmModal.set(false);\r\n    this.confirmModalCallback.set(null);\r\n  }\r\n\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\testing\\api-tester\\api-tester.component.html","messages":[{"ruleId":"@angular-eslint/template/click-events-have-key-events","severity":2,"message":"click must be accompanied by either keyup, keydown or keypress event for accessibility.","line":297,"column":13,"nodeType":null,"messageId":"clickEventsHaveKeyEvents","endLine":311,"endColumn":19},{"ruleId":"@angular-eslint/template/interactive-supports-focus","severity":2,"message":"Elements with interaction handlers must be focusable.","line":297,"column":13,"nodeType":null,"messageId":"interactiveSupportsFocus","endLine":311,"endColumn":19}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<div class=\"api-tester-container\">\r\n  <!-- Header -->\r\n  <div class=\"api-tester-header\">\r\n    <div class=\"header-content\">\r\n      <h1 class=\"page-title\">Exchange Order API Tester</h1>\r\n      <p class=\"page-description\">Test exchange order placement with detailed request/response inspection</p>\r\n    </div>\r\n    <div class=\"header-actions\">\r\n      <button\r\n        type=\"button\"\r\n        class=\"btn-secondary btn-sm\"\r\n        (click)=\"clearAllLogs()\"\r\n        [disabled]=\"logs().length === 0\"\r\n      >\r\n        Clear History\r\n      </button>\r\n    </div>\r\n  </div>\r\n\r\n  <!-- Configuration Panel -->\r\n  <div class=\"config-panel\">\r\n    <h2 class=\"section-title\">Configuration</h2>\r\n\r\n    <div class=\"config-grid\">\r\n      <!-- Exchange Selection -->\r\n      <div class=\"form-group\">\r\n        <label for=\"exchange\" class=\"form-label\">\r\n          Exchange\r\n          <span class=\"required\">*</span>\r\n        </label>\r\n        <select\r\n          id=\"exchange\"\r\n          class=\"form-control\"\r\n          [value]=\"selectedExchange()\"\r\n          (change)=\"onExchangeChange($any($event.target).value)\"\r\n        >\r\n          <option [value]=\"null\">Select Exchange...</option>\r\n          @for (option of exchangeOptions; track option.value) {\r\n            <option [value]=\"option.value\">{{ option.label }}</option>\r\n          }\r\n        </select>\r\n      </div>\r\n\r\n      <!-- Credential Selection -->\r\n      <div class=\"form-group\">\r\n        <label for=\"credential\" class=\"form-label\">\r\n          API Credential\r\n          <span class=\"required\">*</span>\r\n        </label>\r\n        <select\r\n          id=\"credential\"\r\n          class=\"form-control\"\r\n          [disabled]=\"!selectedExchange() || availableCredentials().length === 0\"\r\n          [value]=\"selectedCredential()?.id\"\r\n          (change)=\"onCredentialChange($any($event.target).value)\"\r\n        >\r\n          <option [value]=\"null\">Select Credential...</option>\r\n          @for (cred of availableCredentials(); track cred.id) {\r\n            <option [value]=\"cred.id\">\r\n              {{ cred.label || cred.apiKeyPreview }}\r\n            </option>\r\n          }\r\n        </select>\r\n        @if (selectedExchange() && availableCredentials().length === 0) {\r\n          <p class=\"help-text error\">No credentials configured for this exchange</p>\r\n        }\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <!-- Order Parameters Form -->\r\n  <form [formGroup]=\"orderForm\" class=\"parameters-panel\">\r\n    <h2 class=\"section-title\">Order Parameters</h2>\r\n\r\n    <div class=\"parameters-grid\">\r\n      <!-- Symbol -->\r\n      <div class=\"form-group\">\r\n        <label for=\"symbol\" class=\"form-label\">\r\n          Symbol\r\n          <span class=\"required\">*</span>\r\n        </label>\r\n        <input\r\n          id=\"symbol\"\r\n          type=\"text\"\r\n          formControlName=\"symbol\"\r\n          class=\"form-control\"\r\n          placeholder=\"BTC-USDT\"\r\n          [class.error]=\"hasError('symbol')\"\r\n        />\r\n        @if (hasError('symbol')) {\r\n          <p class=\"help-text error\">{{ getErrorMessage('symbol') }}</p>\r\n        }\r\n        <p class=\"help-text\">Format: BASE-QUOTE (e.g., BTC-USDT)</p>\r\n      </div>\r\n\r\n      <!-- Side -->\r\n      <div class=\"form-group\">\r\n        <label for=\"side\" class=\"form-label\">\r\n          Side\r\n          <span class=\"required\">*</span>\r\n        </label>\r\n        <select\r\n          id=\"side\"\r\n          formControlName=\"side\"\r\n          class=\"form-control\"\r\n        >\r\n          @for (option of orderSideOptions; track option.value) {\r\n            <option [value]=\"option.value\">{{ option.label }}</option>\r\n          }\r\n        </select>\r\n      </div>\r\n\r\n      <!-- Position Side -->\r\n      <div class=\"form-group\">\r\n        <label for=\"positionSide\" class=\"form-label\">\r\n          Position Side\r\n          <span class=\"required\">*</span>\r\n        </label>\r\n        <select\r\n          id=\"positionSide\"\r\n          formControlName=\"positionSide\"\r\n          class=\"form-control\"\r\n        >\r\n          @for (option of positionSideOptions; track option.value) {\r\n            <option [value]=\"option.value\">{{ option.label }}</option>\r\n          }\r\n        </select>\r\n      </div>\r\n\r\n      <!-- Order Type -->\r\n      <div class=\"form-group\">\r\n        <label for=\"type\" class=\"form-label\">\r\n          Order Type\r\n          <span class=\"required\">*</span>\r\n        </label>\r\n        <select\r\n          id=\"type\"\r\n          formControlName=\"type\"\r\n          class=\"form-control\"\r\n        >\r\n          @for (option of orderTypeOptions; track option.value) {\r\n            <option [value]=\"option.value\">{{ option.label }}</option>\r\n          }\r\n        </select>\r\n        <p class=\"help-text\">{{ orderForm.value.type === OrderType.MARKET ? 'Execute at current market price' : 'Execute at specified price or better' }}</p>\r\n      </div>\r\n\r\n      <!-- Quantity -->\r\n      <div class=\"form-group\">\r\n        <label for=\"quantity\" class=\"form-label\">\r\n          Quantity\r\n          <span class=\"required\">*</span>\r\n        </label>\r\n        <input\r\n          id=\"quantity\"\r\n          type=\"number\"\r\n          formControlName=\"quantity\"\r\n          class=\"form-control\"\r\n          placeholder=\"0.001\"\r\n          step=\"0.001\"\r\n          min=\"0\"\r\n          [class.error]=\"hasError('quantity')\"\r\n        />\r\n        @if (hasError('quantity')) {\r\n          <p class=\"help-text error\">{{ getErrorMessage('quantity') }}</p>\r\n        }\r\n      </div>\r\n\r\n      <!-- Price (for LIMIT orders) -->\r\n      <div class=\"form-group\">\r\n        <label for=\"price\" class=\"form-label\">\r\n          Price\r\n          @if (orderForm.value.type === OrderType.LIMIT) {\r\n            <span class=\"required\">*</span>\r\n          }\r\n        </label>\r\n        <input\r\n          id=\"price\"\r\n          type=\"number\"\r\n          formControlName=\"price\"\r\n          class=\"form-control\"\r\n          placeholder=\"Enter price\"\r\n          step=\"0.01\"\r\n          min=\"0\"\r\n          [class.error]=\"hasError('price')\"\r\n        />\r\n        @if (hasError('price')) {\r\n          <p class=\"help-text error\">{{ getErrorMessage('price') }}</p>\r\n        }\r\n        @if (orderForm.value.type !== OrderType.LIMIT) {\r\n          <p class=\"help-text\">Price is only required for LIMIT orders</p>\r\n        }\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Submit Button -->\r\n    <div class=\"submit-section\">\r\n      <button\r\n        type=\"button\"\r\n        class=\"btn-primary btn-lg\"\r\n        (click)=\"onSubmitRequest()\"\r\n        [disabled]=\"!canSubmit()\"\r\n      >\r\n        @if (isLoading()) {\r\n          <span class=\"spinner\"></span>\r\n          Sending Request...\r\n        } @else {\r\n          <svg class=\"icon\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n            <path d=\"M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n          </svg>\r\n          Send Request\r\n        }\r\n      </button>\r\n\r\n      @if (error()) {\r\n        <div class=\"error-banner\">\r\n          <svg class=\"icon\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n            <circle cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"2\"/>\r\n            <path d=\"M12 8v4M12 16h.01\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\"/>\r\n          </svg>\r\n          {{ error() }}\r\n        </div>\r\n      }\r\n    </div>\r\n  </form>\r\n\r\n  <!-- Request/Response Display -->\r\n  @if (currentLog()) {\r\n    <div class=\"log-display\">\r\n      <!-- Request Section -->\r\n      <div class=\"log-section request-section\">\r\n        <div class=\"section-header\">\r\n          <h3 class=\"section-title\">Request</h3>\r\n          <button\r\n            type=\"button\"\r\n            class=\"btn-icon\"\r\n            (click)=\"copyRequest()\"\r\n            title=\"Copy to clipboard\"\r\n          >\r\n            <svg class=\"icon\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n              <rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\" ry=\"2\" stroke=\"currentColor\" stroke-width=\"2\"/>\r\n              <path d=\"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\" stroke=\"currentColor\" stroke-width=\"2\"/>\r\n            </svg>\r\n          </button>\r\n        </div>\r\n\r\n        <div class=\"request-info\">\r\n          <span class=\"http-method\">{{ currentLog()!.method }}</span>\r\n          <span class=\"endpoint\">{{ currentLog()!.endpoint }}</span>\r\n        </div>\r\n\r\n        <div class=\"code-block\">\r\n          <pre><code>{{ formatJson(currentLog()!.requestBody) }}</code></pre>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Response Section -->\r\n      <div class=\"log-section response-section\">\r\n        <div class=\"section-header\">\r\n          <h3 class=\"section-title\">Response</h3>\r\n          <div class=\"header-actions\">\r\n            <span class=\"status-badge\" [ngClass]=\"getStatusCodeClass(currentLog()!.statusCode)\">\r\n              {{ currentLog()!.statusCode }} {{ getStatusCodeLabel(currentLog()!.statusCode) }}\r\n            </span>\r\n            @if (currentLog()!.responseTime) {\r\n              <span class=\"response-time\">{{ currentLog()!.responseTime }}ms</span>\r\n            }\r\n            <button\r\n              type=\"button\"\r\n              class=\"btn-icon\"\r\n              (click)=\"copyResponse()\"\r\n              title=\"Copy to clipboard\"\r\n            >\r\n              <svg class=\"icon\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                <rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\" ry=\"2\" stroke=\"currentColor\" stroke-width=\"2\"/>\r\n                <path d=\"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\" stroke=\"currentColor\" stroke-width=\"2\"/>\r\n              </svg>\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"code-block\" [ngClass]=\"{'response-error': !currentLog()!.success}\">\r\n          <pre><code>{{ formatJson(currentLog()!.responseBody) }}</code></pre>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  }\r\n\r\n  <!-- History Section -->\r\n  @if (logs().length > 1) {\r\n    <div class=\"history-section\">\r\n      <h2 class=\"section-title\">Request History</h2>\r\n\r\n      <div class=\"history-list\">\r\n        @for (log of logs(); track log.timestamp) {\r\n          @if (log !== currentLog()) {\r\n            <div class=\"history-item\" (click)=\"currentLog.set(log)\">\r\n              <div class=\"history-item-header\">\r\n                <span class=\"http-method\">{{ log.method }}</span>\r\n                <span class=\"endpoint\">{{ log.endpoint }}</span>\r\n                <span class=\"status-badge\" [ngClass]=\"getStatusCodeClass(log.statusCode)\">\r\n                  {{ log.statusCode }}\r\n                </span>\r\n              </div>\r\n              <div class=\"history-item-meta\">\r\n                <span class=\"timestamp\">{{ log.timestamp | date:'short' }}</span>\r\n                @if (log.responseTime) {\r\n                  <span class=\"response-time\">{{ log.responseTime }}ms</span>\r\n                }\r\n              </div>\r\n            </div>\r\n          }\r\n        }\r\n      </div>\r\n    </div>\r\n  }\r\n</div>\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\testing\\api-tester\\api-tester.component.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'HttpTestingController' is defined but never used.","line":3,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an error typed value.","line":23,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":23,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .TESTNET on an `error` typed value.","line":23,"column":36,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":23,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an error typed value.","line":34,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":34,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .MAINNET on an `error` typed value.","line":34,"column":36,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":34,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":44,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":44,"endColumn":86},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":45,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":47,"endColumn":7},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":52,"column":36,"nodeType":"Property","messageId":"anyAssignment","endLine":52,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":53,"column":48,"nodeType":"Property","messageId":"anyAssignment","endLine":53,"endColumn":72}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { ComponentFixture, TestBed } from '@angular/core/testing';\r\nimport { ReactiveFormsModule } from '@angular/forms';\r\nimport { HttpClientTestingModule, HttpTestingController } from '@angular/common/http/testing';\r\nimport { of, throwError } from 'rxjs';\r\n\r\nimport { ApiTesterComponent, OrderType, OrderSide, PositionSide } from './api-tester.component';\r\nimport { TradingService, ExchangeOrderResponse } from '../../../services/trading.service';\r\nimport { ExchangeCredentialsService } from '../../../services/exchange-credentials.service';\r\nimport { ExchangeType, EnvironmentType, ExchangeCredential } from '../../../models/exchange-credentials.model';\r\nimport { HttpErrorResponse } from '@angular/common/http';\r\n\r\ndescribe('ApiTesterComponent', () => {\r\n  let component: ApiTesterComponent;\r\n  let fixture: ComponentFixture<ApiTesterComponent>;\r\n  let tradingService: jasmine.SpyObj<TradingService>;\r\n  let credentialsService: jasmine.SpyObj<ExchangeCredentialsService>;\r\n\r\n  const mockCredentials: ExchangeCredential[] = [\r\n    {\r\n      id: 'cred-1',\r\n      userId: 'user-1',\r\n      exchange: ExchangeType.BINGX,\r\n      environment: EnvironmentType.TESTNET,\r\n      apiKeyPreview: '****1234',\r\n      label: 'Test BingX',\r\n      isActive: true,\r\n      createdAt: '2024-01-01T00:00:00Z',\r\n      updatedAt: '2024-01-01T00:00:00Z'\r\n    },\r\n    {\r\n      id: 'cred-2',\r\n      userId: 'user-1',\r\n      exchange: ExchangeType.BYBIT,\r\n      environment: EnvironmentType.MAINNET,\r\n      apiKeyPreview: '****5678',\r\n      label: 'Main Bybit',\r\n      isActive: true,\r\n      createdAt: '2024-01-01T00:00:00Z',\r\n      updatedAt: '2024-01-01T00:00:00Z'\r\n    }\r\n  ];\r\n\r\n  beforeEach(async () => {\r\n    const tradingSpy = jasmine.createSpyObj('TradingService', ['placeExchangeOrder']);\r\n    const credentialsSpy = jasmine.createSpyObj('ExchangeCredentialsService', ['fetchCredentials'], {\r\n      credentials: jasmine.createSpy('credentials').and.returnValue(mockCredentials)\r\n    });\r\n\r\n    await TestBed.configureTestingModule({\r\n      imports: [ApiTesterComponent, ReactiveFormsModule, HttpClientTestingModule],\r\n      providers: [\r\n        { provide: TradingService, useValue: tradingSpy },\r\n        { provide: ExchangeCredentialsService, useValue: credentialsSpy }\r\n      ]\r\n    }).compileComponents();\r\n\r\n    tradingService = TestBed.inject(TradingService) as jasmine.SpyObj<TradingService>;\r\n    credentialsService = TestBed.inject(ExchangeCredentialsService) as jasmine.SpyObj<ExchangeCredentialsService>;\r\n\r\n    // Setup default mock for fetchCredentials\r\n    credentialsService.fetchCredentials.and.returnValue(of(mockCredentials));\r\n\r\n    fixture = TestBed.createComponent(ApiTesterComponent);\r\n    component = fixture.componentInstance;\r\n  });\r\n\r\n  // ============================================================================\r\n  // INITIALIZATION TESTS\r\n  // ============================================================================\r\n\r\n  describe('Component Initialization', () => {\r\n    it('should create component', () => {\r\n      expect(component).toBeTruthy();\r\n    });\r\n\r\n    it('should initialize form with default values', () => {\r\n      fixture.detectChanges();\r\n\r\n      expect(component.orderForm.get('symbol')?.value).toBe('BTC-USDT');\r\n      expect(component.orderForm.get('side')?.value).toBe(OrderSide.BUY);\r\n      expect(component.orderForm.get('positionSide')?.value).toBe(PositionSide.LONG);\r\n      expect(component.orderForm.get('type')?.value).toBe(OrderType.MARKET);\r\n      expect(component.orderForm.get('quantity')?.value).toBe(0.001);\r\n    });\r\n\r\n    it('should have price field disabled for MARKET orders by default', () => {\r\n      fixture.detectChanges();\r\n\r\n      const priceControl = component.orderForm.get('price');\r\n      expect(priceControl?.disabled).toBe(true);\r\n    });\r\n\r\n    it('should fetch credentials on initialization', () => {\r\n      fixture.detectChanges();\r\n\r\n      expect(credentialsService.fetchCredentials).toHaveBeenCalled();\r\n    });\r\n\r\n    it('should handle credentials fetch error', () => {\r\n      credentialsService.fetchCredentials.and.returnValue(\r\n        throwError(() => new Error('Network error'))\r\n      );\r\n\r\n      fixture.detectChanges();\r\n\r\n      expect(component.error()).toBe('Failed to load exchange credentials. Please try again.');\r\n    });\r\n  });\r\n\r\n  // ============================================================================\r\n  // FORM VALIDATION TESTS\r\n  // ============================================================================\r\n\r\n  describe('Form Validation', () => {\r\n    beforeEach(() => {\r\n      fixture.detectChanges();\r\n    });\r\n\r\n    it('should validate symbol format', () => {\r\n      const symbolControl = component.orderForm.get('symbol');\r\n\r\n      symbolControl?.setValue('INVALID');\r\n      expect(symbolControl?.valid).toBe(false);\r\n\r\n      symbolControl?.setValue('BTC-USDT');\r\n      expect(symbolControl?.valid).toBe(true);\r\n\r\n      symbolControl?.setValue('ETH-USD');\r\n      expect(symbolControl?.valid).toBe(true);\r\n    });\r\n\r\n    it('should require symbol', () => {\r\n      const symbolControl = component.orderForm.get('symbol');\r\n\r\n      symbolControl?.setValue('');\r\n      expect(symbolControl?.hasError('required')).toBe(true);\r\n    });\r\n\r\n    it('should validate quantity minimum value', () => {\r\n      const quantityControl = component.orderForm.get('quantity');\r\n\r\n      quantityControl?.setValue(0);\r\n      expect(quantityControl?.hasError('min')).toBe(true);\r\n\r\n      quantityControl?.setValue(-1);\r\n      expect(quantityControl?.hasError('min')).toBe(true);\r\n\r\n      quantityControl?.setValue(0.001);\r\n      expect(quantityControl?.valid).toBe(true);\r\n    });\r\n\r\n    it('should require quantity', () => {\r\n      const quantityControl = component.orderForm.get('quantity');\r\n\r\n      quantityControl?.setValue(null);\r\n      expect(quantityControl?.hasError('required')).toBe(true);\r\n    });\r\n\r\n    it('should enable and validate price for LIMIT orders', () => {\r\n      const typeControl = component.orderForm.get('type');\r\n      const priceControl = component.orderForm.get('price');\r\n\r\n      typeControl?.setValue(OrderType.LIMIT);\r\n      fixture.detectChanges();\r\n\r\n      expect(priceControl?.disabled).toBe(false);\r\n      expect(priceControl?.hasError('required')).toBe(true);\r\n\r\n      priceControl?.setValue(50000);\r\n      expect(priceControl?.valid).toBe(true);\r\n    });\r\n\r\n    it('should disable and clear price validators for MARKET orders', () => {\r\n      const typeControl = component.orderForm.get('type');\r\n      const priceControl = component.orderForm.get('price');\r\n\r\n      // First set to LIMIT\r\n      typeControl?.setValue(OrderType.LIMIT);\r\n      priceControl?.setValue(50000);\r\n      fixture.detectChanges();\r\n\r\n      // Then switch back to MARKET\r\n      typeControl?.setValue(OrderType.MARKET);\r\n      fixture.detectChanges();\r\n\r\n      expect(priceControl?.disabled).toBe(true);\r\n      expect(priceControl?.hasError('required')).toBe(false);\r\n    });\r\n  });\r\n\r\n  // ============================================================================\r\n  // EXCHANGE AND CREDENTIAL SELECTION TESTS\r\n  // ============================================================================\r\n\r\n  describe('Exchange and Credential Selection', () => {\r\n    beforeEach(() => {\r\n      fixture.detectChanges();\r\n    });\r\n\r\n    it('should update selected exchange', () => {\r\n      component.onExchangeChange(ExchangeType.BINGX);\r\n\r\n      expect(component.selectedExchange()).toBe(ExchangeType.BINGX);\r\n    });\r\n\r\n    it('should reset credential when exchange changes', () => {\r\n      component.onExchangeChange(ExchangeType.BINGX);\r\n      component.onCredentialChange('cred-1');\r\n\r\n      expect(component.selectedCredential()).toBeTruthy();\r\n\r\n      component.onExchangeChange(ExchangeType.BYBIT);\r\n\r\n      expect(component.selectedCredential()).toBeNull();\r\n    });\r\n\r\n    it('should filter credentials by selected exchange', () => {\r\n      component.onExchangeChange(ExchangeType.BINGX);\r\n\r\n      const availableCreds = component.availableCredentials();\r\n\r\n      expect(availableCreds.length).toBe(1);\r\n      expect(availableCreds[0].exchange).toBe(ExchangeType.BINGX);\r\n    });\r\n\r\n    it('should update selected credential', () => {\r\n      component.onExchangeChange(ExchangeType.BINGX);\r\n      component.onCredentialChange('cred-1');\r\n\r\n      expect(component.selectedCredential()?.id).toBe('cred-1');\r\n    });\r\n  });\r\n\r\n  // ============================================================================\r\n  // SUBMIT TESTS\r\n  // ============================================================================\r\n\r\n  describe('Order Submission', () => {\r\n    beforeEach(() => {\r\n      fixture.detectChanges();\r\n    });\r\n\r\n    it('should not submit when form is invalid', async () => {\r\n      component.orderForm.get('symbol')?.setValue('INVALID');\r\n\r\n      await component.onSubmitRequest();\r\n\r\n      expect(tradingService.placeExchangeOrder).not.toHaveBeenCalled();\r\n    });\r\n\r\n    it('should not submit when exchange is not selected', async () => {\r\n      await component.onSubmitRequest();\r\n\r\n      expect(tradingService.placeExchangeOrder).not.toHaveBeenCalled();\r\n    });\r\n\r\n    it('should not submit when credential is not selected', async () => {\r\n      component.onExchangeChange(ExchangeType.BINGX);\r\n\r\n      await component.onSubmitRequest();\r\n\r\n      expect(tradingService.placeExchangeOrder).not.toHaveBeenCalled();\r\n    });\r\n\r\n    it('should submit valid MARKET order', async () => {\r\n      const mockResponse: ExchangeOrderResponse = {\r\n        success: true,\r\n        orderId: 'order-123',\r\n        status: 'FILLED'\r\n      };\r\n\r\n      tradingService.placeExchangeOrder.and.returnValue(of(mockResponse));\r\n\r\n      component.onExchangeChange(ExchangeType.BINGX);\r\n      component.onCredentialChange('cred-1');\r\n      component.orderForm.patchValue({\r\n        symbol: 'BTC-USDT',\r\n        side: OrderSide.BUY,\r\n        positionSide: PositionSide.LONG,\r\n        type: OrderType.MARKET,\r\n        quantity: 0.01\r\n      });\r\n\r\n      await component.onSubmitRequest();\r\n\r\n      expect(tradingService.placeExchangeOrder).toHaveBeenCalledWith({\r\n        exchange: ExchangeType.BINGX,\r\n        credentialId: 'cred-1',\r\n        symbol: 'BTC-USDT',\r\n        side: OrderSide.BUY,\r\n        positionSide: PositionSide.LONG,\r\n        type: OrderType.MARKET,\r\n        quantity: 0.01,\r\n        price: undefined\r\n      });\r\n    });\r\n\r\n    it('should submit valid LIMIT order with price', async () => {\r\n      const mockResponse: ExchangeOrderResponse = {\r\n        success: true,\r\n        orderId: 'order-456',\r\n        status: 'NEW'\r\n      };\r\n\r\n      tradingService.placeExchangeOrder.and.returnValue(of(mockResponse));\r\n\r\n      component.onExchangeChange(ExchangeType.BYBIT);\r\n      component.onCredentialChange('cred-2');\r\n      component.orderForm.patchValue({\r\n        symbol: 'ETH-USDT',\r\n        side: OrderSide.SELL,\r\n        positionSide: PositionSide.SHORT,\r\n        type: OrderType.LIMIT,\r\n        quantity: 1.5\r\n      });\r\n      component.orderForm.get('price')?.setValue(3000);\r\n\r\n      await component.onSubmitRequest();\r\n\r\n      expect(tradingService.placeExchangeOrder).toHaveBeenCalledWith({\r\n        exchange: ExchangeType.BYBIT,\r\n        credentialId: 'cred-2',\r\n        symbol: 'ETH-USDT',\r\n        side: OrderSide.SELL,\r\n        positionSide: PositionSide.SHORT,\r\n        type: OrderType.LIMIT,\r\n        quantity: 1.5,\r\n        price: 3000\r\n      });\r\n    });\r\n\r\n    it('should set loading state during submission', async () => {\r\n      const mockResponse: ExchangeOrderResponse = { success: true };\r\n      tradingService.placeExchangeOrder.and.returnValue(of(mockResponse));\r\n\r\n      component.onExchangeChange(ExchangeType.BINGX);\r\n      component.onCredentialChange('cred-1');\r\n\r\n      expect(component.isLoading()).toBe(false);\r\n\r\n      const promise = component.onSubmitRequest();\r\n      expect(component.isLoading()).toBe(true);\r\n\r\n      await promise;\r\n      expect(component.isLoading()).toBe(false);\r\n    });\r\n\r\n    it('should create log entry on successful submission', async () => {\r\n      const mockResponse: ExchangeOrderResponse = {\r\n        success: true,\r\n        orderId: 'order-789'\r\n      };\r\n\r\n      tradingService.placeExchangeOrder.and.returnValue(of(mockResponse));\r\n\r\n      component.onExchangeChange(ExchangeType.BINGX);\r\n      component.onCredentialChange('cred-1');\r\n\r\n      await component.onSubmitRequest();\r\n\r\n      const log = component.currentLog();\r\n      expect(log).toBeTruthy();\r\n      expect(log?.success).toBe(true);\r\n      expect(log?.statusCode).toBe(200);\r\n      expect(log?.method).toBe('POST');\r\n      expect(log?.endpoint).toBe('/api/exchange-orders');\r\n      expect(log?.responseBody).toEqual(mockResponse);\r\n      expect(log?.responseTime).toBeGreaterThan(0);\r\n    });\r\n\r\n    it('should handle submission error', async () => {\r\n      const mockError = new HttpErrorResponse({\r\n        error: { error: { message: 'Invalid API key' } },\r\n        status: 401,\r\n        statusText: 'Unauthorized'\r\n      });\r\n\r\n      tradingService.placeExchangeOrder.and.returnValue(throwError(() => mockError));\r\n\r\n      component.onExchangeChange(ExchangeType.BINGX);\r\n      component.onCredentialChange('cred-1');\r\n\r\n      await component.onSubmitRequest();\r\n\r\n      const log = component.currentLog();\r\n      expect(log).toBeTruthy();\r\n      expect(log?.success).toBe(false);\r\n      expect(log?.statusCode).toBe(401);\r\n      expect(log?.error).toBe('Invalid API key');\r\n      expect(component.error()).toBe('Invalid API key');\r\n    });\r\n\r\n    it('should add log to history', async () => {\r\n      const mockResponse: ExchangeOrderResponse = { success: true };\r\n      tradingService.placeExchangeOrder.and.returnValue(of(mockResponse));\r\n\r\n      component.onExchangeChange(ExchangeType.BINGX);\r\n      component.onCredentialChange('cred-1');\r\n\r\n      expect(component.logs().length).toBe(0);\r\n\r\n      await component.onSubmitRequest();\r\n\r\n      expect(component.logs().length).toBe(1);\r\n    });\r\n  });\r\n\r\n  // ============================================================================\r\n  // UTILITY METHOD TESTS\r\n  // ============================================================================\r\n\r\n  describe('Utility Methods', () => {\r\n    beforeEach(() => {\r\n      fixture.detectChanges();\r\n    });\r\n\r\n    it('should clear current log', () => {\r\n      component.currentLog.set({\r\n        timestamp: new Date(),\r\n        method: 'POST',\r\n        endpoint: '/test',\r\n        requestBody: {},\r\n        success: true\r\n      });\r\n      component.error.set('Test error');\r\n\r\n      component.clearCurrentLog();\r\n\r\n      expect(component.currentLog()).toBeNull();\r\n      expect(component.error()).toBeNull();\r\n    });\r\n\r\n    it('should clear all logs', () => {\r\n      component.logs.set([\r\n        {\r\n          timestamp: new Date(),\r\n          method: 'POST',\r\n          endpoint: '/test1',\r\n          requestBody: {},\r\n          success: true\r\n        },\r\n        {\r\n          timestamp: new Date(),\r\n          method: 'POST',\r\n          endpoint: '/test2',\r\n          requestBody: {},\r\n          success: true\r\n        }\r\n      ]);\r\n\r\n      component.clearAllLogs();\r\n\r\n      expect(component.logs().length).toBe(0);\r\n      expect(component.currentLog()).toBeNull();\r\n    });\r\n\r\n    it('should format JSON correctly', () => {\r\n      const obj = { test: 'value', nested: { key: 123 } };\r\n      const formatted = component.formatJson(obj);\r\n\r\n      expect(formatted).toContain('\"test\": \"value\"');\r\n      expect(formatted).toContain('\"nested\"');\r\n    });\r\n\r\n    it('should get correct status code class', () => {\r\n      expect(component.getStatusCodeClass(200)).toBe('status-success');\r\n      expect(component.getStatusCodeClass(201)).toBe('status-success');\r\n      expect(component.getStatusCodeClass(400)).toBe('status-client-error');\r\n      expect(component.getStatusCodeClass(401)).toBe('status-client-error');\r\n      expect(component.getStatusCodeClass(500)).toBe('status-server-error');\r\n      expect(component.getStatusCodeClass(undefined)).toBe('status-unknown');\r\n    });\r\n\r\n    it('should get correct status code label', () => {\r\n      expect(component.getStatusCodeLabel(200)).toBe('OK');\r\n      expect(component.getStatusCodeLabel(400)).toBe('Bad Request');\r\n      expect(component.getStatusCodeLabel(401)).toBe('Unauthorized');\r\n      expect(component.getStatusCodeLabel(500)).toBe('Internal Server Error');\r\n      expect(component.getStatusCodeLabel(999)).toBe('999');\r\n    });\r\n\r\n    it('should return correct error messages for form controls', () => {\r\n      const symbolControl = component.orderForm.get('symbol');\r\n\r\n      symbolControl?.setValue('');\r\n      symbolControl?.markAsTouched();\r\n      expect(component.getErrorMessage('symbol')).toBe('This field is required');\r\n\r\n      symbolControl?.setValue('INVALID');\r\n      expect(component.getErrorMessage('symbol')).toContain('Invalid format');\r\n    });\r\n\r\n    it('should check if form control has error', () => {\r\n      const symbolControl = component.orderForm.get('symbol');\r\n\r\n      symbolControl?.setValue('');\r\n      expect(component.hasError('symbol')).toBe(false); // Not touched yet\r\n\r\n      symbolControl?.markAsTouched();\r\n      expect(component.hasError('symbol')).toBe(true);\r\n\r\n      symbolControl?.setValue('BTC-USDT');\r\n      expect(component.hasError('symbol')).toBe(false);\r\n    });\r\n  });\r\n\r\n  // ============================================================================\r\n  // COMPUTED SIGNAL TESTS\r\n  // ============================================================================\r\n\r\n  describe('Computed Signals', () => {\r\n    beforeEach(() => {\r\n      fixture.detectChanges();\r\n    });\r\n\r\n    it('should compute canSubmit correctly', () => {\r\n      expect(component.canSubmit()).toBe(false); // No exchange/credential selected\r\n\r\n      component.onExchangeChange(ExchangeType.BINGX);\r\n      expect(component.canSubmit()).toBe(false); // No credential selected\r\n\r\n      component.onCredentialChange('cred-1');\r\n      expect(component.canSubmit()).toBe(true); // All requirements met\r\n    });\r\n\r\n    it('should compute requestPreview correctly', () => {\r\n      component.onExchangeChange(ExchangeType.BINGX);\r\n      component.onCredentialChange('cred-1');\r\n      component.orderForm.patchValue({\r\n        symbol: 'BTC-USDT',\r\n        side: OrderSide.BUY,\r\n        quantity: 0.5\r\n      });\r\n\r\n      const preview = component.requestPreview();\r\n\r\n      expect(preview).toEqual({\r\n        exchange: ExchangeType.BINGX,\r\n        credentialId: 'cred-1',\r\n        symbol: 'BTC-USDT',\r\n        side: OrderSide.BUY,\r\n        positionSide: PositionSide.LONG,\r\n        type: OrderType.MARKET,\r\n        quantity: 0.5,\r\n        price: undefined\r\n      });\r\n    });\r\n\r\n    it('should include price in requestPreview for LIMIT orders', () => {\r\n      component.onExchangeChange(ExchangeType.BINGX);\r\n      component.onCredentialChange('cred-1');\r\n      component.orderForm.patchValue({\r\n        type: OrderType.LIMIT\r\n      });\r\n      component.orderForm.get('price')?.setValue(45000);\r\n\r\n      const preview = component.requestPreview();\r\n\r\n      expect(preview?.price).toBe(45000);\r\n    });\r\n  });\r\n\r\n  // ============================================================================\r\n  // CLIPBOARD TESTS\r\n  // ============================================================================\r\n\r\n  describe('Clipboard Operations', () => {\r\n    beforeEach(() => {\r\n      fixture.detectChanges();\r\n    });\r\n\r\n    it('should copy text to clipboard', async () => {\r\n      spyOn(navigator.clipboard, 'writeText').and.returnValue(Promise.resolve());\r\n\r\n      await component.copyToClipboard('test text');\r\n\r\n      expect(navigator.clipboard.writeText).toHaveBeenCalledWith('test text');\r\n    });\r\n\r\n    it('should copy request to clipboard', async () => {\r\n      spyOn(navigator.clipboard, 'writeText').and.returnValue(Promise.resolve());\r\n\r\n      component.onExchangeChange(ExchangeType.BINGX);\r\n      component.onCredentialChange('cred-1');\r\n\r\n      await component.copyRequest();\r\n\r\n      expect(navigator.clipboard.writeText).toHaveBeenCalled();\r\n    });\r\n\r\n    it('should copy response to clipboard', async () => {\r\n      spyOn(navigator.clipboard, 'writeText').and.returnValue(Promise.resolve());\r\n\r\n      component.currentLog.set({\r\n        timestamp: new Date(),\r\n        method: 'POST',\r\n        endpoint: '/test',\r\n        requestBody: {},\r\n        responseBody: { test: 'data' },\r\n        success: true\r\n      });\r\n\r\n      await component.copyResponse();\r\n\r\n      expect(navigator.clipboard.writeText).toHaveBeenCalledWith(\r\n        jasmine.stringContaining('\"test\": \"data\"')\r\n      );\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\testing\\api-tester\\api-tester.component.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1372,1375],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1372,1375],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":60,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1446,1449],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1446,1449],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1628,1631],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1628,1631],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":75,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1744,1747],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1744,1747],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":139,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":139,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":143,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":143,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":143,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":143,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":144,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":144,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .side on an `any` value.","line":144,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":144,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":145,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":145,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .positionSide on an `any` value.","line":145,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":145,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":146,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":146,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .type on an `any` value.","line":146,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":146,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":147,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":147,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .quantity on an `any` value.","line":147,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":147,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":148,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":148,"endColumn":78},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .type on an `any` value.","line":148,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":148,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .price on an `any` value.","line":148,"column":61,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":148,"endColumn":66},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":283,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":283,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":283,"column":36,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":283,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":284,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":284,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .side on an `any` value.","line":284,"column":34,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":284,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":285,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":285,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .positionSide on an `any` value.","line":285,"column":42,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":285,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":286,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":286,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .type on an `any` value.","line":286,"column":34,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":286,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":287,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":287,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .quantity on an `any` value.","line":287,"column":38,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":287,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":288,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":288,"endColumn":100},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .type on an `any` value.","line":288,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":288,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .price on an `any` value.","line":288,"column":83,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":288,"endColumn":88},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":313,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":313,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10285,10288],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10285,10288],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":318,"column":7,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":318,"endColumn":80},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":320,"column":7,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":320,"endColumn":104},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .error on an `any` value.","line":320,"column":41,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":320,"endColumn":46},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":383,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":383,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12054,12057],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12054,12057],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":386,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":386,"endColumn":17},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .min on an `any` value.","line":434,"column":91,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":434,"endColumn":94}],"suppressedMessages":[],"errorCount":38,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, OnInit, signal, computed } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormBuilder, FormGroup, ReactiveFormsModule, Validators } from '@angular/forms';\r\nimport { HttpErrorResponse } from '@angular/common/http';\r\nimport { ExchangeCredentialsService } from '../../../services/exchange-credentials.service';\r\nimport { TradingService } from '../../../services/trading.service';\r\nimport { ExchangeType, ExchangeCredential } from '../../../models/exchange-credentials.model';\r\n\r\n/**\r\n * Order Type enumeration for exchange orders\r\n */\r\nexport enum OrderType {\r\n  MARKET = 'MARKET',\r\n  LIMIT = 'LIMIT'\r\n}\r\n\r\n/**\r\n * Order Side enumeration\r\n */\r\nexport enum OrderSide {\r\n  BUY = 'BUY',\r\n  SELL = 'SELL'\r\n}\r\n\r\n/**\r\n * Position Side enumeration for futures trading\r\n */\r\nexport enum PositionSide {\r\n  LONG = 'LONG',\r\n  SHORT = 'SHORT'\r\n}\r\n\r\n/**\r\n * Exchange Order Request interface\r\n */\r\nexport interface ExchangeOrderRequest {\r\n  exchange: ExchangeType;\r\n  credentialId: string;\r\n  symbol: string;\r\n  side: OrderSide;\r\n  positionSide: PositionSide;\r\n  type: OrderType;\r\n  quantity: number;\r\n  price?: number;\r\n}\r\n\r\n/**\r\n * Exchange Order Response interface\r\n */\r\nexport interface ExchangeOrderResponse {\r\n  success: boolean;\r\n  orderId?: string;\r\n  clientOrderId?: string;\r\n  status?: string;\r\n  message?: string;\r\n  data?: any;\r\n  error?: {\r\n    code: string;\r\n    message: string;\r\n    details?: any;\r\n  };\r\n}\r\n\r\n/**\r\n * Request/Response Log Entry interface\r\n */\r\nexport interface RequestResponseLog {\r\n  timestamp: Date;\r\n  method: string;\r\n  endpoint: string;\r\n  requestBody: any;\r\n  requestHeaders?: Record<string, string>;\r\n  queryString?: string;\r\n  statusCode?: number;\r\n  responseBody?: any;\r\n  responseTime?: number;\r\n  success: boolean;\r\n  error?: string;\r\n}\r\n\r\n/**\r\n * API Tester Component\r\n *\r\n * A comprehensive API testing interface for exchange orders that mimics Swagger UI.\r\n * Allows users to test exchange order placement with detailed request/response inspection.\r\n *\r\n * Features:\r\n * - Exchange and credential selection\r\n * - Order parameter configuration (symbol, side, type, quantity, price)\r\n * - Real-time request preview with JSON syntax highlighting\r\n * - Response display with status codes and timing\r\n * - Copy-to-clipboard functionality\r\n * - Form validation and error handling\r\n * - Dark theme similar to Swagger UI\r\n */\r\n@Component({\r\n  selector: 'app-api-tester',\r\n  standalone: true,\r\n  imports: [CommonModule, ReactiveFormsModule],\r\n  templateUrl: './api-tester.component.html',\r\n  styleUrls: ['./api-tester.component.scss']\r\n})\r\nexport class ApiTesterComponent implements OnInit {\r\n  // ============================================================================\r\n  // SIGNALS - Reactive State Management\r\n  // ============================================================================\r\n\r\n  readonly isLoading = signal<boolean>(false);\r\n  readonly error = signal<string | null>(null);\r\n  readonly currentLog = signal<RequestResponseLog | null>(null);\r\n  readonly logs = signal<RequestResponseLog[]>([]);\r\n\r\n  readonly selectedExchange = signal<ExchangeType | null>(null);\r\n  readonly selectedCredential = signal<ExchangeCredential | null>(null);\r\n\r\n  // ============================================================================\r\n  // COMPUTED SIGNALS - Derived State\r\n  // ============================================================================\r\n\r\n  readonly availableCredentials = computed(() => {\r\n    const exchange = this.selectedExchange();\r\n    if (!exchange) return [];\r\n\r\n    return this.credentialsService\r\n      .credentials()\r\n      .filter(cred => cred.exchange === exchange);\r\n  });\r\n\r\n  readonly canSubmit = computed(() => {\r\n    return this.orderForm?.valid &&\r\n           this.selectedExchange() !== null &&\r\n           this.selectedCredential() !== null &&\r\n           !this.isLoading();\r\n  });\r\n\r\n  readonly requestPreview = computed(() => {\r\n    if (!this.orderForm) return null;\r\n\r\n    const formValue = this.orderForm.value;\r\n    return {\r\n      exchange: this.selectedExchange(),\r\n      credentialId: this.selectedCredential()?.id,\r\n      symbol: formValue.symbol,\r\n      side: formValue.side,\r\n      positionSide: formValue.positionSide,\r\n      type: formValue.type,\r\n      quantity: formValue.quantity,\r\n      price: formValue.type === OrderType.LIMIT ? formValue.price : undefined\r\n    };\r\n  });\r\n\r\n  // ============================================================================\r\n  // ENUM REFERENCES - For Template Access\r\n  // ============================================================================\r\n\r\n  readonly ExchangeType = ExchangeType;\r\n  readonly OrderType = OrderType;\r\n  readonly OrderSide = OrderSide;\r\n  readonly PositionSide = PositionSide;\r\n\r\n  // ============================================================================\r\n  // FORM\r\n  // ============================================================================\r\n\r\n  orderForm!: FormGroup;\r\n\r\n  // ============================================================================\r\n  // CONFIGURATION\r\n  // ============================================================================\r\n\r\n  readonly exchangeOptions = [\r\n    { value: ExchangeType.BINGX, label: 'BingX', color: '#1E73FA' },\r\n    { value: ExchangeType.BYBIT, label: 'Bybit', color: '#F7A600' },\r\n    { value: ExchangeType.BINANCE, label: 'Binance', color: '#F3BA2F' }\r\n  ];\r\n\r\n  readonly orderTypeOptions = [\r\n    { value: OrderType.MARKET, label: 'Market', description: 'Execute at current market price' },\r\n    { value: OrderType.LIMIT, label: 'Limit', description: 'Execute at specified price or better' }\r\n  ];\r\n\r\n  readonly orderSideOptions = [\r\n    { value: OrderSide.BUY, label: 'Buy', color: '#22c55e' },\r\n    { value: OrderSide.SELL, label: 'Sell', color: '#ef4444' }\r\n  ];\r\n\r\n  readonly positionSideOptions = [\r\n    { value: PositionSide.LONG, label: 'Long', color: '#22c55e' },\r\n    { value: PositionSide.SHORT, label: 'Short', color: '#ef4444' }\r\n  ];\r\n\r\n  // ============================================================================\r\n  // CONSTRUCTOR\r\n  // ============================================================================\r\n\r\n  constructor(\r\n    private fb: FormBuilder,\r\n    private tradingService: TradingService,\r\n    private credentialsService: ExchangeCredentialsService\r\n  ) {\r\n    this.initializeForm();\r\n  }\r\n\r\n  // ============================================================================\r\n  // LIFECYCLE HOOKS\r\n  // ============================================================================\r\n\r\n  ngOnInit(): void {\r\n    // Load credentials from backend\r\n    this.credentialsService.fetchCredentials().subscribe({\r\n      error: (err) => {\r\n        console.error('Failed to load credentials:', err);\r\n        this.error.set('Failed to load exchange credentials. Please try again.');\r\n      }\r\n    });\r\n\r\n    // Watch for form value changes to enable/disable price field\r\n    this.orderForm.get('type')?.valueChanges.subscribe(type => {\r\n      const priceControl = this.orderForm.get('price');\r\n      if (type === OrderType.LIMIT) {\r\n        priceControl?.setValidators([Validators.required, Validators.min(0.00000001)]);\r\n        priceControl?.enable();\r\n      } else {\r\n        priceControl?.clearValidators();\r\n        priceControl?.disable();\r\n      }\r\n      priceControl?.updateValueAndValidity();\r\n    });\r\n  }\r\n\r\n  // ============================================================================\r\n  // PRIVATE METHODS - Initialization\r\n  // ============================================================================\r\n\r\n  private initializeForm(): void {\r\n    this.orderForm = this.fb.group({\r\n      symbol: ['BTC-USDT', [Validators.required, Validators.pattern(/^[A-Z0-9]+-[A-Z0-9]+$/)]],\r\n      side: [OrderSide.BUY, Validators.required],\r\n      positionSide: [PositionSide.LONG, Validators.required],\r\n      type: [OrderType.MARKET, Validators.required],\r\n      quantity: [0.001, [Validators.required, Validators.min(0.00000001)]],\r\n      price: [{ value: null, disabled: true }]\r\n    });\r\n  }\r\n\r\n  // ============================================================================\r\n  // PUBLIC METHODS - User Actions\r\n  // ============================================================================\r\n\r\n  /**\r\n   * Handle exchange selection change\r\n   */\r\n  onExchangeChange(exchange: ExchangeType): void {\r\n    this.selectedExchange.set(exchange);\r\n    this.selectedCredential.set(null); // Reset credential when exchange changes\r\n    this.error.set(null);\r\n  }\r\n\r\n  /**\r\n   * Handle credential selection change\r\n   */\r\n  onCredentialChange(credentialId: string): void {\r\n    const credential = this.availableCredentials().find(c => c.id === credentialId);\r\n    this.selectedCredential.set(credential || null);\r\n    this.error.set(null);\r\n  }\r\n\r\n  /**\r\n   * Submit order request\r\n   */\r\n  async onSubmitRequest(): Promise<void> {\r\n    if (!this.canSubmit()) {\r\n      return;\r\n    }\r\n\r\n    this.error.set(null);\r\n    this.isLoading.set(true);\r\n\r\n    const startTime = Date.now();\r\n    const requestData: ExchangeOrderRequest = {\r\n      exchange: this.selectedExchange()!,\r\n      credentialId: this.selectedCredential()!.id,\r\n      symbol: this.orderForm.value.symbol,\r\n      side: this.orderForm.value.side,\r\n      positionSide: this.orderForm.value.positionSide,\r\n      type: this.orderForm.value.type,\r\n      quantity: this.orderForm.value.quantity,\r\n      price: this.orderForm.value.type === OrderType.LIMIT ? this.orderForm.value.price : undefined\r\n    };\r\n\r\n    // Create log entry\r\n    const logEntry: RequestResponseLog = {\r\n      timestamp: new Date(),\r\n      method: 'POST',\r\n      endpoint: '/api/exchange-orders',\r\n      requestBody: requestData,\r\n      success: false\r\n    };\r\n\r\n    try {\r\n      // Call the trading service to place order\r\n      const response = await this.tradingService.placeExchangeOrder(requestData).toPromise();\r\n      const endTime = Date.now();\r\n\r\n      logEntry.statusCode = 200;\r\n      logEntry.responseBody = response;\r\n      logEntry.responseTime = endTime - startTime;\r\n      logEntry.success = response?.success ?? false;\r\n\r\n      this.currentLog.set(logEntry);\r\n      this.logs.update(logs => [logEntry, ...logs]);\r\n\r\n    } catch (err: any) {\r\n      const endTime = Date.now();\r\n      const httpError = err as HttpErrorResponse;\r\n\r\n      logEntry.statusCode = httpError.status || 500;\r\n      logEntry.responseBody = httpError.error || { message: httpError.message };\r\n      logEntry.responseTime = endTime - startTime;\r\n      logEntry.error = httpError.error?.error?.message || httpError.message || 'Unknown error occurred';\r\n      logEntry.success = false;\r\n\r\n      this.currentLog.set(logEntry);\r\n      this.logs.update(logs => [logEntry, ...logs]);\r\n      this.error.set(logEntry.error || 'Request failed');\r\n    } finally {\r\n      this.isLoading.set(false);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear current request/response\r\n   */\r\n  clearCurrentLog(): void {\r\n    this.currentLog.set(null);\r\n    this.error.set(null);\r\n  }\r\n\r\n  /**\r\n   * Clear all logs\r\n   */\r\n  clearAllLogs(): void {\r\n    this.logs.set([]);\r\n    this.clearCurrentLog();\r\n  }\r\n\r\n  /**\r\n   * Copy text to clipboard\r\n   */\r\n  async copyToClipboard(text: string): Promise<void> {\r\n    try {\r\n      await navigator.clipboard.writeText(text);\r\n      // Could add a toast notification here\r\n      console.log('Copied to clipboard');\r\n    } catch (err) {\r\n      console.error('Failed to copy:', err);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Copy request as JSON\r\n   */\r\n  async copyRequest(): Promise<void> {\r\n    const preview = this.requestPreview();\r\n    if (preview) {\r\n      await this.copyToClipboard(JSON.stringify(preview, null, 2));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Copy response as JSON\r\n   */\r\n  async copyResponse(): Promise<void> {\r\n    const log = this.currentLog();\r\n    if (log?.responseBody) {\r\n      await this.copyToClipboard(JSON.stringify(log.responseBody, null, 2));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Format JSON for display\r\n   */\r\n  formatJson(obj: any): string {\r\n    try {\r\n      return JSON.stringify(obj, null, 2);\r\n    } catch (err) {\r\n      return String(obj);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get status code color class\r\n   */\r\n  getStatusCodeClass(statusCode?: number): string {\r\n    if (!statusCode) return 'status-unknown';\r\n    if (statusCode >= 200 && statusCode < 300) return 'status-success';\r\n    if (statusCode >= 400 && statusCode < 500) return 'status-client-error';\r\n    if (statusCode >= 500) return 'status-server-error';\r\n    return 'status-unknown';\r\n  }\r\n\r\n  /**\r\n   * Get status code label\r\n   */\r\n  getStatusCodeLabel(statusCode?: number): string {\r\n    if (!statusCode) return 'Unknown';\r\n\r\n    const labels: Record<number, string> = {\r\n      200: 'OK',\r\n      201: 'Created',\r\n      400: 'Bad Request',\r\n      401: 'Unauthorized',\r\n      403: 'Forbidden',\r\n      404: 'Not Found',\r\n      422: 'Unprocessable Entity',\r\n      429: 'Too Many Requests',\r\n      500: 'Internal Server Error',\r\n      502: 'Bad Gateway',\r\n      503: 'Service Unavailable'\r\n    };\r\n\r\n    return labels[statusCode] || statusCode.toString();\r\n  }\r\n\r\n  /**\r\n   * Get form control error message\r\n   */\r\n  getErrorMessage(controlName: string): string {\r\n    const control = this.orderForm.get(controlName);\r\n    if (!control || !control.errors || !control.touched) return '';\r\n\r\n    if (control.errors['required']) return 'This field is required';\r\n    if (control.errors['pattern']) return 'Invalid format (use format like BTC-USDT)';\r\n    if (control.errors['min']) return `Value must be greater than ${control.errors['min'].min}`;\r\n\r\n    return 'Invalid value';\r\n  }\r\n\r\n  /**\r\n   * Check if form control has error\r\n   */\r\n  hasError(controlName: string): boolean {\r\n    const control = this.orderForm.get(controlName);\r\n    return !!(control && control.invalid && control.touched);\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\trading-chart\\trading-chart.component.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":98,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":98,"endColumn":55},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":100,"column":9,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":100,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .innerHTML on an `any` value.","line":170,"column":44,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":170,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":230,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":230,"endColumn":55},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .appendChild on an `any` value.","line":230,"column":44,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":230,"endColumn":55}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, OnInit, AfterViewInit, OnDestroy, OnChanges, SimpleChanges, ViewChild, ElementRef, Input, Output, EventEmitter, effect, computed } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { ThemeService } from '../../services/theme.service';\r\nimport { TranslationService } from '../../services/translation.service';\r\nimport { ButtonComponent } from '../ui/button/button.component';\r\n\r\nexport interface TradingViewConfig {\r\n  allow_symbol_change: boolean;\r\n  calendar: boolean;\r\n  details: boolean;\r\n  hide_side_toolbar: boolean;\r\n  hide_top_toolbar: boolean;\r\n  hide_legend: boolean;\r\n  hide_volume: boolean;\r\n  hotlist: boolean;\r\n  interval: string;\r\n  locale: string;\r\n  save_image: boolean;\r\n  style: string;\r\n  symbol: string;\r\n  theme: 'light' | 'dark';\r\n  timezone: string;\r\n  backgroundColor?: string;\r\n  gridColor?: string;\r\n  watchlist: string[];\r\n  withdateranges: boolean;\r\n  compareSymbols: string[];\r\n  studies: string[];\r\n  autosize: boolean;\r\n}\r\n\r\nexport interface GridConfig {\r\n  symbol: string;\r\n  upperBound: number;\r\n  lowerBound: number;\r\n  gridCount: number;\r\n  gridSpacing: number;\r\n  strategyType: string;\r\n}\r\n\r\n@Component({\r\n  selector: 'app-trading-chart',\r\n  standalone: true,\r\n  imports: [CommonModule, FormsModule, ButtonComponent],\r\n  templateUrl: './trading-chart.component.html',\r\n  styleUrl: './trading-chart.component.scss'\r\n})\r\nexport class TradingChartComponent implements OnInit, AfterViewInit, OnDestroy, OnChanges {\r\n  @ViewChild('tradingviewWidget', { static: false }) tradingviewWidget!: ElementRef;\r\n  @Input() symbol = 'BINANCE:BTCUSDT';\r\n  @Input() initialSymbol = 'BINANCE:BTCUSDT';\r\n  @Input() initialResolution = 'D';\r\n  @Input() chartHeight = 600;\r\n  @Output() symbolChange = new EventEmitter<string>();\r\n\r\n  private scriptElement: HTMLScriptElement | null = null;\r\n\r\n  // Component state\r\n  loading = false;\r\n  error: string | null = null;\r\n\r\n  // Widget configuration\r\n  currentSymbol = this.symbol;\r\n  currentInterval = 'D';\r\n  showVolume = false;\r\n  showDetails = false;\r\n  showCalendar = false;\r\n  allowSymbolChange = true;\r\n\r\n  // Theme integration\r\n  readonly currentTheme = this.themeService.currentTheme;\r\n  readonly isDark = computed(() => this.currentTheme() === 'dark');\r\n  readonly currentLanguage = this.translationService.currentLanguage;\r\n\r\n  constructor(\r\n    private themeService: ThemeService,\r\n    private translationService: TranslationService\r\n  ) {\r\n    // React to theme and language changes\r\n    effect(() => {\r\n      this.currentTheme(); // Track theme changes\r\n      this.currentLanguage(); // Track language changes\r\n      if (this.tradingviewWidget?.nativeElement && this.scriptElement) {\r\n        this.reloadWidget();\r\n      }\r\n    });\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.currentSymbol = this.initialSymbol || this.symbol;\r\n    this.currentInterval = this.initialResolution || this.currentInterval;\r\n  }\r\n\r\n  ngOnChanges(changes: SimpleChanges): void {\r\n    // Detect symbol changes from parent component\r\n    if (changes['symbol'] && !changes['symbol'].firstChange) {\r\n      const newSymbol = changes['symbol'].currentValue;\r\n      if (newSymbol && newSymbol !== this.currentSymbol) {\r\n        this.currentSymbol = newSymbol;\r\n        // Only reload if widget is already initialized\r\n        if (this.tradingviewWidget?.nativeElement && this.scriptElement) {\r\n          this.reloadWidget();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  ngAfterViewInit(): void {\r\n    setTimeout(() => {\r\n      this.loadTradingViewWidget();\r\n    }, 100);\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    if (this.scriptElement) {\r\n      this.scriptElement.remove();\r\n      this.scriptElement = null;\r\n    }\r\n  }\r\n\r\n  updateSymbol(): void {\r\n    if (this.currentSymbol && this.currentSymbol.trim()) {\r\n      this.symbol = this.currentSymbol.trim();\r\n      this.symbolChange.emit(this.symbol);\r\n      this.reloadWidget();\r\n    }\r\n  }\r\n\r\n  updateInterval(): void {\r\n    this.reloadWidget();\r\n  }\r\n\r\n  updateConfig(): void {\r\n    this.reloadWidget();\r\n  }\r\n\r\n  toggleTheme(): void {\r\n    this.themeService.toggleTheme();\r\n  }\r\n\r\n  retry(): void {\r\n    this.error = null;\r\n    this.loadTradingViewWidget();\r\n  }\r\n\r\n  translate(key: string): string {\r\n    return this.translationService.translate(key);\r\n  }\r\n\r\n  private loadTradingViewWidget(): void {\r\n    if (!this.tradingviewWidget?.nativeElement) {\r\n      this.error = this.translate('chart.containerNotFound');\r\n      return;\r\n    }\r\n\r\n    this.loading = true;\r\n    this.error = null;\r\n    this.createWidget();\r\n  }\r\n\r\n  private reloadWidget(): void {\r\n    if (this.scriptElement) {\r\n      this.scriptElement.remove();\r\n      this.scriptElement = null;\r\n    }\r\n\r\n    // Clear the container\r\n    if (this.tradingviewWidget?.nativeElement) {\r\n      this.tradingviewWidget.nativeElement.innerHTML = '';\r\n    }\r\n\r\n    // Recreate the widget\r\n    this.createWidget();\r\n  }\r\n\r\n  private createWidget(): void {\r\n    if (!this.tradingviewWidget?.nativeElement) {\r\n      this.error = this.translate('chart.widgetNotAvailable');\r\n      this.loading = false;\r\n      return;\r\n    }\r\n\r\n    const isDarkTheme = this.isDark();\r\n    const locale = this.translationService.getTradingViewLocale();\r\n\r\n    const config: TradingViewConfig = {\r\n      allow_symbol_change: this.allowSymbolChange,\r\n      calendar: this.showCalendar,\r\n      details: this.showDetails,\r\n      hide_side_toolbar: true,\r\n      hide_top_toolbar: false,\r\n      hide_legend: false,\r\n      hide_volume: !this.showVolume,\r\n      hotlist: false,\r\n      interval: this.currentInterval,\r\n      locale: locale,\r\n      save_image: true,\r\n      style: \"1\", // Candle style\r\n      symbol: this.currentSymbol,\r\n      theme: isDarkTheme ? \"dark\" : \"light\",\r\n      timezone: \"Etc/UTC\",\r\n      backgroundColor: isDarkTheme ? \"#1E1E1E\" : \"#FFFFFF\",\r\n      gridColor: isDarkTheme ? \"rgba(242, 242, 242, 0.06)\" : \"rgba(42, 46, 57, 0.06)\",\r\n      watchlist: [],\r\n      withdateranges: false,\r\n      compareSymbols: [],\r\n      studies: [],\r\n      autosize: true\r\n    };\r\n\r\n    try {\r\n      this.scriptElement = document.createElement('script');\r\n      this.scriptElement.type = 'text/javascript';\r\n      this.scriptElement.src = 'https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js';\r\n      this.scriptElement.async = true;\r\n\r\n      this.scriptElement.innerHTML = JSON.stringify(config);\r\n\r\n      this.scriptElement.onload = () => {\r\n        this.loading = false;\r\n        console.log('TradingView widget loaded successfully');\r\n      };\r\n\r\n      this.scriptElement.onerror = () => {\r\n        this.loading = false;\r\n        this.error = this.translate('chart.failedToLoadWidget');\r\n      };\r\n\r\n      this.tradingviewWidget.nativeElement.appendChild(this.scriptElement);\r\n\r\n      // Set loading timeout\r\n      setTimeout(() => {\r\n        if (this.loading) {\r\n          this.loading = false;\r\n        }\r\n      }, 1000);\r\n\r\n    } catch (error) {\r\n      this.loading = false;\r\n      this.error = this.translate('chart.errorInitializing');\r\n      console.error('TradingView widget error:', error);\r\n    }\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\trading-platform-info-modal\\trading-platform-info-modal.component.html","messages":[{"ruleId":"@angular-eslint/template/click-events-have-key-events","severity":2,"message":"click must be accompanied by either keyup, keydown or keypress event for accessibility.","line":1,"column":1,"nodeType":null,"messageId":"clickEventsHaveKeyEvents","endLine":340,"endColumn":7},{"ruleId":"@angular-eslint/template/interactive-supports-focus","severity":2,"message":"Elements with interaction handlers must be focusable.","line":1,"column":1,"nodeType":null,"messageId":"interactiveSupportsFocus","endLine":340,"endColumn":7},{"ruleId":"@angular-eslint/template/click-events-have-key-events","severity":2,"message":"click must be accompanied by either keyup, keydown or keypress event for accessibility.","line":2,"column":3,"nodeType":null,"messageId":"clickEventsHaveKeyEvents","endLine":339,"endColumn":9},{"ruleId":"@angular-eslint/template/interactive-supports-focus","severity":2,"message":"Elements with interaction handlers must be focusable.","line":2,"column":3,"nodeType":null,"messageId":"interactiveSupportsFocus","endLine":339,"endColumn":9}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<div class=\"modal-overlay\" (click)=\"handleOverlayClick()\">\r\n  <div class=\"modal-content\" (click)=\"handleContentClick($event)\">\r\n    <!-- Modal Header -->\r\n    <header class=\"modal-header\">\r\n      <div class=\"header-info\">\r\n        <div class=\"exchange-logo\" [style.background-color]=\"exchangeColor()\">\r\n          <span class=\"logo-text\">{{ exchangeName().substring(0, 2) }}</span>\r\n        </div>\r\n        <div class=\"header-title\">\r\n          <h2>{{ exchangeName() }} {{ translate('modal.account') }}</h2>\r\n          <div class=\"header-badges\">\r\n            @if (credential().label) {\r\n              <span class=\"label-badge\">{{ credential().label }}</span>\r\n            }\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"header-actions\">\r\n        <ui-button\r\n          variant=\"ghost\"\r\n          size=\"small\"\r\n          className=\"refresh-btn\"\r\n          (clicked)=\"refreshUserInfo()\"\r\n          [disabled]=\"loading()\"\r\n          [title]=\"translate('modal.refreshData')\"\r\n        >\r\n          <span class=\"icon\" [class.spinning]=\"loading()\">üîÑ</span>\r\n        </ui-button>\r\n        <ui-button variant=\"ghost\" size=\"small\" className=\"close-btn\" (clicked)=\"close()\" [title]=\"translate('button.close')\">\r\n          <span class=\"icon\">‚úï</span>\r\n        </ui-button>\r\n      </div>\r\n    </header>\r\n\r\n    <!-- Modal Body -->\r\n    <div class=\"modal-body\">\r\n      <!-- Loading State -->\r\n      @if (loading() && !userInfo()) {\r\n        <div class=\"loading-container\">\r\n          <div class=\"spinner-large\"></div>\r\n          <p>{{ translate('modal.loadingAccount') }}</p>\r\n        </div>\r\n      }\r\n\r\n      <!-- Error State -->\r\n      @if (error() && !userInfo()) {\r\n        <div class=\"error-container\">\r\n          <div class=\"error-icon\">‚ö†Ô∏è</div>\r\n          <h3>{{ translate('modal.unableToLoad') }}</h3>\r\n          <p class=\"error-message\">{{ error() }}</p>\r\n          <ui-button variant=\"primary\" size=\"medium\" (clicked)=\"retryLoad()\">\r\n            <span class=\"btn-icon\">üîÑ</span>\r\n            {{ translate('button.tryAgain') }}\r\n          </ui-button>\r\n        </div>\r\n      }\r\n\r\n      <!-- Main Content -->\r\n      @if (userInfo() && !loading()) {\r\n        <!-- Stats Summary Cards -->\r\n        <section class=\"stats-section\">\r\n          <div class=\"stats-grid\">\r\n            <div class=\"stat-card primary\">\r\n              <div class=\"stat-icon\">üí∞</div>\r\n              <div class=\"stat-content\">\r\n                <h3>${{ formatCurrency(totalEquity()) }}</h3>\r\n                <p>{{ translate('modal.totalEquity') }}</p>\r\n              </div>\r\n            </div>\r\n\r\n            <div class=\"stat-card success\">\r\n              <div class=\"stat-icon\">üíµ</div>\r\n              <div class=\"stat-content\">\r\n                <h3>${{ formatCurrency(availableBalance()) }}</h3>\r\n                <p>{{ translate('modal.availableBalance') }}</p>\r\n              </div>\r\n            </div>\r\n\r\n            <div class=\"stat-card info\">\r\n              <div class=\"stat-icon\">üíº</div>\r\n              <div class=\"stat-content\">\r\n                <h3>${{ formatCurrency(walletBalance()) }}</h3>\r\n                <p>{{ translate('modal.walletBalance') }}</p>\r\n              </div>\r\n            </div>\r\n\r\n            <div class=\"stat-card\" [class.danger]=\"unrealizedPnl() < 0\" [class.success]=\"unrealizedPnl() > 0\">\r\n              <div class=\"stat-icon\">üìà</div>\r\n              <div class=\"stat-content\">\r\n                <h3 [class]=\"getPnlColorClass(unrealizedPnl())\">${{ formatCurrency(unrealizedPnl()) }}</h3>\r\n                <p>{{ translate('modal.unrealizedPnL') }}</p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </section>\r\n\r\n        <!-- Tabs Navigation -->\r\n        <nav class=\"tabs-navigation\">\r\n          <div class=\"tabs-list\">\r\n            @for (tab of tabs; track tab.id) {\r\n              <ui-button\r\n                variant=\"ghost\"\r\n                size=\"medium\"\r\n                className=\"tab-button\"\r\n                [class.active]=\"activeTab() === tab.id\"\r\n                (clicked)=\"setActiveTab(tab.id)\"\r\n              >\r\n                <span class=\"tab-icon\">{{ tab.icon }}</span>\r\n                <span class=\"tab-label\">{{ translate(tab.label) }}</span>\r\n              </ui-button>\r\n            }\r\n          </div>\r\n        </nav>\r\n\r\n        <!-- Tab Content -->\r\n        <section class=\"tab-content\">\r\n          <!-- Overview Tab -->\r\n          @if (activeTab() === 'overview') {\r\n            <div class=\"overview-container\">\r\n              @if (accountInfo()) {\r\n                <div class=\"info-card\">\r\n                  <div class=\"card-header\">\r\n                    <h3>{{ translate('modal.accountSummary') }}</h3>\r\n                  </div>\r\n                  <div class=\"card-body\">\r\n                    <div class=\"info-row\">\r\n                      <span class=\"info-label\">{{ translate('modal.totalEquity') }}</span>\r\n                      <span class=\"info-value\">${{ formatCurrency(getAccountField('totalEquity')) }}</span>\r\n                    </div>\r\n                    <div class=\"info-row\">\r\n                      <span class=\"info-label\">{{ translate('modal.walletBalance') }}</span>\r\n                      <span class=\"info-value\">${{ formatCurrency(getAccountField('totalWalletBalance')) }}</span>\r\n                    </div>\r\n                    <div class=\"info-row\">\r\n                      <span class=\"info-label\">{{ translate('modal.availableBalance') }}</span>\r\n                      <span class=\"info-value text-success\">${{ formatCurrency(getAccountField('totalAvailableBalance')) }}</span>\r\n                    </div>\r\n                    <div class=\"info-row\">\r\n                      <span class=\"info-label\">{{ translate('modal.marginBalance') }}</span>\r\n                      <span class=\"info-value\">${{ formatCurrency(getAccountField('totalMarginBalance')) }}</span>\r\n                    </div>\r\n                    <div class=\"info-row\">\r\n                      <span class=\"info-label\">{{ translate('modal.initialMargin') }}</span>\r\n                      <span class=\"info-value\">${{ formatCurrency(getAccountField('totalInitialMargin')) }}</span>\r\n                    </div>\r\n                    <div class=\"info-row\">\r\n                      <span class=\"info-label\">{{ translate('modal.unrealizedPnL') }}</span>\r\n                      <span class=\"info-value\" [class]=\"getPnlColorClass(getAccountField('totalPerpUPL'))\">\r\n                        ${{ formatCurrency(getAccountField('totalPerpUPL')) }}\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                <div class=\"info-card\">\r\n                  <div class=\"card-header\">\r\n                    <h3>{{ translate('modal.quickStats') }}</h3>\r\n                  </div>\r\n                  <div class=\"card-body\">\r\n                    <div class=\"info-row\">\r\n                      <span class=\"info-label\">{{ translate('modal.activePositions') }}</span>\r\n                      <span class=\"info-value\">{{ activePositions().length }}</span>\r\n                    </div>\r\n                    <div class=\"info-row\">\r\n                      <span class=\"info-label\">{{ translate('modal.activeOrders') }}</span>\r\n                      <span class=\"info-value\">{{ activeOrders().length }}</span>\r\n                    </div>\r\n                    <div class=\"info-row\">\r\n                      <span class=\"info-label\">{{ translate('modal.nonZeroBalances') }}</span>\r\n                      <span class=\"info-value\">{{ nonZeroBalances().length }}</span>\r\n                    </div>\r\n                    <div class=\"info-row\">\r\n                      <span class=\"info-label\">{{ translate('modal.lastUpdated') }}</span>\r\n                      <span class=\"info-value text-muted\">{{ userInfo()!.timestamp | date:'short' }}</span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              } @else {\r\n                <div class=\"error-message-inline\">\r\n                  <span class=\"error-icon\">‚ö†Ô∏è</span>\r\n                  <p>{{ translate('modal.failedToLoadAccount') }}</p>\r\n                </div>\r\n              }\r\n            </div>\r\n          }\r\n\r\n          <!-- Balances Tab -->\r\n          @if (activeTab() === 'balances') {\r\n            <div class=\"balances-container\">\r\n              @if (nonZeroBalances().length > 0) {\r\n                <div class=\"balances-grid\">\r\n                  @for (balance of nonZeroBalances(); track balance.coin) {\r\n                    <div class=\"balance-card\">\r\n                      <div class=\"balance-header\">\r\n                        <div class=\"coin-info\">\r\n                          <h4>{{ balance.coin }}</h4>\r\n                          <span class=\"usd-value\">${{ formatCurrency(balance.usdValue) }}</span>\r\n                        </div>\r\n                      </div>\r\n                      <div class=\"balance-body\">\r\n                        <div class=\"balance-row\">\r\n                          <span class=\"label\">{{ translate('modal.walletBalance') }}</span>\r\n                          <span class=\"value\">{{ formatCurrency(balance.walletBalance, 8) }}</span>\r\n                        </div>\r\n                        <div class=\"balance-row\">\r\n                          <span class=\"label\">{{ translate('modal.available') }}</span>\r\n                          <span class=\"value text-success\">{{ formatCurrency(balance.availableToWithdraw, 8) }}</span>\r\n                        </div>\r\n                        <div class=\"balance-row\">\r\n                          <span class=\"label\">{{ translate('modal.equity') }}</span>\r\n                          <span class=\"value\">{{ formatCurrency(balance.equity, 8) }}</span>\r\n                        </div>\r\n                        @if (parseFloat(balance.unrealisedPnl) !== 0) {\r\n                          <div class=\"balance-row\">\r\n                            <span class=\"label\">{{ translate('modal.unrealizedPnL') }}</span>\r\n                            <span class=\"value\" [class]=\"getPnlColorClass(balance.unrealisedPnl)\">\r\n                              {{ formatCurrency(balance.unrealisedPnl, 8) }}\r\n                            </span>\r\n                          </div>\r\n                        }\r\n                      </div>\r\n                    </div>\r\n                  }\r\n                </div>\r\n              } @else {\r\n                <div class=\"empty-state\">\r\n                  <div class=\"empty-icon\">üí∞</div>\r\n                  <h3>{{ translate('modal.noBalances') }}</h3>\r\n                  <p>{{ translate('modal.noBalancesDesc') }}</p>\r\n                </div>\r\n              }\r\n            </div>\r\n          }\r\n\r\n          <!-- Positions Tab -->\r\n          @if (activeTab() === 'positions') {\r\n            <div class=\"positions-container\">\r\n              @if (activePositions().length > 0) {\r\n                <div class=\"table-responsive\">\r\n                  <table class=\"data-table\">\r\n                    <thead>\r\n                      <tr>\r\n                        <th>{{ translate('dashboard.symbol') }}</th>\r\n                        <th>{{ translate('modal.side') }}</th>\r\n                        <th>{{ translate('modal.size') }}</th>\r\n                        <th>{{ translate('modal.entryPrice') }}</th>\r\n                        <th>{{ translate('modal.markPrice') }}</th>\r\n                        <th>{{ translate('modal.leverage') }}</th>\r\n                        <th>{{ translate('modal.unrealizedPnL') }}</th>\r\n                        <th>{{ translate('modal.pnlPercent') }}</th>\r\n                      </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                      @for (position of activePositions(); track position.symbol) {\r\n                        <tr>\r\n                          <td><strong>{{ position.symbol }}</strong></td>\r\n                          <td>\r\n                            <span class=\"badge\" [class]=\"getSideClass(getPositionSide(position))\">\r\n                              {{ getPositionSide(position) }}\r\n                            </span>\r\n                          </td>\r\n                          <td>{{ formatCurrency(getPositionSize(position), 4) }}</td>\r\n                          <td>${{ formatCurrency(position.entryPrice) }}</td>\r\n                          <td>${{ formatCurrency(position.markPrice) }}</td>\r\n                          <td>{{ position.leverage }}x</td>\r\n                          <td [class]=\"getPnlColorClass(getPositionUnrealizedPnl(position))\">\r\n                            ${{ formatCurrency(getPositionUnrealizedPnl(position)) }}\r\n                          </td>\r\n                          <td [class]=\"getPnlColorClass(calculatePositionProfitPct(position))\">\r\n                            {{ formatCurrency(calculatePositionProfitPct(position)) }}%\r\n                          </td>\r\n                        </tr>\r\n                      }\r\n                    </tbody>\r\n                  </table>\r\n                </div>\r\n              } @else {\r\n                <div class=\"empty-state\">\r\n                  <div class=\"empty-icon\">üìà</div>\r\n                  <h3>{{ translate('modal.noPositions') }}</h3>\r\n                  <p>{{ translate('modal.noPositionsDesc') }}</p>\r\n                </div>\r\n              }\r\n            </div>\r\n          }\r\n\r\n          <!-- Active Orders Tab -->\r\n          @if (activeTab() === 'orders') {\r\n            <div class=\"orders-container\">\r\n              @if (activeOrders().length > 0) {\r\n                <div class=\"table-responsive\">\r\n                  <table class=\"data-table\">\r\n                    <thead>\r\n                      <tr>\r\n                        <th>{{ translate('dashboard.symbol') }}</th>\r\n                        <th>{{ translate('modal.side') }}</th>\r\n                        <th>{{ translate('modal.type') }}</th>\r\n                        <th>{{ translate('modal.quantity') }}</th>\r\n                        <th>{{ translate('modal.price') }}</th>\r\n                        <th>{{ translate('modal.status') }}</th>\r\n                        <th>{{ translate('modal.created') }}</th>\r\n                      </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                      @for (order of activeOrders(); track order.orderId) {\r\n                        <tr>\r\n                          <td><strong>{{ order.symbol }}</strong></td>\r\n                          <td>\r\n                            <span class=\"badge\" [class]=\"getSideClass(order.side)\">\r\n                              {{ order.side }}\r\n                            </span>\r\n                          </td>\r\n                          <td>{{ order.orderType }}</td>\r\n                          <td>{{ formatCurrency(order.qty, 4) }}</td>\r\n                          <td>${{ formatCurrency(order.price) }}</td>\r\n                          <td>\r\n                            <span class=\"badge\" [class]=\"getOrderStatusClass(order.orderStatus)\">\r\n                              {{ order.orderStatus }}\r\n                            </span>\r\n                          </td>\r\n                          <td class=\"text-muted\">{{ order.createdTime | date:'short' }}</td>\r\n                        </tr>\r\n                      }\r\n                    </tbody>\r\n                  </table>\r\n                </div>\r\n              } @else {\r\n                <div class=\"empty-state\">\r\n                  <div class=\"empty-icon\">üìã</div>\r\n                  <h3>{{ translate('modal.noActiveOrders') }}</h3>\r\n                  <p>{{ translate('modal.noOrdersDesc') }}</p>\r\n                </div>\r\n              }\r\n            </div>\r\n          }\r\n        </section>\r\n      }\r\n    </div>\r\n  </div>\r\n</div>\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\trading-platform-info-modal\\trading-platform-info-modal.component.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'signal' is defined but never used.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":16},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an error typed value.","line":23,"column":5,"nodeType":"Property","messageId":"anyAssignment","endLine":23,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .TESTNET on an `error` typed value.","line":23,"column":34,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":23,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":133,"column":5,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":141,"endColumn":7},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":216,"column":14,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":216,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":217,"column":14,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":217,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":262,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":262,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .length on an `any` value.","line":263,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":263,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access [0] on an `any` value.","line":264,"column":21,"nodeType":"Literal","messageId":"unsafeMemberExpression","endLine":264,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":275,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":275,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9119,9122],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9119,9122],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":549,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":549,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18295,18298],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18295,18298],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { ComponentFixture, TestBed } from '@angular/core/testing';\r\nimport { signal } from '@angular/core';\r\nimport { of, throwError, BehaviorSubject } from 'rxjs';\r\nimport { TradingPlatformInfoModalComponent } from './trading-platform-info-modal.component';\r\nimport { BybitUserService, BybitUserInfo } from '../../services/bybit-user.service';\r\nimport {\r\n  ExchangeCredential,\r\n  ExchangeType,\r\n  EnvironmentType\r\n} from '../../models/exchange-credentials.model';\r\n\r\ndescribe('TradingPlatformInfoModalComponent', () => {\r\n  let component: TradingPlatformInfoModalComponent;\r\n  let fixture: ComponentFixture<TradingPlatformInfoModalComponent>;\r\n  let mockBybitUserService: jasmine.SpyObj<BybitUserService>;\r\n  let userInfoSubject: BehaviorSubject<BybitUserInfo | null>;\r\n  let errorSubject: BehaviorSubject<string | null>;\r\n\r\n  const mockCredential: ExchangeCredential = {\r\n    id: 'test-cred-1',\r\n    userId: 'user-123',\r\n    exchange: ExchangeType.BYBIT,\r\n    environment: EnvironmentType.TESTNET,\r\n    apiKeyPreview: 'test***1234',\r\n    label: 'Test Account',\r\n    isActive: true,\r\n    createdAt: '2024-01-01T00:00:00Z',\r\n    updatedAt: '2024-01-01T00:00:00Z'\r\n  };\r\n\r\n  const mockUserInfo: BybitUserInfo = {\r\n    success: true,\r\n    timestamp: '2024-01-01T00:00:00Z',\r\n    testnet: true,\r\n    data: {\r\n      accountInfo: {\r\n        totalEquity: '10000.00',\r\n        totalWalletBalance: '9500.00',\r\n        totalMarginBalance: '9000.00',\r\n        totalAvailableBalance: '8500.00',\r\n        totalPerpUPL: '500.00',\r\n        totalInitialMargin: '1000.00',\r\n        totalMaintenanceMargin: '500.00',\r\n        coin: [\r\n          {\r\n            coin: 'USDT',\r\n            equity: '10000.00',\r\n            usdValue: '10000.00',\r\n            walletBalance: '9500.00',\r\n            availableToWithdraw: '8500.00',\r\n            availableToBorrow: '0.00',\r\n            borrowAmount: '0.00',\r\n            accruedInterest: '0.00',\r\n            totalOrderIM: '500.00',\r\n            totalPositionIM: '500.00',\r\n            totalPositionMM: '250.00',\r\n            unrealisedPnl: '500.00',\r\n            cumRealisedPnl: '1000.00'\r\n          }\r\n        ]\r\n      },\r\n      walletBalance: {\r\n        list: [\r\n          {\r\n            accountType: 'UNIFIED',\r\n            accountIMRate: '0.01',\r\n            accountMMRate: '0.005',\r\n            totalEquity: '10000.00',\r\n            totalWalletBalance: '9500.00',\r\n            totalMarginBalance: '9000.00',\r\n            totalAvailableBalance: '8500.00',\r\n            totalPerpUPL: '500.00',\r\n            totalInitialMargin: '1000.00',\r\n            totalMaintenanceMargin: '500.00',\r\n            accountLTV: '0.1',\r\n            coin: []\r\n          }\r\n        ]\r\n      },\r\n      positions: [\r\n        {\r\n          symbol: 'BTCUSDT',\r\n          side: 'Buy',\r\n          size: '0.1',\r\n          positionValue: '5000.00',\r\n          entryPrice: '50000.00',\r\n          markPrice: '51000.00',\r\n          liqPrice: '45000.00',\r\n          bustPrice: '44000.00',\r\n          positionMM: '250.00',\r\n          positionIM: '500.00',\r\n          tpslMode: 'Full',\r\n          takeProfit: '55000.00',\r\n          stopLoss: '48000.00',\r\n          trailingStop: '0.00',\r\n          unrealisedPnl: '100.00',\r\n          cumRealisedPnl: '200.00',\r\n          createdTime: '2024-01-01T00:00:00Z',\r\n          updatedTime: '2024-01-01T00:00:00Z',\r\n          leverage: '10'\r\n        }\r\n      ],\r\n      positionsCount: 1,\r\n      activeOrders: [\r\n        {\r\n          orderId: 'order-1',\r\n          orderLinkId: 'link-1',\r\n          symbol: 'ETHUSDT',\r\n          side: 'Buy',\r\n          orderType: 'Limit',\r\n          qty: '1.0',\r\n          price: '3000.00',\r\n          orderStatus: 'New',\r\n          timeInForce: 'GTC',\r\n          createdTime: '2024-01-01T00:00:00Z',\r\n          updatedTime: '2024-01-01T00:00:00Z',\r\n          avgPrice: '0.00',\r\n          cumExecQty: '0.00',\r\n          cumExecValue: '0.00',\r\n          cumExecFee: '0.00'\r\n        }\r\n      ],\r\n      activeOrdersCount: 1,\r\n      orderHistory: [],\r\n      marketReference: null\r\n    }\r\n  };\r\n\r\n  beforeEach(async () => {\r\n    userInfoSubject = new BehaviorSubject<BybitUserInfo | null>(null);\r\n    errorSubject = new BehaviorSubject<string | null>(null);\r\n\r\n    mockBybitUserService = jasmine.createSpyObj('BybitUserService', [\r\n      'getUserInfo',\r\n      'calculateUnrealizedPnl',\r\n      'getNonZeroBalances',\r\n      'getActivePositions'\r\n    ], {\r\n      userInfo$: userInfoSubject.asObservable(),\r\n      error$: errorSubject.asObservable()\r\n    });\r\n\r\n    mockBybitUserService.getUserInfo.and.returnValue(of(mockUserInfo));\r\n    mockBybitUserService.calculateUnrealizedPnl.and.returnValue(500);\r\n    mockBybitUserService.getNonZeroBalances.and.returnValue(\r\n      'coin' in mockUserInfo.data.accountInfo ? mockUserInfo.data.accountInfo.coin : []\r\n    );\r\n    mockBybitUserService.getActivePositions.and.returnValue(mockUserInfo.data.positions);\r\n\r\n    await TestBed.configureTestingModule({\r\n      imports: [TradingPlatformInfoModalComponent],\r\n      providers: [\r\n        { provide: BybitUserService, useValue: mockBybitUserService }\r\n      ]\r\n    }).compileComponents();\r\n\r\n    fixture = TestBed.createComponent(TradingPlatformInfoModalComponent);\r\n    component = fixture.componentInstance;\r\n  });\r\n\r\n  describe('Component Initialization', () => {\r\n    it('should create', () => {\r\n      expect(component).toBeTruthy();\r\n    });\r\n\r\n    it('should initialize with default state', () => {\r\n      expect(component.loading()).toBe(false);\r\n      expect(component.error()).toBeNull();\r\n      expect(component.userInfo()).toBeNull();\r\n      expect(component.activeTab()).toBe('overview');\r\n    });\r\n\r\n    it('should load user info on init', (done) => {\r\n      fixture.componentRef.setInput('credential', mockCredential);\r\n      fixture.detectChanges();\r\n\r\n      component.ngOnInit();\r\n\r\n      setTimeout(() => {\r\n        expect(mockBybitUserService.getUserInfo).toHaveBeenCalled();\r\n        done();\r\n      }, 10);\r\n    });\r\n\r\n    it('should add keyboard event listener on init', () => {\r\n      spyOn(document, 'addEventListener');\r\n      fixture.componentRef.setInput('credential', mockCredential);\r\n\r\n      component.ngOnInit();\r\n\r\n      expect(document.addEventListener).toHaveBeenCalledWith('keydown', jasmine.any(Function));\r\n    });\r\n\r\n    it('should remove keyboard event listener on destroy', () => {\r\n      spyOn(document, 'removeEventListener');\r\n      fixture.componentRef.setInput('credential', mockCredential);\r\n\r\n      component.ngOnInit();\r\n      component.ngOnDestroy();\r\n\r\n      expect(document.removeEventListener).toHaveBeenCalledWith('keydown', jasmine.any(Function));\r\n    });\r\n  });\r\n\r\n  describe('Computed Values', () => {\r\n    beforeEach(() => {\r\n      fixture.componentRef.setInput('credential', mockCredential);\r\n      fixture.detectChanges();\r\n    });\r\n\r\n    it('should compute exchange name correctly', () => {\r\n      expect(component.exchangeName()).toBe('Bybit');\r\n    });\r\n\r\n    it('should compute environment correctly', () => {\r\n      expect(component.isTestnet()).toBe(true);\r\n      expect(component.environmentName()).toBe('Testnet');\r\n    });\r\n\r\n    it('should compute total equity from user info', () => {\r\n      component.userInfo.set(mockUserInfo);\r\n      expect(component.totalEquity()).toBe('10000.00');\r\n    });\r\n\r\n    it('should return 0.00 for total equity when no user info', () => {\r\n      component.userInfo.set(null);\r\n      expect(component.totalEquity()).toBe('0.00');\r\n    });\r\n\r\n    it('should compute available balance from user info', () => {\r\n      component.userInfo.set(mockUserInfo);\r\n      expect(component.availableBalance()).toBe('8500.00');\r\n    });\r\n\r\n    it('should compute wallet balance from user info', () => {\r\n      component.userInfo.set(mockUserInfo);\r\n      expect(component.walletBalance()).toBe('9500.00');\r\n    });\r\n\r\n    it('should compute unrealized PnL', () => {\r\n      component.userInfo.set(mockUserInfo);\r\n      expect(component.unrealizedPnl()).toBe(500);\r\n      expect(mockBybitUserService.calculateUnrealizedPnl).toHaveBeenCalledWith(mockUserInfo);\r\n    });\r\n\r\n    it('should compute non-zero balances', () => {\r\n      component.userInfo.set(mockUserInfo);\r\n      const balances = component.nonZeroBalances();\r\n      expect(balances.length).toBe(1);\r\n      expect(balances[0].coin).toBe('USDT');\r\n    });\r\n\r\n    it('should compute active positions', () => {\r\n      component.userInfo.set(mockUserInfo);\r\n      const positions = component.activePositions();\r\n      expect(positions.length).toBe(1);\r\n      expect(positions[0].symbol).toBe('BTCUSDT');\r\n    });\r\n\r\n    it('should compute active orders', () => {\r\n      component.userInfo.set(mockUserInfo);\r\n      const orders = component.activeOrders();\r\n      expect(orders.length).toBe(1);\r\n      expect(orders[0].symbol).toBe('ETHUSDT');\r\n    });\r\n\r\n    it('should detect error in account info', () => {\r\n      const errorInfo = {\r\n        ...mockUserInfo,\r\n        data: {\r\n          ...mockUserInfo.data,\r\n          accountInfo: { error: 'Test error' }\r\n        }\r\n      };\r\n      component.userInfo.set(errorInfo as any);\r\n      expect(component.hasError()).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe('Data Loading', () => {\r\n    beforeEach(() => {\r\n      fixture.componentRef.setInput('credential', mockCredential);\r\n      fixture.detectChanges();\r\n    });\r\n\r\n    it('should set loading state when loading user info', (done) => {\r\n      component.loadUserInfo();\r\n      expect(component.loading()).toBe(true);\r\n\r\n      setTimeout(() => {\r\n        userInfoSubject.next(mockUserInfo);\r\n        setTimeout(() => {\r\n          expect(component.loading()).toBe(false);\r\n          done();\r\n        }, 10);\r\n      }, 10);\r\n    });\r\n\r\n    it('should handle successful data fetch', (done) => {\r\n      component.loadUserInfo();\r\n\r\n      setTimeout(() => {\r\n        userInfoSubject.next(mockUserInfo);\r\n        setTimeout(() => {\r\n          expect(component.userInfo()).toEqual(mockUserInfo);\r\n          expect(component.error()).toBeNull();\r\n          done();\r\n        }, 10);\r\n      }, 10);\r\n    });\r\n\r\n    it('should handle error during data fetch', (done) => {\r\n      mockBybitUserService.getUserInfo.and.returnValue(\r\n        throwError(() => new Error('API Error'))\r\n      );\r\n\r\n      component.loadUserInfo();\r\n\r\n      setTimeout(() => {\r\n        expect(component.loading()).toBe(false);\r\n        expect(component.error()).toBeTruthy();\r\n        done();\r\n      }, 100);\r\n    });\r\n\r\n    it('should show error for unsupported exchange', () => {\r\n      const binanceCredential = { ...mockCredential, exchange: ExchangeType.BINANCE };\r\n      fixture.componentRef.setInput('credential', binanceCredential);\r\n\r\n      component.loadUserInfo();\r\n\r\n      expect(component.error()).toBe('Only Bybit exchange is currently supported');\r\n      expect(mockBybitUserService.getUserInfo).not.toHaveBeenCalled();\r\n    });\r\n\r\n    it('should refresh user info when requested', () => {\r\n      component.refreshUserInfo();\r\n      expect(mockBybitUserService.getUserInfo).toHaveBeenCalled();\r\n    });\r\n  });\r\n\r\n  describe('Tab Navigation', () => {\r\n    beforeEach(() => {\r\n      fixture.componentRef.setInput('credential', mockCredential);\r\n      fixture.detectChanges();\r\n    });\r\n\r\n    it('should change active tab', () => {\r\n      component.setActiveTab('balances');\r\n      expect(component.activeTab()).toBe('balances');\r\n\r\n      component.setActiveTab('positions');\r\n      expect(component.activeTab()).toBe('positions');\r\n    });\r\n\r\n    it('should have correct tab configuration', () => {\r\n      expect(component.tabs.length).toBe(4);\r\n      expect(component.tabs[0].id).toBe('overview');\r\n      expect(component.tabs[1].id).toBe('balances');\r\n      expect(component.tabs[2].id).toBe('positions');\r\n      expect(component.tabs[3].id).toBe('orders');\r\n    });\r\n  });\r\n\r\n  describe('Modal Interactions', () => {\r\n    beforeEach(() => {\r\n      fixture.componentRef.setInput('credential', mockCredential);\r\n      fixture.detectChanges();\r\n    });\r\n\r\n    it('should emit close event when close is called', () => {\r\n      spyOn(component.closeModal, 'emit');\r\n      component.close();\r\n      expect(component.closeModal.emit).toHaveBeenCalled();\r\n    });\r\n\r\n    it('should close modal on overlay click', () => {\r\n      spyOn(component.closeModal, 'emit');\r\n      component.handleOverlayClick();\r\n      expect(component.closeModal.emit).toHaveBeenCalled();\r\n    });\r\n\r\n    it('should stop propagation on content click', () => {\r\n      const event = new Event('click');\r\n      spyOn(event, 'stopPropagation');\r\n      component.handleContentClick(event);\r\n      expect(event.stopPropagation).toHaveBeenCalled();\r\n    });\r\n\r\n    it('should close modal on ESC key press', () => {\r\n      spyOn(component, 'close');\r\n      fixture.componentRef.setInput('credential', mockCredential);\r\n      component.ngOnInit();\r\n\r\n      const event = new KeyboardEvent('keydown', { key: 'Escape' });\r\n      document.dispatchEvent(event);\r\n\r\n      expect(component.close).toHaveBeenCalled();\r\n    });\r\n\r\n    it('should not close on other key presses', () => {\r\n      spyOn(component, 'close');\r\n      fixture.componentRef.setInput('credential', mockCredential);\r\n      component.ngOnInit();\r\n\r\n      const event = new KeyboardEvent('keydown', { key: 'Enter' });\r\n      document.dispatchEvent(event);\r\n\r\n      expect(component.close).not.toHaveBeenCalled();\r\n    });\r\n  });\r\n\r\n  describe('Error Handling', () => {\r\n    beforeEach(() => {\r\n      fixture.componentRef.setInput('credential', mockCredential);\r\n      fixture.detectChanges();\r\n    });\r\n\r\n    it('should clear error when clearError is called', () => {\r\n      component.error.set('Test error');\r\n      component.clearError();\r\n      expect(component.error()).toBeNull();\r\n    });\r\n\r\n    it('should retry loading and clear error', () => {\r\n      component.error.set('Test error');\r\n      spyOn(component, 'loadUserInfo');\r\n\r\n      component.retryLoad();\r\n\r\n      expect(component.error()).toBeNull();\r\n      expect(component.loadUserInfo).toHaveBeenCalled();\r\n    });\r\n  });\r\n\r\n  describe('Formatting Utilities', () => {\r\n    beforeEach(() => {\r\n      fixture.componentRef.setInput('credential', mockCredential);\r\n      fixture.detectChanges();\r\n    });\r\n\r\n    it('should parse float values', () => {\r\n      expect(component.parseFloat('123.45')).toBe(123.45);\r\n      expect(component.parseFloat('0')).toBe(0);\r\n    });\r\n\r\n    it('should format large numbers with units', () => {\r\n      expect(component.formatNumber(1234)).toBe('1.23K');\r\n      expect(component.formatNumber(1234567)).toBe('1.23M');\r\n      expect(component.formatNumber(1234567890)).toBe('1.23B');\r\n      expect(component.formatNumber(123)).toBe('123.00');\r\n    });\r\n\r\n    it('should format currency with decimals', () => {\r\n      expect(component.formatCurrency(123.456)).toBe('123.46');\r\n      expect(component.formatCurrency('789.123', 4)).toBe('789.1230');\r\n      expect(component.formatCurrency('invalid')).toBe('0.00');\r\n    });\r\n\r\n    it('should format percentage', () => {\r\n      expect(component.formatPercentage(0.1234)).toBe('12.34%');\r\n      expect(component.formatPercentage('0.05')).toBe('5.00%');\r\n    });\r\n\r\n    it('should get correct PnL color class', () => {\r\n      expect(component.getPnlColorClass(100)).toBe('text-success');\r\n      expect(component.getPnlColorClass(-100)).toBe('text-danger');\r\n      expect(component.getPnlColorClass(0)).toBe('text-muted');\r\n      expect(component.getPnlColorClass('invalid')).toBe('text-muted');\r\n    });\r\n\r\n    it('should get correct order status class', () => {\r\n      expect(component.getOrderStatusClass('Filled')).toBe('badge-success');\r\n      expect(component.getOrderStatusClass('Cancelled')).toBe('badge-secondary');\r\n      expect(component.getOrderStatusClass('New')).toBe('badge-primary');\r\n      expect(component.getOrderStatusClass('Unknown')).toBe('badge-secondary');\r\n    });\r\n\r\n    it('should get correct side class', () => {\r\n      expect(component.getSideClass('Buy')).toBe('badge-success');\r\n      expect(component.getSideClass('Sell')).toBe('badge-danger');\r\n    });\r\n\r\n    it('should calculate position profit percentage', () => {\r\n      const position = mockUserInfo.data.positions[0];\r\n      const pct = component.calculatePositionProfitPct(position);\r\n      expect(pct).toBeCloseTo(2.0, 1); // (51000 - 50000) / 50000 * 100 = 2%\r\n    });\r\n\r\n    it('should calculate negative profit for sell positions', () => {\r\n      const sellPosition = {\r\n        ...mockUserInfo.data.positions[0],\r\n        side: 'Sell' as const,\r\n        entryPrice: '50000.00',\r\n        markPrice: '51000.00'\r\n      };\r\n      const pct = component.calculatePositionProfitPct(sellPosition);\r\n      expect(pct).toBeCloseTo(-2.0, 1);\r\n    });\r\n\r\n    it('should handle invalid position prices', () => {\r\n      const invalidPosition = {\r\n        ...mockUserInfo.data.positions[0],\r\n        entryPrice: '0.00',\r\n        markPrice: '51000.00'\r\n      };\r\n      expect(component.calculatePositionProfitPct(invalidPosition)).toBe(0);\r\n    });\r\n  });\r\n\r\n  describe('Edge Cases', () => {\r\n    beforeEach(() => {\r\n      fixture.componentRef.setInput('credential', mockCredential);\r\n      fixture.detectChanges();\r\n    });\r\n\r\n    it('should handle empty positions array', () => {\r\n      const emptyInfo = {\r\n        ...mockUserInfo,\r\n        data: { ...mockUserInfo.data, positions: [] }\r\n      };\r\n      mockBybitUserService.getActivePositions.and.returnValue([]);\r\n      component.userInfo.set(emptyInfo);\r\n      expect(component.activePositions()).toEqual([]);\r\n    });\r\n\r\n    it('should handle empty orders array', () => {\r\n      const emptyInfo = {\r\n        ...mockUserInfo,\r\n        data: { ...mockUserInfo.data, activeOrders: [] }\r\n      };\r\n      component.userInfo.set(emptyInfo);\r\n      expect(component.activeOrders()).toEqual([]);\r\n    });\r\n\r\n    it('should handle missing account info', () => {\r\n      component.userInfo.set(null);\r\n      expect(component.accountInfo()).toBeNull();\r\n    });\r\n\r\n    it('should handle account info with error', () => {\r\n      const errorInfo = {\r\n        ...mockUserInfo,\r\n        data: {\r\n          ...mockUserInfo.data,\r\n          accountInfo: { error: 'API Error' }\r\n        }\r\n      };\r\n      component.userInfo.set(errorInfo as any);\r\n      expect(component.accountInfo()).toBeNull();\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\trading-platform-info-modal\\trading-platform-info-modal.component.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'BybitCoinBalance' is defined but never used.","line":7,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'BybitOrder' is defined but never used.","line":9,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":13},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":194,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":194,"endColumn":34},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":194,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":194,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6021,6024],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6021,6024],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":195,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":195,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .activeOrders on an `any` value.","line":195,"column":17,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":195,"endColumn":29}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, OnInit, OnDestroy, signal, computed, input, output, inject } from '@angular/core';\r\nimport { CommonModule, DecimalPipe, DatePipe } from '@angular/common';\r\nimport { Subject, takeUntil } from 'rxjs';\r\nimport {\r\n  BybitUserService,\r\n  BybitUserInfo,\r\n  BybitCoinBalance,\r\n  BybitPosition,\r\n  BybitOrder\r\n} from '../../services/bybit-user.service';\r\nimport {\r\n  BingXUserService,\r\n  BingXUserInfo,\r\n  BingXPosition\r\n} from '../../services/bingx-user.service';\r\nimport {\r\n  ExchangeCredential,\r\n  ExchangeType,\r\n  getExchangeName,\r\n  getExchangeLogo,\r\n  EXCHANGE_METADATA\r\n} from '../../models/exchange-credentials.model';\r\nimport { TranslationService } from '../../services/translation.service';\r\n\r\ninterface Tab {\r\n  id: string;\r\n  label: string;\r\n  icon: string;\r\n}\r\n\r\n/**\r\n * Trading Platform Info Modal Component\r\n *\r\n * Displays comprehensive trading platform information in a modal dialog.\r\n * Supports multiple exchanges (Bybit, Binance, etc.) with testnet/mainnet environments.\r\n *\r\n * Features:\r\n * - Account overview with wallet balance and equity\r\n * - Coin balances breakdown\r\n * - Active positions with PnL\r\n * - Active orders and order history\r\n * - Loading and error states\r\n * - Responsive design\r\n * - Keyboard navigation (ESC to close)\r\n * - Click outside to close\r\n */\r\nimport { ButtonComponent } from '../ui/button/button.component';\r\n\r\n@Component({\r\n  selector: 'app-trading-platform-info-modal',\r\n  standalone: true,\r\n  imports: [\r\n    CommonModule,\r\n    DecimalPipe,\r\n    DatePipe,\r\n    ButtonComponent\r\n  ],\r\n  templateUrl: './trading-platform-info-modal.component.html',\r\n  styleUrl: './trading-platform-info-modal.component.scss'\r\n})\r\nexport class TradingPlatformInfoModalComponent implements OnInit, OnDestroy {\r\n  private destroy$ = new Subject<void>();\r\n\r\n  // Input: Exchange credential to display information for\r\n  credential = input.required<ExchangeCredential>();\r\n\r\n  // Output: Event emitted when modal should be closed\r\n  closeModal = output<void>();\r\n\r\n  // Component state signals\r\n  userInfo = signal<BybitUserInfo | BingXUserInfo | null>(null);\r\n  loading = signal<boolean>(false);\r\n  error = signal<string | null>(null);\r\n  activeTab = signal<string>('overview');\r\n\r\n  protected translationService = inject(TranslationService);\r\n\r\n  // Tab configuration\r\n  tabs: Tab[] = [\r\n    { id: 'overview', label: 'modal.accountOverview', icon: 'üìä' },\r\n    { id: 'balances', label: 'modal.balances', icon: 'üí∞' },\r\n    { id: 'positions', label: 'modal.positions', icon: 'üìà' },\r\n    { id: 'orders', label: 'modal.activeOrders', icon: 'üìã' }\r\n  ];\r\n\r\n  // Computed values\r\n  readonly exchangeName = computed(() => getExchangeName(this.credential().exchange));\r\n  readonly exchangeLogo = computed(() => getExchangeLogo(this.credential().exchange));\r\n  readonly exchangeColor = computed(() => EXCHANGE_METADATA[this.credential().exchange]?.color);\r\n\r\n  readonly totalEquity = computed(() => {\r\n    const info = this.userInfo();\r\n    if (!info || !info.success) return '0.00';\r\n\r\n    const accountInfo = info.data.accountInfo;\r\n    if ('error' in accountInfo) return '0.00';\r\n\r\n    // Check if it's Bybit or BingX\r\n    if ('totalEquity' in accountInfo) {\r\n      // Bybit\r\n      return accountInfo.totalEquity || '0.00';\r\n    } else if ('balance' in accountInfo) {\r\n      // BingX\r\n      return accountInfo.balance.equity || '0.00';\r\n    }\r\n\r\n    return '0.00';\r\n  });\r\n\r\n  readonly availableBalance = computed(() => {\r\n    const info = this.userInfo();\r\n    if (!info || !info.success) return '0.00';\r\n\r\n    const accountInfo = info.data.accountInfo;\r\n    if ('error' in accountInfo) return '0.00';\r\n\r\n    // Check if it's Bybit or BingX\r\n    if ('totalAvailableBalance' in accountInfo) {\r\n      // Bybit\r\n      return accountInfo.totalAvailableBalance || '0.00';\r\n    } else if ('balance' in accountInfo) {\r\n      // BingX\r\n      return accountInfo.balance.availableMargin || '0.00';\r\n    }\r\n\r\n    return '0.00';\r\n  });\r\n\r\n  readonly walletBalance = computed(() => {\r\n    const info = this.userInfo();\r\n    if (!info || !info.success) return '0.00';\r\n\r\n    const accountInfo = info.data.accountInfo;\r\n    if ('error' in accountInfo) return '0.00';\r\n\r\n    // Check if it's Bybit or BingX\r\n    if ('totalWalletBalance' in accountInfo) {\r\n      // Bybit\r\n      return accountInfo.totalWalletBalance || '0.00';\r\n    } else if ('balance' in accountInfo) {\r\n      // BingX\r\n      return accountInfo.balance.balance || '0.00';\r\n    }\r\n\r\n    return '0.00';\r\n  });\r\n\r\n  readonly unrealizedPnl = computed(() => {\r\n    const info = this.userInfo();\r\n    if (!info || !info.success) return 0;\r\n\r\n    const cred = this.credential();\r\n    if (cred.exchange === ExchangeType.BYBIT) {\r\n      return this.bybitUserService.calculateUnrealizedPnl(info as BybitUserInfo);\r\n    } else if (cred.exchange === ExchangeType.BINGX) {\r\n      return this.bingxUserService.calculateUnrealizedPnl(info as BingXUserInfo);\r\n    }\r\n\r\n    return 0;\r\n  });\r\n\r\n  readonly nonZeroBalances = computed(() => {\r\n    const info = this.userInfo();\r\n    if (!info) return [];\r\n\r\n    const cred = this.credential();\r\n    if (cred.exchange === ExchangeType.BYBIT) {\r\n      return this.bybitUserService.getNonZeroBalances(info as BybitUserInfo);\r\n    }\r\n\r\n    // BingX doesn't have coin balances in the same way, return empty\r\n    return [];\r\n  });\r\n\r\n  readonly activePositions = computed(() => {\r\n    const info = this.userInfo();\r\n    if (!info) return [];\r\n\r\n    const cred = this.credential();\r\n    if (cred.exchange === ExchangeType.BYBIT) {\r\n      return this.bybitUserService.getActivePositions(info as BybitUserInfo);\r\n    } else if (cred.exchange === ExchangeType.BINGX) {\r\n      return this.bingxUserService.getActivePositions(info as BingXUserInfo);\r\n    }\r\n\r\n    return [];\r\n  });\r\n\r\n  readonly activeOrders = computed(() => {\r\n    const info = this.userInfo();\r\n    if (!info || !info.success) return [];\r\n\r\n    // Bybit has activeOrders, BingX doesn't currently fetch orders\r\n    const data = info.data as any;\r\n    return data.activeOrders || [];\r\n  });\r\n\r\n  readonly hasError = computed(() => {\r\n    const info = this.userInfo();\r\n    if (!info) return false;\r\n\r\n    const accountInfo = info.data.accountInfo;\r\n    return 'error' in accountInfo;\r\n  });\r\n\r\n  readonly accountInfo = computed(() => {\r\n    const info = this.userInfo();\r\n    if (!info || !info.success) return null;\r\n\r\n    const accInfo = info.data.accountInfo;\r\n    if ('error' in accInfo) return null;\r\n\r\n    return accInfo;\r\n  });\r\n\r\n  constructor(\r\n    private bybitUserService: BybitUserService,\r\n    private bingxUserService: BingXUserService\r\n  ) {}\r\n\r\n  translate(key: string): string {\r\n    return this.translationService.translate(key);\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    // Load user info when modal opens\r\n    this.loadUserInfo();\r\n\r\n    // Add keyboard event listener for ESC key\r\n    document.addEventListener('keydown', this.handleKeyDown);\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.destroy$.next();\r\n    this.destroy$.complete();\r\n\r\n    // Remove keyboard event listener\r\n    document.removeEventListener('keydown', this.handleKeyDown);\r\n  }\r\n\r\n  /**\r\n   * Handle keyboard events\r\n   */\r\n  private handleKeyDown = (event: KeyboardEvent): void => {\r\n    if (event.key === 'Escape') {\r\n      this.close();\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Load user information from exchange\r\n   * Supports Bybit and BingX exchanges\r\n   */\r\n  loadUserInfo(): void {\r\n    const cred = this.credential();\r\n\r\n    this.loading.set(true);\r\n    this.error.set(null);\r\n\r\n    if (cred.exchange === ExchangeType.BYBIT) {\r\n      // Subscribe to Bybit service observables\r\n      this.bybitUserService.userInfo$\r\n        .pipe(takeUntil(this.destroy$))\r\n        .subscribe(info => this.userInfo.set(info));\r\n\r\n      this.bybitUserService.error$\r\n        .pipe(takeUntil(this.destroy$))\r\n        .subscribe(error => this.error.set(error));\r\n\r\n      // Fetch Bybit user info\r\n      this.bybitUserService.getUserInfo().subscribe({\r\n        next: () => {\r\n          this.loading.set(false);\r\n        },\r\n        error: (err) => {\r\n          this.loading.set(false);\r\n          console.error('Failed to load Bybit user info:', err);\r\n        }\r\n      });\r\n    } else if (cred.exchange === ExchangeType.BINGX) {\r\n      // Subscribe to BingX service observables\r\n      this.bingxUserService.userInfo$\r\n        .pipe(takeUntil(this.destroy$))\r\n        .subscribe(info => this.userInfo.set(info));\r\n\r\n      this.bingxUserService.error$\r\n        .pipe(takeUntil(this.destroy$))\r\n        .subscribe(error => this.error.set(error));\r\n\r\n      // Fetch BingX user info (uses active credentials from backend)\r\n      this.bingxUserService.getUserInfo().subscribe({\r\n        next: () => {\r\n          this.loading.set(false);\r\n        },\r\n        error: (err) => {\r\n          this.loading.set(false);\r\n          console.error('Failed to load BingX user info:', err);\r\n        }\r\n      });\r\n    } else {\r\n      this.error.set(`Exchange ${cred.exchange} is not yet supported`);\r\n      this.loading.set(false);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Refresh user information\r\n   */\r\n  refreshUserInfo(): void {\r\n    this.loadUserInfo();\r\n  }\r\n\r\n  /**\r\n   * Change active tab\r\n   */\r\n  setActiveTab(tabId: string): void {\r\n    this.activeTab.set(tabId);\r\n  }\r\n\r\n  /**\r\n   * Close modal\r\n   */\r\n  close(): void {\r\n    this.closeModal.emit();\r\n  }\r\n\r\n  /**\r\n   * Handle overlay click (close modal)\r\n   */\r\n  handleOverlayClick(): void {\r\n    this.close();\r\n  }\r\n\r\n  /**\r\n   * Stop event propagation (prevent closing when clicking modal content)\r\n   */\r\n  handleContentClick(event: Event): void {\r\n    event.stopPropagation();\r\n  }\r\n\r\n  /**\r\n   * Parse float helper for templates\r\n   */\r\n  parseFloat(value: string): number {\r\n    return parseFloat(value);\r\n  }\r\n\r\n  /**\r\n   * Format large numbers with proper units (K, M, B)\r\n   */\r\n  formatNumber(value: string | number): string {\r\n    const num = typeof value === 'string' ? parseFloat(value) : value;\r\n\r\n    if (isNaN(num)) return '0';\r\n\r\n    const absNum = Math.abs(num);\r\n\r\n    if (absNum >= 1000000000) {\r\n      return (num / 1000000000).toFixed(2) + 'B';\r\n    } else if (absNum >= 1000000) {\r\n      return (num / 1000000).toFixed(2) + 'M';\r\n    } else if (absNum >= 1000) {\r\n      return (num / 1000).toFixed(2) + 'K';\r\n    } else {\r\n      return num.toFixed(2);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Format currency with proper decimals\r\n   */\r\n  formatCurrency(value: string | number, decimals = 2): string {\r\n    const num = typeof value === 'string' ? parseFloat(value) : value;\r\n\r\n    if (isNaN(num)) return '0.00';\r\n\r\n    return num.toFixed(decimals);\r\n  }\r\n\r\n  /**\r\n   * Format percentage\r\n   */\r\n  formatPercentage(value: string | number): string {\r\n    const num = typeof value === 'string' ? parseFloat(value) : value;\r\n\r\n    if (isNaN(num)) return '0.00%';\r\n\r\n    return (num * 100).toFixed(2) + '%';\r\n  }\r\n\r\n  /**\r\n   * Get position PnL color class\r\n   */\r\n  getPnlColorClass(pnl: string | number): string {\r\n    const num = typeof pnl === 'string' ? parseFloat(pnl) : pnl;\r\n\r\n    if (isNaN(num) || num === 0) return 'text-muted';\r\n    return num > 0 ? 'text-success' : 'text-danger';\r\n  }\r\n\r\n  /**\r\n   * Get order status badge class\r\n   */\r\n  getOrderStatusClass(status: string): string {\r\n    const statusClasses: Record<string, string> = {\r\n      'Filled': 'badge-success',\r\n      'PartiallyFilled': 'badge-info',\r\n      'Cancelled': 'badge-secondary',\r\n      'Rejected': 'badge-danger',\r\n      'New': 'badge-primary',\r\n      'PendingCancel': 'badge-warning'\r\n    };\r\n\r\n    return statusClasses[status] || 'badge-secondary';\r\n  }\r\n\r\n  /**\r\n   * Get side badge class (Buy/Sell)\r\n   */\r\n  getSideClass(side: string): string {\r\n    return side === 'Buy' ? 'badge-success' : 'badge-danger';\r\n  }\r\n\r\n  /**\r\n   * Calculate position profit percentage\r\n   */\r\n  calculatePositionProfitPct(position: BybitPosition | BingXPosition): number {\r\n    // Bybit position\r\n    if ('side' in position && 'entryPrice' in position && 'markPrice' in position) {\r\n      const entryPrice = parseFloat(position.entryPrice);\r\n      const markPrice = parseFloat(position.markPrice);\r\n\r\n      if (isNaN(entryPrice) || isNaN(markPrice) || entryPrice === 0) {\r\n        return 0;\r\n      }\r\n\r\n      const pct = ((markPrice - entryPrice) / entryPrice) * 100;\r\n      return position.side === 'Buy' ? pct : -pct;\r\n    }\r\n\r\n    // BingX position\r\n    if ('positionSide' in position && 'entryPrice' in position && 'markPrice' in position) {\r\n      const entryPrice = parseFloat(position.entryPrice);\r\n      const markPrice = parseFloat(position.markPrice);\r\n\r\n      if (isNaN(entryPrice) || isNaN(markPrice) || entryPrice === 0) {\r\n        return 0;\r\n      }\r\n\r\n      const pct = ((markPrice - entryPrice) / entryPrice) * 100;\r\n      return position.positionSide === 'LONG' ? pct : -pct;\r\n    }\r\n\r\n    return 0;\r\n  }\r\n\r\n  /**\r\n   * Get position side for display (handles both Bybit and BingX)\r\n   */\r\n  getPositionSide(position: BybitPosition | BingXPosition): string {\r\n    if ('side' in position) {\r\n      return position.side; // Bybit: 'Buy' or 'Sell'\r\n    }\r\n    if ('positionSide' in position) {\r\n      return position.positionSide; // BingX: 'LONG' or 'SHORT'\r\n    }\r\n    return '';\r\n  }\r\n\r\n  /**\r\n   * Get position size for display (handles both Bybit and BingX)\r\n   */\r\n  getPositionSize(position: BybitPosition | BingXPosition): string {\r\n    if ('size' in position) {\r\n      return position.size; // Bybit\r\n    }\r\n    if ('positionAmt' in position) {\r\n      return position.positionAmt; // BingX\r\n    }\r\n    return '0';\r\n  }\r\n\r\n  /**\r\n   * Get position unrealized PnL (handles both Bybit and BingX)\r\n   */\r\n  getPositionUnrealizedPnl(position: BybitPosition | BingXPosition): string {\r\n    if ('unrealisedPnl' in position) {\r\n      return position.unrealisedPnl; // Bybit\r\n    }\r\n    if ('unrealizedProfit' in position) {\r\n      return position.unrealizedProfit; // BingX\r\n    }\r\n    return '0';\r\n  }\r\n\r\n  /**\r\n   * Get account field value (handles both Bybit and BingX)\r\n   */\r\n  getAccountField(field: string): string {\r\n    const info = this.accountInfo();\r\n    if (!info) return '0.00';\r\n\r\n    // Bybit fields\r\n    if (field === 'totalEquity' && 'totalEquity' in info) {\r\n      return info.totalEquity || '0.00';\r\n    }\r\n    if (field === 'totalWalletBalance' && 'totalWalletBalance' in info) {\r\n      return info.totalWalletBalance || '0.00';\r\n    }\r\n    if (field === 'totalAvailableBalance' && 'totalAvailableBalance' in info) {\r\n      return info.totalAvailableBalance || '0.00';\r\n    }\r\n    if (field === 'totalMarginBalance' && 'totalMarginBalance' in info) {\r\n      return info.totalMarginBalance || '0.00';\r\n    }\r\n    if (field === 'totalInitialMargin' && 'totalInitialMargin' in info) {\r\n      return info.totalInitialMargin || '0.00';\r\n    }\r\n    if (field === 'totalPerpUPL' && 'totalPerpUPL' in info) {\r\n      return info.totalPerpUPL || '0.00';\r\n    }\r\n\r\n    // BingX fields\r\n    if ('balance' in info) {\r\n      const balance = info.balance;\r\n      if (field === 'totalEquity') return balance.equity || '0.00';\r\n      if (field === 'totalWalletBalance') return balance.balance || '0.00';\r\n      if (field === 'totalAvailableBalance') return balance.availableMargin || '0.00';\r\n      if (field === 'totalMarginBalance') return balance.usedMargin || '0.00';\r\n      if (field === 'totalInitialMargin') return balance.usedMargin || '0.00';\r\n      if (field === 'totalPerpUPL') return balance.unrealizedProfit || '0.00';\r\n    }\r\n\r\n    return '0.00';\r\n  }\r\n\r\n  /**\r\n   * Clear error message\r\n   */\r\n  clearError(): void {\r\n    this.error.set(null);\r\n  }\r\n\r\n  /**\r\n   * Retry loading after error\r\n   */\r\n  retryLoad(): void {\r\n    this.clearError();\r\n    this.loadUserInfo();\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\trading\\active-positions\\active-positions.component.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":121,"column":30,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":121,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":212,"column":50,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":212,"endColumn":57}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Active Price Arbitrage Positions Component\r\n *\r\n * Displays and manages active price arbitrage positions across exchanges.\r\n * Features:\r\n * - Real-time position monitoring\r\n * - Unrealized P&L calculations\r\n * - Position close functionality\r\n * - Status filtering\r\n * - Responsive table layout\r\n */\r\n\r\nimport { Component, OnInit, OnDestroy, inject, signal, computed } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { interval, Subscription } from 'rxjs';\r\nimport { switchMap } from 'rxjs/operators';\r\n\r\nimport { PriceArbitrageService } from '../../../services/price-arbitrage.service';\r\nimport { TranslationService } from '../../../services/translation.service';\r\nimport {\r\n  PriceArbitragePositionDTO,\r\n  PriceArbitrageStatus,\r\n  calculateHoldingTime,\r\n  formatPnlDisplay\r\n} from '../../../models/price-arbitrage.model';\r\n\r\nimport { CardComponent, CardHeaderComponent, CardTitleComponent, CardContentComponent } from '../../ui/card/card.component';\r\nimport { ButtonComponent } from '../../ui/button/button.component';\r\nimport { DialogComponent, DialogHeaderComponent, DialogTitleComponent, DialogContentComponent, DialogFooterComponent } from '../../ui/dialog/dialog.component';\r\n\r\n@Component({\r\n  selector: 'app-active-positions',\r\n  standalone: true,\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    CardComponent,\r\n    CardHeaderComponent,\r\n    CardTitleComponent,\r\n    CardContentComponent,\r\n    ButtonComponent,\r\n    DialogComponent,\r\n    DialogHeaderComponent,\r\n    DialogTitleComponent,\r\n    DialogContentComponent,\r\n    DialogFooterComponent\r\n  ],\r\n  templateUrl: './active-positions.component.html',\r\n  styleUrl: './active-positions.component.scss'\r\n})\r\nexport class ActivePositionsComponent implements OnInit, OnDestroy {\r\n  private priceArbitrageService = inject(PriceArbitrageService);\r\n  private translationService = inject(TranslationService);\r\n\r\n  // State signals\r\n  positions = signal<PriceArbitragePositionDTO[]>([]);\r\n  isLoading = signal<boolean>(false);\r\n  error = signal<string | null>(null);\r\n  selectedStatus = signal<'ALL' | PriceArbitrageStatus>(PriceArbitrageStatus.ACTIVE);\r\n\r\n  // Close confirmation dialog\r\n  showCloseDialog = signal<boolean>(false);\r\n  positionToClose = signal<PriceArbitragePositionDTO | null>(null);\r\n  isClosing = signal<boolean>(false);\r\n\r\n  // Auto-refresh subscription\r\n  private refreshSubscription?: Subscription;\r\n  private readonly REFRESH_INTERVAL = 5000; // 5 seconds\r\n\r\n  // Computed properties\r\n  filteredPositions = computed(() => {\r\n    const status = this.selectedStatus();\r\n    const allPositions = this.positions();\r\n\r\n    if (status === 'ALL') {\r\n      return allPositions;\r\n    }\r\n\r\n    return allPositions.filter(p => p.status === status);\r\n  });\r\n\r\n  activeCount = computed(() =>\r\n    this.positions().filter(p => p.status === PriceArbitrageStatus.ACTIVE).length\r\n  );\r\n\r\n  completedCount = computed(() =>\r\n    this.positions().filter(p => p.status === PriceArbitrageStatus.COMPLETED).length\r\n  );\r\n\r\n  errorCount = computed(() =>\r\n    this.positions().filter(p => p.status === PriceArbitrageStatus.ERROR).length\r\n  );\r\n\r\n  ngOnInit(): void {\r\n    this.loadPositions();\r\n    this.startAutoRefresh();\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.stopAutoRefresh();\r\n  }\r\n\r\n  /**\r\n   * Load positions from API\r\n   */\r\n  loadPositions(): void {\r\n    this.isLoading.set(true);\r\n    this.error.set(null);\r\n\r\n    const status = this.selectedStatus() === 'ALL' ? undefined : this.selectedStatus();\r\n\r\n    this.priceArbitrageService.getPositions(status as PriceArbitrageStatus | undefined)\r\n      .subscribe({\r\n        next: (positions) => {\r\n          this.positions.set(positions);\r\n          this.isLoading.set(false);\r\n        },\r\n        error: (err) => {\r\n          console.error('Error loading positions:', err);\r\n          this.error.set(err.message || 'Failed to load positions');\r\n          this.isLoading.set(false);\r\n        }\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Start auto-refresh interval\r\n   */\r\n  private startAutoRefresh(): void {\r\n    this.refreshSubscription = interval(this.REFRESH_INTERVAL)\r\n      .pipe(\r\n        switchMap(() => {\r\n          const status = this.selectedStatus() === 'ALL' ? undefined : this.selectedStatus();\r\n          return this.priceArbitrageService.getPositions(status as PriceArbitrageStatus | undefined);\r\n        })\r\n      )\r\n      .subscribe({\r\n        next: (positions) => {\r\n          this.positions.set(positions);\r\n        },\r\n        error: (err) => {\r\n          console.error('Error refreshing positions:', err);\r\n        }\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Stop auto-refresh\r\n   */\r\n  private stopAutoRefresh(): void {\r\n    if (this.refreshSubscription) {\r\n      this.refreshSubscription.unsubscribe();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Change status filter\r\n   */\r\n  changeStatusFilter(status: 'ALL' | PriceArbitrageStatus): void {\r\n    this.selectedStatus.set(status);\r\n    this.loadPositions();\r\n  }\r\n\r\n  /**\r\n   * Open close confirmation dialog\r\n   */\r\n  openCloseDialog(position: PriceArbitragePositionDTO): void {\r\n    this.positionToClose.set(position);\r\n    this.showCloseDialog.set(true);\r\n  }\r\n\r\n  /**\r\n   * Cancel close dialog\r\n   */\r\n  cancelClose(): void {\r\n    this.showCloseDialog.set(false);\r\n    this.positionToClose.set(null);\r\n  }\r\n\r\n  /**\r\n   * Confirm and close position\r\n   */\r\n  confirmClose(): void {\r\n    const position = this.positionToClose();\r\n    if (!position) return;\r\n\r\n    this.isClosing.set(true);\r\n\r\n    this.priceArbitrageService.closePosition(position.id)\r\n      .subscribe({\r\n        next: (result) => {\r\n          console.log('Position closed successfully:', result);\r\n\r\n          // Update the position in the list\r\n          const updatedPositions = this.positions().map(p =>\r\n            p.id === position.id ? result.position : p\r\n          );\r\n          this.positions.set(updatedPositions);\r\n\r\n          // Close dialog\r\n          this.showCloseDialog.set(false);\r\n          this.positionToClose.set(null);\r\n          this.isClosing.set(false);\r\n\r\n          // Show success notification (you can implement toast notifications)\r\n          alert(`Position closed successfully! Total P&L: $${result.totalPnl.toFixed(2)}`);\r\n        },\r\n        error: (err) => {\r\n          console.error('Error closing position:', err);\r\n          this.isClosing.set(false);\r\n          alert(`Failed to close position: ${err.message}`);\r\n        }\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Calculate unrealized P&L for display\r\n   */\r\n  getUnrealizedPnl(position: PriceArbitragePositionDTO): number {\r\n    return this.priceArbitrageService.calculateUnrealizedPnl(position);\r\n  }\r\n\r\n  /**\r\n   * Get P&L display with color coding\r\n   */\r\n  getPnlDisplay(position: PriceArbitragePositionDTO) {\r\n    const pnl = this.getUnrealizedPnl(position);\r\n    return formatPnlDisplay(pnl);\r\n  }\r\n\r\n  /**\r\n   * Get holding time display\r\n   */\r\n  getHoldingTimeDisplay(position: PriceArbitragePositionDTO): string {\r\n    if (!position.openedAt) return 'N/A';\r\n    return calculateHoldingTime(position.openedAt).formatted;\r\n  }\r\n\r\n  /**\r\n   * Get current spread display\r\n   */\r\n  getCurrentSpreadDisplay(position: PriceArbitragePositionDTO): string {\r\n    if (position.currentSpreadPercent !== undefined) {\r\n      return `${position.currentSpreadPercent.toFixed(4)}%`;\r\n    }\r\n    return 'N/A';\r\n  }\r\n\r\n  /**\r\n   * Get entry spread display\r\n   */\r\n  getEntrySpreadDisplay(position: PriceArbitragePositionDTO): string {\r\n    return `${position.entrySpreadPercent.toFixed(4)}%`;\r\n  }\r\n\r\n  /**\r\n   * Get status badge class\r\n   */\r\n  getStatusClass(status: PriceArbitrageStatus): string {\r\n    switch (status) {\r\n      case PriceArbitrageStatus.ACTIVE:\r\n        return 'status-active';\r\n      case PriceArbitrageStatus.COMPLETED:\r\n        return 'status-completed';\r\n      case PriceArbitrageStatus.ERROR:\r\n        return 'status-error';\r\n      case PriceArbitrageStatus.PENDING:\r\n        return 'status-pending';\r\n      case PriceArbitrageStatus.CANCELLED:\r\n        return 'status-cancelled';\r\n      default:\r\n        return 'status-unknown';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Translation helper\r\n   */\r\n  translate(key: string): string {\r\n    return this.translationService.translate(key);\r\n  }\r\n\r\n  /**\r\n   * Format price for display\r\n   */\r\n  formatPrice(price: number): string {\r\n    return `$${price.toFixed(2)}`;\r\n  }\r\n\r\n  /**\r\n   * Format P&L for display\r\n   */\r\n  formatPnl(pnl: number | undefined): string {\r\n    if (pnl === undefined || pnl === null) return 'N/A';\r\n    const sign = pnl >= 0 ? '+' : '';\r\n    return `${sign}$${pnl.toFixed(2)}`;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\trading\\arbitrage-chart\\arbitrage-chart.component.html","messages":[{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":482,"column":19,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":482,"endColumn":57},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":496,"column":19,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":496,"endColumn":73},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":510,"column":19,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":510,"endColumn":134},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":512,"column":19,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":512,"endColumn":95},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":561,"column":19,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":563,"endColumn":27},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":575,"column":19,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":577,"endColumn":27},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":590,"column":19,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":590,"endColumn":65},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":602,"column":19,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":602,"endColumn":71},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":657,"column":17,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":657,"endColumn":55},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":671,"column":17,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":671,"endColumn":71},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":684,"column":19,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":684,"endColumn":132},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":686,"column":19,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":686,"endColumn":95},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":733,"column":17,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":733,"endColumn":63},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":745,"column":17,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":745,"endColumn":69}],"suppressedMessages":[],"errorCount":14,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<div class=\"arbitrage-chart-container\">\r\n  <!-- Header -->\r\n  <div class=\"chart-header\">\r\n    <div class=\"header-content\">\r\n      <button class=\"back-button\" (click)=\"goBack()\">\r\n        ‚Üê Back\r\n      </button>\r\n      <h1 class=\"chart-title\">\r\n        {{ symbol() }} Arbitrage Chart\r\n      </h1>\r\n    </div>\r\n  </div>\r\n\r\n  <!-- Loading State -->\r\n  @if (loading()) {\r\n    <div class=\"loading-container\">\r\n      <div class=\"loading-spinner\"></div>\r\n      <p>Loading chart data...</p>\r\n    </div>\r\n  } @else {\r\n    <!-- Historical Data Loading Indicator -->\r\n    @if (loadingHistoricalData()) {\r\n      <div class=\"historical-data-loading\">\r\n        <div class=\"loading-spinner-small\"></div>\r\n        <span>Loading historical data...</span>\r\n      </div>\r\n    }\r\n    <!-- Main Content Layout: Chart (2/3) + Info Panel (1/3) -->\r\n    <div class=\"main-content\">\r\n      <!-- Left Side: Chart (2/3 width) -->\r\n      <div class=\"chart-section\">\r\n        <div class=\"chart-card\">\r\n          <div class=\"chart-card-header\">\r\n            <div class=\"header-left\">\r\n              <div class=\"spread-badges\">\r\n                <div class=\"spread-badge price-spread\"\r\n                     [class.favorable]=\"getPriceSpreadClass() === 'favorable'\"\r\n                     [class.unfavorable]=\"getPriceSpreadClass() === 'unfavorable'\">\r\n                  Price Spread: {{ spreadPercent() }}%\r\n                </div>\r\n                <div class=\"spread-badge funding-spread\"\r\n                     [class.positive]=\"fundingSpread() > 0\"\r\n                     [class.negative]=\"fundingSpread() < 0\">\r\n                  Funding Spread: {{ formatFundingSpread() }}\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div class=\"header-right\">\r\n              <button\r\n                class=\"fit-content-btn\"\r\n                (click)=\"fitContent()\"\r\n                title=\"Fit chart to show all data\">\r\n                <span>üìä</span> Fit\r\n              </button>\r\n              <div class=\"timeframe-selector\">\r\n                <button\r\n                  *ngFor=\"let tf of timeframeOptions\"\r\n                  class=\"timeframe-btn\"\r\n                  [class.active]=\"selectedTimeframe() === tf.value\"\r\n                  (click)=\"changeTimeframe(tf.value)\">\r\n                  {{ tf.label }}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div #chartContainer class=\"chart-container\"></div>\r\n        </div>\r\n\r\n        <!-- Active Positions Table -->\r\n        <div class=\"active-positions-section\">\r\n          <div class=\"section-header\">\r\n            <h2>Active Arbitrage Positions</h2>\r\n            <span class=\"positions-count\">{{ filteredActivePositions().length }} position(s)</span>\r\n          </div>\r\n\r\n          @if (filteredActivePositions().length === 0) {\r\n            <div class=\"no-positions\">\r\n              <span class=\"icon\">üìä</span>\r\n              <p>No active arbitrage positions</p>\r\n              <small>Start a position using the form above</small>\r\n            </div>\r\n          } @else {\r\n            <div class=\"positions-table-container\">\r\n              <table class=\"positions-table\">\r\n                <thead>\r\n                  <tr>\r\n                    <th>Position ID</th>\r\n                    <th>Symbol</th>\r\n                    <th>Primary Exchange</th>\r\n                    <th>Hedge Exchange</th>\r\n                    <th>Status</th>\r\n                    <th>Started At</th>\r\n                    <th>Actions</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  @for (position of filteredActivePositions(); track position.positionId) {\r\n                    <!-- Main Row (clickable) -->\r\n                    <tr class=\"position-row\" [class.expanded]=\"isRowExpanded(position.positionId)\" (click)=\"toggleRowExpansion(position.positionId)\">\r\n                      <td class=\"position-id\">\r\n                        <span class=\"expand-icon\">{{ isRowExpanded(position.positionId) ? '‚ñº' : '‚ñ∂' }}</span>\r\n                        {{ position.positionId }}\r\n                      </td>\r\n                      <td class=\"symbol\">{{ position.symbol }}</td>\r\n                      <td class=\"exchange\">\r\n                        <div class=\"exchange-cell\">\r\n                          <span class=\"exchange-name\">{{ position.primary.exchange }}</span>\r\n                          <span class=\"side-badge\" [class.long]=\"position.primary.side === 'long'\" [class.short]=\"position.primary.side === 'short'\">\r\n                            {{ position.primary.side }}\r\n                          </span>\r\n                          <span class=\"leverage\">{{ position.primary.leverage }}x</span>\r\n                        </div>\r\n                      </td>\r\n                      <td class=\"exchange\">\r\n                        <div class=\"exchange-cell\">\r\n                          <span class=\"exchange-name\">{{ position.hedge.exchange }}</span>\r\n                          <span class=\"side-badge\" [class.long]=\"position.hedge.side === 'long'\" [class.short]=\"position.hedge.side === 'short'\">\r\n                            {{ position.hedge.side }}\r\n                          </span>\r\n                          <span class=\"leverage\">{{ position.hedge.leverage }}x</span>\r\n                        </div>\r\n                      </td>\r\n                      <td class=\"status\">\r\n                        <span class=\"status-badge\" [ngClass]=\"getStatusBadge(position.status).class\">\r\n                          {{ getStatusBadge(position.status).label }}\r\n                        </span>\r\n                      </td>\r\n                      <td class=\"timestamp\">{{ formatTimestamp(position.startedAt) }}</td>\r\n                      <td class=\"actions\">\r\n                        <button class=\"tpsl-button\" (click)=\"syncTpSl(position.positionId); $event.stopPropagation()\" title=\"Set synchronized TP/SL\">\r\n                          TP/SL\r\n                        </button>\r\n                        <button\r\n                          [class.monitoring-enabled]=\"position.monitoring?.enabled\"\r\n                          [class.monitoring-disabled]=\"!position.monitoring?.enabled\"\r\n                          (click)=\"toggleMonitoring(position); $event.stopPropagation()\"\r\n                          [title]=\"position.monitoring?.enabled ? 'Monitoring Active (click to disable)' : 'Monitoring Disabled (click to enable)'\">\r\n                          {{ position.monitoring?.enabled ? 'üëÅÔ∏è ON' : 'üëÅÔ∏è OFF' }}\r\n                        </button>\r\n                        <button class=\"stop-button\" (click)=\"stopPosition(position.positionId); $event.stopPropagation()\">\r\n                          Stop\r\n                        </button>\r\n                      </td>\r\n                    </tr>\r\n\r\n                    <!-- Expanded Details Row -->\r\n                    @if (isRowExpanded(position.positionId)) {\r\n                      <tr class=\"expanded-row\">\r\n                        <td colspan=\"7\">\r\n                          <div class=\"position-details\">\r\n                            <table class=\"details-table\">\r\n                              <thead>\r\n                                <tr>\r\n                                  <th>Metric</th>\r\n                                  <th>Primary ({{ position.primary.exchange }})</th>\r\n                                  <th>Hedge ({{ position.hedge.exchange }})</th>\r\n                                </tr>\r\n                              </thead>\r\n                              <tbody>\r\n                                <tr>\r\n                                  <td class=\"metric-label\">Entry Price</td>\r\n                                  <td class=\"metric-value\">{{ position.primary.entryPrice ? (position.primary.entryPrice | number:'1.2-6') : 'N/A' }}</td>\r\n                                  <td class=\"metric-value\">{{ position.hedge.entryPrice ? (position.hedge.entryPrice | number:'1.2-6') : 'N/A' }}</td>\r\n                                </tr>\r\n                                @if (position.primary.unrealizedProfit !== undefined || position.hedge.unrealizedProfit !== undefined) {\r\n                                  <tr>\r\n                                    <td class=\"metric-label\">Unrealized P&L</td>\r\n                                    <td class=\"metric-value\"\r\n                                        [class.positive]=\"(position.primary.unrealizedProfit || 0) > 0\"\r\n                                        [class.negative]=\"(position.primary.unrealizedProfit || 0) < 0\">\r\n                                      {{ formatCurrency(position.primary.unrealizedProfit) }} USDT\r\n                                    </td>\r\n                                    <td class=\"metric-value\"\r\n                                        [class.positive]=\"(position.hedge.unrealizedProfit || 0) > 0\"\r\n                                        [class.negative]=\"(position.hedge.unrealizedProfit || 0) < 0\">\r\n                                      {{ formatCurrency(position.hedge.unrealizedProfit) }} USDT\r\n                                    </td>\r\n                                  </tr>\r\n                                }\r\n                                @if (position.primary.realizedProfit !== undefined || position.hedge.realizedProfit !== undefined) {\r\n                                  <tr>\r\n                                    <td class=\"metric-label\">Realized P&L</td>\r\n                                    <td class=\"metric-value\"\r\n                                        [class.positive]=\"(position.primary.realizedProfit || 0) > 0\"\r\n                                        [class.negative]=\"(position.primary.realizedProfit || 0) < 0\">\r\n                                      {{ formatCurrency(position.primary.realizedProfit) }} USDT\r\n                                    </td>\r\n                                    <td class=\"metric-value\"\r\n                                        [class.positive]=\"(position.hedge.realizedProfit || 0) > 0\"\r\n                                        [class.negative]=\"(position.hedge.realizedProfit || 0) < 0\">\r\n                                      {{ formatCurrency(position.hedge.realizedProfit) }} USDT\r\n                                    </td>\r\n                                  </tr>\r\n                                }\r\n                                @if (position.primary.liquidationPrice || position.hedge.liquidationPrice) {\r\n                                  <tr>\r\n                                    <td class=\"metric-label\">Liquidation Price</td>\r\n                                    <td class=\"metric-value\">{{ position.primary.liquidationPrice ? (position.primary.liquidationPrice | number:'1.2-6') : 'N/A' }}</td>\r\n                                    <td class=\"metric-value\">{{ position.hedge.liquidationPrice ? (position.hedge.liquidationPrice | number:'1.2-6') : 'N/A' }}</td>\r\n                                  </tr>\r\n                                }\r\n                                @if (position.primary.proximityRatio !== undefined && position.primary.proximityRatio !== null || position.hedge.proximityRatio !== undefined && position.hedge.proximityRatio !== null) {\r\n                                  <tr>\r\n                                    <td class=\"metric-label\">Liquidation Proximity</td>\r\n                                    <td class=\"metric-value\">\r\n                                      @if (position.primary.proximityRatio !== undefined && position.primary.proximityRatio !== null) {\r\n                                        <span class=\"proximity-value\"\r\n                                              [class.proximity-safe]=\"position.primary.proximityRatio < 0.7\"\r\n                                              [class.proximity-warning]=\"position.primary.proximityRatio >= 0.7 && position.primary.proximityRatio < 0.9\"\r\n                                              [class.proximity-danger]=\"position.primary.proximityRatio >= 0.9\">\r\n                                          {{ (position.primary.proximityRatio * 100) | number:'1.1-1' }}%\r\n                                          @if (position.primary.inDanger) {\r\n                                            <span class=\"danger-badge\">DANGER</span>\r\n                                          }\r\n                                        </span>\r\n                                      } @else {\r\n                                        N/A\r\n                                      }\r\n                                    </td>\r\n                                    <td class=\"metric-value\">\r\n                                      @if (position.hedge.proximityRatio !== undefined && position.hedge.proximityRatio !== null) {\r\n                                        <span class=\"proximity-value\"\r\n                                              [class.proximity-safe]=\"position.hedge.proximityRatio < 0.7\"\r\n                                              [class.proximity-warning]=\"position.hedge.proximityRatio >= 0.7 && position.hedge.proximityRatio < 0.9\"\r\n                                              [class.proximity-danger]=\"position.hedge.proximityRatio >= 0.9\">\r\n                                          {{ (position.hedge.proximityRatio * 100) | number:'1.1-1' }}%\r\n                                          @if (position.hedge.inDanger) {\r\n                                            <span class=\"danger-badge\">DANGER</span>\r\n                                          }\r\n                                        </span>\r\n                                      } @else {\r\n                                        N/A\r\n                                      }\r\n                                    </td>\r\n                                  </tr>\r\n                                }\r\n                                @if (position.primary.stopLoss || position.hedge.stopLoss) {\r\n                                  <tr>\r\n                                    <td class=\"metric-label\">Stop Loss</td>\r\n                                    <td class=\"metric-value\">{{ position.primary.stopLoss ? (position.primary.stopLoss | number:'1.2-6') : 'N/A' }}</td>\r\n                                    <td class=\"metric-value\">{{ position.hedge.stopLoss ? (position.hedge.stopLoss | number:'1.2-6') : 'N/A' }}</td>\r\n                                  </tr>\r\n                                }\r\n                                @if (position.primary.takeProfit || position.hedge.takeProfit) {\r\n                                  <tr>\r\n                                    <td class=\"metric-label\">Take Profit</td>\r\n                                    <td class=\"metric-value\">{{ position.primary.takeProfit ? (position.primary.takeProfit | number:'1.2-6') : 'N/A' }}</td>\r\n                                    <td class=\"metric-value\">{{ position.hedge.takeProfit ? (position.hedge.takeProfit | number:'1.2-6') : 'N/A' }}</td>\r\n                                  </tr>\r\n                                }\r\n                                <tr>\r\n                                  <td class=\"metric-label\">Last Funding Paid</td>\r\n                                  <td class=\"metric-value\">{{ formatCurrency(position.primary.lastFundingPaid) }} USDT</td>\r\n                                  <td class=\"metric-value\">{{ formatCurrency(position.hedge.lastFundingPaid) }} USDT</td>\r\n                                </tr>\r\n                                <tr>\r\n                                  <td class=\"metric-label\">Total Funding Earned</td>\r\n                                  <td class=\"metric-value positive\">{{ formatCurrency(position.primary.totalFundingEarned) }} USDT</td>\r\n                                  <td class=\"metric-value positive\">{{ formatCurrency(position.hedge.totalFundingEarned) }} USDT</td>\r\n                                </tr>\r\n                                <tr>\r\n                                  <td class=\"metric-label\">Entry Fees (Paid)</td>\r\n                                  <td class=\"metric-value negative\">{{ formatCurrency(position.primary.tradingFees) }} USDT</td>\r\n                                  <td class=\"metric-value negative\">{{ formatCurrency(position.hedge.tradingFees) }} USDT</td>\r\n                                </tr>\r\n                                <tr class=\"summary-row\">\r\n                                  <td class=\"metric-label\">Gross Profit</td>\r\n                                  <td colspan=\"2\" class=\"metric-value gross-profit\">{{ formatCurrency(position.grossProfit) }} USDT</td>\r\n                                </tr>\r\n                                <tr class=\"summary-row\">\r\n                                  <td class=\"metric-label\">Net Profit</td>\r\n                                  <td colspan=\"2\" class=\"metric-value net-profit\" [class.positive]=\"(position.netProfit || 0) > 0\" [class.negative]=\"(position.netProfit || 0) < 0\">\r\n                                    {{ formatCurrency(position.netProfit) }} USDT\r\n                                  </td>\r\n                                </tr>\r\n                              </tbody>\r\n                            </table>\r\n\r\n                            <!-- Error Message Section for ERROR status -->\r\n                            @if (position.status === 'ERROR' && position.errorMessage) {\r\n                              <div class=\"error-message-section\">\r\n                                <div class=\"error-header\">\r\n                                  <span class=\"error-icon\">‚ö†Ô∏è</span>\r\n                                  <span class=\"error-title\">Position Failed - Troubleshooting Required</span>\r\n                                </div>\r\n                                <div class=\"error-content\">\r\n                                  <div class=\"error-details\">\r\n                                    <h4>Error Details:</h4>\r\n                                    <p class=\"error-text\">{{ position.errorMessage }}</p>\r\n                                  </div>\r\n\r\n                                  <div class=\"troubleshooting-section\">\r\n                                    <h4>How to Fix:</h4>\r\n                                    <ol class=\"fix-steps\">\r\n                                      <li>\r\n                                        <strong>Check Exchange Connectivity:</strong>\r\n                                        <ul>\r\n                                          <li>Verify your internet connection is stable</li>\r\n                                          <li>Check if {{ position.primary.exchange }} and {{ position.hedge.exchange }} APIs are operational</li>\r\n                                          <li>Look for \"fetch failed\" or timeout errors in browser console</li>\r\n                                        </ul>\r\n                                      </li>\r\n                                      <li>\r\n                                        <strong>Verify API Credentials:</strong>\r\n                                        <ul>\r\n                                          <li>Go to Profile ‚Üí Trading Platforms</li>\r\n                                          <li>Test connection for both exchanges</li>\r\n                                          <li>Check if API keys have required permissions (trading, reading positions)</li>\r\n                                        </ul>\r\n                                      </li>\r\n                                      <li>\r\n                                        <strong>Check Exchange Status:</strong>\r\n                                        <ul>\r\n                                          <li>Visit exchange websites to verify they're not under maintenance</li>\r\n                                          <li>Check if your IP is not rate-limited or blocked</li>\r\n                                        </ul>\r\n                                      </li>\r\n                                    </ol>\r\n                                  </div>\r\n\r\n                                  <div class=\"error-actions\">\r\n                                    <div class=\"status-info\">\r\n                                      <p class=\"warning-text\">\r\n                                        ‚ö†Ô∏è <strong>This position is partially filled.</strong> After fixing connectivity issues,\r\n                                        you should close this position to clean up partial orders on exchanges.\r\n                                      </p>\r\n                                    </div>\r\n                                    <button class=\"close-error-button\" (click)=\"stopPosition(position.positionId); $event.stopPropagation()\">\r\n                                      Close Position\r\n                                    </button>\r\n                                    <p class=\"error-help-text\">\r\n                                      The \"Close Position\" button will attempt to close any partial positions on exchanges and mark this as cancelled.\r\n                                    </p>\r\n                                  </div>\r\n                                </div>\r\n                              </div>\r\n                            }\r\n                          </div>\r\n                        </td>\r\n                      </tr>\r\n                    }\r\n                  }\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          }\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Right Side: Info Panel (1/3 width) -->\r\n      <div class=\"info-panel\">\r\n        <div class=\"exchange-info-grid\">\r\n          <div class=\"exchange-column primary-column\">\r\n            <button\r\n                class=\"column-header primary\"\r\n                (click)=\"openExchange(primaryExchange())\"\r\n                type=\"button\"\r\n                title=\"Open {{ primaryExchange() }} in new window\">\r\n              <div class=\"header-content-wrapper\">\r\n                <h3>{{ primaryExchange() }}</h3>\r\n                @if (strategy() === 'spot_futures') {\r\n                  <span class=\"market-type-badge spot\">\r\n                    <span class=\"badge-icon\">üõí</span>\r\n                    <span class=\"badge-text\">SPOT</span>\r\n                  </span>\r\n                }\r\n              </div>\r\n            </button>\r\n\r\n            <div class=\"info-items\">\r\n              @if (strategy() === 'combined') {\r\n                <div class=\"info-item\">\r\n                  <span class=\"info-label\">Funding</span>\r\n                  <span class=\"info-value text-sm\"\r\n                        [class.positive]=\"parseFloat(primaryData().fundingRate) > 0\"\r\n                        [class.negative]=\"parseFloat(primaryData().fundingRate) < 0\">\r\n                    {{ primaryFormattedFunding() }}\r\n                  </span>\r\n                </div>\r\n              }\r\n\r\n              <!-- Account Balance -->\r\n              <div class=\"info-item balance-item\">\r\n                <span class=\"info-label\">Account Balance</span>\r\n                @if (primaryBalance().loading) {\r\n                  <span class=\"info-value loading-balance\">\r\n                    <span class=\"balance-spinner\"></span>\r\n                    Loading...\r\n                  </span>\r\n                } @else {\r\n                  <div class=\"balance-values\">\r\n                    <div class=\"balance-row\">\r\n                      <span class=\"balance-label\">Total:</span>\r\n                      <span class=\"balance-value\">{{ primaryBalance().totalBalance }} USDT</span>\r\n                    </div>\r\n                    <div class=\"balance-row\">\r\n                      <span class=\"balance-label\">Available:</span>\r\n                      <span class=\"balance-value available\">{{ primaryBalance().availableBalance }} USDT</span>\r\n                    </div>\r\n                  </div>\r\n                }\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"sync-lock-container\"></div>\r\n          <div class=\"exchange-column hedge-column\">\r\n            <button\r\n                class=\"column-header hedge\"\r\n                (click)=\"openExchange(hedgeExchange())\"\r\n                type=\"button\"\r\n                title=\"Open {{ hedgeExchange() }} in new window\">\r\n              <div class=\"header-content-wrapper\">\r\n                <h3>{{ hedgeExchange() }}</h3>\r\n                @if (strategy() === 'spot_futures') {\r\n                  <span class=\"market-type-badge futures\">\r\n                    <span class=\"badge-icon\">üìà</span>\r\n                    <span class=\"badge-text\">FUTURES</span>\r\n                  </span>\r\n                }\r\n              </div>\r\n            </button>\r\n\r\n            <div class=\"info-items\">\r\n              <div class=\"info-item\">\r\n                <span class=\"info-label\">Funding</span>\r\n                <span class=\"info-value text-sm\"\r\n                      [class.positive]=\"parseFloat(hedgeData().fundingRate) > 0\"\r\n                      [class.negative]=\"parseFloat(hedgeData().fundingRate) < 0\">\r\n                  {{ hedgeFormattedFunding() }}\r\n                </span>\r\n              </div>\r\n\r\n              <!-- Account Balance -->\r\n              <div class=\"info-item balance-item\">\r\n                <span class=\"info-label\">Account Balance</span>\r\n                @if (hedgeBalance().loading) {\r\n                  <span class=\"info-value loading-balance\">\r\n                    <span class=\"balance-spinner\"></span>\r\n                    Loading...\r\n                  </span>\r\n                } @else {\r\n                  <div class=\"balance-values\">\r\n                    <div class=\"balance-row\">\r\n                      <span class=\"balance-label\">Total:</span>\r\n                      <span class=\"balance-value\">{{ hedgeBalance().totalBalance }} USDT</span>\r\n                    </div>\r\n                    <div class=\"balance-row\">\r\n                      <span class=\"balance-label\">Available:</span>\r\n                      <span class=\"balance-value available\">{{ hedgeBalance().availableBalance }} USDT</span>\r\n                    </div>\r\n                  </div>\r\n                }\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n        </div>\r\n        <div class=\"exchange-info-grid\">\r\n          <!-- Primary Exchange Column -->\r\n          <div class=\"exchange-column primary-column\">\r\n\r\n\r\n            <!-- Order Form for Primary Exchange -->\r\n            <form [formGroup]=\"primaryOrderForm\" class=\"order-form\">\r\n             <!-- <div class=\"form-header\">\r\n                <h4>Order Parameters</h4>\r\n              </div>-->\r\n\r\n              <!-- SPOT MARKET: No side selector, no leverage -->\r\n              @if (strategy() === 'spot_futures') {\r\n                <div class=\"form-field spot-market-info\">\r\n                  <div class=\"info-box\">\r\n                    <span class=\"info-icon\">‚ÑπÔ∏è</span>\r\n                    <span class=\"info-text\">Spot market: Buy asset directly (no leverage)</span>\r\n                  </div>\r\n                </div>\r\n              }\r\n\r\n              <!-- FUTURES MARKET: Show side selector and leverage -->\r\n              @if (strategy() === 'combined') {\r\n                <div class=\"form-field\">\r\n                  <label class=\"form-label\">Side</label>\r\n                  <div class=\"side-selector\">\r\n                    <label class=\"side-option\">\r\n                      <input type=\"radio\" formControlName=\"side\" value=\"long\">\r\n                      <span class=\"side-label long\">Long</span>\r\n                    </label>\r\n                    <label class=\"side-option\">\r\n                      <input type=\"radio\" formControlName=\"side\" value=\"short\">\r\n                      <span class=\"side-label short\">Short</span>\r\n                    </label>\r\n                  </div>\r\n                </div>\r\n\r\n                <div class=\"form-field\">\r\n                  <label class=\"form-label\">Leverage (1x - 125x)</label>\r\n                  <input\r\n                    type=\"number\"\r\n                    formControlName=\"leverage\"\r\n                    class=\"form-input\"\r\n                    placeholder=\"10\"\r\n                    min=\"1\"\r\n                    max=\"125\"\r\n                    step=\"1\">\r\n                </div>\r\n              }\r\n\r\n              <div class=\"form-field\">\r\n                @if (primarySymbolInfo()) {\r\n                  <label class=\"form-label\">Quantity (min: {{ primarySymbolInfo()!.minOrderQty }}{{ getCoinSymbol() }}/order)</label>\r\n                } @else {\r\n                  <label class=\"form-label\">Quantity (min: 0.001{{ getCoinSymbol() }})</label>\r\n                }\r\n                <div class=\"quantity-input-wrapper\" [class.error]=\"!primaryValidation().valid && primaryOrderForm.get('quantity')?.touched\">\r\n                  <input\r\n                    type=\"number\"\r\n                    formControlName=\"quantity\"\r\n                    class=\"form-input quantity-input\"\r\n                    placeholder=\"0.001\"\r\n                    min=\"0.001\"\r\n                    step=\"0.001\">\r\n                  <div class=\"quantity-unit-dropdown\">\r\n                    <button\r\n                      type=\"button\"\r\n                      class=\"quantity-unit-trigger\"\r\n                      (click)=\"togglePrimaryQuantityDropdown(); $event.stopPropagation()\">\r\n                      <span class=\"unit-text\">{{ primaryQuantityUnit() === 'coin' ? getCoinSymbol() : 'USDT' }}</span>\r\n                      <span class=\"dropdown-arrow\">‚ñº</span>\r\n                    </button>\r\n                    @if (primaryDropdownOpen()) {\r\n                      <div class=\"quantity-unit-options\">\r\n                        <button\r\n                          type=\"button\"\r\n                          class=\"quantity-unit-option\"\r\n                          [class.active]=\"primaryQuantityUnit() === 'coin'\"\r\n                          (click)=\"setPrimaryQuantityUnit('coin')\">\r\n                          {{ getCoinSymbol() }}\r\n                        </button>\r\n                        <button\r\n                          type=\"button\"\r\n                          class=\"quantity-unit-option\"\r\n                          [class.active]=\"primaryQuantityUnit() === 'usdt'\"\r\n                          (click)=\"setPrimaryQuantityUnit('usdt')\">\r\n                          USDT\r\n                        </button>\r\n                      </div>\r\n                    }\r\n                  </div>\r\n                </div>\r\n                @if (!primaryValidation().valid && primaryOrderForm.get('quantity')?.touched) {\r\n                  <div class=\"validation-error\">\r\n                    <span class=\"error-icon\">‚ö†Ô∏è</span>\r\n                    <span class=\"error-text\">{{ primaryValidation().error }}</span>\r\n                  </div>\r\n                }\r\n              </div>\r\n\r\n              @if (strategy() === 'spot_futures') {\r\n                <!-- Simplified graduated entry for SPOT -->\r\n                <div class=\"form-field\">\r\n                  <label class=\"form-label\">Parts (1-5)\r\n                    <span class=\"field-hint\">Split buy into parts</span>\r\n                  </label>\r\n                  <input\r\n                    type=\"number\"\r\n                    formControlName=\"graduatedParts\"\r\n                    class=\"form-input\"\r\n                    placeholder=\"3\"\r\n                    min=\"1\"\r\n                    max=\"5\"\r\n                    step=\"1\">\r\n                </div>\r\n\r\n                <div class=\"form-field\">\r\n                  <label class=\"form-label\">Delay (0.1s - 10s)\r\n                    <span class=\"field-hint\">Delay between buys</span>\r\n                  </label>\r\n                  <input\r\n                    type=\"number\"\r\n                    formControlName=\"graduatedDelayMs\"\r\n                    class=\"form-input\"\r\n                    placeholder=\"1\"\r\n                    min=\"0.1\"\r\n                    max=\"10\"\r\n                    step=\"0.1\">\r\n                </div>\r\n              } @else {\r\n                <!-- Full graduated entry for FUTURES -->\r\n                <div class=\"form-field\">\r\n                  <label class=\"form-label\">Parts (1-20)</label>\r\n                  <input\r\n                    type=\"number\"\r\n                    formControlName=\"graduatedParts\"\r\n                    class=\"form-input\"\r\n                    placeholder=\"5\"\r\n                    min=\"1\"\r\n                    max=\"20\"\r\n                    step=\"1\">\r\n                </div>\r\n\r\n                <div class=\"form-field\">\r\n                  <label class=\"form-label\">Delay (0.1s - 60s)</label>\r\n                  <input\r\n                    type=\"number\"\r\n                    formControlName=\"graduatedDelayMs\"\r\n                    class=\"form-input\"\r\n                    placeholder=\"2\"\r\n                    min=\"0.1\"\r\n                    max=\"60\"\r\n                    step=\"0.1\">\r\n                </div>\r\n              }\r\n            </form>\r\n          </div>\r\n\r\n          <!-- Sync Lock Button -->\r\n          <div class=\"sync-lock-container\">\r\n            @if (strategy() === 'combined') {\r\n              <button\r\n                type=\"button\"\r\n                class=\"sync-lock-button\"\r\n                [class.locked]=\"orderParamsLocked()\"\r\n                [class.unlocked]=\"!orderParamsLocked()\"\r\n                (click)=\"toggleOrderParamsLock()\"\r\n                [title]=\"orderParamsLocked() ? 'Click to unlock and edit parameters independently' : 'Click to lock and synchronize parameters'\">\r\n                @if (orderParamsLocked()) {\r\n                  <svg class=\"lock-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                    <rect x=\"5\" y=\"11\" width=\"14\" height=\"10\" rx=\"2\" ry=\"2\"></rect>\r\n                    <path d=\"M7 11V7a5 5 0 0 1 10 0v4\"></path>\r\n                  </svg>\r\n                } @else {\r\n                  <svg class=\"lock-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                    <rect x=\"5\" y=\"11\" width=\"14\" height=\"10\" rx=\"2\" ry=\"2\"></rect>\r\n                    <path d=\"M7 11V7a5 5 0 0 1 9.9-1\"></path>\r\n                  </svg>\r\n                }\r\n              </button>\r\n            } @else {\r\n              <div class=\"sync-lock-disabled\" title=\"Sync lock not available for spot/futures strategy (different parameter sets)\">\r\n                <svg class=\"lock-icon disabled\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                  <rect x=\"5\" y=\"11\" width=\"14\" height=\"10\" rx=\"2\" ry=\"2\"></rect>\r\n                  <line x1=\"4\" y1=\"4\" x2=\"20\" y2=\"20\" stroke-width=\"2\"></line>\r\n                </svg>\r\n              </div>\r\n            }\r\n          </div>\r\n\r\n          <!-- Hedge Exchange Column -->\r\n          <div class=\"exchange-column hedge-column\">\r\n            <!-- Order Form for Hedge Exchange -->\r\n            <form [formGroup]=\"hedgeOrderForm\" class=\"order-form\">\r\n            <!--  <div class=\"form-header\">\r\n                <h4>Order Parameters</h4>\r\n              </div>-->\r\n\r\n              <div class=\"form-field\">\r\n                <label class=\"form-label\">Side</label>\r\n                <div class=\"side-selector\">\r\n                  <label class=\"side-option\">\r\n                    <input type=\"radio\" formControlName=\"side\" value=\"long\">\r\n                    <span class=\"side-label long\">Long</span>\r\n                  </label>\r\n                  <label class=\"side-option\">\r\n                    <input type=\"radio\" formControlName=\"side\" value=\"short\">\r\n                    <span class=\"side-label short\">Short</span>\r\n                  </label>\r\n                </div>\r\n              </div>\r\n\r\n              <div class=\"form-field\">\r\n                <label class=\"form-label\">Leverage (1x - 125x)</label>\r\n                <input\r\n                  type=\"number\"\r\n                  formControlName=\"leverage\"\r\n                  class=\"form-input\"\r\n                  placeholder=\"10\"\r\n                  min=\"1\"\r\n                  max=\"125\"\r\n                  step=\"1\">\r\n              </div>\r\n\r\n              <div class=\"form-field\">\r\n                @if (hedgeSymbolInfo()) {\r\n                  <label class=\"form-label\">Quantity (min: {{ hedgeSymbolInfo()!.minOrderQty }}{{ getCoinSymbol() }}/order)</label>\r\n                } @else {\r\n                  <label class=\"form-label\">Quantity (min: 0.001{{ getCoinSymbol() }})</label>\r\n                }\r\n                <div class=\"quantity-input-wrapper\" [class.error]=\"!hedgeValidation().valid && hedgeOrderForm.get('quantity')?.touched\">\r\n                  <input\r\n                    type=\"number\"\r\n                    formControlName=\"quantity\"\r\n                    class=\"form-input quantity-input\"\r\n                    placeholder=\"0.001\"\r\n                    min=\"0.001\"\r\n                    step=\"0.001\">\r\n                  <div class=\"quantity-unit-dropdown\">\r\n                    <button\r\n                      type=\"button\"\r\n                      class=\"quantity-unit-trigger\"\r\n                      (click)=\"toggleHedgeQuantityDropdown(); $event.stopPropagation()\">\r\n                      <span class=\"unit-text\">{{ hedgeQuantityUnit() === 'coin' ? getCoinSymbol() : 'USDT' }}</span>\r\n                      <span class=\"dropdown-arrow\">‚ñº</span>\r\n                    </button>\r\n                    @if (hedgeDropdownOpen()) {\r\n                      <div class=\"quantity-unit-options\">\r\n                        <button\r\n                          type=\"button\"\r\n                          class=\"quantity-unit-option\"\r\n                          [class.active]=\"hedgeQuantityUnit() === 'coin'\"\r\n                          (click)=\"setHedgeQuantityUnit('coin')\">\r\n                          {{ getCoinSymbol() }}\r\n                        </button>\r\n                        <button\r\n                          type=\"button\"\r\n                          class=\"quantity-unit-option\"\r\n                          [class.active]=\"hedgeQuantityUnit() === 'usdt'\"\r\n                          (click)=\"setHedgeQuantityUnit('usdt')\">\r\n                          USDT\r\n                        </button>\r\n                      </div>\r\n                    }\r\n                  </div>\r\n                </div>\r\n                @if (!hedgeValidation().valid && hedgeOrderForm.get('quantity')?.touched) {\r\n                  <div class=\"validation-error\">\r\n                    <span class=\"error-icon\">‚ö†Ô∏è</span>\r\n                    <span class=\"error-text\">{{ hedgeValidation().error }}</span>\r\n                  </div>\r\n                }\r\n              </div>\r\n\r\n              <div class=\"form-field\">\r\n                <label class=\"form-label\">Parts (1-20)</label>\r\n                <input\r\n                  type=\"number\"\r\n                  formControlName=\"graduatedParts\"\r\n                  class=\"form-input\"\r\n                  placeholder=\"5\"\r\n                  min=\"1\"\r\n                  max=\"20\"\r\n                  step=\"1\">\r\n              </div>\r\n\r\n              <div class=\"form-field\">\r\n                <label class=\"form-label\">Delay (0.1s - 60s)</label>\r\n                <input\r\n                  type=\"number\"\r\n                  formControlName=\"graduatedDelayMs\"\r\n                  class=\"form-input\"\r\n                  placeholder=\"2\"\r\n                  min=\"0.1\"\r\n                  max=\"60\"\r\n                  step=\"0.1\">\r\n              </div>\r\n            </form>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Credentials Warning -->\r\n        @if (credentialsWarning()) {\r\n          <div class=\"credentials-warning\">\r\n            <span class=\"warning-icon\">‚ö†Ô∏è</span>\r\n            <span class=\"warning-text\">{{ credentialsWarning() }}</span>\r\n          </div>\r\n        }\r\n\r\n        <!-- START Button for Both Exchanges -->\r\n        <div class=\"start-button-container\">\r\n          <button\r\n            class=\"start-arbitrage-button\"\r\n            (click)=\"startArbitragePosition()\"\r\n            [disabled]=\"isSubmittingOrder() || primaryOrderForm.invalid || hedgeOrderForm.invalid || !hasPrimaryCredentials() || !hasHedgeCredentials()\">\r\n            @if (isSubmittingOrder()) {\r\n              <span class=\"button-spinner\"></span>\r\n              Starting Position...\r\n            } @else {\r\n              START ARBITRAGE\r\n            }\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  }\r\n</div>\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\trading\\arbitrage-chart\\arbitrage-chart.component.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'FormControl' is defined but never used.","line":2,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":42},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'BehaviorSubject' is defined but never used.","line":5,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'router' is assigned a value but never used.","line":26,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":13},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1567,1570],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1567,1570],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":68,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":72,"endColumn":7},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":73,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":77,"endColumn":7},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":78,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":78,"endColumn":71},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":79,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":79,"endColumn":76},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":80,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":83,"endColumn":7},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":84,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":84,"endColumn":67},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":107,"column":39,"nodeType":"Property","messageId":"anyAssignment","endLine":107,"endColumn":62},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":108,"column":44,"nodeType":"Property","messageId":"anyAssignment","endLine":108,"endColumn":72},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":109,"column":33,"nodeType":"Property","messageId":"anyAssignment","endLine":109,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":110,"column":34,"nodeType":"Property","messageId":"anyAssignment","endLine":110,"endColumn":52},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":111,"column":48,"nodeType":"Property","messageId":"anyAssignment","endLine":111,"endColumn":72},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":112,"column":28,"nodeType":"Property","messageId":"anyAssignment","endLine":112,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":113,"column":36,"nodeType":"Property","messageId":"anyAssignment","endLine":113,"endColumn":60},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'hedgeQuantity' is assigned a value but never used.","line":279,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":279,"endColumn":26},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":281,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":281,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10801,10804],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10801,10804],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":282,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":282,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10857,10860],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10857,10860],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":289,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":289,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11069,11072],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11069,11072],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .validatePrimaryOrder on an `any` value.","line":289,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":289,"endColumn":53},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":290,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":290,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11150,11153],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11150,11153],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .validateHedgeOrder on an `any` value.","line":290,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":290,"endColumn":51},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":383,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":383,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14352,14355],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14352,14355],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .hasManualSideSelection on an `any` value.","line":383,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":383,"endColumn":55},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":390,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":390,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14550,14553],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14550,14553],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .hasManualSideSelection on an `any` value.","line":390,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":390,"endColumn":55},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":433,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":433,"endColumn":46},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":433,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":433,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16022,16025],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16022,16025],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .validatePrimaryOrder on an `any` value.","line":433,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":433,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":457,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":457,"endColumn":44},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":457,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":457,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16846,16849],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16846,16849],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .validateHedgeOrder on an `any` value.","line":457,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":457,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":476,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":476,"endColumn":46},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":476,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":476,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17469,17472],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17469,17472],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .validatePrimaryOrder on an `any` value.","line":476,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":476,"endColumn":46},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":487,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":487,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17827,17830],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17827,17830],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":488,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":488,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17883,17886],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17883,17886],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":499,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":499,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18196,18199],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18196,18199],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .validatePrimaryOrder on an `any` value.","line":499,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":499,"endColumn":53},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":500,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":500,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18271,18274],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18271,18274],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .validateHedgeOrder on an `any` value.","line":500,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":500,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":506,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":506,"endColumn":46},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":506,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":506,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18481,18484],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18481,18484],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .validatePrimaryOrder on an `any` value.","line":506,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":506,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":528,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":528,"endColumn":46},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":528,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":528,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19265,19268],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19265,19268],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .validatePrimaryOrder on an `any` value.","line":528,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":528,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":551,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":551,"endColumn":44},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":551,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":551,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20044,20047],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20044,20047],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .validateHedgeOrder on an `any` value.","line":551,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":551,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":569,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":569,"endColumn":46},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":569,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":569,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20641,20644],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20641,20644],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .validatePrimaryOrder on an `any` value.","line":569,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":569,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":589,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":589,"endColumn":92},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":589,"column":22,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":589,"endColumn":56},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":589,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":589,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21263,21266],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21263,21266],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .convertQuantity on an `any` value.","line":589,"column":41,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":589,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":594,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":594,"endColumn":91},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":594,"column":22,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":594,"endColumn":56},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":594,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":594,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21484,21487],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21484,21487],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .convertQuantity on an `any` value.","line":594,"column":41,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":594,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":599,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":599,"endColumn":88},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":599,"column":22,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":599,"endColumn":56},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":599,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":599,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21714,21717],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21714,21717],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .convertQuantity on an `any` value.","line":599,"column":41,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":599,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":612,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":612,"endColumn":88},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":612,"column":22,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":612,"endColumn":56},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":612,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":612,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22103,22106],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22103,22106],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .convertQuantity on an `any` value.","line":612,"column":41,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":612,"endColumn":56},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":655,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":655,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23591,23594],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23591,23594],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":656,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":656,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23647,23650],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23647,23650],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":661,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":661,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23771,23774],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23771,23774],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .validatePrimaryOrder on an `any` value.","line":661,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":661,"endColumn":53},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":662,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":662,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23846,23849],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23846,23849],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .validateHedgeOrder on an `any` value.","line":662,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":662,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":705,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":705,"endColumn":41},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":705,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":705,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25279,25282],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25279,25282],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .fetchSymbolInfo on an `any` value.","line":705,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":705,"endColumn":41}],"suppressedMessages":[],"errorCount":80,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { ComponentFixture, TestBed, fakeAsync, tick } from '@angular/core/testing';\r\nimport { ReactiveFormsModule, FormControl } from '@angular/forms';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { HttpClientTestingModule } from '@angular/common/http/testing';\r\nimport { of, BehaviorSubject } from 'rxjs';\r\n\r\nimport { ArbitrageChartComponent } from './arbitrage-chart.component';\r\nimport { AuthService } from '../../../services/auth.service';\r\nimport { ThemeService } from '../../../services/theme.service';\r\nimport { ExchangeCredentialsService } from '../../../services/exchange-credentials.service';\r\nimport { SymbolInfoService, SymbolInfo } from '../../../services/symbol-info.service';\r\nimport { TradingSettingsService } from '../../../services/trading-settings.service';\r\n\r\n// Mock components\r\nimport { CardComponent, CardHeaderComponent, CardTitleComponent, CardContentComponent } from '../../ui/card/card.component';\r\nimport { ButtonComponent } from '../../ui/button/button.component';\r\n\r\ndescribe('ArbitrageChartComponent - Order Parameters & Graduated Entry', () => {\r\n  let component: ArbitrageChartComponent;\r\n  let fixture: ComponentFixture<ArbitrageChartComponent>;\r\n  let symbolInfoService: jasmine.SpyObj<SymbolInfoService>;\r\n  let tradingSettingsService: jasmine.SpyObj<TradingSettingsService>;\r\n  let authService: jasmine.SpyObj<AuthService>;\r\n  let themeService: jasmine.SpyObj<ThemeService>;\r\n  let credentialsService: jasmine.SpyObj<ExchangeCredentialsService>;\r\n  let router: jasmine.SpyObj<Router>;\r\n  let activatedRoute: any;\r\n\r\n  // Mock symbol info data\r\n  const mockPrimarySymbolInfo: SymbolInfo = {\r\n    symbol: 'BTCUSDT',\r\n    exchange: 'BYBIT',\r\n    minOrderQty: 0.001,\r\n    qtyStep: 0.001,\r\n    pricePrecision: 2,\r\n    qtyPrecision: 3,\r\n    maxOrderQty: 1000,\r\n    maxLeverage: 125,\r\n    minOrderValue: 10\r\n  };\r\n\r\n  const mockHedgeSymbolInfo: SymbolInfo = {\r\n    symbol: 'BTCUSDT',\r\n    exchange: 'BINGX',\r\n    minOrderQty: 0.01,\r\n    qtyStep: 0.01,\r\n    pricePrecision: 2,\r\n    qtyPrecision: 2,\r\n    maxOrderQty: 500,\r\n    maxLeverage: 100,\r\n    minOrderValue: 20\r\n  };\r\n\r\n  const mockGateIOSymbolInfo: SymbolInfo = {\r\n    symbol: 'BTC_USDT',\r\n    exchange: 'GATEIO',\r\n    minOrderQty: 1,\r\n    qtyStep: 1,\r\n    pricePrecision: 2,\r\n    qtyPrecision: 0,\r\n    maxOrderQty: 1000000,\r\n    maxLeverage: 25,\r\n    minOrderValue: undefined\r\n  };\r\n\r\n  beforeEach(async () => {\r\n    // Create spies\r\n    const symbolInfoSpy = jasmine.createSpyObj('SymbolInfoService', [\r\n      'getSymbolInfo',\r\n      'validateOrderQuantity',\r\n      'clearCache'\r\n    ]);\r\n    const tradingSettingsSpy = jasmine.createSpyObj('TradingSettingsService', [\r\n      'getLeverage',\r\n      'getGraduatedParts',\r\n      'getGraduatedDelayMs'\r\n    ]);\r\n    const authSpy = jasmine.createSpyObj('AuthService', ['authState']);\r\n    const themeSpy = jasmine.createSpyObj('ThemeService', ['currentTheme']);\r\n    const credentialsSpy = jasmine.createSpyObj('ExchangeCredentialsService', [\r\n      'fetchCredentials',\r\n      'testConnection'\r\n    ]);\r\n    const routerSpy = jasmine.createSpyObj('Router', ['navigate']);\r\n\r\n    // Mock route parameters\r\n    activatedRoute = {\r\n      params: of({\r\n        symbol: 'BTCUSDT',\r\n        primary: 'BYBIT',\r\n        hedge: 'BINGX'\r\n      })\r\n    };\r\n\r\n    await TestBed.configureTestingModule({\r\n      imports: [\r\n        ArbitrageChartComponent,\r\n        ReactiveFormsModule,\r\n        HttpClientTestingModule,\r\n        CardComponent,\r\n        CardHeaderComponent,\r\n        CardTitleComponent,\r\n        CardContentComponent,\r\n        ButtonComponent\r\n      ],\r\n      providers: [\r\n        { provide: SymbolInfoService, useValue: symbolInfoSpy },\r\n        { provide: TradingSettingsService, useValue: tradingSettingsSpy },\r\n        { provide: AuthService, useValue: authSpy },\r\n        { provide: ThemeService, useValue: themeSpy },\r\n        { provide: ExchangeCredentialsService, useValue: credentialsSpy },\r\n        { provide: Router, useValue: routerSpy },\r\n        { provide: ActivatedRoute, useValue: activatedRoute }\r\n      ]\r\n    }).compileComponents();\r\n\r\n    // Get service spies\r\n    symbolInfoService = TestBed.inject(SymbolInfoService) as jasmine.SpyObj<SymbolInfoService>;\r\n    tradingSettingsService = TestBed.inject(TradingSettingsService) as jasmine.SpyObj<TradingSettingsService>;\r\n    authService = TestBed.inject(AuthService) as jasmine.SpyObj<AuthService>;\r\n    themeService = TestBed.inject(ThemeService) as jasmine.SpyObj<ThemeService>;\r\n    credentialsService = TestBed.inject(ExchangeCredentialsService) as jasmine.SpyObj<ExchangeCredentialsService>;\r\n    router = TestBed.inject(Router) as jasmine.SpyObj<Router>;\r\n\r\n    // Setup default mock returns\r\n    tradingSettingsService.getLeverage.and.returnValue(10);\r\n    tradingSettingsService.getGraduatedParts.and.returnValue(5);\r\n    tradingSettingsService.getGraduatedDelayMs.and.returnValue(2000);\r\n    authService.authState.and.returnValue({ token: 'mock-token', user: null });\r\n    themeService.currentTheme.and.returnValue('dark');\r\n    symbolInfoService.getSymbolInfo.and.returnValue(of(mockPrimarySymbolInfo));\r\n    symbolInfoService.validateOrderQuantity.and.returnValue({ valid: true });\r\n    credentialsService.fetchCredentials.and.returnValue(of([]));\r\n\r\n    fixture = TestBed.createComponent(ArbitrageChartComponent);\r\n    component = fixture.componentInstance;\r\n  });\r\n\r\n  afterEach(() => {\r\n    fixture.destroy();\r\n  });\r\n\r\n  describe('Form Initialization with Graduated Entry', () => {\r\n    beforeEach(() => {\r\n      fixture.detectChanges();\r\n    });\r\n\r\n    it('should create component with graduated entry forms', () => {\r\n      expect(component).toBeTruthy();\r\n      expect(component.primaryOrderForm).toBeTruthy();\r\n      expect(component.hedgeOrderForm).toBeTruthy();\r\n    });\r\n\r\n    it('should initialize primary form with default graduated entry values', () => {\r\n      expect(component.primaryOrderForm.get('side')?.value).toBe('long');\r\n      expect(component.primaryOrderForm.get('leverage')?.value).toBe(10);\r\n      expect(component.primaryOrderForm.get('quantity')?.value).toBe(0);\r\n      expect(component.primaryOrderForm.get('graduatedParts')?.value).toBe(5);\r\n      expect(component.primaryOrderForm.get('graduatedDelayMs')?.value).toBe(2); // 2000ms converted to 2 seconds\r\n    });\r\n\r\n    it('should initialize hedge form with opposite side and same graduated entry values', () => {\r\n      expect(component.hedgeOrderForm.get('side')?.value).toBe('short');\r\n      expect(component.hedgeOrderForm.get('leverage')?.value).toBe(10);\r\n      expect(component.hedgeOrderForm.get('quantity')?.value).toBe(0);\r\n      expect(component.hedgeOrderForm.get('graduatedParts')?.value).toBe(5);\r\n      expect(component.hedgeOrderForm.get('graduatedDelayMs')?.value).toBe(2);\r\n    });\r\n\r\n    it('should have correct form validators for graduated entry fields', () => {\r\n      const primaryParts = component.primaryOrderForm.get('graduatedParts');\r\n      const hedgeParts = component.hedgeOrderForm.get('graduatedParts');\r\n      const primaryDelay = component.primaryOrderForm.get('graduatedDelayMs');\r\n      const hedgeDelay = component.hedgeOrderForm.get('graduatedDelayMs');\r\n\r\n      // Test minimum values\r\n      primaryParts?.setValue(0);\r\n      expect(primaryParts?.hasError('min')).toBe(true);\r\n      \r\n      hedgeParts?.setValue(0);\r\n      expect(hedgeParts?.hasError('min')).toBe(true);\r\n\r\n      primaryDelay?.setValue(0.05);\r\n      expect(primaryDelay?.hasError('min')).toBe(true);\r\n\r\n      hedgeDelay?.setValue(0.05);\r\n      expect(hedgeDelay?.hasError('min')).toBe(true);\r\n\r\n      // Test maximum values\r\n      primaryParts?.setValue(25);\r\n      expect(primaryParts?.hasError('max')).toBe(true);\r\n\r\n      primaryDelay?.setValue(65);\r\n      expect(primaryDelay?.hasError('max')).toBe(true);\r\n\r\n      // Test valid values\r\n      primaryParts?.setValue(5);\r\n      expect(primaryParts?.hasError('min')).toBe(false);\r\n      expect(primaryParts?.hasError('max')).toBe(false);\r\n\r\n      primaryDelay?.setValue(2);\r\n      expect(primaryDelay?.hasError('min')).toBe(false);\r\n      expect(primaryDelay?.hasError('max')).toBe(false);\r\n    });\r\n\r\n    it('should validate leverage range for both forms', () => {\r\n      const primaryLeverage = component.primaryOrderForm.get('leverage');\r\n      const hedgeLeverage = component.hedgeOrderForm.get('leverage');\r\n\r\n      // Test minimum\r\n      primaryLeverage?.setValue(0);\r\n      expect(primaryLeverage?.hasError('min')).toBe(true);\r\n\r\n      hedgeLeverage?.setValue(0);\r\n      expect(hedgeLeverage?.hasError('min')).toBe(true);\r\n\r\n      // Test maximum\r\n      primaryLeverage?.setValue(130);\r\n      expect(primaryLeverage?.hasError('max')).toBe(true);\r\n\r\n      hedgeLeverage?.setValue(130);\r\n      expect(hedgeLeverage?.hasError('max')).toBe(true);\r\n\r\n      // Test valid values\r\n      primaryLeverage?.setValue(25);\r\n      expect(primaryLeverage?.valid).toBe(true);\r\n\r\n      hedgeLeverage?.setValue(50);\r\n      expect(hedgeLeverage?.valid).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe('Quantity Synchronization', () => {\r\n    beforeEach(() => {\r\n      fixture.detectChanges();\r\n      // Set up price data for conversion calculations\r\n      component['primaryData'].set({\r\n        exchange: 'BYBIT',\r\n        price: 100000,\r\n        fundingRate: '0.0001',\r\n        nextFundingTime: Date.now() + 8 * 60 * 60 * 1000,\r\n        lastUpdate: new Date()\r\n      });\r\n      component['hedgeData'].set({\r\n        exchange: 'BINGX', \r\n        price: 100100,\r\n        fundingRate: '-0.0001',\r\n        nextFundingTime: Date.now() + 8 * 60 * 60 * 1000,\r\n        lastUpdate: new Date()\r\n      });\r\n    });\r\n\r\n    it('should synchronize quantity from primary to hedge when primary changes', fakeAsync(() => {\r\n      const primaryQuantity = component.primaryOrderForm.get('quantity');\r\n      const hedgeQuantity = component.hedgeOrderForm.get('quantity');\r\n\r\n      // Change primary quantity\r\n      primaryQuantity?.setValue(1.5);\r\n      tick();\r\n\r\n      // Should sync to hedge\r\n      expect(hedgeQuantity?.value).toBe(1.5);\r\n    }));\r\n\r\n    it('should synchronize quantity from hedge to primary when hedge changes', fakeAsync(() => {\r\n      const primaryQuantity = component.primaryOrderForm.get('quantity');\r\n      const hedgeQuantity = component.hedgeOrderForm.get('quantity');\r\n\r\n      // Change hedge quantity\r\n      hedgeQuantity?.setValue(2.5);\r\n      tick();\r\n\r\n      // Should sync to primary\r\n      expect(primaryQuantity?.value).toBe(2.5);\r\n    }));\r\n\r\n    it('should prevent circular synchronization during quantity updates', fakeAsync(() => {\r\n      const primaryQuantity = component.primaryOrderForm.get('quantity');\r\n      const hedgeQuantity = component.hedgeOrderForm.get('quantity');\r\n      \r\n      spyOn(component as any, 'validatePrimaryOrder');\r\n      spyOn(component as any, 'validateHedgeOrder');\r\n\r\n      // Change primary quantity\r\n      primaryQuantity?.setValue(1.0);\r\n      tick();\r\n\r\n      // Both validation methods should be called exactly once\r\n      expect((component as any).validatePrimaryOrder).toHaveBeenCalledTimes(1);\r\n      expect((component as any).validateHedgeOrder).toHaveBeenCalledTimes(1);\r\n    }));\r\n\r\n    it('should convert quantity when units differ between primary and hedge', fakeAsync(() => {\r\n      // Set different units\r\n      component.primaryQuantityUnit.set('coin');\r\n      component.hedgeQuantityUnit.set('usdt');\r\n\r\n      const primaryQuantity = component.primaryOrderForm.get('quantity');\r\n      const hedgeQuantity = component.hedgeOrderForm.get('quantity');\r\n\r\n      // Change primary quantity (coin)\r\n      primaryQuantity?.setValue(0.5);\r\n      tick();\r\n\r\n      // Should convert to USDT using primary price (100000)\r\n      expect(hedgeQuantity?.value).toBe(50000); // 0.5 * 100000\r\n    }));\r\n\r\n    it('should convert from USDT to coin when syncing hedge to primary', fakeAsync(() => {\r\n      // Set different units\r\n      component.primaryQuantityUnit.set('coin');\r\n      component.hedgeQuantityUnit.set('usdt');\r\n\r\n      const primaryQuantity = component.primaryOrderForm.get('quantity');\r\n      const hedgeQuantity = component.hedgeOrderForm.get('quantity');\r\n\r\n      // Change hedge quantity (USDT)\r\n      hedgeQuantity?.setValue(100100);\r\n      tick();\r\n\r\n      // Should convert to coin using hedge price (100100)\r\n      expect(primaryQuantity?.value).toBe(1); // 100100 / 100100\r\n    }));\r\n\r\n    it('should handle price data unavailable during conversion', fakeAsync(() => {\r\n      // Clear price data\r\n      component['primaryData'].set({\r\n        exchange: 'BYBIT',\r\n        price: 0,\r\n        fundingRate: '0.0001',\r\n        nextFundingTime: Date.now(),\r\n        lastUpdate: new Date()\r\n      });\r\n\r\n      component.primaryQuantityUnit.set('coin');\r\n      component.hedgeQuantityUnit.set('usdt');\r\n\r\n      const primaryQuantity = component.primaryOrderForm.get('quantity');\r\n      const hedgeQuantity = component.hedgeOrderForm.get('quantity');\r\n\r\n      // Change primary quantity\r\n      primaryQuantity?.setValue(0.5);\r\n      tick();\r\n\r\n      // Should not convert when price is 0\r\n      expect(hedgeQuantity?.value).toBe(0.5);\r\n    }));\r\n  });\r\n\r\n  describe('Side Synchronization', () => {\r\n    beforeEach(() => {\r\n      fixture.detectChanges();\r\n    });\r\n\r\n    it('should synchronize opposite sides when primary side changes', fakeAsync(() => {\r\n      const primarySide = component.primaryOrderForm.get('side');\r\n      const hedgeSide = component.hedgeOrderForm.get('side');\r\n\r\n      // Change primary to short\r\n      primarySide?.setValue('short');\r\n      tick();\r\n\r\n      // Hedge should become long\r\n      expect(hedgeSide?.value).toBe('long');\r\n    }));\r\n\r\n    it('should synchronize opposite sides when hedge side changes', fakeAsync(() => {\r\n      const primarySide = component.primaryOrderForm.get('side');\r\n      const hedgeSide = component.hedgeOrderForm.get('side');\r\n\r\n      // Change hedge to long\r\n      hedgeSide?.setValue('long');\r\n      tick();\r\n\r\n      // Primary should become short\r\n      expect(primarySide?.value).toBe('short');\r\n    }));\r\n\r\n    it('should mark manual side selection when user changes sides', fakeAsync(() => {\r\n      const primarySide = component.primaryOrderForm.get('side');\r\n      \r\n      // Initial state should not have manual selection\r\n      expect((component as any).hasManualSideSelection).toBe(false);\r\n\r\n      // User changes side\r\n      primarySide?.setValue('short');\r\n      tick();\r\n\r\n      // Should mark as manual selection\r\n      expect((component as any).hasManualSideSelection).toBe(true);\r\n    }));\r\n\r\n    it('should prevent circular side synchronization', fakeAsync(() => {\r\n      const primarySide = component.primaryOrderForm.get('side');\r\n      const hedgeSide = component.hedgeOrderForm.get('side');\r\n      \r\n      let primaryChangeCount = 0;\r\n      let hedgeChangeCount = 0;\r\n\r\n      primarySide?.valueChanges.subscribe(() => primaryChangeCount++);\r\n      hedgeSide?.valueChanges.subscribe(() => hedgeChangeCount++);\r\n\r\n      // Change primary side\r\n      primarySide?.setValue('short');\r\n      tick();\r\n\r\n      // Should only trigger one change each (no circular updates)\r\n      expect(primaryChangeCount).toBe(1);\r\n      expect(hedgeChangeCount).toBe(1);\r\n    }));\r\n  });\r\n\r\n  describe('Graduated Entry Validation', () => {\r\n    beforeEach(() => {\r\n      fixture.detectChanges();\r\n      component.primarySymbolInfo.set(mockPrimarySymbolInfo);\r\n      component.hedgeSymbolInfo.set(mockHedgeSymbolInfo);\r\n    });\r\n\r\n    it('should validate primary order with graduated parts', () => {\r\n      symbolInfoService.validateOrderQuantity.and.returnValue({\r\n        valid: false,\r\n        error: 'Each order part (0.0002) is below minimum (0.001)',\r\n        suggestion: 'Increase total quantity to at least 0.005 or reduce graduated parts to 2'\r\n      });\r\n\r\n      component.primaryOrderForm.patchValue({\r\n        quantity: 0.001,\r\n        graduatedParts: 5\r\n      });\r\n\r\n      // Trigger validation\r\n      (component as any).validatePrimaryOrder();\r\n\r\n      expect(symbolInfoService.validateOrderQuantity).toHaveBeenCalledWith(\r\n        mockPrimarySymbolInfo,\r\n        0.001,\r\n        5\r\n      );\r\n      expect(component.primaryValidation().valid).toBe(false);\r\n      expect(component.primaryValidation().error).toContain('Each order part');\r\n    });\r\n\r\n    it('should validate hedge order with graduated parts', () => {\r\n      symbolInfoService.validateOrderQuantity.and.returnValue({\r\n        valid: false,\r\n        error: 'Each order part (0.002) is below minimum (0.01)',\r\n        suggestion: 'Increase total quantity to at least 0.05 or reduce graduated parts to 1'\r\n      });\r\n\r\n      component.hedgeOrderForm.patchValue({\r\n        quantity: 0.01,\r\n        graduatedParts: 5\r\n      });\r\n\r\n      // Trigger validation\r\n      (component as any).validateHedgeOrder();\r\n\r\n      expect(symbolInfoService.validateOrderQuantity).toHaveBeenCalledWith(\r\n        mockHedgeSymbolInfo,\r\n        0.01,\r\n        5\r\n      );\r\n      expect(component.hedgeValidation().valid).toBe(false);\r\n      expect(component.hedgeValidation().error).toContain('Each order part');\r\n    });\r\n\r\n    it('should pass validation when quantity per part meets requirements', () => {\r\n      symbolInfoService.validateOrderQuantity.and.returnValue({ valid: true });\r\n\r\n      component.primaryOrderForm.patchValue({\r\n        quantity: 0.1,\r\n        graduatedParts: 5\r\n      });\r\n\r\n      (component as any).validatePrimaryOrder();\r\n\r\n      expect(symbolInfoService.validateOrderQuantity).toHaveBeenCalledWith(\r\n        mockPrimarySymbolInfo,\r\n        0.1,\r\n        5\r\n      );\r\n      expect(component.primaryValidation().valid).toBe(true);\r\n    });\r\n\r\n    it('should trigger validation when graduated parts change', fakeAsync(() => {\r\n      spyOn(component as any, 'validatePrimaryOrder');\r\n      spyOn(component as any, 'validateHedgeOrder');\r\n\r\n      const primaryParts = component.primaryOrderForm.get('graduatedParts');\r\n      const hedgeParts = component.hedgeOrderForm.get('graduatedParts');\r\n\r\n      primaryParts?.setValue(10);\r\n      tick();\r\n\r\n      hedgeParts?.setValue(3);\r\n      tick();\r\n\r\n      expect((component as any).validatePrimaryOrder).toHaveBeenCalled();\r\n      expect((component as any).validateHedgeOrder).toHaveBeenCalled();\r\n    }));\r\n\r\n    it('should handle validation when symbol info is not available', () => {\r\n      component.primarySymbolInfo.set(null);\r\n      \r\n      (component as any).validatePrimaryOrder();\r\n\r\n      expect(component.primaryValidation().valid).toBe(true);\r\n      expect(symbolInfoService.validateOrderQuantity).not.toHaveBeenCalled();\r\n    });\r\n  });\r\n\r\n  describe('Exchange-Specific Validation Edge Cases', () => {\r\n    it('should handle Gate.io large minimum quantity validation', () => {\r\n      component.primarySymbolInfo.set(mockGateIOSymbolInfo);\r\n      \r\n      symbolInfoService.validateOrderQuantity.and.returnValue({\r\n        valid: false,\r\n        error: 'Each order part (0.2) is below minimum (1)',\r\n        suggestion: 'Increase total quantity to at least 5 or reduce graduated parts to 1'\r\n      });\r\n\r\n      component.primaryOrderForm.patchValue({\r\n        quantity: 1,\r\n        graduatedParts: 5\r\n      });\r\n\r\n      (component as any).validatePrimaryOrder();\r\n\r\n      expect(symbolInfoService.validateOrderQuantity).toHaveBeenCalledWith(\r\n        mockGateIOSymbolInfo,\r\n        1,\r\n        5\r\n      );\r\n      expect(component.primaryValidation().valid).toBe(false);\r\n      expect(component.primaryValidation().suggestion).toContain('reduce graduated parts to 1');\r\n    });\r\n\r\n    it('should validate maximum order quantity constraints', () => {\r\n      symbolInfoService.validateOrderQuantity.and.returnValue({\r\n        valid: false,\r\n        error: 'Each order part (250) exceeds maximum (100)',\r\n        suggestion: 'Decrease quantity or increase graduated parts'\r\n      });\r\n\r\n      component.hedgeOrderForm.patchValue({\r\n        quantity: 1000,\r\n        graduatedParts: 4\r\n      });\r\n\r\n      (component as any).validateHedgeOrder();\r\n\r\n      expect(component.hedgeValidation().valid).toBe(false);\r\n      expect(component.hedgeValidation().error).toContain('exceeds maximum');\r\n    });\r\n\r\n    it('should validate quantity step constraints', () => {\r\n      symbolInfoService.validateOrderQuantity.and.returnValue({\r\n        valid: false,\r\n        error: 'Quantity per part must be a multiple of 0.001',\r\n        suggestion: 'Adjust total quantity to 0.015'\r\n      });\r\n\r\n      component.primaryOrderForm.patchValue({\r\n        quantity: 0.0147,\r\n        graduatedParts: 3\r\n      });\r\n\r\n      (component as any).validatePrimaryOrder();\r\n\r\n      expect(component.primaryValidation().valid).toBe(false);\r\n      expect(component.primaryValidation().error).toContain('multiple of');\r\n    });\r\n  });\r\n\r\n  describe('Quantity Unit Conversion Edge Cases', () => {\r\n    beforeEach(() => {\r\n      fixture.detectChanges();\r\n      component['primaryData'].set({\r\n        exchange: 'BYBIT',\r\n        price: 50000,\r\n        fundingRate: '0.0001',\r\n        nextFundingTime: Date.now(),\r\n        lastUpdate: new Date()\r\n      });\r\n    });\r\n\r\n    it('should handle fractional coin to USDT conversion', () => {\r\n      const result = (component as any).convertQuantity(0.00123, 'coin', 'usdt', 'primary');\r\n      expect(result).toBe(61.5); // 0.00123 * 50000\r\n    });\r\n\r\n    it('should handle large USDT to coin conversion', () => {\r\n      const result = (component as any).convertQuantity(125000, 'usdt', 'coin', 'primary');\r\n      expect(result).toBe(2.5); // 125000 / 50000\r\n    });\r\n\r\n    it('should return original value when converting same units', () => {\r\n      const result = (component as any).convertQuantity(1.5, 'coin', 'coin', 'primary');\r\n      expect(result).toBe(1.5);\r\n    });\r\n\r\n    it('should handle zero price gracefully', () => {\r\n      component['primaryData'].set({\r\n        exchange: 'BYBIT',\r\n        price: 0,\r\n        fundingRate: '0.0001',\r\n        nextFundingTime: Date.now(),\r\n        lastUpdate: new Date()\r\n      });\r\n\r\n      const result = (component as any).convertQuantity(1.5, 'coin', 'usdt', 'primary');\r\n      expect(result).toBe(1.5); // Should return original value when price is 0\r\n    });\r\n  });\r\n\r\n  describe('Form Integration and User Experience', () => {\r\n    beforeEach(() => {\r\n      fixture.detectChanges();\r\n    });\r\n\r\n    it('should maintain form state during quantity unit changes', fakeAsync(() => {\r\n      component.primaryOrderForm.patchValue({\r\n        side: 'long',\r\n        leverage: 25,\r\n        quantity: 0.5,\r\n        graduatedParts: 8,\r\n        graduatedDelayMs: 5\r\n      });\r\n\r\n      // Change quantity unit\r\n      component.setPrimaryQuantityUnit('usdt');\r\n      tick();\r\n\r\n      // Form state should be maintained except for converted quantity\r\n      expect(component.primaryOrderForm.get('side')?.value).toBe('long');\r\n      expect(component.primaryOrderForm.get('leverage')?.value).toBe(25);\r\n      expect(component.primaryOrderForm.get('graduatedParts')?.value).toBe(8);\r\n      expect(component.primaryOrderForm.get('graduatedDelayMs')?.value).toBe(5);\r\n    }));\r\n\r\n    it('should synchronize unit changes between forms', fakeAsync(() => {\r\n      component.setPrimaryQuantityUnit('usdt');\r\n      tick();\r\n\r\n      expect(component.hedgeQuantityUnit()).toBe('usdt');\r\n\r\n      component.setHedgeQuantityUnit('coin');\r\n      tick();\r\n\r\n      expect(component.primaryQuantityUnit()).toBe('coin');\r\n    }));\r\n\r\n    it('should validate both forms after unit conversion', fakeAsync(() => {\r\n      spyOn(component as any, 'validatePrimaryOrder');\r\n      spyOn(component as any, 'validateHedgeOrder');\r\n\r\n      component.setPrimaryQuantityUnit('usdt');\r\n      tick();\r\n\r\n      expect((component as any).validatePrimaryOrder).toHaveBeenCalled();\r\n      expect((component as any).validateHedgeOrder).toHaveBeenCalled();\r\n    }));\r\n  });\r\n\r\n  describe('Error Handling and Edge Cases', () => {\r\n    it('should handle invalid graduated parts gracefully', () => {\r\n      component.primaryOrderForm.patchValue({\r\n        quantity: 1,\r\n        graduatedParts: -1\r\n      });\r\n\r\n      expect(component.primaryOrderForm.get('graduatedParts')?.hasError('min')).toBe(true);\r\n    });\r\n\r\n    it('should handle extremely large graduated parts', () => {\r\n      component.primaryOrderForm.patchValue({\r\n        quantity: 1,\r\n        graduatedParts: 1000\r\n      });\r\n\r\n      expect(component.primaryOrderForm.get('graduatedParts')?.hasError('max')).toBe(true);\r\n    });\r\n\r\n    it('should handle decimal graduated delay validation', () => {\r\n      const delayControl = component.primaryOrderForm.get('graduatedDelayMs');\r\n      \r\n      // Test very small delay\r\n      delayControl?.setValue(0.05);\r\n      expect(delayControl?.hasError('min')).toBe(true);\r\n\r\n      // Test valid decimal delay\r\n      delayControl?.setValue(1.5);\r\n      expect(delayControl?.valid).toBe(true);\r\n\r\n      // Test large delay\r\n      delayControl?.setValue(70);\r\n      expect(delayControl?.hasError('max')).toBe(true);\r\n    });\r\n\r\n    it('should handle symbol info loading failures', () => {\r\n      symbolInfoService.getSymbolInfo.and.returnValue(of(null));\r\n      \r\n      // Component should handle null symbol info gracefully\r\n      (component as any).fetchSymbolInfo();\r\n      \r\n      expect(component.primarySymbolInfo()).toBeNull();\r\n      expect(component.hedgeSymbolInfo()).toBeNull();\r\n    });\r\n  });\r\n\r\n  describe('Performance and Memory Management', () => {\r\n    it('should prevent memory leaks with proper subscription cleanup', () => {\r\n      // Ensure component initializes subscriptions\r\n      fixture.detectChanges();\r\n      \r\n      // Component should have form subscriptions\r\n      expect(component.primaryOrderForm.get('quantity')?.valueChanges).toBeDefined();\r\n      expect(component.hedgeOrderForm.get('quantity')?.valueChanges).toBeDefined();\r\n      \r\n      // Destroy should clean up without errors\r\n      expect(() => {\r\n        component.ngOnDestroy();\r\n      }).not.toThrow();\r\n    });\r\n\r\n    it('should handle rapid form value changes efficiently', fakeAsync(() => {\r\n      const quantityControl = component.primaryOrderForm.get('quantity');\r\n      \r\n      // Simulate rapid changes\r\n      for (let i = 0; i < 10; i++) {\r\n        quantityControl?.setValue(i * 0.1);\r\n        tick(10);\r\n      }\r\n\r\n      // Should end up with the last value\r\n      expect(quantityControl?.value).toBe(0.9);\r\n    }));\r\n  });\r\n\r\n  describe('Funding Time Calculations - UTC Timezone Safety', () => {\r\n    it('should format funding info with correct UTC timestamps (no timezone offset)', () => {\r\n      // Test case: nextFundingTime at 22:00:00 UTC, current time at 21:30:00 UTC\r\n      const nextFundingTime = Date.UTC(2025, 9, 28, 22, 0, 0); // 22:00:00 UTC\r\n      const currentTime = Date.UTC(2025, 9, 28, 21, 30, 0);    // 21:30:00 UTC\r\n\r\n      // Mock Date.now() to return our test current time\r\n      spyOn(Date, 'now').and.returnValue(currentTime);\r\n\r\n      const result = component.formatFundingInfo('0.0001', nextFundingTime, '8h');\r\n\r\n      // Should show 30 minutes remaining (00:30)\r\n      expect(result).toContain('00:30');\r\n      expect(result).toContain('0.0100%');\r\n      expect(result).toContain('8h');\r\n    });\r\n\r\n    it('should handle MEXC hourly funding with correct UTC calculation', () => {\r\n      // MEXC has hourly funding (every hour on the hour)\r\n      // Test: Current time 14:45 UTC -> Next funding at 15:00 UTC (15 minutes)\r\n      const currentTime = Date.UTC(2025, 9, 28, 14, 45, 0);\r\n      const expectedNextFunding = Date.UTC(2025, 9, 28, 15, 0, 0);\r\n\r\n      spyOn(Date, 'now').and.returnValue(currentTime);\r\n\r\n      const result = component.formatFundingInfo('0.0001', expectedNextFunding, '1h');\r\n\r\n      // Should show 15 minutes remaining (00:15)\r\n      expect(result).toContain('00:15');\r\n      expect(result).toContain('1h');\r\n    });\r\n\r\n    it('should correctly calculate time remaining across hour boundary', () => {\r\n      // Test: Current time 23:45 UTC -> Next funding at 00:00 UTC next day (15 minutes)\r\n      const currentTime = Date.UTC(2025, 9, 28, 23, 45, 0);\r\n      const nextFundingTime = Date.UTC(2025, 9, 29, 0, 0, 0); // Next day\r\n\r\n      spyOn(Date, 'now').and.returnValue(currentTime);\r\n\r\n      const result = component.formatFundingInfo('0.0001', nextFundingTime, '8h');\r\n\r\n      // Should show 15 minutes remaining (00:15), NOT 03:15 or other timezone offset\r\n      expect(result).toContain('00:15');\r\n    });\r\n\r\n    it('should show correct hours when funding is more than 1 hour away', () => {\r\n      // Test: Current time 20:15 UTC -> Next funding at 22:00 UTC (1h 45m = 105 minutes)\r\n      const currentTime = Date.UTC(2025, 9, 28, 20, 15, 0);\r\n      const nextFundingTime = Date.UTC(2025, 9, 28, 22, 0, 0);\r\n\r\n      spyOn(Date, 'now').and.returnValue(currentTime);\r\n\r\n      const result = component.formatFundingInfo('0.0001', nextFundingTime, '8h');\r\n\r\n      // Should show 1 hour 45 minutes (01:45)\r\n      expect(result).toContain('01:45');\r\n    });\r\n\r\n    it('should handle funding time in the past (show 00:00)', () => {\r\n      // Test: Funding time has already passed\r\n      const currentTime = Date.UTC(2025, 9, 28, 22, 5, 0);\r\n      const nextFundingTime = Date.UTC(2025, 9, 28, 22, 0, 0); // 5 minutes ago\r\n\r\n      spyOn(Date, 'now').and.returnValue(currentTime);\r\n\r\n      const result = component.formatFundingInfo('0.0001', nextFundingTime, '8h');\r\n\r\n      // Should show 00:00 when funding time has passed\r\n      expect(result).toContain('00:00');\r\n    });\r\n\r\n    it('should NOT add timezone offset to calculated time (regression test)', () => {\r\n      // Regression test for the bug where timezone offset was added\r\n      // Test in UTC+3 timezone scenario: 21:30 UTC -> 22:00 UTC should show 00:30, NOT 03:30\r\n      const currentTime = Date.UTC(2025, 9, 28, 21, 30, 0);\r\n      const nextFundingTime = Date.UTC(2025, 9, 28, 22, 0, 0);\r\n\r\n      spyOn(Date, 'now').and.returnValue(currentTime);\r\n\r\n      const result = component.formatFundingInfo('0.0001', nextFundingTime, '8h');\r\n\r\n      // CRITICAL: Should be 00:30, NOT 03:30 (which would happen if timezone offset is added)\r\n      expect(result).toContain('00:30');\r\n      expect(result).not.toContain('03:30');\r\n      expect(result).not.toContain('02:30');\r\n    });\r\n\r\n    it('should handle different funding intervals correctly', () => {\r\n      const currentTime = Date.UTC(2025, 9, 28, 21, 30, 0);\r\n      const nextFundingTime = Date.UTC(2025, 9, 28, 22, 0, 0);\r\n\r\n      spyOn(Date, 'now').and.returnValue(currentTime);\r\n\r\n      // Test with 8h interval\r\n      const result8h = component.formatFundingInfo('0.0001', nextFundingTime, '8h');\r\n      expect(result8h).toContain('8h');\r\n\r\n      // Test with 1h interval (MEXC)\r\n      const result1h = component.formatFundingInfo('0.0001', nextFundingTime, '1h');\r\n      expect(result1h).toContain('1h');\r\n\r\n      // Test with 4h interval\r\n      const result4h = component.formatFundingInfo('0.0001', nextFundingTime, '4h');\r\n      expect(result4h).toContain('4h');\r\n    });\r\n\r\n    it('should return N/A when nextFundingTime is 0 or undefined', () => {\r\n      const result1 = component.formatFundingInfo('0.0001', 0, '8h');\r\n      expect(result1).toBe('N/A');\r\n\r\n      const result2 = component.formatFundingInfo('', 0, '8h');\r\n      expect(result2).toBe('N/A');\r\n    });\r\n\r\n    it('should format funding rate as percentage correctly', () => {\r\n      const nextFundingTime = Date.UTC(2025, 9, 28, 22, 0, 0);\r\n      const currentTime = Date.UTC(2025, 9, 28, 21, 30, 0);\r\n\r\n      spyOn(Date, 'now').and.returnValue(currentTime);\r\n\r\n      // Positive funding rate\r\n      const resultPositive = component.formatFundingInfo('0.0001', nextFundingTime, '8h');\r\n      expect(resultPositive).toContain('0.0100%');\r\n\r\n      // Negative funding rate\r\n      const resultNegative = component.formatFundingInfo('-0.0001', nextFundingTime, '8h');\r\n      expect(resultNegative).toContain('-0.0100%');\r\n\r\n      // Zero funding rate\r\n      const resultZero = component.formatFundingInfo('0', nextFundingTime, '8h');\r\n      expect(resultZero).toContain('0.0000%');\r\n    });\r\n  });\r\n});","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\trading\\arbitrage-chart\\arbitrage-chart.component.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":462,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":462,"endColumn":68},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":463,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":463,"endColumn":60},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":846,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":846,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30209,30212],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30209,30212],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":859,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":859,"endColumn":66,"suggestions":[{"messageId":"addBrackets","fix":{"range":[30557,30939],"text":"{ const bingxSymbol = this.normalizeSymbolForBingX(symbol);\r\n        wsUrl = 'wss://open-api-swap.bingx.com/swap-market';\r\n        subscribeMessage = {\r\n          id: Date.now().toString(),\r\n          reqType: 'sub',\r\n          dataType: `${bingxSymbol}@ticker`\r\n        };\r\n        console.log(`[ArbitrageChart] BingX symbol normalized: ${symbol} -> ${bingxSymbol}`);\r\n        break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":871,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":871,"endColumn":119,"suggestions":[{"messageId":"addBrackets","fix":{"range":[31041,31496],"text":"{ const mexcSymbol = symbol.includes('_') ? symbol : symbol.replace(/USDT$/, '_USDT').replace(/USDC$/, '_USDC');\r\n        // Correct MEXC futures WebSocket URL\r\n        wsUrl = 'wss://contract.mexc.com/edge';\r\n        subscribeMessage = {\r\n          method: 'sub.ticker',\r\n          param: {\r\n            symbol: mexcSymbol\r\n          }\r\n        };\r\n        console.log(`[ArbitrageChart] MEXC symbol normalized: ${symbol} -> ${mexcSymbol}`);\r\n        break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":951,"column":11,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":951,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":963,"column":15,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":963,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .channel on an `any` value.","line":966,"column":41,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":966,"endColumn":48},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1012,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1012,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[35887,35890],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[35887,35890],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .topic on an `any` value.","line":1022,"column":18,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1022,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1022,"column":27,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1022,"endColumn":48},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .topic on an `any` value.","line":1022,"column":32,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1022,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":1022,"column":69,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1022,"endColumn":73},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":1028,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1028,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .type on an `any` value.","line":1031,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1031,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":1037,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1037,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1038,"column":11,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":1038,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":1038,"column":30,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1038,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1043,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":1043,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .type on an `any` value.","line":1043,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1043,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1044,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":1044,"endColumn":48},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":1044,"column":34,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1044,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1046,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":1046,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":1052,"column":20,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1052,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":1053,"column":44,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1053,"endColumn":48},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":1054,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1054,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":1055,"column":29,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1055,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":1063,"column":20,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1063,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1064,"column":13,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":1064,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":1064,"column":36,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1064,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .dataType on an `any` value.","line":1082,"column":18,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1082,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1082,"column":30,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1082,"endColumn":52},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .dataType on an `any` value.","line":1082,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1082,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":1082,"column":72,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1082,"endColumn":76},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1083,"column":17,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":1083,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":1083,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1083,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .c on an `any` value.","line":1084,"column":41,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1084,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1094,"column":17,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":1094,"endColumn":62},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1094,"column":35,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1094,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .dataType on an `any` value.","line":1094,"column":40,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1094,"endColumn":48},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access [0] on an `any` value.","line":1094,"column":60,"nodeType":"Literal","messageId":"unsafeMemberExpression","endLine":1094,"endColumn":61},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .channel on an `any` value.","line":1109,"column":18,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1109,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":1109,"column":52,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1109,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":1111,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1111,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":1114,"column":20,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1114,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":1114,"column":59,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1114,"endColumn":63},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1115,"column":13,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":1115,"endColumn":59},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1115,"column":27,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1115,"endColumn":57},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":1115,"column":32,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1115,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .arg on an `any` value.","line":1126,"column":18,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1126,"endColumn":21},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .arg on an `any` value.","line":1126,"column":30,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1126,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":1126,"column":64,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1126,"endColumn":68},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":1126,"column":77,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1126,"endColumn":81},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":1127,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1127,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1128,"column":11,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":1128,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":1128,"column":30,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1128,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":1129,"column":43,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1129,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1152,"column":15,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":1152,"endColumn":67},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1152,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1152,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[41860,41863],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[41860,41863],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1157,"column":17,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":1159,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1157,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1157,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[42128,42131],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[42128,42131],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .name on an `any` value.","line":1158,"column":18,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1158,"endColumn":22},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":1158,"column":52,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1158,"endColumn":58},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .last_price on an `any` value.","line":1162,"column":49,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1162,"endColumn":59},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .lastPrice on an `any` value.","line":1162,"column":74,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1162,"endColumn":83},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1163,"column":19,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":1163,"endColumn":82},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .funding_rate on an `any` value.","line":1163,"column":44,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1163,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .fundingRate on an `any` value.","line":1163,"column":71,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1163,"endColumn":82},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .funding_next_apply on an `any` value.","line":1164,"column":49,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1164,"endColumn":67},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .nextFundingTime on an `any` value.","line":1164,"column":82,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1164,"endColumn":97},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1170,"column":17,"nodeType":"Property","messageId":"anyAssignment","endLine":1170,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1373,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":1373,"endColumn":78},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1373,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1373,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[50248,50251],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[50248,50251],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .success on an `any` value.","line":1375,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1375,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":1375,"column":42,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1375,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1376,"column":15,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":1376,"endColumn":59},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":1376,"column":41,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1376,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1377,"column":15,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":1377,"endColumn":55},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":1377,"column":39,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1377,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .length on an `any` value.","line":1379,"column":63,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1379,"endColumn":69},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .length on an `any` value.","line":1379,"column":98,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1379,"endColumn":104},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .length on an `any` value.","line":1382,"column":71,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1382,"endColumn":77},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1383,"column":17,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":1386,"endColumn":14},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1383,"column":31,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1383,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .map on an `any` value.","line":1383,"column":46,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1383,"endColumn":49},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1383,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1383,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[50811,50814],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[50811,50814],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .time on an `any` value.","line":1384,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1384,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1385,"column":13,"nodeType":"Property","messageId":"anyAssignment","endLine":1385,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .price on an `any` value.","line":1385,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1385,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .length on an `any` value.","line":1391,"column":67,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1391,"endColumn":73},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1392,"column":17,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":1395,"endColumn":14},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1392,"column":29,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1392,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .map on an `any` value.","line":1392,"column":42,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1392,"endColumn":45},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1392,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1392,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[51174,51177],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[51174,51177],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .time on an `any` value.","line":1393,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1393,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1394,"column":13,"nodeType":"Property","messageId":"anyAssignment","endLine":1394,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .price on an `any` value.","line":1394,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1394,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1648,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":1648,"endColumn":77},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1649,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":1649,"endColumn":74},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1680,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":1680,"endColumn":77},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1681,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":1681,"endColumn":74},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1692,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":1692,"endColumn":20},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1693,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":1693,"endColumn":18},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1732,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":1732,"endColumn":60},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1733,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":1733,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2088,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2088,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2089,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2089,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2095,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":2095,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .side on an `any` value.","line":2095,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2095,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2096,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":2096,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .leverage on an `any` value.","line":2096,"column":32,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2096,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2097,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":2097,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .quantity on an `any` value.","line":2097,"column":32,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2097,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2101,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":2101,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .side on an `any` value.","line":2101,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2101,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2102,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":2102,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .leverage on an `any` value.","line":2102,"column":30,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2102,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2103,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":2103,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .quantity on an `any` value.","line":2103,"column":30,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2103,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2125,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2125,"endColumn":57},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .quantity on an `any` value.","line":2125,"column":49,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2125,"endColumn":57},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .quantity on an `any` value.","line":2131,"column":48,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2131,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .graduatedParts on an `any` value.","line":2134,"column":60,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2134,"endColumn":74},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .graduatedParts on an `any` value.","line":2143,"column":61,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2143,"endColumn":75},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .quantity on an `any` value.","line":2144,"column":74,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2144,"endColumn":82},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2147,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2147,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .quantity on an `any` value.","line":2147,"column":45,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2147,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .quantity on an `any` value.","line":2153,"column":46,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2153,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .graduatedParts on an `any` value.","line":2156,"column":58,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2156,"endColumn":72},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .graduatedParts on an `any` value.","line":2165,"column":57,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2165,"endColumn":71},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .quantity on an `any` value.","line":2166,"column":70,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2166,"endColumn":78},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2187,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":2187,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .side on an `any` value.","line":2187,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2187,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2188,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":2188,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .leverage on an `any` value.","line":2188,"column":39,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2188,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2189,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":2189,"endColumn":48},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2191,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":2191,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .side on an `any` value.","line":2191,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2191,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2192,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":2192,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .leverage on an `any` value.","line":2192,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2192,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2193,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":2193,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2194,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":2194,"endColumn":62},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .graduatedParts on an `any` value.","line":2194,"column":43,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2194,"endColumn":57},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .graduatedDelayMs on an `any` value.","line":2195,"column":46,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2195,"endColumn":62},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2208,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2208,"endColumn":92},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2208,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2208,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[81860,81863],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[81860,81863],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .success on an `any` value.","line":2210,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2210,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":2211,"column":75,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2211,"endColumn":79},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2214,"column":15,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2214,"endColumn":78},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":2214,"column":45,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2214,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2215,"column":15,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2215,"endColumn":82},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":2215,"column":46,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2215,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2216,"column":15,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2216,"endColumn":67},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":2216,"column":38,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2216,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2218,"column":15,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2218,"endColumn":74},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":2218,"column":43,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2218,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2219,"column":15,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2219,"endColumn":78},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":2219,"column":44,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2219,"endColumn":48},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2220,"column":15,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2220,"endColumn":63},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":2220,"column":36,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2220,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2222,"column":15,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2222,"endColumn":59},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":2222,"column":38,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2222,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2223,"column":15,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2223,"endColumn":55},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":2223,"column":36,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2223,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2226,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":2226,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":2226,"column":32,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2226,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2227,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":2227,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":2227,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2227,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2228,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":2233,"endColumn":12},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":2229,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2229,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2230,"column":13,"nodeType":"Property","messageId":"anyAssignment","endLine":2230,"endColumn":48},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2231,"column":13,"nodeType":"Property","messageId":"anyAssignment","endLine":2231,"endColumn":52},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2232,"column":13,"nodeType":"Property","messageId":"anyAssignment","endLine":2232,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2234,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":2239,"endColumn":12},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":2235,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2235,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2236,"column":13,"nodeType":"Property","messageId":"anyAssignment","endLine":2236,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2237,"column":13,"nodeType":"Property","messageId":"anyAssignment","endLine":2237,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2238,"column":13,"nodeType":"Property","messageId":"anyAssignment","endLine":2238,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2240,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":2240,"endColumn":55},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":2240,"column":36,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2240,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2243,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":2243,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2244,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":2244,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":2250,"column":102,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2250,"endColumn":106},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .error on an `any` value.","line":2278,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2278,"endColumn":40},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2281,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2281,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[84906,84909],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[84906,84909],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2283,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2283,"endColumn":82},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .error on an `any` value.","line":2283,"column":34,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2283,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":2283,"column":56,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2283,"endColumn":63},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2382,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2382,"endColumn":78},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2382,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2382,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[88516,88519],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[88516,88519],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .success on an `any` value.","line":2384,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2384,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":2384,"column":42,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2384,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":2385,"column":57,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2385,"endColumn":61},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2388,"column":15,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2451,"endColumn":11},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":2388,"column":48,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":2388,"endColumn":65},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":2388,"column":57,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2388,"endColumn":61},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2388,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2388,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[88846,88849],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[88846,88849],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2390,"column":17,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2390,"endColumn":70},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .primary on an `any` value.","line":2390,"column":42,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2390,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2391,"column":17,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2391,"endColumn":74},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .primary on an `any` value.","line":2391,"column":43,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2391,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2392,"column":17,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2392,"endColumn":59},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .primary on an `any` value.","line":2392,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2392,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2394,"column":17,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2394,"endColumn":66},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .hedge on an `any` value.","line":2394,"column":40,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2394,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2395,"column":17,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2395,"endColumn":70},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .hedge on an `any` value.","line":2395,"column":41,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2395,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2396,"column":17,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2396,"endColumn":55},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .hedge on an `any` value.","line":2396,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2396,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2398,"column":17,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2398,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .grossProfit on an `any` value.","line":2398,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2398,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2399,"column":17,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2399,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .netProfit on an `any` value.","line":2399,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2399,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2402,"column":13,"nodeType":"Property","messageId":"anyAssignment","endLine":2402,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .positionId on an `any` value.","line":2402,"column":29,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2402,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2403,"column":13,"nodeType":"Property","messageId":"anyAssignment","endLine":2403,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":2403,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2403,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2405,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":2405,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .primary on an `any` value.","line":2405,"column":29,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2405,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2406,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":2406,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .primary on an `any` value.","line":2406,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2406,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2407,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":2407,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .primary on an `any` value.","line":2407,"column":29,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2407,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2408,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":2408,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .primary on an `any` value.","line":2408,"column":29,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2408,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2409,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":2409,"endColumn":64},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .primary on an `any` value.","line":2409,"column":32,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2409,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2410,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":2410,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2411,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":2411,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2412,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":2412,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2414,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":2414,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .primary on an `any` value.","line":2414,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2414,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2415,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":2415,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .primary on an `any` value.","line":2415,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2415,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2416,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":2416,"endColumn":61},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .primary on an `any` value.","line":2416,"column":37,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2416,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2417,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":2417,"endColumn":57},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .primary on an `any` value.","line":2417,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2417,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2418,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":2418,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .primary on an `any` value.","line":2418,"column":29,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2418,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2420,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":2420,"endColumn":61},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .primary on an `any` value.","line":2420,"column":37,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2420,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2421,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":2421,"endColumn":57},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .primary on an `any` value.","line":2421,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2421,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2424,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":2424,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .hedge on an `any` value.","line":2424,"column":29,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2424,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2425,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":2425,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .hedge on an `any` value.","line":2425,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2425,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2426,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":2426,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .hedge on an `any` value.","line":2426,"column":29,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2426,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2427,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":2427,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .hedge on an `any` value.","line":2427,"column":29,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2427,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2428,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":2428,"endColumn":62},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .hedge on an `any` value.","line":2428,"column":32,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2428,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2429,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":2429,"endColumn":48},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2430,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":2430,"endColumn":52},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2431,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":2431,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2433,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":2433,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .hedge on an `any` value.","line":2433,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2433,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2434,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":2434,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .hedge on an `any` value.","line":2434,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2434,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2435,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":2435,"endColumn":59},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .hedge on an `any` value.","line":2435,"column":37,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2435,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2436,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":2436,"endColumn":55},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .hedge on an `any` value.","line":2436,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2436,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2437,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":2437,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .hedge on an `any` value.","line":2437,"column":29,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2437,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2439,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":2439,"endColumn":59},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .hedge on an `any` value.","line":2439,"column":37,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2439,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2440,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":2440,"endColumn":55},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .hedge on an `any` value.","line":2440,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2440,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2443,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":2443,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .graduatedEntry on an `any` value.","line":2443,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2443,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2444,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":2444,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .graduatedEntry on an `any` value.","line":2444,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2444,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .startedAt on an `any` value.","line":2446,"column":37,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2446,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2447,"column":13,"nodeType":"Property","messageId":"anyAssignment","endLine":2447,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .status on an `any` value.","line":2447,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2447,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2448,"column":13,"nodeType":"Property","messageId":"anyAssignment","endLine":2448,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2449,"column":13,"nodeType":"Property","messageId":"anyAssignment","endLine":2449,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2465,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2465,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[92118,92121],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[92118,92121],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2515,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2515,"endColumn":78},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2515,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2515,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[93683,93686],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[93683,93686],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .success on an `any` value.","line":2517,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2517,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":2517,"column":42,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2517,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2519,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":2519,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":2519,"column":34,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2519,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2520,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":2520,"endColumn":59},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":2520,"column":38,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2520,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":2523,"column":74,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2523,"endColumn":78},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .error on an `any` value.","line":2525,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2525,"endColumn":40},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2527,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2527,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[94151,94154],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[94151,94154],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2559,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2559,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[95220,95223],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[95220,95223],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":2572,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":2572,"endColumn":66,"suggestions":[{"messageId":"addBrackets","fix":{"range":[95567,95689],"text":"{ const bingxSymbol = this.normalizeSymbolForBingX(symbol);\r\n        return `https://bingx.com/en/perpetual/${bingxSymbol}`; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":2575,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":2575,"endColumn":119,"suggestions":[{"messageId":"addBrackets","fix":{"range":[95719,95897],"text":"{ const mexcSymbol = symbol.includes('_') ? symbol : symbol.replace(/USDT$/, '_USDT').replace(/USDC$/, '_USDC');\r\n        return `https://www.mexc.com/uk-UA/futures/${mexcSymbol}`; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":2578,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":2578,"endColumn":121,"suggestions":[{"messageId":"addBrackets","fix":{"range":[95929,96113],"text":"{ const gateioSymbol = symbol.includes('_') ? symbol : symbol.replace(/USDT$/, '_USDT').replace(/USDC$/, '_USDC');\r\n        return `https://www.gate.com/uk/futures/USDT/${gateioSymbol}`; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2663,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2663,"endColumn":67},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2668,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2668,"endColumn":68},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2669,"column":40,"nodeType":"Property","messageId":"anyAssignment","endLine":2669,"endColumn":48},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2674,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2674,"endColumn":68},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2676,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2676,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2680,"column":40,"nodeType":"Property","messageId":"anyAssignment","endLine":2680,"endColumn":63},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2683,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2683,"endColumn":80},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2684,"column":40,"nodeType":"Property","messageId":"anyAssignment","endLine":2684,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2687,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2687,"endColumn":84},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2688,"column":40,"nodeType":"Property","messageId":"anyAssignment","endLine":2688,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2709,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2709,"endColumn":78},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2712,"column":9,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2712,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2715,"column":42,"nodeType":"Property","messageId":"anyAssignment","endLine":2715,"endColumn":76},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2726,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2726,"endColumn":74},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2745,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2745,"endColumn":76},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2748,"column":9,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2748,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2751,"column":40,"nodeType":"Property","messageId":"anyAssignment","endLine":2751,"endColumn":72},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2762,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2762,"endColumn":78},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2869,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2869,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[105754,105757],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[105754,105757],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2883,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2883,"endColumn":92},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2883,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2883,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[106405,106408],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[106405,106408],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .success on an `any` value.","line":2885,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2885,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":2886,"column":81,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2886,"endColumn":85},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .error on an `any` value.","line":2894,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2894,"endColumn":40},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2896,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2896,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[106970,106973],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[106970,106973],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2898,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2898,"endColumn":82},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .error on an `any` value.","line":2898,"column":34,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2898,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":2898,"column":56,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2898,"endColumn":63},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2926,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2929,"endColumn":34},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2926,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2926,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[108046,108049],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[108046,108049],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .success on an `any` value.","line":2931,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2931,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":2932,"column":86,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2932,"endColumn":90},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .error on an `any` value.","line":2952,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2952,"endColumn":40},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2954,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2954,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[109009,109012],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[109009,109012],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2956,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2956,"endColumn":82},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .error on an `any` value.","line":2956,"column":34,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2956,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":2956,"column":56,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2956,"endColumn":63},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2995,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2995,"endColumn":95},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2995,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2995,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[110559,110562],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[110559,110562],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .success on an `any` value.","line":2997,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2997,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":2998,"column":83,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2998,"endColumn":87},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .error on an `any` value.","line":3001,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3001,"endColumn":40},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3003,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3003,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[111005,111008],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[111005,111008],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":3005,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":3005,"endColumn":82},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .error on an `any` value.","line":3005,"column":34,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3005,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":3005,"column":56,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3005,"endColumn":63},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":3070,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":3070,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":3076,"column":42,"nodeType":"Property","messageId":"anyAssignment","endLine":3076,"endColumn":62},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":3104,"column":42,"nodeType":"Property","messageId":"anyAssignment","endLine":3104,"endColumn":57},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":3116,"column":42,"nodeType":"Property","messageId":"anyAssignment","endLine":3116,"endColumn":63},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":3127,"column":42,"nodeType":"Property","messageId":"anyAssignment","endLine":3127,"endColumn":65},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":3144,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":3144,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":3150,"column":44,"nodeType":"Property","messageId":"anyAssignment","endLine":3150,"endColumn":66},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":3175,"column":44,"nodeType":"Property","messageId":"anyAssignment","endLine":3175,"endColumn":59},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":3187,"column":44,"nodeType":"Property","messageId":"anyAssignment","endLine":3187,"endColumn":65},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":3198,"column":44,"nodeType":"Property","messageId":"anyAssignment","endLine":3198,"endColumn":67},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":3217,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":3217,"endColumn":71},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":3218,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":3218,"endColumn":83},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":3223,"column":9,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":3223,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":3270,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":3270,"endColumn":69},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":3271,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":3271,"endColumn":81},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":3278,"column":9,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":3278,"endColumn":34},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3317,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3317,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[123750,123753],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[123750,123753],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":359,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, OnInit, OnDestroy, signal, computed, ElementRef, ViewChild, AfterViewInit, inject, effect } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { ReactiveFormsModule, FormControl, FormGroup, Validators } from '@angular/forms';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\r\nimport { lastValueFrom } from 'rxjs';\r\nimport { CardComponent, CardHeaderComponent, CardTitleComponent, CardContentComponent } from '../../ui/card/card.component';\r\nimport { ButtonComponent } from '../../ui/button/button.component';\r\nimport { createChart, IChartApi, ISeriesApi, LineData, Time, LineSeries } from 'lightweight-charts';\r\nimport { AuthService } from '../../../services/auth.service';\r\nimport { ThemeService } from '../../../services/theme.service';\r\nimport { ToastService } from '../../../services/toast.service';\r\nimport { ExchangeCredentialsService } from '../../../services/exchange-credentials.service';\r\nimport { ExchangeType } from '../../../models/exchange-credentials.model';\r\nimport { SymbolInfoService, SymbolInfo } from '../../../services/symbol-info.service';\r\nimport { TradingSettingsService } from '../../../services/trading-settings.service';\r\nimport { PublicFundingRatesService } from '../../../services/public-funding-rates.service';\r\nimport { getEndpointUrl, buildUrlWithQuery } from '../../../config/app.config';\r\nimport * as pako from 'pako';\r\n\r\ninterface ExchangeData {\r\n  exchange: string;\r\n  price: number;\r\n  fundingRate: string;\r\n  nextFundingTime: number;\r\n  fundingInterval?: number; // Funding interval in milliseconds (e.g., 8h = 28800000ms)\r\n  fundingIntervalStr?: string; // Funding interval as string (e.g., \"8h\", \"4h\", \"1h\") - from API/DB\r\n  lastUpdate: Date;\r\n}\r\n\r\ninterface ArbitragePosition {\r\n  positionId: string;\r\n  symbol: string;\r\n  primary: {\r\n    exchange: string;\r\n    side: string;\r\n    leverage: number;\r\n    quantity: number;\r\n    environment: string;\r\n    // Funding data\r\n    lastFundingPaid?: number;      // Last paid funding in USDT\r\n    totalFundingEarned?: number;   // Total sum of all fundings in USDT\r\n    tradingFees?: number;           // Trading fees on this exchange\r\n    // Liquidation data\r\n    liquidationPrice?: number;      // Liquidation price for this position\r\n    proximityRatio?: number;        // Proximity to liquidation (0.0-1.0+)\r\n    inDanger?: boolean;             // True if within 10% of liquidation\r\n    entryPrice?: number;            // Entry price for this position\r\n    currentPrice?: number;          // Current market price\r\n    // Stop Loss and Take Profit\r\n    stopLoss?: number;              // Stop loss price\r\n    takeProfit?: number;            // Take profit price\r\n    // P&L data (real-time from WebSocket)\r\n    unrealizedProfit?: number;      // Real-time unrealized P&L in USDT\r\n    realizedProfit?: number;        // Realized P&L in USDT\r\n  };\r\n  hedge: {\r\n    exchange: string;\r\n    side: string;\r\n    leverage: number;\r\n    quantity: number;\r\n    environment: string;\r\n    // Funding data\r\n    lastFundingPaid?: number;      // Last paid funding in USDT\r\n    totalFundingEarned?: number;   // Total sum of all fundings in USDT\r\n    tradingFees?: number;           // Trading fees on this exchange\r\n    // Liquidation data\r\n    liquidationPrice?: number;      // Liquidation price for this position\r\n    proximityRatio?: number;        // Proximity to liquidation (0.0-1.0+)\r\n    inDanger?: boolean;             // True if within 10% of liquidation\r\n    entryPrice?: number;            // Entry price for this position\r\n    currentPrice?: number;          // Current market price\r\n    // Stop Loss and Take Profit\r\n    stopLoss?: number;              // Stop loss price\r\n    takeProfit?: number;            // Take profit price\r\n    // P&L data (real-time from WebSocket)\r\n    unrealizedProfit?: number;      // Real-time unrealized P&L in USDT\r\n    realizedProfit?: number;        // Realized P&L in USDT\r\n  };\r\n  graduatedEntry: {\r\n    parts: number;\r\n    delayMs: number;\r\n  };\r\n  startedAt: Date;\r\n  status: string;\r\n  errorMessage?: string;           // Error message for failed positions\r\n  // Financial metrics\r\n  grossProfit?: number;            // Total funding earned (primary + hedge)\r\n  netProfit?: number;              // Gross profit - fees\r\n  // Liquidation monitoring status\r\n  monitoring?: {\r\n    enabled: boolean;              // Whether monitoring is enabled\r\n    status: string;                // \"active\", \"paused\", \"disabled\"\r\n    lastCheck?: Date;              // Last monitoring check timestamp\r\n  };\r\n}\r\n\r\n/**\r\n * Arbitrage Chart Component\r\n *\r\n * Displays comparative charts for arbitrage opportunities between two exchanges\r\n * with real-time WebSocket data\r\n */\r\n@Component({\r\n  selector: 'app-arbitrage-chart',\r\n  standalone: true,\r\n  imports: [\r\n    CommonModule,\r\n    ReactiveFormsModule,\r\n    CardComponent,\r\n    CardHeaderComponent,\r\n    CardTitleComponent,\r\n    CardContentComponent,\r\n    ButtonComponent\r\n  ],\r\n  templateUrl: './arbitrage-chart.component.html',\r\n  styleUrl: './arbitrage-chart.component.scss'\r\n})\r\nexport class ArbitrageChartComponent implements OnInit, OnDestroy, AfterViewInit {\r\n  @ViewChild('chartContainer', { static: false }) chartContainer!: ElementRef;\r\n\r\n  // Route parameters\r\n  symbol = signal<string>('');\r\n  primaryExchange = signal<string>('');\r\n  hedgeExchange = signal<string>('');\r\n  strategy = signal<string>('combined'); // Default to 'combined' strategy\r\n\r\n  // Loading state\r\n  loading = signal<boolean>(true);\r\n  loadingHistoricalData = signal<boolean>(false);\r\n\r\n  // Exchange data\r\n  primaryData = signal<ExchangeData>({\r\n    exchange: '',\r\n    price: 0,\r\n    fundingRate: '0.0000',\r\n    nextFundingTime: 0,\r\n    lastUpdate: new Date()\r\n  });\r\n\r\n  hedgeData = signal<ExchangeData>({\r\n    exchange: '',\r\n    price: 0,\r\n    fundingRate: '0.0000',\r\n    nextFundingTime: 0,\r\n    lastUpdate: new Date()\r\n  });\r\n\r\n  // Spread calculation\r\n  spread = signal<number>(0);\r\n  spreadPercent = signal<string>('0.0000');\r\n  fundingSpread = signal<number>(0); // Funding rate spread in percentage\r\n  primarySide = signal<'long' | 'short'>('long'); // Track primary side for price spread calculation\r\n\r\n  // Order forms\r\n  primaryOrderForm!: FormGroup;\r\n  hedgeOrderForm!: FormGroup;\r\n  isSubmittingOrder = signal<boolean>(false);\r\n\r\n  // Credentials validation\r\n  hasPrimaryCredentials = signal<boolean>(false);\r\n  hasHedgeCredentials = signal<boolean>(false);\r\n  credentialsWarning = signal<string>('');\r\n\r\n  // Exchange balances\r\n  primaryBalance = signal<{totalBalance: string; availableBalance: string; loading: boolean}>({\r\n    totalBalance: '0',\r\n    availableBalance: '0',\r\n    loading: false\r\n  });\r\n  hedgeBalance = signal<{totalBalance: string; availableBalance: string; loading: boolean}>({\r\n    totalBalance: '0',\r\n    availableBalance: '0',\r\n    loading: false\r\n  });\r\n\r\n  // Active positions\r\n  activePositions = signal<ArbitragePosition[]>([]);\r\n\r\n  // Filtered positions - only show positions for current symbol\r\n  filteredActivePositions = computed(() => {\r\n    const currentSymbol = this.symbol();\r\n    const allPositions = this.activePositions();\r\n\r\n    // If no symbol selected, show all positions\r\n    if (!currentSymbol) {\r\n      return allPositions;\r\n    }\r\n\r\n    // Filter positions that match the current symbol\r\n    const filtered = allPositions.filter(pos => pos.symbol === currentSymbol);\r\n    console.log(`[ArbitrageChart] Filtering positions: ${allPositions.length} total, ${filtered.length} for ${currentSymbol}`);\r\n\r\n    // DEBUG: Log filtered positions details\r\n    if (filtered.length > 0) {\r\n      console.log('[ArbitrageChart] Filtered positions:', filtered.map(p => ({\r\n        positionId: p.positionId,\r\n        symbol: p.symbol,\r\n        status: p.status,\r\n        primary: `${p.primary.exchange} (${p.primary.side})`,\r\n        hedge: `${p.hedge.exchange} (${p.hedge.side})`\r\n      })));\r\n    }\r\n\r\n    return filtered;\r\n  });\r\n\r\n  // Expanded rows state (set of position IDs)\r\n  expandedRows = signal<Set<string>>(new Set());\r\n\r\n  // Symbol info and validation\r\n  primarySymbolInfo = signal<SymbolInfo | null>(null);\r\n  hedgeSymbolInfo = signal<SymbolInfo | null>(null);\r\n  primaryValidation = signal<{valid: boolean; error?: string; suggestion?: string}>({valid: true});\r\n  hedgeValidation = signal<{valid: boolean; error?: string; suggestion?: string}>({valid: true});\r\n\r\n  // Timeframe selection\r\n  selectedTimeframe = signal<string>('1m');\r\n  timeframeOptions = [\r\n    { value: '1m', label: '1m' },\r\n    { value: '5m', label: '5m' },\r\n    { value: '15m', label: '15m' },\r\n    { value: '1h', label: '1h' },\r\n    { value: '4h', label: '4h' },\r\n    { value: '1d', label: '1D' }\r\n  ];\r\n\r\n  // Quantity unit selection (coin vs USDT)\r\n  primaryQuantityUnit = signal<'coin' | 'usdt'>('usdt');\r\n  hedgeQuantityUnit = signal<'coin' | 'usdt'>('usdt');\r\n  primaryDropdownOpen = signal<boolean>(false);\r\n  hedgeDropdownOpen = signal<boolean>(false);\r\n\r\n  // Order parameters synchronization lock\r\n  orderParamsLocked = signal<boolean>(true); // Default: locked (synchronized)\r\n\r\n  // Chart\r\n  private chart: IChartApi | null = null;\r\n  private primarySeries: ISeriesApi<'Line'> | null = null;\r\n  private hedgeSeries: ISeriesApi<'Line'> | null = null;\r\n  private chartInitRetries = 0;\r\n  private readonly MAX_CHART_INIT_RETRIES = 10;\r\n  private resizeObserver: ResizeObserver | null = null;\r\n\r\n  // Last candle tracking for timeframe synchronization\r\n  private lastPrimaryCandle: { time: number; price: number } | null = null;\r\n  private lastHedgeCandle: { time: number; price: number } | null = null;\r\n\r\n  // WebSocket connections\r\n  private primaryWs: WebSocket | null = null;\r\n  private hedgeWs: WebSocket | null = null;\r\n  private reconnectTimeout: ReturnType<typeof setTimeout> | null = null;\r\n\r\n  // Funding rates storage for both exchanges\r\n  private fundingRatesMap = new Map<string, { fundingRate: string; fundingTime: number; fundingInterval?: string }>();\r\n  private fundingRateRefreshInterval: ReturnType<typeof setInterval> | null = null;\r\n\r\n  // Track previous funding times to calculate intervals\r\n  private previousPrimaryFundingTime: number | null = null;\r\n  private previousHedgeFundingTime: number | null = null;\r\n\r\n  // MEXC ping intervals\r\n  private mexcPingIntervals = new Map<string, ReturnType<typeof setInterval>>();\r\n\r\n  // Destroyed flag to prevent updates after component destruction\r\n  private isDestroyed = false;\r\n\r\n  // Current time signal for funding countdown - updates every 10 seconds\r\n  private currentTime = signal<number>(Date.now());\r\n  private timeUpdateInterval: ReturnType<typeof setInterval> | null = null;\r\n\r\n  // Computed signals for formatted funding info to prevent ExpressionChangedAfterItHasBeenCheckedError\r\n  primaryFormattedFunding = computed(() => {\r\n    // Trigger recomputation when currentTime changes\r\n    this.currentTime();\r\n    return this.formatFundingInfo(\r\n      this.primaryData().fundingRate,\r\n      this.primaryData().nextFundingTime,\r\n      this.primaryData().fundingIntervalStr // From DB/API\r\n    );\r\n  });\r\n\r\n  hedgeFormattedFunding = computed(() => {\r\n    // Trigger recomputation when currentTime changes\r\n    this.currentTime();\r\n    return this.formatFundingInfo(\r\n      this.hedgeData().fundingRate,\r\n      this.hedgeData().nextFundingTime,\r\n      this.hedgeData().fundingIntervalStr // From DB/API\r\n    );\r\n  });\r\n\r\n  // Flags to prevent circular synchronization\r\n  private isSyncingQuantity = false;\r\n  private isSyncingSide = false;\r\n  private isSyncingLeverage = false;\r\n  private isSyncingGraduatedParts = false;\r\n  private isSyncingGraduatedDelay = false;\r\n\r\n  // Flag to track if user has manually selected sides\r\n  private hasManualSideSelection = false;\r\n\r\n  // Services\r\n  private http = inject(HttpClient);\r\n  private authService = inject(AuthService);\r\n  private themeService = inject(ThemeService);\r\n  private toastService = inject(ToastService);\r\n  private credentialsService = inject(ExchangeCredentialsService);\r\n  private symbolInfoService = inject(SymbolInfoService);\r\n  private tradingSettings = inject(TradingSettingsService);\r\n  private fundingRatesService = inject(PublicFundingRatesService);\r\n\r\n  constructor(\r\n    private route: ActivatedRoute,\r\n    private router: Router\r\n  ) {\r\n    // Watch for theme changes and update chart colors\r\n    effect(() => {\r\n      const theme = this.themeService.currentTheme();\r\n      console.log('[ArbitrageChart] Theme changed to:', theme);\r\n      if (this.chart) {\r\n        this.applyThemeToChart(theme);\r\n      }\r\n    });\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    // Get default values from global settings\r\n    const defaultLeverage = this.tradingSettings.getLeverage();\r\n    const defaultGraduatedParts = this.tradingSettings.getGraduatedParts();\r\n    const defaultGraduatedDelayMs = this.tradingSettings.getGraduatedDelayMs();\r\n    // Convert milliseconds to seconds for UI display\r\n    const defaultGraduatedDelaySec = defaultGraduatedDelayMs / 1000;\r\n\r\n    // Initialize order forms with graduated entry fields\r\n    this.primaryOrderForm = new FormGroup({\r\n      side: new FormControl('long', Validators.required),\r\n      leverage: new FormControl(defaultLeverage, [Validators.required, Validators.min(1), Validators.max(125)]),\r\n      quantity: new FormControl(0, [Validators.required, Validators.min(0.001)]),\r\n      graduatedParts: new FormControl(defaultGraduatedParts, [Validators.required, Validators.min(1), Validators.max(20)]),\r\n      graduatedDelayMs: new FormControl(defaultGraduatedDelaySec, [Validators.required, Validators.min(0.1), Validators.max(60)])\r\n    });\r\n\r\n    this.hedgeOrderForm = new FormGroup({\r\n      side: new FormControl('short', Validators.required),\r\n      leverage: new FormControl(defaultLeverage, [Validators.required, Validators.min(1), Validators.max(125)]),\r\n      quantity: new FormControl(0, [Validators.required, Validators.min(0.001)]),\r\n      graduatedParts: new FormControl(defaultGraduatedParts, [Validators.required, Validators.min(1), Validators.max(20)]),\r\n      graduatedDelayMs: new FormControl(defaultGraduatedDelaySec, [Validators.required, Validators.min(0.1), Validators.max(60)])\r\n    });\r\n\r\n    // Get route parameters\r\n    this.route.params.subscribe(params => {\r\n      this.symbol.set(params['symbol'] || '');\r\n      this.primaryExchange.set(params['primary'] || '');\r\n      this.hedgeExchange.set(params['hedge'] || '');\r\n      this.strategy.set(params['strategy'] || 'combined');\r\n\r\n      console.log('[ArbitrageChart] Loaded with params:', {\r\n        symbol: this.symbol(),\r\n        primary: this.primaryExchange(),\r\n        hedge: this.hedgeExchange(),\r\n        strategy: this.strategy()\r\n      });\r\n\r\n      // Adjust form for spot_futures strategy\r\n      if (this.strategy() === 'spot_futures') {\r\n        this.adjustFormsForSpotFutures();\r\n      }\r\n\r\n      // Initialize exchange data\r\n      this.primaryData.set({\r\n        ...this.primaryData(),\r\n        exchange: this.primaryExchange()\r\n      });\r\n\r\n      this.hedgeData.set({\r\n        ...this.hedgeData(),\r\n        exchange: this.hedgeExchange()\r\n      });\r\n\r\n      // Check credentials for both exchanges\r\n      this.checkExchangeCredentials();\r\n\r\n      // Load active positions\r\n      this.loadActivePositions();\r\n\r\n      // Load account balances\r\n      this.loadBalances();\r\n\r\n      // Fetch symbol info for both exchanges\r\n      this.fetchSymbolInfo();\r\n\r\n      // Set up form value watchers for real-time validation\r\n      this.setupFormValidation();\r\n\r\n      // Start loading\r\n      setTimeout(() => {\r\n        this.loading.set(false);\r\n      }, 500);\r\n    });\r\n\r\n    // Add click listener to close dropdowns when clicking outside\r\n    document.addEventListener('click', (event) => {\r\n      const target = event.target as HTMLElement;\r\n      if (!target.closest('.quantity-unit-dropdown')) {\r\n        this.primaryDropdownOpen.set(false);\r\n        this.hedgeDropdownOpen.set(false);\r\n      }\r\n    });\r\n\r\n    // Set up time update interval for funding countdown (every 10 seconds)\r\n    this.timeUpdateInterval = setInterval(() => {\r\n      if (!this.isDestroyed) {\r\n        this.currentTime.set(Date.now());\r\n      }\r\n    }, 10000); // Update every 10 seconds\r\n  }\r\n\r\n  /**\r\n   * Adjust forms for spot_futures strategy\r\n   * Primary = SPOT (no leverage, no side selector, simpler graduated entry)\r\n   * Hedge = FUTURES (full features)\r\n   */\r\n  private adjustFormsForSpotFutures(): void {\r\n    // Primary form (SPOT): Set leverage to 1x (non-editable in UI)\r\n    this.primaryOrderForm.get('leverage')?.setValue(1);\r\n    this.primaryOrderForm.get('leverage')?.disable();\r\n\r\n    // Primary form (SPOT): Set side to 'long' (buy only)\r\n    this.primaryOrderForm.get('side')?.setValue('long');\r\n    this.primaryOrderForm.get('side')?.disable();\r\n\r\n    // Primary form (SPOT): Adjust graduated entry limits for simpler spot trading\r\n    const primaryParts = this.primaryOrderForm.get('graduatedParts');\r\n    const primaryDelay = this.primaryOrderForm.get('graduatedDelayMs');\r\n\r\n    if (primaryParts) {\r\n      // Reduce max parts from 20 to 5 for spot\r\n      primaryParts.setValidators([Validators.required, Validators.min(1), Validators.max(5)]);\r\n      primaryParts.updateValueAndValidity();\r\n      // If current value exceeds new max, adjust it\r\n      if (primaryParts.value > 5) {\r\n        primaryParts.setValue(3);\r\n      }\r\n    }\r\n\r\n    if (primaryDelay) {\r\n      // Reduce max delay from 60s to 10s for spot\r\n      primaryDelay.setValidators([Validators.required, Validators.min(0.1), Validators.max(10)]);\r\n      primaryDelay.updateValueAndValidity();\r\n      // If current value exceeds new max, adjust it\r\n      if (primaryDelay.value > 10) {\r\n        primaryDelay.setValue(1);\r\n      }\r\n    }\r\n\r\n    // Disable sync lock for spot_futures strategy (different parameter sets)\r\n    this.orderParamsLocked.set(false);\r\n\r\n    console.log('[ArbitrageChart] Forms adjusted for spot_futures strategy', {\r\n      primaryLeverage: this.primaryOrderForm.get('leverage')?.value,\r\n      primarySide: this.primaryOrderForm.get('side')?.value,\r\n      primaryPartsMax: 5,\r\n      primaryDelayMax: 10,\r\n      syncLockDisabled: true\r\n    });\r\n  }\r\n\r\n  ngAfterViewInit(): void {\r\n    // Wait for view to be fully ready, then initialize chart with retry logic\r\n    this.tryInitializeChart(0);\r\n  }\r\n\r\n  /**\r\n   * Try to initialize chart with retry logic\r\n   */\r\n  private async tryInitializeChart(attempt: number): Promise<void> {\r\n    const MAX_ATTEMPTS = 5;\r\n    const RETRY_DELAY = 300;\r\n\r\n    if (attempt >= MAX_ATTEMPTS) {\r\n      console.warn('[ArbitrageChart] Chart container not available after', MAX_ATTEMPTS, 'attempts');\r\n      return;\r\n    }\r\n\r\n    if (!this.chartContainer) {\r\n      // ViewChild not ready yet, retry\r\n      setTimeout(() => this.tryInitializeChart(attempt + 1), RETRY_DELAY);\r\n      return;\r\n    }\r\n\r\n    // Chart container is ready, initialize\r\n    this.initializeChart();\r\n\r\n    // Load historical data first\r\n    await this.loadHistoricalData();\r\n\r\n    // Then connect WebSockets for real-time updates\r\n    this.connectWebSockets();\r\n\r\n    // Start interval to update cached \"now\" time every 10 seconds\r\n    // This prevents ExpressionChangedAfterItHasBeenCheckedError in formatTimestamp()\r\n    this.nowUpdateInterval = setInterval(() => {\r\n      this.cachedNow = new Date();\r\n    }, 10000); // Update every 10 seconds\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    // Set destroyed flag to prevent updates after cleanup\r\n    this.isDestroyed = true;\r\n\r\n    // Cleanup\r\n    this.disconnectWebSockets();\r\n\r\n    // Clear MEXC ping intervals (redundant with disconnectWebSockets, but safe)\r\n    this.mexcPingIntervals.forEach((interval) => {\r\n      clearInterval(interval);\r\n    });\r\n    this.mexcPingIntervals.clear();\r\n\r\n    // Clear cached now update interval\r\n    if (this.nowUpdateInterval) {\r\n      clearInterval(this.nowUpdateInterval);\r\n      this.nowUpdateInterval = null;\r\n    }\r\n\r\n    // Clear funding rate refresh interval\r\n    if (this.fundingRateRefreshInterval) {\r\n      clearInterval(this.fundingRateRefreshInterval);\r\n      this.fundingRateRefreshInterval = null;\r\n    }\r\n\r\n    // Clear Gate.io API refresh interval\r\n    if (this.gateioRefreshInterval) {\r\n      clearInterval(this.gateioRefreshInterval);\r\n      this.gateioRefreshInterval = undefined;\r\n    }\r\n\r\n    // Clear time update interval\r\n    if (this.timeUpdateInterval) {\r\n      clearInterval(this.timeUpdateInterval);\r\n      this.timeUpdateInterval = null;\r\n    }\r\n\r\n    // Remove resize observer\r\n    if (this.resizeObserver) {\r\n      this.resizeObserver.disconnect();\r\n      this.resizeObserver = null;\r\n    }\r\n\r\n    // Clear reconnect timeout\r\n    if (this.reconnectTimeout) {\r\n      clearTimeout(this.reconnectTimeout);\r\n      this.reconnectTimeout = null;\r\n    }\r\n\r\n    // Remove chart last to ensure all updates are blocked\r\n    if (this.chart) {\r\n      this.chart.remove();\r\n      this.chart = null;\r\n    }\r\n\r\n    // Nullify series\r\n    this.primarySeries = null;\r\n    this.hedgeSeries = null;\r\n  }\r\n\r\n  /**\r\n   * Get chart colors based on current theme\r\n   */\r\n  private getChartColors(theme: 'light' | 'dark') {\r\n    if (theme === 'dark') {\r\n      return {\r\n        background: '#1e1e1e',\r\n        textColor: '#f9fafb',\r\n        gridColor: 'rgba(59, 130, 246, 0.2)',\r\n        borderColor: 'rgba(255, 255, 255, 0.1)',\r\n      };\r\n    } else {\r\n      return {\r\n        background: '#ffffff',\r\n        textColor: '#111827',\r\n        gridColor: 'rgba(59, 130, 246, 0.3)',\r\n        borderColor: '#e5e7eb',\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Apply theme colors to chart\r\n   */\r\n  private applyThemeToChart(theme: 'light' | 'dark'): void {\r\n    // Guard against updates after component destruction\r\n    if (this.isDestroyed || !this.chart) {\r\n      return;\r\n    }\r\n\r\n    const colors = this.getChartColors(theme);\r\n\r\n    this.chart.applyOptions({\r\n      layout: {\r\n        background: { color: colors.background },\r\n        textColor: colors.textColor,\r\n      },\r\n      grid: {\r\n        vertLines: { color: colors.gridColor },\r\n        horzLines: { color: colors.gridColor },\r\n      },\r\n      rightPriceScale: {\r\n        borderColor: colors.borderColor,\r\n      },\r\n      timeScale: {\r\n        borderColor: colors.borderColor,\r\n      },\r\n    });\r\n\r\n    console.log('[ArbitrageChart] Applied theme colors:', theme, colors);\r\n  }\r\n\r\n  /**\r\n   * Initialize TradingView Lightweight Chart\r\n   */\r\n  private initializeChart(): void {\r\n    if (!this.chartContainer) {\r\n      console.warn('[ArbitrageChart] Chart container not yet available, will retry');\r\n      return;\r\n    }\r\n\r\n    const chartElement = this.chartContainer.nativeElement as HTMLElement;\r\n\r\n    // Ensure container has dimensions (similar to lightweight-chart component)\r\n    if (chartElement.clientWidth === 0 || chartElement.clientHeight === 0) {\r\n      this.chartInitRetries++;\r\n      if (this.chartInitRetries >= this.MAX_CHART_INIT_RETRIES) {\r\n        console.error('[ArbitrageChart] Failed to initialize chart after', this.MAX_CHART_INIT_RETRIES, 'retries');\r\n        // Set explicit dimensions as fallback\r\n        chartElement.style.width = '100%';\r\n        chartElement.style.height = '500px';\r\n      } else {\r\n        console.warn(`[ArbitrageChart] Container has no dimensions, retrying in 200ms... (attempt ${this.chartInitRetries}/${this.MAX_CHART_INIT_RETRIES})`);\r\n        setTimeout(() => this.initializeChart(), 200);\r\n        return;\r\n      }\r\n    }\r\n\r\n    const containerWidth = chartElement.clientWidth || 800;\r\n    console.log('[ArbitrageChart] Initializing chart with width:', containerWidth);\r\n    this.chartInitRetries = 0; // Reset retry counter on success\r\n\r\n    // Get current theme colors\r\n    const theme = this.themeService.currentTheme();\r\n    const colors = this.getChartColors(theme);\r\n\r\n    // Create chart\r\n    this.chart = createChart(chartElement, {\r\n      width: containerWidth,\r\n      height: 500,\r\n      layout: {\r\n        background: { color: colors.background },\r\n        textColor: colors.textColor,\r\n      },\r\n      grid: {\r\n        vertLines: { color: colors.gridColor },\r\n        horzLines: { color: colors.gridColor },\r\n      },\r\n      crosshair: {\r\n        mode: 1, // CrosshairMode.Normal\r\n      },\r\n      rightPriceScale: {\r\n        borderColor: colors.borderColor,\r\n      },\r\n      timeScale: {\r\n        borderColor: colors.borderColor,\r\n        timeVisible: true,\r\n        secondsVisible: false, // Will be toggled based on timeframe\r\n        rightOffset: 12,\r\n        barSpacing: 10,\r\n        minBarSpacing: 0.5,\r\n        fixLeftEdge: false,\r\n        fixRightEdge: false,\r\n        lockVisibleTimeRangeOnResize: true,\r\n        rightBarStaysOnScroll: true,\r\n        borderVisible: true,\r\n        visible: true,\r\n      },\r\n      localization: {\r\n        locale: 'uk-UA', // Ukrainian locale for date/time formatting\r\n        timeFormatter: (time: number) => {\r\n          // Convert Unix timestamp (seconds) to JavaScript Date (milliseconds)\r\n          const date = new Date(time * 1000);\r\n\r\n          // Use local time zone\r\n          const hours = date.getHours().toString().padStart(2, '0');\r\n          const minutes = date.getMinutes().toString().padStart(2, '0');\r\n          const seconds = date.getSeconds().toString().padStart(2, '0');\r\n\r\n          // Format based on timeframe\r\n          const timeframe = this.selectedTimeframe();\r\n          if (timeframe === '1m' || timeframe === '5m') {\r\n            // Show hours:minutes:seconds for short timeframes\r\n            return `${hours}:${minutes}:${seconds}`;\r\n          } else if (timeframe === '15m' || timeframe === '1h') {\r\n            // Show hours:minutes for medium timeframes\r\n            return `${hours}:${minutes}`;\r\n          } else {\r\n            // For 4h and 1d, show date + time\r\n            const day = date.getDate().toString().padStart(2, '0');\r\n            const month = (date.getMonth() + 1).toString().padStart(2, '0');\r\n            return `${day}.${month} ${hours}:${minutes}`;\r\n          }\r\n        },\r\n        priceFormatter: (price: number) => {\r\n          // Format price with 4 decimal places\r\n          return price.toFixed(4);\r\n        },\r\n      },\r\n    });\r\n\r\n    // Add Primary Exchange series (blue line)\r\n    this.primarySeries = this.chart.addSeries(LineSeries, {\r\n      color: '#3b82f6',\r\n      lineWidth: 2,\r\n      title: this.primaryExchange(),\r\n    });\r\n\r\n    // Add Hedge Exchange series (purple line)\r\n    this.hedgeSeries = this.chart.addSeries(LineSeries, {\r\n      color: '#a855f7',\r\n      lineWidth: 2,\r\n      title: this.hedgeExchange(),\r\n    });\r\n\r\n    // Handle window resize with ResizeObserver (better than window.addEventListener)\r\n    this.setupResizeHandler();\r\n  }\r\n\r\n  /**\r\n   * Setup ResizeObserver for automatic chart resizing\r\n   */\r\n  private setupResizeHandler(): void {\r\n    this.resizeObserver = new ResizeObserver(entries => {\r\n      // Guard against updates after component destruction\r\n      if (this.isDestroyed || !this.chart) {\r\n        return;\r\n      }\r\n\r\n      if (entries.length > 0) {\r\n        const { width } = entries[0].contentRect;\r\n        if (width > 0) {\r\n          this.chart.applyOptions({ width });\r\n        }\r\n      }\r\n    });\r\n\r\n    if (this.chartContainer?.nativeElement) {\r\n      this.resizeObserver.observe(this.chartContainer.nativeElement);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Connect to WebSocket for real-time price data\r\n   */\r\n  private async connectWebSockets(): Promise<void> {\r\n    const symbol = this.symbol();\r\n    const primaryExchange = this.primaryExchange().toUpperCase();\r\n    const hedgeExchange = this.hedgeExchange().toUpperCase();\r\n\r\n    console.log('[ArbitrageChart] Connecting WebSockets for', { symbol, primaryExchange, hedgeExchange });\r\n\r\n    // Fetch funding rates for both exchanges\r\n    await this.fetchFundingRates();\r\n\r\n    // Set up periodic refresh for funding rates (every 2 minutes)\r\n    this.fundingRateRefreshInterval = setInterval(() => {\r\n      if (!this.isDestroyed) {\r\n        console.log('[ArbitrageChart] Refreshing funding rates...');\r\n        this.fetchFundingRates();\r\n      }\r\n    }, 2 * 60 * 1000); // 2 minutes\r\n\r\n    console.log('[ArbitrageChart] Funding rate refresh interval set (2 minutes)');\r\n\r\n\r\n    // Connect to Primary Exchange\r\n    this.connectExchangeWebSocket(\r\n      primaryExchange,\r\n      symbol,\r\n      (price: number, fundingRate?: string, nextFundingTime?: number) => {\r\n        this.updatePrimaryData(price, fundingRate, nextFundingTime);\r\n      }\r\n    );\r\n\r\n    // Connect to Hedge Exchange\r\n    this.connectExchangeWebSocket(\r\n      hedgeExchange,\r\n      symbol,\r\n      (price: number, fundingRate?: string, nextFundingTime?: number) => {\r\n        this.updateHedgeData(price, fundingRate, nextFundingTime);\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Convert symbol to BingX format (e.g., BTCUSDT -> BTC-USDT)\r\n   * Also handles CCXT perpetual contract format (e.g., BTC/USDT:USDT -> BTC-USDT)\r\n   */\r\n  private normalizeSymbolForBingX(symbol: string): string {\r\n    // First, remove CCXT perpetual contract suffix (e.g., :USDT)\r\n    let cleanSymbol = symbol.replace(/:.*$/, '');\r\n\r\n    // Remove slashes (CCXT format BTC/USDT -> BTCUSDT)\r\n    cleanSymbol = cleanSymbol.replace(/\\//g, '');\r\n\r\n    // If already has hyphen, return as-is\r\n    if (cleanSymbol.includes('-')) {\r\n      return cleanSymbol;\r\n    }\r\n\r\n    // BingX perpetual futures use USDT or USDC as quote currency\r\n    if (cleanSymbol.endsWith('USDT')) {\r\n      const base = cleanSymbol.slice(0, -4);\r\n      return `${base}-USDT`;\r\n    }\r\n\r\n    if (cleanSymbol.endsWith('USDC')) {\r\n      const base = cleanSymbol.slice(0, -4);\r\n      return `${base}-USDC`;\r\n    }\r\n\r\n    return cleanSymbol;\r\n  }\r\n\r\n  /**\r\n   * Connect to specific exchange WebSocket\r\n   */\r\n  private connectExchangeWebSocket(\r\n    exchange: string,\r\n    symbol: string,\r\n    onUpdate: (price: number, fundingRate?: string, nextFundingTime?: number, fundingInterval?: string) => void\r\n  ): void {\r\n    let ws: WebSocket | null = null;\r\n\r\n    // Determine WebSocket URL based on exchange\r\n    let wsUrl = '';\r\n    let subscribeMessage: any = null;\r\n\r\n    switch (exchange) {\r\n      case 'BYBIT':\r\n        wsUrl = 'wss://stream.bybit.com/v5/public/linear';\r\n        subscribeMessage = {\r\n          op: 'subscribe',\r\n          args: [`tickers.${symbol}`]\r\n        };\r\n        break;\r\n\r\n      case 'BINGX':\r\n        // Convert symbol to BingX format (e.g., BTCUSDT -> BTC-USDT)\r\n        const bingxSymbol = this.normalizeSymbolForBingX(symbol);\r\n        wsUrl = 'wss://open-api-swap.bingx.com/swap-market';\r\n        subscribeMessage = {\r\n          id: Date.now().toString(),\r\n          reqType: 'sub',\r\n          dataType: `${bingxSymbol}@ticker`\r\n        };\r\n        console.log(`[ArbitrageChart] BingX symbol normalized: ${symbol} -> ${bingxSymbol}`);\r\n        break;\r\n\r\n      case 'MEXC':\r\n        // Convert symbol to MEXC format (e.g., BTCUSDT -> BTC_USDT)\r\n        const mexcSymbol = symbol.includes('_') ? symbol : symbol.replace(/USDT$/, '_USDT').replace(/USDC$/, '_USDC');\r\n        // Correct MEXC futures WebSocket URL\r\n        wsUrl = 'wss://contract.mexc.com/edge';\r\n        subscribeMessage = {\r\n          method: 'sub.ticker',\r\n          param: {\r\n            symbol: mexcSymbol\r\n          }\r\n        };\r\n        console.log(`[ArbitrageChart] MEXC symbol normalized: ${symbol} -> ${mexcSymbol}`);\r\n        break;\r\n\r\n      case 'OKX':\r\n        wsUrl = 'wss://ws.okx.com:8443/ws/v5/public';\r\n        subscribeMessage = {\r\n          op: 'subscribe',\r\n          args: [{\r\n            channel: 'tickers',\r\n            instId: symbol\r\n          }]\r\n        };\r\n        break;\r\n\r\n      case 'GATEIO':\r\n        // Gate.io doesn't have public WebSocket for funding rates\r\n        // Use REST API data from our backend instead\r\n        this.connectGateIOViaAPI(symbol, onUpdate);\r\n        return;\r\n\r\n      default:\r\n        console.warn(`[ArbitrageChart] Unsupported exchange: ${exchange}`);\r\n        // Simulate data for unsupported exchanges\r\n        this.simulateExchangeData(exchange, symbol, onUpdate);\r\n        return;\r\n    }\r\n\r\n    // Create WebSocket connection\r\n    ws = new WebSocket(wsUrl);\r\n\r\n    ws.onopen = () => {\r\n      // console.log(`[ArbitrageChart] ${exchange} WebSocket connected`);\r\n      if (ws && subscribeMessage) {\r\n        // console.log(`[ArbitrageChart] ${exchange} subscribing with:`, subscribeMessage);\r\n        ws.send(JSON.stringify(subscribeMessage));\r\n      }\r\n\r\n      // For MEXC, start ping interval to keep connection alive\r\n      // MEXC requires ping every 15-20 seconds or connection closes after 1 minute\r\n      if (exchange === 'MEXC') {\r\n        const pingInterval = setInterval(() => {\r\n          if (!this.isDestroyed && ws && ws.readyState === WebSocket.OPEN) {\r\n            ws.send(JSON.stringify({ method: 'ping' }));\r\n            // console.log(`[ArbitrageChart] MEXC Ping sent`);\r\n          }\r\n        }, 15000); // Send ping every 15 seconds\r\n\r\n        this.mexcPingIntervals.set(exchange, pingInterval);\r\n        // console.log(`[ArbitrageChart] MEXC ping interval started (15s)`);\r\n      }\r\n    };\r\n\r\n    ws.onmessage = async (event) => {\r\n      try {\r\n        let messageData: string;\r\n\r\n        // Handle Blob data (BingX sends data as gzip-compressed Blob)\r\n        if (event.data instanceof Blob) {\r\n          const arrayBuffer = await event.data.arrayBuffer();\r\n          const uint8Array = new Uint8Array(arrayBuffer);\r\n\r\n          try {\r\n            // Try to decompress with pako\r\n            const decompressed = pako.inflate(uint8Array, { to: 'string' });\r\n            messageData = decompressed;\r\n          } catch (decompressError) {\r\n            // If decompression fails, try as plain text\r\n            console.warn(`[ArbitrageChart] ${exchange} decompression failed, trying as plain text:`, decompressError);\r\n            messageData = await event.data.text();\r\n          }\r\n        } else {\r\n          messageData = event.data;\r\n        }\r\n\r\n        // Handle BingX Ping/Pong\r\n        if (exchange === 'BINGX' && messageData === 'Ping') {\r\n          if (ws) {\r\n            ws.send('Pong');\r\n            // console.log(`[ArbitrageChart] BingX Pong sent`);\r\n          }\r\n          return;\r\n        }\r\n\r\n        const data = JSON.parse(messageData);\r\n\r\n        // Handle MEXC Pong response (server responds to our ping)\r\n        if (exchange === 'MEXC' && data.channel === 'pong') {\r\n          // console.log(`[ArbitrageChart] MEXC Pong received:`, data.data);\r\n          return;\r\n        }\r\n\r\n        // Debug logging for BingX\r\n        // if (exchange === 'BINGX') {\r\n        //   console.log(`[ArbitrageChart] BingX WebSocket message:`, data);\r\n        // }\r\n\r\n        this.handleExchangeMessage(exchange, data, onUpdate);\r\n      } catch (error) {\r\n        console.error(`[ArbitrageChart] ${exchange} message parse error:`, error);\r\n      }\r\n    };\r\n\r\n    ws.onerror = (error) => {\r\n      console.error(`[ArbitrageChart] ${exchange} WebSocket error:`, error);\r\n    };\r\n\r\n    ws.onclose = () => {\r\n      console.log(`[ArbitrageChart] ${exchange} WebSocket closed`);\r\n      // Only reconnect if component is not destroyed\r\n      if (!this.isDestroyed) {\r\n        this.reconnectTimeout = setTimeout(() => {\r\n          if (!this.isDestroyed) {\r\n            console.log(`[ArbitrageChart] Reconnecting ${exchange}...`);\r\n            this.connectExchangeWebSocket(exchange, symbol, onUpdate);\r\n          }\r\n        }, 5000);\r\n      }\r\n    };\r\n\r\n    // Store WebSocket reference\r\n    if (exchange === this.primaryExchange().toUpperCase()) {\r\n      this.primaryWs = ws;\r\n    } else {\r\n      this.hedgeWs = ws;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle exchange-specific message format\r\n   */\r\n  private handleExchangeMessage(\r\n    exchange: string,\r\n    data: any,\r\n    onUpdate: (price: number, fundingRate?: string, nextFundingTime?: number, fundingInterval?: string) => void\r\n  ): void {\r\n    let price: number | null = null;\r\n    let fundingRate: string | undefined;\r\n    let nextFundingTime: number | undefined;\r\n    let fundingInterval: string | undefined;\r\n\r\n    switch (exchange) {\r\n      case 'BYBIT':\r\n        if (data.topic && data.topic.startsWith('tickers.') && data.data) {\r\n          // Bybit sends two types of messages:\r\n          // - \"snapshot\": full ticker data with all fields\r\n          // - \"delta\": partial updates with only changed fields\r\n          // We only process messages that have lastPrice (typically snapshots or deltas with price updates)\r\n\r\n          if (!data.data.lastPrice) {\r\n            // Delta messages without lastPrice are normal - just skip silently\r\n            // Only log if it's a snapshot message without lastPrice (unusual)\r\n            if (data.type === 'snapshot') {\r\n              console.warn(`[ArbitrageChart] BYBIT snapshot missing lastPrice:`, data);\r\n            }\r\n            return;\r\n          }\r\n\r\n          price = parseFloat(data.data.lastPrice);\r\n          fundingRate = data.data.fundingRate;\r\n\r\n          // Validate price is a valid number\r\n          if (isNaN(price) || price <= 0) {\r\n            console.error(`[ArbitrageChart] BYBIT invalid price after parsing:`, {\r\n              type: data.type,\r\n              rawLastPrice: data.data.lastPrice,\r\n              parsedPrice: price,\r\n              fullData: data\r\n            });\r\n            return;\r\n          }\r\n\r\n          // Parse nextFundingTime - ensure it's a valid number\r\n          if (data.data.nextFundingTime) {\r\n            const parsedTime = typeof data.data.nextFundingTime === 'string'\r\n              ? parseInt(data.data.nextFundingTime)\r\n              : Number(data.data.nextFundingTime);\r\n\r\n            if (!isNaN(parsedTime) && parsedTime > 0) {\r\n              nextFundingTime = parsedTime;\r\n            }\r\n          }\r\n\r\n          // Extract fundingInterval from BYBIT ticker (e.g., \"4h\", \"8h\", \"1h\")\r\n          if (data.data.fundingInterval) {\r\n            fundingInterval = data.data.fundingInterval;\r\n          }\r\n\r\n          // console.log(`[ArbitrageChart] BYBIT ticker parsed (${data.type || 'unknown'}):`, {\r\n          //   rawLastPrice: data.data.lastPrice,\r\n          //   parsedPrice: price,\r\n          //   rawNextFundingTime: data.data.nextFundingTime,\r\n          //   nextFundingTime: nextFundingTime,\r\n          //   fundingRate: fundingRate,\r\n          //   fundingInterval: fundingInterval\r\n          // });\r\n        } else {\r\n          console.warn(`[ArbitrageChart] BYBIT message format not recognized:`, data);\r\n        }\r\n        break;\r\n\r\n      case 'BINGX':\r\n        // BingX ticker format: { \"dataType\": \"BTC-USDT@ticker\", \"data\": { \"c\": \"50000.5\", \"E\": timestamp } }\r\n        if (data.dataType && data.dataType.includes('@ticker') && data.data) {\r\n          const tickerData = data.data;\r\n          price = parseFloat(tickerData.c); // 'c' = close/last price\r\n\r\n          // Debug logging\r\n          // console.log(`[ArbitrageChart] BingX price parsed:`, {\r\n          //   rawC: tickerData.c,\r\n          //   parsedPrice: price,\r\n          //   isValid: !isNaN(price) && price > 0\r\n          // });\r\n\r\n          // Get funding rate from stored map (BingX ticker doesn't include funding rates)\r\n          const symbolForLookup = data.dataType.split('@')[0]; // Extract symbol from dataType\r\n          const fundingData = this.getFundingRate('BINGX', symbolForLookup);\r\n          fundingRate = fundingData.fundingRate;\r\n          nextFundingTime = fundingData.nextFundingTime;\r\n\r\n          // console.log(`[ArbitrageChart] BingX funding data for ${symbolForLookup}:`, {\r\n          //   fundingRate,\r\n          //   nextFundingTime\r\n          // });\r\n        } else {\r\n          console.warn(`[ArbitrageChart] BingX message format not recognized:`, data);\r\n        }\r\n        break;\r\n\r\n      case 'MEXC':\r\n        if (data.channel === 'push.ticker' && data.data) {\r\n          // MEXC format: { channel: \"push.ticker\", data: { lastPrice, fundingRate, ... } }\r\n          price = parseFloat(data.data.lastPrice);\r\n\r\n          // Convert funding rate to string (MEXC returns numeric fundingRate)\r\n          if (data.data.fundingRate !== undefined && data.data.fundingRate !== null) {\r\n            fundingRate = data.data.fundingRate.toString();\r\n          }\r\n\r\n          // IMPORTANT: MEXC doesn't provide nextFundingTime in WebSocket ticker\r\n          // DO NOT calculate it locally - funding intervals can vary by symbol and change over time\r\n          // We rely on the backend API (/api/arbitrage/funding-rates) to provide accurate nextFundingTime\r\n          // The existing nextFundingTime from fundingRatesMap will be used\r\n        }\r\n        break;\r\n\r\n      case 'OKX':\r\n        if (data.arg && data.arg.channel === 'tickers' && data.data && data.data[0]) {\r\n          price = parseFloat(data.data[0].last);\r\n          fundingRate = data.data[0].fundingRate;\r\n          nextFundingTime = parseInt(data.data[0].nextFundingTime);\r\n        }\r\n        break;\r\n    }\r\n\r\n    if (price !== null && price > 0) {\r\n      // console.log(`[ArbitrageChart] ${exchange} calling onUpdate with:`, { price, fundingRate, nextFundingTime, fundingInterval });\r\n      onUpdate(price, fundingRate, nextFundingTime, fundingInterval);\r\n    } else {\r\n      console.warn(`[ArbitrageChart] ${exchange} price invalid or zero:`, price);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Connect to Gate.io via our backend API (no direct WebSocket support)\r\n   */\r\n  private async connectGateIOViaAPI(\r\n    symbol: string,\r\n    onUpdate: (price: number, fundingRate?: string, nextFundingTime?: number, fundingInterval?: string) => void\r\n  ): Promise<void> {\r\n    const fetchGateIOData = async () => {\r\n      try {\r\n        const url = '/api/gateio/public-funding-rates';\r\n        const response = await this.http.get<any>(url).toPromise();\r\n\r\n        if (response && Array.isArray(response)) {\r\n          // Find our symbol in the response\r\n          const normalizedSymbol = symbol.replace('USDT', '_USDT').replace('USDC', '_USDC');\r\n          const symbolData = response.find((item: any) => \r\n            item.name === normalizedSymbol || item.symbol === normalizedSymbol\r\n          );\r\n\r\n          if (symbolData) {\r\n            const price = parseFloat(symbolData.last_price || symbolData.lastPrice || '0');\r\n            const fundingRate = symbolData.funding_rate || symbolData.fundingRate;\r\n            const nextFundingTime = (symbolData.funding_next_apply || symbolData.nextFundingTime) * 1000; // Convert to ms\r\n\r\n            if (price > 0) {\r\n              console.log(`[ArbitrageChart] Gate.io data updated:`, {\r\n                symbol: normalizedSymbol,\r\n                price,\r\n                fundingRate,\r\n                nextFundingTime\r\n              });\r\n              onUpdate(price, fundingRate, nextFundingTime);\r\n            }\r\n          } else {\r\n            console.warn(`[ArbitrageChart] Gate.io symbol not found: ${normalizedSymbol}`);\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error('[ArbitrageChart] Gate.io API error:', error);\r\n      }\r\n    };\r\n\r\n    // Initial fetch\r\n    await fetchGateIOData();\r\n\r\n    // Refresh every 30 seconds (not real-time like WebSocket, but proper data)\r\n    const interval = setInterval(() => {\r\n      if (!this.isDestroyed) {\r\n        fetchGateIOData();\r\n      }\r\n    }, 30000);\r\n\r\n    // Store interval for cleanup\r\n    if (!this.gateioRefreshInterval) {\r\n      this.gateioRefreshInterval = interval;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Simulate data for testing or unsupported exchanges\r\n   */\r\n  private simulateExchangeData(\r\n    exchange: string,\r\n    symbol: string,\r\n    onUpdate: (price: number, fundingRate?: string, nextFundingTime?: number, fundingInterval?: string) => void\r\n  ): void {\r\n    let basePrice = 50000 + Math.random() * 1000;\r\n\r\n    setInterval(() => {\r\n      // Random price fluctuation\r\n      basePrice += (Math.random() - 0.5) * 100;\r\n      const fundingRate = (Math.random() * 0.001 - 0.0005).toFixed(6);\r\n      const nextFundingTime = Date.now() + 8 * 60 * 60 * 1000; // 8 hours from now\r\n\r\n      onUpdate(basePrice, fundingRate, nextFundingTime);\r\n    }, 2000); // Update every 2 seconds\r\n  }\r\n\r\n  /**\r\n   * Fetch funding rates for both exchanges from optimized endpoint\r\n   * Uses the new /api/arbitrage/public-funding-rates endpoint which returns only needed data\r\n   */\r\n  private async fetchFundingRates(): Promise<void> {\r\n    try {\r\n      const currentSymbol = this.symbol();\r\n      const primaryEx = this.primaryExchange().toUpperCase();\r\n      const hedgeEx = this.hedgeExchange().toUpperCase();\r\n\r\n      if (!currentSymbol || !primaryEx || !hedgeEx) {\r\n        console.warn('[ArbitrageChart] Missing symbol or exchange data, skipping funding rates fetch');\r\n        return;\r\n      }\r\n\r\n      console.log(`[ArbitrageChart] Fetching funding rates for ${primaryEx} and ${hedgeEx} - ${currentSymbol}`);\r\n\r\n      // Use the new optimized endpoint - only fetch data for needed exchanges\r\n      const exchanges = [primaryEx, hedgeEx];\r\n      const fundingRates = await lastValueFrom(\r\n        this.fundingRatesService.getArbitrageFundingRates(exchanges, currentSymbol)\r\n      );\r\n\r\n      console.log(`[ArbitrageChart] Received ${fundingRates.length} funding rates`);\r\n\r\n      // Store all rates in map with exchange-symbol as key\r\n      this.fundingRatesMap.clear();\r\n      fundingRates.forEach(rate => {\r\n        const key = `${rate.exchange}-${rate.symbol}`;\r\n        this.fundingRatesMap.set(key, {\r\n          fundingRate: rate.fundingRate,\r\n          fundingTime: rate.nextFundingTime,\r\n          fundingInterval: rate.fundingInterval // e.g., \"8h\", \"4h\", \"1h\" - from DB\r\n        });\r\n\r\n        console.log(`[ArbitrageChart] Stored funding rate: ${key}`, {\r\n          rate: rate.fundingRate,\r\n          interval: rate.fundingInterval,\r\n          nextTime: new Date(rate.nextFundingTime).toISOString()\r\n        });\r\n      });\r\n\r\n      // Update primary exchange data\r\n      const primaryData = this.getFundingRate(primaryEx, currentSymbol);\r\n      if (primaryData.fundingRate && primaryData.nextFundingTime && primaryData.fundingInterval) {\r\n        console.log('[ArbitrageChart] Updating primary with funding data:', primaryData);\r\n        this.updatePrimaryData(\r\n          this.primaryData().price || 0,\r\n          primaryData.fundingRate,\r\n          primaryData.nextFundingTime\r\n        );\r\n      }\r\n\r\n      // Update hedge exchange data\r\n      const hedgeData = this.getFundingRate(hedgeEx, currentSymbol);\r\n      if (hedgeData.fundingRate && hedgeData.nextFundingTime && hedgeData.fundingInterval) {\r\n        console.log('[ArbitrageChart] Updating hedge with funding data:', hedgeData);\r\n        this.updateHedgeData(\r\n          this.hedgeData().price || 0,\r\n          hedgeData.fundingRate,\r\n          hedgeData.nextFundingTime\r\n        );\r\n      }\r\n    } catch (error) {\r\n      console.error('[ArbitrageChart] Failed to fetch funding rates:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get funding rate for a specific exchange and symbol\r\n   * Tries multiple symbol format variations to find a match\r\n   */\r\n  private getFundingRate(exchange: string, symbol: string): { fundingRate?: string; nextFundingTime?: number; fundingInterval?: string } {\r\n    // Try multiple symbol format variations\r\n    const symbolVariations = [\r\n      symbol,                              // Original (e.g., \"BTC-USDT\" or \"BTCUSDT\")\r\n      symbol.replace(/-/g, ''),           // Remove hyphens: BTC-USDT -> BTCUSDT\r\n      symbol.replace(/USDT$/, '-USDT'),   // Add hyphen before USDT: BTCUSDT -> BTC-USDT\r\n      symbol.replace(/-/g, '').replace(/USDT$/, 'USDT'), // Normalize: any format -> BTCUSDT\r\n      symbol.replace(/USDT$/, '/USDT'),   // Slash format: BTCUSDT -> BTC/USDT\r\n      symbol.replace(/-/g, '/'),          // Convert hyphens to slashes: BTC-USDT -> BTC/USDT\r\n    ];\r\n\r\n    for (const variant of symbolVariations) {\r\n      const key = `${exchange}-${variant}`;\r\n      const fundingData = this.fundingRatesMap.get(key);\r\n      if (fundingData) {\r\n        console.log(`[ArbitrageChart] Found funding for ${exchange} symbol \"${symbol}\" using variant \"${variant}\"`);\r\n        return {\r\n          fundingRate: fundingData.fundingRate,\r\n          nextFundingTime: fundingData.fundingTime,\r\n          fundingInterval: fundingData.fundingInterval // From DB/API\r\n        };\r\n      }\r\n    }\r\n\r\n    // console.warn(`[ArbitrageChart] Funding rate not found for ${exchange} ${symbol} (tried ${symbolVariations.length} variants)`);\r\n    return {};\r\n  }\r\n\r\n  /**\r\n   * Load historical price data for chart initialization\r\n   */\r\n  private async loadHistoricalData(): Promise<void> {\r\n    // Guard against updates after component destruction\r\n    if (this.isDestroyed) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      this.loadingHistoricalData.set(true);\r\n      console.log('[ArbitrageChart] Loading historical data...');\r\n\r\n      const token = this.authService.authState().token;\r\n      if (!token) {\r\n        console.warn('[ArbitrageChart] No auth token available, skipping historical data');\r\n        return;\r\n      }\r\n\r\n      const symbol = this.symbol();\r\n      const primaryExchange = this.primaryExchange();\r\n      const hedgeExchange = this.hedgeExchange();\r\n      const interval = this.selectedTimeframe();\r\n\r\n      // Calculate limit based on interval to get ~3 months of data\r\n      const limitMap: Record<string, number> = {\r\n        '1m': 4320,   // 3 days (too much for 3 months, API limits)\r\n        '5m': 2160,   // 7.5 days\r\n        '15m': 2016,  // 3 weeks\r\n        '1h': 2160,   // 3 months\r\n        '4h': 540,    // 3 months\r\n        '1d': 90      // 3 months\r\n      };\r\n\r\n      const limit = limitMap[interval] || 1000;\r\n\r\n      console.log(`[ArbitrageChart] Fetching ${limit} ${interval} candles for ${symbol}`);\r\n\r\n      const headers = new HttpHeaders({\r\n        'Authorization': `Bearer ${token}`\r\n      });\r\n\r\n      const url = buildUrlWithQuery(\r\n        getEndpointUrl('arbitrage', 'historicalPrices'),\r\n        {\r\n          symbol,\r\n          primaryExchange,\r\n          hedgeExchange,\r\n          interval,\r\n          limit\r\n        }\r\n      );\r\n\r\n      const response = await this.http.get<any>(url, { headers }).toPromise();\r\n\r\n      if (response?.success && response?.data) {\r\n        const primaryHistory = response.data.primary || [];\r\n        const hedgeHistory = response.data.hedge || [];\r\n\r\n        console.log(`[ArbitrageChart] Loaded ${primaryHistory.length} primary and ${hedgeHistory.length} hedge data points`);\r\n\r\n        // Convert to LineData format and set initial data (only if not destroyed)\r\n        if (!this.isDestroyed && this.primarySeries && primaryHistory.length > 0) {\r\n          const primaryData = primaryHistory.map((item: any) => ({\r\n            time: item.time as Time,\r\n            value: item.price\r\n          }));\r\n          this.primarySeries.setData(primaryData);\r\n          console.log('[ArbitrageChart] Primary series data set');\r\n        }\r\n\r\n        if (!this.isDestroyed && this.hedgeSeries && hedgeHistory.length > 0) {\r\n          const hedgeData = hedgeHistory.map((item: any) => ({\r\n            time: item.time as Time,\r\n            value: item.price\r\n          }));\r\n          this.hedgeSeries.setData(hedgeData);\r\n          console.log('[ArbitrageChart] Hedge series data set');\r\n        }\r\n\r\n        // Fit chart to show all historical data\r\n        if (!this.isDestroyed) {\r\n          this.fitContent();\r\n        }\r\n\r\n      } else {\r\n        console.warn('[ArbitrageChart] Invalid historical data response:', response);\r\n      }\r\n\r\n    } catch (error) {\r\n      console.error('[ArbitrageChart] Failed to load historical data:', error);\r\n    } finally {\r\n      if (!this.isDestroyed) {\r\n        this.loadingHistoricalData.set(false);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update primary exchange data\r\n   */\r\n  private updatePrimaryData(price: number, fundingRate?: string, nextFundingTime?: number, fundingIntervalFromWS?: string): void {\r\n    // Guard against updates after component destruction\r\n    if (this.isDestroyed || !this.chart || !this.primarySeries) {\r\n      return;\r\n    }\r\n\r\n    // Calculate funding interval if we have both previous and current nextFundingTime\r\n    let fundingInterval = this.primaryData().fundingInterval;\r\n\r\n    if (nextFundingTime && this.previousPrimaryFundingTime && nextFundingTime !== this.previousPrimaryFundingTime) {\r\n      // New funding cycle detected - calculate interval\r\n      const interval = nextFundingTime - this.previousPrimaryFundingTime;\r\n\r\n      // Only update if interval is reasonable (between 1h and 24h)\r\n      if (interval >= 3600000 && interval <= 86400000) {\r\n        fundingInterval = interval;\r\n        console.log(`[ArbitrageChart] Primary funding interval calculated: ${interval}ms (${interval / 3600000}h)`);\r\n      }\r\n    } else if (!fundingInterval && nextFundingTime) {\r\n      // First time or no interval calculated yet - try to detect from funding time hour\r\n      fundingInterval = this.detectFundingInterval(nextFundingTime);\r\n    }\r\n\r\n    // Update previous funding time tracker\r\n    if (nextFundingTime) {\r\n      this.previousPrimaryFundingTime = nextFundingTime;\r\n    }\r\n\r\n    // Prioritize fundingInterval: 1) from WebSocket, 2) from DB/API Map, 3) keep existing\r\n    let fundingIntervalStr = fundingIntervalFromWS || this.primaryData().fundingIntervalStr;\r\n\r\n    // If not from WebSocket, try to get from Map (from DB/API)\r\n    if (!fundingIntervalFromWS && this.primaryExchange() && this.symbol()) {\r\n      const fundingData = this.getFundingRate(this.primaryExchange().toUpperCase(), this.symbol());\r\n      if (fundingData.fundingInterval) {\r\n        fundingIntervalStr = fundingData.fundingInterval; // e.g., \"8h\", \"4h\", \"1h\" from DB\r\n        // console.log(`[ArbitrageChart] Using fundingInterval from DB/API map for ${this.primaryExchange()}: ${fundingIntervalStr}`);\r\n      } else {\r\n        console.warn(`[ArbitrageChart] fundingInterval not found in map for ${this.primaryExchange()} ${this.symbol()}`);\r\n      }\r\n    } else if (fundingIntervalFromWS) {\r\n      // console.log(`[ArbitrageChart] Using fundingInterval from WebSocket for ${this.primaryExchange()}: ${fundingIntervalFromWS}`);\r\n    }\r\n\r\n    const updatedData = {\r\n      exchange: this.primaryExchange(),\r\n      price,\r\n      fundingRate: fundingRate || this.primaryData().fundingRate,\r\n      nextFundingTime: nextFundingTime || this.primaryData().nextFundingTime,\r\n      fundingInterval: fundingInterval,\r\n      fundingIntervalStr: fundingIntervalStr, // From DB/API for BingX\r\n      lastUpdate: new Date()\r\n    };\r\n\r\n    // console.log('[ArbitrageChart] Updating primary data:', updatedData);\r\n\r\n    this.primaryData.set(updatedData);\r\n\r\n    // Get current timestamp in seconds and round to timeframe interval\r\n    const currentTimestamp = Math.floor(Date.now() / 1000);\r\n    const roundedTime = this.roundTimeToInterval(currentTimestamp);\r\n\r\n    // Check if this is a new candle period\r\n    const isNewCandle = !this.lastPrimaryCandle || this.lastPrimaryCandle.time !== roundedTime;\r\n\r\n    if (isNewCandle) {\r\n      // New candle period - update chart\r\n      if (this.primarySeries) {\r\n        const time = roundedTime as Time;\r\n        this.primarySeries.update({ time, value: price } as LineData);\r\n        // console.log(`[ArbitrageChart] Primary new candle: ${new Date(roundedTime * 1000).toISOString()}, price: ${price}`);\r\n      }\r\n\r\n      // Update last candle tracker\r\n      this.lastPrimaryCandle = {\r\n        time: roundedTime,\r\n        price: price\r\n      };\r\n    } else {\r\n      // Same candle period - update the current candle with latest price\r\n      if (this.primarySeries) {\r\n        const time = roundedTime as Time;\r\n        this.primarySeries.update({ time, value: price } as LineData);\r\n      }\r\n\r\n      // Update tracker with latest price (guaranteed to exist since isNewCandle is false)\r\n      if (this.lastPrimaryCandle) {\r\n        this.lastPrimaryCandle.price = price;\r\n      }\r\n    }\r\n\r\n    // Recalculate spread\r\n    this.calculateSpread();\r\n  }\r\n\r\n  /**\r\n   * Update hedge exchange data\r\n   */\r\n  private updateHedgeData(price: number, fundingRate?: string, nextFundingTime?: number, fundingIntervalFromWS?: string): void {\r\n    // Guard against updates after component destruction\r\n    if (this.isDestroyed || !this.chart || !this.hedgeSeries) {\r\n      return;\r\n    }\r\n\r\n    // Calculate funding interval if we have both previous and current nextFundingTime\r\n    let fundingInterval = this.hedgeData().fundingInterval;\r\n\r\n    if (nextFundingTime && this.previousHedgeFundingTime && nextFundingTime !== this.previousHedgeFundingTime) {\r\n      // New funding cycle detected - calculate interval\r\n      const interval = nextFundingTime - this.previousHedgeFundingTime;\r\n\r\n      // Only update if interval is reasonable (between 1h and 24h)\r\n      if (interval >= 3600000 && interval <= 86400000) {\r\n        fundingInterval = interval;\r\n        console.log(`[ArbitrageChart] Hedge funding interval calculated: ${interval}ms (${interval / 3600000}h)`);\r\n      }\r\n    } else if (!fundingInterval && nextFundingTime) {\r\n      // First time or no interval calculated yet - try to detect from funding time hour\r\n      fundingInterval = this.detectFundingInterval(nextFundingTime);\r\n    }\r\n\r\n    // Update previous funding time tracker\r\n    if (nextFundingTime) {\r\n      this.previousHedgeFundingTime = nextFundingTime;\r\n    }\r\n\r\n    // Prioritize fundingInterval: 1) from WebSocket, 2) from DB/API Map, 3) keep existing\r\n    let fundingIntervalStr = fundingIntervalFromWS || this.hedgeData().fundingIntervalStr;\r\n\r\n    // If not from WebSocket, try to get from Map (from DB/API)\r\n    if (!fundingIntervalFromWS && this.hedgeExchange() && this.symbol()) {\r\n      const fundingData = this.getFundingRate(this.hedgeExchange().toUpperCase(), this.symbol());\r\n      if (fundingData.fundingInterval) {\r\n        fundingIntervalStr = fundingData.fundingInterval; // e.g., \"8h\", \"4h\", \"1h\" from DB\r\n        // console.log(`[ArbitrageChart] Using fundingInterval from DB/API map for ${this.hedgeExchange()}: ${fundingIntervalStr}`);\r\n      } else {\r\n        console.warn(`[ArbitrageChart] fundingInterval not found in map for ${this.hedgeExchange()} ${this.symbol()}`);\r\n      }\r\n    } else if (fundingIntervalFromWS) {\r\n      // console.log(`[ArbitrageChart] Using fundingInterval from WebSocket for ${this.hedgeExchange()}: ${fundingIntervalFromWS}`);\r\n    }\r\n\r\n    const updatedData = {\r\n      exchange: this.hedgeExchange(),\r\n      price,\r\n      fundingRate: fundingRate || this.hedgeData().fundingRate,\r\n      nextFundingTime: nextFundingTime || this.hedgeData().nextFundingTime,\r\n      fundingInterval: fundingInterval,\r\n      fundingIntervalStr: fundingIntervalStr, // From DB/API for BingX\r\n      lastUpdate: new Date()\r\n    };\r\n\r\n    // console.log('[ArbitrageChart] Updating hedge data:', updatedData);\r\n\r\n    this.hedgeData.set(updatedData);\r\n\r\n    // Get current timestamp in seconds and round to timeframe interval\r\n    const currentTimestamp = Math.floor(Date.now() / 1000);\r\n    const roundedTime = this.roundTimeToInterval(currentTimestamp);\r\n\r\n    // Check if this is a new candle period\r\n    const isNewCandle = !this.lastHedgeCandle || this.lastHedgeCandle.time !== roundedTime;\r\n\r\n    if (isNewCandle) {\r\n      // New candle period - update chart\r\n      if (this.hedgeSeries) {\r\n        const time = roundedTime as Time;\r\n        this.hedgeSeries.update({ time, value: price } as LineData);\r\n        // console.log(`[ArbitrageChart] Hedge new candle: ${new Date(roundedTime * 1000).toISOString()}, price: ${price}`);\r\n      }\r\n\r\n      // Update last candle tracker\r\n      this.lastHedgeCandle = {\r\n        time: roundedTime,\r\n        price: price\r\n      };\r\n    } else {\r\n      // Same candle period - update the current candle with latest price\r\n      if (this.hedgeSeries) {\r\n        const time = roundedTime as Time;\r\n        this.hedgeSeries.update({ time, value: price } as LineData);\r\n      }\r\n\r\n      // Update tracker with latest price (guaranteed to exist since isNewCandle is false)\r\n      if (this.lastHedgeCandle) {\r\n        this.lastHedgeCandle.price = price;\r\n      }\r\n    }\r\n\r\n    // Recalculate spread\r\n    this.calculateSpread();\r\n  }\r\n\r\n  /**\r\n   * Calculate price spread\r\n   */\r\n  private calculateSpread(): void {\r\n    const primary = this.primaryData().price;\r\n    const hedge = this.hedgeData().price;\r\n\r\n    if (primary > 0 && hedge > 0) {\r\n      const spreadValue = Math.abs(primary - hedge);\r\n      const spreadPct = ((spreadValue / primary) * 100).toFixed(4);\r\n\r\n      this.spread.set(spreadValue);\r\n      this.spreadPercent.set(spreadPct);\r\n    }\r\n\r\n    // Also calculate funding spread\r\n    this.calculateFundingSpread();\r\n  }\r\n\r\n  /**\r\n   * Calculate funding rate spread (difference between funding rates)\r\n   * Also automatically set optimal sides based on funding rates\r\n   */\r\n  private calculateFundingSpread(): void {\r\n    const primaryRateStr = this.primaryData().fundingRate;\r\n    const hedgeRateStr = this.hedgeData().fundingRate;\r\n\r\n    // Handle null/undefined values properly\r\n    const primaryRate = (primaryRateStr && primaryRateStr !== 'null') ? parseFloat(primaryRateStr) : NaN;\r\n    const hedgeRate = (hedgeRateStr && hedgeRateStr !== 'null') ? parseFloat(hedgeRateStr) : NaN;\r\n\r\n    if (!isNaN(primaryRate) && !isNaN(hedgeRate)) {\r\n      // Calculate NET funding profit based on actual positions\r\n      // Get current sides\r\n      const primarySide = this.primaryOrderForm.get('side')?.value || 'long';\r\n      const hedgeSide = this.hedgeOrderForm.get('side')?.value || 'short';\r\n\r\n      // Calculate actual cash flow for each position\r\n      // LONG: receives when rate is negative (shorts pay longs), pays when positive\r\n      // SHORT: pays when rate is negative, receives when positive\r\n      const primaryCashFlow = primarySide === 'long' ? -primaryRate : primaryRate;\r\n      const hedgeCashFlow = hedgeSide === 'long' ? -hedgeRate : hedgeRate;\r\n\r\n      // NET funding profit = sum of both cash flows\r\n      const netFundingProfit = primaryCashFlow + hedgeCashFlow;\r\n      this.fundingSpread.set(netFundingProfit);\r\n\r\n      // Automatically set optimal sides based on funding rates\r\n      this.setOptimalSides(primaryRate, hedgeRate);\r\n    } else {\r\n      // If either rate is unavailable, set spread to 0 or NaN\r\n      this.fundingSpread.set(NaN);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Recalculate funding spread based on current sides and funding rates\r\n   */\r\n  private recalculateFundingSpread(): void {\r\n    const primaryRateStr = this.primaryData().fundingRate;\r\n    const hedgeRateStr = this.hedgeData().fundingRate;\r\n\r\n    const primaryRate = (primaryRateStr && primaryRateStr !== 'null') ? parseFloat(primaryRateStr) : NaN;\r\n    const hedgeRate = (hedgeRateStr && hedgeRateStr !== 'null') ? parseFloat(hedgeRateStr) : NaN;\r\n\r\n    if (!isNaN(primaryRate) && !isNaN(hedgeRate)) {\r\n      const primarySide = this.primaryOrderForm.get('side')?.value || 'long';\r\n      const hedgeSide = this.hedgeOrderForm.get('side')?.value || 'short';\r\n\r\n      const primaryCashFlow = primarySide === 'long' ? -primaryRate : primaryRate;\r\n      const hedgeCashFlow = hedgeSide === 'long' ? -hedgeRate : hedgeRate;\r\n\r\n      const netFundingProfit = primaryCashFlow + hedgeCashFlow;\r\n      this.fundingSpread.set(netFundingProfit);\r\n\r\n      console.log('[ArbitrageChart] Funding spread recalculated:', {\r\n        primaryRate,\r\n        hedgeRate,\r\n        primarySide,\r\n        hedgeSide,\r\n        netFundingProfit: (netFundingProfit * 100).toFixed(4) + '%'\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Automatically set optimal position sides based on funding rates\r\n   * Higher funding rate -> Short (receive more or pay less)\r\n   * Lower funding rate -> Long (receive more or pay less)\r\n   * Only applies automatic selection if user hasn't manually chosen sides\r\n   */\r\n  private setOptimalSides(primaryRate: number, hedgeRate: number): void {\r\n    // Don't override manual user selection\r\n    if (this.hasManualSideSelection) {\r\n      console.log('[ArbitrageChart] Skipping automatic side selection - user has manually selected sides');\r\n      return;\r\n    }\r\n\r\n    // Prevent side synchronization during automatic setting\r\n    this.isSyncingSide = true;\r\n\r\n    if (primaryRate > hedgeRate) {\r\n      // Primary has higher funding rate -> Primary = Short, Hedge = Long\r\n      this.primaryOrderForm.patchValue({ side: 'short' }, { emitEvent: false });\r\n      this.hedgeOrderForm.patchValue({ side: 'long' }, { emitEvent: false });\r\n      this.primarySide.set('short');\r\n    } else {\r\n      // Hedge has higher funding rate (or equal) -> Primary = Long, Hedge = Short\r\n      this.primaryOrderForm.patchValue({ side: 'long' }, { emitEvent: false });\r\n      this.hedgeOrderForm.patchValue({ side: 'short' }, { emitEvent: false });\r\n      this.primarySide.set('long');\r\n    }\r\n\r\n    this.isSyncingSide = false;\r\n\r\n    console.log('[ArbitrageChart] Optimal sides set based on funding rates:', {\r\n      primaryRate,\r\n      hedgeRate,\r\n      primarySide: this.primaryOrderForm.get('side')?.value,\r\n      hedgeSide: this.hedgeOrderForm.get('side')?.value\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Disconnect all WebSockets\r\n   */\r\n  private disconnectWebSockets(): void {\r\n    if (this.primaryWs) {\r\n      this.primaryWs.close();\r\n      this.primaryWs = null;\r\n    }\r\n\r\n    if (this.hedgeWs) {\r\n      this.hedgeWs.close();\r\n      this.hedgeWs = null;\r\n    }\r\n\r\n    // Clear all MEXC ping intervals\r\n    this.mexcPingIntervals.forEach((interval, exchange) => {\r\n      clearInterval(interval);\r\n      console.log(`[ArbitrageChart] ${exchange} ping interval cleared`);\r\n    });\r\n    this.mexcPingIntervals.clear();\r\n  }\r\n\r\n  /**\r\n   * Parse float value\r\n   */\r\n  parseFloat(value: string): number {\r\n    return parseFloat(value);\r\n  }\r\n\r\n  /**\r\n   * Format funding rate for display\r\n   * Using the exact same logic as working arbitrage-funding page\r\n   */\r\n  formatFundingRate(rate: string): string {\r\n    const rateNum = parseFloat(rate);\r\n    return (rateNum * 100).toFixed(4) + '%';\r\n  }\r\n\r\n  /**\r\n   * Get color class for funding rate\r\n   * Negative (paying) = red, Positive (receiving) = green\r\n   * Using the exact same logic as working arbitrage-funding page\r\n   */\r\n  getFundingRateColorClass(rate: string): string {\r\n    const rateNum = parseFloat(rate);\r\n    if (rateNum < 0) return 'text-red-600 dark:text-red-400';\r\n    if (rateNum > 0) return 'text-green-600 dark:text-green-400';\r\n    return 'text-gray-600 dark:text-gray-400';\r\n  }\r\n\r\n  /**\r\n   * Format funding spread for display\r\n   */\r\n  formatFundingSpread(): string {\r\n    const spread = this.fundingSpread();\r\n    if (isNaN(spread)) {\r\n      return 'N/A';\r\n    }\r\n    const sign = spread > 0 ? '+' : '';\r\n    // Convert decimal to percentage for display (e.g., 0.001 -> 0.1000%)\r\n    const percentageValue = spread * 100;\r\n    return `${sign}${percentageValue.toFixed(4)}%`;\r\n  }\r\n\r\n  /**\r\n   * Get CSS class for price spread badge based on whether it's favorable\r\n   *\r\n   * Logic for FUNDING ARBITRAGE (holding position long-term for funding payments):\r\n   * - If Primary = LONG / Hedge = SHORT: favorable when primaryPrice > hedgePrice\r\n   *   (higher entry spread = more profit potential when closing)\r\n   * - If Primary = SHORT / Hedge = LONG: favorable when primaryPrice < hedgePrice\r\n   *   (lower entry spread = more profit potential when closing)\r\n   *\r\n   * This is OPPOSITE of price arbitrage convergence trading!\r\n   * In funding arbitrage, we WANT a larger entry spread because:\r\n   * 1. It gives immediate entry profit (notional value difference)\r\n   * 2. We hold long-term to collect funding, not to profit from convergence\r\n   */\r\n  getPriceSpreadClass(): string {\r\n    const primaryPrice = this.primaryData().price;\r\n    const hedgePrice = this.hedgeData().price;\r\n    const side = this.primarySide();\r\n\r\n    if (!primaryPrice || !hedgePrice) {\r\n      return ''; // No color if no data\r\n    }\r\n\r\n    // For funding arbitrage: INVERTED logic compared to price arbitrage\r\n    const isFavorable = side === 'long'\r\n      ? primaryPrice > hedgePrice  // LONG/SHORT: want higher primary (larger entry spread profit)\r\n      : primaryPrice < hedgePrice; // SHORT/LONG: want lower primary (larger entry spread profit)\r\n\r\n    return isFavorable ? 'favorable' : 'unfavorable';\r\n  }\r\n\r\n  /**\r\n   * Format next funding time\r\n   */\r\n  formatNextFundingTime(timestamp: number): string {\r\n    if (!timestamp || timestamp === 0) return 'N/A';\r\n\r\n    const date = new Date(timestamp);\r\n    return date.toLocaleString();\r\n  }\r\n\r\n  /**\r\n   * Calculate time remaining until next funding\r\n   * Using the exact same logic as working arbitrage-funding page\r\n   */\r\n  getTimeRemaining(timestamp: number): string {\r\n    if (!timestamp || timestamp === 0) return 'N/A';\r\n\r\n    const now = Date.now();\r\n    const diff = timestamp - now;\r\n\r\n    if (diff <= 0) return '0m';\r\n\r\n    const hours = Math.floor(diff / (1000 * 60 * 60));\r\n    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));\r\n\r\n    if (hours > 0) {\r\n      return `${hours}h ${minutes}m`;\r\n    }\r\n    return `${minutes}m`;\r\n  }\r\n\r\n  /**\r\n   * Detect funding interval based on the nextFundingTime hour\r\n   * Returns interval in milliseconds\r\n   *\r\n   * NOTE: This is a fallback heuristic and may not be accurate!\r\n   * Always prefer fundingInterval from API/DB/WebSocket when available.\r\n   *\r\n   * Since 8h times (0, 8, 16) are also valid for 4h intervals,\r\n   * we default to 4h as it's more common on modern exchanges.\r\n   */\r\n  private detectFundingInterval(nextFundingTime: number): number {\r\n    const fundingDate = new Date(nextFundingTime);\r\n    const hour = fundingDate.getUTCHours();\r\n    const minutes = fundingDate.getUTCMinutes();\r\n\r\n    // Check for common funding schedules:\r\n    // 8h intervals: 00:00, 08:00, 16:00 UTC\r\n    // 4h intervals: 00:00, 04:00, 08:00, 12:00, 16:00, 20:00 UTC\r\n    // 1h intervals: every hour\r\n\r\n    // Only try to detect if time is on the hour (minutes === 0)\r\n    if (minutes !== 0) {\r\n      // Default to 4h if not on the hour (most common for non-hourly schedules)\r\n      return 4 * 60 * 60 * 1000;\r\n    }\r\n\r\n    // Check for 4h pattern (every 4 hours)\r\n    // Since 8h times are also divisible by 4, we can't distinguish between them\r\n    // Default to 4h as it's more common on modern exchanges\r\n    if (hour % 4 === 0) {\r\n      return 4 * 60 * 60 * 1000; // 4 hours\r\n    } else {\r\n      // Odd hours that aren't divisible by 4 - default to 4h\r\n      return 4 * 60 * 60 * 1000;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Format funding information in compact format: rate / time / interval\r\n   * Example: -0.6869% / 02:30 / 8h\r\n   */\r\n  formatFundingInfo(rate: string, nextFundingTime: number, fundingIntervalStr?: string): string {\r\n    if (!rate && (!nextFundingTime || nextFundingTime === 0)) return 'N/A';\r\n\r\n    // Format funding rate\r\n    let rateFormatted = 'N/A';\r\n    if (rate && rate !== 'null' && rate !== 'undefined') {\r\n      const numRate = parseFloat(rate);\r\n      if (!isNaN(numRate)) {\r\n        rateFormatted = (numRate * 100).toFixed(4) + '%';\r\n      }\r\n    }\r\n\r\n    // Format time remaining as HH:MM\r\n    let timeFormatted = 'N/A';\r\n    if (nextFundingTime && nextFundingTime > 0) {\r\n      const now = Date.now();\r\n      const remaining = nextFundingTime - now;\r\n\r\n      if (remaining <= 0) {\r\n        timeFormatted = '00:00';\r\n      } else {\r\n        const hours = Math.floor(remaining / (1000 * 60 * 60));\r\n        const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));\r\n        timeFormatted = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;\r\n      }\r\n    }\r\n\r\n    // Use funding interval from API/DB if available, otherwise default to 8h\r\n    const intervalFormatted = fundingIntervalStr || '8h';\r\n\r\n    const result = `${rateFormatted} / ${timeFormatted} / ${intervalFormatted}`;\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Get status badge configuration for display\r\n   */\r\n  getStatusBadge(status: string): { label: string; class: string } {\r\n    switch (status?.toUpperCase()) {\r\n      case 'INITIALIZING':\r\n        return { label: 'Initializing', class: 'initializing' };\r\n      case 'EXECUTING':\r\n        return { label: 'Executing', class: 'executing' };\r\n      case 'ACTIVE':\r\n        return { label: 'Active', class: 'active' };\r\n      case 'COMPLETED':\r\n        return { label: 'Completed', class: 'completed' };\r\n      case 'LIQUIDATED':\r\n        return { label: 'Liquidated', class: 'liquidated' };\r\n      case 'ERROR':\r\n        return { label: 'Error', class: 'error' };\r\n      case 'CANCELLED':\r\n        return { label: 'Cancelled', class: 'cancelled' };\r\n      default:\r\n        return { label: status || 'Unknown', class: 'unknown' };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Change timeframe\r\n   */\r\n  async changeTimeframe(timeframe: string): Promise<void> {\r\n    // Guard against updates after component destruction\r\n    if (this.isDestroyed) {\r\n      return;\r\n    }\r\n\r\n    console.log('[ArbitrageChart] Changing timeframe to:', timeframe);\r\n    this.selectedTimeframe.set(timeframe);\r\n\r\n    // Update timeScale options based on timeframe\r\n    if (!this.isDestroyed && this.chart) {\r\n      const showSeconds = timeframe === '1m' || timeframe === '5m';\r\n      this.chart.applyOptions({\r\n        timeScale: {\r\n          secondsVisible: showSeconds,\r\n          timeVisible: true,\r\n        },\r\n      });\r\n      console.log(`[ArbitrageChart] TimeScale updated - seconds visible: ${showSeconds}`);\r\n    }\r\n\r\n    // Reset candle trackers\r\n    this.lastPrimaryCandle = null;\r\n    this.lastHedgeCandle = null;\r\n\r\n    // Clear chart data\r\n    if (!this.isDestroyed && this.primarySeries && this.hedgeSeries) {\r\n      this.primarySeries.setData([]);\r\n      this.hedgeSeries.setData([]);\r\n    }\r\n\r\n    // Load historical data for new timeframe\r\n    if (!this.isDestroyed) {\r\n      await this.loadHistoricalData();\r\n    }\r\n  }\r\n\r\n\r\n  /**\r\n   * Get interval in milliseconds for timeframe\r\n   */\r\n  private getIntervalMs(timeframe: string): number {\r\n    const intervals: Record<string, number> = {\r\n      '1m': 60 * 1000,\r\n      '5m': 5 * 60 * 1000,\r\n      '15m': 15 * 60 * 1000,\r\n      '1h': 60 * 60 * 1000,\r\n      '4h': 4 * 60 * 60 * 1000,\r\n      '1d': 24 * 60 * 60 * 1000\r\n    };\r\n\r\n    return intervals[timeframe] || 60 * 1000; // Default to 1 minute\r\n  }\r\n\r\n  /**\r\n   * Get interval in seconds for timeframe\r\n   */\r\n  private getIntervalSeconds(timeframe: string): number {\r\n    return this.getIntervalMs(timeframe) / 1000;\r\n  }\r\n\r\n  /**\r\n   * Round timestamp to timeframe interval\r\n   * This ensures that all data points within the same candle period have the same timestamp\r\n   */\r\n  private roundTimeToInterval(timestamp: number): number {\r\n    const intervalSeconds = this.getIntervalSeconds(this.selectedTimeframe());\r\n    return Math.floor(timestamp / intervalSeconds) * intervalSeconds;\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * Fit chart content to visible area\r\n   */\r\n  fitContent(): void {\r\n    // Guard against updates after component destruction\r\n    if (this.isDestroyed || !this.chart) {\r\n      return;\r\n    }\r\n\r\n    this.chart.timeScale().fitContent();\r\n  }\r\n\r\n  /**\r\n   * Navigate back to funding rates page\r\n   */\r\n  goBack(): void {\r\n    this.router.navigate(['/arbitrage/opportunities']);\r\n  }\r\n\r\n  /**\r\n   * Start arbitrage position on both exchanges simultaneously\r\n   */\r\n  async startArbitragePosition(): Promise<void> {\r\n    // Validate both forms\r\n    if (this.primaryOrderForm.invalid || this.hedgeOrderForm.invalid) {\r\n      this.toastService.error('Please fill in all required fields correctly');\r\n      return;\r\n    }\r\n\r\n    // Check order quantity validation\r\n    const primaryValidation = this.primaryValidation();\r\n    const hedgeValidation = this.hedgeValidation();\r\n\r\n    if (!primaryValidation.valid) {\r\n      this.toastService.error(`Primary order validation failed:\\n${primaryValidation.error}\\n\\nSuggestion: ${primaryValidation.suggestion}`);\r\n      return;\r\n    }\r\n\r\n    if (!hedgeValidation.valid) {\r\n      this.toastService.error(`Hedge order validation failed:\\n${hedgeValidation.error}\\n\\nSuggestion: ${hedgeValidation.suggestion}`);\r\n      return;\r\n    }\r\n\r\n    // Check credentials\r\n    if (!this.hasPrimaryCredentials() || !this.hasHedgeCredentials()) {\r\n      this.toastService.error(this.credentialsWarning() || 'Please configure exchange credentials in Profile -> Trading Platforms');\r\n      return;\r\n    }\r\n\r\n    // Get form values\r\n    const primaryOrder = this.primaryOrderForm.value;\r\n    const hedgeOrder = this.hedgeOrderForm.value;\r\n\r\n    console.log('[ArbitrageChart] Starting arbitrage position:', {\r\n      symbol: this.symbol(),\r\n      primary: {\r\n        exchange: this.primaryExchange(),\r\n        side: primaryOrder.side,\r\n        leverage: primaryOrder.leverage,\r\n        quantity: primaryOrder.quantity\r\n      },\r\n      hedge: {\r\n        exchange: this.hedgeExchange(),\r\n        side: hedgeOrder.side,\r\n        leverage: hedgeOrder.leverage,\r\n        quantity: hedgeOrder.quantity\r\n      }\r\n    });\r\n\r\n    // Set loading state\r\n    this.isSubmittingOrder.set(true);\r\n\r\n    try {\r\n      // Call backend API endpoint to start graduated entry arbitrage\r\n      const token = this.authService.authState().token;\r\n      if (!token) {\r\n        throw new Error('No authentication token available');\r\n      }\r\n\r\n      const headers = new HttpHeaders({\r\n        'Authorization': `Bearer ${token}`,\r\n        'Content-Type': 'application/json'\r\n      });\r\n\r\n      const url = getEndpointUrl('arbitrage', 'graduatedEntry');\r\n\r\n      // Convert quantities to coin units if they're in USDT (backend expects coin quantities)\r\n      let primaryQuantityInCoins = primaryOrder.quantity;\r\n      const primaryUnit = this.primaryQuantityUnit();\r\n      const primaryPrice = this.primaryData().price;\r\n      const primarySymbolInfo = this.primarySymbolInfo();\r\n      \r\n      if (primaryUnit === 'usdt' && primaryPrice > 0 && primarySymbolInfo) {\r\n        const convertedQuantity = primaryOrder.quantity / primaryPrice;\r\n        \r\n        // Apply step rounding (same logic as validation)\r\n        let qtyPerPart = convertedQuantity / (primaryOrder.graduatedParts || 5);\r\n        \r\n        if (primarySymbolInfo.qtyStep >= 1) {\r\n          qtyPerPart = Math.round(qtyPerPart);\r\n        } else {\r\n          const stepDecimals = Math.max(0, -Math.log10(primarySymbolInfo.qtyStep));\r\n          qtyPerPart = Math.round(qtyPerPart * Math.pow(10, stepDecimals)) / Math.pow(10, stepDecimals);\r\n        }\r\n        \r\n        primaryQuantityInCoins = qtyPerPart * (primaryOrder.graduatedParts || 5);\r\n        console.log(`[ArbitrageChart] Primary: Converting ${primaryOrder.quantity} USDT to ${primaryQuantityInCoins} coins`);\r\n      }\r\n\r\n      let hedgeQuantityInCoins = hedgeOrder.quantity;\r\n      const hedgeUnit = this.hedgeQuantityUnit();\r\n      const hedgePrice = this.hedgeData().price;\r\n      const hedgeSymbolInfo = this.hedgeSymbolInfo();\r\n      \r\n      if (hedgeUnit === 'usdt' && hedgePrice > 0 && hedgeSymbolInfo) {\r\n        const convertedQuantity = hedgeOrder.quantity / hedgePrice;\r\n        \r\n        // Apply step rounding (same logic as validation)\r\n        let qtyPerPart = convertedQuantity / (hedgeOrder.graduatedParts || 5);\r\n        \r\n        if (hedgeSymbolInfo.qtyStep >= 1) {\r\n          qtyPerPart = Math.round(qtyPerPart);\r\n        } else {\r\n          const stepDecimals = Math.max(0, -Math.log10(hedgeSymbolInfo.qtyStep));\r\n          qtyPerPart = Math.round(qtyPerPart * Math.pow(10, stepDecimals)) / Math.pow(10, stepDecimals);\r\n        }\r\n        \r\n        hedgeQuantityInCoins = qtyPerPart * (hedgeOrder.graduatedParts || 5);\r\n        console.log(`[ArbitrageChart] Hedge: Converting ${hedgeOrder.quantity} USDT to ${hedgeQuantityInCoins} coins`);\r\n      }\r\n\r\n      // Get funding rates and convert to decimal (hourly rate)\r\n      const primaryFundingRateStr = this.primaryData().fundingRate;\r\n      const hedgeFundingRateStr = this.hedgeData().fundingRate;\r\n\r\n      let primaryFundingRate: number | undefined;\r\n      let hedgeFundingRate: number | undefined;\r\n\r\n      // Parse funding rates if available\r\n      if (primaryFundingRateStr && primaryFundingRateStr !== 'null') {\r\n        primaryFundingRate = parseFloat(primaryFundingRateStr);\r\n      }\r\n      if (hedgeFundingRateStr && hedgeFundingRateStr !== 'null') {\r\n        hedgeFundingRate = parseFloat(hedgeFundingRateStr);\r\n      }\r\n\r\n      const requestBody = {\r\n        symbol: this.symbol(),\r\n        primaryExchange: this.primaryExchange(),\r\n        primarySide: primaryOrder.side,\r\n        primaryLeverage: primaryOrder.leverage,\r\n        primaryQuantity: primaryQuantityInCoins,\r\n        hedgeExchange: this.hedgeExchange(),\r\n        hedgeSide: hedgeOrder.side,\r\n        hedgeLeverage: hedgeOrder.leverage,\r\n        hedgeQuantity: hedgeQuantityInCoins,\r\n        graduatedEntryParts: primaryOrder.graduatedParts || 5,  // Use form value or default to 5\r\n        graduatedEntryDelayMs: (primaryOrder.graduatedDelayMs || 2) * 1000,  // Convert seconds to milliseconds (default 2s = 2000ms)\r\n        // Strategy type (for quantity balancing logic)\r\n        strategyType: this.strategy() || 'combined',\r\n        // Funding rates for combined strategy TP/SL (optional)\r\n        ...(primaryFundingRate !== undefined && { primaryFundingRate }),\r\n        ...(hedgeFundingRate !== undefined && { hedgeFundingRate }),\r\n        // Optional TP/SL preferences (can be made configurable later)\r\n        targetHoldingPeriodHours: 168,  // Default: 7 days\r\n        minProfitPercent: 2  // Default: 2%\r\n      };\r\n\r\n      console.log('[ArbitrageChart] Sending request to graduated entry API:', requestBody);\r\n\r\n      const response = await this.http.post<any>(url, requestBody, { headers }).toPromise();\r\n\r\n      if (response?.success) {\r\n        console.log('[ArbitrageChart] Graduated entry started:', response.data);\r\n\r\n        // Add position to active positions list with real funding data from backend\r\n        const primaryLastFunding = response.data.primary.lastFundingPaid || 0;\r\n        const primaryTotalFunding = response.data.primary.totalFundingEarned || 0;\r\n        const primaryFees = response.data.primary.tradingFees || 0;\r\n\r\n        const hedgeLastFunding = response.data.hedge.lastFundingPaid || 0;\r\n        const hedgeTotalFunding = response.data.hedge.totalFundingEarned || 0;\r\n        const hedgeFees = response.data.hedge.tradingFees || 0;\r\n\r\n        const grossProfit = response.data.grossProfit || 0;\r\n        const netProfit = response.data.netProfit || 0;\r\n\r\n        const newPosition: ArbitragePosition = {\r\n          positionId: response.data.positionId,\r\n          symbol: response.data.symbol,\r\n          primary: {\r\n            ...response.data.primary,\r\n            lastFundingPaid: primaryLastFunding,\r\n            totalFundingEarned: primaryTotalFunding,\r\n            tradingFees: primaryFees\r\n          },\r\n          hedge: {\r\n            ...response.data.hedge,\r\n            lastFundingPaid: hedgeLastFunding,\r\n            totalFundingEarned: hedgeTotalFunding,\r\n            tradingFees: hedgeFees\r\n          },\r\n          graduatedEntry: response.data.graduatedEntry,\r\n          startedAt: new Date(),\r\n          status: 'active',\r\n          grossProfit: grossProfit,\r\n          netProfit: netProfit\r\n        };\r\n\r\n        const updatedPositions = [...this.activePositions(), newPosition];\r\n        this.activePositions.set(updatedPositions);\r\n\r\n        this.toastService.success(`Arbitrage position started successfully!\\nPosition ID: ${response.data.positionId}`);\r\n\r\n        // Reset manual side selection flag to allow automatic selection for next position\r\n        this.hasManualSideSelection = false;\r\n\r\n        // Reset forms after successful submission using global settings\r\n        const defaultLeverage = this.tradingSettings.getLeverage();\r\n        const defaultGraduatedParts = this.tradingSettings.getGraduatedParts();\r\n        const defaultGraduatedDelayMs = this.tradingSettings.getGraduatedDelayMs();\r\n        // Convert milliseconds to seconds for UI display\r\n        const defaultGraduatedDelaySec = defaultGraduatedDelayMs / 1000;\r\n\r\n        this.primaryOrderForm.reset({\r\n          side: 'long',\r\n          leverage: defaultLeverage,\r\n          quantity: 0,\r\n          graduatedParts: defaultGraduatedParts,\r\n          graduatedDelayMs: defaultGraduatedDelaySec\r\n        });\r\n\r\n        this.hedgeOrderForm.reset({\r\n          side: 'short',\r\n          leverage: defaultLeverage,\r\n          quantity: 0,\r\n          graduatedParts: defaultGraduatedParts,\r\n          graduatedDelayMs: defaultGraduatedDelaySec\r\n        });\r\n      } else {\r\n        throw new Error(response?.error || 'Unknown error from server');\r\n      }\r\n\r\n    } catch (error: any) {\r\n      console.error('[ArbitrageChart] Failed to start arbitrage position:', error);\r\n      const errorMessage = error.error?.error || error.message || 'Unknown error';\r\n      this.toastService.error(`Failed to start arbitrage position:\\n${errorMessage}`, 10000);\r\n    } finally {\r\n      this.isSubmittingOrder.set(false);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if active credentials exist for both exchanges\r\n   */\r\n  private checkExchangeCredentials(): void {\r\n    // Fetch credentials if not already loaded\r\n    if (!this.credentialsService.hasCredentials()) {\r\n      this.credentialsService.fetchCredentials().subscribe({\r\n        next: () => {\r\n          this.validateCredentials();\r\n        },\r\n        error: (err) => {\r\n          console.error('[ArbitrageChart] Failed to fetch credentials:', err);\r\n          this.hasPrimaryCredentials.set(false);\r\n          this.hasHedgeCredentials.set(false);\r\n          this.credentialsWarning.set('Failed to fetch exchange credentials');\r\n        }\r\n      });\r\n    } else {\r\n      this.validateCredentials();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Validate that active credentials exist for both exchanges\r\n   */\r\n  private validateCredentials(): void {\r\n    const primaryExchangeType = this.primaryExchange().toUpperCase() as ExchangeType;\r\n    const hedgeExchangeType = this.hedgeExchange().toUpperCase() as ExchangeType;\r\n\r\n    // Check primary exchange credentials\r\n    const primaryCred = this.credentialsService.getActiveCredentialForExchange(primaryExchangeType);\r\n    this.hasPrimaryCredentials.set(!!primaryCred);\r\n\r\n    // Check hedge exchange credentials\r\n    const hedgeCred = this.credentialsService.getActiveCredentialForExchange(hedgeExchangeType);\r\n    this.hasHedgeCredentials.set(!!hedgeCred);\r\n\r\n    // Build warning message\r\n    const warnings: string[] = [];\r\n    if (!primaryCred) {\r\n      warnings.push(`No active credentials for ${this.primaryExchange()}`);\r\n    }\r\n    if (!hedgeCred) {\r\n      warnings.push(`No active credentials for ${this.hedgeExchange()}`);\r\n    }\r\n\r\n    if (warnings.length > 0) {\r\n      this.credentialsWarning.set(warnings.join('. ') + '. Please configure in Profile -> Trading Platforms.');\r\n    } else {\r\n      this.credentialsWarning.set('');\r\n\r\n      // Load balances if credentials are valid\r\n      if (this.hasPrimaryCredentials()) {\r\n        this.loadExchangeBalance(this.primaryExchange(), 'primary');\r\n      }\r\n      if (this.hasHedgeCredentials()) {\r\n        this.loadExchangeBalance(this.hedgeExchange(), 'hedge');\r\n      }\r\n    }\r\n\r\n    console.log('[ArbitrageChart] Credentials validation:', {\r\n      primary: {\r\n        exchange: this.primaryExchange(),\r\n        hasCredentials: this.hasPrimaryCredentials()\r\n      },\r\n      hedge: {\r\n        exchange: this.hedgeExchange(),\r\n        hasCredentials: this.hasHedgeCredentials()\r\n      },\r\n      warning: this.credentialsWarning()\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Load active arbitrage positions from backend\r\n   */\r\n  private async loadActivePositions(): Promise<void> {\r\n    try {\r\n      console.log('[ArbitrageChart] Loading active positions...');\r\n\r\n      const token = this.authService.authState().token;\r\n      if (!token) {\r\n        console.warn('[ArbitrageChart] No auth token available, skipping position loading');\r\n        return;\r\n      }\r\n\r\n      const headers = new HttpHeaders({\r\n        'Authorization': `Bearer ${token}`\r\n      });\r\n\r\n      // Get all non-completed positions (INITIALIZING, EXECUTING, ACTIVE, ERROR, LIQUIDATED, CANCELLED)\r\n      const url = getEndpointUrl('arbitrage', 'graduatedEntry');\r\n      const response = await this.http.get<any>(url, { headers }).toPromise();\r\n\r\n      if (response?.success && response?.data) {\r\n        console.log(`[ArbitrageChart] Loaded ${response.data.length} positions (excluding completed)`);\r\n\r\n        // Transform backend positions to match our interface\r\n        const positions: ArbitragePosition[] = response.data.map((pos: any) => {\r\n          // Use actual data from backend (currently zeros until tracking is implemented)\r\n          const primaryLastFunding = pos.primary.lastFundingPaid || 0;\r\n          const primaryTotalFunding = pos.primary.totalFundingEarned || 0;\r\n          const primaryFees = pos.primary.tradingFees || 0;\r\n\r\n          const hedgeLastFunding = pos.hedge.lastFundingPaid || 0;\r\n          const hedgeTotalFunding = pos.hedge.totalFundingEarned || 0;\r\n          const hedgeFees = pos.hedge.tradingFees || 0;\r\n\r\n          const grossProfit = pos.grossProfit || 0;\r\n          const netProfit = pos.netProfit || 0;\r\n\r\n          return {\r\n            positionId: pos.positionId,\r\n            symbol: pos.symbol,\r\n            primary: {\r\n              exchange: pos.primary.exchange,\r\n              side: pos.primary.side,\r\n              leverage: pos.primary.leverage,\r\n              quantity: pos.primary.quantity,\r\n              environment: pos.primary.environment || 'MAINNET',\r\n              lastFundingPaid: primaryLastFunding,\r\n              totalFundingEarned: primaryTotalFunding,\r\n              tradingFees: primaryFees,\r\n              // Price and liquidation data\r\n              entryPrice: pos.primary.entryPrice,\r\n              currentPrice: pos.primary.currentPrice,\r\n              liquidationPrice: pos.primary.liquidationPrice,\r\n              proximityRatio: pos.primary.proximityRatio,\r\n              inDanger: pos.primary.inDanger,\r\n              // P&L data\r\n              unrealizedProfit: pos.primary.unrealizedProfit,\r\n              realizedProfit: pos.primary.realizedProfit\r\n            },\r\n            hedge: {\r\n              exchange: pos.hedge.exchange,\r\n              side: pos.hedge.side,\r\n              leverage: pos.hedge.leverage,\r\n              quantity: pos.hedge.quantity,\r\n              environment: pos.hedge.environment || 'MAINNET',\r\n              lastFundingPaid: hedgeLastFunding,\r\n              totalFundingEarned: hedgeTotalFunding,\r\n              tradingFees: hedgeFees,\r\n              // Price and liquidation data\r\n              entryPrice: pos.hedge.entryPrice,\r\n              currentPrice: pos.hedge.currentPrice,\r\n              liquidationPrice: pos.hedge.liquidationPrice,\r\n              proximityRatio: pos.hedge.proximityRatio,\r\n              inDanger: pos.hedge.inDanger,\r\n              // P&L data\r\n              unrealizedProfit: pos.hedge.unrealizedProfit,\r\n              realizedProfit: pos.hedge.realizedProfit\r\n            },\r\n            graduatedEntry: {\r\n              parts: pos.graduatedEntry.parts,\r\n              delayMs: pos.graduatedEntry.delayMs\r\n            },\r\n            startedAt: new Date(pos.startedAt),\r\n            status: pos.status,\r\n            grossProfit,\r\n            netProfit\r\n          };\r\n        });\r\n\r\n        this.activePositions.set(positions);\r\n        console.log('[ArbitrageChart] Active positions loaded successfully');\r\n\r\n        // DEBUG: Log all positions with their symbols\r\n        console.log('[ArbitrageChart] All active positions:', positions.map(p => ({\r\n          positionId: p.positionId,\r\n          symbol: p.symbol,\r\n          primary: p.primary.exchange,\r\n          hedge: p.hedge.exchange,\r\n          status: p.status\r\n        })));\r\n      }\r\n    } catch (error: any) {\r\n      console.error('[ArbitrageChart] Failed to load active positions:', error);\r\n      // Don't show error to user - positions just won't be displayed\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load account balances for both exchanges\r\n   */\r\n  private async loadBalances(): Promise<void> {\r\n    // Load primary exchange balance\r\n    if (this.primaryExchange() && this.hasPrimaryCredentials()) {\r\n      await this.loadExchangeBalance(this.primaryExchange(), 'primary');\r\n    }\r\n\r\n    // Load hedge exchange balance\r\n    if (this.hedgeExchange() && this.hasHedgeCredentials()) {\r\n      await this.loadExchangeBalance(this.hedgeExchange(), 'hedge');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load balance for a specific exchange\r\n   */\r\n  private async loadExchangeBalance(exchange: string, type: 'primary' | 'hedge'): Promise<void> {\r\n    const balanceSignal = type === 'primary' ? this.primaryBalance : this.hedgeBalance;\r\n\r\n    try {\r\n      // Set loading state\r\n      balanceSignal.set({\r\n        ...balanceSignal(),\r\n        loading: true\r\n      });\r\n\r\n      const token = this.authService.authState().token;\r\n      if (!token) {\r\n        console.warn(`[ArbitrageChart] No auth token available for ${type} balance`);\r\n        balanceSignal.set({\r\n          totalBalance: '0',\r\n          availableBalance: '0',\r\n          loading: false\r\n        });\r\n        return;\r\n      }\r\n\r\n      const headers = new HttpHeaders({\r\n        'Authorization': `Bearer ${token}`\r\n      });\r\n\r\n      const url = `/api/exchange/balance?exchange=${exchange}`;\r\n      const response = await this.http.get<any>(url, { headers }).toPromise();\r\n\r\n      if (response?.success && response?.data) {\r\n        balanceSignal.set({\r\n          totalBalance: response.data.totalBalance,\r\n          availableBalance: response.data.availableBalance,\r\n          loading: false\r\n        });\r\n        console.log(`[ArbitrageChart] ${type} balance loaded:`, response.data);\r\n      } else {\r\n        throw new Error(response?.error || 'Failed to load balance');\r\n      }\r\n    } catch (error: any) {\r\n      console.error(`[ArbitrageChart] Failed to load ${type} balance:`, error);\r\n      balanceSignal.set({\r\n        totalBalance: '0',\r\n        availableBalance: '0',\r\n        loading: false\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Format timestamp for display\r\n   * Uses cached current time to avoid ExpressionChangedAfterItHasBeenCheckedError\r\n   */\r\n  formatTimestamp(date: Date): string {\r\n    // Use a cached \"now\" time that updates every second via interval\r\n    // This prevents the value from changing during Angular's change detection cycle\r\n    const now = this.cachedNow || new Date();\r\n    const diffMs = now.getTime() - date.getTime();\r\n    const diffMins = Math.floor(diffMs / (1000 * 60));\r\n\r\n    if (diffMins < 1) return 'Just now';\r\n    if (diffMins < 60) return `${diffMins} min ago`;\r\n\r\n    const diffHours = Math.floor(diffMins / 60);\r\n    if (diffHours < 24) return `${diffHours}h ago`;\r\n\r\n    const diffDays = Math.floor(diffHours / 24);\r\n    return `${diffDays}d ago`;\r\n  }\r\n\r\n  private cachedNow = new Date();\r\n  private nowUpdateInterval: any;\r\n\r\n  /**\r\n   * Get exchange URL for opening in new window\r\n   */\r\n  getExchangeUrl(exchange: string): string {\r\n    const symbol = this.symbol();\r\n    const exchangeUpper = exchange.toUpperCase();\r\n\r\n    switch (exchangeUpper) {\r\n      case 'BYBIT':\r\n        return `https://www.bybit.com/trade/usdt/${symbol}`;\r\n      case 'BINGX':\r\n        const bingxSymbol = this.normalizeSymbolForBingX(symbol);\r\n        return `https://bingx.com/en/perpetual/${bingxSymbol}`;\r\n      case 'MEXC':\r\n        const mexcSymbol = symbol.includes('_') ? symbol : symbol.replace(/USDT$/, '_USDT').replace(/USDC$/, '_USDC');\r\n        return `https://www.mexc.com/uk-UA/futures/${mexcSymbol}`;\r\n      case 'GATEIO':\r\n        const gateioSymbol = symbol.includes('_') ? symbol : symbol.replace(/USDT$/, '_USDT').replace(/USDC$/, '_USDC');\r\n        return `https://www.gate.com/uk/futures/USDT/${gateioSymbol}`;\r\n      case 'BITGET':\r\n        return `https://www.bitget.com/futures/usdt/${symbol}`;\r\n      case 'OKX':\r\n        return `https://www.okx.com/trade-swap/${symbol.toLowerCase()}`;\r\n      default:\r\n        return '#';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Open exchange page in new window\r\n   */\r\n  openExchange(exchange: string): void {\r\n    const url = this.getExchangeUrl(exchange);\r\n    if (url !== '#') {\r\n      window.open(url, '_blank', 'noopener,noreferrer');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Toggle row expansion\r\n   */\r\n  toggleRowExpansion(positionId: string): void {\r\n    const currentExpanded = new Set(this.expandedRows());\r\n\r\n    if (currentExpanded.has(positionId)) {\r\n      currentExpanded.delete(positionId);\r\n    } else {\r\n      currentExpanded.add(positionId);\r\n    }\r\n\r\n    this.expandedRows.set(currentExpanded);\r\n  }\r\n\r\n  /**\r\n   * Toggle primary quantity dropdown\r\n   */\r\n  togglePrimaryQuantityDropdown(): void {\r\n    this.primaryDropdownOpen.set(!this.primaryDropdownOpen());\r\n    if (this.primaryDropdownOpen()) {\r\n      this.hedgeDropdownOpen.set(false);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Toggle hedge quantity dropdown\r\n   */\r\n  toggleHedgeQuantityDropdown(): void {\r\n    this.hedgeDropdownOpen.set(!this.hedgeDropdownOpen());\r\n    if (this.hedgeDropdownOpen()) {\r\n      this.primaryDropdownOpen.set(false);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Toggle order parameters synchronization lock\r\n   */\r\n  toggleOrderParamsLock(): void {\r\n    const newState = !this.orderParamsLocked();\r\n    this.orderParamsLocked.set(newState);\r\n    console.log('[ArbitrageChart] Order params lock toggled:', newState ? 'locked' : 'unlocked');\r\n\r\n    // If locking, synchronize all values from primary to hedge\r\n    if (newState) {\r\n      this.synchronizeAllFieldsToHedge();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Synchronize all order parameter fields from primary to hedge\r\n   */\r\n  private synchronizeAllFieldsToHedge(): void {\r\n    console.log('[ArbitrageChart] Synchronizing all fields from primary to hedge');\r\n\r\n    // Prevent circular updates\r\n    this.isSyncingSide = true;\r\n    this.isSyncingLeverage = true;\r\n    this.isSyncingQuantity = true;\r\n    this.isSyncingGraduatedParts = true;\r\n    this.isSyncingGraduatedDelay = true;\r\n\r\n    try {\r\n      // Sync side (opposite)\r\n      const primarySide = this.primaryOrderForm.get('side')?.value;\r\n      const oppositeSide = primarySide === 'long' ? 'short' : 'long';\r\n      this.hedgeOrderForm.patchValue({ side: oppositeSide }, { emitEvent: false });\r\n\r\n      // Sync leverage\r\n      const leverage = this.primaryOrderForm.get('leverage')?.value;\r\n      this.hedgeOrderForm.patchValue({ leverage }, { emitEvent: false });\r\n\r\n      // Sync quantity (with unit conversion if needed)\r\n      const primaryUnit = this.primaryQuantityUnit();\r\n      const hedgeUnit = this.hedgeQuantityUnit();\r\n      const quantity = this.primaryOrderForm.get('quantity')?.value;\r\n\r\n      let hedgeQuantity = quantity;\r\n      if (primaryUnit !== hedgeUnit) {\r\n        hedgeQuantity = this.convertQuantity(quantity, primaryUnit, hedgeUnit, 'primary');\r\n      }\r\n      this.hedgeOrderForm.patchValue({ quantity: hedgeQuantity }, { emitEvent: false });\r\n\r\n      // Sync graduated parts\r\n      const graduatedParts = this.primaryOrderForm.get('graduatedParts')?.value;\r\n      this.hedgeOrderForm.patchValue({ graduatedParts }, { emitEvent: false });\r\n\r\n      // Sync graduated delay\r\n      const graduatedDelayMs = this.primaryOrderForm.get('graduatedDelayMs')?.value;\r\n      this.hedgeOrderForm.patchValue({ graduatedDelayMs }, { emitEvent: false });\r\n\r\n      console.log('[ArbitrageChart] All fields synchronized successfully');\r\n    } finally {\r\n      // Re-enable syncing flags\r\n      this.isSyncingSide = false;\r\n      this.isSyncingLeverage = false;\r\n      this.isSyncingQuantity = false;\r\n      this.isSyncingGraduatedParts = false;\r\n      this.isSyncingGraduatedDelay = false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set primary quantity unit and convert existing value\r\n   * Also synchronizes unit and quantity to hedge form\r\n   */\r\n  setPrimaryQuantityUnit(unit: 'coin' | 'usdt'): void {\r\n    const currentUnit = this.primaryQuantityUnit();\r\n    if (currentUnit === unit) return;\r\n\r\n    const currentQuantity = this.primaryOrderForm.get('quantity')?.value || 0;\r\n\r\n    // Convert primary quantity to new unit\r\n    let convertedPrimaryQuantity = currentQuantity;\r\n    if (currentQuantity > 0) {\r\n      convertedPrimaryQuantity = this.convertQuantity(currentQuantity, currentUnit, unit, 'primary');\r\n      this.primaryOrderForm.patchValue({ quantity: convertedPrimaryQuantity }, { emitEvent: false });\r\n    }\r\n\r\n    // Update primary unit\r\n    this.primaryQuantityUnit.set(unit);\r\n    this.primaryDropdownOpen.set(false);\r\n\r\n    // Synchronize unit to hedge\r\n    this.hedgeQuantityUnit.set(unit);\r\n\r\n    // Convert hedge quantity to new unit\r\n    const hedgeQuantity = this.hedgeOrderForm.get('quantity')?.value || 0;\r\n    if (hedgeQuantity > 0) {\r\n      const convertedHedgeQuantity = this.convertQuantity(hedgeQuantity, currentUnit, unit, 'hedge');\r\n      this.hedgeOrderForm.patchValue({ quantity: convertedHedgeQuantity }, { emitEvent: false });\r\n    }\r\n\r\n    // Validate both forms after unit change\r\n    this.validatePrimaryOrder();\r\n    this.validateHedgeOrder();\r\n  }\r\n\r\n  /**\r\n   * Set hedge quantity unit and convert existing value\r\n   * Also synchronizes unit and quantity to primary form\r\n   */\r\n  setHedgeQuantityUnit(unit: 'coin' | 'usdt'): void {\r\n    const currentUnit = this.hedgeQuantityUnit();\r\n    if (currentUnit === unit) return;\r\n\r\n    const currentQuantity = this.hedgeOrderForm.get('quantity')?.value || 0;\r\n\r\n    // Convert hedge quantity to new unit\r\n    let convertedHedgeQuantity = currentQuantity;\r\n    if (currentQuantity > 0) {\r\n      convertedHedgeQuantity = this.convertQuantity(currentQuantity, currentUnit, unit, 'hedge');\r\n      this.hedgeOrderForm.patchValue({ quantity: convertedHedgeQuantity }, { emitEvent: false });\r\n    }\r\n\r\n    // Update hedge unit\r\n    this.hedgeQuantityUnit.set(unit);\r\n    this.hedgeDropdownOpen.set(false);\r\n\r\n    // Synchronize unit to primary\r\n    this.primaryQuantityUnit.set(unit);\r\n\r\n    // Convert primary quantity to new unit\r\n    const primaryQuantity = this.primaryOrderForm.get('quantity')?.value || 0;\r\n    if (primaryQuantity > 0) {\r\n      const convertedPrimaryQuantity = this.convertQuantity(primaryQuantity, currentUnit, unit, 'primary');\r\n      this.primaryOrderForm.patchValue({ quantity: convertedPrimaryQuantity }, { emitEvent: false });\r\n    }\r\n\r\n    // Validate both forms after unit change\r\n    this.validatePrimaryOrder();\r\n    this.validateHedgeOrder();\r\n  }\r\n\r\n  /**\r\n   * Convert quantity between coin and USDT\r\n   */\r\n  private convertQuantity(\r\n    quantity: number, \r\n    fromUnit: 'coin' | 'usdt', \r\n    toUnit: 'coin' | 'usdt', \r\n    exchange: 'primary' | 'hedge'\r\n  ): number {\r\n    if (fromUnit === toUnit) return quantity;\r\n\r\n    const price = exchange === 'primary' \r\n      ? parseFloat(String(this.primaryData().price || '0'))\r\n      : parseFloat(String(this.hedgeData().price || '0'));\r\n\r\n    if (price <= 0) return quantity;\r\n\r\n    let result: number;\r\n    if (fromUnit === 'coin' && toUnit === 'usdt') {\r\n      // Convert from coin to USDT\r\n      result = quantity * price;\r\n    } else {\r\n      // Convert from USDT to coin\r\n      result = quantity / price;\r\n      \r\n      // Round to match exchange step requirements when converting to coin\r\n      const symbolInfo = exchange === 'primary' ? this.primarySymbolInfo() : this.hedgeSymbolInfo();\r\n      if (symbolInfo) {\r\n        if (symbolInfo.qtyStep >= 1) {\r\n          // For exchanges requiring whole numbers (like FUSDT), round to nearest integer\r\n          result = Math.round(result);\r\n        } else {\r\n          // For exchanges with decimal steps, round to step precision\r\n          const stepDecimals = Math.max(0, -Math.log10(symbolInfo.qtyStep));\r\n          result = Math.round(result * Math.pow(10, stepDecimals)) / Math.pow(10, stepDecimals);\r\n        }\r\n      }\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Get coin symbol from full symbol (e.g., NVDAXUSDT -> NVDAX)\r\n   */\r\n  getCoinSymbol(): string {\r\n    const symbol = this.symbol();\r\n    if (symbol.endsWith('USDT')) {\r\n      return symbol.slice(0, -4);\r\n    }\r\n    if (symbol.endsWith('USDC')) {\r\n      return symbol.slice(0, -4);\r\n    }\r\n    return symbol;\r\n  }\r\n\r\n  /**\r\n   * Check if row is expanded\r\n   */\r\n  isRowExpanded(positionId: string): boolean {\r\n    return this.expandedRows().has(positionId);\r\n  }\r\n\r\n  /**\r\n   * Format currency value\r\n   */\r\n  formatCurrency(value: number | undefined): string {\r\n    if (value === undefined || value === null) return 'N/A';\r\n    return value.toFixed(4);\r\n  }\r\n\r\n  /**\r\n   * Stop an active arbitrage position\r\n   */\r\n  async stopPosition(positionId: string): Promise<void> {\r\n    const confirmed = confirm(`Are you sure you want to stop position ${positionId}?`);\r\n    if (!confirmed) return;\r\n\r\n    try {\r\n      console.log('[ArbitrageChart] Stopping position:', positionId);\r\n\r\n      // Call backend API to stop the position\r\n      const token = this.authService.authState().token;\r\n      if (!token) {\r\n        throw new Error('No authentication token available');\r\n      }\r\n\r\n      const headers = new HttpHeaders({\r\n        'Authorization': `Bearer ${token}`,\r\n        'Content-Type': 'application/json'\r\n      });\r\n\r\n      // Determine position type by ID pattern and use appropriate endpoint\r\n      // Graduated entry positions: arb_1_TIMESTAMP or similar pattern\r\n      // Price arbitrage positions: use different pattern\r\n      let url: string;\r\n      let requestBody: any;\r\n\r\n      if (positionId.startsWith('arb_')) {\r\n        // Graduated entry position - use graduated-entry/stop endpoint\r\n        url = getEndpointUrl('arbitrage', 'graduatedEntry') + '/stop';\r\n        requestBody = { positionId };\r\n        console.log('[ArbitrageChart] Using graduated-entry stop endpoint');\r\n      } else {\r\n        // Price arbitrage position - use positions/:id/close endpoint\r\n        url = getEndpointUrl('arbitrage', 'closePosition').replace(':id', positionId);\r\n        requestBody = {};\r\n        console.log('[ArbitrageChart] Using price arbitrage close endpoint');\r\n      }\r\n\r\n      const response = await this.http.post<any>(url, requestBody, { headers }).toPromise();\r\n\r\n      if (response?.success) {\r\n        console.log('[ArbitrageChart] Position stopped successfully:', response.data);\r\n\r\n        // Remove from local list\r\n        const updatedPositions = this.activePositions().filter(p => p.positionId !== positionId);\r\n        this.activePositions.set(updatedPositions);\r\n\r\n        this.toastService.success(`Position ${positionId} stopped successfully`);\r\n      } else {\r\n        throw new Error(response?.error || 'Unknown error from server');\r\n      }\r\n    } catch (error: any) {\r\n      console.error('[ArbitrageChart] Failed to stop position:', error);\r\n      const errorMessage = error.error?.error || error.message || 'Unknown error';\r\n      this.toastService.error(`Failed to stop position: ${errorMessage}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Toggle liquidation monitoring for an active position\r\n   */\r\n  async toggleMonitoring(position: ArbitragePosition): Promise<void> {\r\n    const newState = !position.monitoring?.enabled;\r\n    const action = newState ? 'enable' : 'disable';\r\n\r\n    try {\r\n      console.log(`[ArbitrageChart] ${action} monitoring for position:`, position.positionId);\r\n\r\n      // Call backend API to toggle monitoring\r\n      const token = this.authService.authState().token;\r\n      if (!token) {\r\n        throw new Error('No authentication token available');\r\n      }\r\n\r\n      const headers = new HttpHeaders({\r\n        'Authorization': `Bearer ${token}`,\r\n        'Content-Type': 'application/json'\r\n      });\r\n\r\n      const url = 'http://localhost:3000/api/arbitrage/positions';\r\n\r\n      const response = await this.http.patch<any>(url, {\r\n        positionId: position.positionId,\r\n        isMonitoringEnabled: newState\r\n      }, { headers }).toPromise();\r\n\r\n      if (response?.success) {\r\n        console.log(`[ArbitrageChart] Monitoring ${action}d successfully:`, response.data);\r\n\r\n        // Update local position\r\n        const updatedPositions = this.activePositions().map(p => {\r\n          if (p.positionId === position.positionId) {\r\n            return {\r\n              ...p,\r\n              monitoring: {\r\n                enabled: newState,\r\n                status: newState ? 'active' : 'disabled',\r\n                lastCheck: p.monitoring?.lastCheck\r\n              }\r\n            };\r\n          }\r\n          return p;\r\n        });\r\n        this.activePositions.set(updatedPositions);\r\n\r\n        this.toastService.success(`Monitoring ${action}d successfully`);\r\n      } else {\r\n        throw new Error(response?.error || 'Unknown error from server');\r\n      }\r\n    } catch (error: any) {\r\n      console.error(`[ArbitrageChart] Failed to ${action} monitoring:`, error);\r\n      const errorMessage = error.error?.error || error.message || 'Unknown error';\r\n      this.toastService.error(`Failed to ${action} monitoring: ${errorMessage}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Synchronize TP/SL for an active position\r\n   * Sets synchronized Take-Profit and Stop-Loss where Primary SL = Hedge TP and vice versa\r\n   */\r\n  async syncTpSl(positionId: string): Promise<void> {\r\n    console.log('=== syncTpSl CALLED ===', positionId);\r\n    console.log('Current time:', new Date().toISOString());\r\n\r\n    const confirmed = confirm(\r\n      `Set synchronized TP/SL for position ${positionId}?\\n\\n` +\r\n      `This will:\\n` +\r\n      `‚Ä¢ Set Primary Stop-Loss = Hedge Take-Profit\\n` +\r\n      `‚Ä¢ Set Hedge Stop-Loss = Primary Take-Profit\\n` +\r\n      `‚Ä¢ Both positions will close simultaneously when either price is hit`\r\n    );\r\n    console.log('User confirmed:', confirmed);\r\n    if (!confirmed) return;\r\n\r\n    try {\r\n      console.log('[ArbitrageChart] Synchronizing TP/SL for position:', positionId);\r\n\r\n      // Call backend API to sync TP/SL\r\n      const token = this.authService.authState().token;\r\n      if (!token) {\r\n        throw new Error('No authentication token available');\r\n      }\r\n\r\n      const headers = new HttpHeaders({\r\n        'Authorization': `Bearer ${token}`,\r\n        'Content-Type': 'application/json'\r\n      });\r\n\r\n      const url = getEndpointUrl('arbitrage', 'spotFuturesSetTpSl');\r\n\r\n      const response = await this.http.post<any>(url, { positionId }, { headers }).toPromise();\r\n\r\n      if (response?.success) {\r\n        console.log('[ArbitrageChart] TP/SL synchronized successfully:', response.data);\r\n        this.toastService.success(`Synchronized TP/SL set successfully for position ${positionId}\\n\\nCheck your exchange UI to verify the orders.`);\r\n      } else {\r\n        throw new Error(response?.error || 'Unknown error from server');\r\n      }\r\n    } catch (error: any) {\r\n      console.error('[ArbitrageChart] Failed to sync TP/SL:', error);\r\n      const errorMessage = error.error?.error || error.message || 'Unknown error';\r\n      this.toastService.error(`Failed to sync TP/SL: ${errorMessage}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Fetch symbol information for both exchanges\r\n   */\r\n  private fetchSymbolInfo(): void {\r\n    const symbol = this.symbol();\r\n    const primaryExchange = this.primaryExchange();\r\n    const hedgeExchange = this.hedgeExchange();\r\n\r\n    console.log('[ArbitrageChart] Fetching symbol info for both exchanges...');\r\n\r\n    // Normalize symbol for primary exchange if needed\r\n    const primarySymbol = primaryExchange.toUpperCase() === 'BINGX'\r\n      ? this.normalizeSymbolForBingX(symbol)\r\n      : symbol;\r\n\r\n    // Normalize symbol for hedge exchange if needed\r\n    const hedgeSymbol = hedgeExchange.toUpperCase() === 'BINGX'\r\n      ? this.normalizeSymbolForBingX(symbol)\r\n      : symbol;\r\n\r\n    // Fetch primary exchange symbol info\r\n    this.symbolInfoService.getSymbolInfo(primaryExchange, primarySymbol).subscribe(symbolInfo => {\r\n      if (symbolInfo) {\r\n        this.primarySymbolInfo.set(symbolInfo);\r\n        console.log(`[ArbitrageChart] Primary symbol info (${primaryExchange}):`, symbolInfo);\r\n        // Validate immediately if form has values\r\n        this.validatePrimaryOrder();\r\n      } else {\r\n        console.warn(`[ArbitrageChart] No symbol info available for ${primaryExchange}:${primarySymbol}`);\r\n      }\r\n    });\r\n\r\n    // Fetch hedge exchange symbol info\r\n    this.symbolInfoService.getSymbolInfo(hedgeExchange, hedgeSymbol).subscribe(symbolInfo => {\r\n      if (symbolInfo) {\r\n        this.hedgeSymbolInfo.set(symbolInfo);\r\n        console.log(`[ArbitrageChart] Hedge symbol info (${hedgeExchange}):`, symbolInfo);\r\n        // Validate immediately if form has values\r\n        this.validateHedgeOrder();\r\n      } else {\r\n        console.warn(`[ArbitrageChart] No symbol info available for ${hedgeExchange}:${hedgeSymbol}`);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Set up form value watchers for real-time validation and field synchronization\r\n   */\r\n  private setupFormValidation(): void {\r\n    // PRIMARY FORM WATCHERS\r\n\r\n    // Watch primary quantity changes\r\n    this.primaryOrderForm.get('quantity')?.valueChanges.subscribe((value) => {\r\n      this.validatePrimaryOrder();\r\n\r\n      // Sync to hedge if locked and not already syncing\r\n      if (this.orderParamsLocked() && !this.isSyncingQuantity) {\r\n        this.isSyncingQuantity = true;\r\n        const primaryUnit = this.primaryQuantityUnit();\r\n        const hedgeUnit = this.hedgeQuantityUnit();\r\n        let hedgeValue = value;\r\n\r\n        if (primaryUnit !== hedgeUnit) {\r\n          hedgeValue = this.convertQuantity(value, primaryUnit, hedgeUnit, 'primary');\r\n        }\r\n\r\n        this.hedgeOrderForm.patchValue({ quantity: hedgeValue }, { emitEvent: false });\r\n        this.validateHedgeOrder();\r\n        this.isSyncingQuantity = false;\r\n      }\r\n    });\r\n\r\n    // Watch primary side changes\r\n    this.primaryOrderForm.get('side')?.valueChanges.subscribe((value: 'long' | 'short') => {\r\n      // Update signal for price spread color calculation\r\n      this.primarySide.set(value);\r\n\r\n      if (this.orderParamsLocked() && !this.isSyncingSide) {\r\n        this.hasManualSideSelection = true;\r\n        this.isSyncingSide = true;\r\n        const oppositeSide = value === 'long' ? 'short' : 'long';\r\n        this.hedgeOrderForm.patchValue({ side: oppositeSide }, { emitEvent: false });\r\n        this.isSyncingSide = false;\r\n        console.log('[ArbitrageChart] Side synced from primary to hedge');\r\n      }\r\n\r\n      // Recalculate funding spread when side changes\r\n      this.recalculateFundingSpread();\r\n    });\r\n\r\n    // Watch primary leverage changes\r\n    this.primaryOrderForm.get('leverage')?.valueChanges.subscribe((value) => {\r\n      if (this.orderParamsLocked() && !this.isSyncingLeverage) {\r\n        this.isSyncingLeverage = true;\r\n        this.hedgeOrderForm.patchValue({ leverage: value }, { emitEvent: false });\r\n        this.isSyncingLeverage = false;\r\n        console.log('[ArbitrageChart] Leverage synced from primary to hedge');\r\n      }\r\n    });\r\n\r\n    // Watch primary graduatedParts changes\r\n    this.primaryOrderForm.get('graduatedParts')?.valueChanges.subscribe((value) => {\r\n      this.validatePrimaryOrder();\r\n\r\n      if (this.orderParamsLocked() && !this.isSyncingGraduatedParts) {\r\n        this.isSyncingGraduatedParts = true;\r\n        this.hedgeOrderForm.patchValue({ graduatedParts: value }, { emitEvent: false });\r\n        this.validateHedgeOrder();\r\n        this.isSyncingGraduatedParts = false;\r\n        console.log('[ArbitrageChart] Graduated parts synced from primary to hedge');\r\n      }\r\n    });\r\n\r\n    // Watch primary graduatedDelayMs changes\r\n    this.primaryOrderForm.get('graduatedDelayMs')?.valueChanges.subscribe((value) => {\r\n      if (this.orderParamsLocked() && !this.isSyncingGraduatedDelay) {\r\n        this.isSyncingGraduatedDelay = true;\r\n        this.hedgeOrderForm.patchValue({ graduatedDelayMs: value }, { emitEvent: false });\r\n        this.isSyncingGraduatedDelay = false;\r\n        console.log('[ArbitrageChart] Graduated delay synced from primary to hedge');\r\n      }\r\n    });\r\n\r\n    // HEDGE FORM WATCHERS\r\n\r\n    // Watch hedge quantity changes\r\n    this.hedgeOrderForm.get('quantity')?.valueChanges.subscribe((value) => {\r\n      this.validateHedgeOrder();\r\n\r\n      // Sync to primary if locked and not already syncing\r\n      if (this.orderParamsLocked() && !this.isSyncingQuantity) {\r\n        this.isSyncingQuantity = true;\r\n        const primaryUnit = this.primaryQuantityUnit();\r\n        const hedgeUnit = this.hedgeQuantityUnit();\r\n        let primaryValue = value;\r\n\r\n        if (primaryUnit !== hedgeUnit) {\r\n          primaryValue = this.convertQuantity(value, hedgeUnit, primaryUnit, 'hedge');\r\n        }\r\n\r\n        this.primaryOrderForm.patchValue({ quantity: primaryValue }, { emitEvent: false });\r\n        this.validatePrimaryOrder();\r\n        this.isSyncingQuantity = false;\r\n      }\r\n    });\r\n\r\n    // Watch hedge side changes\r\n    this.hedgeOrderForm.get('side')?.valueChanges.subscribe((value: 'long' | 'short') => {\r\n      if (this.orderParamsLocked() && !this.isSyncingSide) {\r\n        this.hasManualSideSelection = true;\r\n        this.isSyncingSide = true;\r\n        const oppositeSide = value === 'long' ? 'short' : 'long';\r\n        this.primaryOrderForm.patchValue({ side: oppositeSide }, { emitEvent: false });\r\n        this.isSyncingSide = false;\r\n        console.log('[ArbitrageChart] Side synced from hedge to primary');\r\n      }\r\n\r\n      // Recalculate funding spread when side changes\r\n      this.recalculateFundingSpread();\r\n    });\r\n\r\n    // Watch hedge leverage changes\r\n    this.hedgeOrderForm.get('leverage')?.valueChanges.subscribe((value) => {\r\n      if (this.orderParamsLocked() && !this.isSyncingLeverage) {\r\n        this.isSyncingLeverage = true;\r\n        this.primaryOrderForm.patchValue({ leverage: value }, { emitEvent: false });\r\n        this.isSyncingLeverage = false;\r\n        console.log('[ArbitrageChart] Leverage synced from hedge to primary');\r\n      }\r\n    });\r\n\r\n    // Watch hedge graduatedParts changes\r\n    this.hedgeOrderForm.get('graduatedParts')?.valueChanges.subscribe((value) => {\r\n      this.validateHedgeOrder();\r\n\r\n      if (this.orderParamsLocked() && !this.isSyncingGraduatedParts) {\r\n        this.isSyncingGraduatedParts = true;\r\n        this.primaryOrderForm.patchValue({ graduatedParts: value }, { emitEvent: false });\r\n        this.validatePrimaryOrder();\r\n        this.isSyncingGraduatedParts = false;\r\n        console.log('[ArbitrageChart] Graduated parts synced from hedge to primary');\r\n      }\r\n    });\r\n\r\n    // Watch hedge graduatedDelayMs changes\r\n    this.hedgeOrderForm.get('graduatedDelayMs')?.valueChanges.subscribe((value) => {\r\n      if (this.orderParamsLocked() && !this.isSyncingGraduatedDelay) {\r\n        this.isSyncingGraduatedDelay = true;\r\n        this.primaryOrderForm.patchValue({ graduatedDelayMs: value }, { emitEvent: false });\r\n        this.isSyncingGraduatedDelay = false;\r\n        console.log('[ArbitrageChart] Graduated delay synced from hedge to primary');\r\n      }\r\n    });\r\n\r\n    console.log('[ArbitrageChart] Form validation and synchronization watchers set up');\r\n  }\r\n\r\n  /**\r\n   * Validate primary order quantity against symbol info\r\n   */\r\n  private validatePrimaryOrder(): void {\r\n    const symbolInfo = this.primarySymbolInfo();\r\n    if (!symbolInfo) {\r\n      this.primaryValidation.set({ valid: true });\r\n      return;\r\n    }\r\n\r\n    const quantity = this.primaryOrderForm.get('quantity')?.value || 0;\r\n    const graduatedParts = this.primaryOrderForm.get('graduatedParts')?.value || 1;\r\n    const unit = this.primaryQuantityUnit();\r\n    const price = this.primaryData().price;\r\n\r\n    // Convert quantity to coin if it's in USDT\r\n    let actualQuantity = quantity;\r\n    if (unit === 'usdt' && price > 0) {\r\n      actualQuantity = quantity / price;\r\n      \r\n      // Calculate quantity per part and round each part to match exchange step requirements\r\n      let qtyPerPart = actualQuantity / graduatedParts;\r\n      \r\n      if (symbolInfo.qtyStep >= 1) {\r\n        // For exchanges requiring whole numbers (like FUSDT), round to nearest integer\r\n        qtyPerPart = Math.round(qtyPerPart);\r\n      } else {\r\n        // For exchanges with decimal steps, round to step precision\r\n        const stepDecimals = Math.max(0, -Math.log10(symbolInfo.qtyStep));\r\n        qtyPerPart = Math.round(qtyPerPart * Math.pow(10, stepDecimals)) / Math.pow(10, stepDecimals);\r\n      }\r\n      \r\n      // Recalculate total quantity based on rounded parts\r\n      actualQuantity = qtyPerPart * graduatedParts;\r\n      \r\n      console.log(`[Debug] Converting primary: ${quantity} USDT √∑ ${price} = ${quantity / price} FUSDT, rounded per part: ${qtyPerPart} √ó ${graduatedParts} = ${actualQuantity} FUSDT`);\r\n    }\r\n\r\n    console.log(`[Debug] Primary validation: quantity=${actualQuantity}, parts=${graduatedParts}, unit=${unit}, price=${price}`);\r\n\r\n    const validationResult = this.symbolInfoService.validateOrderQuantity(\r\n      symbolInfo,\r\n      actualQuantity,\r\n      graduatedParts\r\n    );\r\n\r\n    this.primaryValidation.set(validationResult);\r\n\r\n    if (!validationResult.valid) {\r\n      console.warn(`[ArbitrageChart] Primary order validation failed:`, validationResult);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Validate hedge order quantity against symbol info\r\n   */\r\n  private validateHedgeOrder(): void {\r\n    const symbolInfo = this.hedgeSymbolInfo();\r\n    if (!symbolInfo) {\r\n      this.hedgeValidation.set({ valid: true });\r\n      return;\r\n    }\r\n\r\n    const quantity = this.hedgeOrderForm.get('quantity')?.value || 0;\r\n    const graduatedParts = this.hedgeOrderForm.get('graduatedParts')?.value || 1;\r\n    const unit = this.hedgeQuantityUnit();\r\n    const price = this.hedgeData().price;\r\n\r\n    console.log(`[ArbitrageChart] Hedge validation input: form quantity=${quantity}, unit=${unit}, price=${price}, parts=${graduatedParts}`);\r\n\r\n    // Convert quantity to coin if it's in USDT\r\n    let actualQuantity = quantity;\r\n    if (unit === 'usdt' && price > 0) {\r\n      actualQuantity = quantity / price;\r\n      \r\n      // Calculate quantity per part and round each part to match exchange step requirements\r\n      let qtyPerPart = actualQuantity / graduatedParts;\r\n      \r\n      if (symbolInfo.qtyStep >= 1) {\r\n        // For exchanges requiring whole numbers (like FUSDT), round to nearest integer\r\n        qtyPerPart = Math.round(qtyPerPart);\r\n      } else {\r\n        // For exchanges with decimal steps, round to step precision\r\n        const stepDecimals = Math.max(0, -Math.log10(symbolInfo.qtyStep));\r\n        qtyPerPart = Math.round(qtyPerPart * Math.pow(10, stepDecimals)) / Math.pow(10, stepDecimals);\r\n      }\r\n      \r\n      // Recalculate total quantity based on rounded parts\r\n      actualQuantity = qtyPerPart * graduatedParts;\r\n      \r\n      console.log(`[Debug] Converting hedge: ${quantity} USDT √∑ ${price} = ${quantity / price} FUSDT, rounded per part: ${qtyPerPart} √ó ${graduatedParts} = ${actualQuantity} FUSDT`);\r\n    }\r\n\r\n    console.log(`[Debug] Hedge validation: quantity=${actualQuantity}, parts=${graduatedParts}, unit=${unit}, price=${price}`);\r\n\r\n    const validationResult = this.symbolInfoService.validateOrderQuantity(\r\n      symbolInfo,\r\n      actualQuantity,\r\n      graduatedParts\r\n    );\r\n\r\n    this.hedgeValidation.set(validationResult);\r\n\r\n    if (!validationResult.valid) {\r\n      console.warn(`[ArbitrageChart] Hedge order validation failed:`, validationResult);\r\n    }\r\n  }\r\n\r\n\r\n  // Gate.io API refresh interval\r\n  private gateioRefreshInterval?: any;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\trading\\arbitrage-form-validation.integration.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":490,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":490,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15554,15557],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15554,15557],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { TestBed } from '@angular/core/testing';\r\nimport { SymbolInfoService, SymbolInfo } from '../../services/symbol-info.service';\r\nimport { FormControl } from '@angular/forms';\r\n\r\n/**\r\n * Integration tests for Order Parameters form validation focusing on\r\n * Graduated Entry and Quantity synchronization scenarios\r\n */\r\ndescribe('Arbitrage Form Validation Integration Tests', () => {\r\n  let symbolInfoService: SymbolInfoService;\r\n\r\n  // Test data representing different exchange configurations\r\n  const exchangeConfigs = {\r\n    bybit: {\r\n      symbol: 'BTCUSDT',\r\n      exchange: 'BYBIT',\r\n      minOrderQty: 0.001,\r\n      qtyStep: 0.001,\r\n      pricePrecision: 2,\r\n      qtyPrecision: 3,\r\n      maxOrderQty: 1000,\r\n      maxLeverage: 125,\r\n      minOrderValue: 10\r\n    } as SymbolInfo,\r\n\r\n    bingx: {\r\n      symbol: 'BTC-USDT',\r\n      exchange: 'BINGX',\r\n      minOrderQty: 0.01,\r\n      qtyStep: 0.01,\r\n      pricePrecision: 2,\r\n      qtyPrecision: 2,\r\n      maxOrderQty: 500,\r\n      maxLeverage: 100,\r\n      minOrderValue: 20\r\n    } as SymbolInfo,\r\n\r\n    gateio: {\r\n      symbol: 'BTC_USDT',\r\n      exchange: 'GATEIO',\r\n      minOrderQty: 1,\r\n      qtyStep: 1,\r\n      pricePrecision: 2,\r\n      qtyPrecision: 0,\r\n      maxOrderQty: 1000000,\r\n      maxLeverage: 25\r\n    } as SymbolInfo,\r\n\r\n    mexc: {\r\n      symbol: 'BTCUSDT',\r\n      exchange: 'MEXC',\r\n      minOrderQty: 0.0001,\r\n      qtyStep: 0.0001,\r\n      pricePrecision: 2,\r\n      qtyPrecision: 4,\r\n      maxOrderQty: 10000,\r\n      maxLeverage: 200,\r\n      minOrderValue: 5\r\n    } as SymbolInfo\r\n  };\r\n\r\n  beforeEach(() => {\r\n    TestBed.configureTestingModule({\r\n      providers: [SymbolInfoService]\r\n    });\r\n\r\n    symbolInfoService = TestBed.inject(SymbolInfoService);\r\n  });\r\n\r\n  describe('Graduated Entry Validation Scenarios', () => {\r\n    describe('Typical Arbitrage Position Sizes', () => {\r\n      it('should validate $1000 position split into 5 parts on Bybit', () => {\r\n        // Scenario: $1000 position at $100k BTC = 0.01 BTC\r\n        const result = symbolInfoService.validateOrderQuantity(\r\n          exchangeConfigs.bybit,\r\n          0.01,\r\n          5\r\n        );\r\n\r\n        expect(result.valid).toBe(true);\r\n        // Each part: 0.01 / 5 = 0.002, which is >= 0.001 (minimum)\r\n      });\r\n\r\n      it('should reject micro-position with too many parts on Bybit', () => {\r\n        // Scenario: Very small position split into too many parts\r\n        const result = symbolInfoService.validateOrderQuantity(\r\n          exchangeConfigs.bybit,\r\n          0.005,\r\n          10\r\n        );\r\n\r\n        expect(result.valid).toBe(false);\r\n        expect(result.error).toContain('Each order part (0.0005) is below minimum (0.001)');\r\n        expect(result.suggestion).toContain('reduce graduated parts to 5');\r\n      });\r\n\r\n      it('should validate large institutional order on Bybit', () => {\r\n        // Scenario: 10 BTC split into 50 parts\r\n        const result = symbolInfoService.validateOrderQuantity(\r\n          exchangeConfigs.bybit,\r\n          10,\r\n          50\r\n        );\r\n\r\n        expect(result.valid).toBe(true);\r\n        // Each part: 10 / 50 = 0.2, which is >= 0.001\r\n      });\r\n    });\r\n\r\n    describe('Exchange-Specific Constraints', () => {\r\n      it('should handle BingX medium minimum quantity requirements', () => {\r\n        // Scenario: 1 BTC split into 5 parts on BingX\r\n        const result = symbolInfoService.validateOrderQuantity(\r\n          exchangeConfigs.bingx,\r\n          1.0,\r\n          5\r\n        );\r\n\r\n        expect(result.valid).toBe(true);\r\n        // Each part: 1.0 / 5 = 0.2, which is >= 0.01\r\n      });\r\n\r\n      it('should reject insufficient quantity per part on BingX', () => {\r\n        // Scenario: Small position with too many parts for BingX requirements\r\n        const result = symbolInfoService.validateOrderQuantity(\r\n          exchangeConfigs.bingx,\r\n          0.1,\r\n          15\r\n        );\r\n\r\n        expect(result.valid).toBe(false);\r\n        expect(result.error).toContain('is below minimum (0.01)');\r\n        expect(result.suggestion).toContain('reduce graduated parts');\r\n      });\r\n\r\n      it('should handle Gate.io large minimum quantity', () => {\r\n        // Scenario: Gate.io requires large minimum orders\r\n        const result = symbolInfoService.validateOrderQuantity(\r\n          exchangeConfigs.gateio,\r\n          50,\r\n          5\r\n        );\r\n\r\n        expect(result.valid).toBe(true);\r\n        // Each part: 50 / 5 = 10, which is >= 1\r\n      });\r\n\r\n      it('should reject even single part below Gate.io minimum', () => {\r\n        const result = symbolInfoService.validateOrderQuantity(\r\n          exchangeConfigs.gateio,\r\n          0.5,\r\n          1\r\n        );\r\n\r\n        expect(result.valid).toBe(false);\r\n        expect(result.error).toContain('Each order part (0.5) is below minimum (1)');\r\n        expect(result.suggestion).toBe('Increase total quantity to at least 1');\r\n      });\r\n\r\n      it('should allow high-precision trades on MEXC', () => {\r\n        // Scenario: MEXC allows very small quantities with many parts\r\n        const result = symbolInfoService.validateOrderQuantity(\r\n          exchangeConfigs.mexc,\r\n          0.01,\r\n          20\r\n        );\r\n\r\n        expect(result.valid).toBe(true);\r\n        // Each part: 0.01 / 20 = 0.0005, which is >= 0.0001\r\n      });\r\n    });\r\n\r\n    describe('Edge Cases and Boundary Conditions', () => {\r\n      it('should handle quantity exactly at minimum boundary', () => {\r\n        // Test: Total quantity exactly equals minimum * parts\r\n        const result = symbolInfoService.validateOrderQuantity(\r\n          exchangeConfigs.bybit,\r\n          0.005,\r\n          5\r\n        );\r\n\r\n        expect(result.valid).toBe(true);\r\n        // Each part: 0.005 / 5 = 0.001, exactly equals minimum\r\n      });\r\n\r\n      it('should calculate optimal parts suggestion correctly', () => {\r\n        // Test: Suggest reducing parts to maximum feasible\r\n        const result = symbolInfoService.validateOrderQuantity(\r\n          exchangeConfigs.bybit,\r\n          0.007,\r\n          15\r\n        );\r\n\r\n        expect(result.valid).toBe(false);\r\n        // Max parts: floor(0.007 / 0.001) = 7\r\n        expect(result.suggestion).toContain('reduce graduated parts to 7');\r\n      });\r\n\r\n      it('should handle maximum order quantity constraints', () => {\r\n        // Test: Order part exceeds exchange maximum\r\n        const result = symbolInfoService.validateOrderQuantity(\r\n          exchangeConfigs.bybit,\r\n          5000,\r\n          2\r\n        );\r\n\r\n        expect(result.valid).toBe(false);\r\n        expect(result.error).toContain('exceeds maximum (1000)');\r\n        expect(result.suggestion).toContain('Decrease quantity or increase graduated parts');\r\n      });\r\n\r\n      it('should validate quantity step requirements', () => {\r\n        // Test: Quantity not divisible by step size\r\n        const result = symbolInfoService.validateOrderQuantity(\r\n          exchangeConfigs.bingx,\r\n          0.157,\r\n          3\r\n        );\r\n\r\n        expect(result.valid).toBe(false);\r\n        expect(result.error).toContain('must be a multiple of 0.01');\r\n        expect(result.suggestion).toMatch(/Adjust total quantity to \\d+\\.\\d+/);\r\n      });\r\n    });\r\n\r\n    describe('Floating Point Precision Handling', () => {\r\n      it('should handle floating point arithmetic correctly', () => {\r\n        // Test: Floating point division that should work\r\n        const result = symbolInfoService.validateOrderQuantity(\r\n          exchangeConfigs.bybit,\r\n          0.003,\r\n          3\r\n        );\r\n\r\n        expect(result.valid).toBe(true);\r\n        // Each part: 0.003 / 3 = 0.001, should be valid despite floating point\r\n      });\r\n\r\n      it('should use tolerance for step validation', () => {\r\n        // Test: Very small floating point differences should be tolerated\r\n        const customSymbol = {\r\n          ...exchangeConfigs.bybit,\r\n          qtyStep: 0.001,\r\n          qtyPrecision: 6\r\n        };\r\n\r\n        const result = symbolInfoService.validateOrderQuantity(\r\n          customSymbol,\r\n          0.003001,\r\n          3\r\n        );\r\n\r\n        expect(result.valid).toBe(true);\r\n        // Each part: 0.003001 / 3 = 0.001000333..., should pass with tolerance\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Real-World Trading Scenarios', () => {\r\n    interface TradeScenario {\r\n      name: string;\r\n      exchange: keyof typeof exchangeConfigs;\r\n      totalQuantity: number;\r\n      graduatedParts: number;\r\n      expectedValid: boolean;\r\n      expectedError?: string;\r\n      expectedSuggestion?: string;\r\n    }\r\n\r\n    const scenarios: TradeScenario[] = [\r\n      {\r\n        name: 'Small retail arbitrage on Bybit',\r\n        exchange: 'bybit',\r\n        totalQuantity: 0.05,\r\n        graduatedParts: 5,\r\n        expectedValid: true\r\n      },\r\n      {\r\n        name: 'Micro-trading test order',\r\n        exchange: 'bybit',\r\n        totalQuantity: 0.001,\r\n        graduatedParts: 3,\r\n        expectedValid: false,\r\n        expectedError: 'below minimum',\r\n        expectedSuggestion: 'reduce graduated parts to 1'\r\n      },\r\n      {\r\n        name: 'Medium BingX arbitrage position',\r\n        exchange: 'bingx',\r\n        totalQuantity: 2.5,\r\n        graduatedParts: 10,\r\n        expectedValid: true\r\n      },\r\n      {\r\n        name: 'BingX position with too many parts',\r\n        exchange: 'bingx',\r\n        totalQuantity: 0.5,\r\n        graduatedParts: 20,\r\n        expectedValid: false,\r\n        expectedError: 'below minimum',\r\n        expectedSuggestion: 'reduce graduated parts'\r\n      },\r\n      {\r\n        name: 'Gate.io large position',\r\n        exchange: 'gateio',\r\n        totalQuantity: 100,\r\n        graduatedParts: 10,\r\n        expectedValid: true\r\n      },\r\n      {\r\n        name: 'Gate.io insufficient total quantity',\r\n        exchange: 'gateio',\r\n        totalQuantity: 3,\r\n        graduatedParts: 5,\r\n        expectedValid: false,\r\n        expectedError: 'below minimum',\r\n        expectedSuggestion: 'reduce graduated parts to 3'\r\n      },\r\n      {\r\n        name: 'MEXC high-frequency strategy',\r\n        exchange: 'mexc',\r\n        totalQuantity: 0.1,\r\n        graduatedParts: 100,\r\n        expectedValid: true\r\n      },\r\n      {\r\n        name: 'MEXC ultra-micro position',\r\n        exchange: 'mexc',\r\n        totalQuantity: 0.0005,\r\n        graduatedParts: 10,\r\n        expectedValid: false,\r\n        expectedError: 'below minimum',\r\n        expectedSuggestion: 'reduce graduated parts to 5'\r\n      }\r\n    ];\r\n\r\n    scenarios.forEach(scenario => {\r\n      it(`should handle: ${scenario.name}`, () => {\r\n        const config = exchangeConfigs[scenario.exchange];\r\n        const result = symbolInfoService.validateOrderQuantity(\r\n          config,\r\n          scenario.totalQuantity,\r\n          scenario.graduatedParts\r\n        );\r\n\r\n        expect(result.valid).toBe(scenario.expectedValid);\r\n\r\n        if (!scenario.expectedValid) {\r\n          if (scenario.expectedError) {\r\n            expect(result.error).toContain(scenario.expectedError);\r\n          }\r\n          if (scenario.expectedSuggestion) {\r\n            expect(result.suggestion).toContain(scenario.expectedSuggestion);\r\n          }\r\n        }\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Form Control Integration Patterns', () => {\r\n    it('should integrate with Angular FormControl validation', () => {\r\n      // Simulate real form control usage\r\n      const quantityControl = new FormControl(0.001);\r\n      const partsControl = new FormControl(5);\r\n\r\n      // Create validator function\r\n      const spotFuturesValidator = () => {\r\n        const quantity = quantityControl.value;\r\n        const parts = partsControl.value;\r\n\r\n        if (!quantity || !parts) return null;\r\n\r\n        const result = symbolInfoService.validateOrderQuantity(\r\n          exchangeConfigs.bybit,\r\n          quantity,\r\n          parts\r\n        );\r\n\r\n        return result.valid ? null : {\r\n          spotFutures: {\r\n            message: result.error,\r\n            suggestion: result.suggestion\r\n          }\r\n        };\r\n      };\r\n\r\n      // Test invalid case\r\n      const invalidResult = spotFuturesValidator();\r\n      expect(invalidResult).not.toBeNull();\r\n      expect(invalidResult?.spotFutures.message).toContain('below minimum');\r\n\r\n      // Test valid case\r\n      quantityControl.setValue(0.1);\r\n      const validResult = spotFuturesValidator();\r\n      expect(validResult).toBeNull();\r\n    });\r\n\r\n    it('should provide helpful error messages for UI display', () => {\r\n      const result = symbolInfoService.validateOrderQuantity(\r\n        exchangeConfigs.gateio,\r\n        5,\r\n        10\r\n      );\r\n\r\n      expect(result.valid).toBe(false);\r\n      expect(result.error).toMatch(/Each order part \\(\\d+(\\.\\d+)?\\) is below minimum \\(\\d+\\)/);\r\n      expect(result.suggestion).toMatch(/Increase total quantity to at least \\d+ or reduce graduated parts to \\d+/);\r\n\r\n      // Verify the error message is user-friendly\r\n      expect(result.error).toContain('Each order part');\r\n      expect(result.error).toContain('is below minimum');\r\n      expect(result.suggestion).toContain('Increase total quantity');\r\n      expect(result.suggestion).toContain('reduce graduated parts');\r\n    });\r\n  });\r\n\r\n  describe('Performance Considerations', () => {\r\n    it('should handle rapid validation calls efficiently', () => {\r\n      const startTime = performance.now();\r\n\r\n      // Simulate rapid form changes\r\n      for (let i = 0; i < 100; i++) {\r\n        symbolInfoService.validateOrderQuantity(\r\n          exchangeConfigs.bybit,\r\n          0.01 + (i * 0.001),\r\n          5 + (i % 10)\r\n        );\r\n      }\r\n\r\n      const endTime = performance.now();\r\n      const duration = endTime - startTime;\r\n\r\n      // Should complete 100 validations in reasonable time\r\n      expect(duration).toBeLessThan(100); // Less than 100ms\r\n    });\r\n\r\n    it('should handle extreme values without errors', () => {\r\n      // Test very large numbers\r\n      const largeResult = symbolInfoService.validateOrderQuantity(\r\n        exchangeConfigs.mexc,\r\n        1000000,\r\n        1\r\n      );\r\n      expect(largeResult.valid).toBe(true);\r\n\r\n      // Test very small numbers\r\n      const smallResult = symbolInfoService.validateOrderQuantity(\r\n        exchangeConfigs.mexc,\r\n        0.0000001,\r\n        1\r\n      );\r\n      expect(smallResult.valid).toBe(false);\r\n      expect(smallResult.error).toContain('below minimum');\r\n\r\n      // Test zero values\r\n      const zeroResult = symbolInfoService.validateOrderQuantity(\r\n        exchangeConfigs.bybit,\r\n        0,\r\n        5\r\n      );\r\n      expect(zeroResult.valid).toBe(false);\r\n    });\r\n  });\r\n\r\n  describe('Error Recovery and User Guidance', () => {\r\n    it('should provide actionable suggestions for common errors', () => {\r\n      // Test case: User sets too many parts for their quantity\r\n      const result = symbolInfoService.validateOrderQuantity(\r\n        exchangeConfigs.bybit,\r\n        0.01,\r\n        20\r\n      );\r\n\r\n      expect(result.valid).toBe(false);\r\n      expect(result.suggestion).toContain('reduce graduated parts to 10');\r\n\r\n      // The suggestion should be mathematically correct\r\n      const suggestedParts = 10; // floor(0.01 / 0.001) = 10\r\n      const testResult = symbolInfoService.validateOrderQuantity(\r\n        exchangeConfigs.bybit,\r\n        0.01,\r\n        suggestedParts\r\n      );\r\n      expect(testResult.valid).toBe(true);\r\n    });\r\n\r\n    it('should handle edge cases gracefully', () => {\r\n      // Test null/undefined symbol info\r\n      const nullResult = symbolInfoService.validateOrderQuantity(\r\n        null as any,\r\n        1,\r\n        5\r\n      );\r\n      expect(nullResult.valid).toBe(false);\r\n      expect(nullResult.error).toBe('Symbol information not available');\r\n\r\n      // Test division by zero\r\n      const zeroPartsResult = symbolInfoService.validateOrderQuantity(\r\n        exchangeConfigs.bybit,\r\n        1,\r\n        0\r\n      );\r\n      expect(zeroPartsResult.valid).toBe(false);\r\n      // Should not throw error\r\n    });\r\n  });\r\n});","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\trading\\bot-config-form\\bot-config-form.component.html","messages":[{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":198,"column":17,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":198,"endColumn":65},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":315,"column":17,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":315,"endColumn":70}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"    <!-- View Mode Display -->\r\n    <div *ngIf=\"mode === 'view'\" class=\"bot-view\">\r\n      <ui-card>\r\n        <ui-card-header>\r\n          <ui-card-title>{{ botData?.name || translate('bot.details') }}</ui-card-title>\r\n        </ui-card-header>\r\n        <ui-card-content>\r\n          <div class=\"view-grid\">\r\n            <!-- Basic Information -->\r\n            <div class=\"view-section\">\r\n              <h3>{{ translate('bot.basicInformation') }}</h3>\r\n              <div class=\"view-item\">\r\n                <span class=\"label\">{{ translate('bot.id') }}:</span>\r\n                <span class=\"value\">{{ botData?.id }}</span>\r\n              </div>\r\n              <div class=\"view-item\">\r\n                <span class=\"label\">{{ translate('bot.name') }}:</span>\r\n                <span class=\"value\">{{ botData?.name }}</span>\r\n              </div>\r\n              <div class=\"view-item\">\r\n                <span class=\"label\">{{ translate('bot.symbol') }}:</span>\r\n                <span class=\"value\">{{ botData?.symbol }}</span>\r\n              </div>\r\n              <div class=\"view-item\">\r\n                <span class=\"label\">{{ translate('bot.status') }}:</span>\r\n                <span class=\"value\" [class]=\"'status-' + botData?.status?.toLowerCase()\">\r\n                  {{ botData?.status }}\r\n                </span>\r\n              </div>\r\n              <div class=\"view-item\">\r\n                <span class=\"label\">{{ translate('bot.created') }}:</span>\r\n                <span class=\"value\">{{ botData?.createdAt | date:'medium' }}</span>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- Configuration -->\r\n            <div class=\"view-section\">\r\n              <h3>{{ translate('bot.gridConfiguration') }}</h3>\r\n              <div class=\"view-item\">\r\n                <span class=\"label\">{{ translate('bot.gridLevels') }}:</span>\r\n                <span class=\"value\">{{ botData?.config?.gridStrategy?.gridCount || translate('dashboard.na') }}</span>\r\n              </div>\r\n              <div class=\"view-item\">\r\n                <span class=\"label\">{{ translate('bot.strategyType') }}:</span>\r\n                <span class=\"value\">{{ botData?.config?.gridStrategy?.type || translate('dashboard.na') }}</span>\r\n              </div>\r\n              <div class=\"view-item\">\r\n                <span class=\"label\">{{ translate('bot.upperPrice') }}:</span>\r\n                <span class=\"value\">{{ botData?.config?.gridRange?.upperBound | currency }}</span>\r\n              </div>\r\n              <div class=\"view-item\">\r\n                <span class=\"label\">{{ translate('bot.lowerPrice') }}:</span>\r\n                <span class=\"value\">{{ botData?.config?.gridRange?.lowerBound | currency }}</span>\r\n              </div>\r\n              <div class=\"view-item\">\r\n                <span class=\"label\">{{ translate('bot.orderAmount') }}:</span>\r\n                <span class=\"value\">{{ botData?.config?.riskManagement?.baseOrderSize }}</span>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- Trading Filters -->\r\n            <div class=\"view-section\" *ngIf=\"(botData?.config?.entryFilters && botData?.config?.entryFilters.length > 0) || (botData?.config?.exitFilters && botData?.config?.exitFilters.length > 0)\">\r\n              <h3>{{ translate('bot.tradingFilters') }}</h3>\r\n              <div class=\"view-item\" *ngIf=\"botData?.config?.entryFilters && botData?.config?.entryFilters.length > 0\">\r\n                <span class=\"label\">{{ translate('filter.entryFilters') }}:</span>\r\n                <span class=\"value\">{{ botData?.config?.entryFilters.length }} {{ translate('bot.configured') }}</span>\r\n              </div>\r\n              <div class=\"view-item\" *ngIf=\"botData?.config?.exitFilters && botData?.config?.exitFilters.length > 0\">\r\n                <span class=\"label\">{{ translate('filter.exitFilters') }}:</span>\r\n                <span class=\"value\">{{ botData?.config?.exitFilters.length }} {{ translate('bot.configured') }}</span>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- Performance Metrics -->\r\n            <div class=\"view-section\" *ngIf=\"botData?.performance\">\r\n              <h3>{{ translate('bot.performance') }}</h3>\r\n              <div class=\"view-item\">\r\n                <span class=\"label\">{{ translate('dashboard.totalPnl') }}:</span>\r\n                <span class=\"value\" [class]=\"botData?.totalPnL >= 0 ? 'positive' : 'negative'\">\r\n                  {{ botData?.totalPnL | currency }}\r\n                </span>\r\n              </div>\r\n              <div class=\"view-item\">\r\n                <span class=\"label\">{{ translate('bot.totalTrades') }}:</span>\r\n                <span class=\"value\">{{ botData?.totalTrades || 0 }}</span>\r\n              </div>\r\n              <div class=\"view-item\">\r\n                <span class=\"label\">{{ translate('dashboard.winRate') }}:</span>\r\n                <span class=\"value\">{{ botData?.winRate || 0 }}%</span>\r\n              </div>\r\n              <div class=\"view-item\">\r\n                <span class=\"label\">{{ translate('bot.maxDrawdown') }}:</span>\r\n                <span class=\"value\">{{ botData?.performance?.maxDrawdown || 0 }}%</span>\r\n              </div>\r\n              <div class=\"view-item\">\r\n                <span class=\"label\">{{ translate('bot.sharpeRatio') }}:</span>\r\n                <span class=\"value\">{{ botData?.performance?.sharpeRatio || 0 | number:'1.2-2' }}</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </ui-card-content>\r\n      </ui-card>\r\n\r\n      <div class=\"form-actions\">\r\n        <ui-button variant=\"ghost\" (clicked)=\"onCancel()\">\r\n          {{ translate('button.close') }}\r\n        </ui-button>\r\n        <ui-button variant=\"primary\" (clicked)=\"onEdit()\">\r\n          {{ translate('button.edit') }} {{ translate('bot.name') }}\r\n        </ui-button>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Create/Edit Mode Form -->\r\n    <div *ngIf=\"mode !== 'view'\" class=\"trading-layout\">\r\n      <!-- Left Side: Bybit TradingView Chart -->\r\n      <div class=\"chart-container\" [style.width.%]=\"chartWidth\">\r\n        <div class=\"chart-wrapper\">\r\n          <!-- New Bybit-powered TradingView Chart -->\r\n          <app-lightweight-chart\r\n              [symbol]=\"getSelectedSymbol()\"\r\n              [chartHeight]=\"chartHeight\"\r\n              [gridConfig]=\"currentGridConfig\"\r\n              (symbolChange)=\"onChartSymbolChange($event)\">\r\n          </app-lightweight-chart>\r\n\r\n          <!-- Grid overlay removed as requested -->\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Resizer -->\r\n      <div class=\"resizer\"\r\n           (mousedown)=\"startResize($event)\"\r\n           (touchstart)=\"startResize($event)\">\r\n        <div class=\"resizer-handle\"></div>\r\n      </div>\r\n\r\n      <!-- Right Side: Configuration Form -->\r\n      <div class=\"form-container\" [style.width.%]=\"formWidth\">\r\n        <!-- Progress Indicator -->\r\n        <div class=\"progress-header\">\r\n          <div class=\"progress-steps\">\r\n            <div class=\"step active\">\r\n              <div class=\"step-icon\">‚úì</div>\r\n              <span>Setup</span>\r\n            </div>\r\n            <div class=\"step active\">\r\n              <div class=\"step-icon\">‚úì</div>\r\n              <span>API</span>\r\n            </div>\r\n            <div class=\"step active\">\r\n              <div class=\"step-icon\">‚úì</div>\r\n              <span>Pair</span>\r\n            </div>\r\n            <div class=\"step active\">\r\n              <div class=\"step-icon\">‚úì</div>\r\n              <span>Deposit</span>\r\n            </div>\r\n            <div class=\"step active\">\r\n              <div class=\"step-icon\">‚úì</div>\r\n              <span>Filters</span>\r\n            </div>\r\n            <div class=\"step active\">\r\n              <div class=\"step-icon\">‚úì</div>\r\n              <span>Orders</span>\r\n            </div>\r\n            <div class=\"step current\">\r\n              <div class=\"step-icon\">7</div>\r\n              <span>{{ translate('button.launch') }}</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <form [formGroup]=\"configForm\" (ngSubmit)=\"onSave()\" class=\"bot-config-form\">\r\n          <div class=\"form-content\">\r\n            <!-- Trading Pair Section -->\r\n            <div class=\"config-section\">\r\n              <h3>{{ translate('bot.tradingPair') }}</h3>\r\n              <div class=\"recommended-pairs\">\r\n                <div class=\"section-subtitle\">{{ translate('bot.recommendedPairs') }}</div>\r\n                <div class=\"info-text\">{{ translate('bot.recommendedPairsDesc') }}</div>\r\n\r\n                <div class=\"pairs-grid\">\r\n                  <div class=\"pair-item active\">MEME USDT</div>\r\n                  <div class=\"pair-item\">ORDER USDT</div>\r\n                  <div class=\"pair-item trending\">1000PEPE USDT</div>\r\n                  <div class=\"pair-item\">THE USDT</div>\r\n                  <div class=\"pair-item neutral\">AEVO USDT</div>\r\n                  <div class=\"pair-item\">ASTER USDT</div>\r\n                  <div class=\"pair-item\">PUMPETO USDT</div>\r\n                  <div class=\"pair-item\">STEL USDT</div>\r\n                  <div class=\"pair-item\">PUMPFUN USDT</div>\r\n                  <div class=\"pair-item\">AVNT USDT</div>\r\n                </div>\r\n              </div>\r\n\r\n              <div class=\"form-row\">\r\n                <label>{{ translate('bot.selectPair') }}</label>\r\n                <div class=\"pair-selector\">\r\n                  <ui-select\r\n                    formControlName=\"symbol\"\r\n                    [options]=\"symbolOptions\"\r\n                    [placeholder]=\"translate('bot.selectTradingPair')\">\r\n                  </ui-select>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- Deposit Section -->\r\n            <div class=\"config-section\">\r\n              <h3>{{ translate('bot.deposit') }}</h3>\r\n              <div class=\"deposit-info\">\r\n                <div class=\"balance-display\">\r\n                  <span class=\"currency-icon\">‚ÇÆ</span>\r\n                  <span class=\"amount\">200</span>\r\n                  <div class=\"balance-detail\">\r\n                    <span class=\"balance-value\">0.0854105 USDT</span>\r\n                    <ui-button variant=\"ghost\" size=\"small\" className=\"refresh-btn\">‚Üª</ui-button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              <div class=\"warning-card\">\r\n                <div class=\"warning-icon\">‚ö†Ô∏è</div>\r\n                <div class=\"warning-text\">\r\n                  {{ translate('bot.balanceWarning') }}\r\n                </div>\r\n              </div>\r\n\r\n              <div class=\"warning-card\">\r\n                <div class=\"warning-icon\">‚ö†Ô∏è</div>\r\n                <div class=\"warning-text\">\r\n                  {{ translate('bot.insufficientBalance') }}\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- Bot Configuration -->\r\n            <div class=\"config-section\">\r\n              <h3>{{ translate('bot.configuration') }}</h3>\r\n              <div class=\"form-grid\">\r\n                <div class=\"form-group\">\r\n                  <label for=\"botName\">{{ translate('bot.name') }} *</label>\r\n                  <ui-input\r\n                    id=\"botName\"\r\n                    formControlName=\"name\"\r\n                    [placeholder]=\"translate('bot.enterName')\">\r\n                  </ui-input>\r\n                </div>\r\n\r\n                <div class=\"form-group\">\r\n                  <label for=\"gridCount\">{{ translate('bot.gridLevels') }} *</label>\r\n                  <ui-input\r\n                    id=\"gridCount\"\r\n                    type=\"number\"\r\n                    formControlName=\"gridCount\"\r\n                    placeholder=\"10\"\r\n                    min=\"2\"\r\n                    max=\"100\">\r\n                  </ui-input>\r\n                </div>\r\n\r\n                <div class=\"form-group\">\r\n                  <label for=\"baseOrderSize\">{{ translate('bot.orderAmount') }} *</label>\r\n                  <ui-input\r\n                    id=\"baseOrderSize\"\r\n                    type=\"number\"\r\n                    formControlName=\"baseOrderSize\"\r\n                    placeholder=\"10\"\r\n                    step=\"0.01\"\r\n                    min=\"0.01\">\r\n                  </ui-input>\r\n                </div>\r\n\r\n                <div class=\"form-group\">\r\n                  <label for=\"upperBound\">{{ translate('bot.upperPrice') }} *</label>\r\n                  <ui-input\r\n                    id=\"upperBound\"\r\n                    type=\"number\"\r\n                    formControlName=\"upperBound\"\r\n                    placeholder=\"50000\"\r\n                    step=\"0.01\"\r\n                    min=\"0\">\r\n                  </ui-input>\r\n                </div>\r\n\r\n                <div class=\"form-group\">\r\n                  <label for=\"lowerBound\">{{ translate('bot.lowerPrice') }} *</label>\r\n                  <ui-input\r\n                    id=\"lowerBound\"\r\n                    type=\"number\"\r\n                    formControlName=\"lowerBound\"\r\n                    placeholder=\"30000\"\r\n                    step=\"0.01\"\r\n                    min=\"0\">\r\n                  </ui-input>\r\n                </div>\r\n\r\n                <div class=\"form-group\">\r\n                  <label for=\"strategyType\">{{ translate('bot.gridStrategy') }} *</label>\r\n                  <ui-select\r\n                    id=\"strategyType\"\r\n                    formControlName=\"strategyType\"\r\n                    [options]=\"strategyOptions\"\r\n                    [placeholder]=\"translate('bot.selectStrategyType')\">\r\n                  </ui-select>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- Risk Management -->\r\n            <div class=\"config-section\">\r\n              <h3>{{ translate('bot.riskManagement') }}</h3>\r\n              <div class=\"risk-slider\">\r\n                <label>{{ translate('bot.selectOrderType') }}</label>\r\n                <div class=\"slider-container\">\r\n                  <div class=\"slider-track\">\r\n                    <div class=\"slider-fill\" style=\"width: 50%\"></div>\r\n                  </div>\r\n                  <div class=\"slider-value\">20</div>\r\n                </div>\r\n              </div>\r\n\r\n              <div class=\"warning-card\">\r\n                <div class=\"warning-icon\">‚ö†Ô∏è</div>\r\n                <div class=\"warning-text\">\r\n                  {{ translate('bot.leverageWarning') }}\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- Terms Section -->\r\n            <div class=\"config-section\">\r\n              <h3>{{ translate('bot.termsAndConditions') }}</h3>\r\n              <div class=\"terms-grid\">\r\n                <div class=\"term-type\">\r\n                  <h4>{{ translate('bot.conservative') }}</h4>\r\n                  <div class=\"filter-count\">{{ translate('bot.filters') }}: 7</div>\r\n                </div>\r\n                <div class=\"term-type\">\r\n                  <h4>{{ translate('bot.balanced') }}</h4>\r\n                  <div class=\"filter-count\">{{ translate('bot.filters') }}: 4</div>\r\n                </div>\r\n                <div class=\"term-type\">\r\n                  <h4>{{ translate('bot.aggressive') }}</h4>\r\n                  <div class=\"filter-count\">{{ translate('bot.filters') }}: 4</div>\r\n                </div>\r\n              </div>\r\n\r\n              <div class=\"checkbox-option\">\r\n                <input type=\"checkbox\" id=\"accept-terms\">\r\n                <label for=\"accept-terms\">{{ translate('bot.iUnderstand') }}</label>\r\n              </div>\r\n\r\n              <div class=\"test-info\">\r\n                <span>{{ translate('bot.availableTests') }}: 1</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"form-actions\">\r\n            <ui-button variant=\"ghost\" (clicked)=\"onCancel()\">\r\n              {{ translate('button.cancel') }}\r\n            </ui-button>\r\n            <ui-button variant=\"primary\" type=\"submit\" [disabled]=\"!configForm.valid\" class=\"launch-btn\">\r\n              üîß {{ mode === 'edit' ? translate('button.update') + ' ' + translate('bot.name') : translate('button.launch') + ' ' + translate('bot.name') }}\r\n            </ui-button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\trading\\bot-config-form\\bot-config-form.component.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1444,1447],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1444,1447],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1476,1479],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1476,1479],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1518,1521],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1518,1521],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1611,1614],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1611,1614],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":42,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1752,1755],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1752,1755],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1784,1787],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1784,1787],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":97,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":97,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .name on an `any` value.","line":97,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":97,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":98,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":98,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":98,"column":30,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":98,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":99,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":99,"endColumn":70},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .config on an `any` value.","line":99,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":99,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":100,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":100,"endColumn":80},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .config on an `any` value.","line":100,"column":37,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":100,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":101,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":101,"endColumn":72},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .config on an `any` value.","line":101,"column":34,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":101,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":102,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":102,"endColumn":72},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .config on an `any` value.","line":102,"column":34,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":102,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":103,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":103,"endColumn":75},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .config on an `any` value.","line":103,"column":36,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":103,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":107,"column":7,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":107,"endColumn":66},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .config on an `any` value.","line":107,"column":40,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":107,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":108,"column":7,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":108,"endColumn":64},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .config on an `any` value.","line":108,"column":39,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":108,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":120,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":120,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":122,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":122,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .upperBound on an `any` value.","line":122,"column":39,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":122,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .lowerBound on an `any` value.","line":122,"column":63,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":122,"endColumn":73},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .gridCount on an `any` value.","line":122,"column":87,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":122,"endColumn":96},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":124,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":124,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":124,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":124,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":125,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":125,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .upperBound on an `any` value.","line":125,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":125,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":126,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":126,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .lowerBound on an `any` value.","line":126,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":126,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":127,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":127,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .gridCount on an `any` value.","line":127,"column":30,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":127,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":129,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":129,"endColumn":58},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .strategyType on an `any` value.","line":129,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":129,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":138,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":138,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":141,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":141,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .id on an `any` value.","line":141,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":141,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":142,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":142,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .name on an `any` value.","line":142,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":142,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":143,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":143,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":143,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":143,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":145,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":145,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":145,"column":29,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":145,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":146,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":146,"endColumn":61},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":146,"column":22,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":146,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":146,"column":32,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":146,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access [0] on an `any` value.","line":146,"column":50,"nodeType":"Literal","messageId":"unsafeMemberExpression","endLine":146,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":147,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":147,"endColumn":63},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":147,"column":23,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":147,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":147,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":147,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access [1] on an `any` value.","line":147,"column":51,"nodeType":"Literal","messageId":"unsafeMemberExpression","endLine":147,"endColumn":52},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":149,"column":13,"nodeType":"Property","messageId":"anyAssignment","endLine":149,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .strategyType on an `any` value.","line":149,"column":29,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":149,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":150,"column":13,"nodeType":"Property","messageId":"anyAssignment","endLine":150,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .gridCount on an `any` value.","line":150,"column":34,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":150,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":154,"column":13,"nodeType":"Property","messageId":"anyAssignment","endLine":154,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .upperBound on an `any` value.","line":154,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":154,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":155,"column":13,"nodeType":"Property","messageId":"anyAssignment","endLine":155,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .lowerBound on an `any` value.","line":155,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":155,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":161,"column":13,"nodeType":"Property","messageId":"anyAssignment","endLine":161,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .baseOrderSize on an `any` value.","line":161,"column":38,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":161,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .baseOrderSize on an `any` value.","line":162,"column":40,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":162,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .gridCount on an `any` value.","line":162,"column":66,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":162,"endColumn":75},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":163,"column":13,"nodeType":"Property","messageId":"anyAssignment","endLine":163,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .gridCount on an `any` value.","line":163,"column":38,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":163,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":235,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":235,"endColumn":70},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":236,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":236,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":236,"column":12,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":236,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .replace on an `any` value.","line":236,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":236,"endColumn":26}],"suppressedMessages":[],"errorCount":74,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, Input, Output, EventEmitter, OnInit, inject } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormBuilder, FormGroup, Validators, ReactiveFormsModule } from '@angular/forms';\r\n\r\nimport { InputComponent } from '../../ui/input/input.component';\r\nimport { SelectComponent } from '../../ui/select/select.component';\r\nimport { ButtonComponent } from '../../ui/button/button.component';\r\nimport { CardComponent, CardHeaderComponent, CardTitleComponent, CardContentComponent } from '../../ui/card/card.component';\r\nimport { LightweightChartComponent, GridConfig } from '../../lightweight-chart/lightweight-chart.component';\r\nimport { EntryFilterComponent, TradingFilter } from '../entry-filter/entry-filter.component';\r\nimport { TranslationService } from '../../../services/translation.service';\r\n\r\n@Component({\r\n  selector: 'app-bot-config-form',\r\n  standalone: true,\r\n  imports: [\r\n    CommonModule,\r\n    ReactiveFormsModule,\r\n    InputComponent,\r\n    SelectComponent,\r\n    ButtonComponent,\r\n    CardComponent,\r\n    CardHeaderComponent,\r\n    CardTitleComponent,\r\n    CardContentComponent,\r\n    LightweightChartComponent,\r\n    EntryFilterComponent,\r\n  ],\r\n  templateUrl: './bot-config-form.component.html',\r\n  styleUrls: ['./bot-config-form.component.css']\r\n})\r\nexport class BotConfigFormComponent implements OnInit {\r\n  @Input() mode: 'create' | 'edit' | 'view' = 'create';\r\n  @Input() botData?: any;\r\n  @Input() strategyData?: any;\r\n  @Output() save = new EventEmitter<any>();\r\n  @Output() cancel = new EventEmitter<void>();\r\n  @Output() edit = new EventEmitter<any>();\r\n\r\n  configForm: FormGroup;\r\n  symbols: string[] = ['BTC/USDT', 'ETH/USDT', 'ADA/USDT', 'DOT/USDT', 'MATIC/USDT'];\r\n  symbolOptions: any[] = [];\r\n  strategyOptions: any[] = [\r\n    { value: 'REGULAR', label: 'Regular (Linear)' },\r\n    { value: 'FIBONACCI', label: 'Fibonacci' },\r\n    { value: 'LOGARITHMIC', label: 'Logarithmic' },\r\n    { value: 'MULTIPLICATOR', label: 'Multiplicator' },\r\n    { value: 'MARTINGALE', label: 'Martingale' }\r\n  ];\r\n  currentGridConfig?: GridConfig;\r\n  entryFilters: TradingFilter[] = [];\r\n  exitFilters: TradingFilter[] = [];\r\n\r\n  // Grid overlay properties removed\r\n\r\n  // Resizable layout properties\r\n  chartWidth = 65;\r\n  chartHeight = 600;\r\n  formWidth = 35;\r\n  private isResizing = false;\r\n  private startX = 0;\r\n  private startChartWidth = 0;\r\n\r\n  protected translationService = inject(TranslationService);\r\n\r\n  constructor(private fb: FormBuilder) {\r\n    this.configForm = this.createForm();\r\n  }\r\n\r\n  translate(key: string): string {\r\n    return this.translationService.translate(key);\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.symbolOptions = this.symbols.map(s => ({ value: s, label: s }));\r\n    this.populateFormData();\r\n    this.updateGridConfig();\r\n    this.setupFormValueChanges();\r\n    this.setupResizeListeners();\r\n  }\r\n\r\n  private createForm(): FormGroup {\r\n    return this.fb.group({\r\n      name: ['', [Validators.required, Validators.minLength(3)]],\r\n      symbol: ['BTC/USDT', Validators.required],\r\n      gridCount: [10, [Validators.required, Validators.min(2), Validators.max(100)]],\r\n      baseOrderSize: [10, [Validators.required, Validators.min(0.01)]],\r\n      upperBound: [50000, [Validators.required, Validators.min(0)]],\r\n      lowerBound: [30000, [Validators.required, Validators.min(0)]],\r\n      strategyType: ['REGULAR', Validators.required]\r\n    });\r\n  }\r\n\r\n  private populateFormData() {\r\n    if (this.mode === 'edit' && this.botData) {\r\n      this.configForm.patchValue({\r\n        name: this.botData.name,\r\n        symbol: this.botData.symbol,\r\n        gridCount: this.botData.config?.gridStrategy?.gridCount || 10,\r\n        baseOrderSize: this.botData.config?.riskManagement?.baseOrderSize || 10,\r\n        upperBound: this.botData.config?.gridRange?.upperBound || 50000,\r\n        lowerBound: this.botData.config?.gridRange?.lowerBound || 30000,\r\n        strategyType: this.botData.config?.gridStrategy?.type || 'REGULAR'\r\n      });\r\n\r\n      // Load existing filters\r\n      this.entryFilters = this.botData.config?.entryFilters || [];\r\n      this.exitFilters = this.botData.config?.exitFilters || [];\r\n    }\r\n  }\r\n\r\n  private setupFormValueChanges() {\r\n    // Update grid configuration whenever form values change\r\n    this.configForm.valueChanges.subscribe(() => {\r\n      this.updateGridConfig();\r\n    });\r\n  }\r\n\r\n  private updateGridConfig() {\r\n    const formValue = this.configForm.value;\r\n\r\n    if (formValue.symbol && formValue.upperBound && formValue.lowerBound && formValue.gridCount) {\r\n      this.currentGridConfig = {\r\n        symbol: formValue.symbol,\r\n        upperBound: formValue.upperBound,\r\n        lowerBound: formValue.lowerBound,\r\n        gridCount: formValue.gridCount,\r\n        gridSpacing: 1.0, // Will be calculated based on strategy\r\n        strategyType: formValue.strategyType || 'REGULAR'\r\n      };\r\n\r\n      // Grid calculation removed\r\n    }\r\n  }\r\n\r\n  onSave() {\r\n    if (this.configForm.valid) {\r\n      const formValue = this.configForm.value;\r\n\r\n      const botConfig = {\r\n        id: this.botData?.id,\r\n        name: formValue.name,\r\n        symbol: formValue.symbol,\r\n        config: {\r\n          symbol: formValue.symbol,\r\n          baseAsset: formValue.symbol.split('/')[0] || 'BTC',\r\n          quoteAsset: formValue.symbol.split('/')[1] || 'USDT',\r\n          gridStrategy: {\r\n            type: formValue.strategyType || 'REGULAR',\r\n            gridCount: formValue.gridCount,\r\n            gridSpacing: 1.0\r\n          },\r\n          gridRange: {\r\n            upperBound: formValue.upperBound,\r\n            lowerBound: formValue.lowerBound,\r\n            autoAdjust: false\r\n          },\r\n          entryFilters: this.entryFilters,\r\n          exitFilters: this.exitFilters,\r\n          riskManagement: {\r\n            baseOrderSize: formValue.baseOrderSize,\r\n            maxPositionSize: formValue.baseOrderSize * formValue.gridCount,\r\n            maxOpenOrders: formValue.gridCount\r\n          }\r\n        }\r\n      };\r\n\r\n      this.save.emit(botConfig);\r\n    } else {\r\n      Object.keys(this.configForm.controls).forEach(key => {\r\n        const control = this.configForm.get(key);\r\n        control?.markAsTouched();\r\n      });\r\n    }\r\n  }\r\n\r\n  onCancel() {\r\n    this.cancel.emit();\r\n  }\r\n\r\n  onEdit() {\r\n    this.edit.emit(this.botData);\r\n  }\r\n\r\n  onEntryFiltersChange(filters: TradingFilter[]) {\r\n    this.entryFilters = filters;\r\n  }\r\n\r\n  onExitFiltersChange(filters: TradingFilter[]) {\r\n    this.exitFilters = filters;\r\n  }\r\n\r\n  // Resizable layout methods\r\n  startResize(event: MouseEvent | TouchEvent) {\r\n    this.isResizing = true;\r\n    this.startX = this.getClientX(event);\r\n    this.startChartWidth = this.chartWidth;\r\n\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n  }\r\n\r\n  private setupResizeListeners() {\r\n    document.addEventListener('mousemove', this.handleResize.bind(this));\r\n    document.addEventListener('mouseup', this.endResize.bind(this));\r\n    document.addEventListener('touchmove', this.handleResize.bind(this));\r\n    document.addEventListener('touchend', this.endResize.bind(this));\r\n  }\r\n\r\n  private handleResize(event: MouseEvent | TouchEvent) {\r\n    if (!this.isResizing) return;\r\n\r\n    const currentX = this.getClientX(event);\r\n    const deltaX = currentX - this.startX;\r\n    const containerWidth = window.innerWidth - 48; // Account for padding\r\n    const deltaPercent = (deltaX / containerWidth) * 100;\r\n\r\n    let newChartWidth = this.startChartWidth + deltaPercent;\r\n\r\n    // Constrain between 30% and 80%\r\n    newChartWidth = Math.max(30, Math.min(80, newChartWidth));\r\n\r\n    this.chartWidth = newChartWidth;\r\n    this.formWidth = 100 - newChartWidth;\r\n\r\n    event.preventDefault();\r\n  }\r\n\r\n  private endResize() {\r\n    this.isResizing = false;\r\n  }\r\n\r\n  // Chart-related methods\r\n  getSelectedSymbol(): string {\r\n    const symbol = this.configForm.get('symbol')?.value || 'BTC/USDT';\r\n    return symbol.replace('/', '');\r\n  }\r\n\r\n  onChartSymbolChange(symbol: string) {\r\n    // Update form when chart symbol changes\r\n    const formattedSymbol = symbol.includes('/') ? symbol : symbol.replace('USDT', '/USDT');\r\n    this.configForm.patchValue({ symbol: formattedSymbol });\r\n    this.updateGridConfig();\r\n  }\r\n\r\n  // Grid calculation methods removed as grid overlay is no longer needed\r\n\r\n  private getClientX(event: MouseEvent | TouchEvent): number {\r\n    if (event instanceof MouseEvent) {\r\n      return event.clientX;\r\n    } else {\r\n      return event.touches[0]?.clientX || 0;\r\n    }\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\trading\\bot-config-page\\bot-config-page.component.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1079,1082],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1079,1082],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1102,1105],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1102,1105],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":47,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":47,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":48,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":48,"endColumn":64},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":50,"column":7,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":50,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":62,"column":11,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":62,"endColumn":66},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":63,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":63,"endColumn":19},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":90,"column":9,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":90,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .name on an `any` value.","line":94,"column":125,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":94,"endColumn":129},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":94,"column":137,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":94,"endColumn":143},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":105,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3225,3228],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3225,3228],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .id on an `any` value.","line":109,"column":41,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":109,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .id on an `any` value.","line":110,"column":45,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":110,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .config on an `any` value.","line":110,"column":67,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":110,"endColumn":73},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'botData' is defined but never used.","line":142,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":142,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":142,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":142,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4352,4355],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4352,4355],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":153,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":153,"endColumn":51}],"suppressedMessages":[],"errorCount":17,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, OnInit, inject } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { BotConfigFormComponent } from '../bot-config-form/bot-config-form.component';\r\nimport { ButtonComponent } from '../../ui/button/button.component';\r\nimport { CardComponent, CardHeaderComponent, CardTitleComponent, CardContentComponent } from '../../ui/card/card.component';\r\nimport { GridBotService } from '../../../services/grid-bot.service';\r\nimport { TranslationService } from '../../../services/translation.service';\r\n\r\n@Component({\r\n  selector: 'app-bot-config-page',\r\n  standalone: true,\r\n  imports: [\r\n    CommonModule,\r\n    BotConfigFormComponent,\r\n    ButtonComponent,\r\n    CardComponent,\r\n    CardHeaderComponent,\r\n    CardTitleComponent,\r\n    CardContentComponent\r\n  ],\r\n  templateUrl: './bot-config-page.component.html',\r\n  styleUrl: './bot-config-page.component.scss'\r\n})\r\nexport class BotConfigPageComponent implements OnInit {\r\n  mode: 'create' | 'edit' | 'view' = 'create';\r\n  botData?: any;\r\n  strategyData?: any;\r\n  loading = false;\r\n  error: string | null = null;\r\n  pageTitle = 'Create New Bot';\r\n\r\n  protected translationService = inject(TranslationService);\r\n\r\n  constructor(\r\n    private route: ActivatedRoute,\r\n    private router: Router,\r\n    private gridBotService: GridBotService\r\n  ) {}\r\n\r\n  translate(key: string): string {\r\n    return this.translationService.translate(key);\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.route.params.subscribe(params => {\r\n      const botId = params['id'];\r\n      const mode = this.route.snapshot.data['mode'] || 'create';\r\n\r\n      this.mode = mode;\r\n      this.updatePageTitle();\r\n\r\n      if (botId && (mode === 'edit' || mode === 'view')) {\r\n        this.loadBot(botId);\r\n      }\r\n    });\r\n\r\n    // Check for query parameters (strategy data, etc.)\r\n    this.route.queryParams.subscribe(queryParams => {\r\n      if (queryParams['strategy']) {\r\n        try {\r\n          this.strategyData = JSON.parse(queryParams['strategy']);\r\n        } catch (e) {\r\n          console.warn('Invalid strategy data in query params');\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  private updatePageTitle() {\r\n    switch (this.mode) {\r\n      case 'create':\r\n        this.pageTitle = this.translate('dashboard.createBot');\r\n        break;\r\n      case 'edit':\r\n        this.pageTitle = this.translate('bot.editConfiguration');\r\n        break;\r\n      case 'view':\r\n        this.pageTitle = this.translate('bot.details');\r\n        break;\r\n    }\r\n  }\r\n\r\n  private loadBot(botId: string) {\r\n    this.loading = true;\r\n    this.error = null;\r\n\r\n    this.gridBotService.getBot(botId).subscribe({\r\n      next: (bot) => {\r\n        this.botData = bot;\r\n        this.loading = false;\r\n\r\n        if (this.mode === 'view' || this.mode === 'edit') {\r\n          this.pageTitle = `${this.mode === 'view' ? this.translate('bot.details') : this.translate('button.edit')} - ${bot.name || bot.symbol}`;\r\n        }\r\n      },\r\n      error: (error) => {\r\n        this.error = this.translate('bot.errorConfiguration');\r\n        this.loading = false;\r\n        console.error('Failed to load bot:', error);\r\n      }\r\n    });\r\n  }\r\n\r\n  onBotSave(botData: any) {\r\n    this.loading = true;\r\n    this.error = null;\r\n\r\n    if (this.mode === 'edit' && botData.id) {\r\n      this.gridBotService.updateBot(botData.id, 'update', botData.config).subscribe({\r\n        next: (response) => {\r\n          this.loading = false;\r\n          console.log('Bot updated successfully:', response);\r\n          this.router.navigate(['/trading']);\r\n        },\r\n        error: (error) => {\r\n          this.loading = false;\r\n          this.error = this.translate('bot.failedToUpdate');\r\n          console.error('Failed to update bot:', error);\r\n        }\r\n      });\r\n    } else {\r\n      this.gridBotService.createBot(botData).subscribe({\r\n        next: (response) => {\r\n          this.loading = false;\r\n          console.log('Bot created successfully:', response);\r\n          this.router.navigate(['/trading']);\r\n        },\r\n        error: (error) => {\r\n          this.loading = false;\r\n          this.error = this.translate('bot.failedToCreate');\r\n          console.error('Failed to create bot:', error);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  onBotCancel() {\r\n    this.goBack();\r\n  }\r\n\r\n  onBotEdit(botData: any) {\r\n    // Switch to edit mode\r\n    this.mode = 'edit';\r\n    this.updatePageTitle();\r\n  }\r\n\r\n  goBack() {\r\n    this.router.navigate(['/trading']);\r\n  }\r\n\r\n  retry() {\r\n    const botId = this.route.snapshot.params['id'];\r\n    if (botId) {\r\n      this.loadBot(botId);\r\n    } else {\r\n      this.error = null;\r\n    }\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\trading\\entry-filter\\entry-filter.component.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'FormArray' is defined but never used.","line":3,"column":67,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":76},{"ruleId":"@typescript-eslint/no-empty-function","severity":2,"message":"Unexpected empty method 'ngOnInit'.","line":202,"column":14,"nodeType":"FunctionExpression","messageId":"unexpected","endLine":202,"endColumn":16,"suggestions":[{"messageId":"suggestComment","data":{"name":"method 'ngOnInit'"},"fix":{"range":[5639,5639],"text":" /* empty */ "},"desc":"Add comment inside empty method 'ngOnInit'."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":245,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":245,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":248,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":248,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .name on an `any` value.","line":248,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":248,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":251,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":251,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .indicator on an `any` value.","line":251,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":251,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":252,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":252,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .condition on an `any` value.","line":252,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":252,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":253,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":253,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .value on an `any` value.","line":253,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":253,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":254,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":254,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .period on an `any` value.","line":254,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":254,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":255,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":255,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .timeframe on an `any` value.","line":255,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":255,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":256,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":256,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .description on an `any` value.","line":256,"column":30,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":256,"endColumn":41},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":279,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":279,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7739,7742],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7739,7742],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":281,"column":5,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":281,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .target on an `any` value.","line":281,"column":39,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":281,"endColumn":45},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":293,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":293,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8126,8129],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8126,8129],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":295,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":295,"endColumn":129},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .value on an `any` value.","line":295,"column":90,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":295,"endColumn":95},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .target on an `any` value.","line":295,"column":115,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":295,"endColumn":121}],"suppressedMessages":[],"errorCount":24,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, Input, Output, EventEmitter, OnInit, inject } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormBuilder, FormGroup, Validators, ReactiveFormsModule, FormArray } from '@angular/forms';\r\nimport { ButtonComponent } from '../../ui/button/button.component';\r\nimport { CardComponent, CardHeaderComponent, CardTitleComponent, CardContentComponent, CardActionsComponent } from '../../ui/card/card.component';\r\nimport { InputComponent } from '../../ui/input/input.component';\r\nimport { SelectComponent } from '../../ui/select/select.component';\r\nimport { TranslationService } from '../../../services/translation.service';\r\n\r\nexport interface TradingFilter {\r\n  id: string;\r\n  name: string;\r\n  type: 'ENTRY' | 'EXIT';\r\n  enabled: boolean;\r\n  indicator: string;\r\n  condition: string;\r\n  value: number;\r\n  timeframe?: string;\r\n  period?: number;\r\n  description?: string;\r\n}\r\n\r\nexport interface IndicatorOption {\r\n  value: string;\r\n  label: string;\r\n  description: string;\r\n  hasValue: boolean;\r\n  hasPeriod: boolean;\r\n  hasTimeframe: boolean;\r\n  defaultPeriod?: number;\r\n  minValue?: number;\r\n  maxValue?: number;\r\n}\r\n\r\n@Component({\r\n  selector: 'app-entry-filter',\r\n  standalone: true,\r\n  imports: [\r\n    CommonModule,\r\n    ReactiveFormsModule,\r\n    ButtonComponent,\r\n    CardComponent,\r\n    CardHeaderComponent,\r\n    CardTitleComponent,\r\n    CardContentComponent,\r\n    CardActionsComponent,\r\n    InputComponent,\r\n    SelectComponent\r\n  ],\r\n  templateUrl: './entry-filter.component.html',\r\n  styleUrls: ['./entry-filter.component.css']\r\n})\r\nexport class EntryFilterComponent implements OnInit {\r\n  protected translationService = inject(TranslationService);\r\n  @Input() mode: 'ENTRY' | 'EXIT' = 'ENTRY';\r\n  @Input() filters: TradingFilter[] = [];\r\n  @Output() filtersChange = new EventEmitter<TradingFilter[]>();\r\n\r\n  filterForm: FormGroup;\r\n  showForm = false;\r\n  editingIndex = -1;\r\n  selectedIndicator?: IndicatorOption;\r\n\r\n  translate(key: string): string {\r\n    return this.translationService.translate(key);\r\n  }\r\n\r\n  indicatorOptions: IndicatorOption[] = [\r\n    {\r\n      value: 'SMA',\r\n      label: 'Simple Moving Average (SMA)',\r\n      description: 'Average price over a period',\r\n      hasValue: true,\r\n      hasPeriod: true,\r\n      hasTimeframe: true,\r\n      defaultPeriod: 20,\r\n      minValue: 0,\r\n      maxValue: 1000000\r\n    },\r\n    {\r\n      value: 'EMA',\r\n      label: 'Exponential Moving Average (EMA)',\r\n      description: 'Weighted average giving more importance to recent prices',\r\n      hasValue: true,\r\n      hasPeriod: true,\r\n      hasTimeframe: true,\r\n      defaultPeriod: 20,\r\n      minValue: 0,\r\n      maxValue: 1000000\r\n    },\r\n    {\r\n      value: 'RSI',\r\n      label: 'Relative Strength Index (RSI)',\r\n      description: 'Momentum oscillator (0-100)',\r\n      hasValue: true,\r\n      hasPeriod: true,\r\n      hasTimeframe: true,\r\n      defaultPeriod: 14,\r\n      minValue: 0,\r\n      maxValue: 100\r\n    },\r\n    {\r\n      value: 'MACD',\r\n      label: 'MACD Signal',\r\n      description: 'Moving Average Convergence Divergence',\r\n      hasValue: true,\r\n      hasPeriod: false,\r\n      hasTimeframe: true,\r\n      minValue: -1000,\r\n      maxValue: 1000\r\n    },\r\n    {\r\n      value: 'STOCH',\r\n      label: 'Stochastic Oscillator',\r\n      description: 'Momentum indicator (0-100)',\r\n      hasValue: true,\r\n      hasPeriod: true,\r\n      hasTimeframe: true,\r\n      defaultPeriod: 14,\r\n      minValue: 0,\r\n      maxValue: 100\r\n    },\r\n    {\r\n      value: 'BOLLINGER_UPPER',\r\n      label: 'Bollinger Bands Upper',\r\n      description: 'Upper Bollinger Band level',\r\n      hasValue: true,\r\n      hasPeriod: true,\r\n      hasTimeframe: true,\r\n      defaultPeriod: 20,\r\n      minValue: 0,\r\n      maxValue: 1000000\r\n    },\r\n    {\r\n      value: 'BOLLINGER_LOWER',\r\n      label: 'Bollinger Bands Lower',\r\n      description: 'Lower Bollinger Band level',\r\n      hasValue: true,\r\n      hasPeriod: true,\r\n      hasTimeframe: true,\r\n      defaultPeriod: 20,\r\n      minValue: 0,\r\n      maxValue: 1000000\r\n    },\r\n    {\r\n      value: 'VOLUME',\r\n      label: 'Volume',\r\n      description: 'Trading volume',\r\n      hasValue: true,\r\n      hasPeriod: false,\r\n      hasTimeframe: true,\r\n      minValue: 0,\r\n      maxValue: 1000000000\r\n    },\r\n    {\r\n      value: 'ATR',\r\n      label: 'Average True Range (ATR)',\r\n      description: 'Volatility indicator',\r\n      hasValue: true,\r\n      hasPeriod: true,\r\n      hasTimeframe: true,\r\n      defaultPeriod: 14,\r\n      minValue: 0,\r\n      maxValue: 1000\r\n    },\r\n    {\r\n      value: 'ADX',\r\n      label: 'Average Directional Index (ADX)',\r\n      description: 'Trend strength indicator (0-100)',\r\n      hasValue: true,\r\n      hasPeriod: true,\r\n      hasTimeframe: true,\r\n      defaultPeriod: 14,\r\n      minValue: 0,\r\n      maxValue: 100\r\n    }\r\n  ];\r\n\r\n  conditionOptions = [\r\n    { value: 'GREATER_THAN', label: 'Greater Than (>)' },\r\n    { value: 'LESS_THAN', label: 'Less Than (<)' },\r\n    { value: 'GREATER_EQUAL', label: 'Greater Than or Equal (>=)' },\r\n    { value: 'LESS_EQUAL', label: 'Less Than or Equal (<=)' },\r\n    { value: 'EQUAL', label: 'Equal To (=)' },\r\n    { value: 'CROSS_ABOVE', label: 'Cross Above' },\r\n    { value: 'CROSS_BELOW', label: 'Cross Below' }\r\n  ];\r\n\r\n  timeframeOptions = [\r\n    { value: '1m', label: '1 Minute' },\r\n    { value: '5m', label: '5 Minutes' },\r\n    { value: '15m', label: '15 Minutes' },\r\n    { value: '1h', label: '1 Hour' },\r\n    { value: '4h', label: '4 Hours' },\r\n    { value: '1d', label: '1 Day' }\r\n  ];\r\n\r\n  constructor(private fb: FormBuilder) {\r\n    this.filterForm = this.createForm();\r\n  }\r\n\r\n  ngOnInit() {}\r\n\r\n  private createForm(): FormGroup {\r\n    return this.fb.group({\r\n      name: ['', [Validators.required, Validators.minLength(3)]],\r\n      indicator: ['', Validators.required],\r\n      condition: ['', Validators.required],\r\n      value: [null],\r\n      period: [null],\r\n      timeframe: ['1h'],\r\n      description: ['']\r\n    });\r\n  }\r\n\r\n  addFilter() {\r\n    this.showForm = true;\r\n    this.editingIndex = -1;\r\n    this.filterForm.reset({\r\n      timeframe: '1h'\r\n    });\r\n  }\r\n\r\n  editFilter(index: number) {\r\n    this.showForm = true;\r\n    this.editingIndex = index;\r\n    const filter = this.filters[index];\r\n\r\n    this.filterForm.patchValue({\r\n      name: filter.name,\r\n      indicator: filter.indicator,\r\n      condition: filter.condition,\r\n      value: filter.value,\r\n      period: filter.period,\r\n      timeframe: filter.timeframe || '1h',\r\n      description: filter.description || ''\r\n    });\r\n\r\n    this.onIndicatorChange(filter.indicator);\r\n  }\r\n\r\n  saveFilter() {\r\n    if (!this.filterForm.valid) return;\r\n\r\n    const formValue = this.filterForm.value;\r\n    const filter: TradingFilter = {\r\n      id: this.editingIndex !== -1 ? this.filters[this.editingIndex].id : this.generateFilterId(),\r\n      name: formValue.name,\r\n      type: this.mode,\r\n      enabled: true,\r\n      indicator: formValue.indicator,\r\n      condition: formValue.condition,\r\n      value: formValue.value,\r\n      period: formValue.period,\r\n      timeframe: formValue.timeframe,\r\n      description: formValue.description\r\n    };\r\n\r\n    const newFilters = [...this.filters];\r\n    if (this.editingIndex !== -1) {\r\n      newFilters[this.editingIndex] = filter;\r\n    } else {\r\n      newFilters.push(filter);\r\n    }\r\n\r\n    this.filters = newFilters;\r\n    this.filtersChange.emit(this.filters);\r\n    this.cancelForm();\r\n  }\r\n\r\n  removeFilter(index: number) {\r\n    if (confirm('Are you sure you want to remove this filter?')) {\r\n      const newFilters = this.filters.filter((_, i) => i !== index);\r\n      this.filters = newFilters;\r\n      this.filtersChange.emit(this.filters);\r\n    }\r\n  }\r\n\r\n  toggleFilter(index: number, event: any) {\r\n    const newFilters = [...this.filters];\r\n    newFilters[index].enabled = event.target.checked;\r\n    this.filters = newFilters;\r\n    this.filtersChange.emit(this.filters);\r\n  }\r\n\r\n  cancelForm() {\r\n    this.showForm = false;\r\n    this.editingIndex = -1;\r\n    this.selectedIndicator = undefined;\r\n    this.filterForm.reset();\r\n  }\r\n\r\n  onIndicatorChange(indicatorValue: string | any) {\r\n    // Handle both string values and event objects\r\n    const value = typeof indicatorValue === 'string' ? indicatorValue : (indicatorValue?.value || indicatorValue?.target?.value);\r\n    this.selectedIndicator = this.indicatorOptions.find(opt => opt.value === value);\r\n\r\n    if (this.selectedIndicator) {\r\n      // Set default period if applicable\r\n      if (this.selectedIndicator.hasPeriod && this.selectedIndicator.defaultPeriod) {\r\n        this.filterForm.patchValue({ period: this.selectedIndicator.defaultPeriod });\r\n      }\r\n\r\n      // Update form validators based on indicator\r\n      if (this.selectedIndicator.hasValue) {\r\n        this.filterForm.get('value')?.setValidators([Validators.required]);\r\n      } else {\r\n        this.filterForm.get('value')?.clearValidators();\r\n      }\r\n      this.filterForm.get('value')?.updateValueAndValidity();\r\n    }\r\n  }\r\n\r\n  getFilterDescription(filter: TradingFilter): string {\r\n    const indicator = this.indicatorOptions.find(opt => opt.value === filter.indicator);\r\n    const condition = this.conditionOptions.find(opt => opt.value === filter.condition);\r\n\r\n    let description = `${indicator?.label || filter.indicator} ${condition?.label || filter.condition}`;\r\n\r\n    if (filter.value !== null && filter.value !== undefined) {\r\n      description += ` ${filter.value}`;\r\n    }\r\n\r\n    if (filter.period) {\r\n      description += ` (Period: ${filter.period})`;\r\n    }\r\n\r\n    if (filter.timeframe) {\r\n      description += ` [${filter.timeframe}]`;\r\n    }\r\n\r\n    return description;\r\n  }\r\n\r\n  private generateFilterId(): string {\r\n    return `filter_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\trading\\funding-rate-spread-chart\\funding-rate-spread-chart.component.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":137,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":137,"endColumn":59},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .clientWidth on an `any` value.","line":140,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":140,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .clientHeight on an `any` value.","line":140,"column":56,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":140,"endColumn":68},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .style on an `any` value.","line":144,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":144,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .style on an `any` value.","line":145,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":145,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":153,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":153,"endColumn":60},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .clientWidth on an `any` value.","line":153,"column":41,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":153,"endColumn":52},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":162,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":162,"endColumn":28},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":366,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":366,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11309,11312],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11309,11312],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":368,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":368,"endColumn":35}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\r\n  Component,\r\n  Input,\r\n  OnInit,\r\n  OnDestroy,\r\n  AfterViewInit,\r\n  ViewChild,\r\n  ElementRef,\r\n  ChangeDetectionStrategy,\r\n  inject,\r\n  signal,\r\n  effect\r\n} from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\r\nimport { createChart, IChartApi, ISeriesApi, LineData, Time, LineSeries } from 'lightweight-charts';\r\nimport { ThemeService } from '../../../services/theme.service';\r\nimport { AuthService } from '../../../services/auth.service';\r\n\r\ninterface FundingRateDataPoint {\r\n  timestamp: number;      // Timestamp in milliseconds\r\n  spread: number;         // Spread value as decimal (e.g., 0.0015)\r\n}\r\n\r\ninterface FundingRateAPIResponse {\r\n  timestamp: number;\r\n  fundingRate: number;\r\n}\r\n\r\n/**\r\n * Funding Rate Spread Chart Component\r\n *\r\n * Isolated component that displays historical funding rate spread data\r\n * using TradingView Lightweight Charts. This component:\r\n * - Loads its own data independently\r\n * - Uses OnPush change detection for performance\r\n * - Supports theme changes\r\n * - Allows switching between 7-day and 30-day periods\r\n */\r\n@Component({\r\n  selector: 'app-funding-rate-spread-chart',\r\n  standalone: true,\r\n  imports: [CommonModule],\r\n  templateUrl: './funding-rate-spread-chart.component.html',\r\n  styleUrl: './funding-rate-spread-chart.component.scss',\r\n  changeDetection: ChangeDetectionStrategy.OnPush\r\n})\r\nexport class FundingRateSpreadChartComponent implements OnInit, AfterViewInit, OnDestroy {\r\n  @ViewChild('chartContainer', { static: false }) chartContainer!: ElementRef;\r\n\r\n  /**\r\n   * Trading pair symbol (e.g., \"BTCUSDT\")\r\n   */\r\n  @Input({ required: true }) symbol!: string;\r\n\r\n  /**\r\n   * Exchange for best long position\r\n   */\r\n  @Input({ required: true }) bestLongExchange!: string;\r\n\r\n  /**\r\n   * Exchange for best short position\r\n   */\r\n  @Input({ required: true }) bestShortExchange!: string;\r\n\r\n  /**\r\n   * Authentication token (optional - will use AuthService if not provided)\r\n   */\r\n  @Input() authToken?: string;\r\n\r\n  // State signals\r\n  isLoading = signal<boolean>(true);\r\n  error = signal<string | null>(null);\r\n  selectedPeriod = signal<7 | 30>(7);\r\n\r\n  // Chart instance\r\n  private chart: IChartApi | null = null;\r\n  private spreadSeries: ISeriesApi<'Line'> | null = null;\r\n  private resizeObserver: ResizeObserver | null = null;\r\n  private chartInitRetries = 0;\r\n  private readonly MAX_CHART_INIT_RETRIES = 10;\r\n\r\n  // Services\r\n  private http = inject(HttpClient);\r\n  private themeService = inject(ThemeService);\r\n  private authService = inject(AuthService);\r\n\r\n  // Cleanup flag\r\n  private isDestroyed = false;\r\n\r\n  constructor() {\r\n    // Watch for theme changes\r\n    effect(() => {\r\n      const theme = this.themeService.currentTheme();\r\n      if (this.chart && !this.isDestroyed) {\r\n        this.applyThemeToChart(theme);\r\n      }\r\n    });\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    console.log('[FundingRateSpreadChart] Initialized for symbol:', this.symbol);\r\n  }\r\n\r\n  ngAfterViewInit(): void {\r\n    // Initialize chart after view is ready\r\n    setTimeout(() => {\r\n      this.initializeChart();\r\n      this.loadHistoricalData();\r\n    }, 100);\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.isDestroyed = true;\r\n    this.cleanup();\r\n  }\r\n\r\n  /**\r\n   * Switch chart period (7 or 30 days)\r\n   */\r\n  switchPeriod(period: 7 | 30): void {\r\n    if (this.selectedPeriod() === period) return;\r\n\r\n    this.selectedPeriod.set(period);\r\n    this.loadHistoricalData();\r\n  }\r\n\r\n  /**\r\n   * Initialize TradingView Lightweight Chart\r\n   */\r\n  private initializeChart(): void {\r\n    if (!this.chartContainer || this.isDestroyed) {\r\n      console.error('[FundingRateSpreadChart] Chart container not available');\r\n      return;\r\n    }\r\n\r\n    const chartElement = this.chartContainer.nativeElement;\r\n\r\n    // Ensure container has dimensions\r\n    if (chartElement.clientWidth === 0 || chartElement.clientHeight === 0) {\r\n      this.chartInitRetries++;\r\n      if (this.chartInitRetries >= this.MAX_CHART_INIT_RETRIES) {\r\n        console.error('[FundingRateSpreadChart] Failed to initialize chart - no dimensions');\r\n        chartElement.style.width = '100%';\r\n        chartElement.style.height = '300px';\r\n      } else {\r\n        console.warn(`[FundingRateSpreadChart] Retrying chart init... (${this.chartInitRetries}/${this.MAX_CHART_INIT_RETRIES})`);\r\n        setTimeout(() => this.initializeChart(), 200);\r\n        return;\r\n      }\r\n    }\r\n\r\n    const containerWidth = chartElement.clientWidth || 1000;\r\n    console.log('[FundingRateSpreadChart] Initializing chart with width:', containerWidth);\r\n\r\n    // Get current theme colors\r\n    const theme = this.themeService.currentTheme();\r\n    const colors = this.getChartColors(theme);\r\n\r\n    // Create chart\r\n    this.chart = createChart(chartElement, {\r\n      width: containerWidth,\r\n      height: 400,\r\n      layout: {\r\n        background: { color: colors.background },\r\n        textColor: colors.textColor,\r\n      },\r\n      grid: {\r\n        vertLines: { color: colors.gridColor },\r\n        horzLines: { color: colors.gridColor },\r\n      },\r\n      crosshair: {\r\n        mode: 1, // Normal\r\n      },\r\n      rightPriceScale: {\r\n        borderColor: colors.borderColor,\r\n      },\r\n      timeScale: {\r\n        borderColor: colors.borderColor,\r\n        timeVisible: true,\r\n        secondsVisible: false,\r\n      },\r\n      localization: {\r\n        priceFormatter: (price: number) => {\r\n          return price.toFixed(4) + '%';\r\n        },\r\n      },\r\n    });\r\n\r\n    // Add spread line series\r\n    this.spreadSeries = this.chart.addSeries(LineSeries, {\r\n      color: colors.lineColor,\r\n      lineWidth: 2,\r\n      title: 'Funding Spread',\r\n    });\r\n\r\n    // Setup resize observer\r\n    this.setupResizeHandler();\r\n\r\n    console.log('[FundingRateSpreadChart] Chart initialized successfully');\r\n  }\r\n\r\n  /**\r\n   * Get chart colors based on theme\r\n   */\r\n  private getChartColors(theme: 'light' | 'dark') {\r\n    if (theme === 'dark') {\r\n      return {\r\n        background: '#1e1e1e',\r\n        textColor: '#f9fafb',\r\n        gridColor: 'rgba(255, 255, 255, 0.1)',\r\n        borderColor: 'rgba(255, 255, 255, 0.1)',\r\n        lineColor: 'rgb(59, 130, 246)', // blue\r\n      };\r\n    } else {\r\n      return {\r\n        background: '#ffffff',\r\n        textColor: '#1a1a1a',\r\n        gridColor: 'rgba(0, 0, 0, 0.1)',\r\n        borderColor: '#e5e7eb',\r\n        lineColor: 'rgb(59, 130, 246)', // blue\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Apply theme colors to chart\r\n   */\r\n  private applyThemeToChart(theme: 'light' | 'dark'): void {\r\n    if (this.isDestroyed || !this.chart) return;\r\n\r\n    const colors = this.getChartColors(theme);\r\n\r\n    this.chart.applyOptions({\r\n      layout: {\r\n        background: { color: colors.background },\r\n        textColor: colors.textColor,\r\n      },\r\n      grid: {\r\n        vertLines: { color: colors.gridColor },\r\n        horzLines: { color: colors.gridColor },\r\n      },\r\n      rightPriceScale: {\r\n        borderColor: colors.borderColor,\r\n      },\r\n      timeScale: {\r\n        borderColor: colors.borderColor,\r\n      },\r\n    });\r\n\r\n    // Update series color\r\n    if (this.spreadSeries) {\r\n      this.spreadSeries.applyOptions({\r\n        color: colors.lineColor,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Setup ResizeObserver for automatic chart resizing\r\n   */\r\n  private setupResizeHandler(): void {\r\n    if (this.isDestroyed || !this.chart) return;\r\n\r\n    this.resizeObserver = new ResizeObserver(entries => {\r\n      if (this.isDestroyed || !this.chart) return;\r\n\r\n      if (entries.length > 0) {\r\n        const { width } = entries[0].contentRect;\r\n        if (width > 0) {\r\n          this.chart.applyOptions({ width });\r\n        }\r\n      }\r\n    });\r\n\r\n    if (this.chartContainer?.nativeElement) {\r\n      this.resizeObserver.observe(this.chartContainer.nativeElement);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load historical funding rate data from both exchanges and calculate spread\r\n   */\r\n  private async loadHistoricalData(): Promise<void> {\r\n    if (this.isDestroyed) return;\r\n\r\n    try {\r\n      this.isLoading.set(true);\r\n      this.error.set(null);\r\n\r\n      // Use provided token or get from AuthService\r\n      const token = this.authToken || this.authService.authState().token;\r\n      if (!token) {\r\n        console.warn('[FundingRateSpreadChart] No authentication token available, trying without auth');\r\n      }\r\n\r\n      const headers = token ? new HttpHeaders({\r\n        'Authorization': `Bearer ${token}`\r\n      }) : new HttpHeaders();\r\n\r\n      const period = this.selectedPeriod();\r\n\r\n      console.log(`[FundingRateSpreadChart] Loading ${period}d historical data for ${this.symbol}...`);\r\n\r\n      // Fetch data from both exchanges in parallel\r\n      const [longResponse, shortResponse] = await Promise.all([\r\n        this.http.get<{ success: boolean; data: FundingRateAPIResponse[] }>(\r\n          `/api/arbitrage/funding-rates/history?symbol=${this.symbol}&exchange=${this.bestLongExchange}&days=${period}`,\r\n          { headers }\r\n        ).toPromise(),\r\n        this.http.get<{ success: boolean; data: FundingRateAPIResponse[] }>(\r\n          `/api/arbitrage/funding-rates/history?symbol=${this.symbol}&exchange=${this.bestShortExchange}&days=${period}`,\r\n          { headers }\r\n        ).toPromise()\r\n      ]);\r\n\r\n      if (!longResponse?.success || !longResponse?.data || !shortResponse?.success || !shortResponse?.data) {\r\n        throw new Error('Invalid response format from API');\r\n      }\r\n\r\n      // Create maps for quick lookup by timestamp\r\n      const longDataMap = new Map<number, number>();\r\n      longResponse.data.forEach(point => {\r\n        longDataMap.set(point.timestamp, point.fundingRate);\r\n      });\r\n\r\n      const shortDataMap = new Map<number, number>();\r\n      shortResponse.data.forEach(point => {\r\n        shortDataMap.set(point.timestamp, point.fundingRate);\r\n      });\r\n\r\n      // Calculate spread for matching timestamps\r\n      const spreadData: FundingRateDataPoint[] = [];\r\n      longDataMap.forEach((longRate, timestamp) => {\r\n        const shortRate = shortDataMap.get(timestamp);\r\n        if (shortRate !== undefined) {\r\n          // Spread = Long funding rate - Short funding rate\r\n          const spread = longRate - shortRate;\r\n          spreadData.push({ timestamp, spread });\r\n        }\r\n      });\r\n\r\n      if (spreadData.length > 0 && !this.isDestroyed && this.spreadSeries) {\r\n        // Sort by timestamp\r\n        spreadData.sort((a, b) => a.timestamp - b.timestamp);\r\n\r\n        // Convert to LineData format with percentage values\r\n        const chartData: LineData[] = spreadData.map(point => ({\r\n          time: Math.floor(point.timestamp / 1000) as Time, // Convert ms to seconds\r\n          value: point.spread * 100 // Convert decimal to percentage\r\n        }));\r\n\r\n        this.spreadSeries.setData(chartData);\r\n\r\n        // Fit chart to show all data\r\n        if (!this.isDestroyed && this.chart) {\r\n          this.chart.timeScale().fitContent();\r\n        }\r\n\r\n        console.log(`[FundingRateSpreadChart] Loaded ${chartData.length} spread data points`);\r\n      } else {\r\n        console.warn('[FundingRateSpreadChart] No matching historical data available');\r\n        this.error.set('No matching data available for the selected period');\r\n      }\r\n\r\n    } catch (error: any) {\r\n      console.error('[FundingRateSpreadChart] Failed to load data:', error);\r\n      this.error.set(error.message || 'Failed to load historical data');\r\n    } finally {\r\n      if (!this.isDestroyed) {\r\n        this.isLoading.set(false);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Cleanup chart and observers\r\n   */\r\n  private cleanup(): void {\r\n    if (this.resizeObserver) {\r\n      this.resizeObserver.disconnect();\r\n      this.resizeObserver = null;\r\n    }\r\n\r\n    if (this.chart) {\r\n      this.chart.remove();\r\n      this.chart = null;\r\n    }\r\n\r\n    this.spreadSeries = null;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\trading\\funding-rates\\funding-rates.component.html","messages":[{"ruleId":"@angular-eslint/template/click-events-have-key-events","severity":2,"message":"click must be accompanied by either keyup, keydown or keypress event for accessibility.","line":1476,"column":5,"nodeType":null,"messageId":"clickEventsHaveKeyEvents","endLine":1734,"endColumn":11},{"ruleId":"@angular-eslint/template/interactive-supports-focus","severity":2,"message":"Elements with interaction handlers must be focusable.","line":1476,"column":5,"nodeType":null,"messageId":"interactiveSupportsFocus","endLine":1734,"endColumn":11},{"ruleId":"@angular-eslint/template/click-events-have-key-events","severity":2,"message":"click must be accompanied by either keyup, keydown or keypress event for accessibility.","line":1477,"column":7,"nodeType":null,"messageId":"clickEventsHaveKeyEvents","endLine":1733,"endColumn":13},{"ruleId":"@angular-eslint/template/interactive-supports-focus","severity":2,"message":"Elements with interaction handlers must be focusable.","line":1477,"column":7,"nodeType":null,"messageId":"interactiveSupportsFocus","endLine":1733,"endColumn":13},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":1543,"column":15,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":1543,"endColumn":57},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":1558,"column":15,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":1558,"endColumn":62},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":1579,"column":17,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":1579,"endColumn":66},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":1594,"column":17,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":1594,"endColumn":64},{"ruleId":"@angular-eslint/template/click-events-have-key-events","severity":2,"message":"click must be accompanied by either keyup, keydown or keypress event for accessibility.","line":1739,"column":5,"nodeType":null,"messageId":"clickEventsHaveKeyEvents","endLine":1914,"endColumn":11},{"ruleId":"@angular-eslint/template/interactive-supports-focus","severity":2,"message":"Elements with interaction handlers must be focusable.","line":1739,"column":5,"nodeType":null,"messageId":"interactiveSupportsFocus","endLine":1914,"endColumn":11},{"ruleId":"@angular-eslint/template/click-events-have-key-events","severity":2,"message":"click must be accompanied by either keyup, keydown or keypress event for accessibility.","line":1740,"column":7,"nodeType":null,"messageId":"clickEventsHaveKeyEvents","endLine":1913,"endColumn":13},{"ruleId":"@angular-eslint/template/interactive-supports-focus","severity":2,"message":"Elements with interaction handlers must be focusable.","line":1740,"column":7,"nodeType":null,"messageId":"interactiveSupportsFocus","endLine":1913,"endColumn":13},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":1796,"column":19,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":1796,"endColumn":102},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":1811,"column":19,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":1811,"endColumn":117},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":1859,"column":19,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":1859,"endColumn":102},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":1874,"column":19,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":1874,"endColumn":117},{"ruleId":"@angular-eslint/template/click-events-have-key-events","severity":2,"message":"click must be accompanied by either keyup, keydown or keypress event for accessibility.","line":1933,"column":5,"nodeType":null,"messageId":"clickEventsHaveKeyEvents","endLine":2119,"endColumn":11},{"ruleId":"@angular-eslint/template/interactive-supports-focus","severity":2,"message":"Elements with interaction handlers must be focusable.","line":1933,"column":5,"nodeType":null,"messageId":"interactiveSupportsFocus","endLine":2119,"endColumn":11},{"ruleId":"@angular-eslint/template/click-events-have-key-events","severity":2,"message":"click must be accompanied by either keyup, keydown or keypress event for accessibility.","line":1934,"column":7,"nodeType":null,"messageId":"clickEventsHaveKeyEvents","endLine":2118,"endColumn":13},{"ruleId":"@angular-eslint/template/interactive-supports-focus","severity":2,"message":"Elements with interaction handlers must be focusable.","line":1934,"column":7,"nodeType":null,"messageId":"interactiveSupportsFocus","endLine":2118,"endColumn":13},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":1966,"column":15,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":1971,"endColumn":23},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":1985,"column":15,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":1990,"endColumn":23},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":2029,"column":17,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":2035,"endColumn":25},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":2059,"column":15,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":2065,"endColumn":23},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":2080,"column":15,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":2085,"endColumn":23}],"suppressedMessages":[],"errorCount":25,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<div class=\"funding-rates-container\">\r\n  <!-- Header -->\r\n  <div class=\"funding-rates-header\">\r\n    <h2 class=\"funding-rates-title\">{{ translate('funding.title') }}</h2>\r\n    <div class=\"funding-rates-actions\">\r\n      <!-- Settings -->\r\n      <ui-button\r\n        variant=\"ghost\"\r\n        size=\"small\"\r\n        (clicked)=\"openSettingsDialog()\"\r\n        aria-label=\"Subscription settings\">\r\n        <span>‚öôÔ∏è {{ translate('fundingRates.filters.settings') }}</span>\r\n      </ui-button>\r\n\r\n      <!-- Trade History Report (General) -->\r\n      <ui-button\r\n        variant=\"ghost\"\r\n        size=\"small\"\r\n        (clicked)=\"openTradeHistoryDialog()\"\r\n        aria-label=\"View all trade history\">\r\n        <span>üìä {{ translate('fundingRates.actions.viewAllHistory') }}</span>\r\n      </ui-button>\r\n\r\n      <!-- Clear Sort (only show if multi-sort active) -->\r\n      @if (sortColumns().length > 1) {\r\n        <ui-button\r\n          variant=\"ghost\"\r\n          size=\"small\"\r\n          (clicked)=\"clearSort()\"\r\n          aria-label=\"Clear sort\">\r\n          <span>{{ translate('fundingRates.actions.clearSort') }}</span>\r\n        </ui-button>\r\n      }\r\n    </div>\r\n  </div>\r\n\r\n  <!-- Arbitrage Opportunities Section -->\r\n  <ui-card variant=\"outlined\" class=\"arbitrage-card\">\r\n    <ui-card-header>\r\n      <div class=\"card-header-content\">\r\n        <ui-card-title>{{ translate('arbitrage.title') }}</ui-card-title>\r\n\r\n        <!-- Mode Toggle -->\r\n        <div class=\"mode-toggle-wrapper\">\r\n          <div class=\"mode-toggle\">\r\n            <button\r\n              type=\"button\"\r\n              class=\"mode-toggle-option\"\r\n              [class.active]=\"arbitrageMode() === 'HEDGED'\"\r\n              (click)=\"setArbitrageMode('HEDGED')\">\r\n              <span class=\"mode-toggle-label\">{{ translate('arbitrage.mode.hedged') }}</span>\r\n            </button>\r\n            <button\r\n              type=\"button\"\r\n              class=\"mode-toggle-option\"\r\n              [class.active]=\"arbitrageMode() === 'NON_HEDGED'\"\r\n              (click)=\"setArbitrageMode('NON_HEDGED')\">\r\n              <span class=\"mode-toggle-label\">{{ translate('arbitrage.mode.nonHedged') }}</span>\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"header-actions\">\r\n          <!-- Symbol Search Input -->\r\n          <div class=\"filter-control\">\r\n            <div class=\"filter-input-wrapper\">\r\n              <svg class=\"filter-icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                <path d=\"M21 21L15 15M17 10C17 13.866 13.866 17 10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n              </svg>\r\n              <input\r\n                type=\"text\"\r\n                class=\"filter-input\"\r\n                [(ngModel)]=\"arbitrageSearchQuery\"\r\n                placeholder=\"Search symbol (e.g., BTC-USDT)\"\r\n                aria-label=\"Filter by symbol\"\r\n              />\r\n              @if (arbitrageSearchQuery()) {\r\n                <button\r\n                  class=\"filter-clear-btn\"\r\n                  (click)=\"arbitrageSearchQuery.set('')\"\r\n                  aria-label=\"Clear symbol filter\"\r\n                  type=\"button\">\r\n                  <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                    <path d=\"M18 6L6 18M6 6L18 18\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                  </svg>\r\n                </button>\r\n              }\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Spread Filter Input -->\r\n          <div class=\"filter-control\">\r\n            <div class=\"filter-input-wrapper\">\r\n              <svg class=\"filter-icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                <path d=\"M3 6L5 8L9 4M3 12H9M15 12H21M3 18H13M17 18H21\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n              </svg>\r\n              <input\r\n                type=\"number\"\r\n                class=\"filter-input\"\r\n                [(ngModel)]=\"minSpreadThreshold\"\r\n                step=\"0.001\"\r\n                min=\"0\"\r\n                placeholder=\"Min spread % (e.g., 0.01)\"\r\n                aria-label=\"Minimum spread percentage\"\r\n              />\r\n              @if (minSpreadThreshold() !== null && minSpreadThreshold()! > 0) {\r\n                <button\r\n                  class=\"filter-clear-btn\"\r\n                  (click)=\"minSpreadThreshold.set(null)\"\r\n                  aria-label=\"Clear spread filter\"\r\n                  type=\"button\">\r\n                  <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                    <path d=\"M18 6L6 18M6 6L18 18\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                  </svg>\r\n                </button>\r\n              }\r\n              @if (minSpreadThreshold() !== null && minSpreadThreshold()! > 0) {\r\n                <span class=\"filter-badge\">{{ minSpreadThreshold() }}%+</span>\r\n              }\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Next Funding Filter Input -->\r\n          <div class=\"filter-control\">\r\n            <div class=\"filter-input-wrapper\">\r\n              <svg class=\"filter-icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                <path d=\"M12 8V12L15 15M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n              </svg>\r\n              <input\r\n                type=\"number\"\r\n                class=\"filter-input\"\r\n                [(ngModel)]=\"maxNextFundingHoursArbitrage\"\r\n                step=\"1\"\r\n                min=\"0\"\r\n                placeholder=\"Next funding (hours, e.g., 8)\"\r\n                aria-label=\"Maximum hours until next funding\"\r\n              />\r\n              @if (maxNextFundingHoursArbitrage() !== null && maxNextFundingHoursArbitrage()! > 0) {\r\n                <button\r\n                  class=\"filter-clear-btn\"\r\n                  (click)=\"maxNextFundingHoursArbitrage.set(null)\"\r\n                  aria-label=\"Clear next funding filter\"\r\n                  type=\"button\">\r\n                  <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                    <path d=\"M18 6L6 18M6 6L18 18\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                  </svg>\r\n                </button>\r\n              }\r\n              @if (maxNextFundingHoursArbitrage() !== null && maxNextFundingHoursArbitrage()! > 0) {\r\n                <span class=\"filter-badge\">‚â§{{ maxNextFundingHoursArbitrage() }}h</span>\r\n              }\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Market Cap Filter (HEDGED mode only) -->\r\n          @if (arbitrageMode() === 'HEDGED') {\r\n            <div class=\"filter-control\">\r\n              <ui-dropdown\r\n                [options]=\"marketCapOptions\"\r\n                [(ngModel)]=\"minMarketCapFilterValue\"\r\n                (ngModelChange)=\"onMarketCapFilterChange($event)\"\r\n                [placeholder]=\"translate('fundingRates.filters.marketCapFilter')\"\r\n                size=\"small\"\r\n                [searchable]=\"false\"\r\n                width=\"medium\"\r\n                class=\"market-cap-filter\">\r\n              </ui-dropdown>\r\n            </div>\r\n          }\r\n\r\n          <!-- Show Only Subscribed Checkbox -->\r\n          <div class=\"filter-control\">\r\n            <label class=\"checkbox-filter\">\r\n              <input\r\n                type=\"checkbox\"\r\n                [ngModel]=\"showOnlySubscribedArbitrage()\"\r\n                (ngModelChange)=\"showOnlySubscribedArbitrage.set($event)\"\r\n                class=\"checkbox-input\"\r\n                aria-label=\"Show only subscribed pairs\"\r\n              />\r\n              <span class=\"checkbox-label\">Only Subscribed</span>\r\n            </label>\r\n          </div>\r\n\r\n          <!-- Action Buttons -->\r\n          <div class=\"header-actions-group\">\r\n            <!-- Real-time Streaming Toggle -->\r\n            <label class=\"streaming-toggle-wrapper\">\r\n              <input\r\n                type=\"checkbox\"\r\n                [ngModel]=\"enableRealtimeStreaming()\"\r\n                (ngModelChange)=\"enableRealtimeStreaming.set($event)\"\r\n                class=\"streaming-toggle-input\"\r\n                aria-label=\"Enable real-time streaming\"\r\n              />\r\n              <span class=\"streaming-toggle-label\">Real-time</span>\r\n            </label>\r\n\r\n            <!-- Real-time Streaming Indicator -->\r\n            <div class=\"streaming-indicator\" [class.disconnected]=\"!isStreamConnected()\">\r\n              <span class=\"streaming-dot\"></span>\r\n              <span>{{ isStreamConnected() ? 'Live' : 'Offline' }}</span>\r\n            </div>\r\n\r\n            @if (arbitrageSearchQuery() || (minSpreadThreshold() !== null && minSpreadThreshold()! > 0) || (maxNextFundingHoursArbitrage() !== null && maxNextFundingHoursArbitrage()! > 0) || showOnlySubscribedArbitrage()) {\r\n              <ui-button\r\n                variant=\"ghost\"\r\n                size=\"small\"\r\n                (clicked)=\"clearArbitrageFilters()\"\r\n                aria-label=\"Clear all filters\">\r\n                <span class=\"button-content\">\r\n                  <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                    <path d=\"M18 6L6 18M6 6L18 18\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                  </svg>\r\n                  Clear\r\n                </span>\r\n              </ui-button>\r\n            }\r\n\r\n            <ui-button\r\n              variant=\"ghost\"\r\n              size=\"small\"\r\n              (clicked)=\"cancelAllSubscriptions()\"\r\n              aria-label=\"Cancel all subscriptions\">\r\n              <span class=\"button-content\">\r\n                <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                  <path d=\"M12 2L2 7L12 12L22 7L12 2Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                  <path d=\"M2 17L12 22L22 17\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                  <path d=\"M2 12L12 17L22 12\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                  <path d=\"M4 9L20 9\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\"/>\r\n                </svg>\r\n                Cancel All ({{ subscriptions().size }})\r\n              </span>\r\n            </ui-button>\r\n\r\n            <ui-button\r\n              variant=\"ghost\"\r\n              size=\"small\"\r\n              (clicked)=\"loadArbitrageOpportunities()\"\r\n              [loading]=\"isLoadingArbitrage()\"\r\n              aria-label=\"Refresh arbitrage opportunities\">\r\n              <span class=\"button-content\">\r\n                <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                  <path d=\"M21.5 2V8M21.5 8H15.5M21.5 8L18.5 5C17.3 3.8 15.7 3 14 3C10.1 3 7 6.1 7 10M2.5 22V16M2.5 16H8.5M2.5 16L5.5 19C6.7 20.2 8.3 21 10 21C13.9 21 17 17.9 17 14\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                </svg>\r\n                {{ translate('funding.refresh') }}\r\n              </span>\r\n            </ui-button>\r\n\r\n            <button\r\n              class=\"toggle-section-btn\"\r\n              (click)=\"toggleArbitrageSection()\"\r\n              [attr.aria-expanded]=\"!showArbitrageSection()\"\r\n              [attr.aria-label]=\"showArbitrageSection() ? 'Collapse section' : 'Expand section'\"\r\n              type=\"button\">\r\n              <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" [class.rotate-180]=\"!showArbitrageSection()\">\r\n                <path d=\"M18 15L12 9L6 15\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n              </svg>\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </ui-card-header>\r\n    <ui-card-content>\r\n      @if (!showArbitrageSection()) {\r\n        <div class=\"collapsed-summary\">\r\n          <span>{{ translate('arbitrage.collapsed') }} ({{ filteredArbitrageOpportunities().length }} {{ translate('fundingRates.info.pairs') }})</span>\r\n        </div>\r\n      } @else {\r\n        @if (isLoadingArbitrage()) {\r\n          <div class=\"loading-state\">\r\n            <span>{{ translate('arbitrage.loading') }}</span>\r\n          </div>\r\n        } @else if (arbitrageError()) {\r\n          <div class=\"error-state\">\r\n            <p>{{ arbitrageError() }}</p>\r\n            <ui-button variant=\"primary\" size=\"small\" (clicked)=\"loadArbitrageOpportunities()\">\r\n              {{ translate('funding.retry') }}\r\n            </ui-button>\r\n          </div>\r\n        } @else if (arbitrageOpportunities().length === 0) {\r\n          <div class=\"empty-state\">\r\n            <p>{{ translate('arbitrage.empty') }}</p>\r\n            <p class=\"help-text\">{{ translate('arbitrage.emptyHelp') }}</p>\r\n          </div>\r\n        } @else if (filteredArbitrageOpportunities().length === 0) {\r\n          <div class=\"empty-state\">\r\n            <p>{{ translate('arbitrage.noMatches') }}</p>\r\n            <ui-button variant=\"secondary\" size=\"small\" (clicked)=\"clearArbitrageFilters()\">\r\n              {{ translate('fundingRates.filters.clearFilters') }}\r\n            </ui-button>\r\n          </div>\r\n        } @else {\r\n        <!-- HEDGED MODE TABLE -->\r\n        @if (arbitrageMode() === 'HEDGED') {\r\n          <div class=\"arbitrage-table-wrapper\">\r\n            <table class=\"arbitrage-table hedged-table\" role=\"table\" aria-label=\"Hedged arbitrage opportunities\">\r\n              <thead>\r\n                <tr>\r\n                  <!-- Symbol -->\r\n                  <th class=\"sortable-header\" (click)=\"sortArbitrageBy('symbol', $event)\">\r\n                    <div class=\"header-content\">\r\n                      <span>{{ translate('arbitrage.table.symbol') }}</span>\r\n                      @if (getArbitrageSortInfo('symbol'); as sortInfo) {\r\n                        <span class=\"sort-indicator\" [class.asc]=\"sortInfo.direction === 'asc'\" [class.desc]=\"sortInfo.direction === 'desc'\">\r\n                          @if (sortInfo.index >= 0) {\r\n                            <span class=\"sort-number\">{{ sortInfo.index + 1 }}</span>\r\n                          }\r\n                          ‚ñº\r\n                        </span>\r\n                      }\r\n                    </div>\r\n                  </th>\r\n\r\n                  <!-- Primary Exchange -->\r\n                  <th class=\"text-center sortable-header\" (click)=\"sortArbitrageBy('primaryExchange', $event)\">\r\n                    <div class=\"header-content\">\r\n                      <span>{{ translate('arbitrage.table.primaryExchange') || 'Primary Exchange' }}</span>\r\n                      @if (getArbitrageSortInfo('primaryExchange'); as sortInfo) {\r\n                        <span class=\"sort-indicator\" [class.asc]=\"sortInfo.direction === 'asc'\" [class.desc]=\"sortInfo.direction === 'desc'\">\r\n                          @if (sortInfo.index >= 0) {\r\n                            <span class=\"sort-number\">{{ sortInfo.index + 1 }}</span>\r\n                          }\r\n                          ‚ñº\r\n                        </span>\r\n                      }\r\n                    </div>\r\n                  </th>\r\n\r\n                  <!-- Hedge Exchange -->\r\n                  <th class=\"text-center sortable-header\" (click)=\"sortArbitrageBy('hedgeExchange', $event)\">\r\n                    <div class=\"header-content\">\r\n                      <span>{{ translate('arbitrage.table.hedgeExchange') || 'Hedge Exchange' }}</span>\r\n                      @if (getArbitrageSortInfo('hedgeExchange'); as sortInfo) {\r\n                        <span class=\"sort-indicator\" [class.asc]=\"sortInfo.direction === 'asc'\" [class.desc]=\"sortInfo.direction === 'desc'\">\r\n                          @if (sortInfo.index >= 0) {\r\n                            <span class=\"sort-number\">{{ sortInfo.index + 1 }}</span>\r\n                          }\r\n                          ‚ñº\r\n                        </span>\r\n                      }\r\n                    </div>\r\n                  </th>\r\n\r\n                  <!-- Funding Spread -->\r\n                  <th class=\"text-center sortable-header\" (click)=\"sortArbitrageBy('fundingSpread', $event)\">\r\n                    <div class=\"header-content\">\r\n                      <span>{{ translate('arbitrage.table.fundingSpread') || 'Funding Spread' }}</span>\r\n                      @if (getArbitrageSortInfo('fundingSpread'); as sortInfo) {\r\n                        <span class=\"sort-indicator\" [class.asc]=\"sortInfo.direction === 'asc'\" [class.desc]=\"sortInfo.direction === 'desc'\">\r\n                          @if (sortInfo.index >= 0) {\r\n                            <span class=\"sort-number\">{{ sortInfo.index + 1 }}</span>\r\n                          }\r\n                          ‚ñº\r\n                        </span>\r\n                      }\r\n                    </div>\r\n                  </th>\r\n\r\n                  <!-- Action -->\r\n                  <th class=\"text-left\">{{ translate('arbitrage.table.opportunity') }}</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                @for (opportunity of sortedArbitrageOpportunities(); track opportunity.symbol) {\r\n                  <tr [class.opportunity-row]=\"opportunity.arbitrageOpportunity\" [class.has-subscription]=\"hasActiveSubscriptionsOrStrategies(opportunity.symbol)\">\r\n                    <!-- Symbol -->\r\n                    <td class=\"symbol-cell\">\r\n                      <div class=\"symbol-wrapper\">\r\n                        @if (hasActiveSubscriptionsOrStrategies(opportunity.symbol)) {\r\n                          <button\r\n                            class=\"expand-icon\"\r\n                            (click)=\"toggleExpandRow(opportunity.symbol)\"\r\n                            [class.expanded]=\"isRowExpanded(opportunity.symbol)\"\r\n                            title=\"{{ isRowExpanded(opportunity.symbol) ? translate('fundingRates.actions.collapse') : translate('fundingRates.actions.expand') }}\">\r\n                            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                              <path d=\"M6 9L12 15L18 9\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                            </svg>\r\n                          </button>\r\n                        }\r\n                        <span class=\"symbol-text\">{{ opportunity.symbol }}</span>\r\n                        <!-- Display market cap if available -->\r\n                        @if (opportunity.marketCap && opportunity.marketCap > 0) {\r\n                          <span class=\"symbol-price text-xs\">{{ formatMarketCap(opportunity.marketCap) }}</span>\r\n                        } @else {\r\n                          <!-- Fallback: Display average price between Primary and Hedge exchanges -->\r\n                          @for (primaryEx of opportunity.exchanges; track primaryEx.exchange + primaryEx.credentialId) {\r\n                            @if (primaryEx.exchange === opportunity.bestShort.exchange && primaryEx.credentialId === opportunity.bestShort.credentialId) {\r\n                              @for (hedgeEx of opportunity.exchanges; track hedgeEx.exchange + hedgeEx.credentialId) {\r\n                                @if (hedgeEx.exchange === opportunity.bestLong.exchange && hedgeEx.credentialId === opportunity.bestLong.credentialId) {\r\n                                  @if (primaryEx.lastPrice && hedgeEx.lastPrice) {\r\n                                    @if (getRealtimePrice(primaryEx.exchange, opportunity.symbol); as primaryRealtime) {\r\n                                      @if (getRealtimePrice(hedgeEx.exchange, opportunity.symbol); as hedgeRealtime) {\r\n                                        <span class=\"symbol-price text-xs realtime-price\">\r\n                                          ${{ ((primaryRealtime.price + hedgeRealtime.price) / 2).toFixed(3) }}\r\n                                        </span>\r\n                                      } @else {\r\n                                        <span class=\"symbol-price text-xs\">\r\n                                          ${{ ((primaryRealtime.price + parseFloat(hedgeEx.lastPrice)) / 2).toFixed(3) }}\r\n                                        </span>\r\n                                      }\r\n                                    } @else {\r\n                                      @if (getRealtimePrice(hedgeEx.exchange, opportunity.symbol); as hedgeRealtime) {\r\n                                        <span class=\"symbol-price text-xs\">\r\n                                          ${{ ((parseFloat(primaryEx.lastPrice) + hedgeRealtime.price) / 2).toFixed(3) }}\r\n                                        </span>\r\n                                      } @else {\r\n                                        <span class=\"symbol-price text-xs\">\r\n                                          ${{ ((parseFloat(primaryEx.lastPrice) + parseFloat(hedgeEx.lastPrice)) / 2).toFixed(3) }}\r\n                                        </span>\r\n                                      }\r\n                                    }\r\n                                  }\r\n                                }\r\n                              }\r\n                            }\r\n                          }\r\n                        }\r\n                      </div>\r\n                    </td>\r\n\r\n                    <!-- Primary Exchange (Best Short - HIGH price) -->\r\n                    <td class=\"text-center exchange-cell\">\r\n                      @for (exchange of opportunity.exchanges; track exchange.exchange + exchange.credentialId) {\r\n                        @if (exchange.exchange === opportunity.bestShort.exchange && exchange.credentialId === opportunity.bestShort.credentialId) {\r\n                          <div class=\"exchange-info-compact\">\r\n                            <button\r\n                              class=\"exchange-badge exchange-badge-button\"\r\n                              [class]=\"'badge-' + exchange.exchange.toLowerCase()\"\r\n                              (click)=\"openTradingPairForExchange(opportunity.symbol, exchange.exchange, exchange.environment, exchange.originalSymbol)\"\r\n                              [title]=\"'Open ' + opportunity.symbol + ' on ' + exchange.exchange\">\r\n                              {{ exchange.exchange }}\r\n                            </button>\r\n                            @if (exchange.lastPrice && parseFloat(exchange.lastPrice) > 0) {\r\n                              @if (getRealtimePrice(exchange.exchange, opportunity.symbol); as realtimePrice) {\r\n                                <div class=\"exchange-price text-xs realtime-price\"\r\n                                     [class.price-up]=\"realtimePrice.change === 'up'\"\r\n                                     [class.price-down]=\"realtimePrice.change === 'down'\"\r\n                                     [class.price-neutral]=\"realtimePrice.change === 'neutral'\">\r\n                                  ${{ realtimePrice.price.toFixed(3) }}\r\n                                  @if (realtimePrice.change === 'up') {\r\n                                    <span class=\"price-indicator up\">‚ñ≤</span>\r\n                                  } @else if (realtimePrice.change === 'down') {\r\n                                    <span class=\"price-indicator down\">‚ñº</span>\r\n                                  }\r\n                                </div>\r\n                              } @else {\r\n                                <div class=\"exchange-price text-xs\">\r\n                                  ${{ parseFloat(exchange.lastPrice).toFixed(3) }}\r\n                                </div>\r\n                              }\r\n                            }\r\n                            @if (exchange.fundingRate) {\r\n                              <div class=\"exchange-funding text-xs\"\r\n                                   [class.positive]=\"parseFloat(exchange.fundingRate) > 0\"\r\n                                   [class.negative]=\"parseFloat(exchange.fundingRate) < 0\">\r\n                                {{ (parseFloat(exchange.fundingRate) * 100).toFixed(4) }}%\r\n                              </div>\r\n                            }\r\n                            @if (exchange.nextFundingTime) {\r\n                              <div class=\"exchange-periodicity text-xs\">\r\n                                {{ calculateFundingPeriodicity(exchange.nextFundingTime, exchange.fundingInterval) }}\r\n                              </div>\r\n                            }\r\n                          </div>\r\n                        }\r\n                      }\r\n                    </td>\r\n\r\n                    <!-- Hedge Exchange (Best Long - LOW price) -->\r\n                    <td class=\"text-center exchange-cell\">\r\n                      @for (exchange of opportunity.exchanges; track exchange.exchange + exchange.credentialId) {\r\n                        @if (exchange.exchange === opportunity.bestLong.exchange && exchange.credentialId === opportunity.bestLong.credentialId) {\r\n                          <div class=\"exchange-info-compact\">\r\n                            <button\r\n                              class=\"exchange-badge exchange-badge-button\"\r\n                              [class]=\"'badge-' + exchange.exchange.toLowerCase()\"\r\n                              (click)=\"openTradingPairForExchange(opportunity.symbol, exchange.exchange, exchange.environment, exchange.originalSymbol)\"\r\n                              [title]=\"'Open ' + opportunity.symbol + ' on ' + exchange.exchange\">\r\n                              {{ exchange.exchange }}\r\n                            </button>\r\n                            @if (exchange.lastPrice && parseFloat(exchange.lastPrice) > 0) {\r\n                              @if (getRealtimePrice(exchange.exchange, opportunity.symbol); as realtimePrice) {\r\n                                <div class=\"exchange-price text-xs realtime-price\"\r\n                                     [class.price-up]=\"realtimePrice.change === 'up'\"\r\n                                     [class.price-down]=\"realtimePrice.change === 'down'\"\r\n                                     [class.price-neutral]=\"realtimePrice.change === 'neutral'\">\r\n                                  ${{ realtimePrice.price.toFixed(3) }}\r\n                                  @if (realtimePrice.change === 'up') {\r\n                                    <span class=\"price-indicator up\">‚ñ≤</span>\r\n                                  } @else if (realtimePrice.change === 'down') {\r\n                                    <span class=\"price-indicator down\">‚ñº</span>\r\n                                  }\r\n                                </div>\r\n                              } @else {\r\n                                <div class=\"exchange-price text-xs\">\r\n                                  ${{ parseFloat(exchange.lastPrice).toFixed(3) }}\r\n                                </div>\r\n                              }\r\n                            }\r\n                            @if (exchange.fundingRate) {\r\n                              <div class=\"exchange-funding text-xs\"\r\n                                   [class.positive]=\"parseFloat(exchange.fundingRate) > 0\"\r\n                                   [class.negative]=\"parseFloat(exchange.fundingRate) < 0\">\r\n                                {{ (parseFloat(exchange.fundingRate) * 100).toFixed(4) }}%\r\n                              </div>\r\n                            }\r\n                            @if (exchange.nextFundingTime) {\r\n                              <div class=\"exchange-periodicity text-xs\">\r\n                                {{ calculateFundingPeriodicity(exchange.nextFundingTime, exchange.fundingInterval) }}\r\n                              </div>\r\n                            }\r\n                          </div>\r\n                        }\r\n                      }\r\n                    </td>\r\n\r\n                    <!-- Funding Spread -->\r\n                    <td class=\"text-center funding-spread-cell\">\r\n                      <div class=\"funding-spread-value\"\r\n                           [class.high]=\"opportunity.fundingSpread && opportunity.fundingSpread >= 0.0005\"\r\n                           [class.medium]=\"opportunity.fundingSpread && opportunity.fundingSpread >= 0.0002 && opportunity.fundingSpread < 0.0005\"\r\n                           [class.low]=\"opportunity.fundingSpread && opportunity.fundingSpread < 0.0002\">\r\n                        {{ opportunity.fundingSpreadPercent || '0.0000' }}%\r\n                      </div>\r\n                    </td>\r\n\r\n                    <!-- Action Button -->\r\n                    <td class=\"text-left action-cell\">\r\n                      <div class=\"action-buttons-group\">\r\n                        <ui-button\r\n                          variant=\"primary\"\r\n                          size=\"small\"\r\n                          (clicked)=\"startHedgedArbitrage(opportunity)\"\r\n                          className=\"action-btn start-hedged-btn\">\r\n                          <span>{{ translate('fundingRates.actions.start') || 'Start' }}</span>\r\n                        </ui-button>\r\n                        <button\r\n                          class=\"chart-icon-btn\"\r\n                          (click)=\"openArbitrageChart(opportunity)\"\r\n                          [title]=\"translate('fundingRates.actions.viewChart') || 'View Chart'\">\r\n                          üìä\r\n                        </button>\r\n                      </div>\r\n                    </td>\r\n                  </tr>\r\n\r\n                  <!-- Expanded row for subscriptions/strategies -->\r\n                  @if (isRowExpanded(opportunity.symbol)) {\r\n                    <tr class=\"expanded-row\">\r\n                      <td colspan=\"5\" class=\"expanded-content\">\r\n                        <div class=\"expanded-content-wrapper\">\r\n                          @if (getSubscriptionsForSymbol(opportunity.symbol); as subscriptions) {\r\n                            <!-- Regular Funding Subscriptions -->\r\n                            @if (subscriptions.regular) {\r\n                              <div class=\"subscription-section\">\r\n                                <h4 class=\"section-title\">üí∞ {{ translate('fundingRates.sections.regularSubscription') || 'Regular Funding Subscription' }}</h4>\r\n                                <div class=\"subscription-card\">\r\n                                  <div class=\"subscription-details\">\r\n                                    <div class=\"detail-item\">\r\n                                      <span class=\"detail-label\">{{ translate('fundingRates.labels.status') }}:</span>\r\n                                      <span class=\"detail-value status-badge\" [class]=\"'status-' + subscriptions.regular.status.toLowerCase()\">\r\n                                        {{ subscriptions.regular.status }}\r\n                                      </span>\r\n                                    </div>\r\n                                    <div class=\"detail-item\">\r\n                                      <span class=\"detail-label\">{{ translate('fundingRates.labels.side') }}:</span>\r\n                                      <span class=\"detail-value\">{{ subscriptions.regular.positionType }}</span>\r\n                                    </div>\r\n                                    @if (subscriptions.regular.primaryExchange) {\r\n                                      <div class=\"detail-item\">\r\n                                        <span class=\"detail-label\">{{ translate('fundingRates.labels.exchange') }}:</span>\r\n                                        <span class=\"detail-value\">{{ subscriptions.regular.primaryExchange }}</span>\r\n                                      </div>\r\n                                    }\r\n                                    <div class=\"detail-item\">\r\n                                      <span class=\"detail-label\">{{ translate('fundingRates.labels.quantity') }}:</span>\r\n                                      <span class=\"detail-value\">{{ subscriptions.regular.quantity }}</span>\r\n                                    </div>\r\n                                    @if (subscriptions.regular.leverage) {\r\n                                      <div class=\"detail-item\">\r\n                                        <span class=\"detail-label\">{{ translate('fundingRates.labels.leverage') }}:</span>\r\n                                        <span class=\"detail-value\">{{ subscriptions.regular.leverage }}x</span>\r\n                                      </div>\r\n                                    }\r\n                                    @if (subscriptions.regular.margin) {\r\n                                      <div class=\"detail-item\">\r\n                                        <span class=\"detail-label\">{{ translate('fundingRates.labels.margin') }}:</span>\r\n                                        <span class=\"detail-value\">{{ subscriptions.regular.margin }} USDT</span>\r\n                                      </div>\r\n                                    }\r\n                                    <div class=\"detail-item\">\r\n                                      <span class=\"detail-label\">{{ translate('fundingRates.labels.fundingRate') }}:</span>\r\n                                      <span class=\"detail-value\" [ngClass]=\"getFundingRateClass(subscriptions.regular.fundingRate.toString())\">\r\n                                        {{ formatFundingRate(subscriptions.regular.fundingRate.toString()) }}\r\n                                      </span>\r\n                                    </div>\r\n                                    @if (subscriptions.regular.nextFundingTime) {\r\n                                      <div class=\"detail-item\">\r\n                                        <span class=\"detail-label\">{{ translate('fundingRates.labels.nextFunding') }}:</span>\r\n                                        <span class=\"detail-value\">{{ formatNextFundingTime(subscriptions.regular.nextFundingTime) }}</span>\r\n                                      </div>\r\n                                    }\r\n                                    @if (subscriptions.regular.countdown && subscriptions.regular.countdown > 0) {\r\n                                      <div class=\"detail-item\">\r\n                                        <span class=\"detail-label\">{{ translate('fundingRates.labels.countdown') }}:</span>\r\n                                        <span class=\"detail-value countdown\">{{ formatCountdown(subscriptions.regular.countdown) }}</span>\r\n                                      </div>\r\n                                    }\r\n                                  </div>\r\n                                  <div class=\"subscription-actions\">\r\n                                    <ui-button variant=\"ghost\" size=\"small\" (clicked)=\"editSubscription(subscriptions.regular)\">\r\n                                      {{ translate('fundingRates.actions.edit') }}\r\n                                    </ui-button>\r\n                                    <ui-button variant=\"danger\" size=\"small\" (clicked)=\"unsubscribe(subscriptions.regular.subscriptionId)\">\r\n                                      {{ translate('fundingRates.actions.cancel') }}\r\n                                    </ui-button>\r\n                                  </div>\r\n                                </div>\r\n                              </div>\r\n                            }\r\n\r\n                            <!-- Bybit Funding Strategies -->\r\n                            @if (subscriptions.bybitStrategies.length > 0) {\r\n                              <div class=\"subscription-section\">\r\n                                <h4 class=\"section-title\">üìä {{ translate('fundingRates.sections.bybitStrategies') || 'Bybit Funding Strategies' }}</h4>\r\n                                @for (strategy of subscriptions.bybitStrategies; track strategy.id) {\r\n                                  <div class=\"subscription-card bybit-strategy\">\r\n                                    <div class=\"subscription-details\">\r\n                                      <div class=\"detail-item\">\r\n                                        <span class=\"detail-label\">{{ translate('fundingRates.labels.status') }}:</span>\r\n                                        <span class=\"detail-value status-badge\" [class]=\"'status-' + strategy.status.toLowerCase()\">\r\n                                          {{ strategy.status }}\r\n                                        </span>\r\n                                      </div>\r\n                                      <div class=\"detail-item\">\r\n                                        <span class=\"detail-label\">{{ translate('fundingRates.labels.leverage') }}:</span>\r\n                                        <span class=\"detail-value\">{{ strategy.leverage }}x</span>\r\n                                      </div>\r\n                                      <div class=\"detail-item\">\r\n                                        <span class=\"detail-label\">{{ translate('fundingRates.labels.margin') }}:</span>\r\n                                        <span class=\"detail-value\">{{ strategy.margin }} USDT</span>\r\n                                      </div>\r\n                                      @if (strategy.takeProfitPrice) {\r\n                                        <div class=\"detail-item\">\r\n                                          <span class=\"detail-label\">{{ translate('fundingRates.labels.takeProfit') }}:</span>\r\n                                          <span class=\"detail-value positive\">{{ strategy.takeProfitPrice }} USDT</span>\r\n                                        </div>\r\n                                      }\r\n                                      @if (strategy.stopLossPrice) {\r\n                                        <div class=\"detail-item\">\r\n                                          <span class=\"detail-label\">{{ translate('fundingRates.labels.stopLoss') }}:</span>\r\n                                          <span class=\"detail-value negative\">{{ strategy.stopLossPrice }} USDT</span>\r\n                                        </div>\r\n                                      }\r\n                                      @if (strategy.realizedPnl !== null && strategy.realizedPnl !== undefined) {\r\n                                        <div class=\"detail-item\">\r\n                                          <span class=\"detail-label\">{{ translate('fundingRates.labels.pnl') }}:</span>\r\n                                          <span class=\"detail-value\" [class.positive]=\"strategy.realizedPnl > 0\" [class.negative]=\"strategy.realizedPnl < 0\">\r\n                                            {{ strategy.realizedPnl > 0 ? '+' : '' }}{{ strategy.realizedPnl.toFixed(2) }} USDT\r\n                                          </span>\r\n                                        </div>\r\n                                      }\r\n                                    </div>\r\n                                    <div class=\"subscription-actions\">\r\n                                      <ui-button variant=\"danger\" size=\"small\" (clicked)=\"stopBybitStrategy(strategy.id)\">\r\n                                        {{ translate('fundingRates.actions.stop') }}\r\n                                      </ui-button>\r\n                                    </div>\r\n                                  </div>\r\n                                }\r\n                              </div>\r\n                            }\r\n\r\n                          <!-- Multi-Exchange Funding Rates Section -->\r\n                          @if (opportunity.exchanges && opportunity.exchanges.length > 0) {\r\n                            <div class=\"subscription-section\">\r\n                              <h4 class=\"section-title\">üåê {{ translate('fundingRates.sections.allExchanges') || 'Funding Rates on All Exchanges' }}</h4>\r\n                              <div class=\"exchanges-table-wrapper\">\r\n                                <table class=\"exchanges-table\">\r\n                                  <thead>\r\n                                    <tr>\r\n                                      <th class=\"text-left\">{{ translate('fundingRates.labels.exchange') }}</th>\r\n                                      <th class=\"text-right\">{{ translate('fundingRates.labels.fundingRate') }}</th>\r\n                                      <th class=\"text-right\">{{ translate('fundingRates.labels.price') }}</th>\r\n                                      <th class=\"text-center\">{{ translate('fundingRates.labels.nextFunding') }}</th>\r\n                                      <th class=\"text-center\">{{ translate('fundingRates.actions.actions') || 'Actions' }}</th>\r\n                                    </tr>\r\n                                  </thead>\r\n                                  <tbody>\r\n                                    @for (exchangeData of opportunity.exchanges; track exchangeData.exchange) {\r\n                                      <tr class=\"exchange-row\">\r\n                                        <td class=\"text-left\">\r\n                                          <div class=\"exchange-info\">\r\n                                            <span class=\"exchange-name\">{{ exchangeData.exchange }}</span>\r\n                                            <span class=\"exchange-env-badge\">{{ exchangeData.environment }}</span>\r\n                                          </div>\r\n                                        </td>\r\n                                        <td class=\"text-right\">\r\n                                          <span class=\"funding-rate-value\" [ngClass]=\"getFundingRateClass(exchangeData.fundingRate)\">\r\n                                            {{ formatFundingRate(exchangeData.fundingRate) }}\r\n                                          </span>\r\n                                        </td>\r\n                                        <td class=\"text-right\">\r\n                                          <span class=\"price-value\">${{ formatPrice(exchangeData.lastPrice) }}</span>\r\n                                        </td>\r\n                                        <td class=\"text-center\">\r\n                                          <span class=\"next-funding-value\">{{ formatNextFundingTime(exchangeData.nextFundingTime) }}</span>\r\n                                        </td>\r\n                                        <td class=\"text-center exchange-actions-cell\">\r\n                                          @if (getSubscriptionForExchange(opportunity.symbol, exchangeData.exchange); as sub) {\r\n                                            <!-- Has subscription - show edit/cancel/start buttons -->\r\n                                            <div class=\"action-buttons\">\r\n                                              @if (sub.status === 'pending' || sub.status === 'active') {\r\n                                                <ui-button\r\n                                                  variant=\"tertiary\"\r\n                                                  size=\"small\"\r\n                                                  [iconOnly]=\"true\"\r\n                                                  (clicked)=\"startSubscriptionNow(sub.subscriptionId)\"\r\n                                                  className=\"action-btn start-btn\"\r\n                                                  [title]=\"translate('fundingRates.actions.startNow')\">\r\n                                                  <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                                                    <path d=\"M5 3L19 12L5 21V3Z\" fill=\"currentColor\"/>\r\n                                                  </svg>\r\n                                                </ui-button>\r\n                                                <ui-button\r\n                                                  variant=\"tertiary\"\r\n                                                  size=\"small\"\r\n                                                  [iconOnly]=\"true\"\r\n                                                  (clicked)=\"editSubscription(sub)\"\r\n                                                  className=\"action-btn edit-btn\"\r\n                                                  [title]=\"translate('fundingRates.actions.edit')\">\r\n                                                  <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                                                    <path d=\"M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                                                    <path d=\"M18.5 2.50001C18.8978 2.10219 19.4374 1.87869 20 1.87869C20.5626 1.87869 21.1022 2.10219 21.5 2.50001C21.8978 2.89784 22.1213 3.4374 22.1213 4.00001C22.1213 4.56262 21.8978 5.10219 21.5 5.50001L12 15L8 16L9 12L18.5 2.50001Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                                                  </svg>\r\n                                                </ui-button>\r\n                                                <ui-button\r\n                                                  variant=\"tertiary\"\r\n                                                  size=\"small\"\r\n                                                  [iconOnly]=\"true\"\r\n                                                  (clicked)=\"unsubscribe(sub.subscriptionId)\"\r\n                                                  className=\"action-btn cancel-btn\"\r\n                                                  [title]=\"translate('fundingRates.actions.cancel')\">\r\n                                                  <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                                                    <path d=\"M18 6L6 18M6 6L18 18\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                                                  </svg>\r\n                                                </ui-button>\r\n                                              }\r\n                                              @if (sub.status === 'executing') {\r\n                                                <span class=\"status-badge status-executing\">{{ translate('fundingRates.subscriptions.executing') }}</span>\r\n                                              }\r\n                                            </div>\r\n                                          } @else {\r\n                                            <!-- No subscription - show subscribe button -->\r\n                                            <ui-button variant=\"primary\" size=\"small\" (clicked)=\"openSubscribeModalForExchange(opportunity.symbol, exchangeData)\">\r\n                                              {{ translate('fundingRates.actions.subscribe') }}\r\n                                            </ui-button>\r\n                                          }\r\n                                        </td>\r\n                                      </tr>\r\n                                    }\r\n                                  </tbody>\r\n                                </table>\r\n                              </div>\r\n                            </div>\r\n                          }\r\n                          }\r\n                        </div>\r\n                      </td>\r\n                    </tr>\r\n                  }\r\n                }\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        }\r\n        <!-- NON_HEDGED MODE TABLE -->\r\n        @if (arbitrageMode() === 'NON_HEDGED') {\r\n          <div class=\"arbitrage-table-wrapper\">\r\n            <table class=\"arbitrage-table non-hedged-table\" role=\"table\" aria-label=\"Non-hedged arbitrage opportunities\">\r\n              <thead>\r\n                <tr>\r\n                  <!-- Symbol -->\r\n                  <th class=\"sortable-header\" (click)=\"sortArbitrageBy('symbol', $event)\">\r\n                    <div class=\"header-content\">\r\n                      <span>{{ translate('arbitrage.table.symbol') }}</span>\r\n                      @if (getArbitrageSortInfo('symbol'); as sortInfo) {\r\n                        <span class=\"sort-indicator\" [class.asc]=\"sortInfo.direction === 'asc'\" [class.desc]=\"sortInfo.direction === 'desc'\">\r\n                          @if (sortInfo.index >= 0) {\r\n                            <span class=\"sort-number\">{{ sortInfo.index + 1 }}</span>\r\n                          }\r\n                          ‚ñº\r\n                        </span>\r\n                      }\r\n                    </div>\r\n                  </th>\r\n\r\n                  <!-- Funding Rate -->\r\n                  <th class=\"text-center sortable-header\" (click)=\"sortArbitrageBy('funding', $event)\">\r\n                    <div class=\"header-content\">\r\n                      <span>{{ translate('arbitrage.table.funding') || 'Funding' }}</span>\r\n                      @if (getArbitrageSortInfo('funding'); as sortInfo) {\r\n                        <span class=\"sort-indicator\" [class.asc]=\"sortInfo.direction === 'asc'\" [class.desc]=\"sortInfo.direction === 'desc'\">\r\n                          @if (sortInfo.index >= 0) {\r\n                            <span class=\"sort-number\">{{ sortInfo.index + 1 }}</span>\r\n                          }\r\n                          ‚ñº\r\n                        </span>\r\n                      }\r\n                    </div>\r\n                  </th>\r\n\r\n                  <!-- Next Funding -->\r\n                  <th class=\"text-center sortable-header\" (click)=\"sortArbitrageBy('nextFunding', $event)\">\r\n                    <div class=\"header-content\">\r\n                      <span>{{ translate('arbitrage.table.nextFunding') || 'Next Funding' }}</span>\r\n                      @if (getArbitrageSortInfo('nextFunding'); as sortInfo) {\r\n                        <span class=\"sort-indicator\" [class.asc]=\"sortInfo.direction === 'asc'\" [class.desc]=\"sortInfo.direction === 'desc'\">\r\n                          @if (sortInfo.index >= 0) {\r\n                            <span class=\"sort-number\">{{ sortInfo.index + 1 }}</span>\r\n                          }\r\n                          ‚ñº\r\n                        </span>\r\n                      }\r\n                    </div>\r\n                  </th>\r\n\r\n                  <!-- Position -->\r\n                  <th class=\"text-center sortable-header\" (click)=\"sortArbitrageBy('position', $event)\">\r\n                    <div class=\"header-content\">\r\n                      <span>{{ translate('arbitrage.table.position') || 'Position' }}</span>\r\n                      @if (getArbitrageSortInfo('position'); as sortInfo) {\r\n                        <span class=\"sort-indicator\" [class.asc]=\"sortInfo.direction === 'asc'\" [class.desc]=\"sortInfo.direction === 'desc'\">\r\n                          @if (sortInfo.index >= 0) {\r\n                            <span class=\"sort-number\">{{ sortInfo.index + 1 }}</span>\r\n                          }\r\n                          ‚ñº\r\n                        </span>\r\n                      }\r\n                    </div>\r\n                  </th>\r\n\r\n                  <!-- Exchange -->\r\n                  <th class=\"text-center\">{{ translate('arbitrage.table.exchanges') }}</th>\r\n\r\n                  <!-- Action -->\r\n                  <th class=\"text-left\">{{ translate('arbitrage.table.opportunity') }}</th>\r\n                </tr>\r\n              </thead>\r\n            <tbody>\r\n              @for (opportunity of sortedArbitrageOpportunities(); track opportunity.symbol) {\r\n                <tr [class.opportunity-row]=\"opportunity.arbitrageOpportunity\" [class.has-subscription]=\"hasActiveSubscriptionsOrStrategies(opportunity.symbol)\">\r\n                  <!-- Symbol -->\r\n                  <td class=\"symbol-cell\">\r\n                    <div class=\"symbol-wrapper\">\r\n                      <button\r\n                        class=\"expand-icon\"\r\n                        (click)=\"toggleExpandRow(opportunity.symbol)\"\r\n                        [class.expanded]=\"isRowExpanded(opportunity.symbol)\"\r\n                        title=\"{{ isRowExpanded(opportunity.symbol) ? translate('fundingRates.actions.collapse') : translate('fundingRates.actions.expand') }}\">\r\n                        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                          <path d=\"M6 9L12 15L18 9\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                        </svg>\r\n                      </button>\r\n                      <span class=\"symbol-text\">{{ opportunity.symbol }}</span>\r\n                      <!-- Display market cap if available -->\r\n                      @if (opportunity.marketCap && opportunity.marketCap > 0) {\r\n                        <span class=\"symbol-price text-xs\">{{ formatMarketCap(opportunity.marketCap) }}</span>\r\n                      } @else {\r\n                        <!-- Fallback: Display price from the exchange with highest absolute funding rate -->\r\n                        @for (exchange of opportunity.exchanges; track exchange.exchange + exchange.credentialId) {\r\n                          @if ((getAbsoluteFundingRate(opportunity.bestLong.fundingRate) >= getAbsoluteFundingRate(opportunity.bestShort.fundingRate) &&\r\n                                exchange.exchange === opportunity.bestLong.exchange &&\r\n                                exchange.credentialId === opportunity.bestLong.credentialId) ||\r\n                               (getAbsoluteFundingRate(opportunity.bestLong.fundingRate) < getAbsoluteFundingRate(opportunity.bestShort.fundingRate) &&\r\n                                exchange.exchange === opportunity.bestShort.exchange &&\r\n                                exchange.credentialId === opportunity.bestShort.credentialId)) {\r\n                            @if (exchange.lastPrice) {\r\n                              @if (getRealtimePrice(exchange.exchange, opportunity.symbol); as realtimePrice) {\r\n                                <span class=\"symbol-price text-xs realtime-price\"\r\n                                      [class.price-up]=\"realtimePrice.change === 'up'\"\r\n                                      [class.price-down]=\"realtimePrice.change === 'down'\"\r\n                                      [class.price-neutral]=\"realtimePrice.change === 'neutral'\">\r\n                                  ${{ realtimePrice.price.toFixed(3) }}\r\n                                  @if (realtimePrice.change === 'up') {\r\n                                    <span class=\"price-indicator up\">‚ñ≤</span>\r\n                                  } @else if (realtimePrice.change === 'down') {\r\n                                    <span class=\"price-indicator down\">‚ñº</span>\r\n                                  }\r\n                                </span>\r\n                              } @else {\r\n                                <span class=\"symbol-price text-xs\">${{ parseFloat(exchange.lastPrice).toFixed(3) }}</span>\r\n                              }\r\n                            }\r\n                          }\r\n                        }\r\n                      }\r\n                    </div>\r\n                  </td>\r\n\r\n                  <!-- Funding Rate -->\r\n                  <td class=\"text-center funding-cell\">\r\n                    @if (getAbsoluteFundingRate(opportunity.bestLong.fundingRate) >= getAbsoluteFundingRate(opportunity.bestShort.fundingRate)) {\r\n                      <div class=\"funding-value\" [class.negative]=\"parseFloat(opportunity.bestLong.fundingRate) < 0\" [class.positive]=\"parseFloat(opportunity.bestLong.fundingRate) > 0\">\r\n                        {{ (parseFloat(opportunity.bestLong.fundingRate) * 100).toFixed(4) }}%\r\n                      </div>\r\n                    } @else {\r\n                      <div class=\"funding-value\" [class.negative]=\"parseFloat(opportunity.bestShort.fundingRate) < 0\" [class.positive]=\"parseFloat(opportunity.bestShort.fundingRate) > 0\">\r\n                        {{ (parseFloat(opportunity.bestShort.fundingRate) * 100).toFixed(4) }}%\r\n                      </div>\r\n                    }\r\n                  </td>\r\n\r\n                  <!-- Next Funding Time -->\r\n                  <td class=\"text-center next-funding-cell\">\r\n                    @for (exchange of opportunity.exchanges; track exchange.exchange + exchange.credentialId) {\r\n                      @if ((getAbsoluteFundingRate(opportunity.bestLong.fundingRate) >= getAbsoluteFundingRate(opportunity.bestShort.fundingRate) &&\r\n                            exchange.exchange === opportunity.bestLong.exchange &&\r\n                            exchange.credentialId === opportunity.bestLong.credentialId) ||\r\n                           (getAbsoluteFundingRate(opportunity.bestLong.fundingRate) < getAbsoluteFundingRate(opportunity.bestShort.fundingRate) &&\r\n                            exchange.exchange === opportunity.bestShort.exchange &&\r\n                            exchange.credentialId === opportunity.bestShort.credentialId)) {\r\n                        <div class=\"next-funding-value\">\r\n                          {{ formatNextFundingTime(exchange.nextFundingTime.toString() || '0') }}\r\n                        </div>\r\n                      }\r\n                    }\r\n                  </td>\r\n\r\n                  <!-- Position Type -->\r\n                  <td class=\"text-center position-cell\">\r\n                    @if (getAbsoluteFundingRate(opportunity.bestLong.fundingRate) >= getAbsoluteFundingRate(opportunity.bestShort.fundingRate)) {\r\n                      <div class=\"position-badge\" [class.long-position]=\"parseFloat(opportunity.bestLong.fundingRate) < 0\" [class.short-position]=\"parseFloat(opportunity.bestLong.fundingRate) >= 0\">\r\n                        {{ parseFloat(opportunity.bestLong.fundingRate) < 0 ? 'LONG' : 'SHORT' }}\r\n                      </div>\r\n                    } @else {\r\n                      <div class=\"position-badge\" [class.long-position]=\"parseFloat(opportunity.bestShort.fundingRate) < 0\" [class.short-position]=\"parseFloat(opportunity.bestShort.fundingRate) >= 0\">\r\n                        {{ parseFloat(opportunity.bestShort.fundingRate) < 0 ? 'LONG' : 'SHORT' }}\r\n                      </div>\r\n                    }\r\n                  </td>\r\n\r\n                  <!-- Exchange -->\r\n                  <td class=\"exchanges-cell text-center\">\r\n                    <div class=\"exchanges-badges\">\r\n                      <!-- Show only the exchange with highest absolute funding rate -->\r\n                      @for (exchange of opportunity.exchanges; track exchange.exchange + exchange.credentialId) {\r\n                        @if ((getAbsoluteFundingRate(opportunity.bestLong.fundingRate) >= getAbsoluteFundingRate(opportunity.bestShort.fundingRate) &&\r\n                              exchange.exchange === opportunity.bestLong.exchange &&\r\n                              exchange.credentialId === opportunity.bestLong.credentialId) ||\r\n                             (getAbsoluteFundingRate(opportunity.bestLong.fundingRate) < getAbsoluteFundingRate(opportunity.bestShort.fundingRate) &&\r\n                              exchange.exchange === opportunity.bestShort.exchange &&\r\n                              exchange.credentialId === opportunity.bestShort.credentialId)) {\r\n                          <div class=\"exchange-info-wrapper\">\r\n                            <button\r\n                              class=\"exchange-badge exchange-badge-button\"\r\n                              [class]=\"'badge-' + exchange.exchange.toLowerCase()\"\r\n                              (click)=\"openTradingPairForExchange(opportunity.symbol, exchange.exchange, exchange.environment, exchange.originalSymbol)\"\r\n                              [title]=\"'Open ' + opportunity.symbol + ' on ' + exchange.exchange + ' (Best rate: ' + (parseFloat(exchange.fundingRate) * 100).toFixed(4) + '%)'\">\r\n                              {{ exchange.exchange }}\r\n                            </button>\r\n                          </div>\r\n                        }\r\n                      }\r\n                    </div>\r\n                  </td>\r\n\r\n                  <!-- Action Buttons -->\r\n                  <td class=\"text-left action-cell\">\r\n                    @if (hasArbitrageSubscription(opportunity.symbol)) {\r\n                      <!-- Show Start, Edit, Cancel for subscribed symbols -->\r\n                      <div class=\"subscription-action-buttons\">\r\n                        <ui-button\r\n                          variant=\"tertiary\"\r\n                          size=\"small\"\r\n                          [iconOnly]=\"true\"\r\n                          [disabled]=\"startingSubscriptionId() === getArbitrageSubscription(opportunity.symbol)?.subscriptionId\"\r\n                          (clicked)=\"startArbitrageSubscription(opportunity)\"\r\n                          className=\"action-btn start-btn\"\r\n                          title=\"Start Arbitrage\">\r\n                          <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                            <path d=\"M5 3L19 12L5 21V3Z\" fill=\"currentColor\"/>\r\n                          </svg>\r\n                        </ui-button>\r\n                        <ui-button\r\n                          variant=\"tertiary\"\r\n                          size=\"small\"\r\n                          [iconOnly]=\"true\"\r\n                          (clicked)=\"editArbitrageSubscription(opportunity)\"\r\n                          className=\"action-btn edit-btn\"\r\n                          title=\"Edit Subscription\">\r\n                          <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                            <path d=\"M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                            <path d=\"M18.5 2.50001C18.8978 2.10219 19.4374 1.87869 20 1.87869C20.5626 1.87869 21.1022 2.10219 21.5 2.50001C21.8978 2.89784 22.1213 3.4374 22.1213 4.00001C22.1213 4.56262 21.8978 5.10219 21.5 5.50001L12 15L8 16L9 12L18.5 2.50001Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                          </svg>\r\n                        </ui-button>\r\n                        <ui-button\r\n                          variant=\"tertiary\"\r\n                          size=\"small\"\r\n                          [iconOnly]=\"true\"\r\n                          (clicked)=\"cancelArbitrageSubscription(opportunity)\"\r\n                          className=\"action-btn cancel-btn\"\r\n                          title=\"Cancel Subscription\">\r\n                          <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                            <path d=\"M18 6L6 18M6 6L18 18\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                          </svg>\r\n                        </ui-button>\r\n                      </div>\r\n                    } @else {\r\n                      <!-- Show Subscribe button for non-subscribed symbols -->\r\n                      @if (opportunity.arbitrageOpportunity) {\r\n                        <ui-button\r\n                          variant=\"primary\"\r\n                          size=\"small\"\r\n                          (clicked)=\"subscribeToArbitrage(opportunity)\"\r\n                          className=\"action-btn subscribe-arbitrage-btn\">\r\n                          <span>‚ö° {{ translate('fundingRates.actions.subscribe') }}</span>\r\n                        </ui-button>\r\n                      } @else {\r\n                        <ui-button\r\n                          variant=\"ghost\"\r\n                          size=\"small\"\r\n                          (clicked)=\"subscribeToArbitrage(opportunity)\"\r\n                          className=\"action-btn subscribe-arbitrage-btn\">\r\n                          <span>{{ translate('fundingRates.actions.subscribe') }}</span>\r\n                        </ui-button>\r\n                      }\r\n\r\n                      <!-- Trade History Report Button -->\r\n                      <ui-button\r\n                        variant=\"ghost\"\r\n                        size=\"small\"\r\n                        (clicked)=\"openTradeHistoryDialog(opportunity.symbol, opportunity.bestLong.exchange)\"\r\n                        className=\"action-btn trade-history-btn\"\r\n                        [ariaLabel]=\"translate('fundingRates.actions.viewTradeHistory')\">\r\n                        <span>üìä</span>\r\n                      </ui-button>\r\n\r\n                      <!-- Bybit Strategy Button -->\r\n                      @if (opportunity.bestLong.exchange === 'BYBIT' || opportunity.bestLong.exchange === 'BYBIT_MAINNET' || opportunity.bestShort.exchange === 'BYBIT' || opportunity.bestShort.exchange === 'BYBIT_MAINNET') {\r\n                        <ui-button\r\n                          variant=\"ghost\"\r\n                          size=\"small\"\r\n                          (clicked)=\"openBybitStrategyModal(opportunity)\"\r\n                          className=\"action-btn bybit-strategy-btn\"\r\n                          ariaLabel=\"Start Bybit Funding Strategy\">\r\n                          <span>‚ö°</span>\r\n                        </ui-button>\r\n                      }\r\n                    }\r\n                  </td>\r\n                </tr>\r\n\r\n                <!-- Expanded row for subscriptions/strategies and ticker details -->\r\n                @if (isRowExpanded(opportunity.symbol)) {\r\n                  <tr class=\"expanded-row\">\r\n                    <td colspan=\"6\" class=\"expanded-content\">\r\n                      <div class=\"expanded-content-wrapper\">\r\n                        @if (getSubscriptionsForSymbol(opportunity.symbol); as subscriptions) {\r\n                          <!-- Regular Funding Subscriptions -->\r\n                          @if (subscriptions.regular) {\r\n                            <div class=\"subscription-section\">\r\n                              <h4 class=\"section-title\">üí∞ {{ translate('fundingRates.sections.regularSubscription') || 'Regular Funding Subscription' }}</h4>\r\n                              <div class=\"subscription-card\">\r\n                                <div class=\"subscription-details\">\r\n                                  <div class=\"detail-item\">\r\n                                    <span class=\"detail-label\">{{ translate('fundingRates.labels.status') }}:</span>\r\n                                    <span class=\"detail-value status-badge\" [class]=\"'status-' + subscriptions.regular.status.toLowerCase()\">\r\n                                      {{ subscriptions.regular.status }}\r\n                                    </span>\r\n                                  </div>\r\n                                  <div class=\"detail-item\">\r\n                                    <span class=\"detail-label\">{{ translate('fundingRates.labels.side') }}:</span>\r\n                                    <span class=\"detail-value\">{{ subscriptions.regular.positionType }}</span>\r\n                                  </div>\r\n                                  @if (subscriptions.regular.primaryExchange) {\r\n                                    <div class=\"detail-item\">\r\n                                      <span class=\"detail-label\">{{ translate('fundingRates.labels.exchange') }}:</span>\r\n                                      <span class=\"detail-value\">{{ subscriptions.regular.primaryExchange }}</span>\r\n                                    </div>\r\n                                  }\r\n                                  <div class=\"detail-item\">\r\n                                    <span class=\"detail-label\">{{ translate('fundingRates.labels.quantity') }}:</span>\r\n                                    <span class=\"detail-value\">{{ subscriptions.regular.quantity }}</span>\r\n                                  </div>\r\n                                  @if (subscriptions.regular.leverage) {\r\n                                    <div class=\"detail-item\">\r\n                                      <span class=\"detail-label\">{{ translate('fundingRates.labels.leverage') }}:</span>\r\n                                      <span class=\"detail-value\">{{ subscriptions.regular.leverage }}x</span>\r\n                                    </div>\r\n                                  }\r\n                                  @if (subscriptions.regular.margin) {\r\n                                    <div class=\"detail-item\">\r\n                                      <span class=\"detail-label\">{{ translate('fundingRates.labels.margin') }}:</span>\r\n                                      <span class=\"detail-value\">{{ subscriptions.regular.margin }} USDT</span>\r\n                                    </div>\r\n                                  }\r\n                                  <div class=\"detail-item\">\r\n                                    <span class=\"detail-label\">{{ translate('fundingRates.labels.fundingRate') }}:</span>\r\n                                    <span class=\"detail-value\" [ngClass]=\"getFundingRateClass(subscriptions.regular.fundingRate.toString())\">\r\n                                      {{ formatFundingRate(subscriptions.regular.fundingRate.toString()) }}\r\n                                    </span>\r\n                                  </div>\r\n                                  @if (subscriptions.regular.nextFundingTime) {\r\n                                    <div class=\"detail-item\">\r\n                                      <span class=\"detail-label\">{{ translate('fundingRates.labels.nextFunding') }}:</span>\r\n                                      <span class=\"detail-value\">{{ formatNextFundingTime(subscriptions.regular.nextFundingTime) }}</span>\r\n                                    </div>\r\n                                  }\r\n                                  @if (subscriptions.regular.countdown && subscriptions.regular.countdown > 0) {\r\n                                    <div class=\"detail-item\">\r\n                                      <span class=\"detail-label\">{{ translate('fundingRates.labels.countdown') }}:</span>\r\n                                      <span class=\"detail-value countdown\">{{ formatCountdown(subscriptions.regular.countdown) }}</span>\r\n                                    </div>\r\n                                  }\r\n                                </div>\r\n                                <div class=\"subscription-actions\">\r\n                                  <ui-button variant=\"ghost\" size=\"small\" (clicked)=\"editSubscription(subscriptions.regular)\">\r\n                                    {{ translate('fundingRates.actions.edit') }}\r\n                                  </ui-button>\r\n                                  <ui-button variant=\"danger\" size=\"small\" (clicked)=\"unsubscribe(subscriptions.regular.subscriptionId)\">\r\n                                    {{ translate('fundingRates.actions.cancel') }}\r\n                                  </ui-button>\r\n                                </div>\r\n                              </div>\r\n                            </div>\r\n                          }\r\n\r\n                          <!-- Bybit Funding Strategies -->\r\n                          @if (subscriptions.bybitStrategies.length > 0) {\r\n                            <div class=\"subscription-section\">\r\n                              <h4 class=\"section-title\">üìä {{ translate('fundingRates.sections.bybitStrategies') || 'Bybit Funding Strategies' }}</h4>\r\n                              @for (strategy of subscriptions.bybitStrategies; track strategy.id) {\r\n                                <div class=\"subscription-card bybit-strategy\">\r\n                                  <div class=\"subscription-details\">\r\n                                    <div class=\"detail-item\">\r\n                                      <span class=\"detail-label\">{{ translate('fundingRates.labels.status') }}:</span>\r\n                                      <span class=\"detail-value status-badge\" [class]=\"'status-' + strategy.status.toLowerCase()\">\r\n                                        {{ strategy.status }}\r\n                                      </span>\r\n                                    </div>\r\n                                    <div class=\"detail-item\">\r\n                                      <span class=\"detail-label\">{{ translate('fundingRates.labels.leverage') }}:</span>\r\n                                      <span class=\"detail-value\">{{ strategy.leverage }}x</span>\r\n                                    </div>\r\n                                    <div class=\"detail-item\">\r\n                                      <span class=\"detail-label\">{{ translate('fundingRates.labels.margin') }}:</span>\r\n                                      <span class=\"detail-value\">{{ strategy.margin }} USDT</span>\r\n                                    </div>\r\n                                    @if (strategy.takeProfitPrice) {\r\n                                      <div class=\"detail-item\">\r\n                                        <span class=\"detail-label\">{{ translate('fundingRates.labels.takeProfit') }}:</span>\r\n                                        <span class=\"detail-value positive\">{{ strategy.takeProfitPrice }} USDT</span>\r\n                                      </div>\r\n                                    }\r\n                                    @if (strategy.stopLossPrice) {\r\n                                      <div class=\"detail-item\">\r\n                                        <span class=\"detail-label\">{{ translate('fundingRates.labels.stopLoss') }}:</span>\r\n                                        <span class=\"detail-value negative\">{{ strategy.stopLossPrice }} USDT</span>\r\n                                      </div>\r\n                                    }\r\n                                    @if (strategy.realizedPnl !== null && strategy.realizedPnl !== undefined) {\r\n                                      <div class=\"detail-item\">\r\n                                        <span class=\"detail-label\">{{ translate('fundingRates.labels.pnl') }}:</span>\r\n                                        <span class=\"detail-value\" [class.positive]=\"strategy.realizedPnl > 0\" [class.negative]=\"strategy.realizedPnl < 0\">\r\n                                          {{ strategy.realizedPnl > 0 ? '+' : '' }}{{ strategy.realizedPnl.toFixed(2) }} USDT\r\n                                        </span>\r\n                                      </div>\r\n                                    }\r\n                                  </div>\r\n                                  <div class=\"subscription-actions\">\r\n                                    <ui-button variant=\"danger\" size=\"small\" (clicked)=\"stopBybitStrategy(strategy.id)\">\r\n                                      {{ translate('fundingRates.actions.stop') }}\r\n                                    </ui-button>\r\n                                  </div>\r\n                                </div>\r\n                              }\r\n                            </div>\r\n                          }\r\n\r\n                          <!-- Multi-Exchange Funding Rates Section -->\r\n                          @if (opportunity.exchanges && opportunity.exchanges.length > 0) {\r\n                            <div class=\"subscription-section\">\r\n                              <h4 class=\"section-title\">üåê {{ translate('fundingRates.sections.allExchanges') || 'Funding Rates on All Exchanges' }}</h4>\r\n                              <div class=\"exchanges-table-wrapper\">\r\n                                <table class=\"exchanges-table\">\r\n                                  <thead>\r\n                                    <tr>\r\n                                      <th class=\"text-left\">{{ translate('fundingRates.labels.exchange') }}</th>\r\n                                      <th class=\"text-right\">{{ translate('fundingRates.labels.fundingRate') }}</th>\r\n                                      <th class=\"text-right\">{{ translate('fundingRates.labels.price') }}</th>\r\n                                      <th class=\"text-center\">{{ translate('fundingRates.labels.nextFunding') }}</th>\r\n                                      <th class=\"text-center\">{{ translate('fundingRates.actions.actions') || 'Actions' }}</th>\r\n                                    </tr>\r\n                                  </thead>\r\n                                  <tbody>\r\n                                    @for (exchangeData of opportunity.exchanges; track exchangeData.exchange) {\r\n                                      <tr class=\"exchange-row\">\r\n                                        <td class=\"text-left\">\r\n                                          <div class=\"exchange-info\">\r\n                                            <span class=\"exchange-name\">{{ exchangeData.exchange }}</span>\r\n                                            <span class=\"exchange-env-badge\">{{ exchangeData.environment }}</span>\r\n                                          </div>\r\n                                        </td>\r\n                                        <td class=\"text-right\">\r\n                                          <span class=\"funding-rate-value\" [ngClass]=\"getFundingRateClass(exchangeData.fundingRate)\">\r\n                                            {{ formatFundingRate(exchangeData.fundingRate) }}\r\n                                          </span>\r\n                                        </td>\r\n                                        <td class=\"text-right\">\r\n                                          <span class=\"price-value\">${{ formatPrice(exchangeData.lastPrice) }}</span>\r\n                                        </td>\r\n                                        <td class=\"text-center\">\r\n                                          <span class=\"next-funding-value\">{{ formatNextFundingTime(exchangeData.nextFundingTime) }}</span>\r\n                                        </td>\r\n                                        <td class=\"text-center exchange-actions-cell\">\r\n                                          @if (getSubscriptionForExchange(opportunity.symbol, exchangeData.exchange); as sub) {\r\n                                            <!-- Has subscription - show edit/cancel/start buttons -->\r\n                                            <div class=\"action-buttons\">\r\n                                              @if (sub.status === 'pending' || sub.status === 'active') {\r\n                                                <ui-button\r\n                                                  variant=\"tertiary\"\r\n                                                  size=\"small\"\r\n                                                  [iconOnly]=\"true\"\r\n                                                  (clicked)=\"startSubscriptionNow(sub.subscriptionId)\"\r\n                                                  className=\"action-btn start-btn\"\r\n                                                  [title]=\"translate('fundingRates.actions.startNow')\">\r\n                                                  <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                                                    <path d=\"M5 3L19 12L5 21V3Z\" fill=\"currentColor\"/>\r\n                                                  </svg>\r\n                                                </ui-button>\r\n                                                <ui-button\r\n                                                  variant=\"tertiary\"\r\n                                                  size=\"small\"\r\n                                                  [iconOnly]=\"true\"\r\n                                                  (clicked)=\"editSubscription(sub)\"\r\n                                                  className=\"action-btn edit-btn\"\r\n                                                  [title]=\"translate('fundingRates.actions.edit')\">\r\n                                                  <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                                                    <path d=\"M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                                                    <path d=\"M18.5 2.50001C18.8978 2.10219 19.4374 1.87869 20 1.87869C20.5626 1.87869 21.1022 2.10219 21.5 2.50001C21.8978 2.89784 22.1213 3.4374 22.1213 4.00001C22.1213 4.56262 21.8978 5.10219 21.5 5.50001L12 15L8 16L9 12L18.5 2.50001Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                                                  </svg>\r\n                                                </ui-button>\r\n                                                <ui-button\r\n                                                  variant=\"tertiary\"\r\n                                                  size=\"small\"\r\n                                                  [iconOnly]=\"true\"\r\n                                                  (clicked)=\"unsubscribe(sub.subscriptionId)\"\r\n                                                  className=\"action-btn cancel-btn\"\r\n                                                  [title]=\"translate('fundingRates.actions.cancel')\">\r\n                                                  <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                                                    <path d=\"M18 6L6 18M6 6L18 18\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                                                  </svg>\r\n                                                </ui-button>\r\n                                              }\r\n                                              @if (sub.status === 'executing') {\r\n                                                <span class=\"status-badge status-executing\">{{ translate('fundingRates.subscriptions.executing') }}</span>\r\n                                              }\r\n                                            </div>\r\n                                          } @else {\r\n                                            <!-- No subscription - show subscribe button -->\r\n                                            <ui-button variant=\"primary\" size=\"small\" (clicked)=\"openSubscribeModalForExchange(opportunity.symbol, exchangeData)\">\r\n                                              {{ translate('fundingRates.actions.subscribe') }}\r\n                                            </ui-button>\r\n                                          }\r\n                                        </td>\r\n                                      </tr>\r\n                                    }\r\n                                  </tbody>\r\n                                </table>\r\n                              </div>\r\n                            </div>\r\n                          }\r\n                          }\r\n                      </div>\r\n                    </td>\r\n                  </tr>\r\n                }\r\n              }\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n        }\r\n      }\r\n      }\r\n    </ui-card-content>\r\n  </ui-card>\r\n\r\n  <!-- Active Subscriptions Panel -->\r\n  @if (subscriptions().size > 0) {\r\n    <ui-card variant=\"elevated\" class=\"subscriptions-card\">\r\n      <ui-card-header>\r\n        <ui-card-title>{{ translate('fundingRates.subscriptions.title') }}</ui-card-title>\r\n      </ui-card-header>\r\n      <ui-card-content>\r\n        <div class=\"subscriptions-list\">\r\n          @for (sub of Array.from(subscriptions().values()); track sub.subscriptionId) {\r\n            <div class=\"subscription-item\">\r\n              <div class=\"subscription-info\">\r\n                <div class=\"subscription-symbol\">{{ sub.symbol }}</div>\r\n                <div class=\"subscription-details\">\r\n                  <span class=\"detail-label\">{{ translate('fundingRates.subscriptions.type') }}:</span>\r\n                  <span class=\"detail-value\" [class.positive]=\"sub.positionType === 'short'\" [class.negative]=\"sub.positionType === 'long'\">\r\n                    {{ sub.positionType.toUpperCase() }}\r\n                  </span>\r\n                  <span class=\"detail-separator\">‚Ä¢</span>\r\n                  <span class=\"detail-label\">{{ translate('fundingRates.subscriptions.rate') }}:</span>\r\n                  <span class=\"detail-value\">{{ formatFundingRate(sub.fundingRate.toString()) }}</span>\r\n                  <span class=\"detail-separator\">‚Ä¢</span>\r\n                  <span class=\"detail-label\">{{ translate('fundingRates.subscriptions.quantity') }}:</span>\r\n                  <span class=\"detail-value\">{{ sub.quantity }}</span>\r\n                </div>\r\n              </div>\r\n              <div class=\"subscription-countdown\">\r\n                @if (sub.countdown !== undefined) {\r\n                  <div class=\"countdown-display\" [class.urgent]=\"sub.countdown && sub.countdown <= 10\">\r\n                    {{ formatCountdown(sub.countdown) }}\r\n                  </div>\r\n                } @else {\r\n                  <div class=\"countdown-display\" [class.urgent]=\"calculateCountdown(sub.nextFundingTime) <= 10\">\r\n                    {{ formatCountdown(calculateCountdown(sub.nextFundingTime)) }}\r\n                  </div>\r\n                }\r\n              </div>\r\n              <div class=\"subscription-actions\">\r\n                <ui-button\r\n                  variant=\"primary\"\r\n                  size=\"small\"\r\n                  (clicked)=\"startSubscriptionNow(sub.subscriptionId)\">\r\n                  {{ translate('fundingRates.actions.startNow') }}\r\n                </ui-button>\r\n                <ui-button\r\n                  variant=\"ghost\"\r\n                  size=\"small\"\r\n                  (clicked)=\"editSubscription(sub)\">\r\n                  {{ translate('fundingRates.actions.edit') }}\r\n                </ui-button>\r\n                <ui-button\r\n                  variant=\"ghost\"\r\n                  size=\"small\"\r\n                  (clicked)=\"unsubscribe(sub.subscriptionId)\">\r\n                  {{ translate('fundingRates.actions.cancel') }}\r\n                </ui-button>\r\n              </div>\r\n            </div>\r\n          }\r\n        </div>\r\n      </ui-card-content>\r\n    </ui-card>\r\n  }\r\n\r\n  <!-- Active Bybit Funding Strategies Panel -->\r\n  @if (activeBybitStrategies().length > 0) {\r\n    <ui-card variant=\"elevated\" class=\"bybit-strategies-card\">\r\n      <ui-card-header>\r\n        <ui-card-title>{{ translate('fundingRates.bybitStrategies.title') }}</ui-card-title>\r\n      </ui-card-header>\r\n      <ui-card-content>\r\n        <div class=\"bybit-strategies-list\">\r\n          @for (strategy of activeBybitStrategies(); track strategy.id) {\r\n            <div class=\"strategy-item\">\r\n              <div class=\"strategy-info\">\r\n                <div class=\"strategy-symbol\">{{ strategy.symbol }}</div>\r\n                <div class=\"strategy-details\">\r\n                  <span class=\"detail-label\">{{ translate('fundingRates.bybitStrategies.status') }}:</span>\r\n                  <span class=\"detail-value status-badge\" [attr.data-status]=\"strategy.status\">\r\n                    {{ strategy.status }}\r\n                  </span>\r\n                  <span class=\"detail-separator\">‚Ä¢</span>\r\n                  <span class=\"detail-label\">{{ translate('fundingRates.bybitStrategies.side') }}:</span>\r\n                  <span class=\"detail-value\" [class.positive]=\"strategy.side === 'Buy'\" [class.negative]=\"strategy.side === 'Sell'\">\r\n                    {{ strategy.side }}\r\n                  </span>\r\n                  <span class=\"detail-separator\">‚Ä¢</span>\r\n                  <span class=\"detail-label\">{{ translate('fundingRates.bybitStrategies.leverage') }}:</span>\r\n                  <span class=\"detail-value\">{{ strategy.leverage }}x</span>\r\n                  @if (strategy.entryPrice) {\r\n                    <span class=\"detail-separator\">‚Ä¢</span>\r\n                    <span class=\"detail-label\">{{ translate('fundingRates.bybitStrategies.entryPrice') }}:</span>\r\n                    <span class=\"detail-value\">${{ strategy.entryPrice.toFixed(2) }}</span>\r\n                  }\r\n                  @if (strategy.hasPosition) {\r\n                    <span class=\"detail-separator\">‚Ä¢</span>\r\n                    <span class=\"detail-label\">{{ translate('fundingRates.bybitStrategies.positionSize') }}:</span>\r\n                    <span class=\"detail-value\">{{ strategy.positionSize }}</span>\r\n                  }\r\n                </div>\r\n                @if (strategy.secondsRemaining !== undefined && strategy.secondsRemaining > 0) {\r\n                  <div class=\"strategy-countdown\">\r\n                    <span class=\"countdown-label\">{{ translate('fundingRates.bybitStrategies.nextFunding') }}:</span>\r\n                    <span class=\"countdown-value\">{{ formatCountdown(strategy.secondsRemaining) }}</span>\r\n                  </div>\r\n                }\r\n                @if (strategy.errorMessage) {\r\n                  <div class=\"strategy-error\">\r\n                    <span class=\"error-icon\">‚ö†Ô∏è</span>\r\n                    <span class=\"error-text\">{{ strategy.errorMessage }}</span>\r\n                  </div>\r\n                }\r\n              </div>\r\n              <div class=\"strategy-actions\">\r\n                <ui-button\r\n                  variant=\"ghost\"\r\n                  size=\"small\"\r\n                  (clicked)=\"stopBybitStrategy(strategy.id)\">\r\n                  {{ translate('fundingRates.bybitStrategies.actions.stop') }}\r\n                </ui-button>\r\n              </div>\r\n            </div>\r\n          }\r\n        </div>\r\n      </ui-card-content>\r\n    </ui-card>\r\n  }\r\n\r\n  <!-- Completed Deals Panel -->\r\n  @if (completedDeals().length > 0) {\r\n    <ui-card variant=\"elevated\" class=\"deals-card\">\r\n      <ui-card-header>\r\n        <ui-card-title>{{ translate('fundingRates.deals.title') }}</ui-card-title>\r\n      </ui-card-header>\r\n      <ui-card-content>\r\n        <div class=\"deals-list\">\r\n          @for (deal of completedDeals(); track deal.subscriptionId) {\r\n            <div class=\"deal-item\">\r\n              <div class=\"deal-header\">\r\n                <div class=\"deal-symbol\">{{ deal.symbol }}</div>\r\n                <div class=\"deal-type\" [class.positive]=\"deal.positionType === 'short'\" [class.negative]=\"deal.positionType === 'long'\">\r\n                  {{ deal.positionType.toUpperCase() }}\r\n                </div>\r\n              </div>\r\n              <div class=\"deal-details\">\r\n                <div class=\"deal-row\">\r\n                  <span class=\"detail-label\">{{ translate('fundingRates.deals.fundingRate') }}:</span>\r\n                  <span class=\"detail-value\">{{ formatFundingRate(deal.fundingRate.toString()) }}</span>\r\n                </div>\r\n                <div class=\"deal-row\">\r\n                  <span class=\"detail-label\">{{ translate('fundingRates.deals.quantity') }}:</span>\r\n                  <span class=\"detail-value\">{{ deal.quantity }}</span>\r\n                </div>\r\n                <div class=\"deal-row\">\r\n                  <span class=\"detail-label\">{{ translate('fundingRates.deals.entryPrice') }}:</span>\r\n                  <span class=\"detail-value\">${{ deal.entryPrice.toFixed(3) }}</span>\r\n                </div>\r\n                <div class=\"deal-row\">\r\n                  <span class=\"detail-label\">{{ translate('fundingRates.deals.hedgeEntry') }}:</span>\r\n                  <span class=\"detail-value\">${{ deal.hedgeEntryPrice.toFixed(3) }}</span>\r\n                </div>\r\n                <div class=\"deal-row highlight\">\r\n                  <span class=\"detail-label\">{{ translate('fundingRates.deals.fundingEarned') }}:</span>\r\n                  <span class=\"detail-value\" [class.positive]=\"deal.fundingEarned > 0\" [class.negative]=\"deal.fundingEarned < 0\">\r\n                    ${{ deal.fundingEarned.toFixed(4) }}\r\n                  </span>\r\n                </div>\r\n                <div class=\"deal-row highlight\">\r\n                  <span class=\"detail-label\">{{ translate('fundingRates.deals.realizedPnl') }}:</span>\r\n                  <span class=\"detail-value\" [class.positive]=\"deal.realizedPnl > 0\" [class.negative]=\"deal.realizedPnl < 0\">\r\n                    ${{ deal.realizedPnl.toFixed(4) }}\r\n                  </span>\r\n                </div>\r\n                <div class=\"deal-row\">\r\n                  <span class=\"detail-label\">{{ translate('fundingRates.deals.executed') }}:</span>\r\n                  <span class=\"detail-value\">{{ formatTimestamp(deal.executedAt) }}</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          }\r\n        </div>\r\n      </ui-card-content>\r\n    </ui-card>\r\n  }\r\n\r\n  <!-- Subscription Dialog -->\r\n  @if (showSubscriptionDialog() && selectedTicker()) {\r\n    <div class=\"dialog-overlay\" (click)=\"closeSubscriptionDialog()\">\r\n      <div class=\"dialog-content\" (click)=\"$event.stopPropagation()\">\r\n        <div class=\"dialog-header\">\r\n          <h3>{{ editingSubscription() ? 'Edit Subscription' : translate('fundingRates.dialog.title') }}</h3>\r\n          <button class=\"dialog-close\" (click)=\"closeSubscriptionDialog()\">√ó</button>\r\n        </div>\r\n\r\n        <div class=\"dialog-body\">\r\n          <!-- Basic Info -->\r\n          <div class=\"dialog-info\">\r\n            <div class=\"info-row\">\r\n              <span class=\"info-label\">Symbol:</span>\r\n              <span class=\"info-value\">{{ selectedTicker()!.symbol }}</span>\r\n            </div>\r\n            <div class=\"info-row\">\r\n              <span class=\"info-label\">Funding Rate:</span>\r\n              <span class=\"info-value\" [ngClass]=\"getFundingRateClass(selectedTicker()!.fundingRate)\">\r\n                {{ formatFundingRate(selectedTicker()!.fundingRate) }}\r\n              </span>\r\n            </div>\r\n            <div class=\"info-row\">\r\n              <span class=\"info-label\">Next Funding:</span>\r\n              <span class=\"info-value\">{{ formatNextFundingTime(selectedTicker()!.nextFundingTime) }}</span>\r\n            </div>\r\n            <div class=\"info-row\">\r\n              <span class=\"info-label\">Mode:</span>\r\n              <span class=\"info-value\" [class.mode-hedged]=\"arbitrageMode() === 'HEDGED'\" [class.mode-non-hedged]=\"arbitrageMode() === 'NON_HEDGED'\">\r\n                {{ arbitrageMode() === 'HEDGED' ? 'Hedged (2 positions)' : 'Non-Hedged (1 position)' }}\r\n              </span>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Exchange Information -->\r\n          <div class=\"exchanges-info\">\r\n            <div class=\"exchange-item\">\r\n              <div class=\"exchange-label\">Primary Exchange:</div>\r\n              <div class=\"exchange-value\">\r\n                {{ selectedCredential()?.exchange }} {{ selectedCredential()?.environment }}\r\n              </div>\r\n              @if (positionCalculation()) {\r\n                <div class=\"exchange-price\">\r\n                  Price: ${{ positionCalculation()!.estimatedPrice.toFixed(3) }}\r\n                </div>\r\n              }\r\n            </div>\r\n            @if (arbitrageMode() === 'HEDGED') {\r\n              <div class=\"exchange-item\">\r\n                <div class=\"exchange-label\">Hedge Exchange:</div>\r\n                <div class=\"exchange-value\">\r\n                  @if (hedgeCredential()) {\r\n                    {{ hedgeCredential()!.exchange }} {{ hedgeCredential()!.environment }}\r\n                  } @else {\r\n                    {{ translate('fundingRates.dialog.mockExchange') || 'Not selected' }}\r\n                  }\r\n                </div>\r\n                @if (positionCalculation()) {\r\n                  <div class=\"exchange-price\">\r\n                    Price: ${{ positionCalculation()!.estimatedPrice.toFixed(3) }}\r\n                  </div>\r\n                }\r\n              </div>\r\n            }\r\n          </div>\r\n\r\n          <!-- Trading Parameters -->\r\n          <div class=\"dialog-form\">\r\n            <div class=\"form-group\">\r\n              <label class=\"form-label\">Leverage</label>\r\n              <input\r\n                type=\"number\"\r\n                class=\"form-input\"\r\n                [ngModel]=\"dialogLeverage()\"\r\n                (ngModelChange)=\"dialogLeverage.set($event)\"\r\n                min=\"1\"\r\n                max=\"125\"\r\n                step=\"1\"\r\n                placeholder=\"3\"\r\n              />\r\n              <p class=\"form-hint\">{{ dialogLeverage() }}x leverage multiplies your position size</p>\r\n            </div>\r\n\r\n            <div class=\"form-group\">\r\n              <label class=\"form-label\">Margin (USDT)</label>\r\n              <input\r\n                type=\"number\"\r\n                class=\"form-input\"\r\n                [ngModel]=\"positionSizeUsdt()\"\r\n                (ngModelChange)=\"positionSizeUsdt.set($event)\"\r\n                step=\"10\"\r\n                min=\"10\"\r\n                placeholder=\"e.g., 100\"\r\n              />\r\n              <p class=\"form-hint\">\r\n                @if (arbitrageMode() === 'HEDGED') {\r\n                  ${{ positionSizeUsdt() || 0 }} per exchange = ${{ (positionSizeUsdt() || 0) * 2 }} total\r\n                } @else {\r\n                  Single position margin\r\n                }\r\n              </p>\r\n            </div>\r\n\r\n            @if (arbitrageMode() === 'NON_HEDGED') {\r\n              <div class=\"form-group\">\r\n                <label class=\"form-label\">Take Profit (%)</label>\r\n                <input\r\n                  type=\"number\"\r\n                  class=\"form-input\"\r\n                  [ngModel]=\"dialogTakeProfitPercent()\"\r\n                  (ngModelChange)=\"dialogTakeProfitPercent.set($event)\"\r\n                  min=\"1\"\r\n                  max=\"100\"\r\n                  step=\"1\"\r\n                  placeholder=\"90\"\r\n                />\r\n                <p class=\"form-hint\">Take profit at {{ dialogTakeProfitPercent() }}% of expected funding</p>\r\n              </div>\r\n\r\n              <div class=\"form-group\">\r\n                <label class=\"form-label\">Stop Loss (%)</label>\r\n                <input\r\n                  type=\"number\"\r\n                  class=\"form-input\"\r\n                  [ngModel]=\"dialogStopLossPercent()\"\r\n                  (ngModelChange)=\"dialogStopLossPercent.set($event)\"\r\n                  min=\"1\"\r\n                  max=\"100\"\r\n                  step=\"1\"\r\n                  placeholder=\"20\"\r\n                />\r\n                <p class=\"form-hint\">Stop loss at {{ dialogStopLossPercent() }}% of expected funding</p>\r\n              </div>\r\n            }\r\n          </div>\r\n\r\n          <!-- Balance Information -->\r\n          @if (isLoadingBalances()) {\r\n            <div class=\"balance-info loading\">\r\n              <p>{{ translate('fundingRates.dialog.loadingBalances') || 'Loading balances...' }}</p>\r\n            </div>\r\n          } @else {\r\n            <div class=\"balance-info\">\r\n              <div class=\"balance-row\">\r\n                <span class=\"balance-label\">{{ translate('fundingRates.dialog.primary') }} Balance:</span>\r\n                <span class=\"balance-value\" [class.low-balance]=\"primaryBalance() !== null && primaryBalance()! < 10\">\r\n                  @if (primaryBalance() !== null) {\r\n                    ${{ primaryBalance()!.toFixed(2) }} USDT\r\n                  } @else {\r\n                    N/A\r\n                  }\r\n                </span>\r\n              </div>\r\n              @if (arbitrageMode() === 'HEDGED') {\r\n                <div class=\"balance-row\">\r\n                  <span class=\"balance-label\">{{ translate('fundingRates.dialog.hedge') }} Balance:</span>\r\n                  <span class=\"balance-value\" [class.low-balance]=\"hedgeBalance() !== null && hedgeBalance()! < 10 && hedgeBalance()! !== 999999\">\r\n                    @if (hedgeBalance() !== null) {\r\n                      @if (hedgeBalance() === 999999) {\r\n                        ‚àû ({{ translate('fundingRates.dialog.mockExchange') }})\r\n                      } @else {\r\n                        ${{ hedgeBalance()!.toFixed(2) }} USDT\r\n                      }\r\n                    } @else {\r\n                      N/A\r\n                    }\r\n                  </span>\r\n                </div>\r\n              }\r\n            </div>\r\n          }\r\n\r\n          <!-- Profit Calculation -->\r\n          @if (profitCalculation()) {\r\n            <div class=\"profit-calculation\">\r\n              <h4 class=\"profit-title\">Expected Profit</h4>\r\n              <div class=\"profit-grid\">\r\n                @if (arbitrageMode() === 'HEDGED') {\r\n                  <div class=\"profit-row\">\r\n                    <span class=\"profit-label\">Primary Funding:</span>\r\n                    <span class=\"profit-value positive\">${{ profitCalculation()!.primaryFunding.toFixed(4) }}</span>\r\n                  </div>\r\n                  <div class=\"profit-row\">\r\n                    <span class=\"profit-label\">Hedge Funding:</span>\r\n                    <span class=\"profit-value positive\">${{ profitCalculation()!.hedgeFunding.toFixed(4) }}</span>\r\n                  </div>\r\n                  <div class=\"profit-row\">\r\n                    <span class=\"profit-label\">Gross Profit:</span>\r\n                    <span class=\"profit-value\">${{ profitCalculation()!.grossProfit.toFixed(4) }}</span>\r\n                  </div>\r\n                } @else {\r\n                  <div class=\"profit-row\">\r\n                    <span class=\"profit-label\">Funding Payment:</span>\r\n                    <span class=\"profit-value positive\">${{ profitCalculation()!.primaryFunding.toFixed(4) }}</span>\r\n                  </div>\r\n                }\r\n                <div class=\"profit-row\">\r\n                  <span class=\"profit-label\">Est. Fees:</span>\r\n                  <span class=\"profit-value negative\">-${{ profitCalculation()!.estimatedFees.toFixed(4) }}</span>\r\n                </div>\r\n                <div class=\"profit-row important\">\r\n                  <span class=\"profit-label\">Net Profit:</span>\r\n                  <span class=\"profit-value\" [class.positive]=\"profitCalculation()!.netProfit > 0\" [class.negative]=\"profitCalculation()!.netProfit < 0\">\r\n                    ${{ profitCalculation()!.netProfit.toFixed(4) }}\r\n                  </span>\r\n                </div>\r\n                <div class=\"profit-row important\">\r\n                  <span class=\"profit-label\">ROI:</span>\r\n                  <span class=\"profit-value\" [class.positive]=\"profitCalculation()!.profitPercent > 0\" [class.negative]=\"profitCalculation()!.profitPercent < 0\">\r\n                    {{ profitCalculation()!.profitPercent.toFixed(2) }}%\r\n                  </span>\r\n                </div>\r\n              </div>\r\n              <p class=\"profit-note\">\r\n                üí° Expected profit per funding interval (~{{ arbitrageMode() === 'HEDGED' ? '8' : '0.5-8' }} hours)\r\n              </p>\r\n            </div>\r\n          }\r\n\r\n          <!-- Position Summary -->\r\n          @if (positionCalculation()) {\r\n            <div class=\"position-summary\">\r\n              <div class=\"summary-row\">\r\n                <span class=\"summary-label\">Position Type:</span>\r\n                <span class=\"summary-value\" [class.long-position]=\"parseFloat(selectedTicker()!.fundingRate) < 0\" [class.short-position]=\"parseFloat(selectedTicker()!.fundingRate) >= 0\">\r\n                  {{ parseFloat(selectedTicker()!.fundingRate) < 0 ? 'LONG' : 'SHORT' }}\r\n                  @if (arbitrageMode() === 'HEDGED') {\r\n                    + {{ parseFloat(selectedTicker()!.fundingRate) < 0 ? 'SHORT' : 'LONG' }} (hedge)\r\n                  }\r\n                </span>\r\n              </div>\r\n              <div class=\"summary-row\">\r\n                <span class=\"summary-label\">Quantity:</span>\r\n                <span class=\"summary-value\">{{ positionCalculation()!.quantity.toFixed(6) }} {{ positionCalculation()!.symbol.replace('USDT', '') }}</span>\r\n              </div>\r\n              <div class=\"summary-row\">\r\n                <span class=\"summary-label\">Position Value:</span>\r\n                <span class=\"summary-value\">\r\n                  ${{ positionCalculation()!.positionValue.toFixed(2) }} USDT\r\n                  @if (arbitrageMode() === 'HEDGED') {\r\n                    √ó 2 = ${{ (positionCalculation()!.positionValue * 2).toFixed(2) }}\r\n                  }\r\n                </span>\r\n              </div>\r\n            </div>\r\n          }\r\n        </div>\r\n\r\n        <div class=\"dialog-footer\">\r\n          <ui-button variant=\"ghost\" (clicked)=\"closeSubscriptionDialog()\">\r\n            {{ translate('fundingRates.actions.cancel') }}\r\n          </ui-button>\r\n          <ui-button\r\n            variant=\"primary\"\r\n            (clicked)=\"subscribeFundingRate()\"\r\n            [loading]=\"isSubscribing()\">\r\n            {{ editingSubscription() ? 'Save Changes' : translate('fundingRates.actions.subscribe') }}\r\n          </ui-button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  }\r\n\r\n  <!-- HEDGED Mode Start Dialog -->\r\n  @if (showHedgedDialog() && selectedHedgedOpportunity()) {\r\n    <div class=\"dialog-overlay\" (click)=\"closeHedgedDialog()\">\r\n      <div class=\"dialog-content hedged-dialog\" (click)=\"$event.stopPropagation()\">\r\n        <div class=\"dialog-header\">\r\n          <h3>{{ translate('fundingRates.hedged.title') || 'Start Hedged Arbitrage' }}</h3>\r\n          <button class=\"dialog-close\" (click)=\"closeHedgedDialog()\">√ó</button>\r\n        </div>\r\n\r\n        <div class=\"dialog-body\">\r\n          <!-- Basic Info -->\r\n          <div class=\"dialog-info\">\r\n            <div class=\"info-row\">\r\n              <span class=\"info-label\">{{ translate('arbitrage.table.symbol') }}:</span>\r\n              <span class=\"info-value\">{{ selectedHedgedOpportunity()!.symbol }}</span>\r\n            </div>\r\n            <div class=\"info-row\">\r\n              <span class=\"info-label\">{{ translate('arbitrage.table.spread') }}:</span>\r\n              <span class=\"info-value positive\">\r\n                {{ (parseFloat(selectedHedgedOpportunity()!.spread.toString()) * 100).toFixed(4) }}%\r\n              </span>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Exchange Configuration -->\r\n          <div class=\"exchanges-config\">\r\n            <!-- Primary Exchange Section -->\r\n            <div class=\"exchange-config-section\">\r\n              <div class=\"exchange-config-header\">\r\n                <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                  <path d=\"M21 16V8C20.9996 7.64927 20.9071 7.30481 20.7315 7.00116C20.556 6.69751 20.3037 6.44536 20 6.27L13 2.27C12.696 2.09446 12.3511 2.00205 12 2.00205C11.6489 2.00205 11.304 2.09446 11 2.27L4 6.27C3.69626 6.44536 3.44398 6.69751 3.26846 7.00116C3.09294 7.30481 3.00036 7.64927 3 8V16C3.00036 16.3507 3.09294 16.6952 3.26846 16.9988C3.44398 17.3025 3.69626 17.5546 4 17.73L11 21.73C11.304 21.9055 11.6489 21.9979 12 21.9979C12.3511 21.9979 12.696 21.9055 13 21.73L20 17.73C20.3037 17.5546 20.556 17.3025 20.7315 16.9988C20.9071 16.6952 20.9996 16.3507 21 16Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                  <path d=\"M3.27002 6.96L12 12.01L20.73 6.96\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                  <path d=\"M12 22.08V12\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                </svg>\r\n                <h4>{{ translate('arbitrage.table.primaryExchange') || 'Primary Exchange' }}</h4>\r\n              </div>\r\n\r\n              <!-- Primary Exchange Info (HIGH price - SHORT position) -->\r\n              @for (exchange of selectedHedgedOpportunity()!.exchanges; track exchange.exchange + exchange.credentialId) {\r\n                @if (exchange.exchange === selectedHedgedOpportunity()!.bestShort.exchange && exchange.credentialId === selectedHedgedOpportunity()!.bestShort.credentialId) {\r\n                  <div class=\"exchange-badge-info\">\r\n                    <span class=\"exchange-badge\" [class]=\"'badge-' + exchange.exchange.toLowerCase()\">\r\n                      {{ exchange.exchange }}\r\n                    </span>\r\n                    @if (exchange.lastPrice) {\r\n                      <span class=\"exchange-price-display\">\r\n                        Price: ${{ parseFloat(exchange.lastPrice).toFixed(3) }}\r\n                      </span>\r\n                    }\r\n                    <span class=\"exchange-funding\" [class.positive]=\"parseFloat(exchange.fundingRate) > 0\" [class.negative]=\"parseFloat(exchange.fundingRate) < 0\">\r\n                      Funding: {{ (parseFloat(exchange.fundingRate) * 100).toFixed(4) }}%\r\n                    </span>\r\n                  </div>\r\n                }\r\n              }\r\n\r\n              <!-- Primary Exchange Configuration -->\r\n              <div class=\"exchange-config-form\">\r\n                <div class=\"form-group\">\r\n                  <label class=\"form-label\">{{ translate('fundingRates.settings.leverage') }}</label>\r\n                  <input\r\n                    type=\"number\"\r\n                    class=\"form-input\"\r\n                    [ngModel]=\"hedgedPrimaryLeverage()\"\r\n                    (ngModelChange)=\"hedgedPrimaryLeverage.set($event)\"\r\n                    min=\"1\"\r\n                    max=\"125\"\r\n                    step=\"1\"\r\n                    placeholder=\"3\"\r\n                  />\r\n                  <p class=\"form-hint\">{{ hedgedPrimaryLeverage() }}x leverage for primary position</p>\r\n                </div>\r\n\r\n                <div class=\"form-group\">\r\n                  <label class=\"form-label\">{{ translate('fundingRates.dialog.margin') || 'Margin' }} (USDT)</label>\r\n                  <input\r\n                    type=\"number\"\r\n                    class=\"form-input\"\r\n                    [ngModel]=\"hedgedPrimaryMargin()\"\r\n                    (ngModelChange)=\"hedgedPrimaryMargin.set($event)\"\r\n                    step=\"10\"\r\n                    min=\"10\"\r\n                    placeholder=\"100\"\r\n                  />\r\n                  <p class=\"form-hint\">Margin for primary exchange position</p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- Hedge Exchange Section -->\r\n            <div class=\"exchange-config-section\">\r\n              <div class=\"exchange-config-header\">\r\n                <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                  <path d=\"M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                  <path d=\"M2 12H22\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                  <path d=\"M12 2C14.5013 4.73835 15.9228 8.29203 16 12C15.9228 15.708 14.5013 19.2616 12 22C9.49872 19.2616 8.07725 15.708 8 12C8.07725 8.29203 9.49872 4.73835 12 2Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                </svg>\r\n                <h4>{{ translate('arbitrage.table.hedgeExchange') || 'Hedge Exchange' }}</h4>\r\n              </div>\r\n\r\n              <!-- Hedge Exchange Info (LOW price - LONG position) -->\r\n              @for (exchange of selectedHedgedOpportunity()!.exchanges; track exchange.exchange + exchange.credentialId) {\r\n                @if (exchange.exchange === selectedHedgedOpportunity()!.bestLong.exchange && exchange.credentialId === selectedHedgedOpportunity()!.bestLong.credentialId) {\r\n                  <div class=\"exchange-badge-info\">\r\n                    <span class=\"exchange-badge\" [class]=\"'badge-' + exchange.exchange.toLowerCase()\">\r\n                      {{ exchange.exchange }}\r\n                    </span>\r\n                    @if (exchange.lastPrice) {\r\n                      <span class=\"exchange-price-display\">\r\n                        Price: ${{ parseFloat(exchange.lastPrice).toFixed(3) }}\r\n                      </span>\r\n                    }\r\n                    <span class=\"exchange-funding\" [class.positive]=\"parseFloat(exchange.fundingRate) > 0\" [class.negative]=\"parseFloat(exchange.fundingRate) < 0\">\r\n                      Funding: {{ (parseFloat(exchange.fundingRate) * 100).toFixed(4) }}%\r\n                    </span>\r\n                  </div>\r\n                }\r\n              }\r\n\r\n              <!-- Hedge Exchange Configuration -->\r\n              <div class=\"exchange-config-form\">\r\n                <div class=\"form-group\">\r\n                  <label class=\"form-label\">{{ translate('fundingRates.settings.leverage') }}</label>\r\n                  <input\r\n                    type=\"number\"\r\n                    class=\"form-input\"\r\n                    [ngModel]=\"hedgedHedgeLeverage()\"\r\n                    (ngModelChange)=\"hedgedHedgeLeverage.set($event)\"\r\n                    min=\"1\"\r\n                    max=\"125\"\r\n                    step=\"1\"\r\n                    placeholder=\"3\"\r\n                  />\r\n                  <p class=\"form-hint\">{{ hedgedHedgeLeverage() }}x leverage for hedge position</p>\r\n                </div>\r\n\r\n                <div class=\"form-group\">\r\n                  <label class=\"form-label\">{{ translate('fundingRates.dialog.margin') || 'Margin' }} (USDT)</label>\r\n                  <input\r\n                    type=\"number\"\r\n                    class=\"form-input\"\r\n                    [ngModel]=\"hedgedHedgeMargin()\"\r\n                    (ngModelChange)=\"hedgedHedgeMargin.set($event)\"\r\n                    step=\"10\"\r\n                    min=\"10\"\r\n                    placeholder=\"100\"\r\n                  />\r\n                  <p class=\"form-hint\">Margin for hedge exchange position</p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Total Summary -->\r\n          <div class=\"total-summary\">\r\n            <div class=\"summary-row total\">\r\n              <span class=\"summary-label\">{{ translate('fundingRates.hedged.totalMargin') || 'Total Margin Required' }}:</span>\r\n              <span class=\"summary-value\">${{ (hedgedPrimaryMargin() + hedgedHedgeMargin()).toFixed(2) }} USDT</span>\r\n            </div>\r\n            <p class=\"summary-note\">\r\n              üí° {{ translate('fundingRates.hedged.note') || 'Positions will be opened simultaneously on both exchanges without delays' }}\r\n            </p>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"dialog-footer\">\r\n          <ui-button variant=\"ghost\" (clicked)=\"closeHedgedDialog()\">\r\n            {{ translate('fundingRates.actions.cancel') }}\r\n          </ui-button>\r\n          <ui-button\r\n            variant=\"primary\"\r\n            (clicked)=\"executeHedgedArbitrage()\"\r\n            [loading]=\"isStartingHedged()\">\r\n            {{ translate('fundingRates.actions.start') || 'Start' }}\r\n          </ui-button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  }\r\n\r\n  <!-- Toast Notifications -->\r\n  @if (notifications().length > 0) {\r\n    <div class=\"notifications-container\">\r\n      @for (notification of notifications(); track notification) {\r\n        <div class=\"notification-toast\"\r\n             [class.success]=\"notification.includes('[SUCCESS]')\"\r\n             [class.error]=\"notification.includes('[ERROR]')\"\r\n             [class.info]=\"notification.includes('[INFO]')\">\r\n          {{ notification.replace('[SUCCESS] ', '').replace('[ERROR] ', '').replace('[INFO] ', '') }}\r\n        </div>\r\n      }\r\n    </div>\r\n  }\r\n\r\n  <!-- Settings Dialog -->\r\n  @if (showSettingsDialog()) {\r\n    <div class=\"settings-overlay\" (click)=\"closeSettingsDialog()\">\r\n      <div class=\"settings-modal\" (click)=\"$event.stopPropagation()\">\r\n        <!-- Header with Gradient -->\r\n        <div class=\"settings-header\">\r\n          <div class=\"settings-header-content\">\r\n            <div class=\"settings-icon\">\r\n              <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                <path d=\"M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                <path d=\"M19.4 15C19.2669 15.3016 19.2272 15.6362 19.286 15.9606C19.3448 16.285 19.4995 16.5843 19.73 16.82L19.79 16.88C19.976 17.0657 20.1235 17.2863 20.2241 17.5291C20.3248 17.7719 20.3766 18.0322 20.3766 18.295C20.3766 18.5578 20.3248 18.8181 20.2241 19.0609C20.1235 19.3037 19.976 19.5243 19.79 19.71C19.6043 19.896 19.3837 20.0435 19.1409 20.1441C18.8981 20.2448 18.6378 20.2966 18.375 20.2966C18.1122 20.2966 17.8519 20.2448 17.6091 20.1441C17.3663 20.0435 17.1457 19.896 16.96 19.71L16.9 19.65C16.6643 19.4195 16.365 19.2648 16.0406 19.206C15.7162 19.1472 15.3816 19.1869 15.08 19.32C14.7842 19.4468 14.532 19.6572 14.3543 19.9255C14.1766 20.1938 14.0813 20.5082 14.08 20.83V21C14.08 21.5304 13.8693 22.0391 13.4942 22.4142C13.1191 22.7893 12.6104 23 12.08 23C11.5496 23 11.0409 22.7893 10.6658 22.4142C10.2907 22.0391 10.08 21.5304 10.08 21V20.91C10.0723 20.579 9.96512 20.258 9.77251 19.9887C9.5799 19.7194 9.31074 19.5143 9 19.4C8.69838 19.2669 8.36381 19.2272 8.03941 19.286C7.71502 19.3448 7.41568 19.4995 7.18 19.73L7.12 19.79C6.93425 19.976 6.71368 20.1235 6.47088 20.2241C6.22808 20.3248 5.96783 20.3766 5.705 20.3766C5.44217 20.3766 5.18192 20.3248 4.93912 20.2241C4.69632 20.1235 4.47575 19.976 4.29 19.79C4.10405 19.6043 3.95653 19.3837 3.85588 19.1409C3.75523 18.8981 3.70343 18.6378 3.70343 18.375C3.70343 18.1122 3.75523 17.8519 3.85588 17.6091C3.95653 17.3663 4.10405 17.1457 4.29 16.96L4.35 16.9C4.58054 16.6643 4.73519 16.365 4.794 16.0406C4.85282 15.7162 4.81312 15.3816 4.68 15.08C4.55324 14.7842 4.34276 14.532 4.07447 14.3543C3.80618 14.1766 3.49179 14.0813 3.17 14.08H3C2.46957 14.08 1.96086 13.8693 1.58579 13.4942C1.21071 13.1191 1 12.6104 1 12.08C1 11.5496 1.21071 11.0409 1.58579 10.6658C1.96086 10.2907 2.46957 10.08 3 10.08H3.09C3.42099 10.0723 3.742 9.96512 4.0113 9.77251C4.28059 9.5799 4.48572 9.31074 4.6 9C4.73312 8.69838 4.77282 8.36381 4.714 8.03941C4.65519 7.71502 4.50054 7.41568 4.27 7.18L4.21 7.12C4.02405 6.93425 3.87653 6.71368 3.77588 6.47088C3.67523 6.22808 3.62343 5.96783 3.62343 5.705C3.62343 5.44217 3.67523 5.18192 3.77588 4.93912C3.87653 4.69632 4.02405 4.47575 4.21 4.29C4.39575 4.10405 4.61632 3.95653 4.85912 3.85588C5.10192 3.75523 5.36217 3.70343 5.625 3.70343C5.88783 3.70343 6.14808 3.75523 6.39088 3.85588C6.63368 3.95653 6.85425 4.10405 7.04 4.29L7.1 4.35C7.33568 4.58054 7.63502 4.73519 7.95941 4.794C8.28381 4.85282 8.61838 4.81312 8.92 4.68H9C9.29577 4.55324 9.54802 4.34276 9.72569 4.07447C9.90337 3.80618 9.99872 3.49179 10 3.17V3C10 2.46957 10.2107 1.96086 10.5858 1.58579C10.9609 1.21071 11.4696 1 12 1C12.5304 1 13.0391 1.21071 13.4142 1.58579C13.7893 1.96086 14 2.46957 14 3V3.09C14.0013 3.41179 14.0966 3.72618 14.2743 3.99447C14.452 4.26276 14.7042 4.47324 15 4.6C15.3016 4.73312 15.6362 4.77282 15.9606 4.714C16.285 4.65519 16.5843 4.50054 16.82 4.27L16.88 4.21C17.0657 4.02405 17.2863 3.87653 17.5291 3.77588C17.7719 3.67523 18.0322 3.62343 18.295 3.62343C18.5578 3.62343 18.8181 3.67523 19.0609 3.77588C19.3037 3.87653 19.5243 4.02405 19.71 4.21C19.896 4.39575 20.0435 4.61632 20.1441 4.85912C20.2448 5.10192 20.2966 5.36217 20.2966 5.625C20.2966 5.88783 20.2448 6.14808 20.1441 6.39088C20.0435 6.63368 19.896 6.85425 19.71 7.04L19.65 7.1C19.4195 7.33568 19.2648 7.63502 19.206 7.95941C19.1472 8.28381 19.1869 8.61838 19.32 8.92V9C19.4468 9.29577 19.6572 9.54802 19.9255 9.72569C20.1938 9.90337 20.5082 9.99872 20.83 10H21C21.5304 10 22.0391 10.2107 22.4142 10.5858C22.7893 10.9609 23 11.4696 23 12C23 12.5304 22.7893 13.0391 22.4142 13.4142C22.0391 13.7893 21.5304 14 21 14H20.91C20.5882 14.0013 20.2738 14.0966 20.0055 14.2743C19.7372 14.452 19.5268 14.7042 19.4 15Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n              </svg>\r\n            </div>\r\n            <h3 class=\"settings-title\">{{ translate('fundingRates.settings.title') }}</h3>\r\n          </div>\r\n          <button class=\"settings-close\" (click)=\"closeSettingsDialog()\" aria-label=\"Close\">\r\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n              <path d=\"M18 6L6 18M6 6L18 18\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n            </svg>\r\n          </button>\r\n        </div>\r\n\r\n        <!-- Body with Organized Sections -->\r\n        <div class=\"settings-body\">\r\n          <!-- Trading Configuration Section -->\r\n          <div class=\"settings-section\">\r\n            <div class=\"section-header\">\r\n              <svg class=\"section-icon\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                <path d=\"M16 21V5C16 4.46957 15.7893 3.96086 15.4142 3.58579C15.0391 3.21071 14.5304 3 14 3H10C9.46957 3 8.96086 3.21071 8.58579 3.58579C8.21071 3.96086 8 4.46957 8 5V21M4 7H20M4 15H20M3 21H21\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n              </svg>\r\n              <h4 class=\"section-title\">Trading Configuration</h4>\r\n            </div>\r\n\r\n            <!-- Default Quantity -->\r\n            <div class=\"settings-field\">\r\n              <label class=\"field-label\">\r\n                <svg class=\"field-icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                  <path d=\"M12 2V22M17 5H9.5C8.57174 5 7.6815 5.36875 7.02513 6.02513C6.36875 6.6815 6 7.57174 6 8.5C6 9.42826 6.36875 10.3185 7.02513 10.9749C7.6815 11.6313 8.57174 12 9.5 12H14.5C15.4283 12 16.3185 12.3687 16.9749 13.0251C17.6313 13.6815 18 14.5717 18 15.5C18 16.4283 17.6313 17.3185 16.9749 17.9749C16.3185 18.6313 15.4283 19 14.5 19H6\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                </svg>\r\n                {{ translate('fundingRates.settings.defaultQuantity') }} ({{ translate('fundingRates.dialog.coins') }})\r\n              </label>\r\n              <input\r\n                type=\"number\"\r\n                class=\"field-input\"\r\n                [(ngModel)]=\"subscriptionSettings().defaultQuantity\"\r\n                step=\"0.001\"\r\n                min=\"0.001\"\r\n                placeholder=\"0.01\"\r\n                aria-label=\"Default quantity\">\r\n              <p class=\"field-help\">{{ translate('fundingRates.settings.defaultQuantityHelp') }}</p>\r\n            </div>\r\n\r\n            <!-- Leverage -->\r\n            <div class=\"settings-field\">\r\n              <label class=\"field-label\">\r\n                <svg class=\"field-icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                  <path d=\"M13 2L3 14H12L11 22L21 10H12L13 2Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                </svg>\r\n                {{ translate('fundingRates.settings.leverage') }}\r\n              </label>\r\n              <input\r\n                type=\"number\"\r\n                class=\"field-input\"\r\n                [(ngModel)]=\"subscriptionSettings().leverage\"\r\n                min=\"1\"\r\n                max=\"20\"\r\n                step=\"1\"\r\n                placeholder=\"3\"\r\n                aria-label=\"Leverage\">\r\n              <p class=\"field-help\">{{ translate('fundingRates.settings.leverageHelp') }}</p>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Auto-Cancel Configuration Section -->\r\n          <div class=\"settings-section\">\r\n            <div class=\"section-header\">\r\n              <svg class=\"section-icon\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                <path d=\"M12 8V12L15 15M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n              </svg>\r\n              <h4 class=\"section-title\">Auto-Cancel Settings</h4>\r\n            </div>\r\n\r\n            <!-- Auto-Cancel Toggle -->\r\n            <div class=\"settings-field\">\r\n              <label class=\"field-checkbox\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  [(ngModel)]=\"subscriptionSettings().enableAutoCancel\"\r\n                  class=\"checkbox-input\">\r\n                <span class=\"checkbox-custom\"></span>\r\n                <span class=\"checkbox-label\">{{ translate('fundingRates.settings.enableAutoCancel') }}</span>\r\n              </label>\r\n              <p class=\"field-help\">{{ translate('fundingRates.settings.autoCancelHelp') }}</p>\r\n            </div>\r\n\r\n            <!-- Auto-Cancel Threshold (only show if enabled) -->\r\n            @if (subscriptionSettings().enableAutoCancel) {\r\n              <div class=\"settings-field\">\r\n                <label class=\"field-label\">\r\n                  <svg class=\"field-icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                    <path d=\"M22 11.08V12C21.9988 14.1564 21.3005 16.2547 20.0093 17.9818C18.7182 19.7088 16.9033 20.9725 14.8354 21.5839C12.7674 22.1953 10.5573 22.1219 8.53447 21.3746C6.51168 20.6273 4.78465 19.2461 3.61096 17.4371C2.43727 15.628 1.87979 13.4881 2.02168 11.3363C2.16356 9.18455 2.99721 7.13631 4.39828 5.49706C5.79935 3.85781 7.69279 2.71537 9.79619 2.24013C11.8996 1.76489 14.1003 1.98232 16.07 2.86\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                    <path d=\"M22 4L12 14.01L9 11.01\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                  </svg>\r\n                  {{ translate('fundingRates.settings.autoCancelThreshold') }} (%)\r\n                </label>\r\n                <input\r\n                  type=\"number\"\r\n                  class=\"field-input\"\r\n                  [(ngModel)]=\"subscriptionSettings().autoCancelThreshold\"\r\n                  step=\"0.0001\"\r\n                  placeholder=\"0.01\"\r\n                  aria-label=\"Auto-cancel threshold\">\r\n                <p class=\"field-help\">{{ translate('fundingRates.settings.autoCancelThresholdHelp') }}</p>\r\n              </div>\r\n            }\r\n          </div>\r\n\r\n          <!-- Execution Settings Section -->\r\n          <div class=\"settings-section\">\r\n            <div class=\"section-header\">\r\n              <svg class=\"section-icon\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                <path d=\"M13 2L3 14H12L11 22L21 10H12L13 2Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n              </svg>\r\n              <h4 class=\"section-title\">Execution Settings</h4>\r\n            </div>\r\n\r\n            <!-- Execution Delay -->\r\n            <div class=\"settings-field\">\r\n              <label class=\"field-label\">\r\n                <svg class=\"field-icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                  <path d=\"M12 6V12L16 14\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                  <path d=\"M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                </svg>\r\n                {{ translate('fundingRates.settings.executionDelay') }} ({{ translate('fundingRates.dialog.seconds') }})\r\n              </label>\r\n              <input\r\n                type=\"number\"\r\n                class=\"field-input\"\r\n                [(ngModel)]=\"subscriptionSettings().executionDelay\"\r\n                min=\"1\"\r\n                max=\"60\"\r\n                step=\"1\"\r\n                placeholder=\"5\"\r\n                aria-label=\"Execution delay\">\r\n              <p class=\"field-help\">{{ translate('fundingRates.settings.executionDelayHelp') }}</p>\r\n            </div>\r\n\r\n            <!-- Arbitrage Spread Threshold -->\r\n            <div class=\"settings-field\">\r\n              <label class=\"field-label\">\r\n                <svg class=\"field-icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                  <path d=\"M3 3V21M21 21V3M7 8H17M7 12H17M7 16H17\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                </svg>\r\n                {{ translate('fundingRates.settings.arbitrageSpreadThreshold') }} (%)\r\n              </label>\r\n              <input\r\n                type=\"number\"\r\n                class=\"field-input\"\r\n                [(ngModel)]=\"subscriptionSettings().arbitrageSpreadThreshold\"\r\n                step=\"0.001\"\r\n                min=\"0\"\r\n                placeholder=\"0.01\"\r\n                aria-label=\"Arbitrage spread threshold\">\r\n              <p class=\"field-help\">{{ translate('fundingRates.settings.arbitrageSpreadThresholdHelp') }}</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Footer with Action Buttons -->\r\n        <div class=\"settings-footer\">\r\n          <ui-button\r\n            variant=\"ghost\"\r\n            (clicked)=\"closeSettingsDialog()\">\r\n            {{ translate('fundingRates.actions.cancel') }}\r\n          </ui-button>\r\n          <ui-button\r\n            variant=\"primary\"\r\n            (clicked)=\"saveSettings()\">\r\n            <span class=\"button-with-icon\">\r\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                <path d=\"M19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H16L21 8V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                <path d=\"M17 21V13H7V21M7 3V8H15\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n              </svg>\r\n              {{ translate('fundingRates.actions.save') }}\r\n            </span>\r\n          </ui-button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  }\r\n\r\n  <!-- Trade History Dialog -->\r\n  <app-trade-history\r\n    [open]=\"showTradeHistoryDialog()\"\r\n    [initialSymbol]=\"tradeHistorySymbol() || ''\"\r\n    [initialExchange]=\"tradeHistoryExchange() || ''\"\r\n    (openChange)=\"showTradeHistoryDialog.set($event)\">\r\n  </app-trade-history>\r\n\r\n  <!-- Bybit Strategy Modal -->\r\n  @if (bybitStrategyModalData()) {\r\n    <app-start-bybit-strategy-modal\r\n      [isOpen]=\"showBybitStrategyModal()\"\r\n      [data]=\"bybitStrategyModalData()!\"\r\n      (close)=\"closeBybitStrategyModal()\"\r\n      (strategyStarted)=\"onStrategyStarted()\">\r\n    </app-start-bybit-strategy-modal>\r\n  }\r\n</div>\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\trading\\funding-rates\\funding-rates.component.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'TradeHistoryDialogData' is defined but never used.","line":19,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":19,"endColumn":55},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":256,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":256,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9662,9665],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9662,9665],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":414,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":414,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16588,16591],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16588,16591],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":415,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":415,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16644,16647],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16644,16647],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":507,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":507,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19637,19640],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19637,19640],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":508,"column":40,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":508,"endColumn":74},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .nextFundingTime on an `any` value.","line":508,"column":49,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":508,"endColumn":64},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":557,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":557,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21522,21525],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21522,21525],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":558,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":558,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21546,21549],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21546,21549],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":583,"column":13,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":592,"endColumn":15,"suggestions":[{"messageId":"addBrackets","fix":{"range":[22467,23040],"text":"{ const parseTime = (periodicity: string | undefined): number => {\r\n              if (!periodicity) return 0;\r\n              const match = periodicity.match(/(\\d+)–≥\\s+(\\d+)—Ö–≤/);\r\n              if (match) {\r\n                const hours = parseInt(match[1], 10);\r\n                const minutes = parseInt(match[2], 10);\r\n                return hours * 60 + minutes; // Convert to total minutes\r\n              }\r\n              return 0;\r\n            };\r\n            aVal = parseTime(a.fundingPeriodicity);\r\n            bVal = parseTime(b.fundingPeriodicity);\r\n            break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":605,"column":13,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":605,"endColumn":47,"suggestions":[{"messageId":"addBrackets","fix":{"range":[23485,24450],"text":"{ const mode = this.arbitrageMode();\r\n\r\n            if (mode === 'NON_HEDGED') {\r\n              // Find exchange with maximum absolute funding rate\r\n              const aLongRate = parseFloat(a.bestLong?.fundingRate || '0');\r\n              const aShortRate = parseFloat(a.bestShort?.fundingRate || '0');\r\n              const bLongRate = parseFloat(b.bestLong?.fundingRate || '0');\r\n              const bShortRate = parseFloat(b.bestShort?.fundingRate || '0');\r\n\r\n              // Use the rate with higher absolute value, keeping the sign\r\n              aVal = Math.abs(aLongRate) >= Math.abs(aShortRate) ? aLongRate : aShortRate;\r\n              bVal = Math.abs(bLongRate) >= Math.abs(bShortRate) ? bLongRate : bShortRate;\r\n            } else {\r\n              // HEDGED mode: use bestLong funding rate\r\n              aVal = parseFloat(a.bestLong?.fundingRate || '0');\r\n              bVal = parseFloat(b.bestLong?.fundingRate || '0');\r\n            }\r\n            break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":626,"column":13,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":626,"endColumn":83,"suggestions":[{"messageId":"addBrackets","fix":{"range":[24656,25904],"text":"{ const aAbsLong = Math.abs(parseFloat(a.bestLong?.fundingRate || '0'));\r\n            const aAbsShort = Math.abs(parseFloat(a.bestShort?.fundingRate || '0'));\r\n            const bAbsLong = Math.abs(parseFloat(b.bestLong?.fundingRate || '0'));\r\n            const bAbsShort = Math.abs(parseFloat(b.bestShort?.fundingRate || '0'));\r\n\r\n            // Determine which exchange to use for each opportunity (matches UI display logic)\r\n            const useALong = aAbsLong >= aAbsShort;\r\n            const useBLong = bAbsLong >= bAbsShort;\r\n\r\n            const aExchange = a.exchanges?.find((ex: any) =>\r\n              ex.exchange === (useALong ? a.bestLong?.exchange : a.bestShort?.exchange) &&\r\n              ex.credentialId === (useALong ? a.bestLong?.credentialId : a.bestShort?.credentialId)\r\n            );\r\n            const bExchange = b.exchanges?.find((ex: any) =>\r\n              ex.exchange === (useBLong ? b.bestLong?.exchange : b.bestShort?.exchange) &&\r\n              ex.credentialId === (useBLong ? b.bestLong?.credentialId : b.bestShort?.credentialId)\r\n            );\r\n            aVal = parseInt(aExchange?.nextFundingTime?.toString() || '0');\r\n            bVal = parseInt(bExchange?.nextFundingTime?.toString() || '0');\r\n            break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":627,"column":13,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":627,"endColumn":85,"suggestions":[{"messageId":"addBrackets","fix":{"range":[24656,25904],"text":"{ const aAbsLong = Math.abs(parseFloat(a.bestLong?.fundingRate || '0'));\r\n            const aAbsShort = Math.abs(parseFloat(a.bestShort?.fundingRate || '0'));\r\n            const bAbsLong = Math.abs(parseFloat(b.bestLong?.fundingRate || '0'));\r\n            const bAbsShort = Math.abs(parseFloat(b.bestShort?.fundingRate || '0'));\r\n\r\n            // Determine which exchange to use for each opportunity (matches UI display logic)\r\n            const useALong = aAbsLong >= aAbsShort;\r\n            const useBLong = bAbsLong >= bAbsShort;\r\n\r\n            const aExchange = a.exchanges?.find((ex: any) =>\r\n              ex.exchange === (useALong ? a.bestLong?.exchange : a.bestShort?.exchange) &&\r\n              ex.credentialId === (useALong ? a.bestLong?.credentialId : a.bestShort?.credentialId)\r\n            );\r\n            const bExchange = b.exchanges?.find((ex: any) =>\r\n              ex.exchange === (useBLong ? b.bestLong?.exchange : b.bestShort?.exchange) &&\r\n              ex.credentialId === (useBLong ? b.bestLong?.credentialId : b.bestShort?.credentialId)\r\n            );\r\n            aVal = parseInt(aExchange?.nextFundingTime?.toString() || '0');\r\n            bVal = parseInt(bExchange?.nextFundingTime?.toString() || '0');\r\n            break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":628,"column":13,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":628,"endColumn":83,"suggestions":[{"messageId":"addBrackets","fix":{"range":[24656,25904],"text":"{ const aAbsLong = Math.abs(parseFloat(a.bestLong?.fundingRate || '0'));\r\n            const aAbsShort = Math.abs(parseFloat(a.bestShort?.fundingRate || '0'));\r\n            const bAbsLong = Math.abs(parseFloat(b.bestLong?.fundingRate || '0'));\r\n            const bAbsShort = Math.abs(parseFloat(b.bestShort?.fundingRate || '0'));\r\n\r\n            // Determine which exchange to use for each opportunity (matches UI display logic)\r\n            const useALong = aAbsLong >= aAbsShort;\r\n            const useBLong = bAbsLong >= bAbsShort;\r\n\r\n            const aExchange = a.exchanges?.find((ex: any) =>\r\n              ex.exchange === (useALong ? a.bestLong?.exchange : a.bestShort?.exchange) &&\r\n              ex.credentialId === (useALong ? a.bestLong?.credentialId : a.bestShort?.credentialId)\r\n            );\r\n            const bExchange = b.exchanges?.find((ex: any) =>\r\n              ex.exchange === (useBLong ? b.bestLong?.exchange : b.bestShort?.exchange) &&\r\n              ex.credentialId === (useBLong ? b.bestLong?.credentialId : b.bestShort?.credentialId)\r\n            );\r\n            aVal = parseInt(aExchange?.nextFundingTime?.toString() || '0');\r\n            bVal = parseInt(bExchange?.nextFundingTime?.toString() || '0');\r\n            break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":629,"column":13,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":629,"endColumn":85,"suggestions":[{"messageId":"addBrackets","fix":{"range":[24656,25904],"text":"{ const aAbsLong = Math.abs(parseFloat(a.bestLong?.fundingRate || '0'));\r\n            const aAbsShort = Math.abs(parseFloat(a.bestShort?.fundingRate || '0'));\r\n            const bAbsLong = Math.abs(parseFloat(b.bestLong?.fundingRate || '0'));\r\n            const bAbsShort = Math.abs(parseFloat(b.bestShort?.fundingRate || '0'));\r\n\r\n            // Determine which exchange to use for each opportunity (matches UI display logic)\r\n            const useALong = aAbsLong >= aAbsShort;\r\n            const useBLong = bAbsLong >= bAbsShort;\r\n\r\n            const aExchange = a.exchanges?.find((ex: any) =>\r\n              ex.exchange === (useALong ? a.bestLong?.exchange : a.bestShort?.exchange) &&\r\n              ex.credentialId === (useALong ? a.bestLong?.credentialId : a.bestShort?.credentialId)\r\n            );\r\n            const bExchange = b.exchanges?.find((ex: any) =>\r\n              ex.exchange === (useBLong ? b.bestLong?.exchange : b.bestShort?.exchange) &&\r\n              ex.credentialId === (useBLong ? b.bestLong?.credentialId : b.bestShort?.credentialId)\r\n            );\r\n            aVal = parseInt(aExchange?.nextFundingTime?.toString() || '0');\r\n            bVal = parseInt(bExchange?.nextFundingTime?.toString() || '0');\r\n            break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":632,"column":13,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":632,"endColumn":52,"suggestions":[{"messageId":"addBrackets","fix":{"range":[24656,25904],"text":"{ const aAbsLong = Math.abs(parseFloat(a.bestLong?.fundingRate || '0'));\r\n            const aAbsShort = Math.abs(parseFloat(a.bestShort?.fundingRate || '0'));\r\n            const bAbsLong = Math.abs(parseFloat(b.bestLong?.fundingRate || '0'));\r\n            const bAbsShort = Math.abs(parseFloat(b.bestShort?.fundingRate || '0'));\r\n\r\n            // Determine which exchange to use for each opportunity (matches UI display logic)\r\n            const useALong = aAbsLong >= aAbsShort;\r\n            const useBLong = bAbsLong >= bAbsShort;\r\n\r\n            const aExchange = a.exchanges?.find((ex: any) =>\r\n              ex.exchange === (useALong ? a.bestLong?.exchange : a.bestShort?.exchange) &&\r\n              ex.credentialId === (useALong ? a.bestLong?.credentialId : a.bestShort?.credentialId)\r\n            );\r\n            const bExchange = b.exchanges?.find((ex: any) =>\r\n              ex.exchange === (useBLong ? b.bestLong?.exchange : b.bestShort?.exchange) &&\r\n              ex.credentialId === (useBLong ? b.bestLong?.credentialId : b.bestShort?.credentialId)\r\n            );\r\n            aVal = parseInt(aExchange?.nextFundingTime?.toString() || '0');\r\n            bVal = parseInt(bExchange?.nextFundingTime?.toString() || '0');\r\n            break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":633,"column":13,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":633,"endColumn":52,"suggestions":[{"messageId":"addBrackets","fix":{"range":[24656,25904],"text":"{ const aAbsLong = Math.abs(parseFloat(a.bestLong?.fundingRate || '0'));\r\n            const aAbsShort = Math.abs(parseFloat(a.bestShort?.fundingRate || '0'));\r\n            const bAbsLong = Math.abs(parseFloat(b.bestLong?.fundingRate || '0'));\r\n            const bAbsShort = Math.abs(parseFloat(b.bestShort?.fundingRate || '0'));\r\n\r\n            // Determine which exchange to use for each opportunity (matches UI display logic)\r\n            const useALong = aAbsLong >= aAbsShort;\r\n            const useBLong = bAbsLong >= bAbsShort;\r\n\r\n            const aExchange = a.exchanges?.find((ex: any) =>\r\n              ex.exchange === (useALong ? a.bestLong?.exchange : a.bestShort?.exchange) &&\r\n              ex.credentialId === (useALong ? a.bestLong?.credentialId : a.bestShort?.credentialId)\r\n            );\r\n            const bExchange = b.exchanges?.find((ex: any) =>\r\n              ex.exchange === (useBLong ? b.bestLong?.exchange : b.bestShort?.exchange) &&\r\n              ex.credentialId === (useBLong ? b.bestLong?.credentialId : b.bestShort?.credentialId)\r\n            );\r\n            aVal = parseInt(aExchange?.nextFundingTime?.toString() || '0');\r\n            bVal = parseInt(bExchange?.nextFundingTime?.toString() || '0');\r\n            break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":635,"column":13,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":638,"endColumn":15,"suggestions":[{"messageId":"addBrackets","fix":{"range":[24656,25904],"text":"{ const aAbsLong = Math.abs(parseFloat(a.bestLong?.fundingRate || '0'));\r\n            const aAbsShort = Math.abs(parseFloat(a.bestShort?.fundingRate || '0'));\r\n            const bAbsLong = Math.abs(parseFloat(b.bestLong?.fundingRate || '0'));\r\n            const bAbsShort = Math.abs(parseFloat(b.bestShort?.fundingRate || '0'));\r\n\r\n            // Determine which exchange to use for each opportunity (matches UI display logic)\r\n            const useALong = aAbsLong >= aAbsShort;\r\n            const useBLong = bAbsLong >= bAbsShort;\r\n\r\n            const aExchange = a.exchanges?.find((ex: any) =>\r\n              ex.exchange === (useALong ? a.bestLong?.exchange : a.bestShort?.exchange) &&\r\n              ex.credentialId === (useALong ? a.bestLong?.credentialId : a.bestShort?.credentialId)\r\n            );\r\n            const bExchange = b.exchanges?.find((ex: any) =>\r\n              ex.exchange === (useBLong ? b.bestLong?.exchange : b.bestShort?.exchange) &&\r\n              ex.credentialId === (useBLong ? b.bestLong?.credentialId : b.bestShort?.credentialId)\r\n            );\r\n            aVal = parseInt(aExchange?.nextFundingTime?.toString() || '0');\r\n            bVal = parseInt(bExchange?.nextFundingTime?.toString() || '0');\r\n            break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":635,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":635,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25243,25246],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25243,25246],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exchange on an `any` value.","line":636,"column":18,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":636,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .credentialId on an `any` value.","line":637,"column":18,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":637,"endColumn":30},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":639,"column":13,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":642,"endColumn":15,"suggestions":[{"messageId":"addBrackets","fix":{"range":[24656,25904],"text":"{ const aAbsLong = Math.abs(parseFloat(a.bestLong?.fundingRate || '0'));\r\n            const aAbsShort = Math.abs(parseFloat(a.bestShort?.fundingRate || '0'));\r\n            const bAbsLong = Math.abs(parseFloat(b.bestLong?.fundingRate || '0'));\r\n            const bAbsShort = Math.abs(parseFloat(b.bestShort?.fundingRate || '0'));\r\n\r\n            // Determine which exchange to use for each opportunity (matches UI display logic)\r\n            const useALong = aAbsLong >= aAbsShort;\r\n            const useBLong = bAbsLong >= bAbsShort;\r\n\r\n            const aExchange = a.exchanges?.find((ex: any) =>\r\n              ex.exchange === (useALong ? a.bestLong?.exchange : a.bestShort?.exchange) &&\r\n              ex.credentialId === (useALong ? a.bestLong?.credentialId : a.bestShort?.credentialId)\r\n            );\r\n            const bExchange = b.exchanges?.find((ex: any) =>\r\n              ex.exchange === (useBLong ? b.bestLong?.exchange : b.bestShort?.exchange) &&\r\n              ex.credentialId === (useBLong ? b.bestLong?.credentialId : b.bestShort?.credentialId)\r\n            );\r\n            aVal = parseInt(aExchange?.nextFundingTime?.toString() || '0');\r\n            bVal = parseInt(bExchange?.nextFundingTime?.toString() || '0');\r\n            break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":639,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":639,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25514,25517],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25514,25517],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exchange on an `any` value.","line":640,"column":18,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":640,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .credentialId on an `any` value.","line":641,"column":18,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":641,"endColumn":30},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":648,"column":13,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":648,"endColumn":73,"suggestions":[{"messageId":"addBrackets","fix":{"range":[26022,26282],"text":"{ const aFunding = parseFloat(a.bestLong?.fundingRate || '0');\r\n            const bFunding = parseFloat(b.bestLong?.fundingRate || '0');\r\n            aVal = aFunding < 0 ? 'LONG' : 'SHORT';\r\n            bVal = bFunding < 0 ? 'LONG' : 'SHORT';\r\n            break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":649,"column":13,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":649,"endColumn":73,"suggestions":[{"messageId":"addBrackets","fix":{"range":[26022,26282],"text":"{ const aFunding = parseFloat(a.bestLong?.fundingRate || '0');\r\n            const bFunding = parseFloat(b.bestLong?.fundingRate || '0');\r\n            aVal = aFunding < 0 ? 'LONG' : 'SHORT';\r\n            bVal = bFunding < 0 ? 'LONG' : 'SHORT';\r\n            break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":947,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":947,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[36471,36474],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[36471,36474],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .success on an `any` value.","line":952,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":952,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":952,"column":44,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":952,"endColumn":48},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":954,"column":19,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":954,"endColumn":69},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":954,"column":47,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":954,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":958,"column":19,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":960,"endColumn":14},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":958,"column":39,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":958,"endColumn":62},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .filter on an `any` value.","line":958,"column":56,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":958,"endColumn":62},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":966,"column":19,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":966,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access [0] on an `any` value.","line":966,"column":51,"nodeType":"Literal","messageId":"unsafeMemberExpression","endLine":966,"endColumn":52},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .id on an `any` value.","line":968,"column":57,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":968,"endColumn":59},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1057,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1057,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[40005,40008],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[40005,40008],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .success on an `any` value.","line":1060,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1060,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1062,"column":17,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":1064,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":1063,"column":47,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1063,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":1064,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1064,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .length on an `any` value.","line":1075,"column":59,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1075,"endColumn":65},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":1077,"column":37,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1077,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":1080,"column":11,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":1080,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1081,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1081,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[41063,41066],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[41063,41066],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":1083,"column":32,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1083,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1098,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":1101,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1098,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1098,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[41769,41772],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[41769,41772],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .success on an `any` value.","line":1105,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1105,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":1105,"column":56,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1105,"endColumn":60},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":1106,"column":57,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1106,"endColumn":61},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1107,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1107,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[42111,42114],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[42111,42114],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1108,"column":9,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1108,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":1108,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1108,"endColumn":29},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1108,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1108,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[42162,42165],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[42162,42165],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":1109,"column":29,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1109,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1114,"column":17,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":1114,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1118,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":1118,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .fundingRate on an `any` value.","line":1118,"column":36,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1118,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1119,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":1119,"endColumn":90},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .fundingTime on an `any` value.","line":1119,"column":40,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1119,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1119,"column":54,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1119,"endColumn":82},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .fundingTime on an `any` value.","line":1119,"column":62,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1119,"endColumn":73},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1141,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1141,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[43249,43252],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[43249,43252],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1143,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":1143,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":1143,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1143,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1144,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":1144,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .lastPrice on an `any` value.","line":1144,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1144,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1145,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":1145,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .lastPrice on an `any` value.","line":1145,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1145,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1146,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":1146,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .lastPrice on an `any` value.","line":1146,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1146,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1147,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":1147,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .openPrice on an `any` value.","line":1147,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1147,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .priceChangePercent on an `any` value.","line":1148,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1148,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .priceChangePercent on an `any` value.","line":1148,"column":68,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1148,"endColumn":86},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1149,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":1149,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .highPrice on an `any` value.","line":1149,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1149,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1150,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":1150,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .lowPrice on an `any` value.","line":1150,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1150,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1151,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":1151,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .openPrice on an `any` value.","line":1151,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1151,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1154,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":1154,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .quoteVolume on an `any` value.","line":1154,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1154,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1155,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":1155,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .volume on an `any` value.","line":1155,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1155,"endColumn":31},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1203,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1203,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[45437,45440],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[45437,45440],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .success on an `any` value.","line":1205,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1205,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1207,"column":17,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":1229,"endColumn":13},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1207,"column":33,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1207,"endColumn":58},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":1207,"column":43,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1207,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .map on an `any` value.","line":1207,"column":55,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1207,"endColumn":58},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1207,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1207,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[45668,45671],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[45668,45671],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1209,"column":19,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":1211,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1209,"column":34,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1211,"endColumn":22},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1209,"column":34,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1210,"endColumn":19},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exchanges on an `any` value.","line":1209,"column":46,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1209,"endColumn":55},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1210,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1210,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[45850,45853],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[45850,45853],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":1210,"column":33,"nodeType":"MemberExpression","messageId":"unsafeReturn","endLine":1210,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .nextFundingTime on an `any` value.","line":1210,"column":36,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1210,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .filter on an `any` value.","line":1211,"column":16,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1211,"endColumn":22},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .length on an `any` value.","line":1212,"column":54,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1212,"endColumn":60},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .bestLong on an `any` value.","line":1219,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1219,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .bestShort on an `any` value.","line":1220,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1220,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":1223,"column":13,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":1228,"endColumn":15},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .length on an `any` value.","line":1234,"column":62,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1234,"endColumn":68},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1235,"column":61,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1235,"endColumn":79},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .map on an `any` value.","line":1235,"column":76,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1235,"endColumn":79},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1235,"column":84,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1235,"endColumn":87,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[46895,46898],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[46895,46898],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":1235,"column":92,"nodeType":"MemberExpression","messageId":"unsafeReturn","endLine":1235,"endColumn":100},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":1235,"column":94,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1235,"endColumn":100},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access [0] on an `any` value.","line":1236,"column":82,"nodeType":"Literal","messageId":"unsafeMemberExpression","endLine":1236,"endColumn":83},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1245,"column":13,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1245,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1245,"column":13,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1245,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .slice on an `any` value.","line":1245,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1245,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .forEach on an `any` value.","line":1245,"column":40,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1245,"endColumn":47},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1245,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1245,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[47374,47377],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[47374,47377],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":1246,"column":57,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1246,"endColumn":63},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1250,"column":21,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":1252,"endColumn":16},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1250,"column":40,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1250,"endColumn":58},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exchanges on an `any` value.","line":1250,"column":44,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1250,"endColumn":53},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1250,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1250,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[47650,47653],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[47650,47653],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exchange on an `any` value.","line":1251,"column":20,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1251,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .bestLong on an `any` value.","line":1251,"column":37,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1251,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .credentialId on an `any` value.","line":1251,"column":61,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1251,"endColumn":73},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .bestLong on an `any` value.","line":1251,"column":82,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1251,"endColumn":90},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1253,"column":21,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":1255,"endColumn":16},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1253,"column":41,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1253,"endColumn":59},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exchanges on an `any` value.","line":1253,"column":45,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1253,"endColumn":54},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1253,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1253,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[47845,47848],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[47845,47848],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exchange on an `any` value.","line":1254,"column":20,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1254,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .bestShort on an `any` value.","line":1254,"column":37,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1254,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .credentialId on an `any` value.","line":1254,"column":62,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1254,"endColumn":74},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .bestShort on an `any` value.","line":1254,"column":83,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1254,"endColumn":92},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .bestLong on an `any` value.","line":1258,"column":46,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1258,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .lastPrice on an `any` value.","line":1259,"column":58,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1259,"endColumn":67},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .fundingRate on an `any` value.","line":1260,"column":71,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1260,"endColumn":82},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .bestShort on an `any` value.","line":1264,"column":46,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1264,"endColumn":55},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .lastPrice on an `any` value.","line":1265,"column":59,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1265,"endColumn":68},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .fundingRate on an `any` value.","line":1266,"column":72,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1266,"endColumn":83},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .spreadPercent on an `any` value.","line":1269,"column":44,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1269,"endColumn":57},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .priceSpreadUsdt on an `any` value.","line":1269,"column":68,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1269,"endColumn":83},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .lastPrice on an `any` value.","line":1272,"column":65,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1272,"endColumn":74},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .lastPrice on an `any` value.","line":1273,"column":64,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1273,"endColumn":73},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":1292,"column":44,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1292,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":1307,"column":39,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1307,"endColumn":46},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1385,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1385,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[52919,52922],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[52919,52922],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of type `any[]` to a variable of type `{ exchange: string; symbol: string; credentialId: string; apiKey?: string | undefined; apiSecret?: string | undefined; authToken?: string | undefined; environment: string; }[]`.","line":1411,"column":9,"nodeType":"Property","messageId":"unsafeAssignment","endLine":1411,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1520,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":1523,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1520,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1520,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[57125,57128],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[57125,57128],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .success on an `any` value.","line":1525,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1525,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":1525,"column":44,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1525,"endColumn":48},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1531,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":1531,"endColumn":97},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1531,"column":35,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1531,"endColumn":55},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":1531,"column":44,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1531,"endColumn":48},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1531,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1531,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[57529,57532],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[57529,57532],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .status on an `any` value.","line":1531,"column":74,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1531,"endColumn":80},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .length on an `any` value.","line":1533,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1533,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .length on an `any` value.","line":1542,"column":68,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1542,"endColumn":74},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .length on an `any` value.","line":1552,"column":76,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1552,"endColumn":82},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1553,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":1558,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":1553,"column":30,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":1553,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .map on an `any` value.","line":1553,"column":50,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1553,"endColumn":53},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1553,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1553,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[58398,58401],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[58398,58401],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1554,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1554,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[58432,58435],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[58432,58435],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .subscriptionId on an `any` value.","line":1555,"column":87,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1555,"endColumn":101},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .length on an `any` value.","line":1565,"column":79,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1565,"endColumn":85},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1569,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1569,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[58950,58953],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[58950,58953],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1828,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":1828,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .success on an `any` value.","line":1830,"column":18,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1830,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":1834,"column":58,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1834,"endColumn":65},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .error on an `any` value.","line":1834,"column":76,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1834,"endColumn":81},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1836,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1836,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[67672,67675],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[67672,67675],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1983,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1983,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[72470,72473],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[72470,72473],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1984,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1984,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[72513,72516],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[72513,72516],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2163,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2163,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[79938,79941],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[79938,79941],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .success on an `any` value.","line":2168,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2168,"endColumn":35},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2195,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2195,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[81241,81244],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[81241,81244],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .success on an `any` value.","line":2201,"column":34,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2201,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":2206,"column":65,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2206,"endColumn":72},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .error on an `any` value.","line":2211,"column":54,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2211,"endColumn":59},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":2215,"column":59,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2215,"endColumn":66},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .error on an `any` value.","line":2220,"column":48,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2220,"endColumn":53},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2247,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2247,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[83050,83053],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[83050,83053],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .success on an `any` value.","line":2251,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2251,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":2251,"column":44,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2251,"endColumn":48},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":2255,"column":13,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":2255,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":2255,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2255,"endColumn":26},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2255,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2255,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[83460,83463],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[83460,83463],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2257,"column":21,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2260,"endColumn":97},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":2257,"column":41,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2257,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":2258,"column":47,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2258,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":2259,"column":40,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2259,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":2260,"column":37,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":2260,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":2260,"column":41,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2260,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":2260,"column":68,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":2260,"endColumn":87},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":2260,"column":72,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2260,"endColumn":78},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":2263,"column":100,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2263,"endColumn":106},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .subscriptionId on an `any` value.","line":2263,"column":119,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2263,"endColumn":133},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .status on an `any` value.","line":2268,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2268,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .entryPrice on an `any` value.","line":2268,"column":53,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2268,"endColumn":63},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2270,"column":19,"nodeType":"Property","messageId":"anyAssignment","endLine":2270,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .subscriptionId on an `any` value.","line":2270,"column":39,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2270,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2271,"column":19,"nodeType":"Property","messageId":"anyAssignment","endLine":2271,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":2271,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2271,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2272,"column":19,"nodeType":"Property","messageId":"anyAssignment","endLine":2272,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .fundingRate on an `any` value.","line":2272,"column":36,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2272,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2273,"column":19,"nodeType":"Property","messageId":"anyAssignment","endLine":2273,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .positionType on an `any` value.","line":2273,"column":37,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2273,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2274,"column":19,"nodeType":"Property","messageId":"anyAssignment","endLine":2274,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .quantity on an `any` value.","line":2274,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2274,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2275,"column":19,"nodeType":"Property","messageId":"anyAssignment","endLine":2275,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .entryPrice on an `any` value.","line":2275,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2275,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2276,"column":19,"nodeType":"Property","messageId":"anyAssignment","endLine":2276,"endColumn":55},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .hedgeEntryPrice on an `any` value.","line":2276,"column":40,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2276,"endColumn":55},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2277,"column":19,"nodeType":"Property","messageId":"anyAssignment","endLine":2277,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .fundingEarned on an `any` value.","line":2277,"column":38,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2277,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2278,"column":19,"nodeType":"Property","messageId":"anyAssignment","endLine":2278,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .realizedPnl on an `any` value.","line":2278,"column":36,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2278,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2279,"column":19,"nodeType":"Property","messageId":"anyAssignment","endLine":2279,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .executedAt on an `any` value.","line":2279,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2279,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2280,"column":19,"nodeType":"Property","messageId":"anyAssignment","endLine":2280,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .createdAt on an `any` value.","line":2280,"column":34,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2280,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .status on an `any` value.","line":2282,"column":30,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2282,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .subscriptionId on an `any` value.","line":2284,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2284,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":2348,"column":65,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2348,"endColumn":72},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2408,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2408,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[89682,89685],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[89682,89685],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .takeProfitPercent on an `any` value.","line":2424,"column":14,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2424,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .stopLossPercent on an `any` value.","line":2425,"column":14,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2425,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .hedgeExchange on an `any` value.","line":2430,"column":14,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2430,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .hedgeCredentialId on an `any` value.","line":2431,"column":14,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2431,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2437,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2441,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2437,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2437,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[90942,90945],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[90942,90945],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .success on an `any` value.","line":2443,"column":20,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2443,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2458,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2458,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[91633,91636],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[91633,91636],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .error on an `any` value.","line":2461,"column":39,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2461,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":2461,"column":63,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2461,"endColumn":70},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2519,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2522,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'response' is assigned a value but never used.","line":2519,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":2519,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2519,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2519,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[93531,93534],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[93531,93534],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2532,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2532,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[93958,93961],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[93958,93961],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2536,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2538,"endColumn":67},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .status on an `any` value.","line":2536,"column":32,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2536,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":2537,"column":26,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":2537,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .error on an `any` value.","line":2537,"column":32,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2537,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":2538,"column":26,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":2538,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .error on an `any` value.","line":2538,"column":32,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2538,"endColumn":37},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2709,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2709,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[99694,99697],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[99694,99697],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":2710,"column":68,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2710,"endColumn":74},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2722,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2722,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[100133,100136],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[100133,100136],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":2723,"column":68,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2723,"endColumn":74},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2819,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2819,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[104592,104595],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[104592,104595],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":2820,"column":68,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2820,"endColumn":74},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":2828,"column":75,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2828,"endColumn":81},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2845,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2845,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[105462,105465],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[105462,105465],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .bestLong on an `any` value.","line":2859,"column":67,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2859,"endColumn":75},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .bestShort on an `any` value.","line":2860,"column":68,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2860,"endColumn":77},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2863,"column":9,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":2863,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .bestLong on an `any` value.","line":2863,"column":39,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2863,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2864,"column":9,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":2864,"endColumn":64},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .bestLong on an `any` value.","line":2864,"column":43,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2864,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2865,"column":9,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":2865,"endColumn":62},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .bestLong on an `any` value.","line":2865,"column":42,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2865,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2868,"column":9,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":2868,"endColumn":57},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .bestShort on an `any` value.","line":2868,"column":39,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2868,"endColumn":48},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2869,"column":9,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":2869,"endColumn":65},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .bestShort on an `any` value.","line":2869,"column":43,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2869,"endColumn":52},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2870,"column":9,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":2870,"endColumn":63},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .bestShort on an `any` value.","line":2870,"column":42,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2870,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2875,"column":7,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":2875,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .bestLong on an `any` value.","line":2875,"column":37,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2875,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2876,"column":7,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":2876,"endColumn":62},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .bestLong on an `any` value.","line":2876,"column":41,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2876,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2877,"column":7,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":2877,"endColumn":60},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .bestLong on an `any` value.","line":2877,"column":40,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2877,"endColumn":48},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2898,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2898,"endColumn":71},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .bestShort on an `any` value.","line":2898,"column":49,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2898,"endColumn":58},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2908,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":2910,"endColumn":6},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":2908,"column":26,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":2908,"endColumn":52},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exchanges on an `any` value.","line":2908,"column":38,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2908,"endColumn":47},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2909,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2909,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[108614,108617],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[108614,108617],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exchange on an `any` value.","line":2909,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2909,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .credentialId on an `any` value.","line":2909,"column":58,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2909,"endColumn":70},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exchanges on an `any` value.","line":2912,"column":70,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2912,"endColumn":79},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":2916,"column":72,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2916,"endColumn":78},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":2926,"column":70,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2926,"endColumn":76},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2932,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":2932,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":2932,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2932,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2934,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":2934,"endColumn":75},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":2934,"column":28,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":2934,"endColumn":66},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .nextFundingTime on an `any` value.","line":2934,"column":41,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2934,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2935,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":2935,"endColumn":86},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":2935,"column":22,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":2935,"endColumn":84},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .lastPrice on an `any` value.","line":2935,"column":36,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2935,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .price on an `any` value.","line":2935,"column":62,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2935,"endColumn":67},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .toString on an `any` value.","line":2935,"column":76,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2935,"endColumn":84},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2936,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":2936,"endColumn":114},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":2936,"column":23,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":2936,"endColumn":112},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .indexPrice on an `any` value.","line":2936,"column":37,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2936,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .lastPrice on an `any` value.","line":2936,"column":64,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2936,"endColumn":73},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .price on an `any` value.","line":2936,"column":90,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2936,"endColumn":95},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .toString on an `any` value.","line":2936,"column":104,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2936,"endColumn":112},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2937,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":2937,"endColumn":112},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":2937,"column":22,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":2937,"endColumn":110},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .markPrice on an `any` value.","line":2937,"column":36,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2937,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .lastPrice on an `any` value.","line":2937,"column":62,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2937,"endColumn":71},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .price on an `any` value.","line":2937,"column":88,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2937,"endColumn":93},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .toString on an `any` value.","line":2937,"column":102,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2937,"endColumn":110},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2943,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":2943,"endColumn":69},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":2943,"column":25,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":2943,"endColumn":60},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .openInterest on an `any` value.","line":2943,"column":38,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2943,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2946,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":2946,"endColumn":63},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":2946,"column":22,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":2946,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .volume24h on an `any` value.","line":2946,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2946,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":2962,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":2962,"endColumn":92},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":2962,"column":26,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":2962,"endColumn":64},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .nextFundingTime on an `any` value.","line":2962,"column":39,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2962,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .spread on an `any` value.","line":2975,"column":55,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2975,"endColumn":61},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":2976,"column":57,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2976,"endColumn":63},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .bestShort on an `any` value.","line":2976,"column":153,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2976,"endColumn":162},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":2980,"column":57,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":2980,"endColumn":63},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'symbol' is defined but never used.","line":2992,"column":43,"nodeType":null,"messageId":"unusedVar","endLine":2992,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":3029,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":3029,"endColumn":106},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3029,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3029,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[113948,113951],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[113948,113951],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .success on an `any` value.","line":3033,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3033,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":3033,"column":69,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3033,"endColumn":73},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":3038,"column":87,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3038,"endColumn":91},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":3040,"column":17,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":3040,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":3040,"column":47,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3040,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .length on an `any` value.","line":3041,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3041,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access [0] on an `any` value.","line":3042,"column":39,"nodeType":"Literal","messageId":"unsafeMemberExpression","endLine":3042,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":3050,"column":77,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3050,"endColumn":81},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":3051,"column":85,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3051,"endColumn":89},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":3053,"column":17,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":3053,"endColumn":68},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":3053,"column":55,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3053,"endColumn":59},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .availableMargin on an `any` value.","line":3056,"column":88,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3056,"endColumn":103},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .balance on an `any` value.","line":3057,"column":80,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3057,"endColumn":87},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .availableMargin on an `any` value.","line":3058,"column":47,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3058,"endColumn":62},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .balance on an `any` value.","line":3058,"column":79,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3058,"endColumn":86},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":3086,"column":15,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":3086,"endColumn":104},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3086,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3086,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[117127,117130],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[117127,117130],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .success on an `any` value.","line":3090,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3090,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":3090,"column":67,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3090,"endColumn":71},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":3096,"column":19,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":3096,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":3096,"column":47,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3096,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .length on an `any` value.","line":3097,"column":30,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3097,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access [0] on an `any` value.","line":3098,"column":41,"nodeType":"Literal","messageId":"unsafeMemberExpression","endLine":3098,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":3105,"column":93,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3105,"endColumn":97},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":3106,"column":19,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":3106,"endColumn":67},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":3106,"column":55,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3106,"endColumn":59},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .availableMargin on an `any` value.","line":3108,"column":48,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3108,"endColumn":63},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .balance on an `any` value.","line":3108,"column":81,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3108,"endColumn":88},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3124,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3124,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[119098,119101],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[119098,119101],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":3185,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":3185,"endColumn":75,"suggestions":[{"messageId":"addBrackets","fix":{"range":[121135,121862],"text":"{ const cleanSymbol = symbol.replace(/:.*$/, '').replace(/\\//g, '');\r\n        // Convert to BingX format with hyphen (e.g., BTCUSDT -> BTC-USDT)\r\n        const bingxSymbol = cleanSymbol.includes('-') ? cleanSymbol :\r\n          (cleanSymbol.endsWith('USDT') ? `${cleanSymbol.slice(0, -4)}-USDT` :\r\n          (cleanSymbol.endsWith('USDC') ? `${cleanSymbol.slice(0, -4)}-USDC` : cleanSymbol));\r\n\r\n        if (environment === 'TESTNET') {\r\n          // BingX Testnet perpetual trading page\r\n          url = `https://testnet-futures.bingx.com/en/perpetual/${bingxSymbol}`;\r\n        } else {\r\n          // BingX Mainnet perpetual trading page\r\n          url = `https://bingx.com/en/perpetual/${bingxSymbol}`;\r\n        }\r\n        break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":3187,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":3189,"endColumn":94,"suggestions":[{"messageId":"addBrackets","fix":{"range":[121135,121862],"text":"{ const cleanSymbol = symbol.replace(/:.*$/, '').replace(/\\//g, '');\r\n        // Convert to BingX format with hyphen (e.g., BTCUSDT -> BTC-USDT)\r\n        const bingxSymbol = cleanSymbol.includes('-') ? cleanSymbol :\r\n          (cleanSymbol.endsWith('USDT') ? `${cleanSymbol.slice(0, -4)}-USDT` :\r\n          (cleanSymbol.endsWith('USDC') ? `${cleanSymbol.slice(0, -4)}-USDC` : cleanSymbol));\r\n\r\n        if (environment === 'TESTNET') {\r\n          // BingX Testnet perpetual trading page\r\n          url = `https://testnet-futures.bingx.com/en/perpetual/${bingxSymbol}`;\r\n        } else {\r\n          // BingX Mainnet perpetual trading page\r\n          url = `https://bingx.com/en/perpetual/${bingxSymbol}`;\r\n        }\r\n        break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":3259,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":3259,"endColumn":87,"suggestions":[{"messageId":"addBrackets","fix":{"range":[123767,124460],"text":"{ const cleanBingxSymbol = displaySymbol.replace(/:.*$/, '').replace(/\\//g, '');\r\n        // Convert to BingX format with hyphen (e.g., BTCUSDT -> BTC-USDT)\r\n        const bingxDisplaySymbol = cleanBingxSymbol.includes('-') ? cleanBingxSymbol :\r\n          (cleanBingxSymbol.endsWith('USDT') ? `${cleanBingxSymbol.slice(0, -4)}-USDT` :\r\n          (cleanBingxSymbol.endsWith('USDC') ? `${cleanBingxSymbol.slice(0, -4)}-USDC` : cleanBingxSymbol));\r\n\r\n        if (environment === 'TESTNET') {\r\n          url = `https://testnet-futures.bingx.com/en/perpetual/${bingxDisplaySymbol}`;\r\n        } else {\r\n          url = `https://bingx.com/en/perpetual/${bingxDisplaySymbol}`;\r\n        }\r\n        break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":3261,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":3263,"endColumn":109,"suggestions":[{"messageId":"addBrackets","fix":{"range":[123767,124460],"text":"{ const cleanBingxSymbol = displaySymbol.replace(/:.*$/, '').replace(/\\//g, '');\r\n        // Convert to BingX format with hyphen (e.g., BTCUSDT -> BTC-USDT)\r\n        const bingxDisplaySymbol = cleanBingxSymbol.includes('-') ? cleanBingxSymbol :\r\n          (cleanBingxSymbol.endsWith('USDT') ? `${cleanBingxSymbol.slice(0, -4)}-USDT` :\r\n          (cleanBingxSymbol.endsWith('USDC') ? `${cleanBingxSymbol.slice(0, -4)}-USDC` : cleanBingxSymbol));\r\n\r\n        if (environment === 'TESTNET') {\r\n          url = `https://testnet-futures.bingx.com/en/perpetual/${bingxDisplaySymbol}`;\r\n        } else {\r\n          url = `https://bingx.com/en/perpetual/${bingxDisplaySymbol}`;\r\n        }\r\n        break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":3274,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":3274,"endColumn":123,"suggestions":[{"messageId":"addBrackets","fix":{"range":[124557,124765],"text":"{ const mexcSymbol = displaySymbol.includes('_') ? displaySymbol : symbol.replace(/^(.+)(USDT|USDC|USD)$/, '$1_$2');\r\n        url = `https://www.mexc.com/futures/${mexcSymbol}?type=linear_swap`;\r\n        break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'symbol' is defined but never used.","line":3291,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":3291,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3318,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3318,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[125768,125771],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[125768,125771],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3338,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3338,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[126451,126454],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[126451,126454],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":3341,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":3341,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":3341,"column":32,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3341,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":3342,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":3342,"endColumn":65},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .bestShort on an `any` value.","line":3342,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3342,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":3343,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":3343,"endColumn":62},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .bestLong on an `any` value.","line":3343,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3343,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":3361,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":3361,"endColumn":57},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":3382,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":3384,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":3382,"column":32,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":3382,"endColumn":58},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exchanges on an `any` value.","line":3382,"column":44,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3382,"endColumn":53},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3382,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3382,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[127846,127849],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[127846,127849],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exchange on an `any` value.","line":3383,"column":12,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3383,"endColumn":20},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .bestLong on an `any` value.","line":3383,"column":37,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3383,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .credentialId on an `any` value.","line":3383,"column":61,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3383,"endColumn":73},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .bestLong on an `any` value.","line":3383,"column":90,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3383,"endColumn":98},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":3385,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":3387,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":3385,"column":33,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":3385,"endColumn":59},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exchanges on an `any` value.","line":3385,"column":45,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3385,"endColumn":54},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3385,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3385,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[128041,128044],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[128041,128044],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exchange on an `any` value.","line":3386,"column":12,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3386,"endColumn":20},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .bestShort on an `any` value.","line":3386,"column":37,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3386,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .credentialId on an `any` value.","line":3386,"column":62,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3386,"endColumn":74},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .bestShort on an `any` value.","line":3386,"column":91,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3386,"endColumn":100},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":3399,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":3399,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":3399,"column":29,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3399,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":3400,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":3400,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .bestShort on an `any` value.","line":3400,"column":38,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3400,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":3401,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":3401,"endColumn":64},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .bestShort on an `any` value.","line":3401,"column":42,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3401,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":3404,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":3404,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .bestLong on an `any` value.","line":3404,"column":36,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3404,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":3405,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":3405,"endColumn":61},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .bestLong on an `any` value.","line":3405,"column":40,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3405,"endColumn":48},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .lastPrice on an `any` value.","line":3408,"column":57,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3408,"endColumn":66},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .lastPrice on an `any` value.","line":3409,"column":54,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3409,"endColumn":63},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":3419,"column":69,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3419,"endColumn":75},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":3429,"column":71,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3429,"endColumn":78},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3436,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3436,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[130281,130284],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[130281,130284],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":3438,"column":67,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3438,"endColumn":74},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3652,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3652,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[138274,138277],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[138274,138277],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .hedgeExchange on an `any` value.","line":3652,"column":52,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3652,"endColumn":65},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3670,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3670,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[139102,139105],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[139102,139105],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .hedgeExchange on an `any` value.","line":3670,"column":29,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3670,"endColumn":42},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3670,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3670,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[139132,139135],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[139132,139135],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .hedgeExchange on an `any` value.","line":3670,"column":59,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3670,"endColumn":72},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3696,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3696,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[140285,140288],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[140285,140288],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .hedgeExchange on an `any` value.","line":3696,"column":52,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3696,"endColumn":65},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3696,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3696,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[140315,140318],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[140315,140318],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .hedgeExchange on an `any` value.","line":3696,"column":82,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3696,"endColumn":95},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3700,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3700,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[140453,140456],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[140453,140456],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .hedgeExchange on an `any` value.","line":3700,"column":60,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3700,"endColumn":73},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3720,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3720,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[141077,141080],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[141077,141080],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .hedgeExchange on an `any` value.","line":3720,"column":54,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":3720,"endColumn":67}],"suppressedMessages":[],"errorCount":416,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, OnInit, OnDestroy, inject, signal, computed, effect, ChangeDetectorRef } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\r\nimport { Router } from '@angular/router';\r\nimport { interval, Subscription, of } from 'rxjs';\r\nimport { switchMap, startWith } from 'rxjs/operators';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\r\nimport { AuthService } from '../../../services/auth.service';\r\nimport { TranslationService } from '../../../services/translation.service';\r\nimport { ArbitrageStreamService, PriceUpdate } from '../../../services/arbitrage-stream.service';\r\nimport { PriceArbitrageService } from '../../../services/price-arbitrage.service';\r\nimport { CardComponent, CardHeaderComponent, CardTitleComponent, CardContentComponent } from '../../ui/card/card.component';\r\nimport { ButtonComponent } from '../../ui/button/button.component';\r\nimport { DropdownComponent, DropdownOption } from '../../ui/dropdown/dropdown.component';\r\nimport { TradeHistoryComponent, TradeHistoryDialogData } from '../trade-history/trade-history.component';\r\nimport { StartBybitStrategyModalComponent, StartBybitStrategyModalData } from '../start-bybit-strategy-modal/start-bybit-strategy-modal.component';\r\nimport { BybitFundingStrategyService } from '../../../services/bybit-funding-strategy.service';\r\nimport { ActiveStrategy } from '../../../models/bybit-funding-strategy.model';\r\nimport { getEndpointUrl } from '../../../config/app.config';\r\n\r\n/**\r\n * Ticker data interface (Linear/Inverse)\r\n */\r\nexport interface TickerData {\r\n  symbol: string;\r\n  lastPrice: string;\r\n  indexPrice: string;\r\n  markPrice: string;\r\n  prevPrice24h: string;\r\n  price24hPcnt: string;\r\n  highPrice24h: string;\r\n  lowPrice24h: string;\r\n  prevPrice1h: string;\r\n  openInterest: string;\r\n  openInterestValue: string;\r\n  turnover24h: string;\r\n  volume24h: string;\r\n  fundingRate: string;\r\n  nextFundingTime: string;\r\n  predictedDeliveryPrice: string;\r\n  basisRate: string;\r\n  deliveryFeeRate: string;\r\n  deliveryTime: string;\r\n  ask1Size: string;\r\n  bid1Price: string;\r\n  ask1Price: string;\r\n  bid1Size: string;\r\n}\r\n\r\nexport interface ExchangeCredential {\r\n  id: string;\r\n  exchange: string;\r\n  environment: string;\r\n  label?: string;\r\n  isActive: boolean;\r\n}\r\n\r\nexport interface FundingSubscription {\r\n  subscriptionId: string;\r\n  symbol: string;\r\n  fundingRate: number;\r\n  nextFundingTime: number;\r\n  positionType: 'long' | 'short';\r\n  quantity: number;\r\n  status: string;\r\n  countdown?: number; // Seconds remaining\r\n  primaryExchange?: string; // Exchange where position is opened\r\n  primaryCredentialId?: string; // Credential used for primary exchange\r\n  hedgeExchange?: string; // Exchange for hedge position\r\n  hedgeCredentialId?: string; // Credential for hedge exchange\r\n  leverage?: number; // Leverage multiplier for this subscription\r\n  margin?: number; // Margin amount in USDT (the actual capital invested by user)\r\n}\r\n\r\nexport interface CompletedDeal {\r\n  subscriptionId: string;\r\n  symbol: string;\r\n  fundingRate: number;\r\n  positionType: 'long' | 'short';\r\n  quantity: number;\r\n  entryPrice: number;\r\n  hedgeEntryPrice: number;\r\n  fundingEarned: number;\r\n  realizedPnl: number;\r\n  executedAt: string;\r\n  createdAt: string;\r\n}\r\n\r\nexport interface TradeHistoryRecord {\r\n  id: string;\r\n  symbol: string;\r\n  executedAt: string;\r\n  closedAt: string;\r\n  positionSizeUsdt: number;\r\n  fundingEarned: number;\r\n  realizedPnl: number;\r\n  entryPrice: number;\r\n  exitPrice: number;\r\n  leverage: number;\r\n  quantity: number;\r\n  status: string;\r\n}\r\n\r\nexport interface SubscriptionSettings {\r\n  defaultQuantity: number;           // Default number of coins to trade\r\n  leverage: number;                   // Trading leverage (1-100x)\r\n  autoCancelThreshold: number | null; // Auto-cancel if funding rate falls below this (null = disabled)\r\n  enableAutoCancel: boolean;          // Enable/disable auto-cancel feature\r\n  executionDelay: number;             // Seconds before funding time to execute (default: 5)\r\n  arbitrageSpreadThreshold: number | null; // Minimum spread threshold for arbitrage opportunities (in %)\r\n}\r\n\r\nexport interface ExchangeData {\r\n  exchange: string;\r\n  credentialId: string;\r\n  environment: string;\r\n  fundingRate: string;\r\n  nextFundingTime: number;\r\n  fundingInterval?: string; // Funding interval (e.g., \"8h\", \"4h\", \"1h\")\r\n  originalSymbol?: string;\r\n  lastPrice: string;\r\n  indexPrice?: string;\r\n  markPrice?: string;\r\n  highPrice24h?: string;\r\n  lowPrice24h?: string;\r\n  openInterest?: string;\r\n  volume24h?: string;\r\n  turnover24h?: string;\r\n}\r\n\r\nexport interface FundingRateArbitrageOpportunity {\r\n  symbol: string;\r\n  exchanges: ExchangeData[];\r\n  spread: string; // Price spread as decimal (e.g., \"0.0004\")\r\n  spreadPercent: string; // Price spread as percentage (e.g., \"0.04\")\r\n  priceSpreadUsdt: string; // Absolute price difference in USDT (e.g., \"25.50\")\r\n  fundingPeriodicity?: string; // Funding periodicity (e.g., \"2–≥ 35—Ö–≤/8h\")\r\n  fundingSpread?: number; // Funding rate spread (difference between PRIMARY and HEDGE funding rates)\r\n  fundingSpreadPercent?: string; // Funding spread as percentage string (e.g., \"0.15\")\r\n  bestLong: {\r\n    exchange: string;\r\n    credentialId: string;\r\n    fundingRate: string;\r\n    environment: string;\r\n  };\r\n  bestShort: {\r\n    exchange: string;\r\n    credentialId: string;\r\n    fundingRate: string;\r\n    environment: string;\r\n  };\r\n  arbitrageOpportunity: boolean;\r\n  marketCap?: number; // Market capitalization in USD from CoinGecko\r\n}\r\n\r\n/**\r\n * Enhanced Funding Rates Component\r\n *\r\n * Displays real-time funding rates with advanced filtering and exchange selection.\r\n * Features:\r\n * - Multi-exchange credential selection\r\n * - Filter by funding rate (min/max)\r\n * - Filter by next funding time\r\n * - Auto-refresh every 30 seconds\r\n * - Sortable columns\r\n * - Annualized rate calculation\r\n */\r\n@Component({\r\n  selector: 'app-funding-rates',\r\n  standalone: true,\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    MatIconModule,\r\n    MatButtonModule,\r\n    MatTooltipModule,\r\n    MatProgressSpinnerModule,\r\n    CardComponent,\r\n    CardHeaderComponent,\r\n    CardTitleComponent,\r\n    CardContentComponent,\r\n    ButtonComponent,\r\n    DropdownComponent,\r\n    TradeHistoryComponent,\r\n    StartBybitStrategyModalComponent\r\n  ],\r\n  templateUrl: './funding-rates.component.html',\r\n  styleUrl: './funding-rates.component.scss'\r\n})\r\nexport class FundingRatesComponent implements OnInit, OnDestroy {\r\n  private http = inject(HttpClient);\r\n  private authService = inject(AuthService);\r\n  private translationService = inject(TranslationService);\r\n  private arbitrageStreamService = inject(ArbitrageStreamService);\r\n  private priceArbitrageService = inject(PriceArbitrageService);\r\n  private bybitFundingStrategyService = inject(BybitFundingStrategyService);\r\n  private cdr = inject(ChangeDetectorRef);\r\n  private router = inject(Router);\r\n\r\n  // Trade History Dialog State\r\n  showTradeHistoryDialog = signal<boolean>(false);\r\n  tradeHistorySymbol = signal<string | undefined>(undefined);\r\n  tradeHistoryExchange = signal<string | undefined>(undefined);\r\n\r\n  // Bybit Strategy Modal State\r\n  showBybitStrategyModal = signal<boolean>(false);\r\n  bybitStrategyModalData = signal<StartBybitStrategyModalData | null>(null);\r\n\r\n  // Expose utilities to template\r\n  readonly Array = Array;\r\n  readonly parseFloat = parseFloat;\r\n  readonly Math = Math;\r\n\r\n  // State\r\n  tickers = signal<TickerData[]>([]);\r\n  credentials = signal<ExchangeCredential[]>([]);\r\n  isLoading = signal<boolean>(false);\r\n  isLoadingCredentials = signal<boolean>(false);\r\n  error = signal<string | null>(null);\r\n  selectedCredentialId = signal<string | null>(null);\r\n  hedgeCredentialId = signal<string | null>(null); // For arbitrage subscriptions\r\n  autoRefreshEnabled = signal<boolean>(true);\r\n\r\n  // Balance and position information for subscription dialog\r\n  primaryBalance = signal<number | null>(null);\r\n  hedgeBalance = signal<number | null>(null);\r\n  isLoadingBalances = signal<boolean>(false);\r\n\r\n  // Filter state\r\n  searchQuery = signal<string>('');\r\n  positionType = signal<'all' | 'long' | 'short'>('all');\r\n  minAbsFundingRate = signal<number | null>(null);\r\n  maxNextFundingHours = signal<number | null>(null);\r\n\r\n  // Subscription state\r\n  subscriptions = signal<Map<string, FundingSubscription>>(new Map());\r\n  completedDeals = signal<CompletedDeal[]>([]);\r\n  activeBybitStrategies = signal<ActiveStrategy[]>([]);\r\n  notifications = signal<string[]>([]);\r\n  showSubscriptionDialog = signal<boolean>(false);\r\n  selectedTicker = signal<TickerData | null>(null);\r\n  positionSizeUsdt = signal<number>(100); // Changed from subscriptionQuantity to USDT-based\r\n  dialogLeverage = signal<number>(3); // Dialog-specific leverage (separate from global settings)\r\n  dialogTakeProfitPercent = signal<number>(90); // Take profit percentage (90% of expected funding)\r\n  dialogStopLossPercent = signal<number>(20); // Stop loss percentage (20% of expected funding)\r\n  isSubscribing = signal<boolean>(false);\r\n  editingSubscription = signal<FundingSubscription | null>(null);\r\n  startingSubscriptionId = signal<string | null>(null); // Track which subscription is being started\r\n\r\n  // HEDGED mode dialog state\r\n  showHedgedDialog = signal<boolean>(false);\r\n  selectedHedgedOpportunity = signal<any>(null);\r\n  hedgedPrimaryLeverage = signal<number>(3);\r\n  hedgedPrimaryMargin = signal<number>(100);\r\n  hedgedHedgeLeverage = signal<number>(3);\r\n  hedgedHedgeMargin = signal<number>(100);\r\n  isStartingHedged = signal<boolean>(false);\r\n\r\n  // Row expansion state (only one row can be expanded at a time)\r\n  expandedRowSymbol = signal<string | null>(null);\r\n\r\n  // Arbitrage state\r\n  arbitrageOpportunities = signal<FundingRateArbitrageOpportunity[]>([]);\r\n  isLoadingArbitrage = signal<boolean>(false);\r\n  isArbitrageRequestInProgress = signal<boolean>(false); // Prevents concurrent requests\r\n  arbitrageError = signal<string | null>(null);\r\n  showArbitrageSection = signal<boolean>(true);\r\n  arbitrageFiltersCollapsed = signal<boolean>(false);\r\n  arbitrageSearchQuery = signal<string>(''); // Symbol search filter for arbitrage table\r\n  minSpreadThreshold = signal<number | null>(null); // Minimum spread threshold in percentage\r\n  showOnlySubscribedArbitrage = signal<boolean>(false); // Filter to show only subscribed pairs\r\n  maxNextFundingHoursArbitrage = signal<number | null>(null); // Maximum hours until next funding (filter)\r\n  minMarketCapFilter = signal<number | null>(null); // Minimum market cap filter in millions USD (HEDGED mode only)\r\n  minMarketCapFilterValue = signal<string>(''); // Selected dropdown value for market cap filter\r\n\r\n  // Market cap filter options for dropdown (uses translation keys)\r\n  get marketCapOptions(): DropdownOption[] {\r\n    return [\r\n      { value: '', label: this.translate('fundingRates.filters.allMarketCaps') },\r\n      { value: '0.1', label: this.translate('fundingRates.filters.marketCap100K') },\r\n      { value: '0.2', label: this.translate('fundingRates.filters.marketCap200K') },\r\n      { value: '0.5', label: this.translate('fundingRates.filters.marketCap500K') },\r\n      { value: '1', label: this.translate('fundingRates.filters.marketCap1M') },\r\n      { value: '10', label: this.translate('fundingRates.filters.marketCap10M') },\r\n      { value: '50', label: this.translate('fundingRates.filters.marketCap50M') },\r\n      { value: '100', label: this.translate('fundingRates.filters.marketCap100M') },\r\n      { value: '500', label: this.translate('fundingRates.filters.marketCap500M') },\r\n      { value: '1000', label: this.translate('fundingRates.filters.marketCap1B') },\r\n      { value: '5000', label: this.translate('fundingRates.filters.marketCap5B') },\r\n      { value: '10000', label: this.translate('fundingRates.filters.marketCap10B') },\r\n      { value: '50000', label: this.translate('fundingRates.filters.marketCap50B') },\r\n      { value: '100000', label: this.translate('fundingRates.filters.marketCap100B') }\r\n    ];\r\n  }\r\n\r\n  arbitrageMode = signal<'HEDGED' | 'NON_HEDGED'>('HEDGED'); // Mode toggle: HEDGED (long-term, 2 positions) or NON_HEDGED (short-term, 1 position)\r\n\r\n  // Real-time streaming state\r\n  realtimePrices = signal<Map<string, { price: number; change: 'up' | 'down' | 'neutral'; timestamp: number }>>(new Map());\r\n  isStreamConnected = signal<boolean>(false);\r\n  enableRealtimeStreaming = signal<boolean>(false); // Feature flag for real-time streaming\r\n  priceUpdateSubscription: Subscription | null = null;\r\n\r\n  // Subscription settings\r\n  subscriptionSettings = signal<SubscriptionSettings>({\r\n    defaultQuantity: 0.01,\r\n    leverage: 3,\r\n    autoCancelThreshold: 0.003,\r\n    enableAutoCancel: true,\r\n    executionDelay: 5, // Default: execute 5 seconds before funding\r\n    arbitrageSpreadThreshold: null // Default: no minimum spread threshold\r\n  });\r\n  showSettingsDialog = signal<boolean>(false);\r\n\r\n  // Multi-sort state\r\n  sortColumns = signal<{ column: string; direction: 'asc' | 'desc' }[]>([\r\n    { column: 'fundingRate', direction: 'desc' }\r\n  ]);\r\n\r\n  // Arbitrage table multi-sort state\r\n  // Initial sort matches initial mode (HEDGED = fundingSpread, NON_HEDGED = funding)\r\n  arbitrageSortColumns = signal<{ column: string; direction: 'asc' | 'desc' }[]>([\r\n    { column: 'fundingSpread', direction: 'desc' }  // Default HEDGED mode - sort by funding spread\r\n  ]);\r\n\r\n  // UI state\r\n  isFiltersCollapsed = signal<boolean>(false);\r\n\r\n  // Computed\r\n  credentialOptions = computed(() => {\r\n    // Only show active credentials\r\n    return this.credentials()\r\n      .filter(cred => cred.isActive)\r\n      .map(cred => ({\r\n        value: cred.id,\r\n        label: cred.label || `${cred.exchange} (${cred.environment})`,\r\n        disabled: false\r\n      }));\r\n  });\r\n\r\n  selectedCredential = computed(() => {\r\n    const id = this.selectedCredentialId();\r\n    return this.credentials().find(c => c.id === id);\r\n  });\r\n\r\n  hedgeCredential = computed(() => {\r\n    const id = this.hedgeCredentialId();\r\n    return id ? this.credentials().find(c => c.id === id) : null;\r\n  });\r\n\r\n  filteredTickers = computed(() => {\r\n    let filtered = [...this.tickers()];\r\n\r\n    // Filter out pairs with no funding rate\r\n    filtered = filtered.filter(t => {\r\n      const fundingRate = parseFloat(t.fundingRate);\r\n      return !isNaN(fundingRate) && t.fundingRate !== '' && t.fundingRate !== null && t.fundingRate !== undefined;\r\n    });\r\n\r\n    // Note: We do NOT filter out pairs with 0% price movement\r\n    // because they can still have excellent funding rates for arbitrage\r\n\r\n    // Filter by search query (symbol name)\r\n    const search = this.searchQuery().trim().toUpperCase();\r\n    if (search) {\r\n      filtered = filtered.filter(t => t.symbol.toUpperCase().includes(search));\r\n    }\r\n\r\n    // Filter by position type (long/short)\r\n    const posType = this.positionType();\r\n    if (posType === 'long') {\r\n      // Long positions: filter for NEGATIVE funding rates (you receive funding)\r\n      filtered = filtered.filter(t => parseFloat(t.fundingRate) < 0);\r\n    } else if (posType === 'short') {\r\n      // Short positions: filter for POSITIVE funding rates (you receive funding)\r\n      filtered = filtered.filter(t => parseFloat(t.fundingRate) > 0);\r\n    }\r\n\r\n    // Filter by minimum absolute funding rate\r\n    const minAbsRate = this.minAbsFundingRate();\r\n    if (minAbsRate !== null) {\r\n      filtered = filtered.filter(t => Math.abs(parseFloat(t.fundingRate) * 100) >= minAbsRate);\r\n    }\r\n\r\n    // Filter by next funding time\r\n    const maxHours = this.maxNextFundingHours();\r\n    if (maxHours !== null) {\r\n      const now = Date.now();\r\n      const maxTime = now + (maxHours * 60 * 60 * 1000);\r\n      filtered = filtered.filter(t => {\r\n        const fundingTime = parseInt(t.nextFundingTime);\r\n        return fundingTime <= maxTime;\r\n      });\r\n    }\r\n\r\n    return filtered;\r\n  });\r\n\r\n  sortedTickers = computed(() => {\r\n    const tickers = [...this.filteredTickers()];\r\n    const sortCols = this.sortColumns();\r\n\r\n    if (sortCols.length === 0) {\r\n      return tickers;\r\n    }\r\n\r\n    return tickers.sort((a, b) => {\r\n      // Apply each sort column in order\r\n      for (const { column, direction } of sortCols) {\r\n        let aVal: any = a[column as keyof TickerData];\r\n        let bVal: any = b[column as keyof TickerData];\r\n\r\n        // Parse numbers for numeric columns\r\n        if (column !== 'symbol') {\r\n          aVal = parseFloat(aVal) || 0;\r\n          bVal = parseFloat(bVal) || 0;\r\n        }\r\n\r\n        // Compare values\r\n        let comparison = 0;\r\n        if (aVal > bVal) {\r\n          comparison = 1;\r\n        } else if (aVal < bVal) {\r\n          comparison = -1;\r\n        }\r\n\r\n        // If values are different, apply direction and return\r\n        if (comparison !== 0) {\r\n          return direction === 'asc' ? comparison : -comparison;\r\n        }\r\n\r\n        // If values are equal, continue to next sort column\r\n      }\r\n\r\n      return 0; // All sort columns equal\r\n    });\r\n  });\r\n\r\n  /**\r\n   * Check if a ticker meets the auto-subscribe threshold\r\n   */\r\n  meetsAutoSubscribeThreshold = computed(() => {\r\n    const settings = this.subscriptionSettings();\r\n    const tickers = this.sortedTickers();\r\n    const threshold = settings.autoCancelThreshold;\r\n\r\n    if (threshold === null || threshold === undefined) {\r\n      return new Set<string>();\r\n    }\r\n\r\n    const eligibleSymbols = new Set<string>();\r\n\r\n    tickers.forEach(ticker => {\r\n      const fundingRate = parseFloat(ticker.fundingRate);\r\n      const absFundingRate = Math.abs(fundingRate);\r\n\r\n      // Symbol meets threshold if absolute funding rate is >= threshold\r\n      if (absFundingRate >= Math.abs(threshold)) {\r\n        eligibleSymbols.add(ticker.symbol);\r\n      }\r\n    });\r\n\r\n    return eligibleSymbols;\r\n  });\r\n\r\n  /**\r\n   * Filtered arbitrage opportunities based on symbol search, spread threshold, subscription status, and next funding time\r\n   */\r\n  filteredArbitrageOpportunities = computed(() => {\r\n    let opportunities = [...this.arbitrageOpportunities()];\r\n\r\n    // Filter by symbol search query\r\n    const search = this.arbitrageSearchQuery().trim().toUpperCase();\r\n    if (search) {\r\n      opportunities = opportunities.filter(opp =>\r\n        opp.symbol.toUpperCase().includes(search)\r\n      );\r\n    }\r\n\r\n    // Filter by minimum spread threshold\r\n    const minSpread = this.minSpreadThreshold();\r\n    if (minSpread !== null && minSpread > 0) {\r\n      opportunities = opportunities.filter(opp => {\r\n        const spreadPercent = parseFloat(opp.spread) * 100;\r\n        return spreadPercent >= minSpread;\r\n      });\r\n    }\r\n\r\n    // Filter by subscription status (show only subscribed pairs)\r\n    if (this.showOnlySubscribedArbitrage()) {\r\n      opportunities = opportunities.filter(opp =>\r\n        this.hasArbitrageSubscription(opp.symbol)\r\n      );\r\n    }\r\n\r\n    // Filter by next funding time\r\n    const maxHours = this.maxNextFundingHoursArbitrage();\r\n    if (maxHours !== null && maxHours > 0) {\r\n      const now = Date.now();\r\n      const maxTime = now + (maxHours * 60 * 60 * 1000);\r\n      opportunities = opportunities.filter(opp => {\r\n        // Check if any exchange in this opportunity has next funding time within the threshold\r\n        return opp.exchanges.some((exchange: any) => {\r\n          const fundingTime = parseInt(exchange.nextFundingTime?.toString() || '0');\r\n          return fundingTime > 0 && fundingTime <= maxTime;\r\n        });\r\n      });\r\n    }\r\n\r\n    // Filter by minimum market cap (HEDGED mode only)\r\n    const minMarketCap = this.minMarketCapFilter();\r\n    if (minMarketCap !== null && minMarketCap > 0) {\r\n      const beforeCount = opportunities.length;\r\n\r\n      opportunities = opportunities.filter(opp => {\r\n        // Market cap is already stored in millions USD (from backend)\r\n        // Filter value is also in millions (e.g., 0.1 for $100K, 1 for $1M, 1000 for $1B)\r\n\r\n        // Check if marketCap exists\r\n        if (!opp.marketCap) {\r\n          return false;\r\n        }\r\n\r\n        // Ensure both values are numbers\r\n        const oppMarketCap = typeof opp.marketCap === 'number' ? opp.marketCap : parseFloat(String(opp.marketCap));\r\n        const filterValue = typeof minMarketCap === 'number' ? minMarketCap : parseFloat(String(minMarketCap));\r\n\r\n        // Check if marketCap exists and is within range\r\n        const hasValidMarketCap = !isNaN(oppMarketCap) && oppMarketCap > 0;\r\n        return hasValidMarketCap && oppMarketCap >= filterValue;\r\n      });\r\n\r\n      console.log(`[FundingRates] Market Cap Filter: ${beforeCount} ‚Üí ${opportunities.length} opportunities (‚â• $${minMarketCap}M)`);\r\n    }\r\n\r\n    return opportunities;\r\n  });\r\n\r\n  /**\r\n   * Sorted arbitrage opportunities based on current sort columns\r\n   */\r\n  sortedArbitrageOpportunities = computed(() => {\r\n    const opportunities = [...this.filteredArbitrageOpportunities()];\r\n    const sortCols = this.arbitrageSortColumns();\r\n\r\n    if (sortCols.length === 0) {\r\n      return opportunities;\r\n    }\r\n\r\n    return opportunities.sort((a, b) => {\r\n      // Apply each sort column in order\r\n      for (const { column, direction } of sortCols) {\r\n        let aVal: any;\r\n        let bVal: any;\r\n\r\n        // Extract values based on column\r\n        switch (column) {\r\n          case 'symbol':\r\n            aVal = a.symbol;\r\n            bVal = b.symbol;\r\n            break;\r\n          case 'primaryExchange':\r\n            // Sort by primary exchange name (HEDGED mode)\r\n            aVal = a.bestLong?.exchange || '';\r\n            bVal = b.bestLong?.exchange || '';\r\n            break;\r\n          case 'hedgeExchange':\r\n            // Sort by hedge exchange name (HEDGED mode)\r\n            aVal = a.bestShort?.exchange || '';\r\n            bVal = b.bestShort?.exchange || '';\r\n            break;\r\n          case 'spread':\r\n            // Sort by price spread (HEDGED mode)\r\n            aVal = parseFloat(a.spread || '0');\r\n            bVal = parseFloat(b.spread || '0');\r\n            break;\r\n          case 'fundingPeriodicity':\r\n            // Sort by funding periodicity (extract hours and minutes)\r\n            const parseTime = (periodicity: string | undefined): number => {\r\n              if (!periodicity) return 0;\r\n              const match = periodicity.match(/(\\d+)–≥\\s+(\\d+)—Ö–≤/);\r\n              if (match) {\r\n                const hours = parseInt(match[1], 10);\r\n                const minutes = parseInt(match[2], 10);\r\n                return hours * 60 + minutes; // Convert to total minutes\r\n              }\r\n              return 0;\r\n            };\r\n            aVal = parseTime(a.fundingPeriodicity);\r\n            bVal = parseTime(b.fundingPeriodicity);\r\n            break;\r\n          case 'fundingSpread':\r\n            // Sort by funding spread (HEDGED mode)\r\n            aVal = a.fundingSpread || 0;\r\n            bVal = b.fundingSpread || 0;\r\n            break;\r\n          case 'funding':\r\n            // For NON_HEDGED mode: find maximum funding rate by absolute value,\r\n            // but use the actual signed value for sorting (descending)\r\n            // For HEDGED mode: use bestLong funding rate\r\n            const mode = this.arbitrageMode();\r\n\r\n            if (mode === 'NON_HEDGED') {\r\n              // Find exchange with maximum absolute funding rate\r\n              const aLongRate = parseFloat(a.bestLong?.fundingRate || '0');\r\n              const aShortRate = parseFloat(a.bestShort?.fundingRate || '0');\r\n              const bLongRate = parseFloat(b.bestLong?.fundingRate || '0');\r\n              const bShortRate = parseFloat(b.bestShort?.fundingRate || '0');\r\n\r\n              // Use the rate with higher absolute value, keeping the sign\r\n              aVal = Math.abs(aLongRate) >= Math.abs(aShortRate) ? aLongRate : aShortRate;\r\n              bVal = Math.abs(bLongRate) >= Math.abs(bShortRate) ? bLongRate : bShortRate;\r\n            } else {\r\n              // HEDGED mode: use bestLong funding rate\r\n              aVal = parseFloat(a.bestLong?.fundingRate || '0');\r\n              bVal = parseFloat(b.bestLong?.fundingRate || '0');\r\n            }\r\n            break;\r\n          case 'nextFunding':\r\n            // Get the next funding time from the exchange with highest absolute funding rate\r\n            // This matches the display logic in NON_HEDGED mode\r\n            const aAbsLong = Math.abs(parseFloat(a.bestLong?.fundingRate || '0'));\r\n            const aAbsShort = Math.abs(parseFloat(a.bestShort?.fundingRate || '0'));\r\n            const bAbsLong = Math.abs(parseFloat(b.bestLong?.fundingRate || '0'));\r\n            const bAbsShort = Math.abs(parseFloat(b.bestShort?.fundingRate || '0'));\r\n\r\n            // Determine which exchange to use for each opportunity (matches UI display logic)\r\n            const useALong = aAbsLong >= aAbsShort;\r\n            const useBLong = bAbsLong >= bAbsShort;\r\n\r\n            const aExchange = a.exchanges?.find((ex: any) =>\r\n              ex.exchange === (useALong ? a.bestLong?.exchange : a.bestShort?.exchange) &&\r\n              ex.credentialId === (useALong ? a.bestLong?.credentialId : a.bestShort?.credentialId)\r\n            );\r\n            const bExchange = b.exchanges?.find((ex: any) =>\r\n              ex.exchange === (useBLong ? b.bestLong?.exchange : b.bestShort?.exchange) &&\r\n              ex.credentialId === (useBLong ? b.bestLong?.credentialId : b.bestShort?.credentialId)\r\n            );\r\n            aVal = parseInt(aExchange?.nextFundingTime?.toString() || '0');\r\n            bVal = parseInt(bExchange?.nextFundingTime?.toString() || '0');\r\n            break;\r\n          case 'position':\r\n            // Sort by position type (LONG or SHORT based on funding rate)\r\n            const aFunding = parseFloat(a.bestLong?.fundingRate || '0');\r\n            const bFunding = parseFloat(b.bestLong?.fundingRate || '0');\r\n            aVal = aFunding < 0 ? 'LONG' : 'SHORT';\r\n            bVal = bFunding < 0 ? 'LONG' : 'SHORT';\r\n            break;\r\n          default:\r\n            continue;\r\n        }\r\n\r\n        // Compare values\r\n        let comparison = 0;\r\n        if (column === 'symbol' || column === 'position' || column === 'primaryExchange' || column === 'hedgeExchange') {\r\n          // String comparison\r\n          if (aVal > bVal) comparison = 1;\r\n          else if (aVal < bVal) comparison = -1;\r\n        } else {\r\n          // Numeric comparison\r\n          const aNum = typeof aVal === 'number' ? aVal : parseFloat(aVal) || 0;\r\n          const bNum = typeof bVal === 'number' ? bVal : parseFloat(bVal) || 0;\r\n          if (aNum > bNum) comparison = 1;\r\n          else if (aNum < bNum) comparison = -1;\r\n        }\r\n\r\n        // If values are different, apply direction and return\r\n        if (comparison !== 0) {\r\n          return direction === 'asc' ? comparison : -comparison;\r\n        }\r\n\r\n        // If values are equal, continue to next sort column\r\n      }\r\n\r\n      return 0; // All sort columns equal\r\n    });\r\n  });\r\n\r\n  /**\r\n   * Set of symbols with active subscriptions for efficient lookup\r\n   */\r\n  subscribedSymbols = computed(() => {\r\n    const subs = Array.from(this.subscriptions().values());\r\n    const symbols = new Set(subs.map(sub => sub.symbol));\r\n    console.log('[subscribedSymbols] Computed signal updated. Active symbols:', Array.from(symbols));\r\n    return symbols;\r\n  });\r\n\r\n  /**\r\n   * Map of symbol to subscription for quick lookup in arbitrage table\r\n   */\r\n  symbolToSubscription = computed(() => {\r\n    const subs = Array.from(this.subscriptions().values());\r\n    const map = new Map<string, FundingSubscription>();\r\n    subs.forEach(sub => {\r\n      // Normalize symbol format (remove hyphens for comparison)\r\n      const normalizedSymbol = sub.symbol.replace(/-/g, '');\r\n      map.set(normalizedSymbol, sub);\r\n    });\r\n    console.log('[symbolToSubscription] Map keys:', Array.from(map.keys()));\r\n    return map;\r\n  });\r\n\r\n  /**\r\n   * Position validation error - tracks why position calculation might fail\r\n   */\r\n  positionValidationError = computed(() => {\r\n    const ticker = this.selectedTicker();\r\n    const positionSizeUsdt = this.positionSizeUsdt();\r\n\r\n    if (!ticker) {\r\n      return 'No symbol selected';\r\n    }\r\n\r\n    if (!positionSizeUsdt || positionSizeUsdt <= 0) {\r\n      return 'Invalid position size';\r\n    }\r\n\r\n    // Check if price data is available\r\n    const lastPrice = parseFloat(ticker.lastPrice) || 0;\r\n    const markPrice = parseFloat(ticker.markPrice) || 0;\r\n\r\n    if (lastPrice === 0 && markPrice === 0) {\r\n      return `No price data available for ${ticker.symbol}. This symbol may not be actively traded or may be delisted.`;\r\n    }\r\n\r\n    return null;\r\n  });\r\n\r\n  /**\r\n   * Position calculation computed signal - automatically recalculates when dependencies change\r\n   * Uses dialogLeverage for dialog-specific leverage (separate from global settings)\r\n   */\r\n  positionCalculation = computed(() => {\r\n    const ticker = this.selectedTicker();\r\n    const positionSizeUsdt = this.positionSizeUsdt();\r\n    const leverage = this.dialogLeverage(); // Use dialog-specific leverage\r\n\r\n    console.log('[positionCalculation] Computing with:', {\r\n      ticker: ticker?.symbol,\r\n      positionSizeUsdt,\r\n      leverage,\r\n      tickerLastPrice: ticker?.lastPrice,\r\n      tickerMarkPrice: ticker?.markPrice\r\n    });\r\n\r\n    if (!ticker || !positionSizeUsdt || positionSizeUsdt <= 0) {\r\n      console.log('[positionCalculation] Returning null - missing dependencies');\r\n      return null;\r\n    }\r\n\r\n    // Use last price or mark price as estimate\r\n    const estimatedPrice = parseFloat(ticker.lastPrice) || parseFloat(ticker.markPrice) || 0;\r\n\r\n    if (estimatedPrice === 0) {\r\n      console.log('[positionCalculation] Returning null - price is 0');\r\n      return null;\r\n    }\r\n\r\n    // positionSizeUsdt is the margin (your own money)\r\n    // With leverage, actual position value = margin * leverage\r\n    const margin = positionSizeUsdt;\r\n    const positionValue = margin * leverage;\r\n\r\n    // Calculate quantity from position value: quantity = positionValue / price\r\n    const quantity = positionValue / estimatedPrice;\r\n\r\n    // Estimate trading fee (typical taker fee: 0.055% for Bybit, 0.05% for BingX)\r\n    // For both entry and exit, fee = position value * 0.00055 * 2\r\n    const estimatedFee = positionValue * 0.00055 * 2; // Entry + Exit\r\n\r\n    const result = {\r\n      symbol: ticker.symbol,\r\n      quantity,\r\n      estimatedPrice,\r\n      positionValue,\r\n      requiredMargin: margin,\r\n      estimatedFee,\r\n      leverage\r\n    };\r\n\r\n    console.log('[positionCalculation] Returning:', result);\r\n    return result;\r\n  });\r\n\r\n  /**\r\n   * Profit calculation computed signal - calculates expected funding earnings\r\n   * Accounts for HEDGED vs NON_HEDGED modes\r\n   */\r\n  profitCalculation = computed(() => {\r\n    const ticker = this.selectedTicker();\r\n    const positionCalc = this.positionCalculation();\r\n    const mode = this.arbitrageMode();\r\n\r\n    if (!ticker || !positionCalc) {\r\n      return null;\r\n    }\r\n\r\n    const fundingRate = parseFloat(ticker.fundingRate);\r\n    const positionValue = positionCalc.positionValue;\r\n\r\n    // Calculate funding payment for primary position\r\n    const primaryFunding = positionValue * Math.abs(fundingRate);\r\n\r\n    // Estimate fees (entry + exit)\r\n    const estimatedFees = positionCalc.estimatedFee;\r\n\r\n    if (mode === 'HEDGED') {\r\n      // In hedged mode, assume hedge exchange has near-zero or opposite funding\r\n      // For now, we'll estimate hedge funding as 50% of primary (conservative)\r\n      const hedgeFunding = primaryFunding * 0.5;\r\n      const grossProfit = primaryFunding + hedgeFunding;\r\n      const netProfit = grossProfit - estimatedFees;\r\n\r\n      return {\r\n        primaryFunding,\r\n        hedgeFunding,\r\n        grossProfit,\r\n        estimatedFees,\r\n        netProfit,\r\n        profitPercent: (netProfit / (positionCalc.requiredMargin * 2)) * 100, // Total margin for both positions\r\n        mode: 'HEDGED'\r\n      };\r\n    } else {\r\n      // NON_HEDGED mode: single position\r\n      const grossProfit = primaryFunding;\r\n      const netProfit = grossProfit - estimatedFees;\r\n\r\n      return {\r\n        primaryFunding,\r\n        hedgeFunding: 0,\r\n        grossProfit,\r\n        estimatedFees,\r\n        netProfit,\r\n        profitPercent: (netProfit / positionCalc.requiredMargin) * 100,\r\n        mode: 'NON_HEDGED'\r\n      };\r\n    }\r\n  });\r\n\r\n  private refreshSubscription?: Subscription;\r\n\r\n  constructor() {\r\n    // Add effect to track mode changes\r\n    effect(() => {\r\n      const mode = this.arbitrageMode();\r\n      console.log('[Mode Toggle] Mode changed to:', mode);\r\n\r\n      // When switching to NON_HEDGED mode, clear hedge credential\r\n      if (mode === 'NON_HEDGED') {\r\n        console.log('[Mode Toggle] Clearing hedge credential for NON_HEDGED mode');\r\n        this.hedgeCredentialId.set(null);\r\n      }\r\n\r\n      // Update sorting based on mode\r\n      // HEDGED mode: Sort by spread (descending)\r\n      // NON_HEDGED mode: Sort by funding rate (descending, by absolute value)\r\n      if (mode === 'HEDGED') {\r\n        console.log('[Mode Toggle] Setting sort to spread (descending) for HEDGED mode');\r\n        this.arbitrageSortColumns.set([{ column: 'spread', direction: 'desc' }]);\r\n      } else {\r\n        console.log('[Mode Toggle] Setting sort to funding (descending) for NON_HEDGED mode');\r\n        this.arbitrageSortColumns.set([{ column: 'funding', direction: 'desc' }]);\r\n      }\r\n\r\n      // Restart streaming with new top 3 opportunities based on new sorting (if enabled)\r\n      if (this.enableRealtimeStreaming()) {\r\n        console.log('[Mode Toggle] Restarting real-time streaming with new mode');\r\n        this.startRealtimeStreaming();\r\n      }\r\n    }, { allowSignalWrites: true }); // Allow signal writes inside effect\r\n\r\n    // Add effect to handle feature flag changes\r\n    effect(() => {\r\n      const enabled = this.enableRealtimeStreaming();\r\n      console.log('[RealtimeStreaming] Feature flag changed to:', enabled);\r\n\r\n      if (enabled) {\r\n        console.log('[RealtimeStreaming] Starting real-time streaming');\r\n        this.startRealtimeStreaming();\r\n      } else {\r\n        console.log('[RealtimeStreaming] Stopping real-time streaming');\r\n        this.stopRealtimeStreaming();\r\n      }\r\n    }, { allowSignalWrites: true });\r\n  }\r\n\r\n  /**\r\n   * Set arbitrage mode with explicit logging for debugging\r\n   */\r\n  setArbitrageMode(mode: 'HEDGED' | 'NON_HEDGED'): void {\r\n    console.log('[setArbitrageMode] Button clicked! Current mode:', this.arbitrageMode(), '-> New mode:', mode);\r\n    this.arbitrageMode.set(mode);\r\n    console.log('[setArbitrageMode] Mode updated to:', this.arbitrageMode());\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.loadSettings();\r\n    this.loadCredentials();\r\n    this.loadSubscriptions();\r\n    this.loadActiveBybitStrategies(); // Load active Bybit funding strategies\r\n    this.loadArbitrageOpportunities(); // Load cross-exchange arbitrage data (initial load)\r\n    this.startArbitrageAutoRefresh(); // Start auto-refresh every 15 seconds\r\n    this.startAutoCancelChecker();\r\n    this.syncSettingsToFilters();\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    if (this.refreshSubscription) {\r\n      this.refreshSubscription.unsubscribe();\r\n    }\r\n    if (this.autoCancelInterval) {\r\n      clearInterval(this.autoCancelInterval);\r\n    }\r\n    if (this.arbitrageRefreshInterval) {\r\n      clearInterval(this.arbitrageRefreshInterval);\r\n      console.log('[ArbitrageAutoRefresh] Auto-refresh stopped');\r\n    }\r\n    // Disconnect from real-time streaming\r\n    if (this.priceUpdateSubscription) {\r\n      this.priceUpdateSubscription.unsubscribe();\r\n    }\r\n    this.arbitrageStreamService.disconnect();\r\n  }\r\n\r\n  translate(key: string): string {\r\n    return this.translationService.translate(key);\r\n  }\r\n\r\n  loadCredentials(): void {\r\n    this.isLoadingCredentials.set(true);\r\n    const token = this.authService.authState().token;\r\n    if (!token) {\r\n      this.error.set('Authentication required');\r\n      this.isLoadingCredentials.set(false);\r\n      return;\r\n    }\r\n\r\n    const headers = new HttpHeaders({\r\n      'Authorization': `Bearer ${token}`\r\n    });\r\n\r\n    this.http.get<any>('http://localhost:3000/api/exchange-credentials', { headers })\r\n      .subscribe({\r\n        next: (response) => {\r\n          console.log('Credentials response:', response);\r\n\r\n          if (response.success && response.data) {\r\n            // API returns { credentials: [], totalCount: number }\r\n            const credentialsArray = response.data.credentials || [];\r\n            console.log('Credentials array:', credentialsArray);\r\n\r\n            // Filter for active credentials only (all exchanges supported)\r\n            const activeCredentials = credentialsArray.filter((c: ExchangeCredential) =>\r\n              c.isActive === true\r\n            );\r\n            this.credentials.set(activeCredentials);\r\n\r\n            console.log('Active credentials:', activeCredentials);\r\n\r\n            // Auto-select first credential (all are active now)\r\n            const defaultCred = activeCredentials[0];\r\n            if (defaultCred) {\r\n              this.selectedCredentialId.set(defaultCred.id);\r\n              this.loadTickers();\r\n              this.setupAutoRefresh();\r\n            } else {\r\n              console.warn('No active credentials found');\r\n            }\r\n          }\r\n          this.isLoadingCredentials.set(false);\r\n        },\r\n        error: (err) => {\r\n          console.error('Failed to load credentials:', err);\r\n          this.error.set('Failed to load exchange credentials');\r\n          this.isLoadingCredentials.set(false);\r\n        }\r\n      });\r\n  }\r\n\r\n  onCredentialChange(credentialId: string): void {\r\n    this.selectedCredentialId.set(credentialId);\r\n    this.loadTickers();\r\n  }\r\n\r\n  setupAutoRefresh(): void {\r\n    if (this.refreshSubscription) {\r\n      this.refreshSubscription.unsubscribe();\r\n    }\r\n\r\n    if (this.autoRefreshEnabled()) {\r\n      // Refresh every 3 minutes (180 seconds)\r\n      this.refreshSubscription = interval(180000)\r\n        .pipe(\r\n          startWith(0),\r\n          switchMap(() => this.loadTickersAsync())\r\n        )\r\n        .subscribe();\r\n    }\r\n  }\r\n\r\n  toggleAutoRefresh(): void {\r\n    this.autoRefreshEnabled.update(v => !v);\r\n    this.setupAutoRefresh();\r\n  }\r\n\r\n  loadTickers(): void {\r\n    this.loadTickersAsync().subscribe();\r\n  }\r\n\r\n  private loadTickersAsync() {\r\n    const credential = this.selectedCredential();\r\n    if (!credential) {\r\n      return of(null);\r\n    }\r\n\r\n    // Prevent concurrent loading - skip if already loading\r\n    if (this.isLoading()) {\r\n      console.log('[FundingRates] Skipping refresh - already loading');\r\n      return of(null);\r\n    }\r\n\r\n    this.isLoading.set(true);\r\n    this.error.set(null);\r\n\r\n    const token = this.authService.authState().token;\r\n    if (!token) {\r\n      this.error.set('Authentication required');\r\n      this.isLoading.set(false);\r\n      return of(null);\r\n    }\r\n\r\n    const headers = new HttpHeaders({\r\n      'Authorization': `Bearer ${token}`\r\n    });\r\n\r\n    const exchange = credential.exchange;\r\n    const credentialId = credential.id;\r\n\r\n    // Determine API endpoint based on exchange\r\n    // Pass credentialId to use the specific selected credential\r\n    let apiUrl = '';\r\n    if (exchange === 'BYBIT') {\r\n      apiUrl = `http://localhost:3000/api/bybit/tickers?category=linear&credentialId=${credentialId}`;\r\n    } else if (exchange === 'BINGX') {\r\n      apiUrl = `http://localhost:3000/api/bingx/tickers?credentialId=${credentialId}`;\r\n    } else {\r\n      this.error.set(`Unsupported exchange: ${exchange}`);\r\n      this.isLoading.set(false);\r\n      return of(null);\r\n    }\r\n\r\n    return this.http.get<any>(apiUrl, { headers }).pipe(\r\n      switchMap(async (response) => {\r\n        try {\r\n          if (response.success) {\r\n            // Map BingX ticker format to match Bybit format if needed\r\n            let tickers = exchange === 'BINGX'\r\n              ? this.mapBingXTickers(response.data)\r\n              : response.data;\r\n\r\n            // For BingX, fetch funding rates separately and merge\r\n            if (exchange === 'BINGX') {\r\n              console.log('[BingX] Starting to merge funding rates...');\r\n              tickers = await this.mergeBingXFundingRates(tickers, headers, credentialId);\r\n              console.log('[BingX] Funding rates merged, updating table...');\r\n            }\r\n\r\n            this.tickers.set(tickers);\r\n            this.isLoading.set(false);\r\n            console.log(`[FundingRates] Updated ${tickers.length} tickers`);\r\n          } else {\r\n            this.error.set(response.message || 'Failed to load tickers');\r\n            this.isLoading.set(false);\r\n          }\r\n          return response;\r\n        } catch (error: any) {\r\n          console.error('[FundingRates] Error in loadTickersAsync:', error);\r\n          this.error.set(error.message || 'Failed to load data');\r\n          this.isLoading.set(false);\r\n          return null;\r\n        }\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Fetch BingX funding rates and merge with ticker data\r\n   */\r\n  private async mergeBingXFundingRates(tickers: TickerData[], headers: HttpHeaders, credentialId: string): Promise<TickerData[]> {\r\n    try {\r\n      console.log('[BingX] Fetching funding rates for', tickers.length, 'symbols...');\r\n      const fundingUrl = `${getEndpointUrl('bingx', 'fundingRates')}?credentialId=${credentialId}`;\r\n      const fundingResponse = await this.http.get<any>(\r\n        fundingUrl,\r\n        { headers }\r\n      ).toPromise();\r\n\r\n      console.log('[BingX] Funding rates response:', fundingResponse);\r\n\r\n      if (fundingResponse?.success && fundingResponse?.data) {\r\n        console.log('[BingX] Received', fundingResponse.data.length, 'funding rates');\r\n        const fundingMap = new Map<string, any>();\r\n        fundingResponse.data.forEach((fr: any) => {\r\n          fundingMap.set(fr.symbol, fr);\r\n        });\r\n\r\n        // Merge funding rates into tickers\r\n        const mergedTickers = tickers.map(ticker => {\r\n          const funding = fundingMap.get(ticker.symbol);\r\n          if (funding) {\r\n            return {\r\n              ...ticker,\r\n              fundingRate: funding.fundingRate || '0',\r\n              nextFundingTime: funding.fundingTime ? funding.fundingTime.toString() : '0'\r\n            };\r\n          }\r\n          return ticker;\r\n        });\r\n\r\n        console.log('[BingX] Merged funding rates into', mergedTickers.length, 'tickers');\r\n        return mergedTickers;\r\n      } else {\r\n        console.warn('[BingX] Invalid funding rates response:', fundingResponse);\r\n      }\r\n    } catch (error) {\r\n      console.error('[BingX] Failed to fetch funding rates:', error);\r\n    }\r\n\r\n    console.log('[BingX] Returning original tickers without funding rates');\r\n    return tickers;\r\n  }\r\n\r\n  /**\r\n   * Map BingX ticker format to Bybit ticker format for consistent display\r\n   */\r\n  private mapBingXTickers(bingxTickers: any[]): TickerData[] {\r\n    return bingxTickers.map(ticker => ({\r\n      symbol: ticker.symbol,\r\n      lastPrice: ticker.lastPrice || '0',\r\n      indexPrice: ticker.lastPrice || '0', // BingX doesn't have indexPrice, use lastPrice\r\n      markPrice: ticker.lastPrice || '0',\r\n      prevPrice24h: ticker.openPrice || '0',\r\n      price24hPcnt: ticker.priceChangePercent ? (parseFloat(ticker.priceChangePercent) / 100).toString() : '0',\r\n      highPrice24h: ticker.highPrice || '0',\r\n      lowPrice24h: ticker.lowPrice || '0',\r\n      prevPrice1h: ticker.openPrice || '0', // BingX doesn't have 1h price\r\n      openInterest: '0', // BingX doesn't provide this in ticker\r\n      openInterestValue: '0',\r\n      turnover24h: ticker.quoteVolume || '0',\r\n      volume24h: ticker.volume || '0',\r\n      fundingRate: '0', // BingX doesn't include funding rate in tickers - need separate call\r\n      nextFundingTime: '0',\r\n      predictedDeliveryPrice: '0',\r\n      basisRate: '0',\r\n      deliveryFeeRate: '0',\r\n      deliveryTime: '0',\r\n      ask1Size: '0',\r\n      bid1Price: '0',\r\n      ask1Price: '0',\r\n      bid1Size: '0'\r\n    }));\r\n  }\r\n\r\n  /**\r\n   * Load arbitrage opportunities from all exchanges\r\n   * @param silent If true, reduces console logging (for auto-refresh)\r\n   */\r\n  loadArbitrageOpportunities(silent = false): void {\r\n    // Prevent concurrent requests - skip if previous request is still in progress\r\n    if (this.isArbitrageRequestInProgress()) {\r\n      if (!silent) {\r\n        console.log('[Arbitrage] Skipping request - previous request still in progress');\r\n      }\r\n      return;\r\n    }\r\n\r\n    const token = this.authService.authState().token;\r\n    if (!token) {\r\n      this.arbitrageError.set('Authentication required');\r\n      return;\r\n    }\r\n\r\n    // Mark request as in progress\r\n    this.isArbitrageRequestInProgress.set(true);\r\n\r\n    // Don't show loading spinner for silent refresh\r\n    if (!silent) {\r\n      this.isLoadingArbitrage.set(true);\r\n    }\r\n    this.arbitrageError.set(null);\r\n\r\n    const headers = new HttpHeaders({\r\n      'Authorization': `Bearer ${token}`\r\n    });\r\n\r\n    const arbitrageUrl = getEndpointUrl('arbitrage', 'fundingRates');\r\n\r\n    this.http.get<any>(arbitrageUrl, { headers }).subscribe({\r\n      next: (response) => {\r\n        if (response.success) {\r\n          // Process data to add calculated fields\r\n          const processedData = (response.data || []).map((opportunity: any) => {\r\n            // Get the earliest next funding time from exchanges to calculate periodicity\r\n            const fundingTimes = opportunity.exchanges\r\n              .map((ex: any) => ex.nextFundingTime)\r\n              .filter((time: number) => time > 0);\r\n            const earliestFundingTime = fundingTimes.length > 0 ? Math.min(...fundingTimes) : 0;\r\n\r\n            // Calculate funding periodicity\r\n            const fundingPeriodicity = this.calculateFundingPeriodicity(earliestFundingTime);\r\n\r\n            // Calculate funding spread\r\n            const { spread, spreadPercent } = this.calculateFundingSpread(\r\n              opportunity.bestLong?.fundingRate || '0',\r\n              opportunity.bestShort?.fundingRate || '0'\r\n            );\r\n\r\n            return {\r\n              ...opportunity,\r\n              fundingPeriodicity,\r\n              fundingSpread: spread,\r\n              fundingSpreadPercent: spreadPercent\r\n            };\r\n          });\r\n\r\n          this.arbitrageOpportunities.set(processedData);\r\n\r\n          if (!silent) {\r\n            console.log(`[Arbitrage] Loaded ${processedData?.length || 0} opportunities`);\r\n            console.log('[Arbitrage] Opportunity symbols:', processedData?.map((o: any) => o.symbol));\r\n            console.log('[Arbitrage] First opportunity sample:', processedData?.[0]);\r\n\r\n            // üîç DETAILED VERIFICATION: Check bestLong/bestShort mapping for first 3 opportunities\r\n            console.log('='.repeat(80));\r\n            console.log('üîç HEDGED ARBITRAGE VERIFICATION - Primary vs Hedge Exchange');\r\n            console.log('='.repeat(80));\r\n          }\r\n\r\n          if (!silent) {\r\n            processedData?.slice(0, 3).forEach((opp: any, idx: number) => {\r\n              console.log(`\\n[${idx + 1}] Symbol: ${opp.symbol}`);\r\n              console.log('-'.repeat(60));\r\n\r\n              // Find the actual exchange data for bestLong and bestShort\r\n              const bestLongExchange = opp.exchanges.find((ex: any) =>\r\n                ex.exchange === opp.bestLong.exchange && ex.credentialId === opp.bestLong.credentialId\r\n              );\r\n              const bestShortExchange = opp.exchanges.find((ex: any) =>\r\n                ex.exchange === opp.bestShort.exchange && ex.credentialId === opp.bestShort.credentialId\r\n              );\r\n\r\n              console.log(`Primary Exchange (bestLong):`);\r\n              console.log(`  Exchange: ${opp.bestLong.exchange}`);\r\n              console.log(`  Price: $${bestLongExchange?.lastPrice || 'N/A'}`);\r\n              console.log(`  Funding: ${(parseFloat(bestLongExchange?.fundingRate || '0') * 100).toFixed(4)}%`);\r\n              console.log(`  ‚Üí This is where we LONG (BUY)`);\r\n\r\n              console.log(`\\nHedge Exchange (bestShort):`);\r\n              console.log(`  Exchange: ${opp.bestShort.exchange}`);\r\n              console.log(`  Price: $${bestShortExchange?.lastPrice || 'N/A'}`);\r\n              console.log(`  Funding: ${(parseFloat(bestShortExchange?.fundingRate || '0') * 100).toFixed(4)}%`);\r\n              console.log(`  ‚Üí This is where we SHORT (SELL)`);\r\n\r\n              console.log(`\\nSpread: ${opp.spreadPercent}% ($${opp.priceSpreadUsdt})`);\r\n\r\n              // Verify correctness\r\n              const primaryPrice = parseFloat(bestLongExchange?.lastPrice || '0');\r\n              const hedgePrice = parseFloat(bestShortExchange?.lastPrice || '0');\r\n\r\n              if (primaryPrice > 0 && hedgePrice > 0) {\r\n                if (primaryPrice < hedgePrice) {\r\n                  console.log(`‚úÖ CORRECT: Primary ($${primaryPrice}) < Hedge ($${hedgePrice})`);\r\n                  console.log(`   ‚Üí We BUY LOW and SELL HIGH = PROFIT`);\r\n                } else {\r\n                  console.log(`‚ùå ERROR: Primary ($${primaryPrice}) >= Hedge ($${hedgePrice})`);\r\n                  console.log(`   ‚Üí This would mean BUY HIGH and SELL LOW = LOSS!`);\r\n                }\r\n              }\r\n            });\r\n\r\n            console.log('\\n' + '='.repeat(80));\r\n          }\r\n\r\n          // Real-time streaming is now controlled by the enableRealtimeStreaming feature flag\r\n          // via effect in constructor - no need to start it here\r\n        } else {\r\n          this.arbitrageError.set(response.message || 'Failed to load arbitrage data');\r\n        }\r\n\r\n        // Mark request as completed\r\n        this.isArbitrageRequestInProgress.set(false);\r\n\r\n        // Only hide loading spinner if not in silent mode\r\n        if (!silent) {\r\n          this.isLoadingArbitrage.set(false);\r\n        }\r\n      },\r\n      error: (error) => {\r\n        if (!silent) {\r\n          console.error('[Arbitrage] Error loading opportunities:', error);\r\n        }\r\n        this.arbitrageError.set(error.message || 'Failed to load arbitrage data');\r\n\r\n        // Mark request as completed (even on error)\r\n        this.isArbitrageRequestInProgress.set(false);\r\n\r\n        // Only hide loading spinner if not in silent mode\r\n        if (!silent) {\r\n          this.isLoadingArbitrage.set(false);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  toggleArbitrageSection(): void {\r\n    this.showArbitrageSection.update(v => !v);\r\n  }\r\n\r\n  toggleArbitrageFilters(): void {\r\n    this.arbitrageFiltersCollapsed.update(v => !v);\r\n  }\r\n\r\n  /**\r\n   * Handle market cap filter change from dropdown\r\n   */\r\n  onMarketCapFilterChange(value: string): void {\r\n    if (value === '' || value === null) {\r\n      this.minMarketCapFilter.set(null);\r\n    } else {\r\n      this.minMarketCapFilter.set(parseFloat(value));\r\n    }\r\n  }\r\n\r\n  clearArbitrageFilters(): void {\r\n    this.arbitrageSearchQuery.set('');\r\n    this.minSpreadThreshold.set(null);\r\n    this.showOnlySubscribedArbitrage.set(false);\r\n    this.maxNextFundingHoursArbitrage.set(null);\r\n    this.minMarketCapFilter.set(null);\r\n    this.minMarketCapFilterValue.set('');\r\n  }\r\n\r\n  /**\r\n   * Start real-time price streaming for top arbitrage opportunities\r\n   *\r\n   * Algorithm:\r\n   * - HEDGED mode: Selects top 3 opportunities by maximum spread (descending)\r\n   * - NON_HEDGED mode: Selects top 3 opportunities by maximum absolute funding rate (descending, considering sign)\r\n   */\r\n  startRealtimeStreaming(): void {\r\n    // Check if feature is enabled\r\n    if (!this.enableRealtimeStreaming()) {\r\n      console.log('[RealtimeStream] Feature is disabled, skipping streaming');\r\n      return;\r\n    }\r\n\r\n    const token = this.authService.authState().token;\r\n    if (!token) {\r\n      console.warn('[RealtimeStream] Cannot start streaming: no auth token');\r\n      return;\r\n    }\r\n\r\n    const mode = this.arbitrageMode();\r\n\r\n    // Get top 3 opportunities based on current mode\r\n    // Sorting is already handled by sortedArbitrageOpportunities() computed signal\r\n    const opportunities = this.sortedArbitrageOpportunities();\r\n    if (opportunities.length === 0) {\r\n      console.log('[RealtimeStream] No opportunities to stream');\r\n      return;\r\n    }\r\n\r\n    // Select ONLY top 3 (not top 3 + bottom 3)\r\n    const selectedOpportunities = opportunities.slice(0, Math.min(3, opportunities.length));\r\n\r\n    console.log(`[RealtimeStream] Mode: ${mode}, Streaming top ${selectedOpportunities.length} opportunities`);\r\n\r\n    // Build subscription configuration\r\n    const symbols = new Set<string>();\r\n    const exchangeConfigs: any[] = [];\r\n\r\n    selectedOpportunities.forEach(opp => {\r\n      symbols.add(opp.symbol);\r\n\r\n      // Add all exchanges for this symbol\r\n      opp.exchanges.forEach(ex => {\r\n        // Find credential details\r\n        const credential = this.credentials().find(c => c.id === ex.credentialId);\r\n        if (credential) {\r\n          exchangeConfigs.push({\r\n            exchange: ex.exchange,\r\n            symbol: opp.symbol,\r\n            credentialId: ex.credentialId,\r\n            environment: ex.environment,\r\n          });\r\n        }\r\n      });\r\n    });\r\n\r\n    console.log(`[RealtimeStream] Starting stream for ${symbols.size} symbols across ${exchangeConfigs.length} exchanges`);\r\n\r\n    // Subscribe to price updates\r\n    this.arbitrageStreamService.subscribe(\r\n      {\r\n        symbols: Array.from(symbols),\r\n        exchanges: exchangeConfigs,\r\n      },\r\n      token\r\n    );\r\n\r\n    // Listen to price updates\r\n    if (this.priceUpdateSubscription) {\r\n      this.priceUpdateSubscription.unsubscribe();\r\n    }\r\n\r\n    this.priceUpdateSubscription = this.arbitrageStreamService.getPriceUpdates().subscribe({\r\n      next: (update: PriceUpdate) => {\r\n        this.handlePriceUpdate(update);\r\n      },\r\n      error: (error) => {\r\n        console.error('[RealtimeStream] Error receiving price updates:', error);\r\n      }\r\n    });\r\n\r\n    // Track connection state\r\n    this.arbitrageStreamService.getConnectionState().subscribe((state) => {\r\n      this.isStreamConnected.set(state === 'connected');\r\n      console.log('[RealtimeStream] Connection state:', state);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Handle real-time price update from SSE stream\r\n   */\r\n  handlePriceUpdate(update: PriceUpdate): void {\r\n    const key = `${update.exchange}:${update.symbol}`;\r\n\r\n    // Get previous price for change detection\r\n    const currentPrices = this.realtimePrices();\r\n    const previousEntry = currentPrices.get(key);\r\n\r\n    // Determine price change direction\r\n    let change: 'up' | 'down' | 'neutral' = 'neutral';\r\n    if (previousEntry) {\r\n      if (update.price > previousEntry.price) {\r\n        change = 'up';\r\n      } else if (update.price < previousEntry.price) {\r\n        change = 'down';\r\n      }\r\n    }\r\n\r\n    // Update prices map\r\n    const updatedPrices = new Map(currentPrices);\r\n    updatedPrices.set(key, {\r\n      price: update.price,\r\n      change,\r\n      timestamp: update.timestamp,\r\n    });\r\n    this.realtimePrices.set(updatedPrices);\r\n\r\n    // Trigger change detection\r\n    this.cdr.markForCheck();\r\n\r\n    console.log(`[RealtimeStream] Price update: ${update.exchange} ${update.symbol} = $${update.price.toFixed(2)} (${change})`);\r\n  }\r\n\r\n  /**\r\n   * Get real-time price for a specific exchange-symbol pair\r\n   */\r\n  getRealtimePrice(exchange: string, symbol: string): { price: number; change: 'up' | 'down' | 'neutral' } | null {\r\n    const key = `${exchange}:${symbol}`;\r\n    const entry = this.realtimePrices().get(key);\r\n    return entry ? { price: entry.price, change: entry.change } : null;\r\n  }\r\n\r\n  /**\r\n   * Stop real-time price streaming\r\n   */\r\n  stopRealtimeStreaming(): void {\r\n    console.log('[RealtimeStream] Stopping real-time streaming');\r\n\r\n    // Unsubscribe from price updates\r\n    if (this.priceUpdateSubscription) {\r\n      this.priceUpdateSubscription.unsubscribe();\r\n      this.priceUpdateSubscription = null;\r\n    }\r\n\r\n    // Disconnect from SSE stream\r\n    this.arbitrageStreamService.disconnect();\r\n\r\n    // Clear cached prices\r\n    this.realtimePrices.set(new Map());\r\n    this.isStreamConnected.set(false);\r\n\r\n    console.log('[RealtimeStream] Streaming stopped');\r\n  }\r\n\r\n  /**\r\n   * Cancel all active subscriptions\r\n   * Always fetches fresh subscription data from server and deletes all of them\r\n   */\r\n  async cancelAllSubscriptions(): Promise<void> {\r\n    try {\r\n      const token = this.authService.authState().token;\r\n      if (!token) {\r\n        this.showNotification('Authentication required', 'error');\r\n        return;\r\n      }\r\n\r\n      const headers = new HttpHeaders({\r\n        'Authorization': `Bearer ${token}`\r\n      });\r\n\r\n      // Step 1: Fetch all subscriptions from server (to ensure we have the complete list)\r\n      const response = await this.http.get<any>(\r\n        'http://localhost:3000/api/funding-arbitrage/subscribe',\r\n        { headers }\r\n      ).toPromise();\r\n\r\n      if (!response?.success || !response?.data) {\r\n        this.showNotification('Failed to fetch subscriptions from server', 'error');\r\n        return;\r\n      }\r\n\r\n      // Filter only active subscriptions (not completed)\r\n      const serverSubscriptions = response.data.filter((sub: any) => sub.status !== 'COMPLETED');\r\n\r\n      if (serverSubscriptions.length === 0) {\r\n        this.showNotification('No active subscriptions found on server', 'info');\r\n        // Still clear local state\r\n        this.subscriptions.set(new Map());\r\n        return;\r\n      }\r\n\r\n      // Step 2: Show confirmation dialog with server count\r\n      const confirmed = confirm(\r\n        `Are you sure you want to cancel ALL ${serverSubscriptions.length} active subscriptions?\\n\\n` +\r\n        `This will delete all subscriptions from the database.\\n` +\r\n        `This action cannot be undone.`\r\n      );\r\n\r\n      if (!confirmed) {\r\n        return;\r\n      }\r\n\r\n      // Step 3: Delete all subscriptions in parallel\r\n      console.log('[cancelAllSubscriptions] Deleting', serverSubscriptions.length, 'subscriptions');\r\n      const cancelPromises = serverSubscriptions.map((sub: any) =>\r\n        this.http.delete<any>(\r\n          `http://localhost:3000/api/funding-arbitrage/subscribe?subscriptionId=${sub.subscriptionId}`,\r\n          { headers }\r\n        ).toPromise()\r\n      );\r\n\r\n      await Promise.all(cancelPromises);\r\n\r\n      // Step 4: Clear local state\r\n      this.subscriptions.set(new Map());\r\n\r\n      this.showNotification(`Successfully cancelled all ${serverSubscriptions.length} subscriptions`, 'success');\r\n\r\n      // Reload subscriptions to verify they're gone\r\n      this.loadSubscriptions();\r\n    } catch (error: any) {\r\n      console.error('Error cancelling all subscriptions:', error);\r\n      this.showNotification('Failed to cancel some subscriptions. Please try again.', 'error');\r\n\r\n      // Reload subscriptions to get current state\r\n      this.loadSubscriptions();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sort by column with multi-sort support\r\n   * - Click: Single column sort (replaces all)\r\n   * - Shift+Click: Add column to multi-sort\r\n   * - Click same column: Toggle direction\r\n   */\r\n  sortBy(column: string, event?: MouseEvent): void {\r\n    const currentSorts = this.sortColumns();\r\n    const existingIndex = currentSorts.findIndex(s => s.column === column);\r\n\r\n    if (event?.shiftKey) {\r\n      // Shift+Click: Add to multi-sort or toggle existing\r\n      if (existingIndex >= 0) {\r\n        // Toggle direction of existing sort\r\n        const updated = [...currentSorts];\r\n        updated[existingIndex] = {\r\n          column,\r\n          direction: updated[existingIndex].direction === 'asc' ? 'desc' : 'asc'\r\n        };\r\n        this.sortColumns.set(updated);\r\n      } else {\r\n        // Add new sort column\r\n        this.sortColumns.set([...currentSorts, { column, direction: 'desc' }]);\r\n      }\r\n    } else {\r\n      // Regular click: Single column sort\r\n      if (existingIndex === 0 && currentSorts.length === 1) {\r\n        // Same column, toggle direction\r\n        this.sortColumns.set([{\r\n          column,\r\n          direction: currentSorts[0].direction === 'asc' ? 'desc' : 'asc'\r\n        }]);\r\n      } else {\r\n        // New column, default to descending\r\n        this.sortColumns.set([{ column, direction: 'desc' }]);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get sort info for a column (for display)\r\n   */\r\n  getSortInfo(column: string): { index: number; direction: 'asc' | 'desc' } | null {\r\n    const sorts = this.sortColumns();\r\n    const index = sorts.findIndex(s => s.column === column);\r\n    if (index === -1) return null;\r\n    return { index, direction: sorts[index].direction };\r\n  }\r\n\r\n  /**\r\n   * Clear all sorting\r\n   */\r\n  clearSort(): void {\r\n    this.sortColumns.set([{ column: 'fundingRate', direction: 'desc' }]);\r\n  }\r\n\r\n  /**\r\n   * Sort arbitrage table by column with multi-sort support\r\n   * - Click: Single column sort (replaces all)\r\n   * - Shift+Click: Add column to multi-sort\r\n   * - Click same column: Toggle direction\r\n   */\r\n  sortArbitrageBy(column: string, event?: MouseEvent): void {\r\n    const currentSorts = this.arbitrageSortColumns();\r\n    const existingIndex = currentSorts.findIndex(s => s.column === column);\r\n\r\n    if (event?.shiftKey) {\r\n      // Shift+Click: Add to multi-sort or toggle existing\r\n      if (existingIndex >= 0) {\r\n        // Toggle direction of existing sort\r\n        const updated = [...currentSorts];\r\n        updated[existingIndex] = {\r\n          column,\r\n          direction: updated[existingIndex].direction === 'asc' ? 'desc' : 'asc'\r\n        };\r\n        this.arbitrageSortColumns.set(updated);\r\n      } else {\r\n        // Add new sort column\r\n        this.arbitrageSortColumns.set([...currentSorts, { column, direction: 'desc' }]);\r\n      }\r\n    } else {\r\n      // Regular click: Single column sort\r\n      if (existingIndex === 0 && currentSorts.length === 1) {\r\n        // Same column, toggle direction\r\n        this.arbitrageSortColumns.set([{\r\n          column,\r\n          direction: currentSorts[0].direction === 'asc' ? 'desc' : 'asc'\r\n        }]);\r\n      } else {\r\n        // New column, default to descending\r\n        this.arbitrageSortColumns.set([{ column, direction: 'desc' }]);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get sort info for arbitrage table column (for display)\r\n   */\r\n  getArbitrageSortInfo(column: string): { index: number; direction: 'asc' | 'desc' } | null {\r\n    const sorts = this.arbitrageSortColumns();\r\n    const index = sorts.findIndex(s => s.column === column);\r\n    if (index === -1) return null;\r\n    return { index, direction: sorts[index].direction };\r\n  }\r\n\r\n  /**\r\n   * Clear arbitrage table sorting - resets to mode-specific default\r\n   */\r\n  clearArbitrageSort(): void {\r\n    const mode = this.arbitrageMode();\r\n    const defaultColumn = mode === 'HEDGED' ? 'spread' : 'funding';\r\n    console.log(`[clearArbitrageSort] Resetting sort to ${defaultColumn} for ${mode} mode`);\r\n    this.arbitrageSortColumns.set([{ column: defaultColumn, direction: 'desc' }]);\r\n  }\r\n\r\n  clearFilters(): void {\r\n    this.searchQuery.set('');\r\n    this.positionType.set('all');\r\n    this.minAbsFundingRate.set(null);\r\n    this.maxNextFundingHours.set(null);\r\n  }\r\n\r\n  toggleFiltersCollapsed(): void {\r\n    this.isFiltersCollapsed.update(v => !v);\r\n  }\r\n\r\n  formatPrice(price: string): string {\r\n    const num = parseFloat(price);\r\n    if (isNaN(num)) return '-';\r\n    return num.toLocaleString('en-US', {\r\n      minimumFractionDigits: 2,\r\n      maximumFractionDigits: 6\r\n    });\r\n  }\r\n\r\n  formatFundingRate(rate: string): string {\r\n    const num = parseFloat(rate);\r\n    if (isNaN(num)) return '-';\r\n    const percentage = (num * 100).toFixed(4);\r\n    return `${percentage}%`;\r\n  }\r\n\r\n  formatAnnualizedRate(rate: string): string {\r\n    const num = parseFloat(rate);\r\n    if (isNaN(num)) return '-';\r\n    // Bybit charges funding every 8 hours (3 times per day)\r\n    const annualized = num * 3 * 365 * 100;\r\n    return `${annualized.toFixed(2)}%`;\r\n  }\r\n\r\n  formatPercent(value: string): string {\r\n    const num = parseFloat(value);\r\n    if (isNaN(num)) return '-';\r\n    const percentage = (num * 100).toFixed(2);\r\n    return `${num >= 0 ? '+' : ''}${percentage}%`;\r\n  }\r\n\r\n  formatNextFundingTime(timestamp: string | number): string {\r\n    const ts = typeof timestamp === 'string' ? parseInt(timestamp) : timestamp;\r\n    if (isNaN(ts)) return '-';\r\n\r\n    const date = new Date(ts);\r\n    const now = new Date();\r\n    const diff = date.getTime() - now.getTime();\r\n\r\n    if (diff < 0) return 'Expired';\r\n\r\n    const hours = Math.floor(diff / (1000 * 60 * 60));\r\n    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));\r\n\r\n    return `${hours}h ${minutes}m`;\r\n  }\r\n\r\n  formatVolume(volume: string): string {\r\n    const num = parseFloat(volume);\r\n    if (isNaN(num)) return '-';\r\n\r\n    if (num >= 1000000000) {\r\n      return `$${(num / 1000000000).toFixed(2)}B`;\r\n    } else if (num >= 1000000) {\r\n      return `$${(num / 1000000).toFixed(2)}M`;\r\n    } else if (num >= 1000) {\r\n      return `$${(num / 1000).toFixed(2)}K`;\r\n    }\r\n    return `$${num.toFixed(2)}`;\r\n  }\r\n\r\n  getFundingRateClass(rate: string): string {\r\n    const num = parseFloat(rate);\r\n    if (isNaN(num)) return '';\r\n\r\n    if (num > 0) return 'funding-positive';\r\n    if (num < 0) return 'funding-negative';\r\n    return 'funding-neutral';\r\n  }\r\n\r\n  getPercentClass(value: string): string {\r\n    const num = parseFloat(value);\r\n    if (isNaN(num)) return '';\r\n\r\n    if (num > 0) return 'percent-positive';\r\n    if (num < 0) return 'percent-negative';\r\n    return '';\r\n  }\r\n\r\n  /**\r\n   * Check if a ticker meets the auto-subscribe threshold\r\n   */\r\n  tickerMeetsThreshold(symbol: string): boolean {\r\n    return this.meetsAutoSubscribeThreshold().has(symbol);\r\n  }\r\n\r\n  /**\r\n   * Get the recommended position type based on funding rate\r\n   * Long if funding is negative (you receive funding)\r\n   * Short if funding is positive (you receive funding)\r\n   */\r\n  getRecommendedPositionType(ticker: TickerData): 'long' | 'short' {\r\n    const fundingRate = parseFloat(ticker.fundingRate);\r\n    return fundingRate < 0 ? 'long' : 'short';\r\n  }\r\n\r\n  /**\r\n   * Start subscription execution immediately (manual trigger)\r\n   */\r\n  async startSubscriptionNow(subscriptionId: string): Promise<void> {\r\n    // Prevent duplicate executions\r\n    if (this.startingSubscriptionId() === subscriptionId) {\r\n      console.log('Already starting this subscription, ignoring duplicate request');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      this.startingSubscriptionId.set(subscriptionId);\r\n\r\n      const token = this.authService.authState().token;\r\n      if (!token) {\r\n        this.showNotification('Authentication required', 'error');\r\n        this.startingSubscriptionId.set(null);\r\n        return;\r\n      }\r\n\r\n      const response = await fetch(`/api/funding-arbitrage/execute/${subscriptionId}`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n      });\r\n\r\n      const result = await response.json();\r\n\r\n      if (result.success) {\r\n        this.showNotification('Subscription execution started!', 'success');\r\n        this.loadSubscriptions();\r\n      } else {\r\n        this.showNotification(`Failed to start: ${result.message || result.error}`, 'error');\r\n      }\r\n    } catch (error: any) {\r\n      console.error('Start subscription error:', error);\r\n      this.showNotification('Failed to start subscription execution', 'error');\r\n    } finally {\r\n      this.startingSubscriptionId.set(null);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Open subscription dialog for funding rate\r\n   */\r\n  openSubscriptionDialog(ticker: TickerData, event: Event): void {\r\n    event.stopPropagation();\r\n    this.selectedTicker.set(ticker);\r\n    this.dialogLeverage.set(this.subscriptionSettings().leverage); // Initialize with global setting\r\n    this.showSubscriptionDialog.set(true);\r\n    this.positionSizeUsdt.set(100); // Default position size in USDT\r\n  }\r\n\r\n  /**\r\n   * Close subscription dialog\r\n   */\r\n  closeSubscriptionDialog(): void {\r\n    this.showSubscriptionDialog.set(false);\r\n    this.selectedTicker.set(null);\r\n    this.editingSubscription.set(null);\r\n    this.isSubscribing.set(false);\r\n    this.hedgeCredentialId.set(null); // Clear hedge credential\r\n    this.dialogLeverage.set(this.subscriptionSettings().leverage); // Reset to global setting\r\n  }\r\n\r\n  /**\r\n   * Toggle row expansion for inline subscription form\r\n   */\r\n\r\n  /**\r\n   * Get active subscription for a symbol\r\n   */\r\n  getActiveSubscription(symbol: string): FundingSubscription | undefined {\r\n    // Find subscription by symbol (subscriptions Map is keyed by subscriptionId)\r\n    const subs = Array.from(this.subscriptions().values());\r\n    return subs.find(sub => sub.symbol === symbol);\r\n  }\r\n\r\n  /**\r\n   * Subscribe from inline form or action button\r\n   */\r\n  subscribeFromInlineForm(ticker: TickerData): void {\r\n    this.selectedTicker.set(ticker);\r\n    // Use default quantity or the one set in expanded form\r\n    if (!this.isRowExpanded(ticker.symbol)) {\r\n      this.positionSizeUsdt.set(100); // Default position size in USDT\r\n    }\r\n    this.subscribeFundingRate();\r\n  }\r\n\r\n  /**\r\n   * Check if subscription can be started now\r\n   */\r\n  canStartNow(subscription: FundingSubscription): boolean {\r\n    // Can start now if waiting and more than 1 minute until funding\r\n    return subscription.countdown !== undefined && subscription.countdown > 60;\r\n  }\r\n\r\n  /**\r\n   * Cancel a subscription (wrapper for unsubscribe)\r\n   */\r\n  async cancelSubscription(subscriptionId: string): Promise<void> {\r\n    await this.unsubscribe(subscriptionId, false);\r\n  }\r\n\r\n  /**\r\n   * Load settings from localStorage\r\n   */\r\n  loadSettings(): void {\r\n    const saved = localStorage.getItem('fundingSubscriptionSettings');\r\n    if (saved) {\r\n      try {\r\n        const settings = JSON.parse(saved) as SubscriptionSettings;\r\n        this.subscriptionSettings.set(settings);\r\n        this.positionSizeUsdt.set(100); // Default position size in USDT\r\n      } catch (error) {\r\n        console.error('Failed to load settings:', error);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Save settings to localStorage\r\n   */\r\n  saveSettings(): void {\r\n    const settings = this.subscriptionSettings();\r\n    localStorage.setItem('fundingSubscriptionSettings', JSON.stringify(settings));\r\n    // Position size is now in USDT, not affected by settings.defaultQuantity\r\n    this.syncSettingsToFilters();\r\n    this.showSettingsDialog.set(false);\r\n    this.showNotification('Settings saved successfully', 'success');\r\n  }\r\n\r\n  /**\r\n   * Sync settings to filters (threshold becomes min funding rate filter AND min spread filter)\r\n   */\r\n  syncSettingsToFilters(): void {\r\n    const settings = this.subscriptionSettings();\r\n    if (settings.autoCancelThreshold !== null && settings.autoCancelThreshold !== undefined) {\r\n      // Convert from decimal (0.003) to percentage (0.3%) for the filter\r\n      const thresholdPercent = Math.abs(settings.autoCancelThreshold) * 100;\r\n      this.minAbsFundingRate.set(thresholdPercent);\r\n      // Also sync to arbitrage min spread filter\r\n      this.minSpreadThreshold.set(thresholdPercent);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Open settings dialog\r\n   */\r\n  openSettingsDialog(): void {\r\n    this.showSettingsDialog.set(true);\r\n  }\r\n\r\n  /**\r\n   * Close settings dialog\r\n   */\r\n  closeSettingsDialog(): void {\r\n    this.showSettingsDialog.set(false);\r\n    this.loadSettings(); // Reload to reset any unsaved changes\r\n  }\r\n\r\n  /**\r\n   * Open trade history dialog\r\n   * @param symbol - Optional symbol filter (e.g., 'BTCUSDT')\r\n   * @param exchange - Optional exchange filter (e.g., 'BYBIT')\r\n   */\r\n  openTradeHistoryDialog(symbol?: string, exchange?: string): void {\r\n    console.log('[FundingRates] Opening trade history dialog', { symbol, exchange });\r\n\r\n    // Set dialog parameters\r\n    this.tradeHistorySymbol.set(symbol);\r\n    this.tradeHistoryExchange.set(exchange);\r\n\r\n    // Open dialog\r\n    this.showTradeHistoryDialog.set(true);\r\n  }\r\n\r\n  /**\r\n   * Start auto-cancel checker (runs every 30 seconds)\r\n   */\r\n  private autoCancelInterval?: any;\r\n  private arbitrageRefreshInterval?: any;\r\n\r\n  startAutoCancelChecker(): void {\r\n    this.autoCancelInterval = setInterval(() => {\r\n      this.checkAutoCancelConditions();\r\n    }, 30000); // Check every 30 seconds\r\n  }\r\n\r\n  /**\r\n   * Start arbitrage opportunities auto-refresh (runs every 15 seconds)\r\n   * Silently updates the table data without UI reload\r\n   */\r\n  startArbitrageAutoRefresh(): void {\r\n    // Clear existing interval if any\r\n    if (this.arbitrageRefreshInterval) {\r\n      clearInterval(this.arbitrageRefreshInterval);\r\n    }\r\n\r\n    // Start new interval - silent mode (no logs, no loading spinner)\r\n    this.arbitrageRefreshInterval = setInterval(() => {\r\n      this.loadArbitrageOpportunities(true); // true = silent mode\r\n      this.loadSubscriptions(); // Also refresh subscription data (including funding rates)\r\n      this.loadActiveBybitStrategies(); // Also refresh Bybit funding strategies\r\n    }, 60000); // Refresh every 60 seconds (1 minute)\r\n\r\n    console.log('[ArbitrageAutoRefresh] Auto-refresh started (60s interval, silent mode)');\r\n  }\r\n\r\n  /**\r\n   * Check if any subscriptions should be auto-cancelled based on funding rate threshold\r\n   * Only cancels if BOTH conditions are met:\r\n   * 1. Funding rate is below threshold\r\n   * 2. Less than 30 seconds remaining before execution\r\n   */\r\n  checkAutoCancelConditions(): void {\r\n    const settings = this.subscriptionSettings();\r\n    if (!settings.enableAutoCancel || settings.autoCancelThreshold === null) {\r\n      return; // Auto-cancel is disabled\r\n    }\r\n\r\n    const subscriptionsMap = this.subscriptions();\r\n    const tickers = this.tickers();\r\n    const now = Date.now();\r\n\r\n    subscriptionsMap.forEach((subscription, subscriptionId) => {\r\n      // Find current ticker data for this subscription\r\n      const ticker = tickers.find(t => t.symbol === subscription.symbol);\r\n      if (!ticker) return;\r\n\r\n      const currentFundingRate = parseFloat(ticker.fundingRate);\r\n      const absFundingRate = Math.abs(currentFundingRate);\r\n\r\n      // Calculate time remaining until execution\r\n      const timeRemaining = subscription.nextFundingTime - now;\r\n      const secondsRemaining = Math.floor(timeRemaining / 1000);\r\n\r\n      // Only cancel if funding rate is below threshold AND less than 30 seconds remaining\r\n      const isFundingBelowThreshold = absFundingRate < Math.abs(settings.autoCancelThreshold!);\r\n      const isCloseToExecution = secondsRemaining < 30 && secondsRemaining > 0;\r\n\r\n      if (isFundingBelowThreshold && isCloseToExecution) {\r\n        console.log(`Auto-cancelling ${subscription.symbol}: funding rate ${currentFundingRate} below threshold ${settings.autoCancelThreshold} with ${secondsRemaining}s remaining`);\r\n        this.unsubscribe(subscriptionId, false); // Cancel with notification\r\n        this.showNotification(\r\n          `Auto-cancelled ${subscription.symbol}: funding rate ${(currentFundingRate * 100).toFixed(4)}% below threshold (${secondsRemaining}s remaining)`,\r\n          'info'\r\n        );\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Edit an existing subscription\r\n   */\r\n  async editSubscription(subscription: FundingSubscription): Promise<void> {\r\n    console.log('[DEBUG] editSubscription called with:', subscription);\r\n\r\n    // If subscription has primary credential, switch to it to load correct ticker data\r\n    if (subscription.primaryCredentialId) {\r\n      const currentCredId = this.selectedCredentialId();\r\n      if (currentCredId !== subscription.primaryCredentialId) {\r\n        console.log('[DEBUG] Switching credential from', currentCredId, 'to', subscription.primaryCredentialId);\r\n        this.selectedCredentialId.set(subscription.primaryCredentialId);\r\n        // Load tickers for this credential\r\n        await this.loadTickersAsync().toPromise();\r\n      }\r\n    }\r\n\r\n    // Find the ticker data for this subscription\r\n    let ticker = this.tickers().find(t => t.symbol === subscription.symbol);\r\n\r\n    if (!ticker) {\r\n      // Try with normalized symbol (remove/add hyphens)\r\n      const normalizedSymbol = subscription.symbol.includes('-')\r\n        ? subscription.symbol.replace(/-/g, '')\r\n        : subscription.symbol.replace('USDT', '-USDT');\r\n      ticker = this.tickers().find(t => t.symbol === normalizedSymbol);\r\n    }\r\n\r\n    if (!ticker) {\r\n      console.error('[ERROR] Cannot edit: ticker data not found for symbol:', subscription.symbol);\r\n      console.log('[DEBUG] Available tickers:', this.tickers().map(t => t.symbol));\r\n      this.showNotification(`[ERROR] Cannot find ticker data for ${subscription.symbol}. Please ensure the exchange is accessible.`, 'error');\r\n      return;\r\n    }\r\n\r\n    console.log('[DEBUG] Found ticker:', ticker);\r\n\r\n    this.editingSubscription.set(subscription);\r\n    this.selectedTicker.set(ticker);\r\n\r\n    // Set hedge credential if available\r\n    if (subscription.hedgeCredentialId) {\r\n      this.hedgeCredentialId.set(subscription.hedgeCredentialId);\r\n    }\r\n\r\n    // Use subscription's leverage if available, otherwise fall back to global setting\r\n    const leverage = subscription.leverage || this.subscriptionSettings().leverage;\r\n\r\n    // Use saved margin if available, otherwise recalculate from quantity\r\n    const savedMargin = subscription.margin;\r\n    if (savedMargin && savedMargin > 0) {\r\n      console.log('[Edit] Loaded saved margin:', savedMargin);\r\n      this.positionSizeUsdt.set(savedMargin);\r\n    } else {\r\n      // Fallback: recalculate from quantity (existing logic)\r\n      const price = parseFloat(ticker.lastPrice) || parseFloat(ticker.markPrice) || 0;\r\n      const estimatedMargin = subscription.quantity * price / leverage;\r\n      console.log('[Edit] Recalculated margin from quantity:', estimatedMargin, 'based on quantity:', subscription.quantity, 'price:', price, 'leverage:', leverage);\r\n      this.positionSizeUsdt.set(estimatedMargin);\r\n    }\r\n\r\n    // Set leverage for dialog (use subscription's leverage, not global)\r\n    this.dialogLeverage.set(leverage);\r\n    console.log('[DEBUG] Set dialogLeverage to:', leverage, '(from subscription)');\r\n\r\n    // Open the subscription dialog for editing\r\n    console.log('[DEBUG] Opening subscription dialog');\r\n    this.showSubscriptionDialog.set(true);\r\n\r\n    // Fetch balances for both primary and hedge exchanges\r\n    this.fetchBalancesAndCalculatePosition(ticker.symbol);\r\n  }\r\n\r\n  /**\r\n   * Save edited subscription\r\n   * Note: Backend doesn't support PATCH/PUT, so we need to cancel and recreate\r\n   */\r\n  saveEditedSubscription(): void {\r\n    const editingSub = this.editingSubscription();\r\n    if (!editingSub) {\r\n      return;\r\n    }\r\n\r\n    const positionCalc = this.positionCalculation();\r\n    if (!positionCalc) {\r\n      this.showNotification('Unable to calculate position. Please check your input.', 'error');\r\n      return;\r\n    }\r\n    const newQuantity = positionCalc.quantity;\r\n    if (newQuantity === editingSub.quantity) {\r\n      this.showNotification('[INFO] No changes to save', 'info');\r\n      this.cancelEdit();\r\n      return;\r\n    }\r\n\r\n    // Since backend doesn't have PUT endpoint, we need to cancel and recreate\r\n    const token = this.authService.authState().token;\r\n    if (!token) {\r\n      this.showNotification('[ERROR] Not authenticated', 'error');\r\n      return;\r\n    }\r\n\r\n    const headers = new HttpHeaders({\r\n      'Authorization': `Bearer ${token}`,\r\n      'Content-Type': 'application/json'\r\n    });\r\n\r\n    // Step 1: Cancel existing subscription\r\n    this.http.delete<any>(\r\n      `http://localhost:3000/api/funding-arbitrage/subscribe?subscriptionId=${editingSub.subscriptionId}`,\r\n      { headers }\r\n    ).subscribe({\r\n      next: (deleteResponse) => {\r\n        if (deleteResponse.success) {\r\n          // Step 2: Create new subscription with updated quantity\r\n          const credential = this.selectedCredential();\r\n          if (!credential) {\r\n            this.showNotification('[ERROR] No exchange credential selected', 'error');\r\n            return;\r\n          }\r\n\r\n          // Get hedge credential - REQUIRED\r\n          const hedgeCred = this.hedgeCredential();\r\n          if (!hedgeCred) {\r\n            this.showNotification('[ERROR] Hedge credential is required. Please select a hedge exchange.', 'error');\r\n            return;\r\n          }\r\n\r\n          const subscribeData = {\r\n            symbol: editingSub.symbol,\r\n            fundingRate: editingSub.fundingRate,\r\n            nextFundingTime: editingSub.nextFundingTime,\r\n            positionType: editingSub.positionType,\r\n            quantity: newQuantity,\r\n            primaryCredentialId: credential.id,\r\n            hedgeExchange: hedgeCred.exchange,\r\n            hedgeCredentialId: hedgeCred.id,\r\n            leverage: this.subscriptionSettings().leverage\r\n          };\r\n\r\n          this.http.post<any>(\r\n            'http://localhost:3000/api/funding-arbitrage/subscribe',\r\n            subscribeData,\r\n            { headers }\r\n          ).subscribe({\r\n            next: (createResponse) => {\r\n              if (createResponse.success) {\r\n                this.showNotification('[SUCCESS] Subscription updated successfully', 'success');\r\n                this.editingSubscription.set(null);\r\n                this.loadSubscriptions();\r\n              } else {\r\n                this.showNotification(`[ERROR] ${createResponse.message || 'Failed to recreate subscription'}`, 'error');\r\n              }\r\n            },\r\n            error: (error) => {\r\n              console.error('Recreate subscription error:', error);\r\n              this.showNotification(`[ERROR] ${error.error?.message || 'Failed to recreate subscription'}`, 'error');\r\n            }\r\n          });\r\n        } else {\r\n          this.showNotification(`[ERROR] ${deleteResponse.message || 'Failed to cancel old subscription'}`, 'error');\r\n        }\r\n      },\r\n      error: (error) => {\r\n        console.error('Cancel subscription error:', error);\r\n        this.showNotification(`[ERROR] ${error.error?.message || 'Failed to cancel old subscription'}`, 'error');\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Cancel editing subscription\r\n   */\r\n  cancelEdit(): void {\r\n    this.editingSubscription.set(null);\r\n    this.positionSizeUsdt.set(100); // Reset to default USDT amount\r\n  }\r\n\r\n  /**\r\n   * Load existing subscriptions from the server\r\n   */\r\n  loadSubscriptions(): void {\r\n    const token = this.authService.authState().token;\r\n    if (!token) {\r\n      console.log('No auth token, skipping subscription load');\r\n      return;\r\n    }\r\n\r\n    const headers = new HttpHeaders({\r\n      'Authorization': `Bearer ${token}`\r\n    });\r\n\r\n    this.http.get<any>('http://localhost:3000/api/funding-arbitrage/subscribe', { headers })\r\n      .subscribe({\r\n        next: (response) => {\r\n          console.log('Loaded subscriptions:', response);\r\n          if (response.success && response.data) {\r\n            const subsMap = new Map<string, FundingSubscription>();\r\n            const completedDealsList: CompletedDeal[] = [];\r\n\r\n            response.data.forEach((sub: any) => {\r\n              // Basic validation - symbol must be a non-empty string ending with USDT\r\n              const isValidSymbol = sub.symbol &&\r\n                                   typeof sub.symbol === 'string' &&\r\n                                   sub.symbol.length > 0 &&\r\n                                   (sub.symbol.endsWith('USDT') || sub.symbol.endsWith('-USDT'));\r\n\r\n              if (!isValidSymbol) {\r\n                console.warn(`[loadSubscriptions] Skipping subscription with invalid symbol: ${sub.symbol} (ID: ${sub.subscriptionId})`);\r\n                return; // Skip this subscription\r\n              }\r\n\r\n              // Check if subscription is completed\r\n              if (sub.status === 'COMPLETED' && sub.entryPrice) {\r\n                completedDealsList.push({\r\n                  subscriptionId: sub.subscriptionId,\r\n                  symbol: sub.symbol,\r\n                  fundingRate: sub.fundingRate,\r\n                  positionType: sub.positionType,\r\n                  quantity: sub.quantity,\r\n                  entryPrice: sub.entryPrice,\r\n                  hedgeEntryPrice: sub.hedgeEntryPrice,\r\n                  fundingEarned: sub.fundingEarned,\r\n                  realizedPnl: sub.realizedPnl,\r\n                  executedAt: sub.executedAt,\r\n                  createdAt: sub.createdAt,\r\n                });\r\n              } else if (sub.status !== 'COMPLETED') {\r\n                // Only add non-completed subscriptions to active list\r\n                subsMap.set(sub.subscriptionId, sub);\r\n              }\r\n            });\r\n\r\n            console.log('[loadSubscriptions] Active subscriptions map:', subsMap);\r\n            console.log('[loadSubscriptions] Active subscription symbols:', Array.from(subsMap.values()).map(s => s.symbol));\r\n            console.log('[loadSubscriptions] Completed deals:', completedDealsList.length);\r\n\r\n            // Log funding rates for debugging\r\n            Array.from(subsMap.values()).forEach(sub => {\r\n              console.log(`[loadSubscriptions] ${sub.symbol} funding rate: ${sub.fundingRate}`);\r\n            });\r\n\r\n            this.subscriptions.set(subsMap);\r\n            this.completedDeals.set(completedDealsList);\r\n\r\n            // Trigger change detection to update UI\r\n            this.cdr.detectChanges();\r\n          }\r\n        },\r\n        error: (err) => {\r\n          console.error('Failed to load subscriptions:', err);\r\n        }\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Load active Bybit funding strategies from the server\r\n   */\r\n  loadActiveBybitStrategies(): void {\r\n    console.log('[loadActiveBybitStrategies] Calling API to load strategies...');\r\n    this.bybitFundingStrategyService.getActiveStrategies().subscribe({\r\n      next: (strategies) => {\r\n        console.log('[loadActiveBybitStrategies] Loaded strategies:', strategies);\r\n        console.log('[loadActiveBybitStrategies] Number of strategies:', strategies.length);\r\n        this.activeBybitStrategies.set(strategies);\r\n        console.log('[loadActiveBybitStrategies] Signal updated, current value:', this.activeBybitStrategies());\r\n        // Manually trigger change detection to ensure UI updates\r\n        this.cdr.detectChanges();\r\n      },\r\n      error: (error) => {\r\n        console.error('[loadActiveBybitStrategies] Failed to load strategies:', error);\r\n        // Don't show error notification to avoid spamming user\r\n        // Set empty array so UI shows correct state\r\n        this.activeBybitStrategies.set([]);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Stop a Bybit funding strategy\r\n   */\r\n  stopBybitStrategy(strategyId: string): void {\r\n    if (!confirm('Are you sure you want to stop this strategy?')) {\r\n      return;\r\n    }\r\n\r\n    this.bybitFundingStrategyService.stopStrategy(strategyId).subscribe({\r\n      next: () => {\r\n        this.showNotification('Strategy stopped successfully', 'success');\r\n        this.loadActiveBybitStrategies(); // Reload strategies\r\n      },\r\n      error: (error) => {\r\n        console.error('[stopBybitStrategy] Error:', error);\r\n        this.showNotification(`Failed to stop strategy: ${error.message}`, 'error');\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Subscribe to funding rate arbitrage\r\n   */\r\n  async subscribeFundingRate(): Promise<void> {\r\n    const ticker = this.selectedTicker();\r\n    const credential = this.selectedCredential();\r\n    const editingSub = this.editingSubscription();\r\n\r\n    if (!ticker || !credential) return;\r\n\r\n    this.isSubscribing.set(true);\r\n\r\n    try {\r\n      // If editing, cancel the old subscription first\r\n      if (editingSub) {\r\n        await this.unsubscribe(editingSub.subscriptionId, true); // true = silent mode\r\n      }\r\n      const token = this.authService.authState().token;\r\n      if (!token) {\r\n        this.showNotification('Authentication required', 'error');\r\n        return;\r\n      }\r\n\r\n      const headers = new HttpHeaders({\r\n        'Authorization': `Bearer ${token}`,\r\n        'Content-Type': 'application/json'\r\n      });\r\n\r\n      // Determine position type based on funding rate\r\n      const fundingRate = parseFloat(ticker.fundingRate);\r\n      const positionType = fundingRate < 0 ? 'long' : 'short';\r\n\r\n      // Debug: Log ticker price data\r\n      console.log(`[Subscribe ${ticker.symbol}] Price data - lastPrice: ${ticker.lastPrice}, markPrice: ${ticker.markPrice}`);\r\n\r\n      // Calculate quantity from position size in USDT\r\n      const positionCalc = this.positionCalculation();\r\n      if (!positionCalc) {\r\n        const errorMessage = this.positionValidationError() || 'Unable to calculate position details. Please check your input.';\r\n        console.log(`[Subscribe ${ticker.symbol}] Validation error: ${errorMessage}`);\r\n        this.showNotification(errorMessage, 'error');\r\n        return;\r\n      }\r\n\r\n      // Get hedge credential - only REQUIRED for HEDGED mode\r\n      const hedgeCred = this.hedgeCredential();\r\n      const mode = this.arbitrageMode();\r\n\r\n      if (mode === 'HEDGED' && !hedgeCred) {\r\n        this.showNotification('Hedge credential is required for HEDGED mode. Please select a hedge exchange or switch to NON_HEDGED mode.', 'error');\r\n        return;\r\n      }\r\n\r\n      const currentMargin = this.positionSizeUsdt();\r\n\r\n      const body: any = {\r\n        symbol: ticker.symbol,\r\n        fundingRate: fundingRate,\r\n        nextFundingTime: parseInt(ticker.nextFundingTime),\r\n        positionType: positionType,\r\n        quantity: positionCalc.quantity, // Use calculated quantity from USDT amount\r\n        primaryCredentialId: credential.id,\r\n        primaryExchange: credential.exchange, // Add exchange information\r\n        executionDelay: this.subscriptionSettings().executionDelay,\r\n        leverage: this.dialogLeverage(), // Use dialog-specific leverage\r\n        margin: currentMargin, // Current margin/position size in USDT\r\n        mode: mode // Add mode to request body\r\n      };\r\n\r\n      // Add TP/SL parameters for NON_HEDGED mode\r\n      if (mode === 'NON_HEDGED') {\r\n        body.takeProfitPercent = this.dialogTakeProfitPercent();\r\n        body.stopLossPercent = this.dialogStopLossPercent();\r\n      }\r\n\r\n      // Only add hedge credentials if in HEDGED mode\r\n      if (mode === 'HEDGED' && hedgeCred) {\r\n        body.hedgeExchange = hedgeCred.exchange;\r\n        body.hedgeCredentialId = hedgeCred.id;\r\n      }\r\n\r\n      console.log('[Subscribe] Saving margin:', currentMargin);\r\n      console.log('Creating funding subscription:', body);\r\n\r\n      const response = await this.http.post<any>(\r\n        'http://localhost:3000/api/funding-arbitrage/subscribe',\r\n        body,\r\n        { headers }\r\n      ).toPromise();\r\n\r\n      if (response.success) {\r\n        const message = editingSub\r\n          ? `‚úÖ Updated subscription for ${ticker.symbol}`\r\n          : `‚úÖ Subscribed to ${ticker.symbol} funding arbitrage`;\r\n\r\n        this.showNotification(message, 'success');\r\n\r\n        this.closeSubscriptionDialog();\r\n\r\n        // Reload subscriptions to get complete data with all fields\r\n        this.loadSubscriptions();\r\n\r\n        // Also reload arbitrage opportunities to update subscription indicators\r\n        this.loadArbitrageOpportunities(true);\r\n      }\r\n    } catch (error: any) {\r\n      console.error('Error subscribing to funding rate:', error);\r\n      this.showNotification(\r\n        `Failed to subscribe: ${error.error?.message || error.message}`,\r\n        'error'\r\n      );\r\n    } finally {\r\n      this.isSubscribing.set(false);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start countdown monitoring for a subscription\r\n   */\r\n  private startCountdownMonitoring(subscription: FundingSubscription): void {\r\n    const updateCountdown = () => {\r\n      const now = Date.now();\r\n      const timeRemaining = subscription.nextFundingTime - now;\r\n      const secondsRemaining = Math.floor(timeRemaining / 1000);\r\n\r\n      if (secondsRemaining <= 0) {\r\n        return;\r\n      }\r\n\r\n      // Update countdown\r\n      const subs = this.subscriptions();\r\n      const sub = subs.get(subscription.subscriptionId);\r\n      if (sub) {\r\n        sub.countdown = secondsRemaining;\r\n        this.subscriptions.set(new Map(subs));\r\n        // Manually trigger change detection to avoid ExpressionChangedAfterItHasBeenCheckedError\r\n        this.cdr.detectChanges();\r\n      }\r\n\r\n      // Notify at key moments\r\n      if (secondsRemaining === 10) {\r\n        this.showNotification(`‚è∞ 10 seconds until funding for ${subscription.symbol}`, 'info');\r\n      } else if (secondsRemaining === 5) {\r\n        this.showNotification(`üöÄ Opening positions for ${subscription.symbol}...`, 'info');\r\n      }\r\n\r\n      // Schedule next update\r\n      setTimeout(updateCountdown, 1000);\r\n    };\r\n\r\n    // Start the countdown\r\n    updateCountdown();\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe from funding arbitrage\r\n   */\r\n  async unsubscribe(subscriptionId: string, silent = false): Promise<void> {\r\n    try {\r\n      const token = this.authService.authState().token;\r\n      if (!token) return;\r\n\r\n      const headers = new HttpHeaders({\r\n        'Authorization': `Bearer ${token}`\r\n      });\r\n\r\n      const response = await this.http.delete<any>(\r\n        `http://localhost:3000/api/funding-arbitrage/subscribe?subscriptionId=${subscriptionId}`,\r\n        { headers }\r\n      ).toPromise();\r\n\r\n      // Remove from local state\r\n      const subs = this.subscriptions();\r\n      subs.delete(subscriptionId);\r\n      this.subscriptions.set(new Map(subs));\r\n\r\n      if (!silent) {\r\n        this.showNotification('Subscription canceled', 'info');\r\n      }\r\n    } catch (error: any) {\r\n      console.error('Error unsubscribing:', error);\r\n\r\n      // Check if subscription was already removed (404 or \"not found\" error)\r\n      const isNotFound = error.status === 404 ||\r\n                         error.error?.message?.includes('not found') ||\r\n                         error.error?.error?.includes('not found');\r\n\r\n      if (isNotFound) {\r\n        // Subscription already gone from backend, just remove from frontend\r\n        const subs = this.subscriptions();\r\n        subs.delete(subscriptionId);\r\n        this.subscriptions.set(new Map(subs));\r\n\r\n        if (!silent) {\r\n          this.showNotification('Subscription already removed', 'info');\r\n        }\r\n      } else {\r\n        // Real error\r\n        if (!silent) {\r\n          this.showNotification('Failed to cancel subscription', 'error');\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show notification\r\n   */\r\n  private showNotification(message: string, type: 'success' | 'error' | 'info'): void {\r\n    console.log('üì¢ showNotification called:', { message, type });\r\n    const notifications = this.notifications();\r\n    console.log('   Current notifications:', notifications);\r\n    const formattedMessage = `[${type.toUpperCase()}] ${message}`;\r\n    console.log('   Formatted message:', formattedMessage);\r\n    notifications.push(formattedMessage);\r\n    console.log('   After push:', notifications);\r\n    this.notifications.set([...notifications]);\r\n    console.log('   Signal updated. New notifications():', this.notifications());\r\n\r\n    // Auto-remove after 5 seconds\r\n    setTimeout(() => {\r\n      const notifs = this.notifications();\r\n      const index = notifs.indexOf(`[${type.toUpperCase()}] ${message}`);\r\n      if (index > -1) {\r\n        notifs.splice(index, 1);\r\n        this.notifications.set([...notifs]);\r\n      }\r\n    }, 5000);\r\n  }\r\n\r\n  /**\r\n   * Calculate countdown from funding time\r\n   */\r\n  calculateCountdown(nextFundingTime: number): number {\r\n    const now = Date.now();\r\n    const timeRemaining = nextFundingTime - now;\r\n    return Math.max(0, Math.floor(timeRemaining / 1000));\r\n  }\r\n\r\n  /**\r\n   * Format countdown time\r\n   */\r\n  formatCountdown(seconds: number): string {\r\n    if (seconds <= 0) return 'Executing...';\r\n\r\n    const hours = Math.floor(seconds / 3600);\r\n    const minutes = Math.floor((seconds % 3600) / 60);\r\n    const secs = seconds % 60;\r\n\r\n    if (hours > 0) {\r\n      return `${hours}h ${minutes}m ${secs}s`;\r\n    } else if (minutes > 0) {\r\n      return `${minutes}m ${secs}s`;\r\n    } else {\r\n      return `${secs}s`;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Calculate funding periodicity in format \"HH:MM / 8h\"\r\n   * Returns time until next funding and the interval\r\n   */\r\n  calculateFundingPeriodicity(nextFundingTime: number, fundingInterval = '8h'): string {\r\n    if (!nextFundingTime || nextFundingTime === 0) {\r\n      return 'N/A';\r\n    }\r\n\r\n    const now = Date.now();\r\n    const timeRemaining = nextFundingTime - now;\r\n\r\n    if (timeRemaining <= 0) {\r\n      return `--:-- / ${fundingInterval}`;\r\n    }\r\n\r\n    // Calculate hours and minutes until next funding\r\n    const totalSeconds = Math.floor(timeRemaining / 1000);\r\n    const hours = Math.floor(totalSeconds / 3600);\r\n    const minutes = Math.floor((totalSeconds % 3600) / 60);\r\n\r\n    // Format hours and minutes with leading zeros\r\n    const hoursStr = String(hours).padStart(2, '0');\r\n    const minutesStr = String(minutes).padStart(2, '0');\r\n\r\n    return `${hoursStr}:${minutesStr} / ${fundingInterval}`;\r\n  }\r\n\r\n  /**\r\n   * Calculate funding spread between PRIMARY (bestLong) and HEDGE (bestShort)\r\n   * Returns the absolute difference in funding rates\r\n   */\r\n  private calculateFundingSpread(bestLongRate: string, bestShortRate: string): { spread: number; spreadPercent: string } {\r\n    const longRate = parseFloat(bestLongRate || '0');\r\n    const shortRate = parseFloat(bestShortRate || '0');\r\n\r\n    // Calculate the absolute difference\r\n    const spread = Math.abs(longRate - shortRate);\r\n    const spreadPercent = (spread * 100).toFixed(4);\r\n\r\n    return {\r\n      spread,\r\n      spreadPercent\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Check if a symbol has an active subscription\r\n   */\r\n  hasActiveSubscription(symbol: string): boolean {\r\n    const hasSubscription = this.subscribedSymbols().has(symbol);\r\n\r\n    // Debug logging\r\n    if (hasSubscription) {\r\n      console.log('[hasActiveSubscription] Symbol has subscription:', symbol);\r\n    }\r\n\r\n    return hasSubscription;\r\n  }\r\n\r\n  /**\r\n   * Format timestamp for display\r\n   */\r\n  formatTimestamp(timestamp: string | Date): string {\r\n    const date = new Date(timestamp);\r\n    const now = new Date();\r\n    const diffMs = now.getTime() - date.getTime();\r\n    const diffMins = Math.floor(diffMs / 60000);\r\n    const diffHours = Math.floor(diffMins / 60);\r\n    const diffDays = Math.floor(diffHours / 24);\r\n\r\n    if (diffMins < 1) return 'Just now';\r\n    if (diffMins < 60) return `${diffMins}m ago`;\r\n    if (diffHours < 24) return `${diffHours}h ago`;\r\n    if (diffDays < 7) return `${diffDays}d ago`;\r\n\r\n    return date.toLocaleString();\r\n  }\r\n\r\n  /**\r\n   * Get subscription for an arbitrage opportunity by symbol\r\n   */\r\n  getArbitrageSubscription(symbol: string): FundingSubscription | undefined {\r\n    // Normalize symbol (remove hyphens)\r\n    const normalizedSymbol = symbol.replace(/-/g, '');\r\n    return this.symbolToSubscription().get(normalizedSymbol);\r\n  }\r\n\r\n  /**\r\n   * Check if arbitrage opportunity has an active subscription\r\n   */\r\n  hasArbitrageSubscription(symbol: string): boolean {\r\n    return this.getArbitrageSubscription(symbol) !== undefined;\r\n  }\r\n\r\n  /**\r\n   * Start arbitrage subscription execution (for already subscribed symbols)\r\n   */\r\n  async startArbitrageSubscription(opportunity: any): Promise<void> {\r\n    const subscription = this.getArbitrageSubscription(opportunity.symbol);\r\n    if (!subscription) {\r\n      this.showNotification('No active subscription found for this symbol', 'error');\r\n      return;\r\n    }\r\n\r\n    await this.startSubscriptionNow(subscription.subscriptionId);\r\n  }\r\n\r\n  /**\r\n   * Edit arbitrage subscription (for already subscribed symbols)\r\n   */\r\n  async editArbitrageSubscription(opportunity: any): Promise<void> {\r\n    const subscription = this.getArbitrageSubscription(opportunity.symbol);\r\n    if (!subscription) {\r\n      this.showNotification('No active subscription found for this symbol', 'error');\r\n      return;\r\n    }\r\n\r\n    console.log('[editArbitrageSubscription] === DEBUGGING MARGIN CALCULATION ===');\r\n    console.log('[editArbitrageSubscription] Opportunity data:', opportunity);\r\n    console.log('[editArbitrageSubscription] Subscription data:', subscription);\r\n\r\n    // Set hedge credential if available\r\n    if (subscription.hedgeCredentialId) {\r\n      this.hedgeCredentialId.set(subscription.hedgeCredentialId);\r\n      console.log('[editArbitrageSubscription] Set hedge credential:', subscription.hedgeCredentialId);\r\n    }\r\n\r\n    // Switch to primary credential if needed and load tickers to get current price\r\n    if (subscription.primaryCredentialId) {\r\n      const currentCredId = this.selectedCredentialId();\r\n      if (currentCredId !== subscription.primaryCredentialId) {\r\n        console.log('[editArbitrageSubscription] Switching credential from', currentCredId, 'to', subscription.primaryCredentialId);\r\n        this.selectedCredentialId.set(subscription.primaryCredentialId);\r\n        // Load tickers for this credential to get current price\r\n        await this.loadTickersAsync().toPromise();\r\n      }\r\n    }\r\n\r\n    // Find the actual ticker data from loaded tickers (has current price)\r\n    let ticker = this.tickers().find(t => t.symbol === subscription.symbol);\r\n\r\n    if (!ticker) {\r\n      // Try with normalized symbol (BingX uses hyphens, Bybit doesn't)\r\n      const normalizedSymbol = subscription.symbol.includes('-')\r\n        ? subscription.symbol.replace(/-/g, '')\r\n        : subscription.symbol.replace('USDT', '-USDT');\r\n      ticker = this.tickers().find(t => t.symbol === normalizedSymbol);\r\n    }\r\n\r\n    if (!ticker) {\r\n      console.error('[editArbitrageSubscription] ERROR: Cannot find ticker data for symbol:', subscription.symbol);\r\n      console.log('[editArbitrageSubscription] Available tickers:', this.tickers().map(t => t.symbol));\r\n      this.showNotification(`Cannot find current price for ${subscription.symbol}. Please try again.`, 'error');\r\n      return;\r\n    }\r\n\r\n    console.log('[editArbitrageSubscription] Found ticker with price:', {\r\n      symbol: ticker.symbol,\r\n      lastPrice: ticker.lastPrice,\r\n      markPrice: ticker.markPrice\r\n    });\r\n\r\n    this.editingSubscription.set(subscription);\r\n    this.selectedTicker.set(ticker);\r\n\r\n    // Use subscription's leverage if available, otherwise fall back to global setting\r\n    const leverage = subscription.leverage || this.subscriptionSettings().leverage;\r\n\r\n    // Use saved margin if available, otherwise recalculate from quantity\r\n    const savedMargin = subscription.margin;\r\n    if (savedMargin && savedMargin > 0) {\r\n      console.log('[editArbitrageSubscription] Loaded saved margin:', savedMargin);\r\n      this.positionSizeUsdt.set(savedMargin);\r\n    } else {\r\n      // Fallback: recalculate from quantity and current price\r\n      const price = parseFloat(ticker.lastPrice) || parseFloat(ticker.markPrice) || 0;\r\n      const estimatedMargin = subscription.quantity * price / leverage;\r\n\r\n      console.log('[editArbitrageSubscription] Recalculated margin from quantity:', estimatedMargin);\r\n      console.log('[editArbitrageSubscription] Margin calculation:', {\r\n        quantity: subscription.quantity,\r\n        price: price,\r\n        subscriptionLeverage: subscription.leverage,\r\n        globalLeverage: this.subscriptionSettings().leverage,\r\n        usedLeverage: leverage,\r\n        calculation: `${subscription.quantity} * ${price} / ${leverage}`,\r\n        estimatedMargin: estimatedMargin\r\n      });\r\n\r\n      this.positionSizeUsdt.set(estimatedMargin);\r\n    }\r\n\r\n    // Set leverage from subscription (use subscription's leverage, not global)\r\n    this.dialogLeverage.set(leverage);\r\n    console.log('[editArbitrageSubscription] Set dialogLeverage to:', leverage, '(from subscription)');\r\n\r\n    // Open the subscription dialog for editing\r\n    this.showSubscriptionDialog.set(true);\r\n\r\n    // Fetch balances for both exchanges\r\n    console.log('[editArbitrageSubscription] Calling fetchBalancesAndCalculatePosition...');\r\n    this.fetchBalancesAndCalculatePosition(ticker.symbol);\r\n  }\r\n\r\n  /**\r\n   * Cancel arbitrage subscription (for already subscribed symbols)\r\n   */\r\n  async cancelArbitrageSubscription(opportunity: any): Promise<void> {\r\n    const subscription = this.getArbitrageSubscription(opportunity.symbol);\r\n    if (!subscription) {\r\n      this.showNotification('No active subscription found for this symbol', 'error');\r\n      return;\r\n    }\r\n\r\n    // Show confirmation dialog\r\n    const confirmed = confirm(\r\n      `Are you sure you want to cancel the subscription for ${opportunity.symbol}?\\n\\n` +\r\n      `Position: ${subscription.positionType.toUpperCase()}\\n` +\r\n      `Quantity: ${subscription.quantity}\\n` +\r\n      `Funding Rate: ${(subscription.fundingRate * 100).toFixed(4)}%`\r\n    );\r\n\r\n    if (!confirmed) {\r\n      return;\r\n    }\r\n\r\n    await this.cancelSubscription(subscription.subscriptionId);\r\n  }\r\n\r\n  /**\r\n   * Subscribe to arbitrage opportunity\r\n   * Opens the subscription dialog for the best long position exchange\r\n   */\r\n  subscribeToArbitrage(opportunity: any): void {\r\n    console.log('[subscribeToArbitrage] Called with opportunity:', opportunity);\r\n    console.log('[subscribeToArbitrage] Mode:', this.arbitrageMode());\r\n\r\n    const mode = this.arbitrageMode();\r\n\r\n    // For NON_HEDGED mode: Choose the exchange with highest absolute funding rate\r\n    // For HEDGED mode: Use bestLong as primary\r\n    let primaryExchange: string;\r\n    let primaryCredentialId: string;\r\n    let primaryFundingRate: string;\r\n\r\n    if (mode === 'NON_HEDGED') {\r\n      // Compare absolute funding rates and choose the higher one\r\n      const absLongRate = this.getAbsoluteFundingRate(opportunity.bestLong.fundingRate);\r\n      const absShortRate = this.getAbsoluteFundingRate(opportunity.bestShort.fundingRate);\r\n\r\n      if (absLongRate >= absShortRate) {\r\n        primaryExchange = opportunity.bestLong.exchange;\r\n        primaryCredentialId = opportunity.bestLong.credentialId;\r\n        primaryFundingRate = opportunity.bestLong.fundingRate;\r\n        console.log('[subscribeToArbitrage] NON_HEDGED: Using bestLong (higher abs rate):', { primaryExchange, absLongRate });\r\n      } else {\r\n        primaryExchange = opportunity.bestShort.exchange;\r\n        primaryCredentialId = opportunity.bestShort.credentialId;\r\n        primaryFundingRate = opportunity.bestShort.fundingRate;\r\n        console.log('[subscribeToArbitrage] NON_HEDGED: Using bestShort (higher abs rate):', { primaryExchange, absShortRate });\r\n      }\r\n    } else {\r\n      // HEDGED mode: Use bestLong as primary\r\n      primaryExchange = opportunity.bestLong.exchange;\r\n      primaryCredentialId = opportunity.bestLong.credentialId;\r\n      primaryFundingRate = opportunity.bestLong.fundingRate;\r\n      console.log('[subscribeToArbitrage] HEDGED: Using bestLong:', { primaryExchange });\r\n    }\r\n\r\n    // Find the matching credential\r\n    const credential = this.credentials().find(c => c.id === primaryCredentialId);\r\n    console.log('[subscribeToArbitrage] Found credential:', credential);\r\n    console.log('[subscribeToArbitrage] All credentials:', this.credentials());\r\n\r\n    if (!credential) {\r\n      console.error('[subscribeToArbitrage] Credential not found for ID:', primaryCredentialId);\r\n      this.showNotification('Exchange credential not found for ' + primaryExchange, 'error');\r\n      return;\r\n    }\r\n\r\n    // Switch to the primary exchange's credential\r\n    this.selectedCredentialId.set(primaryCredentialId);\r\n    console.log('[subscribeToArbitrage] Switched to credential:', primaryCredentialId);\r\n\r\n    // Set the hedge exchange credential (only for HEDGED mode)\r\n    if (mode === 'HEDGED') {\r\n      const bestShortCredentialId = opportunity.bestShort.credentialId;\r\n      this.hedgeCredentialId.set(bestShortCredentialId);\r\n      console.log('[subscribeToArbitrage] HEDGED: Set hedge credential:', bestShortCredentialId);\r\n    } else {\r\n      // For NON_HEDGED mode, clear hedge credential\r\n      this.hedgeCredentialId.set(null);\r\n      console.log('[subscribeToArbitrage] NON_HEDGED: Cleared hedge credential');\r\n    }\r\n\r\n    // Find the ticker data from the exchanges array\r\n    const exchangeData = opportunity.exchanges.find(\r\n      (ex: any) => ex.exchange === primaryExchange && ex.credentialId === primaryCredentialId\r\n    );\r\n    console.log('[subscribeToArbitrage] Found exchange data:', exchangeData);\r\n    console.log('[subscribeToArbitrage] All exchanges:', opportunity.exchanges);\r\n\r\n    if (!exchangeData) {\r\n      console.error('[subscribeToArbitrage] Exchange data not found');\r\n      this.showNotification('Ticker data not found for ' + opportunity.symbol, 'error');\r\n      return;\r\n    }\r\n\r\n    // Try to find the actual ticker from loaded tickers (after switching credential)\r\n    // We need to load tickers for this credential first\r\n    this.loadTickers();\r\n\r\n    // Wait a moment for tickers to load, then find the ticker\r\n    setTimeout(() => {\r\n      let ticker = this.tickers().find(t => t.symbol === opportunity.symbol);\r\n\r\n      if (!ticker) {\r\n        console.warn('[subscribeToArbitrage] Ticker not found in loaded tickers, creating from exchange data');\r\n        // Fallback: Create a ticker object from exchange data with better price handling\r\n        ticker = {\r\n          symbol: opportunity.symbol,\r\n          fundingRate: primaryFundingRate,\r\n          nextFundingTime: exchangeData.nextFundingTime?.toString() || '0',\r\n          lastPrice: (exchangeData.lastPrice || exchangeData.price || '0').toString(),\r\n          indexPrice: (exchangeData.indexPrice || exchangeData.lastPrice || exchangeData.price || '0').toString(),\r\n          markPrice: (exchangeData.markPrice || exchangeData.lastPrice || exchangeData.price || '0').toString(),\r\n          prevPrice24h: '0',\r\n          price24hPcnt: '0',\r\n          highPrice24h: '0',\r\n          lowPrice24h: '0',\r\n          prevPrice1h: '0',\r\n          openInterest: exchangeData.openInterest?.toString() || '0',\r\n          openInterestValue: '0',\r\n          turnover24h: '0',\r\n          volume24h: exchangeData.volume24h?.toString() || '0',\r\n          predictedDeliveryPrice: '0',\r\n          basisRate: '0',\r\n          deliveryFeeRate: '0',\r\n          deliveryTime: '0',\r\n          ask1Size: '0',\r\n          bid1Price: '0',\r\n          ask1Price: '0',\r\n          bid1Size: '0'\r\n        };\r\n      }\r\n\r\n      // Update the ticker's funding rate from arbitrage data\r\n      ticker = {\r\n        ...ticker,\r\n        fundingRate: primaryFundingRate,\r\n        nextFundingTime: exchangeData.nextFundingTime?.toString() || ticker.nextFundingTime\r\n      };\r\n\r\n      console.log('[subscribeToArbitrage] Using ticker:', ticker);\r\n      this.selectedTicker.set(ticker);\r\n      this.positionSizeUsdt.set(100); // Default position size in USDT\r\n      this.dialogLeverage.set(this.subscriptionSettings().leverage); // Initialize with global setting\r\n      this.showSubscriptionDialog.set(true);\r\n      this.fetchBalancesAndCalculatePosition(ticker.symbol);\r\n\r\n      // Show notification about the arbitrage opportunity\r\n      let notificationMsg: string;\r\n      if (mode === 'HEDGED') {\r\n        const spreadPercent = (parseFloat(opportunity.spread) * 100).toFixed(4);\r\n        notificationMsg = `Subscribing to ${opportunity.symbol} HEDGED arbitrage: ${spreadPercent}% spread between ${primaryExchange} and ${opportunity.bestShort.exchange}`;\r\n      } else {\r\n        const fundingPercent = (parseFloat(primaryFundingRate) * 100).toFixed(4);\r\n        const positionType = parseFloat(primaryFundingRate) < 0 ? 'LONG' : 'SHORT';\r\n        notificationMsg = `Subscribing to ${opportunity.symbol} NON_HEDGED: ${positionType} position on ${primaryExchange} (${fundingPercent}% funding rate)`;\r\n      }\r\n      console.log('[subscribeToArbitrage] Showing notification:', notificationMsg);\r\n      this.showNotification(notificationMsg, 'info');\r\n\r\n      console.log('[subscribeToArbitrage] Completed successfully');\r\n    }, 500); // Give tickers time to load\r\n  }\r\n\r\n  /**\r\n   * Fetch balances for primary and hedge exchanges and calculate position details\r\n   */\r\n  async fetchBalancesAndCalculatePosition(symbol: string): Promise<void> {\r\n    const primaryCred = this.selectedCredential();\r\n    const hedgeCred = this.hedgeCredential();\r\n    const ticker = this.selectedTicker();\r\n\r\n    if (!primaryCred || !ticker) {\r\n      console.error('[fetchBalances] Missing primary credential or ticker');\r\n      return;\r\n    }\r\n\r\n    this.isLoadingBalances.set(true);\r\n\r\n    try {\r\n      const token = this.authService.authState().token;\r\n      if (!token) {\r\n        this.showNotification('Authentication required', 'error');\r\n        return;\r\n      }\r\n\r\n      const headers = new HttpHeaders({\r\n        'Authorization': `Bearer ${token}`\r\n      });\r\n\r\n      // Fetch primary balance\r\n      let primaryBalanceUrl: string;\r\n\r\n      // Use correct endpoint based on exchange\r\n      if (primaryCred.exchange === 'BYBIT') {\r\n        primaryBalanceUrl = `http://localhost:3000/api/bybit/wallet-balance?accountType=UNIFIED&environment=${primaryCred.environment}&credentialId=${primaryCred.id}`;\r\n      } else if (primaryCred.exchange === 'BINGX') {\r\n        primaryBalanceUrl = `http://localhost:3000/api/bingx/wallet-balance?environment=${primaryCred.environment}&credentialId=${primaryCred.id}`;\r\n      } else {\r\n        console.warn('[fetchBalances] Unsupported primary exchange:', primaryCred.exchange);\r\n        this.primaryBalance.set(null);\r\n        return;\r\n      }\r\n\r\n      const primaryBalanceResponse = await this.http.get<any>(primaryBalanceUrl, { headers }).toPromise();\r\n\r\n      console.log('[fetchBalances] Primary balance response:', JSON.stringify(primaryBalanceResponse, null, 2));\r\n\r\n      if (primaryBalanceResponse?.success && primaryBalanceResponse.data) {\r\n        let balance = 0;\r\n\r\n        // Extract balance based on exchange type\r\n        if (primaryCred.exchange === 'BYBIT') {\r\n          console.log('[fetchBalances] Bybit data structure:', primaryBalanceResponse.data);\r\n          // Bybit returns: data.list[0].totalAvailableBalance\r\n          const list = primaryBalanceResponse.data.list;\r\n          if (list && list.length > 0) {\r\n            balance = parseFloat(list[0].totalAvailableBalance || '0');\r\n            console.log('[fetchBalances] Bybit balance from list[0]:', balance);\r\n          } else {\r\n            console.warn('[fetchBalances] Bybit list is empty or undefined:', list);\r\n          }\r\n        } else if (primaryCred.exchange === 'BINGX') {\r\n          // BingX response: data.balance.availableMargin or data.balance.balance\r\n          console.log('[fetchBalances] BingX FULL response:', primaryBalanceResponse);\r\n          console.log('[fetchBalances] BingX data:', primaryBalanceResponse.data);\r\n          console.log('[fetchBalances] BingX data.balance:', primaryBalanceResponse.data?.balance);\r\n\r\n          const bingxBalance = primaryBalanceResponse.data?.balance;\r\n          if (bingxBalance) {\r\n            console.log('[fetchBalances] BingX balance object keys:', Object.keys(bingxBalance));\r\n            console.log('[fetchBalances] BingX balance.availableMargin:', bingxBalance.availableMargin);\r\n            console.log('[fetchBalances] BingX balance.balance:', bingxBalance.balance);\r\n            balance = parseFloat(bingxBalance.availableMargin || bingxBalance.balance || '0');\r\n          } else {\r\n            console.error('[fetchBalances] BingX balance object is null/undefined');\r\n          }\r\n          console.log('[fetchBalances] Final extracted balance:', balance);\r\n        }\r\n\r\n        this.primaryBalance.set(balance);\r\n        console.log('[fetchBalances] Primary balance set to:', balance, 'for', primaryCred.exchange);\r\n        this.cdr.detectChanges(); // Trigger change detection to update computed signals in UI\r\n        console.log('[fetchBalances] Change detection triggered after primary balance update');\r\n      }\r\n\r\n      // Fetch hedge balance if available\r\n      if (hedgeCred) {\r\n        let hedgeBalanceUrl: string;\r\n\r\n        // Use correct endpoint based on exchange\r\n        if (hedgeCred.exchange === 'BYBIT') {\r\n          hedgeBalanceUrl = `http://localhost:3000/api/bybit/wallet-balance?accountType=UNIFIED&environment=${hedgeCred.environment}&credentialId=${hedgeCred.id}`;\r\n        } else if (hedgeCred.exchange === 'BINGX') {\r\n          hedgeBalanceUrl = `http://localhost:3000/api/bingx/wallet-balance?environment=${hedgeCred.environment}&credentialId=${hedgeCred.id}`;\r\n        } else {\r\n          console.warn('[fetchBalances] Unsupported hedge exchange:', hedgeCred.exchange);\r\n          this.hedgeBalance.set(null);\r\n          return;\r\n        }\r\n\r\n        const hedgeBalanceResponse = await this.http.get<any>(hedgeBalanceUrl, { headers }).toPromise();\r\n\r\n        console.log('[fetchBalances] Hedge balance response:', JSON.stringify(hedgeBalanceResponse, null, 2));\r\n\r\n        if (hedgeBalanceResponse?.success && hedgeBalanceResponse.data) {\r\n          let balance = 0;\r\n\r\n          // Extract balance based on exchange type\r\n          if (hedgeCred.exchange === 'BYBIT') {\r\n            // Bybit returns: data.list[0].totalAvailableBalance\r\n            const list = hedgeBalanceResponse.data.list;\r\n            if (list && list.length > 0) {\r\n              balance = parseFloat(list[0].totalAvailableBalance || '0');\r\n              console.log('[fetchBalances] Hedge Bybit balance from list[0]:', balance);\r\n            } else {\r\n              console.warn('[fetchBalances] Hedge Bybit list is empty or undefined:', list);\r\n            }\r\n          } else if (hedgeCred.exchange === 'BINGX') {\r\n            // BingX response: data.balance.availableMargin or data.balance.balance\r\n            console.log('[fetchBalances] Hedge BingX data structure:', hedgeBalanceResponse.data);\r\n            const bingxBalance = hedgeBalanceResponse.data.balance;\r\n            console.log('[fetchBalances] Hedge BingX balance object:', bingxBalance);\r\n            balance = parseFloat(bingxBalance?.availableMargin || bingxBalance?.balance || '0');\r\n            console.log('[fetchBalances] Hedge extracted balance:', balance);\r\n          }\r\n\r\n          this.hedgeBalance.set(balance);\r\n          console.log('[fetchBalances] Hedge balance set to:', balance, 'for', hedgeCred.exchange);\r\n          this.cdr.detectChanges(); // Trigger change detection to update computed signals in UI\r\n          console.log('[fetchBalances] Change detection triggered after hedge balance update');\r\n        }\r\n      } else {\r\n        // No hedge credential selected\r\n        this.hedgeBalance.set(null);\r\n      }\r\n\r\n      // Position calculation is now automatic via computed signal\r\n\r\n    } catch (error: any) {\r\n      console.error('[fetchBalances] Error fetching balances:', error);\r\n      this.primaryBalance.set(null);\r\n      this.hedgeBalance.set(null);\r\n    } finally {\r\n      this.isLoadingBalances.set(false);\r\n      this.cdr.detectChanges(); // Trigger final change detection after loading completes\r\n      console.log('[fetchBalances] Final change detection triggered after loading completion');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Opens the trading pair's futures page on the exchange platform\r\n   */\r\n  openTradingPair(symbol: string): void {\r\n    const credential = this.selectedCredential();\r\n    if (!credential) return;\r\n\r\n    const exchange = credential.exchange;\r\n    const environment = credential.environment;\r\n\r\n    let url = '';\r\n\r\n    switch (exchange) {\r\n      case 'BYBIT':\r\n        if (environment === 'TESTNET') {\r\n          // Bybit Testnet futures trading page\r\n          url = `https://testnet.bybit.com/trade/usdt/${symbol}`;\r\n        } else {\r\n          // Bybit Mainnet futures trading page\r\n          url = `https://www.bybit.com/trade/usdt/${symbol}`;\r\n        }\r\n        break;\r\n\r\n      case 'BINANCE':\r\n        if (environment === 'TESTNET') {\r\n          // Binance Testnet futures\r\n          url = `https://testnet.binancefuture.com/en/futures/${symbol}`;\r\n        } else {\r\n          // Binance Mainnet futures\r\n          url = `https://www.binance.com/en/futures/${symbol}`;\r\n        }\r\n        break;\r\n\r\n      case 'OKX':\r\n        // OKX doesn't have separate testnet URLs for trading\r\n        url = `https://www.okx.com/trade-swap/${symbol.toLowerCase()}`;\r\n        break;\r\n\r\n      case 'KRAKEN':\r\n        // Kraken futures\r\n        url = `https://futures.kraken.com/trade/${symbol}`;\r\n        break;\r\n\r\n      case 'COINBASE':\r\n        // Coinbase doesn't have futures trading in the same way\r\n        url = `https://www.coinbase.com/advanced-trade/spot/${symbol}`;\r\n        break;\r\n\r\n      case 'BINGX':\r\n        // Remove CCXT perpetual contract suffix and slashes (e.g., BTC/USDT:USDT -> BTCUSDT)\r\n        const cleanSymbol = symbol.replace(/:.*$/, '').replace(/\\//g, '');\r\n        // Convert to BingX format with hyphen (e.g., BTCUSDT -> BTC-USDT)\r\n        const bingxSymbol = cleanSymbol.includes('-') ? cleanSymbol :\r\n          (cleanSymbol.endsWith('USDT') ? `${cleanSymbol.slice(0, -4)}-USDT` :\r\n          (cleanSymbol.endsWith('USDC') ? `${cleanSymbol.slice(0, -4)}-USDC` : cleanSymbol));\r\n\r\n        if (environment === 'TESTNET') {\r\n          // BingX Testnet perpetual trading page\r\n          url = `https://testnet-futures.bingx.com/en/perpetual/${bingxSymbol}`;\r\n        } else {\r\n          // BingX Mainnet perpetual trading page\r\n          url = `https://bingx.com/en/perpetual/${bingxSymbol}`;\r\n        }\r\n        break;\r\n\r\n      default:\r\n        console.warn('Unknown exchange:', exchange);\r\n        return;\r\n    }\r\n\r\n    if (url) {\r\n      window.open(url, '_blank', 'noopener,noreferrer');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get absolute value of a funding rate (helper for templates)\r\n   */\r\n  getAbsoluteFundingRate(fundingRate: string | number): number {\r\n    return Math.abs(parseFloat(fundingRate?.toString() || '0'));\r\n  }\r\n\r\n  /**\r\n   * Opens the trading pair's futures page on a specific exchange platform\r\n   * Used by arbitrage table where exchange is passed explicitly\r\n   */\r\n  openTradingPairForExchange(symbol: string, exchange: string, environment: string, originalSymbol?: string): void {\r\n    let url = '';\r\n\r\n    // Use originalSymbol for exchanges that need specific formatting (e.g., BingX uses hyphens)\r\n    const displaySymbol = originalSymbol || symbol;\r\n\r\n    switch (exchange) {\r\n      case 'BYBIT':\r\n        if (environment === 'TESTNET') {\r\n          url = `https://testnet.bybit.com/trade/usdt/${symbol}`;\r\n        } else {\r\n          url = `https://www.bybit.com/trade/usdt/${symbol}`;\r\n        }\r\n        break;\r\n\r\n      case 'BINANCE':\r\n        if (environment === 'TESTNET') {\r\n          url = `https://testnet.binancefuture.com/en/futures/${symbol}`;\r\n        } else {\r\n          url = `https://www.binance.com/en/futures/${symbol}`;\r\n        }\r\n        break;\r\n\r\n      case 'OKX':\r\n        url = `https://www.okx.com/trade-swap/${symbol.toLowerCase()}`;\r\n        break;\r\n\r\n      case 'KRAKEN':\r\n        url = `https://futures.kraken.com/trade/${symbol}`;\r\n        break;\r\n\r\n      case 'COINBASE':\r\n        url = `https://www.coinbase.com/advanced-trade/spot/${symbol}`;\r\n        break;\r\n\r\n      case 'BINGX':\r\n        // BingX uses hyphens in their URLs (e.g., DOOD-USDT instead of DOODUSDT)\r\n        // Remove CCXT perpetual contract suffix and slashes (e.g., BTC/USDT:USDT -> BTCUSDT)\r\n        const cleanBingxSymbol = displaySymbol.replace(/:.*$/, '').replace(/\\//g, '');\r\n        // Convert to BingX format with hyphen (e.g., BTCUSDT -> BTC-USDT)\r\n        const bingxDisplaySymbol = cleanBingxSymbol.includes('-') ? cleanBingxSymbol :\r\n          (cleanBingxSymbol.endsWith('USDT') ? `${cleanBingxSymbol.slice(0, -4)}-USDT` :\r\n          (cleanBingxSymbol.endsWith('USDC') ? `${cleanBingxSymbol.slice(0, -4)}-USDC` : cleanBingxSymbol));\r\n\r\n        if (environment === 'TESTNET') {\r\n          url = `https://testnet-futures.bingx.com/en/perpetual/${bingxDisplaySymbol}`;\r\n        } else {\r\n          url = `https://bingx.com/en/perpetual/${bingxDisplaySymbol}`;\r\n        }\r\n        break;\r\n\r\n      case 'MEXC':\r\n        // MEXC uses underscore format in URLs (e.g., BTC_USDT)\r\n        const mexcSymbol = displaySymbol.includes('_') ? displaySymbol : symbol.replace(/^(.+)(USDT|USDC|USD)$/, '$1_$2');\r\n        url = `https://www.mexc.com/futures/${mexcSymbol}?type=linear_swap`;\r\n        break;\r\n\r\n      default:\r\n        console.warn('Unknown exchange:', exchange);\r\n        return;\r\n    }\r\n\r\n    if (url) {\r\n      window.open(url, '_blank', 'noopener,noreferrer');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get market cap for a symbol\r\n   */\r\n  getMarketCap(symbol: string): number {\r\n    // TODO: Implement market cap fetching\r\n    return 0;\r\n  }\r\n\r\n  /**\r\n   * Format market cap value for display\r\n   */\r\n  formatMarketCap(value: number): string {\r\n    if (value === 0) return '';\r\n\r\n    if (value >= 1e12) {\r\n      return `$${(value / 1e12).toFixed(2)}T`;\r\n    } else if (value >= 1e9) {\r\n      return `$${(value / 1e9).toFixed(2)}B`;\r\n    } else if (value >= 1e6) {\r\n      return `$${(value / 1e6).toFixed(2)}M`;\r\n    } else if (value >= 1e3) {\r\n      return `$${(value / 1e3).toFixed(2)}K`;\r\n    } else {\r\n      return `$${value.toFixed(2)}`;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start hedged arbitrage - opens a modal to configure leverage and margin for both exchanges\r\n   */\r\n  startHedgedArbitrage(opportunity: any): void {\r\n    console.log('Starting hedged arbitrage for:', opportunity);\r\n\r\n    // Store the selected opportunity\r\n    this.selectedHedgedOpportunity.set(opportunity);\r\n\r\n    // Initialize leverage and margin with default values\r\n    const defaultLeverage = this.subscriptionSettings().leverage || 3;\r\n    this.hedgedPrimaryLeverage.set(defaultLeverage);\r\n    this.hedgedHedgeLeverage.set(defaultLeverage);\r\n    this.hedgedPrimaryMargin.set(100);\r\n    this.hedgedHedgeMargin.set(100);\r\n\r\n    // Show the HEDGED mode dialog\r\n    this.showHedgedDialog.set(true);\r\n  }\r\n\r\n  /**\r\n   * Open arbitrage chart page for the selected opportunity\r\n   */\r\n  openArbitrageChart(opportunity: any): void {\r\n    console.log('Opening arbitrage chart for:', opportunity);\r\n\r\n    const symbol = opportunity.symbol;\r\n    const primary = opportunity.bestShort?.exchange || 'UNKNOWN';\r\n    const hedge = opportunity.bestLong?.exchange || 'UNKNOWN';\r\n\r\n    // Navigate to the chart page\r\n    this.router.navigate(['/arbitrage/chart', symbol, primary, hedge]);\r\n  }\r\n\r\n  /**\r\n   * Close the HEDGED mode dialog\r\n   */\r\n  closeHedgedDialog(): void {\r\n    this.showHedgedDialog.set(false);\r\n    this.selectedHedgedOpportunity.set(null);\r\n  }\r\n\r\n  /**\r\n   * Execute hedged arbitrage - opens positions on both exchanges simultaneously\r\n   */\r\n  async executeHedgedArbitrage(): Promise<void> {\r\n    const opportunity = this.selectedHedgedOpportunity();\r\n    if (!opportunity) {\r\n      this.showNotification('No opportunity selected', 'error');\r\n      return;\r\n    }\r\n\r\n    // Validate inputs\r\n    if (this.hedgedPrimaryMargin() <= 0 || this.hedgedHedgeMargin() <= 0) {\r\n      this.showNotification('Margin must be greater than 0', 'error');\r\n      return;\r\n    }\r\n\r\n    if (this.hedgedPrimaryLeverage() < 1 || this.hedgedHedgeLeverage() < 1) {\r\n      this.showNotification('Leverage must be at least 1', 'error');\r\n      return;\r\n    }\r\n\r\n    this.isStartingHedged.set(true);\r\n\r\n    try {\r\n      // Find exchange data from exchanges array\r\n      const bestLongExchange = opportunity.exchanges.find((ex: any) =>\r\n        ex.exchange === opportunity.bestLong.exchange && ex.credentialId === opportunity.bestLong.credentialId\r\n      );\r\n      const bestShortExchange = opportunity.exchanges.find((ex: any) =>\r\n        ex.exchange === opportunity.bestShort.exchange && ex.credentialId === opportunity.bestShort.credentialId\r\n      );\r\n\r\n      if (!bestLongExchange || !bestShortExchange) {\r\n        this.showNotification('Missing exchange data', 'error');\r\n        this.isStartingHedged.set(false);\r\n        return;\r\n      }\r\n\r\n      // Build params for Price Arbitrage API\r\n      // PRIMARY = bestShort (high price exchange) - we SHORT here\r\n      // HEDGE = bestLong (low price exchange) - we LONG here\r\n      const params = {\r\n        symbol: opportunity.symbol,\r\n        primaryExchange: opportunity.bestShort.exchange,\r\n        primaryCredentialId: opportunity.bestShort.credentialId,\r\n        primaryLeverage: this.hedgedPrimaryLeverage(),\r\n        primaryMargin: this.hedgedPrimaryMargin(),\r\n        hedgeExchange: opportunity.bestLong.exchange,\r\n        hedgeCredentialId: opportunity.bestLong.credentialId,\r\n        hedgeLeverage: this.hedgedHedgeLeverage(),\r\n        hedgeMargin: this.hedgedHedgeMargin(),\r\n        entryPrimaryPrice: parseFloat(bestShortExchange.lastPrice),\r\n        entryHedgePrice: parseFloat(bestLongExchange.lastPrice),\r\n        // Optional: –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å targetSpread, stopLoss, maxHoldingTime\r\n      };\r\n\r\n      console.log('Executing price arbitrage (hedged mode):', params);\r\n\r\n      // Call the Price Arbitrage API - positions open immediately\r\n      this.priceArbitrageService.startArbitrage(params).subscribe({\r\n        next: (response) => {\r\n          console.log('Price arbitrage started successfully:', response);\r\n          this.showNotification(`Hedged arbitrage for ${opportunity.symbol} started successfully!`, 'success');\r\n\r\n          // Close the dialog\r\n          this.closeHedgedDialog();\r\n\r\n          // Refresh active positions\r\n          // Note: –º–æ–∂–µ—Ç –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è –æ–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π –µ—Å–ª–∏ —Ç–∞–∫–æ–π –µ—Å—Ç—å\r\n        },\r\n        error: (error) => {\r\n          console.error('Error executing price arbitrage:', error);\r\n          this.showNotification(`Failed to execute arbitrage: ${error.message}`, 'error');\r\n          this.isStartingHedged.set(false);\r\n        },\r\n        complete: () => {\r\n          this.isStartingHedged.set(false);\r\n        }\r\n      });\r\n    } catch (error: any) {\r\n      console.error('Error executing price arbitrage:', error);\r\n      this.showNotification(`Failed to execute arbitrage: ${error.message || error}`, 'error');\r\n      this.isStartingHedged.set(false);\r\n    }\r\n  }\r\n\r\n\r\n  /**\r\n   * Formats duration between two timestamps\r\n   */\r\n  formatDuration(startTime: string, endTime: string): string {\r\n    const start = new Date(startTime).getTime();\r\n    const end = new Date(endTime).getTime();\r\n    const diffMs = end - start;\r\n\r\n    const diffMinutes = Math.floor(diffMs / 60000);\r\n    const diffHours = Math.floor(diffMinutes / 60);\r\n    const diffDays = Math.floor(diffHours / 24);\r\n\r\n    if (diffDays > 0) {\r\n      return `${diffDays}d ${diffHours % 24}h`;\r\n    } else if (diffHours > 0) {\r\n      return `${diffHours}h ${diffMinutes % 60}m`;\r\n    } else {\r\n      return `${diffMinutes}m`;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Formats datetime for display\r\n   */\r\n  formatDateTime(dateString: string): string {\r\n    const date = new Date(dateString);\r\n    return new Intl.DateTimeFormat('en-US', {\r\n      month: 'short',\r\n      day: 'numeric',\r\n      year: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit',\r\n      second: '2-digit'\r\n    }).format(date);\r\n  }\r\n\r\n  /**\r\n   * Returns CSS class based on P&L value\r\n   */\r\n  getPnlColorClass(pnl: number): string {\r\n    if (pnl > 0) return 'positive';\r\n    if (pnl < 0) return 'negative';\r\n    return 'neutral';\r\n  }\r\n\r\n  /**\r\n   * Open Bybit Strategy Modal for a specific opportunity\r\n   */\r\n  openBybitStrategyModal(opportunity: FundingRateArbitrageOpportunity): void {\r\n    // Find Bybit exchange data from the opportunity\r\n    const bybitExchange = opportunity.exchanges.find(e =>\r\n      e.exchange === 'BYBIT_MAINNET' || e.exchange === 'BYBIT_TESTNET' || e.exchange === 'BYBIT'\r\n    );\r\n\r\n    if (!bybitExchange) {\r\n      this.showNotification(this.translate('bybitStrategy.messages.noBybitData'), 'error');\r\n      return;\r\n    }\r\n\r\n    // Prepare modal data - don't pass credentialId, let backend use active credential\r\n    const modalData: StartBybitStrategyModalData = {\r\n      symbol: opportunity.symbol,\r\n      fundingRate: parseFloat(bybitExchange.fundingRate),\r\n      nextFundingTime: bybitExchange.nextFundingTime,\r\n      credentialId: '' // Empty string means backend will use active credential\r\n    };\r\n\r\n    // Set modal data and open modal\r\n    this.bybitStrategyModalData.set(modalData);\r\n    this.showBybitStrategyModal.set(true);\r\n  }\r\n\r\n  /**\r\n   * Close Bybit Strategy Modal\r\n   */\r\n  closeBybitStrategyModal(): void {\r\n    console.log('[FundingRates] closeBybitStrategyModal called');\r\n    this.showBybitStrategyModal.set(false);\r\n    // Refresh strategies list when modal closes (strategy may have been created)\r\n    console.log('[FundingRates] Calling loadActiveBybitStrategies from closeBybitStrategyModal');\r\n    this.loadActiveBybitStrategies();\r\n  }\r\n\r\n  /**\r\n   * Handle strategy started event\r\n   */\r\n  onStrategyStarted(): void {\r\n    console.log('[FundingRates] onStrategyStarted called');\r\n    this.showNotification(this.translate('bybitStrategy.messages.success'), 'success');\r\n    // Refresh active strategies list immediately after strategy creation\r\n    console.log('[FundingRates] Calling loadActiveBybitStrategies from onStrategyStarted');\r\n    this.loadActiveBybitStrategies();\r\n  }\r\n\r\n  /**\r\n   * Open subscription modal for a specific exchange\r\n   * @param symbol - Trading symbol\r\n   * @param exchangeData - Exchange data from the opportunity\r\n   */\r\n  openSubscribeModalForExchange(symbol: string, exchangeData: ExchangeData): void {\r\n    console.log('üöÄ [FundingRates] openSubscribeModalForExchange called:', { symbol, exchange: exchangeData.exchange });\r\n\r\n    // Check if this is a Bybit exchange - use Bybit modal\r\n    const isBybit = exchangeData.exchange === 'BYBIT' ||\r\n                    exchangeData.exchange === 'BYBIT_MAINNET' ||\r\n                    exchangeData.exchange === 'BYBIT_TESTNET';\r\n\r\n    if (isBybit) {\r\n      console.log('   ‚Üí Opening Bybit Strategy Modal');\r\n      // Use Bybit Strategy Modal for Bybit exchanges\r\n      const modalData: StartBybitStrategyModalData = {\r\n        symbol: symbol,\r\n        fundingRate: parseFloat(exchangeData.fundingRate),\r\n        nextFundingTime: exchangeData.nextFundingTime,\r\n        credentialId: exchangeData.credentialId || '' // Use exchange's credential or empty for active\r\n      };\r\n\r\n      this.bybitStrategyModalData.set(modalData);\r\n      this.showBybitStrategyModal.set(true);\r\n    } else {\r\n      console.log('   ‚Üí Opening general subscription dialog for', exchangeData.exchange);\r\n\r\n      // Find the credential for this exchange\r\n      const credential = this.credentials().find(c => c.id === exchangeData.credentialId);\r\n      if (!credential) {\r\n        console.error('   ‚ùå Credential not found for ID:', exchangeData.credentialId);\r\n        this.showNotification(`Credential not found for ${exchangeData.exchange}`, 'error');\r\n        return;\r\n      }\r\n\r\n      console.log('   ‚úÖ Found credential:', { exchange: credential.exchange, id: credential.id });\r\n\r\n      // For non-Bybit exchanges, use the general subscription dialog\r\n      // Convert ExchangeData to TickerData format\r\n      const tickerData: TickerData = {\r\n        symbol: symbol,\r\n        fundingRate: exchangeData.fundingRate,\r\n        nextFundingTime: exchangeData.nextFundingTime.toString(),\r\n        lastPrice: exchangeData.lastPrice || '0',\r\n        markPrice: exchangeData.markPrice || '0',\r\n        indexPrice: '0',\r\n        openInterest: '0',\r\n        volume24h: '0',\r\n        turnover24h: '0',\r\n        price24hPcnt: '0',\r\n        // Additional required fields with default values\r\n        prevPrice24h: '0',\r\n        highPrice24h: '0',\r\n        lowPrice24h: '0',\r\n        prevPrice1h: '0',\r\n        openInterestValue: '0',\r\n        predictedDeliveryPrice: '0',\r\n        basisRate: '0',\r\n        deliveryFeeRate: '0',\r\n        deliveryTime: '0',\r\n        ask1Size: '0',\r\n        bid1Price: '0',\r\n        ask1Price: '0',\r\n        bid1Size: '0'\r\n      };\r\n\r\n      // Set the selected ticker, credential and open the dialog\r\n      this.selectedTicker.set(tickerData);\r\n      this.selectedCredentialId.set(credential.id); // IMPORTANT: Set the correct credential ID (selectedCredential will auto-update)\r\n      this.dialogLeverage.set(this.subscriptionSettings().leverage);\r\n      this.arbitrageMode.set('NON_HEDGED'); // IMPORTANT: Set mode to NON_HEDGED for single-exchange subscriptions\r\n      this.showSubscriptionDialog.set(true);\r\n      this.positionSizeUsdt.set(100); // Default position size in USDT\r\n      console.log('   ‚úÖ Subscription dialog opened with credential:', credential.exchange);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Toggle row expansion (only one row can be expanded at a time)\r\n   */\r\n  toggleExpandRow(symbol: string): void {\r\n    const currentExpanded = this.expandedRowSymbol();\r\n    if (currentExpanded === symbol) {\r\n      // Collapse if clicking on the same row\r\n      this.expandedRowSymbol.set(null);\r\n    } else {\r\n      // Expand new row (automatically collapses previous)\r\n      this.expandedRowSymbol.set(symbol);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if a row is currently expanded\r\n   */\r\n  isRowExpanded(symbol: string): boolean {\r\n    return this.expandedRowSymbol() === symbol;\r\n  }\r\n\r\n  /**\r\n   * Check if a symbol has any active subscriptions or strategies\r\n   */\r\n  hasActiveSubscriptionsOrStrategies(symbol: string): boolean {\r\n    // Check regular funding subscriptions\r\n    const hasRegularSubscription = this.subscriptions().has(symbol);\r\n\r\n    // Check Bybit funding strategies\r\n    const hasBybitStrategy = this.activeBybitStrategies().some(\r\n      strategy => strategy.symbol === symbol\r\n    );\r\n\r\n    // Check hedged arbitrage subscriptions\r\n    // Need to check if this symbol appears in any arbitrage opportunity subscriptions\r\n    const hasArbitrageSubscription = Array.from(this.subscriptions().values()).some(\r\n      sub => sub.symbol === symbol && (sub as any).hedgeExchange\r\n    );\r\n\r\n    return hasRegularSubscription || hasBybitStrategy || hasArbitrageSubscription;\r\n  }\r\n\r\n  /**\r\n   * Get subscription for a specific symbol and exchange\r\n   * @param symbol - Trading symbol\r\n   * @param exchange - Exchange name (e.g., 'BYBIT', 'BINGX', 'MEXC')\r\n   * @returns FundingSubscription if found, undefined otherwise\r\n   */\r\n  getSubscriptionForExchange(symbol: string, exchange: string): FundingSubscription | undefined {\r\n    // Check regular subscriptions (single exchange) by iterating through Map values\r\n    // The Map uses subscriptionId as key, not symbol, so we need to iterate through values\r\n    const regularSub = Array.from(this.subscriptions().values()).find(\r\n      sub => sub.symbol === symbol &&\r\n             sub.primaryExchange === exchange &&\r\n             (!(sub as any).hedgeExchange || (sub as any).hedgeExchange === 'UNKNOWN')\r\n    );\r\n    if (regularSub) {\r\n      return regularSub;\r\n    }\r\n\r\n    // Check Bybit strategies (they have their own structure)\r\n    const bybitStrategy = this.activeBybitStrategies().find(s => s.symbol === symbol);\r\n    if (bybitStrategy && (exchange === 'BYBIT' || exchange === 'BYBIT_MAINNET' || exchange === 'BYBIT_TESTNET')) {\r\n      // Convert ActiveStrategy to FundingSubscription format for display\r\n      return {\r\n        subscriptionId: bybitStrategy.id,\r\n        symbol: bybitStrategy.symbol,\r\n        fundingRate: 0, // Not stored in ActiveStrategy\r\n        nextFundingTime: 0, // Not stored in ActiveStrategy\r\n        positionType: bybitStrategy.side === 'Buy' ? 'long' : 'short',\r\n        quantity: 0, // Not directly available\r\n        status: bybitStrategy.status,\r\n        primaryExchange: 'BYBIT',\r\n        leverage: bybitStrategy.leverage,\r\n        margin: bybitStrategy.margin\r\n      } as FundingSubscription;\r\n    }\r\n\r\n    // Check arbitrage subscriptions (dual exchange)\r\n    const arbitrageSubs = Array.from(this.subscriptions().values()).filter(\r\n      sub => sub.symbol === symbol && (sub as any).hedgeExchange && (sub as any).hedgeExchange !== 'UNKNOWN'\r\n    );\r\n\r\n    for (const sub of arbitrageSubs) {\r\n      if (sub.primaryExchange === exchange || (sub as any).hedgeExchange === exchange) {\r\n        return sub;\r\n      }\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  /**\r\n   * Get all active subscriptions for a specific symbol\r\n   */\r\n  getSubscriptionsForSymbol(symbol: string): {\r\n    regular: FundingSubscription | undefined;\r\n    bybitStrategies: ActiveStrategy[];\r\n    arbitrage: FundingSubscription[];\r\n  } {\r\n    return {\r\n      regular: this.subscriptions().get(symbol),\r\n      bybitStrategies: this.activeBybitStrategies().filter(s => s.symbol === symbol),\r\n      arbitrage: Array.from(this.subscriptions().values()).filter(\r\n        sub => sub.symbol === symbol && (sub as any).hedgeExchange\r\n      )\r\n    };\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\trading\\funding-rates\\subscription-dialog.partial.html","messages":[{"ruleId":"@angular-eslint/template/click-events-have-key-events","severity":2,"message":"click must be accompanied by either keyup, keydown or keypress event for accessibility.","line":3,"column":3,"nodeType":null,"messageId":"clickEventsHaveKeyEvents","endLine":360,"endColumn":9},{"ruleId":"@angular-eslint/template/interactive-supports-focus","severity":2,"message":"Elements with interaction handlers must be focusable.","line":3,"column":3,"nodeType":null,"messageId":"interactiveSupportsFocus","endLine":360,"endColumn":9},{"ruleId":"@angular-eslint/template/click-events-have-key-events","severity":2,"message":"click must be accompanied by either keyup, keydown or keypress event for accessibility.","line":4,"column":5,"nodeType":null,"messageId":"clickEventsHaveKeyEvents","endLine":359,"endColumn":11},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":243,"column":13,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":249,"endColumn":21}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<!-- Modern Professional Subscription Dialog -->\r\n@if (showSubscriptionDialog() && selectedTicker()) {\r\n  <div class=\"subscription-modal-overlay\" (click)=\"closeSubscriptionDialog()\" [@fadeIn]>\r\n    <div class=\"subscription-modal\" (click)=\"$event.stopPropagation()\" [@slideUp] role=\"dialog\"\r\n         aria-labelledby=\"subscription-dialog-title\" aria-modal=\"true\">\r\n\r\n      <!-- Header Section -->\r\n      <div class=\"modal-header\">\r\n        <div class=\"header-content\">\r\n          <div class=\"header-icon-wrapper\">\r\n            <svg class=\"header-icon\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n              <path d=\"M12 2L2 7L12 12L22 7L12 2Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n              <path d=\"M2 17L12 22L22 17\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n              <path d=\"M2 12L12 17L22 12\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n            </svg>\r\n          </div>\r\n          <div class=\"header-text\">\r\n            <h2 class=\"modal-title\" id=\"subscription-dialog-title\">\r\n              {{ editingSubscription() ? 'Edit Subscription' : translate('fundingRates.dialog.title') }}\r\n            </h2>\r\n            <p class=\"modal-subtitle\">Configure your funding arbitrage position</p>\r\n          </div>\r\n        </div>\r\n        <button class=\"close-button\" (click)=\"closeSubscriptionDialog()\" aria-label=\"Close dialog\" type=\"button\">\r\n          <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n            <path d=\"M18 6L6 18M6 6L18 18\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n          </svg>\r\n        </button>\r\n      </div>\r\n\r\n      <!-- Body Section -->\r\n      <div class=\"modal-body\">\r\n\r\n        <!-- Symbol Information Card -->\r\n        <div class=\"info-card\">\r\n          <div class=\"info-card-header\">\r\n            <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n              <circle cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"2\"/>\r\n              <path d=\"M12 16V12M12 8H12.01\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\"/>\r\n            </svg>\r\n            <h3>Trading Pair Information</h3>\r\n          </div>\r\n          <div class=\"info-card-body\">\r\n            <div class=\"info-grid\">\r\n              <!-- Symbol -->\r\n              <div class=\"info-item\">\r\n                <div class=\"info-item-label\">\r\n                  <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                    <path d=\"M12 2L2 7L12 12L22 7L12 2Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                  </svg>\r\n                  <span>{{ translate('fundingRates.dialog.symbol') }}</span>\r\n                </div>\r\n                <div class=\"info-item-value symbol-highlight\">{{ selectedTicker()!.symbol }}</div>\r\n              </div>\r\n\r\n              <!-- Next Funding Time -->\r\n              <div class=\"info-item\">\r\n                <div class=\"info-item-label\">\r\n                  <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                    <path d=\"M12 8V12L15 15\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\"/>\r\n                    <circle cx=\"12\" cy=\"12\" r=\"9\" stroke=\"currentColor\" stroke-width=\"2\"/>\r\n                  </svg>\r\n                  <span>{{ translate('fundingRates.dialog.nextFunding') }}</span>\r\n                </div>\r\n                <div class=\"info-item-value\">{{ formatNextFundingTime(selectedTicker()!.nextFundingTime) }}</div>\r\n              </div>\r\n\r\n              <!-- Funding Rate (highlighted) -->\r\n              <div class=\"info-item featured\">\r\n                <div class=\"info-item-label\">\r\n                  <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                    <path d=\"M12 2V22M17 5H9.5C8.57174 5 7.6815 5.36875 7.02513 6.02513C6.36875 6.6815 6 7.57174 6 8.5C6 9.42826 6.36875 10.3185 7.02513 10.9749C7.6815 11.6313 8.57174 12 9.5 12H14.5C15.4283 12 16.3185 12.3687 16.9749 13.0251C17.6313 13.6815 18 14.5717 18 15.5C18 16.4283 17.6313 17.3185 16.9749 17.9749C16.3185 18.6313 15.4283 19 14.5 19H6\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                  </svg>\r\n                  <span>{{ translate('fundingRates.dialog.fundingRate') }}</span>\r\n                </div>\r\n                <div class=\"info-item-value rate-badge\" [ngClass]=\"getFundingRateClass(selectedTicker()!.fundingRate)\">\r\n                  {{ formatFundingRate(selectedTicker()!.fundingRate) }}\r\n                </div>\r\n              </div>\r\n\r\n              <!-- Position Type -->\r\n              <div class=\"info-item\">\r\n                <div class=\"info-item-label\">\r\n                  <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                    <path d=\"M7 10L12 15L17 10\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                  </svg>\r\n                  <span>{{ translate('fundingRates.dialog.positionType') }}</span>\r\n                </div>\r\n                <div class=\"info-item-value\">\r\n                  {{ parseFloat(selectedTicker()!.fundingRate) < 0 ? translate('fundingRates.dialog.longReceive') : translate('fundingRates.dialog.shortReceive') }}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Position Strategy Card -->\r\n        <div class=\"positions-card\">\r\n          <div class=\"positions-card-header\">\r\n            <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n              <path d=\"M7 21V7M17 21V3\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n              <path d=\"M3 11H7M17 15H21M3 7H7M17 19H21M3 15H7M17 11H21M3 19H7M17 7H21\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n            </svg>\r\n            <h3>{{ translate('fundingRates.dialog.positionsToOpen') }}</h3>\r\n          </div>\r\n          <div class=\"positions-grid\">\r\n            <!-- Primary Position -->\r\n            <div class=\"position-card primary\">\r\n              <div class=\"position-badge\">\r\n                {{ translate('fundingRates.dialog.primaryPosition') }}\r\n              </div>\r\n              <div class=\"position-type\"\r\n                   [class.long]=\"parseFloat(selectedTicker()!.fundingRate) < 0\"\r\n                   [class.short]=\"parseFloat(selectedTicker()!.fundingRate) >= 0\">\r\n                {{ parseFloat(selectedTicker()!.fundingRate) < 0 ? 'LONG' : 'SHORT' }}\r\n              </div>\r\n              <div class=\"position-value\">\r\n                ${{ (positionSizeUsdt() || 0) * subscriptionSettings().leverage }} USDT\r\n              </div>\r\n              <div class=\"position-margin\">\r\n                Margin: ${{ positionSizeUsdt() || 0 }} USDT\r\n              </div>\r\n              <div class=\"position-description\">\r\n                {{ parseFloat(selectedTicker()!.fundingRate) < 0 ? 'Receive funding payments' : 'Pay funding to receive later' }}\r\n              </div>\r\n            </div>\r\n\r\n            <!-- Arrow/Divider -->\r\n            <div class=\"position-divider\">\r\n              <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                <path d=\"M14 4L22 12L14 20M2 12H22\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n              </svg>\r\n            </div>\r\n\r\n            <!-- Hedge Position -->\r\n            <div class=\"position-card hedge\">\r\n              <div class=\"position-badge\">\r\n                {{ translate('fundingRates.dialog.hedgePosition') }}\r\n              </div>\r\n              <div class=\"position-type\"\r\n                   [class.long]=\"parseFloat(selectedTicker()!.fundingRate) >= 0\"\r\n                   [class.short]=\"parseFloat(selectedTicker()!.fundingRate) < 0\">\r\n                {{ parseFloat(selectedTicker()!.fundingRate) < 0 ? 'SHORT' : 'LONG' }}\r\n              </div>\r\n              <div class=\"position-value\">\r\n                ${{ (positionSizeUsdt() || 0) * subscriptionSettings().leverage }} USDT\r\n              </div>\r\n              <div class=\"position-margin\">\r\n                Margin: ${{ positionSizeUsdt() || 0 }} USDT\r\n              </div>\r\n              <div class=\"position-description\">\r\n                Hedge position (opposite direction)\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Balance Information -->\r\n        @if (isLoadingBalances()) {\r\n          <div class=\"balance-card loading\">\r\n            <div class=\"loading-spinner\"></div>\r\n            <p>{{ translate('fundingRates.dialog.loadingBalances') || 'Loading balances...' }}</p>\r\n          </div>\r\n        } @else {\r\n          <div class=\"balance-card\">\r\n            <div class=\"balance-row\">\r\n              <div class=\"balance-label\">\r\n                <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                  <rect x=\"2\" y=\"5\" width=\"20\" height=\"14\" rx=\"2\" stroke=\"currentColor\" stroke-width=\"2\"/>\r\n                  <path d=\"M2 10H22\" stroke=\"currentColor\" stroke-width=\"2\"/>\r\n                </svg>\r\n                <span>{{ translate('fundingRates.dialog.primary') }} {{ translate('fundingRates.dialog.balance') || 'Balance' }}</span>\r\n              </div>\r\n              <div class=\"balance-value\" [class.low]=\"primaryBalance() !== null && primaryBalance()! < 10\">\r\n                @if (primaryBalance() !== null) {\r\n                  <span class=\"balance-amount\">${{ primaryBalance()!.toFixed(2) }}</span>\r\n                  <span class=\"balance-currency\">USDT</span>\r\n                } @else {\r\n                  <span class=\"balance-unavailable\">{{ translate('fundingRates.dialog.unavailable') || 'N/A' }}</span>\r\n                }\r\n              </div>\r\n            </div>\r\n            <div class=\"balance-row\">\r\n              <div class=\"balance-label\">\r\n                <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                  <rect x=\"2\" y=\"5\" width=\"20\" height=\"14\" rx=\"2\" stroke=\"currentColor\" stroke-width=\"2\"/>\r\n                  <path d=\"M2 10H22\" stroke=\"currentColor\" stroke-width=\"2\"/>\r\n                </svg>\r\n                <span>{{ translate('fundingRates.dialog.hedge') }} {{ translate('fundingRates.dialog.balance') || 'Balance' }}</span>\r\n              </div>\r\n              <div class=\"balance-value\" [class.low]=\"hedgeBalance() !== null && hedgeBalance()! < 10 && hedgeBalance()! !== 999999\">\r\n                @if (hedgeBalance() !== null) {\r\n                  @if (hedgeBalance() === 999999) {\r\n                    <span class=\"balance-infinite\">‚àû</span>\r\n                    <span class=\"balance-mock\">({{ translate('fundingRates.dialog.mockExchange') }})</span>\r\n                  } @else {\r\n                    <span class=\"balance-amount\">${{ hedgeBalance()!.toFixed(2) }}</span>\r\n                    <span class=\"balance-currency\">USDT</span>\r\n                  }\r\n                } @else {\r\n                  <span class=\"balance-unavailable\">{{ translate('fundingRates.dialog.unavailable') || 'N/A' }}</span>\r\n                }\r\n              </div>\r\n            </div>\r\n          </div>\r\n        }\r\n\r\n        <!-- Configuration Form -->\r\n        <div class=\"config-form\">\r\n          <!-- Margin Input -->\r\n          <div class=\"form-field\">\r\n            <label class=\"field-label\" for=\"margin-input\">\r\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                <path d=\"M12 2V22M17 5H9.5C8.57174 5 7.6815 5.36875 7.02513 6.02513C6.36875 6.6815 6 7.57174 6 8.5C6 9.42826 6.36875 10.3185 7.02513 10.9749C7.6815 11.6313 8.57174 12 9.5 12H14.5C15.4283 12 16.3185 12.3687 16.9749 13.0251C17.6313 13.6815 18 14.5717 18 15.5C18 16.4283 17.6313 17.3185 16.9749 17.9749C16.3185 18.6313 15.4283 19 14.5 19H6\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n              </svg>\r\n              <span>Margin (USDT)</span>\r\n            </label>\r\n            <div class=\"input-wrapper\">\r\n              <input\r\n                id=\"margin-input\"\r\n                type=\"number\"\r\n                class=\"field-input\"\r\n                [ngModel]=\"positionSizeUsdt()\"\r\n                (ngModelChange)=\"positionSizeUsdt.set($event)\"\r\n                step=\"10\"\r\n                min=\"10\"\r\n                placeholder=\"e.g., 100\"\r\n                aria-label=\"Margin amount in USDT\"\r\n              />\r\n              <div class=\"input-suffix\">USDT</div>\r\n            </div>\r\n            <p class=\"field-hint\">\r\n              <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                <circle cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"2\"/>\r\n                <path d=\"M12 16V12M12 8H12.01\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\"/>\r\n              </svg>\r\n              Your collateral amount. With {{ subscriptionSettings().leverage }}x leverage, this will open a position worth ${{ (positionSizeUsdt() || 0) * subscriptionSettings().leverage }} USDT\r\n            </p>\r\n          </div>\r\n\r\n          <!-- Leverage Display -->\r\n          <div class=\"form-field\">\r\n            <label class=\"field-label\">\r\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                <path d=\"M21 16V8C20.9996 7.64927 20.9071 7.30481 20.7315 7.00116C20.556 6.69751 20.3037 6.44536 20 6.27L13 2.27C12.696 2.09446 12.3511 2.00205 12 2.00205C11.6489 2.00205 11.304 2.09446 11 2.27L4 6.27C3.69626 6.44536 3.44398 6.69751 3.26846 7.00116C3.09294 7.30481 3.00036 7.64927 3 8V16C3.00036 16.3507 3.09294 16.6952 3.26846 16.9988C3.44398 17.3025 3.69626 17.5546 4 17.73L11 21.73C11.304 21.9055 11.6489 21.9979 12 21.9979C12.3511 21.9979 12.696 21.9055 13 21.73L20 17.73C20.3037 17.5546 20.556 17.3025 20.7315 16.9988C20.9071 16.6952 20.9996 16.3507 21 16Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                <path d=\"M3.27 6.96L12 12.01L20.73 6.96M12 22.08V12\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n              </svg>\r\n              <span>{{ translate('fundingRates.settings.leverage') }}</span>\r\n            </label>\r\n            <div class=\"leverage-display-box\">\r\n              <div class=\"leverage-value-large\">{{ subscriptionSettings().leverage }}x</div>\r\n              <p class=\"leverage-hint\">\r\n                {{ translate('fundingRates.dialog.currentLeverage') }}. {{ translate('fundingRates.dialog.changeIn') }}\r\n                <button type=\"button\" class=\"settings-link-btn\" (click)=\"closeSubscriptionDialog(); openSettingsDialog()\">\r\n                  <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                    <circle cx=\"12\" cy=\"12\" r=\"3\" stroke=\"currentColor\" stroke-width=\"2\"/>\r\n                    <path d=\"M12 1V3M12 21V23M4.22 4.22L5.64 5.64M18.36 18.36L19.78 19.78M1 12H3M21 12H23M4.22 19.78L5.64 18.36M18.36 5.64L19.78 4.22\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\"/>\r\n                  </svg>\r\n                  {{ translate('fundingRates.filters.settings') }}\r\n                </button>\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Position Calculation Summary -->\r\n        @if (positionCalculation()) {\r\n          <div class=\"calculation-card\">\r\n            <div class=\"calculation-header\">\r\n              <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" stroke=\"currentColor\" stroke-width=\"2\"/>\r\n                <path d=\"M3 9H21M9 21V9\" stroke=\"currentColor\" stroke-width=\"2\"/>\r\n              </svg>\r\n              <h3>Position Details</h3>\r\n            </div>\r\n            <div class=\"calculation-grid\">\r\n              <div class=\"calc-item\">\r\n                <span class=\"calc-label\">Coin Quantity</span>\r\n                <span class=\"calc-value\">{{ positionCalculation()!.quantity.toFixed(6) }} {{ positionCalculation()!.symbol.replace('USDT', '') }}</span>\r\n              </div>\r\n              <div class=\"calc-item\">\r\n                <span class=\"calc-label\">Estimated Price</span>\r\n                <span class=\"calc-value\">${{ positionCalculation()!.estimatedPrice.toFixed(2) }}</span>\r\n              </div>\r\n              <div class=\"calc-item\">\r\n                <span class=\"calc-label\">Position Value</span>\r\n                <span class=\"calc-value\">${{ positionCalculation()!.positionValue.toFixed(2) }} USDT</span>\r\n              </div>\r\n              <div class=\"calc-item\">\r\n                <span class=\"calc-label\">Leverage</span>\r\n                <span class=\"calc-value\">{{ positionCalculation()!.leverage }}x</span>\r\n              </div>\r\n              <div class=\"calc-item important\">\r\n                <span class=\"calc-label\">\r\n                  <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                    <path d=\"M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z\" stroke=\"currentColor\" stroke-width=\"2\"/>\r\n                    <path d=\"M12 8V12L15 15\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\"/>\r\n                  </svg>\r\n                  Required Margin (per exchange)\r\n                </span>\r\n                <span class=\"calc-value highlight\">${{ positionCalculation()!.requiredMargin.toFixed(2) }} USDT</span>\r\n              </div>\r\n              <div class=\"calc-item\">\r\n                <span class=\"calc-label\">Est. Fees (Entry+Exit)</span>\r\n                <span class=\"calc-value\">${{ positionCalculation()!.estimatedFee.toFixed(2) }} USDT</span>\r\n              </div>\r\n            </div>\r\n            <div class=\"calculation-note\">\r\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                <path d=\"M12 9V13M12 17H12.01M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n              </svg>\r\n              <span>Each exchange needs <strong>${{ positionCalculation()!.requiredMargin.toFixed(2) }} USDT</strong> margin</span>\r\n            </div>\r\n          </div>\r\n        }\r\n\r\n        <!-- Warning Notice -->\r\n        <div class=\"warning-card\">\r\n          <div class=\"warning-header\">\r\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n              <path d=\"M10.29 3.86L1.82 18C1.64537 18.3024 1.55296 18.6453 1.55199 18.9945C1.55101 19.3437 1.64151 19.6871 1.81441 19.9905C1.98731 20.2939 2.23641 20.5467 2.53696 20.7239C2.83751 20.9011 3.18058 20.9962 3.53 21H20.47C20.8194 20.9962 21.1625 20.9011 21.463 20.7239C21.7636 20.5467 22.0127 20.2939 22.1856 19.9905C22.3585 19.6871 22.449 19.3437 22.448 18.9945C22.447 18.6453 22.3546 18.3024 22.18 18L13.71 3.86C13.5317 3.56611 13.2807 3.32312 12.9812 3.15448C12.6817 2.98585 12.3437 2.89725 12 2.89725C11.6563 2.89725 11.3183 2.98585 11.0188 3.15448C10.7193 3.32312 10.4683 3.56611 10.29 3.86Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n              <path d=\"M12 9V13M12 17H12.01\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n            </svg>\r\n            <span>{{ translate('fundingRates.dialog.warning') }}</span>\r\n          </div>\r\n          <ul class=\"warning-list\">\r\n            <li>\r\n              <strong>{{ translate('fundingRates.dialog.primary') }}:</strong>\r\n              {{ selectedCredential()?.exchange }} {{ selectedCredential()?.environment }}\r\n            </li>\r\n            <li>\r\n              <strong>{{ translate('fundingRates.dialog.hedge') }}:</strong>\r\n              @if (hedgeCredential()) {\r\n                {{ hedgeCredential()!.exchange }} {{ hedgeCredential()!.environment }}\r\n              } @else {\r\n                {{ translate('fundingRates.dialog.mockExchange') }}\r\n              }\r\n            </li>\r\n          </ul>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Footer Section -->\r\n      <div class=\"modal-footer\">\r\n        <ui-button variant=\"ghost\" (clicked)=\"closeSubscriptionDialog()\" size=\"large\">\r\n          <span>{{ translate('fundingRates.actions.cancel') }}</span>\r\n        </ui-button>\r\n        <ui-button\r\n          variant=\"primary\"\r\n          (clicked)=\"subscribeFundingRate()\"\r\n          [loading]=\"isSubscribing()\"\r\n          size=\"large\">\r\n          <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n            <path d=\"M13 2L3 14H12L11 22L21 10H12L13 2Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n          </svg>\r\n          <span>{{ editingSubscription() ? 'Save Changes' : translate('fundingRates.actions.subscribe') }}</span>\r\n        </ui-button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\trading\\funding-revenue\\funding-revenue.component.html","messages":[{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":29,"column":13,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":29,"endColumn":59},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":38,"column":13,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":38,"endColumn":57},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":47,"column":13,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":47,"endColumn":57},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":57,"column":13,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":57,"endColumn":55},{"ruleId":"@angular-eslint/template/click-events-have-key-events","severity":2,"message":"click must be accompanied by either keyup, keydown or keypress event for accessibility.","line":345,"column":17,"nodeType":null,"messageId":"clickEventsHaveKeyEvents","endLine":363,"endColumn":23},{"ruleId":"@angular-eslint/template/interactive-supports-focus","severity":2,"message":"Elements with interaction handlers must be focusable.","line":345,"column":17,"nodeType":null,"messageId":"interactiveSupportsFocus","endLine":363,"endColumn":23}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<div class=\"funding-revenue-container\">\r\n  <!-- Header -->\r\n  <div class=\"funding-revenue-header\">\r\n    <h2 class=\"funding-revenue-title\">Funding Arbitrage Revenue</h2>\r\n    <div class=\"funding-revenue-actions\">\r\n      <ui-button\r\n        variant=\"ghost\"\r\n        size=\"small\"\r\n        (clicked)=\"toggleFilters()\"\r\n        [attr.aria-expanded]=\"showFilters()\">\r\n        <span>{{ showFilters() ? 'Hide Filters' : 'Show Filters' }}</span>\r\n      </ui-button>\r\n      <ui-button\r\n        variant=\"primary\"\r\n        size=\"small\"\r\n        (clicked)=\"refreshRevenue()\"\r\n        [loading]=\"isLoading()\">\r\n        <span>Refresh</span>\r\n      </ui-button>\r\n    </div>\r\n  </div>\r\n\r\n  <!-- Filters Panel -->\r\n  @if (showFilters()) {\r\n    <ui-card variant=\"outlined\" class=\"filters-card\">\r\n      <ui-card-content>\r\n        <div class=\"filters-container\">\r\n          <div class=\"filter-group\">\r\n            <label class=\"filter-label\">Start Date</label>\r\n            <input\r\n              type=\"date\"\r\n              class=\"filter-input\"\r\n              [(ngModel)]=\"startDate\"\r\n            />\r\n          </div>\r\n\r\n          <div class=\"filter-group\">\r\n            <label class=\"filter-label\">End Date</label>\r\n            <input\r\n              type=\"date\"\r\n              class=\"filter-input\"\r\n              [(ngModel)]=\"endDate\"\r\n            />\r\n          </div>\r\n\r\n          <div class=\"filter-group\">\r\n            <label class=\"filter-label\">Exchange</label>\r\n            <select class=\"filter-input filter-select\" [(ngModel)]=\"selectedExchange\">\r\n              <option value=\"\">All Exchanges</option>\r\n              @for (exchange of availableExchanges(); track exchange) {\r\n                <option [value]=\"exchange\">{{ exchange }}</option>\r\n              }\r\n            </select>\r\n          </div>\r\n\r\n          <div class=\"filter-group\">\r\n            <label class=\"filter-label\">Symbol</label>\r\n            <select class=\"filter-input filter-select\" [(ngModel)]=\"selectedSymbol\">\r\n              <option value=\"\">All Symbols</option>\r\n              @for (symbol of availableSymbols(); track symbol) {\r\n                <option [value]=\"symbol\">{{ symbol }}</option>\r\n              }\r\n            </select>\r\n          </div>\r\n\r\n          <div class=\"filter-actions\">\r\n            <ui-button variant=\"primary\" size=\"small\" (clicked)=\"applyFilters()\">\r\n              Apply Filters\r\n            </ui-button>\r\n            <ui-button variant=\"ghost\" size=\"small\" (clicked)=\"clearFilters()\">\r\n              Clear\r\n            </ui-button>\r\n          </div>\r\n        </div>\r\n      </ui-card-content>\r\n    </ui-card>\r\n  }\r\n\r\n  <!-- Loading State -->\r\n  @if (isLoading()) {\r\n    <div class=\"loading-state\">\r\n      <p>Loading revenue data...</p>\r\n    </div>\r\n  }\r\n\r\n  <!-- Error State -->\r\n  @if (error() && !isLoading()) {\r\n    <div class=\"error-state\">\r\n      <p>{{ error() }}</p>\r\n      <ui-button variant=\"primary\" size=\"small\" (clicked)=\"refreshRevenue()\">\r\n        Retry\r\n      </ui-button>\r\n    </div>\r\n  }\r\n\r\n  <!-- Revenue Data -->\r\n  @if (revenueData() && !isLoading() && !error()) {\r\n    <!-- Summary Cards -->\r\n    <div class=\"summary-grid\">\r\n      <!-- Total Revenue -->\r\n      <ui-card variant=\"elevated\" class=\"metric-card revenue-card\">\r\n        <ui-card-content>\r\n          <div class=\"metric-header\">\r\n            <span class=\"metric-icon\">üí∞</span>\r\n            <span class=\"metric-label\">Total Revenue</span>\r\n          </div>\r\n          <div class=\"metric-value\" [class]=\"getValueClass(summary()!.totalRevenue)\">\r\n            {{ formatCurrency(summary()!.totalRevenue) }}\r\n          </div>\r\n          <div class=\"metric-subtext\">\r\n            Net: {{ formatCurrency(netProfit()) }}\r\n          </div>\r\n        </ui-card-content>\r\n      </ui-card>\r\n\r\n      <!-- Total Deals -->\r\n      <ui-card variant=\"elevated\" class=\"metric-card\">\r\n        <ui-card-content>\r\n          <div class=\"metric-header\">\r\n            <span class=\"metric-icon\">üìä</span>\r\n            <span class=\"metric-label\">Total Deals</span>\r\n          </div>\r\n          <div class=\"metric-value\">\r\n            {{ summary()!.totalDeals }}\r\n          </div>\r\n          <div class=\"metric-subtext\">\r\n            Profitable: {{ summary()!.profitableDeals }} | Losing: {{ summary()!.losingDeals }}\r\n          </div>\r\n        </ui-card-content>\r\n      </ui-card>\r\n\r\n      <!-- Win Rate -->\r\n      <ui-card variant=\"elevated\" class=\"metric-card\">\r\n        <ui-card-content>\r\n          <div class=\"metric-header\">\r\n            <span class=\"metric-icon\">üéØ</span>\r\n            <span class=\"metric-label\">Win Rate</span>\r\n          </div>\r\n          <div class=\"metric-value\" [class]=\"getWinRateClass(summary()!.winRate)\">\r\n            {{ formatPercent(summary()!.winRate) }}\r\n          </div>\r\n          <div class=\"metric-subtext\">\r\n            {{ summary()!.profitableDeals }} / {{ summary()!.totalDeals }} trades\r\n          </div>\r\n        </ui-card-content>\r\n      </ui-card>\r\n\r\n      <!-- Total Funding Earned -->\r\n      <ui-card variant=\"elevated\" class=\"metric-card\">\r\n        <ui-card-content>\r\n          <div class=\"metric-header\">\r\n            <span class=\"metric-icon\">üíµ</span>\r\n            <span class=\"metric-label\">Funding Earned</span>\r\n          </div>\r\n          <div class=\"metric-value positive\">\r\n            {{ formatCurrency(summary()!.totalFundingEarned) }}\r\n          </div>\r\n          <div class=\"metric-subtext\">\r\n            From funding payments\r\n          </div>\r\n        </ui-card-content>\r\n      </ui-card>\r\n\r\n      <!-- Total Trading P&L -->\r\n      <ui-card variant=\"elevated\" class=\"metric-card\">\r\n        <ui-card-content>\r\n          <div class=\"metric-header\">\r\n            <span class=\"metric-icon\">üìà</span>\r\n            <span class=\"metric-label\">Trading P&L</span>\r\n          </div>\r\n          <div class=\"metric-value\" [class]=\"getValueClass(summary()!.totalTradingPnl)\">\r\n            {{ formatCurrency(summary()!.totalTradingPnl) }}\r\n          </div>\r\n          <div class=\"metric-subtext\">\r\n            Price movement impact\r\n          </div>\r\n        </ui-card-content>\r\n      </ui-card>\r\n\r\n      <!-- Average Revenue Per Deal -->\r\n      <ui-card variant=\"elevated\" class=\"metric-card\">\r\n        <ui-card-content>\r\n          <div class=\"metric-header\">\r\n            <span class=\"metric-icon\">üìä</span>\r\n            <span class=\"metric-label\">Avg per Deal</span>\r\n          </div>\r\n          <div class=\"metric-value\" [class]=\"getValueClass(summary()!.avgRevenuePerDeal)\">\r\n            {{ formatCurrency(summary()!.avgRevenuePerDeal) }}\r\n          </div>\r\n          <div class=\"metric-subtext\">\r\n            Average profit per trade\r\n          </div>\r\n        </ui-card-content>\r\n      </ui-card>\r\n    </div>\r\n\r\n    <!-- Best and Worst Deals -->\r\n    @if (summary()!.bestDeal || summary()!.worstDeal) {\r\n      <div class=\"best-worst-grid\">\r\n        <!-- Best Deal -->\r\n        @if (summary()!.bestDeal) {\r\n          <ui-card variant=\"elevated\" class=\"deal-highlight-card best-deal-card\">\r\n            <ui-card-header>\r\n              <ui-card-title>Best Deal üèÜ</ui-card-title>\r\n            </ui-card-header>\r\n            <ui-card-content>\r\n              <div class=\"deal-highlight-info\">\r\n                <div class=\"deal-highlight-row\">\r\n                  <span class=\"deal-label\">Symbol:</span>\r\n                  <span class=\"deal-value\">{{ summary()!.bestDeal!.symbol }}</span>\r\n                </div>\r\n                <div class=\"deal-highlight-row\">\r\n                  <span class=\"deal-label\">Revenue:</span>\r\n                  <span class=\"deal-value positive\">{{ formatCurrency(summary()!.bestDeal!.revenue) }}</span>\r\n                </div>\r\n                <div class=\"deal-highlight-row\">\r\n                  <span class=\"deal-label\">Date:</span>\r\n                  <span class=\"deal-value\">{{ formatDate(summary()!.bestDeal!.date) }}</span>\r\n                </div>\r\n              </div>\r\n            </ui-card-content>\r\n          </ui-card>\r\n        }\r\n\r\n        <!-- Worst Deal -->\r\n        @if (summary()!.worstDeal) {\r\n          <ui-card variant=\"elevated\" class=\"deal-highlight-card worst-deal-card\">\r\n            <ui-card-header>\r\n              <ui-card-title>Worst Deal üìâ</ui-card-title>\r\n            </ui-card-header>\r\n            <ui-card-content>\r\n              <div class=\"deal-highlight-info\">\r\n                <div class=\"deal-highlight-row\">\r\n                  <span class=\"deal-label\">Symbol:</span>\r\n                  <span class=\"deal-value\">{{ summary()!.worstDeal!.symbol }}</span>\r\n                </div>\r\n                <div class=\"deal-highlight-row\">\r\n                  <span class=\"deal-label\">Revenue:</span>\r\n                  <span class=\"deal-value negative\">{{ formatCurrency(summary()!.worstDeal!.revenue) }}</span>\r\n                </div>\r\n                <div class=\"deal-highlight-row\">\r\n                  <span class=\"deal-label\">Date:</span>\r\n                  <span class=\"deal-value\">{{ formatDate(summary()!.worstDeal!.date) }}</span>\r\n                </div>\r\n              </div>\r\n            </ui-card-content>\r\n          </ui-card>\r\n        }\r\n      </div>\r\n    }\r\n\r\n    <!-- Revenue by Symbol -->\r\n    @if (bySymbol().length > 0) {\r\n      <ui-card variant=\"outlined\" class=\"data-table-card\">\r\n        <ui-card-header>\r\n          <ui-card-title>Revenue by Symbol</ui-card-title>\r\n        </ui-card-header>\r\n        <ui-card-content>\r\n          <div class=\"table-wrapper\">\r\n            <table class=\"data-table\">\r\n              <thead>\r\n                <tr>\r\n                  <th>Symbol</th>\r\n                  <th class=\"text-right\">Deals</th>\r\n                  <th class=\"text-right\">Total Revenue</th>\r\n                  <th class=\"text-right\">Avg Revenue</th>\r\n                  <th class=\"text-right\">Funding Earned</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                @for (item of bySymbol(); track item.symbol) {\r\n                  <tr>\r\n                    <td class=\"symbol-cell\">{{ item.symbol }}</td>\r\n                    <td class=\"text-right\">{{ item.deals }}</td>\r\n                    <td class=\"text-right\" [class]=\"getValueClass(item.revenue)\">\r\n                      {{ formatCurrency(item.revenue) }}\r\n                    </td>\r\n                    <td class=\"text-right\" [class]=\"getValueClass(item.avgRevenue)\">\r\n                      {{ formatCurrency(item.avgRevenue) }}\r\n                    </td>\r\n                    <td class=\"text-right positive\">\r\n                      {{ formatCurrency(item.fundingEarned) }}\r\n                    </td>\r\n                  </tr>\r\n                }\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </ui-card-content>\r\n      </ui-card>\r\n    }\r\n\r\n    <!-- Revenue by Exchange -->\r\n    @if (byExchange().length > 0) {\r\n      <ui-card variant=\"outlined\" class=\"data-table-card\">\r\n        <ui-card-header>\r\n          <ui-card-title>Revenue by Exchange</ui-card-title>\r\n        </ui-card-header>\r\n        <ui-card-content>\r\n          <div class=\"table-wrapper\">\r\n            <table class=\"data-table\">\r\n              <thead>\r\n                <tr>\r\n                  <th>Exchange</th>\r\n                  <th class=\"text-right\">Deals</th>\r\n                  <th class=\"text-right\">Total Revenue</th>\r\n                  <th class=\"text-right\">Avg Revenue</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                @for (item of byExchange(); track item.exchange) {\r\n                  <tr>\r\n                    <td class=\"exchange-cell\">\r\n                      <span class=\"exchange-badge\" [class]=\"'badge-' + item.exchange.toLowerCase()\">\r\n                        {{ item.exchange }}\r\n                      </span>\r\n                    </td>\r\n                    <td class=\"text-right\">{{ item.deals }}</td>\r\n                    <td class=\"text-right\" [class]=\"getValueClass(item.revenue)\">\r\n                      {{ formatCurrency(item.revenue) }}\r\n                    </td>\r\n                    <td class=\"text-right\" [class]=\"getValueClass(item.avgRevenue)\">\r\n                      {{ formatCurrency(item.avgRevenue) }}\r\n                    </td>\r\n                  </tr>\r\n                }\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </ui-card-content>\r\n      </ui-card>\r\n    }\r\n\r\n    <!-- Individual Deals -->\r\n    @if (deals().length > 0) {\r\n      <ui-card variant=\"outlined\" class=\"deals-card\">\r\n        <ui-card-header>\r\n          <ui-card-title>Completed Deals ({{ deals().length }})</ui-card-title>\r\n        </ui-card-header>\r\n        <ui-card-content>\r\n          <div class=\"deals-list\">\r\n            @for (deal of deals(); track deal.id) {\r\n              <div class=\"deal-item\" [class.expanded]=\"isDealExpanded(deal.id)\">\r\n                <!-- Deal Header (always visible) -->\r\n                <div class=\"deal-header\" (click)=\"toggleDealExpansion(deal.id)\">\r\n                  <div class=\"deal-main-info\">\r\n                    <span class=\"deal-symbol\">{{ deal.symbol }}</span>\r\n                    <span class=\"deal-exchanges\">\r\n                      {{ deal.primaryExchange }} ‚Üî {{ deal.hedgeExchange }}\r\n                    </span>\r\n                    <span class=\"deal-position-type\" [class]=\"deal.positionType\">\r\n                      {{ deal.positionType.toUpperCase() }}\r\n                    </span>\r\n                  </div>\r\n                  <div class=\"deal-summary-info\">\r\n                    <span class=\"deal-pnl\" [class]=\"getValueClass(deal.realizedPnl)\">\r\n                      {{ formatCurrency(deal.realizedPnl) }}\r\n                    </span>\r\n                    <span class=\"deal-expand-icon\">\r\n                      {{ isDealExpanded(deal.id) ? '‚ñ≤' : '‚ñº' }}\r\n                    </span>\r\n                  </div>\r\n                </div>\r\n\r\n                <!-- Deal Details (expandable) -->\r\n                @if (isDealExpanded(deal.id)) {\r\n                  <div class=\"deal-details\">\r\n                    <div class=\"deal-details-grid\">\r\n                      <div class=\"detail-row\">\r\n                        <span class=\"detail-label\">Quantity:</span>\r\n                        <span class=\"detail-value\">{{ formatNumber(deal.quantity, 6) }}</span>\r\n                      </div>\r\n                      <div class=\"detail-row\">\r\n                        <span class=\"detail-label\">Funding Rate:</span>\r\n                        <span class=\"detail-value\">{{ formatPercent(deal.fundingRate * 100) }}</span>\r\n                      </div>\r\n                      <div class=\"detail-row\">\r\n                        <span class=\"detail-label\">Entry Price:</span>\r\n                        <span class=\"detail-value\">{{ formatCurrency(deal.entryPrice) }}</span>\r\n                      </div>\r\n                      <div class=\"detail-row\">\r\n                        <span class=\"detail-label\">Hedge Entry:</span>\r\n                        <span class=\"detail-value\">{{ formatCurrency(deal.hedgeEntryPrice) }}</span>\r\n                      </div>\r\n                      @if (deal.primaryExitPrice !== null) {\r\n                        <div class=\"detail-row\">\r\n                          <span class=\"detail-label\">Exit Price:</span>\r\n                          <span class=\"detail-value\">{{ formatCurrency(deal.primaryExitPrice) }}</span>\r\n                        </div>\r\n                      }\r\n                      @if (deal.hedgeExitPrice !== null) {\r\n                        <div class=\"detail-row\">\r\n                          <span class=\"detail-label\">Hedge Exit:</span>\r\n                          <span class=\"detail-value\">{{ formatCurrency(deal.hedgeExitPrice) }}</span>\r\n                        </div>\r\n                      }\r\n                      <div class=\"detail-row highlight\">\r\n                        <span class=\"detail-label\">Funding Earned:</span>\r\n                        <span class=\"detail-value positive\">{{ formatCurrency(deal.fundingEarned) }}</span>\r\n                      </div>\r\n                      <div class=\"detail-row highlight\">\r\n                        <span class=\"detail-label\">Realized P&L:</span>\r\n                        <span class=\"detail-value\" [class]=\"getValueClass(deal.realizedPnl)\">\r\n                          {{ formatCurrency(deal.realizedPnl) }}\r\n                        </span>\r\n                      </div>\r\n                      <div class=\"detail-row\">\r\n                        <span class=\"detail-label\">Primary Fees:</span>\r\n                        <span class=\"detail-value\">{{ formatCurrency(deal.primaryTradingFees) }}</span>\r\n                      </div>\r\n                      <div class=\"detail-row\">\r\n                        <span class=\"detail-label\">Hedge Fees:</span>\r\n                        <span class=\"detail-value\">{{ formatCurrency(deal.hedgeTradingFees) }}</span>\r\n                      </div>\r\n                      <div class=\"detail-row\">\r\n                        <span class=\"detail-label\">Executed At:</span>\r\n                        <span class=\"detail-value\">{{ formatDate(deal.executedAt) }}</span>\r\n                      </div>\r\n                      <div class=\"detail-row\">\r\n                        <span class=\"detail-label\">Closed At:</span>\r\n                        <span class=\"detail-value\">{{ formatDate(deal.closedAt) }}</span>\r\n                      </div>\r\n                      @if (deal.duration !== null) {\r\n                        <div class=\"detail-row\">\r\n                          <span class=\"detail-label\">Duration:</span>\r\n                          <span class=\"detail-value\">{{ formatDuration(deal.duration) }}</span>\r\n                        </div>\r\n                      }\r\n                    </div>\r\n                  </div>\r\n                }\r\n              </div>\r\n            }\r\n          </div>\r\n        </ui-card-content>\r\n      </ui-card>\r\n    }\r\n\r\n    <!-- Empty State -->\r\n    @if (deals().length === 0) {\r\n      <div class=\"empty-state\">\r\n        <p>No completed deals found for the selected filters.</p>\r\n        <p class=\"help-text\">Try adjusting your date range or clearing filters.</p>\r\n      </div>\r\n    }\r\n  }\r\n</div>\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\trading\\funding-revenue\\funding-revenue.component.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":114,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":117,"endColumn":7},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":118,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":118,"endColumn":92},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":123,"column":45,"nodeType":"Property","messageId":"anyAssignment","endLine":123,"endColumn":81},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":124,"column":40,"nodeType":"Property","messageId":"anyAssignment","endLine":124,"endColumn":71}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { ComponentFixture, TestBed } from '@angular/core/testing';\r\nimport { FundingRevenueComponent } from './funding-revenue.component';\r\nimport { FundingArbitrageService, FundingArbitrageRevenueResponse } from '../../../services/funding-arbitrage.service';\r\nimport { TranslationService } from '../../../services/translation.service';\r\nimport { of, throwError } from 'rxjs';\r\nimport { HttpClientTestingModule } from '@angular/common/http/testing';\r\n\r\ndescribe('FundingRevenueComponent', () => {\r\n  let component: FundingRevenueComponent;\r\n  let fixture: ComponentFixture<FundingRevenueComponent>;\r\n  let fundingArbitrageService: jasmine.SpyObj<FundingArbitrageService>;\r\n  let translationService: jasmine.SpyObj<TranslationService>;\r\n\r\n  const mockRevenueResponse: FundingArbitrageRevenueResponse = {\r\n    success: true,\r\n    data: {\r\n      summary: {\r\n        totalDeals: 10,\r\n        totalRevenue: 1250.50,\r\n        totalFundingEarned: 800.25,\r\n        totalTradingPnl: 450.25,\r\n        avgRevenuePerDeal: 125.05,\r\n        winRate: 80,\r\n        profitableDeals: 8,\r\n        losingDeals: 2,\r\n        bestDeal: {\r\n          symbol: 'BTCUSDT',\r\n          revenue: 250.00,\r\n          date: '2025-10-01T12:00:00Z'\r\n        },\r\n        worstDeal: {\r\n          symbol: 'ETHUSDT',\r\n          revenue: -50.00,\r\n          date: '2025-10-02T14:00:00Z'\r\n        }\r\n      },\r\n      bySymbol: [\r\n        {\r\n          symbol: 'BTCUSDT',\r\n          deals: 5,\r\n          revenue: 750.00,\r\n          avgRevenue: 150.00,\r\n          fundingEarned: 500.00\r\n        },\r\n        {\r\n          symbol: 'ETHUSDT',\r\n          deals: 5,\r\n          revenue: 500.50,\r\n          avgRevenue: 100.10,\r\n          fundingEarned: 300.25\r\n        }\r\n      ],\r\n      byExchange: [\r\n        {\r\n          exchange: 'BYBIT',\r\n          deals: 7,\r\n          revenue: 900.00,\r\n          avgRevenue: 128.57\r\n        },\r\n        {\r\n          exchange: 'BINGX',\r\n          deals: 3,\r\n          revenue: 350.50,\r\n          avgRevenue: 116.83\r\n        }\r\n      ],\r\n      deals: [\r\n        {\r\n          id: '1',\r\n          symbol: 'BTCUSDT',\r\n          primaryExchange: 'BYBIT',\r\n          hedgeExchange: 'BINGX',\r\n          fundingRate: 0.001,\r\n          positionType: 'long',\r\n          quantity: 0.5,\r\n          entryPrice: 45000,\r\n          hedgeEntryPrice: 45010,\r\n          primaryExitPrice: 45100,\r\n          hedgeExitPrice: 45090,\r\n          fundingEarned: 22.50,\r\n          realizedPnl: 50.00,\r\n          primaryTradingFees: 12.50,\r\n          hedgeTradingFees: 12.50,\r\n          executedAt: '2025-10-01T10:00:00Z',\r\n          closedAt: '2025-10-01T18:00:00Z',\r\n          duration: 28800\r\n        }\r\n      ],\r\n      timeline: [\r\n        {\r\n          date: '2025-10-01',\r\n          deals: 5,\r\n          revenue: 625.00,\r\n          fundingEarned: 400.00\r\n        },\r\n        {\r\n          date: '2025-10-02',\r\n          deals: 5,\r\n          revenue: 625.50,\r\n          fundingEarned: 400.25\r\n        }\r\n      ]\r\n    },\r\n    filters: {\r\n      startDate: '2025-09-08',\r\n      endDate: '2025-10-08',\r\n      exchange: null,\r\n      symbol: null\r\n    },\r\n    timestamp: '2025-10-08T12:00:00Z'\r\n  };\r\n\r\n  beforeEach(async () => {\r\n    const fundingArbitrageServiceSpy = jasmine.createSpyObj('FundingArbitrageService', [\r\n      'getRevenue',\r\n      'refreshRevenue'\r\n    ]);\r\n    const translationServiceSpy = jasmine.createSpyObj('TranslationService', ['translate']);\r\n\r\n    await TestBed.configureTestingModule({\r\n      imports: [FundingRevenueComponent, HttpClientTestingModule],\r\n      providers: [\r\n        { provide: FundingArbitrageService, useValue: fundingArbitrageServiceSpy },\r\n        { provide: TranslationService, useValue: translationServiceSpy }\r\n      ]\r\n    }).compileComponents();\r\n\r\n    fundingArbitrageService = TestBed.inject(FundingArbitrageService) as jasmine.SpyObj<FundingArbitrageService>;\r\n    translationService = TestBed.inject(TranslationService) as jasmine.SpyObj<TranslationService>;\r\n    translationService.translate.and.returnValue('Translated');\r\n\r\n    fixture = TestBed.createComponent(FundingRevenueComponent);\r\n    component = fixture.componentInstance;\r\n  });\r\n\r\n  it('should create', () => {\r\n    expect(component).toBeTruthy();\r\n  });\r\n\r\n  describe('Component Initialization', () => {\r\n    it('should load revenue data on init', () => {\r\n      fundingArbitrageService.getRevenue.and.returnValue(of(mockRevenueResponse));\r\n\r\n      fixture.detectChanges(); // triggers ngOnInit\r\n\r\n      expect(fundingArbitrageService.getRevenue).toHaveBeenCalled();\r\n      expect(component.revenueData()).toEqual(mockRevenueResponse);\r\n      expect(component.isLoading()).toBe(false);\r\n    });\r\n\r\n    it('should set default date range (30 days)', () => {\r\n      const today = new Date().toISOString().split('T')[0];\r\n      const thirtyDaysAgo = new Date();\r\n      thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\r\n      const expectedStartDate = thirtyDaysAgo.toISOString().split('T')[0];\r\n\r\n      fundingArbitrageService.getRevenue.and.returnValue(of(mockRevenueResponse));\r\n      fixture.detectChanges();\r\n\r\n      expect(component.startDate()).toBe(expectedStartDate);\r\n      expect(component.endDate()).toBe(today);\r\n    });\r\n  });\r\n\r\n  describe('Loading State', () => {\r\n    it('should set isLoading to true while fetching data', () => {\r\n      fundingArbitrageService.getRevenue.and.returnValue(of(mockRevenueResponse).pipe());\r\n\r\n      component.loadRevenue();\r\n\r\n      expect(component.isLoading()).toBe(true);\r\n    });\r\n\r\n    it('should set isLoading to false after successful fetch', (done) => {\r\n      fundingArbitrageService.getRevenue.and.returnValue(of(mockRevenueResponse));\r\n\r\n      component.loadRevenue();\r\n\r\n      setTimeout(() => {\r\n        expect(component.isLoading()).toBe(false);\r\n        done();\r\n      }, 0);\r\n    });\r\n\r\n    it('should set isLoading to false after error', (done) => {\r\n      const errorMessage = 'Failed to fetch data';\r\n      fundingArbitrageService.getRevenue.and.returnValue(throwError(() => new Error(errorMessage)));\r\n\r\n      component.loadRevenue();\r\n\r\n      setTimeout(() => {\r\n        expect(component.isLoading()).toBe(false);\r\n        expect(component.error()).toBe(errorMessage);\r\n        done();\r\n      }, 0);\r\n    });\r\n  });\r\n\r\n  describe('Computed Signals', () => {\r\n    beforeEach(() => {\r\n      fundingArbitrageService.getRevenue.and.returnValue(of(mockRevenueResponse));\r\n      fixture.detectChanges();\r\n    });\r\n\r\n    it('should compute summary from revenue data', () => {\r\n      expect(component.summary()).toEqual(mockRevenueResponse.data.summary);\r\n    });\r\n\r\n    it('should compute bySymbol from revenue data', () => {\r\n      expect(component.bySymbol()).toEqual(mockRevenueResponse.data.bySymbol);\r\n    });\r\n\r\n    it('should compute byExchange from revenue data', () => {\r\n      expect(component.byExchange()).toEqual(mockRevenueResponse.data.byExchange);\r\n    });\r\n\r\n    it('should compute deals from revenue data', () => {\r\n      expect(component.deals()).toEqual(mockRevenueResponse.data.deals);\r\n    });\r\n\r\n    it('should compute totalFees from deals', () => {\r\n      const expectedFees = 25.00; // 12.50 + 12.50\r\n      expect(component.totalFees()).toBe(expectedFees);\r\n    });\r\n\r\n    it('should compute netProfit correctly', () => {\r\n      const expectedNetProfit = mockRevenueResponse.data.summary.totalRevenue - 25.00;\r\n      expect(component.netProfit()).toBe(expectedNetProfit);\r\n    });\r\n\r\n    it('should compute available exchanges', () => {\r\n      const exchanges = component.availableExchanges();\r\n      expect(exchanges).toContain('BYBIT');\r\n      expect(exchanges).toContain('BINGX');\r\n      expect(exchanges.length).toBe(2);\r\n    });\r\n\r\n    it('should compute available symbols', () => {\r\n      const symbols = component.availableSymbols();\r\n      expect(symbols).toContain('BTCUSDT');\r\n      expect(symbols).toContain('ETHUSDT');\r\n      expect(symbols.length).toBe(2);\r\n    });\r\n  });\r\n\r\n  describe('Filter Operations', () => {\r\n    beforeEach(() => {\r\n      fundingArbitrageService.getRevenue.and.returnValue(of(mockRevenueResponse));\r\n      fixture.detectChanges();\r\n    });\r\n\r\n    it('should apply filters and reload data', () => {\r\n      component.selectedExchange.set('BYBIT');\r\n      component.selectedSymbol.set('BTCUSDT');\r\n      component.applyFilters();\r\n\r\n      expect(fundingArbitrageService.getRevenue).toHaveBeenCalledWith(\r\n        component.startDate(),\r\n        component.endDate(),\r\n        'BYBIT',\r\n        'BTCUSDT'\r\n      );\r\n    });\r\n\r\n    it('should clear filters and reload with defaults', () => {\r\n      component.selectedExchange.set('BYBIT');\r\n      component.selectedSymbol.set('BTCUSDT');\r\n      component.clearFilters();\r\n\r\n      expect(component.selectedExchange()).toBe('');\r\n      expect(component.selectedSymbol()).toBe('');\r\n      expect(fundingArbitrageService.getRevenue).toHaveBeenCalled();\r\n    });\r\n\r\n    it('should toggle filters panel visibility', () => {\r\n      const initialState = component.showFilters();\r\n      component.toggleFilters();\r\n      expect(component.showFilters()).toBe(!initialState);\r\n    });\r\n  });\r\n\r\n  describe('Deal Expansion', () => {\r\n    beforeEach(() => {\r\n      fundingArbitrageService.getRevenue.and.returnValue(of(mockRevenueResponse));\r\n      fixture.detectChanges();\r\n    });\r\n\r\n    it('should expand deal when toggled', () => {\r\n      const dealId = '1';\r\n      component.toggleDealExpansion(dealId);\r\n      expect(component.expandedDealId()).toBe(dealId);\r\n    });\r\n\r\n    it('should collapse deal when toggled again', () => {\r\n      const dealId = '1';\r\n      component.toggleDealExpansion(dealId);\r\n      expect(component.expandedDealId()).toBe(dealId);\r\n      component.toggleDealExpansion(dealId);\r\n      expect(component.expandedDealId()).toBeNull();\r\n    });\r\n\r\n    it('should check if deal is expanded', () => {\r\n      const dealId = '1';\r\n      component.toggleDealExpansion(dealId);\r\n      expect(component.isDealExpanded(dealId)).toBe(true);\r\n      expect(component.isDealExpanded('2')).toBe(false);\r\n    });\r\n  });\r\n\r\n  describe('Formatting Functions', () => {\r\n    it('should format currency correctly', () => {\r\n      expect(component.formatCurrency(1234.5678)).toBe('$1,234.5678');\r\n      expect(component.formatCurrency(0.12)).toBe('$0.12');\r\n    });\r\n\r\n    it('should format percentage correctly', () => {\r\n      expect(component.formatPercent(85.5)).toBe('85.50%');\r\n      expect(component.formatPercent(50)).toBe('50.00%');\r\n    });\r\n\r\n    it('should format date correctly', () => {\r\n      const formattedDate = component.formatDate('2025-10-01T12:00:00Z');\r\n      expect(formattedDate).toContain('Oct');\r\n      expect(formattedDate).toContain('2025');\r\n    });\r\n\r\n    it('should handle null date', () => {\r\n      expect(component.formatDate(null)).toBe('N/A');\r\n    });\r\n\r\n    it('should format duration correctly', () => {\r\n      expect(component.formatDuration(3661)).toBe('1h 1m'); // 1 hour, 1 minute, 1 second\r\n      expect(component.formatDuration(65)).toBe('1m 5s'); // 1 minute, 5 seconds\r\n      expect(component.formatDuration(30)).toBe('30s'); // 30 seconds\r\n      expect(component.formatDuration(null)).toBe('N/A');\r\n    });\r\n\r\n    it('should format numbers with thousands separator', () => {\r\n      expect(component.formatNumber(1234567, 2)).toBe('1,234,567.00');\r\n      expect(component.formatNumber(123, 0)).toBe('123');\r\n    });\r\n  });\r\n\r\n  describe('CSS Class Helpers', () => {\r\n    it('should return correct class for positive values', () => {\r\n      expect(component.getValueClass(100)).toBe('positive');\r\n    });\r\n\r\n    it('should return correct class for negative values', () => {\r\n      expect(component.getValueClass(-100)).toBe('negative');\r\n    });\r\n\r\n    it('should return correct class for zero values', () => {\r\n      expect(component.getValueClass(0)).toBe('neutral');\r\n    });\r\n\r\n    it('should return correct win rate class', () => {\r\n      expect(component.getWinRateClass(80)).toBe('excellent');\r\n      expect(component.getWinRateClass(60)).toBe('good');\r\n      expect(component.getWinRateClass(40)).toBe('average');\r\n      expect(component.getWinRateClass(20)).toBe('poor');\r\n    });\r\n  });\r\n\r\n  describe('Error Handling', () => {\r\n    it('should handle error when loading revenue', (done) => {\r\n      const errorMessage = 'Network error';\r\n      fundingArbitrageService.getRevenue.and.returnValue(throwError(() => new Error(errorMessage)));\r\n\r\n      component.loadRevenue();\r\n\r\n      setTimeout(() => {\r\n        expect(component.error()).toBe(errorMessage);\r\n        expect(component.isLoading()).toBe(false);\r\n        done();\r\n      }, 0);\r\n    });\r\n\r\n    it('should clear error on successful reload', (done) => {\r\n      // First, set an error\r\n      fundingArbitrageService.getRevenue.and.returnValue(throwError(() => new Error('Error')));\r\n      component.loadRevenue();\r\n\r\n      setTimeout(() => {\r\n        expect(component.error()).toBeTruthy();\r\n\r\n        // Now load successfully\r\n        fundingArbitrageService.getRevenue.and.returnValue(of(mockRevenueResponse));\r\n        component.loadRevenue();\r\n\r\n        setTimeout(() => {\r\n          expect(component.error()).toBeNull();\r\n          done();\r\n        }, 0);\r\n      }, 0);\r\n    });\r\n  });\r\n\r\n  describe('Refresh Operation', () => {\r\n    it('should refresh revenue data', () => {\r\n      fundingArbitrageService.getRevenue.and.returnValue(of(mockRevenueResponse));\r\n      fixture.detectChanges();\r\n\r\n      component.refreshRevenue();\r\n\r\n      expect(fundingArbitrageService.getRevenue).toHaveBeenCalledTimes(2); // once on init, once on refresh\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\trading\\funding-revenue\\funding-revenue.component.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'FundingArbitrageDeal' is defined but never used.","line":8,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'RevenueBySymbol' is defined but never used.","line":9,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'RevenueByExchange' is defined but never used.","line":10,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":20},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":134,"column":30,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":134,"endColumn":37}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, OnInit, OnDestroy, inject, signal, computed } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { Subscription } from 'rxjs';\r\nimport {\r\n  FundingArbitrageService,\r\n  FundingArbitrageRevenueResponse,\r\n  FundingArbitrageDeal,\r\n  RevenueBySymbol,\r\n  RevenueByExchange\r\n} from '../../../services/funding-arbitrage.service';\r\nimport { TranslationService } from '../../../services/translation.service';\r\nimport { CardComponent, CardHeaderComponent, CardTitleComponent, CardContentComponent } from '../../ui/card/card.component';\r\nimport { ButtonComponent } from '../../ui/button/button.component';\r\n\r\n/**\r\n * Funding Revenue Component\r\n *\r\n * Displays comprehensive revenue statistics for funding arbitrage deals:\r\n * - Summary metrics (total revenue, deals, win rate, etc.)\r\n * - Revenue breakdown by symbol\r\n * - Revenue breakdown by exchange\r\n * - Individual deal list\r\n * - Date range filtering\r\n */\r\n@Component({\r\n  selector: 'app-funding-revenue',\r\n  standalone: true,\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    CardComponent,\r\n    CardHeaderComponent,\r\n    CardTitleComponent,\r\n    CardContentComponent,\r\n    ButtonComponent\r\n  ],\r\n  templateUrl: './funding-revenue.component.html',\r\n  styleUrl: './funding-revenue.component.scss'\r\n})\r\nexport class FundingRevenueComponent implements OnInit, OnDestroy {\r\n  private fundingArbitrageService = inject(FundingArbitrageService);\r\n  private translationService = inject(TranslationService);\r\n\r\n  // Expose utilities to template\r\n  Math = Math;\r\n\r\n  // State signals\r\n  revenueData = signal<FundingArbitrageRevenueResponse | null>(null);\r\n  isLoading = signal<boolean>(false);\r\n  error = signal<string | null>(null);\r\n\r\n  // Filter signals\r\n  startDate = signal<string>(this.getDefaultStartDate());\r\n  endDate = signal<string>(this.getDefaultEndDate());\r\n  selectedExchange = signal<string>('');\r\n  selectedSymbol = signal<string>('');\r\n\r\n  // UI state\r\n  showFilters = signal<boolean>(true);\r\n  expandedDealId = signal<string | null>(null);\r\n\r\n  // Computed signals\r\n  summary = computed(() => this.revenueData()?.data?.summary);\r\n  bySymbol = computed(() => this.revenueData()?.data?.bySymbol || []);\r\n  byExchange = computed(() => this.revenueData()?.data?.byExchange || []);\r\n  deals = computed(() => this.revenueData()?.data?.deals || []);\r\n  timeline = computed(() => this.revenueData()?.data?.timeline || []);\r\n\r\n  // Computed metrics\r\n  totalFees = computed(() => {\r\n    const dealsData = this.deals();\r\n    return dealsData.reduce(\r\n      (sum, deal) => sum + deal.primaryTradingFees + deal.hedgeTradingFees,\r\n      0\r\n    );\r\n  });\r\n\r\n  netProfit = computed(() => {\r\n    const summaryData = this.summary();\r\n    const fees = this.totalFees();\r\n    return summaryData ? summaryData.totalRevenue - fees : 0;\r\n  });\r\n\r\n  // Unique exchanges and symbols for filters\r\n  availableExchanges = computed(() => {\r\n    const exchanges = new Set<string>();\r\n    this.byExchange().forEach(item => exchanges.add(item.exchange));\r\n    return Array.from(exchanges).sort();\r\n  });\r\n\r\n  availableSymbols = computed(() => {\r\n    const symbols = new Set<string>();\r\n    this.bySymbol().forEach(item => symbols.add(item.symbol));\r\n    return Array.from(symbols).sort();\r\n  });\r\n\r\n  private subscription?: Subscription;\r\n\r\n  ngOnInit(): void {\r\n    this.loadRevenue();\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    if (this.subscription) {\r\n      this.subscription.unsubscribe();\r\n    }\r\n  }\r\n\r\n  translate(key: string): string {\r\n    return this.translationService.translate(key);\r\n  }\r\n\r\n  /**\r\n   * Load revenue data with current filters\r\n   */\r\n  loadRevenue(): void {\r\n    this.isLoading.set(true);\r\n    this.error.set(null);\r\n\r\n    const startDateValue = this.startDate() || undefined;\r\n    const endDateValue = this.endDate() || undefined;\r\n    const exchangeValue = this.selectedExchange() || undefined;\r\n    const symbolValue = this.selectedSymbol() || undefined;\r\n\r\n    this.subscription = this.fundingArbitrageService\r\n      .getRevenue(startDateValue, endDateValue, exchangeValue, symbolValue)\r\n      .subscribe({\r\n        next: (response) => {\r\n          this.revenueData.set(response);\r\n          this.isLoading.set(false);\r\n        },\r\n        error: (err) => {\r\n          this.error.set(err.message || 'Failed to load revenue data');\r\n          this.isLoading.set(false);\r\n        }\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Refresh revenue data\r\n   */\r\n  refreshRevenue(): void {\r\n    this.loadRevenue();\r\n  }\r\n\r\n  /**\r\n   * Apply filters and reload data\r\n   */\r\n  applyFilters(): void {\r\n    this.loadRevenue();\r\n  }\r\n\r\n  /**\r\n   * Clear all filters and reload\r\n   */\r\n  clearFilters(): void {\r\n    this.startDate.set(this.getDefaultStartDate());\r\n    this.endDate.set(this.getDefaultEndDate());\r\n    this.selectedExchange.set('');\r\n    this.selectedSymbol.set('');\r\n    this.loadRevenue();\r\n  }\r\n\r\n  /**\r\n   * Toggle filters panel\r\n   */\r\n  toggleFilters(): void {\r\n    this.showFilters.update(value => !value);\r\n  }\r\n\r\n  /**\r\n   * Toggle deal expansion\r\n   */\r\n  toggleDealExpansion(dealId: string): void {\r\n    const current = this.expandedDealId();\r\n    this.expandedDealId.set(current === dealId ? null : dealId);\r\n  }\r\n\r\n  /**\r\n   * Check if deal is expanded\r\n   */\r\n  isDealExpanded(dealId: string): boolean {\r\n    return this.expandedDealId() === dealId;\r\n  }\r\n\r\n  /**\r\n   * Format currency value\r\n   */\r\n  formatCurrency(value: number): string {\r\n    return new Intl.NumberFormat('en-US', {\r\n      style: 'currency',\r\n      currency: 'USD',\r\n      minimumFractionDigits: 2,\r\n      maximumFractionDigits: 4\r\n    }).format(value);\r\n  }\r\n\r\n  /**\r\n   * Format percentage value\r\n   */\r\n  formatPercent(value: number): string {\r\n    return `${value.toFixed(2)}%`;\r\n  }\r\n\r\n  /**\r\n   * Format date\r\n   */\r\n  formatDate(dateString: string | null): string {\r\n    if (!dateString) return 'N/A';\r\n    const date = new Date(dateString);\r\n    return date.toLocaleString('en-US', {\r\n      year: 'numeric',\r\n      month: 'short',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Format duration in seconds\r\n   */\r\n  formatDuration(seconds: number | null): string {\r\n    if (seconds === null) return 'N/A';\r\n\r\n    const hours = Math.floor(seconds / 3600);\r\n    const minutes = Math.floor((seconds % 3600) / 60);\r\n    const secs = seconds % 60;\r\n\r\n    if (hours > 0) {\r\n      return `${hours}h ${minutes}m`;\r\n    } else if (minutes > 0) {\r\n      return `${minutes}m ${secs}s`;\r\n    } else {\r\n      return `${secs}s`;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get CSS class for positive/negative values\r\n   */\r\n  getValueClass(value: number): string {\r\n    if (value > 0) return 'positive';\r\n    if (value < 0) return 'negative';\r\n    return 'neutral';\r\n  }\r\n\r\n  /**\r\n   * Get default start date (30 days ago)\r\n   */\r\n  private getDefaultStartDate(): string {\r\n    const date = new Date();\r\n    date.setDate(date.getDate() - 30);\r\n    return date.toISOString().split('T')[0];\r\n  }\r\n\r\n  /**\r\n   * Get default end date (today)\r\n   */\r\n  private getDefaultEndDate(): string {\r\n    const date = new Date();\r\n    return date.toISOString().split('T')[0];\r\n  }\r\n\r\n  /**\r\n   * Calculate win rate color class\r\n   */\r\n  getWinRateClass(winRate: number): string {\r\n    if (winRate >= 70) return 'excellent';\r\n    if (winRate >= 50) return 'good';\r\n    if (winRate >= 30) return 'average';\r\n    return 'poor';\r\n  }\r\n\r\n  /**\r\n   * Format number with thousands separator\r\n   */\r\n  formatNumber(value: number, decimals = 0): string {\r\n    return new Intl.NumberFormat('en-US', {\r\n      minimumFractionDigits: decimals,\r\n      maximumFractionDigits: decimals\r\n    }).format(value);\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\trading\\funding-spread-details\\funding-spread-details.component.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'signal' is defined but never used.","line":1,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":34}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, Input, signal, computed } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FundingRateSpreadChartComponent } from '../funding-rate-spread-chart/funding-rate-spread-chart.component';\r\n\r\ninterface ArbitrageOpportunity {\r\n  symbol: string;\r\n  spread: number;\r\n  spreadPercentage: number;\r\n  bestLongExchange: string;\r\n  bestShortExchange: string;\r\n  longFundingRate: number;\r\n  shortFundingRate: number;\r\n  currentPrice?: number;\r\n  volume24h?: number;\r\n  marketCap?: number;\r\n  metrics?: {\r\n    historicalStability?: number;\r\n    avgSpread7d?: number;\r\n    avgSpread30d?: number;\r\n    spreadVolatility?: number;\r\n    trendDirection?: 'stable' | 'increasing' | 'decreasing';\r\n  };\r\n}\r\n\r\n@Component({\r\n  selector: 'app-funding-spread-details',\r\n  standalone: true,\r\n  imports: [CommonModule, FundingRateSpreadChartComponent],\r\n  templateUrl: './funding-spread-details.component.html',\r\n  styleUrls: ['./funding-spread-details.component.scss']\r\n})\r\nexport class FundingSpreadDetailsComponent {\r\n  @Input({ required: true }) opportunity!: ArbitrageOpportunity;\r\n  @Input() authToken?: string;\r\n\r\n  // Computed signals for metrics\r\n  stabilityScore = computed(() => {\r\n    const stability = this.opportunity?.metrics?.historicalStability ?? 0;\r\n    return Math.round(stability * 100);\r\n  });\r\n\r\n  stabilityRating = computed(() => {\r\n    const score = this.stabilityScore();\r\n    if (score >= 80) return 'excellent';\r\n    if (score >= 60) return 'good';\r\n    if (score >= 40) return 'moderate';\r\n    return 'low';\r\n  });\r\n\r\n  spreadQuality = computed(() => {\r\n    const spread = this.opportunity?.spreadPercentage ?? 0;\r\n    if (spread >= 0.15) return 'excellent';\r\n    if (spread >= 0.10) return 'good';\r\n    if (spread >= 0.05) return 'moderate';\r\n    return 'low';\r\n  });\r\n\r\n  volatilityRating = computed(() => {\r\n    const volatility = this.opportunity?.metrics?.spreadVolatility ?? 0;\r\n    if (volatility < 0.02) return 'excellent';\r\n    if (volatility < 0.05) return 'good';\r\n    if (volatility < 0.10) return 'moderate';\r\n    return 'high';\r\n  });\r\n\r\n  trendDirection = computed(() => {\r\n    return this.opportunity?.metrics?.trendDirection ?? 'stable';\r\n  });\r\n\r\n  avg7d = computed(() => {\r\n    return this.opportunity?.metrics?.avgSpread7d ?? 0;\r\n  });\r\n\r\n  avg30d = computed(() => {\r\n    return this.opportunity?.metrics?.avgSpread30d ?? 0;\r\n  });\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\trading\\grid-bot-dashboard\\grid-bot-dashboard.component.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'FormBuilder' is defined but never used.","line":4,"column":44,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":55},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'FormGroup' is defined but never used.","line":4,"column":57,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":66},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Validators' is defined but never used.","line":4,"column":68,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":78},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1089,1092],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1089,1092],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1779,1782],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1779,1782],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":52,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1805,1808],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1805,1808],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of type `any[]` to a variable of type `GridBot[]`.","line":81,"column":9,"nodeType":"AssignmentExpression","messageId":"unsafeAssignment","endLine":81,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":83,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":83,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":95,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":95,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":121,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":121,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":134,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":134,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":145,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4523,4526],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4523,4526],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'strategy' is defined but never used.","line":152,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":152,"endColumn":28},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":152,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":152,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4758,4761],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4758,4761],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'strategy' is defined but never used.","line":156,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":156,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":156,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":156,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4855,4858],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4855,4858],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'strategy' is defined but never used.","line":160,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":160,"endColumn":26},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":160,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":160,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4950,4953],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4950,4953],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":168,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":168,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5114,5117],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5114,5117],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":173,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":173,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5257,5260],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5257,5260],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .id on an `any` value.","line":175,"column":51,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":175,"endColumn":53},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":180,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":180,"endColumn":22}],"suppressedMessages":[],"errorCount":22,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, OnInit, inject } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { Router } from '@angular/router';\r\nimport { FormsModule, ReactiveFormsModule, FormBuilder, FormGroup, Validators } from '@angular/forms';\r\nimport { ButtonComponent } from '../../ui/button/button.component';\r\nimport { CardComponent, CardHeaderComponent, CardTitleComponent, CardSubtitleComponent, CardContentComponent, CardActionsComponent } from '../../ui/card/card.component';\r\nimport { TableComponent } from '../../ui/table/table.component';\r\nimport { TabsComponent, TabContentComponent } from '../../ui/tabs/tabs.component';\r\nimport { TableColumn } from '../../ui/table/table.component';\r\n\r\nimport { GridBotService } from '../../../services/grid-bot.service';\r\nimport { TranslationService } from '../../../services/translation.service';\r\n\r\nexport interface GridBot {\r\n  id: string;\r\n  name: string;\r\n  symbol: string;\r\n  status: 'RUNNING' | 'STOPPED' | 'PAUSED' | 'ERROR';\r\n  totalPnL: number;\r\n  totalTrades: number;\r\n  winRate: number;\r\n  createdAt: Date;\r\n  config: any;\r\n}\r\n\r\n\r\n@Component({\r\n  selector: 'app-grid-bot-dashboard',\r\n  standalone: true,\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    ButtonComponent,\r\n    CardComponent,\r\n    CardHeaderComponent,\r\n    CardTitleComponent,\r\n    CardSubtitleComponent,\r\n    CardContentComponent,\r\n    CardActionsComponent,\r\n    TableComponent,\r\n    TabsComponent,\r\n    TabContentComponent\r\n  ],\r\n  templateUrl: './grid-bot-dashboard.component.html',\r\n  styleUrls: ['./grid-bot-dashboard.component.css']\r\n})\r\nexport class GridBotDashboardComponent implements OnInit {\r\n  protected translationService = inject(TranslationService);\r\n  activeBots: GridBot[] = [];\r\n  strategies: any[] = [];\r\n  backtests: any[] = [];\r\n  backtestTableColumns: TableColumn[] = [];\r\n\r\n  constructor(\r\n    private gridBotService: GridBotService,\r\n    private router: Router\r\n  ) {}\r\n\r\n  translate(key: string): string {\r\n    return this.translationService.translate(key);\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.backtestTableColumns = [\r\n      { key: 'symbol', label: this.translate('dashboard.symbol'), sortable: true },\r\n      { key: 'timeframe', label: this.translate('dashboard.timeframe'), sortable: true },\r\n      { key: 'totalPnL', label: this.translate('dashboard.totalPnl'), sortable: true, type: 'currency' },\r\n      { key: 'winRate', label: this.translate('dashboard.winRate'), sortable: true, type: 'percentage' },\r\n      { key: 'maxDrawdown', label: this.translate('dashboard.maxDrawdown'), sortable: true, type: 'percentage' },\r\n      { key: 'createdAt', label: this.translate('dashboard.date'), sortable: true, type: 'date' },\r\n      { key: 'actions', label: this.translate('dashboard.actions'), sortable: false }\r\n    ];\r\n    this.loadActiveBots();\r\n    this.loadBacktests();\r\n  }\r\n\r\n  loadActiveBots() {\r\n    this.gridBotService.getBots().subscribe({\r\n      next: (bots) => {\r\n        this.activeBots = bots;\r\n      },\r\n      error: (error) => {\r\n        console.error('Failed to load bots');\r\n      }\r\n    });\r\n  }\r\n\r\n\r\n  loadBacktests() {\r\n    this.gridBotService.getBacktests().subscribe({\r\n      next: (backtests) => {\r\n        this.backtests = backtests;\r\n      },\r\n      error: (error) => {\r\n        console.error('Failed to load backtests');\r\n      }\r\n    });\r\n  }\r\n\r\n  openBotConfig() {\r\n    this.router.navigate(['/trading/bot/create']);\r\n  }\r\n\r\n  viewBot(bot: GridBot) {\r\n    this.router.navigate(['/trading/bot/view', bot.id]);\r\n  }\r\n\r\n  editBot(bot: GridBot) {\r\n    this.router.navigate(['/trading/bot/edit', bot.id]);\r\n  }\r\n\r\n  toggleBot(bot: GridBot) {\r\n    const action = bot.status === 'RUNNING' ? 'stop' : 'start';\r\n\r\n    this.gridBotService.updateBot(bot.id, action).subscribe({\r\n      next: () => {\r\n        console.log(`Bot ${action}ed successfully`);\r\n        this.loadActiveBots();\r\n      },\r\n      error: (error) => {\r\n        console.error(`Failed to ${action} bot`);\r\n      }\r\n    });\r\n  }\r\n\r\n  deleteBot(bot: GridBot) {\r\n    if (confirm(`Are you sure you want to delete bot ${bot.name || bot.symbol}?`)) {\r\n      this.gridBotService.deleteBot(bot.id).subscribe({\r\n        next: () => {\r\n          console.log('Bot deleted successfully');\r\n          this.loadActiveBots();\r\n        },\r\n        error: (error) => {\r\n          console.error('Failed to delete bot');\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  createStrategy() {\r\n    console.log('Create strategy - not implemented');\r\n  }\r\n\r\n  useStrategy(strategy: any) {\r\n    // Navigate to create page with strategy data as query parameter\r\n    this.router.navigate(['/trading/bot/create'], {\r\n      queryParams: { strategy: JSON.stringify(strategy) }\r\n    });\r\n  }\r\n\r\n  backtestStrategy(strategy: any) {\r\n    console.log('Backtest strategy - not implemented');\r\n  }\r\n\r\n  editStrategy(strategy: any) {\r\n    console.log('Edit strategy - not implemented');\r\n  }\r\n\r\n  deleteStrategy(strategy: any) {\r\n    console.log('Delete strategy - not implemented');\r\n  }\r\n\r\n  newBacktest() {\r\n    // Open backtest configuration dialog\r\n  }\r\n\r\n  viewBacktest(backtest: any) {\r\n    // TODO: Implement custom backtest results dialog\r\n    console.log('View backtest:', backtest);\r\n  }\r\n\r\n  deleteBacktest(backtest: any) {\r\n    if (confirm('Are you sure you want to delete this backtest?')) {\r\n      this.gridBotService.deleteBacktest(backtest.id).subscribe({\r\n        next: () => {\r\n          console.log('Backtest deleted successfully');\r\n          this.loadBacktests();\r\n        },\r\n        error: (error) => {\r\n          console.error('Failed to delete backtest');\r\n        }\r\n      });\r\n    }\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\trading\\order-form\\order-form.component.html","messages":[{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":68,"column":7,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":68,"endColumn":46},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":100,"column":7,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":100,"endColumn":49},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":196,"column":11,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":196,"endColumn":56},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":218,"column":11,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":218,"endColumn":54},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":351,"column":9,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":351,"endColumn":59},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":361,"column":9,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":361,"endColumn":63}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<div class=\"order-form-container\">\r\n  <!-- Header -->\r\n  <div class=\"order-form-header\">\r\n    <h2 class=\"order-form-title\">Trade</h2>\r\n    <div class=\"header-actions\">\r\n      <button class=\"icon-button\" aria-label=\"Grid settings\">\r\n        <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n          <rect x=\"2\" y=\"2\" width=\"7\" height=\"7\" rx=\"1\"></rect>\r\n          <rect x=\"11\" y=\"2\" width=\"7\" height=\"7\" rx=\"1\"></rect>\r\n          <rect x=\"2\" y=\"11\" width=\"7\" height=\"7\" rx=\"1\"></rect>\r\n          <rect x=\"11\" y=\"11\" width=\"7\" height=\"7\" rx=\"1\"></rect>\r\n        </svg>\r\n      </button>\r\n      <button class=\"icon-button notification-button\" aria-label=\"Notifications\">\r\n        <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n          <path d=\"M10 2C6.68629 2 4 4.68629 4 8V11.5858L2.29289 13.2929C1.90237 13.6834 2.19063 14.5 2.70711 14.5H17.2929C17.8094 14.5 18.0976 13.6834 17.7071 13.2929L16 11.5858V8C16 4.68629 13.3137 2 10 2Z\"></path>\r\n          <path d=\"M8 16C8 17.1046 8.89543 18 10 18C11.1046 18 12 17.1046 12 16H8Z\"></path>\r\n        </svg>\r\n        <span class=\"notification-badge\"></span>\r\n      </button>\r\n      <button class=\"icon-button\" aria-label=\"Settings\">\r\n        <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n          <path d=\"M10 6C7.79086 6 6 7.79086 6 10C6 12.2091 7.79086 14 10 14C12.2091 14 14 12.2091 14 10C14 7.79086 12.2091 6 10 6Z\"></path>\r\n          <circle cx=\"3\" cy=\"10\" r=\"2\"></circle>\r\n          <circle cx=\"17\" cy=\"10\" r=\"2\"></circle>\r\n        </svg>\r\n      </button>\r\n    </div>\r\n  </div>\r\n\r\n  <!-- Margin Mode & Leverage -->\r\n  <div class=\"margin-leverage-row\">\r\n    <div class=\"margin-mode-select\">\r\n      <ui-select\r\n        [options]=\"marginModeOptions\"\r\n        [(ngModel)]=\"marginMode\"\r\n        (ngModelChange)=\"onMarginModeChange($event)\"\r\n        [fullWidth]=\"true\"\r\n        size=\"medium\">\r\n      </ui-select>\r\n    </div>\r\n    <div class=\"leverage-select\">\r\n      <ui-select\r\n        [options]=\"leverageOptions\"\r\n        [(ngModel)]=\"leverage\"\r\n        (ngModelChange)=\"onLeverageChange($event)\"\r\n        [fullWidth]=\"true\"\r\n        size=\"medium\">\r\n      </ui-select>\r\n      <span class=\"leverage-label\">{{ leverage }}x</span>\r\n    </div>\r\n  </div>\r\n\r\n  <!-- Order Type Tabs -->\r\n  <div class=\"order-type-tabs\">\r\n    <ui-tabs\r\n      [tabs]=\"orderTypeTabs\"\r\n      [activeTabId]=\"orderType\"\r\n      (tabChange)=\"onOrderTypeChange($event)\"\r\n      variant=\"underline\"\r\n      size=\"medium\">\r\n    </ui-tabs>\r\n  </div>\r\n\r\n  <form [formGroup]=\"orderForm\" class=\"order-form\">\r\n    <!-- Price Input -->\r\n    <div class=\"form-group\" *ngIf=\"orderType !== 'Market'\">\r\n      <label class=\"form-label\">Price</label>\r\n      <div class=\"input-with-actions\">\r\n        <input\r\n          type=\"number\"\r\n          formControlName=\"price\"\r\n          class=\"form-input price-input\"\r\n          [class.error]=\"hasError('price')\"\r\n          placeholder=\"0.0\"\r\n          step=\"0.1\"\r\n        />\r\n        <button\r\n          type=\"button\"\r\n          class=\"input-action-button last-button\"\r\n          (click)=\"fillLastPrice()\"\r\n          aria-label=\"Fill last price\">\r\n          Last\r\n        </button>\r\n        <button\r\n          type=\"button\"\r\n          class=\"input-action-button transfer-button\"\r\n          aria-label=\"Transfer\">\r\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\r\n            <path d=\"M8 1L12 5H9V11H7V5H4L8 1Z\"></path>\r\n            <path d=\"M8 15L4 11H7V5H9V11H12L8 15Z\"></path>\r\n          </svg>\r\n        </button>\r\n      </div>\r\n      <div class=\"current-price\">{{ lastPrice() | number:'1.1-1' }}</div>\r\n    </div>\r\n\r\n    <!-- Quantity Input -->\r\n    <div class=\"form-group\">\r\n      <label class=\"form-label\">Quantity</label>\r\n      <div class=\"input-with-unit\">\r\n        <input\r\n          type=\"number\"\r\n          formControlName=\"quantity\"\r\n          class=\"form-input quantity-input\"\r\n          [class.error]=\"hasError('quantity')\"\r\n          placeholder=\"0.0\"\r\n          step=\"0.001\"\r\n        />\r\n        <ui-select\r\n          [options]=\"quantityUnitOptions\"\r\n          [(ngModel)]=\"quantityUnit\"\r\n          [ngModelOptions]=\"{standalone: true}\"\r\n          (ngModelChange)=\"onQuantityUnitChange($event)\"\r\n          class=\"unit-select\"\r\n          size=\"small\">\r\n        </ui-select>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Quantity Slider -->\r\n    <div class=\"quantity-slider-container\">\r\n      <input\r\n        type=\"range\"\r\n        min=\"0\"\r\n        max=\"100\"\r\n        [value]=\"quantityPercentage\"\r\n        (input)=\"onQuantityPercentageChange($event)\"\r\n        class=\"quantity-slider\"\r\n        aria-label=\"Quantity percentage\"\r\n      />\r\n      <div class=\"slider-markers\">\r\n        <span class=\"slider-marker\">0</span>\r\n        <span class=\"slider-marker\"\r\n          [class.active]=\"quantityPercentage >= 100\">100%</span>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Value Display -->\r\n    <div class=\"value-display-section\">\r\n      <div class=\"value-row\">\r\n        <span class=\"value-label\">Value</span>\r\n        <span class=\"value-amount\">\r\n          <span class=\"value-dash\">--</span>\r\n          <span class=\"value-separator\">/</span>\r\n          <span class=\"value-dash\">--</span>\r\n          <span class=\"value-unit\">USDT</span>\r\n        </span>\r\n      </div>\r\n      <div class=\"value-row\">\r\n        <span class=\"value-label\">Cost</span>\r\n        <span class=\"value-amount\">\r\n          <span class=\"value-dash\">--</span>\r\n          <span class=\"value-separator\">/</span>\r\n          <span class=\"value-dash\">--</span>\r\n          <span class=\"value-unit\">USDT</span>\r\n        </span>\r\n      </div>\r\n      <div class=\"value-row liq-price-row\">\r\n        <span class=\"value-label\">Liq. Price</span>\r\n        <button\r\n          type=\"button\"\r\n          class=\"calculate-button\"\r\n          (click)=\"calculateLiquidationPrice()\">\r\n          Calculate\r\n        </button>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- TP/SL Section -->\r\n    <div class=\"tpsl-section\">\r\n      <div class=\"tpsl-header\">\r\n        <label class=\"checkbox-label\">\r\n          <input\r\n            type=\"checkbox\"\r\n            [checked]=\"tpslEnabled\"\r\n            (change)=\"toggleTPSL()\"\r\n            class=\"checkbox-input\"\r\n          />\r\n          <span class=\"checkbox-custom\"></span>\r\n          <span class=\"checkbox-text\">TP/SL</span>\r\n        </label>\r\n        <button\r\n          type=\"button\"\r\n          class=\"tpsl-mode-toggle\"\r\n          (click)=\"toggleTPSLMode()\">\r\n          {{ tpslMode }}\r\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"currentColor\" class=\"toggle-icon\">\r\n            <path d=\"M4 6L8 10L12 6H4Z\"></path>\r\n          </svg>\r\n        </button>\r\n      </div>\r\n\r\n      <div class=\"tpsl-inputs\" *ngIf=\"tpslEnabled\">\r\n        <div class=\"form-group\">\r\n          <label class=\"form-label\">Take Profit</label>\r\n          <div class=\"input-with-dropdown\">\r\n            <input\r\n              type=\"number\"\r\n              formControlName=\"takeProfit\"\r\n              class=\"form-input\"\r\n              placeholder=\"0.0\"\r\n              step=\"0.1\"\r\n            />\r\n            <button\r\n              type=\"button\"\r\n              class=\"dropdown-button\"\r\n              (click)=\"fillTPSLWithLast('takeProfit')\">\r\n              Last\r\n              <svg width=\"12\" height=\"12\" viewBox=\"0 0 12 12\" fill=\"currentColor\">\r\n                <path d=\"M3 5L6 8L9 5H3Z\"></path>\r\n              </svg>\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"form-group\">\r\n          <label class=\"form-label\">Stop Loss</label>\r\n          <div class=\"input-with-dropdown\">\r\n            <input\r\n              type=\"number\"\r\n              formControlName=\"stopLoss\"\r\n              class=\"form-input\"\r\n              placeholder=\"0.0\"\r\n              step=\"0.1\"\r\n            />\r\n            <button\r\n              type=\"button\"\r\n              class=\"dropdown-button\"\r\n              (click)=\"fillTPSLWithLast('stopLoss')\">\r\n              Last\r\n              <svg width=\"12\" height=\"12\" viewBox=\"0 0 12 12\" fill=\"currentColor\">\r\n                <path d=\"M3 5L6 8L9 5H3Z\"></path>\r\n              </svg>\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Order Options -->\r\n    <div class=\"order-options\">\r\n      <label class=\"checkbox-label\">\r\n        <input\r\n          type=\"checkbox\"\r\n          formControlName=\"postOnly\"\r\n          class=\"checkbox-input\"\r\n        />\r\n        <span class=\"checkbox-custom\"></span>\r\n        <span class=\"checkbox-text\">Post-Only</span>\r\n      </label>\r\n\r\n      <ui-select\r\n        [options]=\"timeInForceOptions\"\r\n        formControlName=\"timeInForce\"\r\n        [fullWidth]=\"true\"\r\n        size=\"small\">\r\n      </ui-select>\r\n    </div>\r\n\r\n    <div class=\"order-options\">\r\n      <label class=\"checkbox-label\">\r\n        <input\r\n          type=\"checkbox\"\r\n          formControlName=\"reduceOnly\"\r\n          class=\"checkbox-input\"\r\n        />\r\n        <span class=\"checkbox-custom\"></span>\r\n        <span class=\"checkbox-text\">Reduce-Only</span>\r\n      </label>\r\n    </div>\r\n\r\n    <!-- Action Buttons -->\r\n    <div class=\"action-buttons\">\r\n      <ui-button\r\n        type=\"button\"\r\n        variant=\"primary\"\r\n        size=\"large\"\r\n        className=\"long-button\"\r\n        (clicked)=\"placeLongOrder()\"\r\n        [disabled]=\"isPlacingOrder() || orderForm.invalid\">\r\n        <span *ngIf=\"!isPlacingOrder()\">Long</span>\r\n        <span *ngIf=\"isPlacingOrder()\" class=\"loading-spinner\"></span>\r\n      </ui-button>\r\n      <ui-button\r\n        type=\"button\"\r\n        variant=\"danger\"\r\n        size=\"large\"\r\n        className=\"short-button\"\r\n        (clicked)=\"placeShortOrder()\"\r\n        [disabled]=\"isPlacingOrder() || orderForm.invalid\">\r\n        <span *ngIf=\"!isPlacingOrder()\">Short</span>\r\n        <span *ngIf=\"isPlacingOrder()\" class=\"loading-spinner\"></span>\r\n      </ui-button>\r\n    </div>\r\n\r\n    <!-- Footer Links -->\r\n    <div class=\"form-footer\">\r\n      <button type=\"button\" class=\"footer-link\" (click)=\"openFeeRateDialog()\">\r\n        <svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\r\n          <circle cx=\"8\" cy=\"8\" r=\"6\" stroke=\"currentColor\" fill=\"none\"></circle>\r\n          <path d=\"M8 4V8L11 11\"></path>\r\n        </svg>\r\n        Fee Rate\r\n        <span class=\"notification-dot\"></span>\r\n      </button>\r\n      <button type=\"button\" class=\"footer-link\" (click)=\"openCalculatorDialog()\">\r\n        <svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\r\n          <rect x=\"3\" y=\"2\" width=\"10\" height=\"12\" rx=\"1\" stroke=\"currentColor\" fill=\"none\"></rect>\r\n          <line x1=\"5\" y1=\"6\" x2=\"11\" y2=\"6\" stroke=\"currentColor\"></line>\r\n          <line x1=\"5\" y1=\"9\" x2=\"11\" y2=\"9\" stroke=\"currentColor\"></line>\r\n        </svg>\r\n        Calculator\r\n      </button>\r\n    </div>\r\n  </form>\r\n\r\n  <!-- Account Info Section -->\r\n  <div class=\"account-section\">\r\n    <div class=\"account-header\">\r\n      <div class=\"account-title\">\r\n        <span>Unified Trading Account</span>\r\n        <button class=\"icon-button-small\" aria-label=\"View account\">\r\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\r\n            <path d=\"M8 3C4.5 3 1.5 5.5 1 8C1.5 10.5 4.5 13 8 13C11.5 13 14.5 10.5 15 8C14.5 5.5 11.5 3 8 3Z\"></path>\r\n            <circle cx=\"8\" cy=\"8\" r=\"2\"></circle>\r\n          </svg>\r\n        </button>\r\n      </div>\r\n      <button class=\"pnl-button\" aria-label=\"P&L\">\r\n        <svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\r\n          <path d=\"M2 3L8 9L14 3\"></path>\r\n          <path d=\"M2 7L8 13L14 7\"></path>\r\n        </svg>\r\n        P&L\r\n      </button>\r\n    </div>\r\n\r\n    <div class=\"margin-mode-row\">\r\n      <span class=\"margin-label\">Margin Mode</span>\r\n      <button class=\"margin-mode-value\">\r\n        {{ marginMode }} Margin\r\n        <svg width=\"12\" height=\"12\" viewBox=\"0 0 12 12\" fill=\"currentColor\">\r\n          <path d=\"M4 5L6 7L8 5H4Z\"></path>\r\n        </svg>\r\n      </button>\r\n    </div>\r\n\r\n    <div class=\"margin-sliders\">\r\n      <div class=\"margin-slider-row\">\r\n        <label class=\"slider-label\">Initial Margin</label>\r\n        <div class=\"slider-container\">\r\n          <div class=\"slider-track\">\r\n            <div class=\"slider-fill\" style=\"width: 0%\"></div>\r\n          </div>\r\n        </div>\r\n        <span class=\"slider-value\">0.00%</span>\r\n      </div>\r\n\r\n      <div class=\"margin-slider-row\">\r\n        <label class=\"slider-label\">Maintenance Margin</label>\r\n        <div class=\"slider-container\">\r\n          <div class=\"slider-track\">\r\n            <div class=\"slider-fill\" style=\"width: 0%\"></div>\r\n          </div>\r\n        </div>\r\n        <span class=\"slider-value\">0.00%</span>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"balance-display\">\r\n      <div class=\"balance-row\">\r\n        <span class=\"balance-label\">Margin Balance</span>\r\n        <span class=\"balance-value\">\r\n          {{ marginBalance() | number:'1.4-4' }} USDT\r\n        </span>\r\n      </div>\r\n      <div class=\"balance-row\">\r\n        <span class=\"balance-label\">Available Balance</span>\r\n        <span class=\"balance-value\">\r\n          {{ availableBalance() | number:'1.4-4' }} USDT\r\n        </span>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"account-actions\">\r\n      <ui-button\r\n        type=\"button\"\r\n        variant=\"secondary\"\r\n        size=\"small\"\r\n        (clicked)=\"navigateToDeposit()\">\r\n        Deposit\r\n      </ui-button>\r\n      <ui-button\r\n        type=\"button\"\r\n        variant=\"secondary\"\r\n        size=\"small\"\r\n        (clicked)=\"navigateToConvert()\">\r\n        Convert\r\n      </ui-button>\r\n      <ui-button\r\n        type=\"button\"\r\n        variant=\"secondary\"\r\n        size=\"small\"\r\n        (clicked)=\"navigateToTransfer()\">\r\n        Transfer\r\n      </ui-button>\r\n    </div>\r\n  </div>\r\n</div>\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\trading\\order-form\\order-form.component.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'OrderRequest' is defined but never used.","line":12,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":22},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":32,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":39,"endColumn":7},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":41,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":44,"endColumn":7},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":56,"column":42,"nodeType":"Property","messageId":"anyAssignment","endLine":56,"endColumn":69},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":57,"column":34,"nodeType":"Property","messageId":"anyAssignment","endLine":57,"endColumn":59},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":118,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":118,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":128,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":128,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":239,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":239,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":257,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":257,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":258,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":258,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":281,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":281,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":287,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":287,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":295,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":295,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":302,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":302,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":307,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":307,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":325,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":325,"endColumn":32},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":370,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":370,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12786,12789],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12786,12789],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":389,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":389,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13336,13339],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13336,13339],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":405,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":405,"endColumn":30},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":407,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":407,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13911,13914],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13911,13914],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":418,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":418,"endColumn":32},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":420,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":420,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14440,14443],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14440,14443],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":434,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":434,"endColumn":32},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":435,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":435,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14904,14907],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14904,14907],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":446,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":446,"endColumn":33},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":448,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":448,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15464,15467],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15464,15467],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":470,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":470,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16202,16205],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16202,16205],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":481,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":481,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16645,16648],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16645,16648],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":564,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":564,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":577,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":577,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":578,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":578,"endColumn":80},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":578,"column":26,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":578,"endColumn":48},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .querySelector on an `any` value.","line":578,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":578,"endColumn":48},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":579,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":579,"endColumn":88},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":579,"column":34,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":579,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .querySelector on an `any` value.","line":579,"column":43,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":579,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":580,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":580,"endColumn":79},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":580,"column":30,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":580,"endColumn":52},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .querySelector on an `any` value.","line":580,"column":39,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":580,"endColumn":52},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":588,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":588,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":589,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":589,"endColumn":82},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":589,"column":22,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":589,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .querySelector on an `any` value.","line":589,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":589,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":595,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":595,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":596,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":596,"endColumn":72},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":596,"column":24,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":596,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .querySelector on an `any` value.","line":596,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":596,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":599,"column":14,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":599,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .getAttribute on an `any` value.","line":599,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":599,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":606,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":606,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":612,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":612,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":619,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":619,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":627,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":627,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":628,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":628,"endColumn":66},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":628,"column":23,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":628,"endColumn":55},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":628,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":628,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21716,21719],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21716,21719],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .roundQuantity on an `any` value.","line":628,"column":42,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":628,"endColumn":55},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":633,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":633,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":634,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":634,"endColumn":67},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":634,"column":23,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":634,"endColumn":55},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":634,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":634,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21947,21950],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21947,21950],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .roundQuantity on an `any` value.","line":634,"column":42,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":634,"endColumn":55}],"suppressedMessages":[],"errorCount":62,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { ComponentFixture, TestBed } from '@angular/core/testing';\r\nimport { ReactiveFormsModule } from '@angular/forms';\r\nimport { of, throwError } from 'rxjs';\r\n\r\nimport { OrderFormComponent } from './order-form.component';\r\nimport { ManualTradingService } from '../../../services/manual-trading.service';\r\nimport { BybitService } from '../../../services/bybit.service';\r\nimport { ButtonComponent } from '../../ui/button/button.component';\r\nimport { InputComponent } from '../../ui/input/input.component';\r\nimport { SelectComponent } from '../../ui/select/select.component';\r\nimport { TabsComponent } from '../../ui/tabs/tabs.component';\r\nimport { OrderRequest, Balance } from '../../../models/trading.model';\r\n\r\ndescribe('OrderFormComponent', () => {\r\n  let component: OrderFormComponent;\r\n  let fixture: ComponentFixture<OrderFormComponent>;\r\n  let tradingService: jasmine.SpyObj<ManualTradingService>;\r\n  let bybitService: jasmine.SpyObj<BybitService>;\r\n\r\n  const mockBalance: Balance = {\r\n    exchange: 'bybit',\r\n    totalBalance: 10000,\r\n    availableBalance: 8000,\r\n    usedMargin: 2000,\r\n    unrealizedPnl: 100,\r\n    walletBalance: 9900,\r\n    currency: 'USDT',\r\n    updatedAt: new Date()\r\n  };\r\n\r\n  beforeEach(async () => {\r\n    const tradingServiceSpy = jasmine.createSpyObj('ManualTradingService', [\r\n      'placeOrder',\r\n      'getAccountBalance'\r\n    ], {\r\n      isPlacingOrder: jasmine.createSpy('isPlacingOrder').and.returnValue(false),\r\n      isLoadingBalance: jasmine.createSpy('isLoadingBalance').and.returnValue(false),\r\n      balance$: of(mockBalance)\r\n    });\r\n\r\n    const bybitServiceSpy = jasmine.createSpyObj('BybitService', [\r\n      'subscribeToRealtimeTicker',\r\n      'unsubscribeFromRealtimeTicker'\r\n    ]);\r\n\r\n    await TestBed.configureTestingModule({\r\n      imports: [\r\n        OrderFormComponent,\r\n        ReactiveFormsModule,\r\n        ButtonComponent,\r\n        InputComponent,\r\n        SelectComponent,\r\n        TabsComponent\r\n      ],\r\n      providers: [\r\n        { provide: ManualTradingService, useValue: tradingServiceSpy },\r\n        { provide: BybitService, useValue: bybitServiceSpy }\r\n      ]\r\n    }).compileComponents();\r\n\r\n    tradingService = TestBed.inject(ManualTradingService) as jasmine.SpyObj<ManualTradingService>;\r\n    bybitService = TestBed.inject(BybitService) as jasmine.SpyObj<BybitService>;\r\n\r\n    tradingService.getAccountBalance.and.returnValue(of(mockBalance));\r\n    bybitService.subscribeToRealtimeTicker.and.returnValue(of({ lastPrice: '99866.7' }));\r\n\r\n    fixture = TestBed.createComponent(OrderFormComponent);\r\n    component = fixture.componentInstance;\r\n    fixture.detectChanges();\r\n  });\r\n\r\n  afterEach(() => {\r\n    fixture.destroy();\r\n  });\r\n\r\n  describe('Component Initialization', () => {\r\n    it('should create', () => {\r\n      expect(component).toBeTruthy();\r\n    });\r\n\r\n    it('should initialize with default values', () => {\r\n      expect(component.marginMode()).toBe('Cross');\r\n      expect(component.leverage()).toBe(10);\r\n      expect(component.orderType()).toBe('Limit');\r\n      expect(component.quantityUnit()).toBe('BTC');\r\n      expect(component.quantityPercentage()).toBe(0);\r\n      expect(component.tpslEnabled()).toBe(false);\r\n      expect(component.tpslMode()).toBe('Basic');\r\n    });\r\n\r\n    it('should create order form with correct controls', () => {\r\n      expect(component.orderForm.get('price')).toBeTruthy();\r\n      expect(component.orderForm.get('quantity')).toBeTruthy();\r\n      expect(component.orderForm.get('takeProfit')).toBeTruthy();\r\n      expect(component.orderForm.get('stopLoss')).toBeTruthy();\r\n      expect(component.orderForm.get('postOnly')).toBeTruthy();\r\n      expect(component.orderForm.get('reduceOnly')).toBeTruthy();\r\n      expect(component.orderForm.get('timeInForce')).toBeTruthy();\r\n    });\r\n\r\n    it('should load account balance on init', () => {\r\n      expect(tradingService.getAccountBalance).toHaveBeenCalledWith('bybit');\r\n      expect(component.balance()).toEqual(mockBalance);\r\n    });\r\n\r\n    it('should subscribe to market data on init', () => {\r\n      expect(bybitService.subscribeToRealtimeTicker).toHaveBeenCalledWith('BTCUSDT');\r\n    });\r\n\r\n    it('should unsubscribe from market data on destroy', () => {\r\n      component.ngOnDestroy();\r\n      expect(bybitService.unsubscribeFromRealtimeTicker).toHaveBeenCalledWith('BTCUSDT');\r\n    });\r\n  });\r\n\r\n  describe('Form Validation', () => {\r\n    it('should validate required price for limit orders', () => {\r\n      component.orderType.set('Limit');\r\n      const priceControl = component.orderForm.get('price');\r\n\r\n      expect(priceControl?.hasError('required')).toBe(true);\r\n\r\n      priceControl?.setValue(50000);\r\n      expect(priceControl?.hasError('required')).toBe(false);\r\n    });\r\n\r\n    it('should not require price for market orders', () => {\r\n      component.orderType.set('Market');\r\n      const priceControl = component.orderForm.get('price');\r\n\r\n      expect(priceControl?.hasError('required')).toBe(false);\r\n    });\r\n\r\n    it('should validate minimum price value', () => {\r\n      const priceControl = component.orderForm.get('price');\r\n      priceControl?.setValue(-100);\r\n\r\n      expect(priceControl?.hasError('min')).toBe(true);\r\n\r\n      priceControl?.setValue(50000);\r\n      expect(priceControl?.hasError('min')).toBe(false);\r\n    });\r\n\r\n    it('should validate required quantity', () => {\r\n      const quantityControl = component.orderForm.get('quantity');\r\n\r\n      expect(quantityControl?.hasError('required')).toBe(true);\r\n\r\n      quantityControl?.setValue(0.5);\r\n      expect(quantityControl?.hasError('required')).toBe(false);\r\n    });\r\n\r\n    it('should validate minimum quantity value', () => {\r\n      const quantityControl = component.orderForm.get('quantity');\r\n      quantityControl?.setValue(-1);\r\n\r\n      expect(quantityControl?.hasError('min')).toBe(true);\r\n\r\n      quantityControl?.setValue(0.5);\r\n      expect(quantityControl?.hasError('min')).toBe(false);\r\n    });\r\n  });\r\n\r\n  describe('Margin Mode & Leverage', () => {\r\n    it('should change margin mode', () => {\r\n      component.onMarginModeChange('Isolated');\r\n      expect(component.marginMode()).toBe('Isolated');\r\n    });\r\n\r\n    it('should change leverage', () => {\r\n      component.onLeverageChange(25);\r\n      expect(component.leverage()).toBe(25);\r\n    });\r\n\r\n    it('should have correct leverage options', () => {\r\n      expect(component.leverageOptions.length).toBe(125);\r\n      expect(component.leverageOptions[0].value).toBe(1);\r\n      expect(component.leverageOptions[124].value).toBe(125);\r\n    });\r\n  });\r\n\r\n  describe('Order Type', () => {\r\n    it('should change order type', () => {\r\n      component.onOrderTypeChange('Market');\r\n      expect(component.orderType()).toBe('Market');\r\n    });\r\n\r\n    it('should update price validation when order type changes', () => {\r\n      const priceControl = component.orderForm.get('price');\r\n\r\n      component.onOrderTypeChange('Limit');\r\n      expect(priceControl?.hasError('required')).toBe(true);\r\n\r\n      component.onOrderTypeChange('Market');\r\n      expect(priceControl?.hasError('required')).toBe(false);\r\n    });\r\n\r\n    it('should have all order type tabs', () => {\r\n      expect(component.orderTypeTabs.length).toBe(3);\r\n      expect(component.orderTypeTabs[0].id).toBe('Limit');\r\n      expect(component.orderTypeTabs[1].id).toBe('Market');\r\n      expect(component.orderTypeTabs[2].id).toBe('Conditional');\r\n    });\r\n  });\r\n\r\n  describe('Price Input', () => {\r\n    it('should fill price with last price', () => {\r\n      component.lastPrice.set(99866.7);\r\n      component.fillLastPrice();\r\n\r\n      expect(component.orderForm.get('price')?.value).toBe(99866.7);\r\n    });\r\n\r\n    it('should update last price from ticker', () => {\r\n      bybitService.subscribeToRealtimeTicker.and.returnValue(\r\n        of({ lastPrice: '100000.5' })\r\n      );\r\n\r\n      component.ngOnInit();\r\n\r\n      expect(component.lastPrice()).toBe(100000.5);\r\n    });\r\n  });\r\n\r\n  describe('Quantity Input & Slider', () => {\r\n    it('should change quantity unit', () => {\r\n      component.onQuantityUnitChange('USDT');\r\n      expect(component.quantityUnit()).toBe('USDT');\r\n    });\r\n\r\n    it('should convert quantity when unit changes from BTC to USDT', () => {\r\n      component.orderForm.patchValue({ price: 100000, quantity: 0.5 });\r\n      component.onQuantityUnitChange('USDT');\r\n\r\n      expect(component.orderForm.get('quantity')?.value).toBe(50000);\r\n    });\r\n\r\n    it('should convert quantity when unit changes from USDT to BTC', () => {\r\n      component.quantityUnit.set('USDT');\r\n      component.orderForm.patchValue({ price: 100000, quantity: 50000 });\r\n      component.onQuantityUnitChange('BTC');\r\n\r\n      expect(component.orderForm.get('quantity')?.value).toBe(0.5);\r\n    });\r\n\r\n    it('should update quantity percentage', () => {\r\n      const event = {\r\n        target: { value: '50' } as HTMLInputElement\r\n      } as Event;\r\n\r\n      component.onQuantityPercentageChange(event);\r\n\r\n      expect(component.quantityPercentage()).toBe(50);\r\n    });\r\n\r\n    it('should calculate quantity from percentage', () => {\r\n      component.balance.set(mockBalance);\r\n      component.leverage.set(10);\r\n      component.orderForm.patchValue({ price: 100000 });\r\n\r\n      const event = {\r\n        target: { value: '100' } as HTMLInputElement\r\n      } as Event;\r\n\r\n      component.onQuantityPercentageChange(event);\r\n\r\n      // Available: 8000, Leverage: 10x, Total: 80000, Price: 100000\r\n      // Expected quantity: 80000 / 100000 = 0.8 BTC\r\n      expect(component.orderForm.get('quantity')?.value).toBeCloseTo(0.8, 2);\r\n    });\r\n  });\r\n\r\n  describe('Computed Values', () => {\r\n    it('should calculate order value correctly', () => {\r\n      component.orderForm.patchValue({ price: 100000, quantity: 0.5 });\r\n      expect(component.orderValue()).toBe(50000);\r\n    });\r\n\r\n    it('should calculate order cost correctly', () => {\r\n      component.orderForm.patchValue({ price: 100000, quantity: 0.5 });\r\n      component.leverage.set(10);\r\n      expect(component.orderCost()).toBe(5000);\r\n    });\r\n\r\n    it('should calculate liquidation price for long', () => {\r\n      component.orderForm.patchValue({ price: 100000 });\r\n      component.leverage.set(10);\r\n\r\n      const liq = component.liquidationPrice();\r\n      expect(liq.long).toBe(90000); // 100000 - (100000 / 10)\r\n    });\r\n\r\n    it('should calculate liquidation price for short', () => {\r\n      component.orderForm.patchValue({ price: 100000 });\r\n      component.leverage.set(10);\r\n\r\n      const liq = component.liquidationPrice();\r\n      expect(liq.short).toBe(110000); // 100000 + (100000 / 10)\r\n    });\r\n\r\n    it('should compute available balance from balance signal', () => {\r\n      component.balance.set(mockBalance);\r\n      expect(component.availableBalance()).toBe(8000);\r\n    });\r\n\r\n    it('should compute margin balance from balance signal', () => {\r\n      component.balance.set(mockBalance);\r\n      expect(component.marginBalance()).toBe(9900);\r\n    });\r\n  });\r\n\r\n  describe('TP/SL Configuration', () => {\r\n    it('should toggle TP/SL enabled state', () => {\r\n      expect(component.tpslEnabled()).toBe(false);\r\n\r\n      component.toggleTPSL();\r\n      expect(component.tpslEnabled()).toBe(true);\r\n\r\n      component.toggleTPSL();\r\n      expect(component.tpslEnabled()).toBe(false);\r\n    });\r\n\r\n    it('should clear TP/SL values when disabled', () => {\r\n      component.orderForm.patchValue({ takeProfit: 110000, stopLoss: 90000 });\r\n      component.tpslEnabled.set(true);\r\n\r\n      component.toggleTPSL();\r\n\r\n      expect(component.orderForm.get('takeProfit')?.value).toBeNull();\r\n      expect(component.orderForm.get('stopLoss')?.value).toBeNull();\r\n    });\r\n\r\n    it('should toggle TP/SL mode', () => {\r\n      expect(component.tpslMode()).toBe('Basic');\r\n\r\n      component.toggleTPSLMode();\r\n      expect(component.tpslMode()).toBe('Advanced');\r\n\r\n      component.toggleTPSLMode();\r\n      expect(component.tpslMode()).toBe('Basic');\r\n    });\r\n\r\n    it('should fill take profit with last price', () => {\r\n      component.lastPrice.set(100000);\r\n      component.fillTPSLWithLast('takeProfit');\r\n\r\n      expect(component.orderForm.get('takeProfit')?.value).toBe(100000);\r\n    });\r\n\r\n    it('should fill stop loss with last price', () => {\r\n      component.lastPrice.set(100000);\r\n      component.fillTPSLWithLast('stopLoss');\r\n\r\n      expect(component.orderForm.get('stopLoss')?.value).toBe(100000);\r\n    });\r\n  });\r\n\r\n  describe('Place Order', () => {\r\n    beforeEach(() => {\r\n      component.orderForm.patchValue({\r\n        price: 100000,\r\n        quantity: 0.5,\r\n        timeInForce: 'GTC',\r\n        postOnly: false,\r\n        reduceOnly: false\r\n      });\r\n    });\r\n\r\n    it('should place long order successfully', () => {\r\n      const mockResponse: any = { orderId: '123', status: 'New' };\r\n      tradingService.placeOrder.and.returnValue(of(mockResponse));\r\n\r\n      component.placeLongOrder();\r\n\r\n      expect(tradingService.placeOrder).toHaveBeenCalledWith(\r\n        jasmine.objectContaining({\r\n          exchange: 'bybit',\r\n          symbol: 'BTCUSDT',\r\n          side: 'Buy',\r\n          type: 'Limit',\r\n          quantity: 0.5,\r\n          price: 100000,\r\n          leverage: 10\r\n        })\r\n      );\r\n    });\r\n\r\n    it('should place short order successfully', () => {\r\n      const mockResponse: any = { orderId: '123', status: 'New' };\r\n      tradingService.placeOrder.and.returnValue(of(mockResponse));\r\n\r\n      component.placeShortOrder();\r\n\r\n      expect(tradingService.placeOrder).toHaveBeenCalledWith(\r\n        jasmine.objectContaining({\r\n          exchange: 'bybit',\r\n          symbol: 'BTCUSDT',\r\n          side: 'Sell',\r\n          type: 'Limit'\r\n        })\r\n      );\r\n    });\r\n\r\n    it('should place market order without price', () => {\r\n      component.orderType.set('Market');\r\n      component.orderForm.patchValue({ price: null });\r\n      const mockResponse: any = { orderId: '123', status: 'New' };\r\n      tradingService.placeOrder.and.returnValue(of(mockResponse));\r\n\r\n      component.placeLongOrder();\r\n\r\n      const callArgs = tradingService.placeOrder.calls.mostRecent().args[0];\r\n      expect(callArgs.type).toBe('Market');\r\n      expect(callArgs.price).toBeUndefined();\r\n    });\r\n\r\n    it('should include TP/SL when enabled', () => {\r\n      component.tpslEnabled.set(true);\r\n      component.orderForm.patchValue({ takeProfit: 110000, stopLoss: 90000 });\r\n      const mockResponse: any = { orderId: '123', status: 'New' };\r\n      tradingService.placeOrder.and.returnValue(of(mockResponse));\r\n\r\n      component.placeLongOrder();\r\n\r\n      expect(tradingService.placeOrder).toHaveBeenCalledWith(\r\n        jasmine.objectContaining({\r\n          takeProfit: 110000,\r\n          stopLoss: 90000\r\n        })\r\n      );\r\n    });\r\n\r\n    it('should not include TP/SL when disabled', () => {\r\n      component.tpslEnabled.set(false);\r\n      const mockResponse: any = { orderId: '123', status: 'New' };\r\n      tradingService.placeOrder.and.returnValue(of(mockResponse));\r\n\r\n      component.placeLongOrder();\r\n\r\n      const callArgs = tradingService.placeOrder.calls.mostRecent().args[0];\r\n      expect(callArgs.takeProfit).toBeUndefined();\r\n      expect(callArgs.stopLoss).toBeUndefined();\r\n    });\r\n\r\n    it('should convert USDT quantity to BTC before placing order', () => {\r\n      component.quantityUnit.set('USDT');\r\n      component.orderForm.patchValue({ price: 100000, quantity: 50000 });\r\n      const mockResponse: any = { orderId: '123', status: 'New' };\r\n      tradingService.placeOrder.and.returnValue(of(mockResponse));\r\n\r\n      component.placeLongOrder();\r\n\r\n      expect(tradingService.placeOrder).toHaveBeenCalledWith(\r\n        jasmine.objectContaining({\r\n          quantity: 0.5 // 50000 USDT / 100000 price = 0.5 BTC\r\n        })\r\n      );\r\n    });\r\n\r\n    it('should not place order if form is invalid', () => {\r\n      component.orderForm.patchValue({ quantity: null });\r\n\r\n      component.placeLongOrder();\r\n\r\n      expect(tradingService.placeOrder).not.toHaveBeenCalled();\r\n      expect(component.orderForm.get('quantity')?.touched).toBe(true);\r\n    });\r\n\r\n    it('should reset form after successful order', () => {\r\n      const mockResponse: any = { orderId: '123', status: 'New' };\r\n      tradingService.placeOrder.and.returnValue(of(mockResponse));\r\n\r\n      component.placeLongOrder();\r\n\r\n      expect(component.orderForm.get('price')?.value).toBeNull();\r\n      expect(component.orderForm.get('quantity')?.value).toBeNull();\r\n      expect(component.quantityPercentage()).toBe(0);\r\n    });\r\n\r\n    it('should refresh balance after successful order', () => {\r\n      const mockResponse: any = { orderId: '123', status: 'New' };\r\n      tradingService.placeOrder.and.returnValue(of(mockResponse));\r\n      tradingService.getAccountBalance.calls.reset();\r\n\r\n      component.placeLongOrder();\r\n\r\n      expect(tradingService.getAccountBalance).toHaveBeenCalled();\r\n    });\r\n\r\n    it('should handle order placement error', () => {\r\n      const error = new Error('Insufficient balance');\r\n      tradingService.placeOrder.and.returnValue(throwError(() => error));\r\n      spyOn(window, 'alert');\r\n\r\n      component.placeLongOrder();\r\n\r\n      expect(window.alert).toHaveBeenCalledWith(\r\n        'Failed to place order: Insufficient balance'\r\n      );\r\n    });\r\n  });\r\n\r\n  describe('Error Messages', () => {\r\n    it('should return required error message', () => {\r\n      const control = component.orderForm.get('quantity');\r\n      control?.setErrors({ required: true });\r\n      control?.markAsTouched();\r\n\r\n      expect(component.getErrorMessage('quantity')).toBe('This field is required');\r\n    });\r\n\r\n    it('should return minimum value error message', () => {\r\n      const control = component.orderForm.get('quantity');\r\n      control?.setErrors({ min: true });\r\n      control?.markAsTouched();\r\n\r\n      expect(component.getErrorMessage('quantity')).toBe('Value must be greater than 0');\r\n    });\r\n\r\n    it('should check if control has error', () => {\r\n      const control = component.orderForm.get('quantity');\r\n      control?.setErrors({ required: true });\r\n\r\n      expect(component.hasError('quantity')).toBe(false);\r\n\r\n      control?.markAsTouched();\r\n      expect(component.hasError('quantity')).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe('Navigation & Dialogs', () => {\r\n    it('should navigate to deposit', () => {\r\n      spyOn(console, 'log');\r\n      component.navigateToDeposit();\r\n      expect(console.log).toHaveBeenCalledWith('Navigate to deposit');\r\n    });\r\n\r\n    it('should navigate to convert', () => {\r\n      spyOn(console, 'log');\r\n      component.navigateToConvert();\r\n      expect(console.log).toHaveBeenCalledWith('Navigate to convert');\r\n    });\r\n\r\n    it('should navigate to transfer', () => {\r\n      spyOn(console, 'log');\r\n      component.navigateToTransfer();\r\n      expect(console.log).toHaveBeenCalledWith('Navigate to transfer');\r\n    });\r\n\r\n    it('should open fee rate dialog', () => {\r\n      spyOn(console, 'log');\r\n      component.openFeeRateDialog();\r\n      expect(console.log).toHaveBeenCalledWith('Open fee rate dialog');\r\n    });\r\n\r\n    it('should open calculator dialog', () => {\r\n      spyOn(console, 'log');\r\n      component.openCalculatorDialog();\r\n      expect(console.log).toHaveBeenCalledWith('Open calculator dialog');\r\n    });\r\n\r\n    it('should show liquidation price alert', () => {\r\n      component.orderForm.patchValue({ price: 100000 });\r\n      component.leverage.set(10);\r\n      spyOn(window, 'alert');\r\n\r\n      component.calculateLiquidationPrice();\r\n\r\n      expect(window.alert).toHaveBeenCalledWith(\r\n        'Long Liquidation: 90000.00 USDT\\nShort Liquidation: 110000.00 USDT'\r\n      );\r\n    });\r\n  });\r\n\r\n  describe('Accessibility', () => {\r\n    it('should have proper ARIA labels for icon buttons', () => {\r\n      const compiled = fixture.nativeElement;\r\n      const gridButton = compiled.querySelector('[aria-label=\"Grid settings\"]');\r\n      const notificationButton = compiled.querySelector('[aria-label=\"Notifications\"]');\r\n      const settingsButton = compiled.querySelector('[aria-label=\"Settings\"]');\r\n\r\n      expect(gridButton).toBeTruthy();\r\n      expect(notificationButton).toBeTruthy();\r\n      expect(settingsButton).toBeTruthy();\r\n    });\r\n\r\n    it('should have proper ARIA label for quantity slider', () => {\r\n      const compiled = fixture.nativeElement;\r\n      const slider = compiled.querySelector('[aria-label=\"Quantity percentage\"]');\r\n\r\n      expect(slider).toBeTruthy();\r\n    });\r\n\r\n    it('should support keyboard navigation for checkboxes', () => {\r\n      const compiled = fixture.nativeElement;\r\n      const checkbox = compiled.querySelector('input[type=\"checkbox\"]');\r\n\r\n      expect(checkbox).toBeTruthy();\r\n      expect(checkbox.getAttribute('type')).toBe('checkbox');\r\n    });\r\n  });\r\n\r\n  describe('Edge Cases', () => {\r\n    it('should handle zero balance', () => {\r\n      const zeroBalance: Balance = { ...mockBalance, availableBalance: 0 };\r\n      component.balance.set(zeroBalance);\r\n\r\n      expect(component.availableBalance()).toBe(0);\r\n    });\r\n\r\n    it('should handle null balance', () => {\r\n      component.balance.set(null);\r\n\r\n      expect(component.availableBalance()).toBe(0);\r\n      expect(component.marginBalance()).toBe(0);\r\n    });\r\n\r\n    it('should handle extreme leverage values', () => {\r\n      component.leverage.set(125);\r\n      component.orderForm.patchValue({ price: 100000 });\r\n\r\n      const liq = component.liquidationPrice();\r\n      expect(liq.long).toBeCloseTo(99200, 0); // 100000 - (100000 / 125)\r\n    });\r\n\r\n    it('should round quantity to correct decimals for BTC', () => {\r\n      component.quantityUnit.set('BTC');\r\n      const rounded = (component as any).roundQuantity(0.1234567);\r\n      expect(rounded).toBe(0.123457);\r\n    });\r\n\r\n    it('should round quantity to correct decimals for USDT', () => {\r\n      component.quantityUnit.set('USDT');\r\n      const rounded = (component as any).roundQuantity(12345.6789);\r\n      expect(rounded).toBe(12345.68);\r\n    });\r\n\r\n    it('should handle WebSocket connection errors gracefully', () => {\r\n      bybitService.subscribeToRealtimeTicker.and.returnValue(\r\n        throwError(() => new Error('WebSocket connection failed'))\r\n      );\r\n      spyOn(console, 'error');\r\n\r\n      component.ngOnInit();\r\n\r\n      expect(console.error).toHaveBeenCalled();\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\trading\\order-form\\order-form.component.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'OrderRequest' is defined but never used.","line":17,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'OrderType' is defined but never used.","line":17,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":44},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":114,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3277,3280],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3277,3280],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":156,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":156,"endColumn":74},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":157,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":157,"endColumn":65},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":168,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":168,"endColumn":74},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'marginMode' is assigned a value but never used.","line":170,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":170,"endColumn":21},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":178,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":178,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .lastPrice on an `any` value.","line":305,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":305,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .lastPrice on an `any` value.","line":306,"column":50,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":306,"endColumn":59},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":371,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":371,"endColumn":73},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":388,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":388,"endColumn":66},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":389,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":389,"endColumn":73},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":452,"column":80,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":452,"endColumn":97},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .toFixed on an `any` value.","line":452,"column":90,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":452,"endColumn":97},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":478,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":478,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":483,"column":9,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":483,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .quantity on an `any` value.","line":483,"column":30,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":483,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":485,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":485,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .price on an `any` value.","line":485,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":485,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .quantity on an `any` value.","line":486,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":486,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":494,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":494,"endColumn":61},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .price on an `any` value.","line":494,"column":56,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":494,"endColumn":61},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":495,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":495,"endColumn":73},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .takeProfit on an `any` value.","line":495,"column":51,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":495,"endColumn":61},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":496,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":496,"endColumn":69},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .stopLoss on an `any` value.","line":496,"column":49,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":496,"endColumn":57},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":497,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":497,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .timeInForce on an `any` value.","line":497,"column":30,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":497,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":498,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":498,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .postOnly on an `any` value.","line":498,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":498,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":499,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":499,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .reduceOnly on an `any` value.","line":499,"column":29,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":499,"endColumn":39}],"suppressedMessages":[],"errorCount":33,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, OnInit, OnDestroy, Input, Output, EventEmitter, signal, computed, effect } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormBuilder, FormGroup, Validators, ReactiveFormsModule, FormsModule } from '@angular/forms';\r\nimport { Subject, takeUntil } from 'rxjs';\r\n\r\n// UI Components\r\nimport { ButtonComponent } from '../../ui/button/button.component';\r\nimport { InputComponent } from '../../ui/input/input.component';\r\nimport { SelectComponent, SelectOption } from '../../ui/select/select.component';\r\nimport { TabsComponent, Tab } from '../../ui/tabs/tabs.component';\r\n\r\n// Services\r\nimport { ManualTradingService } from '../../../services/manual-trading.service';\r\nimport { BybitService } from '../../../services/bybit.service';\r\n\r\n// Models\r\nimport { OrderRequest, OrderSide, OrderType, TimeInForce, Balance } from '../../../models/trading.model';\r\n\r\n/**\r\n * Margin mode type\r\n */\r\nexport type MarginMode = 'Cross' | 'Isolated';\r\n\r\n/**\r\n * Order type tabs\r\n */\r\nexport type OrderTypeTab = 'Limit' | 'Market' | 'Conditional';\r\n\r\n/**\r\n * TP/SL mode\r\n */\r\nexport type TPSLMode = 'Basic' | 'Advanced';\r\n\r\n/**\r\n * Quantity unit type\r\n */\r\nexport type QuantityUnit = 'BTC' | 'USDT';\r\n\r\n/**\r\n * Order form state interface\r\n */\r\nexport interface OrderFormState {\r\n  marginMode: MarginMode;\r\n  leverage: number;\r\n  orderType: OrderTypeTab;\r\n  price: number | null;\r\n  quantity: number | null;\r\n  quantityUnit: QuantityUnit;\r\n  quantityPercentage: number;\r\n  tpslEnabled: boolean;\r\n  tpslMode: TPSLMode;\r\n  takeProfit: number | null;\r\n  stopLoss: number | null;\r\n  postOnly: boolean;\r\n  reduceOnly: boolean;\r\n  timeInForce: TimeInForce;\r\n}\r\n\r\n/**\r\n * Trading Order Form Component\r\n *\r\n * Professional trading order form matching Bybit futures trading interface.\r\n * Features comprehensive order management, TP/SL configuration, margin control,\r\n * and account balance display.\r\n *\r\n * Key Features:\r\n * - Margin mode & leverage selection (1x-125x)\r\n * - Order type tabs: Limit, Market, Conditional\r\n * - Dynamic price input with \"Last\" quick-fill\r\n * - Quantity input with BTC/USDT unit selector\r\n * - Visual percentage slider (0-100%)\r\n * - TP/SL configuration with Basic/Advanced modes\r\n * - Post-Only & Reduce-Only options\r\n * - Time-in-Force settings\r\n * - Long/Short action buttons\r\n * - Unified Trading Account section with margin info\r\n * - Full theme support (dark/light modes)\r\n * - Real-time balance updates\r\n *\r\n * @example\r\n * ```html\r\n * <app-order-form></app-order-form>\r\n * ```\r\n */\r\n@Component({\r\n  selector: 'app-order-form',\r\n  standalone: true,\r\n  imports: [\r\n    CommonModule,\r\n    ReactiveFormsModule,\r\n    FormsModule,\r\n    ButtonComponent,\r\n    InputComponent,\r\n    SelectComponent,\r\n    TabsComponent\r\n  ],\r\n  templateUrl: './order-form.component.html',\r\n  styleUrls: ['./order-form.component.css']\r\n})\r\nexport class OrderFormComponent implements OnInit, OnDestroy {\r\n  private destroy$ = new Subject<void>();\r\n\r\n  // Inputs\r\n  @Input() selectedSymbol = 'BTCUSDT';\r\n  @Input() currentPrice = 0;\r\n  @Input() set balance(value: Balance | null) {\r\n    this._balance.set(value);\r\n  }\r\n  get balance(): Balance | null {\r\n    return this._balance();\r\n  }\r\n\r\n  // Outputs\r\n  @Output() orderPlaced = new EventEmitter<any>();\r\n\r\n  // Form\r\n  orderForm: FormGroup;\r\n\r\n  // Signals for reactive state management\r\n  private _marginMode = signal<MarginMode>('Cross');\r\n  private _leverage = signal<number>(10);\r\n  private _orderType = signal<OrderTypeTab>('Limit');\r\n  private _quantityUnit = signal<QuantityUnit>('BTC');\r\n  private _quantityPercentage = signal<number>(0);\r\n  private _tpslEnabled = signal<boolean>(false);\r\n  private _tpslMode = signal<TPSLMode>('Basic');\r\n\r\n  // Getters and setters for ngModel binding\r\n  get marginMode() { return this._marginMode(); }\r\n  set marginMode(value: MarginMode) { this._marginMode.set(value); }\r\n\r\n  get leverage() { return this._leverage(); }\r\n  set leverage(value: number) { this._leverage.set(value); }\r\n\r\n  get orderType() { return this._orderType(); }\r\n  set orderType(value: OrderTypeTab) { this._orderType.set(value); }\r\n\r\n  get quantityUnit() { return this._quantityUnit(); }\r\n  set quantityUnit(value: QuantityUnit) { this._quantityUnit.set(value); }\r\n\r\n  get quantityPercentage() { return this._quantityPercentage(); }\r\n  set quantityPercentage(value: number) { this._quantityPercentage.set(value); }\r\n\r\n  get tpslEnabled() { return this._tpslEnabled(); }\r\n  set tpslEnabled(value: boolean) { this._tpslEnabled.set(value); }\r\n\r\n  get tpslMode() { return this._tpslMode(); }\r\n  set tpslMode(value: TPSLMode) { this._tpslMode.set(value); }\r\n\r\n  // Market data signals\r\n  lastPrice = signal<number>(99866.7);\r\n  private _balance = signal<Balance | null>(null);\r\n\r\n  // Computed values\r\n  orderValue = computed(() => {\r\n    const price = this.orderForm?.get('price')?.value || this.lastPrice();\r\n    const quantity = this.orderForm?.get('quantity')?.value || 0;\r\n    return price * quantity;\r\n  });\r\n\r\n  orderCost = computed(() => {\r\n    const value = this.orderValue();\r\n    const lev = this._leverage();\r\n    return value / lev;\r\n  });\r\n\r\n  liquidationPrice = computed(() => {\r\n    const price = this.orderForm?.get('price')?.value || this.lastPrice();\r\n    const lev = this._leverage();\r\n    const marginMode = this._marginMode();\r\n\r\n    // Simplified liquidation price calculation\r\n    // For long: liq = entry - (entry / leverage)\r\n    // For short: liq = entry + (entry / leverage)\r\n    const marginRatio = 1 / lev;\r\n    return {\r\n      long: price - (price * marginRatio),\r\n      short: price + (price * marginRatio)\r\n    };\r\n  });\r\n\r\n  availableBalance = computed(() => {\r\n    return this._balance()?.availableBalance || 0;\r\n  });\r\n\r\n  marginBalance = computed(() => {\r\n    return this._balance()?.walletBalance || 0;\r\n  });\r\n\r\n  // Dropdown options\r\n  marginModeOptions: SelectOption[] = [\r\n    { value: 'Cross', label: 'Cross' },\r\n    { value: 'Isolated', label: 'Isolated' }\r\n  ];\r\n\r\n  leverageOptions: SelectOption[] = Array.from({ length: 125 }, (_, i) => ({\r\n    value: i + 1,\r\n    label: `${i + 1}x`\r\n  }));\r\n\r\n  quantityUnitOptions: SelectOption[] = [\r\n    { value: 'BTC', label: 'BTC' },\r\n    { value: 'USDT', label: 'USDT' }\r\n  ];\r\n\r\n  timeInForceOptions: SelectOption[] = [\r\n    { value: 'GTC', label: 'Good-Till-Canceled' },\r\n    { value: 'IOC', label: 'IOC' },\r\n    { value: 'FOK', label: 'FOK' }\r\n  ];\r\n\r\n  lastPriceOptions: SelectOption[] = [\r\n    { value: 'last', label: 'Last' },\r\n    { value: 'mark', label: 'Mark' },\r\n    { value: 'index', label: 'Index' }\r\n  ];\r\n\r\n  // Order type tabs\r\n  orderTypeTabs: Tab[] = [\r\n    { id: 'Limit', label: 'Limit' },\r\n    { id: 'Market', label: 'Market' },\r\n    { id: 'Conditional', label: 'Conditional' }\r\n  ];\r\n\r\n  // Loading states from service\r\n  isPlacingOrder = this.tradingService.isPlacingOrder;\r\n  isLoadingBalance = this.tradingService.isLoadingBalance;\r\n\r\n  constructor(\r\n    private fb: FormBuilder,\r\n    private tradingService: ManualTradingService,\r\n    private bybitService: BybitService\r\n  ) {\r\n    // Initialize form\r\n    this.orderForm = this.fb.group({\r\n      price: [null, [Validators.required, Validators.min(0)]],\r\n      quantity: [null, [Validators.required, Validators.min(0)]],\r\n      takeProfit: [null, [Validators.min(0)]],\r\n      stopLoss: [null, [Validators.min(0)]],\r\n      postOnly: [false],\r\n      reduceOnly: [false],\r\n      timeInForce: ['GTC']\r\n    });\r\n\r\n    // Effect to update form validators based on order type\r\n    effect(() => {\r\n      const type = this._orderType();\r\n      const priceControl = this.orderForm.get('price');\r\n\r\n      if (type === 'Market') {\r\n        priceControl?.clearValidators();\r\n        priceControl?.setValue(null);\r\n      } else {\r\n        priceControl?.setValidators([Validators.required, Validators.min(0)]);\r\n      }\r\n      priceControl?.updateValueAndValidity();\r\n    });\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    // Load initial data\r\n    this.loadBalance();\r\n    this.subscribeToMarketData();\r\n\r\n    // Subscribe to balance updates\r\n    this.tradingService.balance$\r\n      .pipe(takeUntil(this.destroy$))\r\n      .subscribe(balance => {\r\n        if (balance) {\r\n          this._balance.set(balance);\r\n        }\r\n      });\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.destroy$.next();\r\n    this.destroy$.complete();\r\n    this.bybitService.unsubscribeFromRealtimeTicker('BTCUSDT');\r\n  }\r\n\r\n  /**\r\n   * Load account balance\r\n   */\r\n  private loadBalance(): void {\r\n    this.tradingService.getAccountBalance('bybit')\r\n      .pipe(takeUntil(this.destroy$))\r\n      .subscribe({\r\n        next: (balance) => {\r\n          this._balance.set(balance);\r\n        },\r\n        error: (error) => {\r\n          console.error('Failed to load balance:', error);\r\n        }\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Subscribe to real-time market data\r\n   */\r\n  private subscribeToMarketData(): void {\r\n    this.bybitService.subscribeToRealtimeTicker('BTCUSDT')\r\n      .pipe(takeUntil(this.destroy$))\r\n      .subscribe({\r\n        next: (ticker) => {\r\n          if (ticker?.lastPrice) {\r\n            this.lastPrice.set(parseFloat(ticker.lastPrice));\r\n          }\r\n        },\r\n        error: (error) => {\r\n          console.error('Failed to subscribe to ticker:', error);\r\n        }\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Handle margin mode change\r\n   */\r\n  onMarginModeChange(mode: MarginMode): void {\r\n    this._marginMode.set(mode);\r\n  }\r\n\r\n  /**\r\n   * Handle leverage change\r\n   */\r\n  onLeverageChange(lev: number): void {\r\n    this._leverage.set(lev);\r\n  }\r\n\r\n  /**\r\n   * Handle order type tab change\r\n   */\r\n  onOrderTypeChange(type: string): void {\r\n    this._orderType.set(type as OrderTypeTab);\r\n  }\r\n\r\n  /**\r\n   * Handle quantity unit change\r\n   */\r\n  onQuantityUnitChange(unit: QuantityUnit): void {\r\n    this._quantityUnit.set(unit);\r\n    // Convert quantity when unit changes\r\n    this.convertQuantity(unit);\r\n  }\r\n\r\n  /**\r\n   * Fill price with last price\r\n   */\r\n  fillLastPrice(): void {\r\n    this.orderForm.patchValue({\r\n      price: this.lastPrice()\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Handle quantity percentage slider change\r\n   */\r\n  onQuantityPercentageChange(event: Event): void {\r\n    const input = event.target as HTMLInputElement;\r\n    const percentage = parseInt(input.value, 10);\r\n    this._quantityPercentage.set(percentage);\r\n\r\n    // Calculate quantity based on percentage and available balance\r\n    this.calculateQuantityFromPercentage(percentage);\r\n  }\r\n\r\n  /**\r\n   * Calculate quantity from percentage\r\n   */\r\n  private calculateQuantityFromPercentage(percentage: number): void {\r\n    const available = this.availableBalance();\r\n    const price = this.orderForm.get('price')?.value || this.lastPrice();\r\n    const lev = this._leverage();\r\n\r\n    if (available && price) {\r\n      const totalValue = (available * percentage / 100) * lev;\r\n      const quantity = totalValue / price;\r\n\r\n      this.orderForm.patchValue({\r\n        quantity: this.roundQuantity(quantity)\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Convert quantity when unit changes\r\n   */\r\n  private convertQuantity(newUnit: QuantityUnit): void {\r\n    const currentQuantity = this.orderForm.get('quantity')?.value;\r\n    const price = this.orderForm.get('price')?.value || this.lastPrice();\r\n\r\n    if (currentQuantity && price) {\r\n      let newQuantity: number;\r\n\r\n      if (newUnit === 'USDT') {\r\n        // Convert BTC to USDT\r\n        newQuantity = currentQuantity * price;\r\n      } else {\r\n        // Convert USDT to BTC\r\n        newQuantity = currentQuantity / price;\r\n      }\r\n\r\n      this.orderForm.patchValue({\r\n        quantity: this.roundQuantity(newQuantity)\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Round quantity to appropriate decimal places\r\n   */\r\n  private roundQuantity(value: number): number {\r\n    const unit = this._quantityUnit();\r\n    const decimals = unit === 'BTC' ? 6 : 2;\r\n    return Math.round(value * Math.pow(10, decimals)) / Math.pow(10, decimals);\r\n  }\r\n\r\n  /**\r\n   * Toggle TP/SL enabled state\r\n   */\r\n  toggleTPSL(): void {\r\n    this._tpslEnabled.update(enabled => !enabled);\r\n\r\n    if (!this._tpslEnabled()) {\r\n      this.orderForm.patchValue({\r\n        takeProfit: null,\r\n        stopLoss: null\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Toggle TP/SL mode\r\n   */\r\n  toggleTPSLMode(): void {\r\n    this._tpslMode.update(mode => mode === 'Basic' ? 'Advanced' : 'Basic');\r\n  }\r\n\r\n  /**\r\n   * Fill TP/SL with last price\r\n   */\r\n  fillTPSLWithLast(field: 'takeProfit' | 'stopLoss'): void {\r\n    this.orderForm.patchValue({\r\n      [field]: this.lastPrice()\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Calculate liquidation price\r\n   */\r\n  calculateLiquidationPrice(): void {\r\n    const liq = this.liquidationPrice();\r\n    alert(`Long Liquidation: ${liq.long.toFixed(2)} USDT\\nShort Liquidation: ${liq.short.toFixed(2)} USDT`);\r\n  }\r\n\r\n  /**\r\n   * Place long order\r\n   */\r\n  placeLongOrder(): void {\r\n    this.placeOrder('Buy');\r\n  }\r\n\r\n  /**\r\n   * Place short order\r\n   */\r\n  placeShortOrder(): void {\r\n    this.placeOrder('Sell');\r\n  }\r\n\r\n  /**\r\n   * Place order\r\n   */\r\n  private placeOrder(side: OrderSide): void {\r\n    if (this.orderForm.invalid) {\r\n      this.orderForm.markAllAsTouched();\r\n      return;\r\n    }\r\n\r\n    const formValue = this.orderForm.value;\r\n    const type = this._orderType();\r\n    const unit = this._quantityUnit();\r\n\r\n    // Calculate actual quantity in base currency (BTC)\r\n    let quantity = formValue.quantity;\r\n    if (unit === 'USDT') {\r\n      const price = formValue.price || this.lastPrice();\r\n      quantity = formValue.quantity / price;\r\n    }\r\n\r\n    const orderRequest = {\r\n      symbol: this.selectedSymbol,\r\n      side,\r\n      type: type === 'Conditional' ? 'Limit' : type,\r\n      quantity: this.roundQuantity(quantity),\r\n      price: type === 'Market' ? undefined : formValue.price,\r\n      takeProfit: this._tpslEnabled() ? formValue.takeProfit : undefined,\r\n      stopLoss: this._tpslEnabled() ? formValue.stopLoss : undefined,\r\n      timeInForce: formValue.timeInForce,\r\n      postOnly: formValue.postOnly,\r\n      reduceOnly: formValue.reduceOnly,\r\n      leverage: this._leverage()\r\n    };\r\n\r\n    // Emit the order request to parent component\r\n    this.orderPlaced.emit(orderRequest);\r\n    this.resetForm();\r\n  }\r\n\r\n  /**\r\n   * Reset form to default values\r\n   */\r\n  private resetForm(): void {\r\n    this.orderForm.reset({\r\n      price: null,\r\n      quantity: null,\r\n      takeProfit: null,\r\n      stopLoss: null,\r\n      postOnly: false,\r\n      reduceOnly: false,\r\n      timeInForce: 'GTC'\r\n    });\r\n    this._quantityPercentage.set(0);\r\n  }\r\n\r\n  /**\r\n   * Get form control error message\r\n   */\r\n  getErrorMessage(controlName: string): string {\r\n    const control = this.orderForm.get(controlName);\r\n\r\n    if (control?.hasError('required')) {\r\n      return 'This field is required';\r\n    }\r\n\r\n    if (control?.hasError('min')) {\r\n      return 'Value must be greater than 0';\r\n    }\r\n\r\n    return '';\r\n  }\r\n\r\n  /**\r\n   * Check if form control has error\r\n   */\r\n  hasError(controlName: string): boolean {\r\n    const control = this.orderForm.get(controlName);\r\n    return !!(control && control.invalid && (control.dirty || control.touched));\r\n  }\r\n\r\n  /**\r\n   * Navigate to deposit\r\n   */\r\n  navigateToDeposit(): void {\r\n    console.log('Navigate to deposit');\r\n    // TODO: Implement navigation\r\n  }\r\n\r\n  /**\r\n   * Navigate to convert\r\n   */\r\n  navigateToConvert(): void {\r\n    console.log('Navigate to convert');\r\n    // TODO: Implement navigation\r\n  }\r\n\r\n  /**\r\n   * Navigate to transfer\r\n   */\r\n  navigateToTransfer(): void {\r\n    console.log('Navigate to transfer');\r\n    // TODO: Implement navigation\r\n  }\r\n\r\n  /**\r\n   * Open fee rate dialog\r\n   */\r\n  openFeeRateDialog(): void {\r\n    console.log('Open fee rate dialog');\r\n    // TODO: Implement dialog\r\n  }\r\n\r\n  /**\r\n   * Open calculator dialog\r\n   */\r\n  openCalculatorDialog(): void {\r\n    console.log('Open calculator dialog');\r\n    // TODO: Implement calculator\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\trading\\start-arbitrage-modal\\start-arbitrage-modal.component.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'effect' is defined but never used.","line":13,"column":47,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":137,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":137,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":141,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":164,"endColumn":8},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":147,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":147,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .primaryLeverage on an `any` value.","line":147,"column":36,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":147,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":148,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":148,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .primaryMargin on an `any` value.","line":148,"column":34,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":148,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":153,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":153,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .hedgeLeverage on an `any` value.","line":153,"column":34,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":153,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":154,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":154,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .hedgeMargin on an `any` value.","line":154,"column":32,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":154,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .targetSpread on an `any` value.","line":161,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":161,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .targetSpread on an `any` value.","line":161,"column":65,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":161,"endColumn":77},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .stopLoss on an `any` value.","line":162,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":162,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .stopLoss on an `any` value.","line":162,"column":57,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":162,"endColumn":65},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .maxHoldingTime on an `any` value.","line":163,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":163,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .maxHoldingTime on an `any` value.","line":163,"column":69,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":163,"endColumn":83},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":177,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":177,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6234,6237],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6234,6237],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":179,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":179,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .min on an `any` value.","line":210,"column":93,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":210,"endColumn":96},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .max on an `any` value.","line":213,"column":93,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":213,"endColumn":96}],"suppressedMessages":[],"errorCount":21,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Start Arbitrage Modal Component\r\n *\r\n * Modal dialog for configuring and starting a new price arbitrage position.\r\n * Features:\r\n * - Display opportunity details (symbol, exchanges, prices, spread)\r\n * - Configure leverage and margin for both exchanges\r\n * - Advanced settings: target spread, stop loss, max holding time\r\n * - Real-time validation and error handling\r\n * - Success/error feedback\r\n */\r\n\r\nimport { Component, inject, signal, computed, effect, OnInit } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule, FormBuilder, FormGroup, Validators } from '@angular/forms';\r\nimport { MatDialogRef, MAT_DIALOG_DATA, MatDialogModule } from '@angular/material/dialog';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatSliderModule } from '@angular/material/slider';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\r\nimport { MatExpansionModule } from '@angular/material/expansion';\r\nimport { MatTooltipModule } from '@angular/material/tooltip';\r\nimport { MatIconModule } from '@angular/material/icon';\r\n\r\nimport { PriceArbitrageService } from '../../../services/price-arbitrage.service';\r\nimport { TranslationService } from '../../../services/translation.service';\r\nimport { PriceArbitrageOpportunity, StartPriceArbitrageParams } from '../../../models/price-arbitrage.model';\r\n\r\nexport interface StartArbitrageDialogData {\r\n  opportunity: PriceArbitrageOpportunity;\r\n}\r\n\r\n@Component({\r\n  selector: 'app-start-arbitrage-modal',\r\n  standalone: true,\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    MatDialogModule,\r\n    MatFormFieldModule,\r\n    MatInputModule,\r\n    MatSliderModule,\r\n    MatButtonModule,\r\n    MatProgressSpinnerModule,\r\n    MatExpansionModule,\r\n    MatTooltipModule,\r\n    MatIconModule\r\n  ],\r\n  templateUrl: './start-arbitrage-modal.component.html',\r\n  styleUrls: ['./start-arbitrage-modal.component.scss']\r\n})\r\nexport class StartArbitrageModalComponent implements OnInit {\r\n  // Injected services\r\n  private dialogRef = inject(MatDialogRef<StartArbitrageModalComponent>);\r\n  private data = inject<StartArbitrageDialogData>(MAT_DIALOG_DATA);\r\n  private fb = inject(FormBuilder);\r\n  private priceArbitrageService = inject(PriceArbitrageService);\r\n  private translationService = inject(TranslationService);\r\n\r\n  // Opportunity data\r\n  opportunity = signal<PriceArbitrageOpportunity>(this.data.opportunity);\r\n\r\n  // Form state\r\n  form!: FormGroup;\r\n  isSubmitting = signal<boolean>(false);\r\n  errorMessage = signal<string | null>(null);\r\n  successMessage = signal<string | null>(null);\r\n\r\n  // Advanced settings expansion state\r\n  showAdvancedSettings = signal<boolean>(false);\r\n\r\n  // Computed values\r\n  spreadPercent = computed(() => {\r\n    const opp = this.opportunity();\r\n    return (opp.spread * 100).toFixed(4);\r\n  });\r\n\r\n  spreadClass = computed(() => {\r\n    const opp = this.opportunity();\r\n    if (opp.spread >= 0.02) return 'spread-high';\r\n    if (opp.spread >= 0.01) return 'spread-medium';\r\n    return 'spread-low';\r\n  });\r\n\r\n  // Translation helper\r\n  translate(key: string): string {\r\n    return this.translationService.translate(key);\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.initializeForm();\r\n  }\r\n\r\n  /**\r\n   * Initialize the form with validators\r\n   */\r\n  private initializeForm(): void {\r\n    this.form = this.fb.group({\r\n      // Primary exchange settings\r\n      primaryLeverage: [10, [Validators.required, Validators.min(1), Validators.max(100)]],\r\n      primaryMargin: [100, [Validators.required, Validators.min(10)]],\r\n\r\n      // Hedge exchange settings\r\n      hedgeLeverage: [10, [Validators.required, Validators.min(1), Validators.max(100)]],\r\n      hedgeMargin: [100, [Validators.required, Validators.min(10)]],\r\n\r\n      // Advanced settings (optional)\r\n      targetSpread: [null, [Validators.min(0), Validators.max(100)]],\r\n      stopLoss: [null, [Validators.min(0), Validators.max(100)]],\r\n      maxHoldingTime: [null, [Validators.min(1)]]\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Format leverage value for slider display\r\n   */\r\n  formatLeverageLabel(value: number): string {\r\n    return `${value}x`;\r\n  }\r\n\r\n  /**\r\n   * Handle form submission\r\n   */\r\n  async onSubmit(): Promise<void> {\r\n    if (this.form.invalid || this.isSubmitting()) {\r\n      this.form.markAllAsTouched();\r\n      return;\r\n    }\r\n\r\n    this.isSubmitting.set(true);\r\n    this.errorMessage.set(null);\r\n    this.successMessage.set(null);\r\n\r\n    try {\r\n      const formValue = this.form.value;\r\n      const opp = this.opportunity();\r\n\r\n      // Build params for API\r\n      const params: StartPriceArbitrageParams = {\r\n        symbol: opp.symbol,\r\n\r\n        // Primary exchange (higher price - SHORT position)\r\n        primaryExchange: opp.primaryExchange.name,\r\n        primaryCredentialId: opp.primaryExchange.credentialId,\r\n        primaryLeverage: formValue.primaryLeverage,\r\n        primaryMargin: formValue.primaryMargin,\r\n\r\n        // Hedge exchange (lower price - LONG position)\r\n        hedgeExchange: opp.hedgeExchange.name,\r\n        hedgeCredentialId: opp.hedgeExchange.credentialId,\r\n        hedgeLeverage: formValue.hedgeLeverage,\r\n        hedgeMargin: formValue.hedgeMargin,\r\n\r\n        // Entry prices\r\n        entryPrimaryPrice: opp.primaryExchange.price,\r\n        entryHedgePrice: opp.hedgeExchange.price,\r\n\r\n        // Optional advanced settings\r\n        ...(formValue.targetSpread && { targetSpread: formValue.targetSpread / 100 }),\r\n        ...(formValue.stopLoss && { stopLoss: formValue.stopLoss / 100 }),\r\n        ...(formValue.maxHoldingTime && { maxHoldingTime: formValue.maxHoldingTime * 3600 }) // Convert hours to seconds\r\n      };\r\n\r\n      // Call the service\r\n      const result = await this.priceArbitrageService.startArbitrage(params).toPromise();\r\n\r\n      // Success!\r\n      this.successMessage.set(this.translate('arbitrage.startSuccess'));\r\n\r\n      // Close modal after short delay\r\n      setTimeout(() => {\r\n        this.dialogRef.close({ success: true, position: result });\r\n      }, 1500);\r\n\r\n    } catch (error: any) {\r\n      console.error('Failed to start arbitrage:', error);\r\n      this.errorMessage.set(error.message || this.translate('arbitrage.startError'));\r\n    } finally {\r\n      this.isSubmitting.set(false);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Close the modal without starting arbitrage\r\n   */\r\n  onCancel(): void {\r\n    this.dialogRef.close({ success: false });\r\n  }\r\n\r\n  /**\r\n   * Toggle advanced settings panel\r\n   */\r\n  toggleAdvancedSettings(): void {\r\n    this.showAdvancedSettings.update(val => !val);\r\n  }\r\n\r\n  /**\r\n   * Get form control error message\r\n   */\r\n  getErrorMessage(controlName: string): string {\r\n    const control = this.form.get(controlName);\r\n    if (!control || !control.errors) return '';\r\n\r\n    if (control.errors['required']) {\r\n      return this.translate('validation.required');\r\n    }\r\n    if (control.errors['min']) {\r\n      return this.translate('validation.minValue').replace('{value}', control.errors['min'].min);\r\n    }\r\n    if (control.errors['max']) {\r\n      return this.translate('validation.maxValue').replace('{value}', control.errors['max'].max);\r\n    }\r\n\r\n    return '';\r\n  }\r\n\r\n  /**\r\n   * Check if form control is invalid and touched\r\n   */\r\n  isFieldInvalid(controlName: string): boolean {\r\n    const control = this.form.get(controlName);\r\n    return !!(control && control.invalid && control.touched);\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\trading\\start-bybit-strategy-modal\\start-bybit-strategy-modal.component.html","messages":[{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":90,"column":9,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":90,"endColumn":90}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<ui-dialog\r\n  [open]=\"isOpen\"\r\n  [title]=\"translate('bybitStrategy.title')\"\r\n  [size]=\"'large'\"\r\n  [closable]=\"!isSubmitting()\"\r\n  [closeOnBackdrop]=\"!isSubmitting()\"\r\n  [showFooter]=\"true\"\r\n  (close)=\"onCancel()\">\r\n\r\n  <ui-dialog-content>\r\n    <!-- Symbol Info Section -->\r\n    <div class=\"symbol-section\">\r\n      <h3 class=\"symbol-name\">{{ dataSignal().symbol }}</h3>\r\n      <div class=\"funding-info\">\r\n        <div class=\"funding-rate\" [ngClass]=\"(dataSignal().fundingRate || 0) > 0 ? 'positive' : 'negative'\">\r\n          <span class=\"funding-label\">{{ translate('bybitStrategy.info.fundingRate') }}:</span>\r\n          <span class=\"funding-value\">{{ (dataSignal().fundingRate || 0) * 100 | number: '1.4-4' }}%</span>\r\n        </div>\r\n        <div class=\"time-remaining\">\r\n          <span class=\"icon\">‚è±</span>\r\n          <span>{{ timeRemainingFormatted() }}</span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Configuration Form -->\r\n    <form [formGroup]=\"form\" (ngSubmit)=\"onSubmit()\" class=\"config-form\">\r\n      <!-- Strategy Type Selection -->\r\n      <div class=\"form-section\">\r\n        <h4 class=\"section-title\">\r\n          <span class=\"icon\">‚öô</span>\r\n          {{ translate('bybitStrategy.type.label') }}\r\n        </h4>\r\n\r\n        <ui-dropdown\r\n          [options]=\"strategyTypeOptions\"\r\n          [placeholder]=\"translate('bybitStrategy.type.placeholder')\"\r\n          formControlName=\"strategyType\">\r\n        </ui-dropdown>\r\n        @if (isFieldInvalid('strategyType')) {\r\n          <div class=\"field-error\">{{ getErrorMessage('strategyType') }}</div>\r\n        }\r\n        <div class=\"field-hint\">\r\n          @if (isPreciseStrategy()) {\r\n            {{ translate('bybitStrategy.type.preciseHint') }}\r\n          } @else {\r\n            {{ translate('bybitStrategy.type.regularHint') }}\r\n          }\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Position Configuration -->\r\n      <div class=\"form-section\">\r\n        <h4 class=\"section-title\">\r\n          <span class=\"icon\">‚öô</span>\r\n          {{ translate('bybitStrategy.position.title') }}\r\n        </h4>\r\n\r\n        <!-- Leverage -->\r\n        <div class=\"form-field\">\r\n          <ui-input\r\n            type=\"number\"\r\n            [value]=\"form.get('leverage')?.value?.toString() || ''\"\r\n            (valueChange)=\"form.patchValue({leverage: +$event})\"\r\n            [label]=\"translate('bybitStrategy.position.leverage')\"\r\n            placeholder=\"10\"\r\n            [min]=\"1\"\r\n            [max]=\"125\"\r\n            [error]=\"isFieldInvalid('leverage') ? getErrorMessage('leverage') : ''\"\r\n            [fullWidth]=\"true\">\r\n          </ui-input>\r\n          <div class=\"field-hint\">{{ translate('bybitStrategy.position.leverageHint') }} ({{ form.get('leverage')?.value }}x)</div>\r\n        </div>\r\n\r\n        <!-- Margin -->\r\n        <ui-input\r\n          type=\"number\"\r\n          [value]=\"form.get('margin')?.value?.toString() || ''\"\r\n          (valueChange)=\"form.patchValue({margin: +$event})\"\r\n          [label]=\"translate('bybitStrategy.position.margin')\"\r\n          placeholder=\"100\"\r\n          [min]=\"1\"\r\n          [step]=\"10\"\r\n          [error]=\"isFieldInvalid('margin') ? getErrorMessage('margin') : ''\"\r\n          [fullWidth]=\"true\">\r\n        </ui-input>\r\n        <div class=\"field-hint\">{{ translate('bybitStrategy.position.marginHint') }} (USDT)</div>\r\n\r\n        <!-- Position Side -->\r\n        <label class=\"field-label\">{{ translate('bybitStrategy.position.side') }}</label>\r\n        <ui-dropdown\r\n          [options]=\"positionSideOptions\"\r\n          [placeholder]=\"translate('bybitStrategy.position.sidePlaceholder')\"\r\n          formControlName=\"positionSide\">\r\n        </ui-dropdown>\r\n        @if (isFieldInvalid('positionSide')) {\r\n          <div class=\"field-error\">{{ getErrorMessage('positionSide') }}</div>\r\n        }\r\n        <div class=\"field-hint\">{{ translate('bybitStrategy.position.sideHint') }}</div>\r\n      </div>\r\n\r\n      <!-- Risk Management (TP/SL) -->\r\n      <div class=\"form-section\">\r\n        <h4 class=\"section-title\">\r\n          <span class=\"icon\">üõ°</span>\r\n          {{ translate('bybitStrategy.risk.title') }}\r\n        </h4>\r\n\r\n        <div class=\"risk-fields\">\r\n          <!-- Take Profit -->\r\n          <div class=\"risk-field\">\r\n            <ui-input\r\n              type=\"number\"\r\n              [value]=\"form.get('takeProfitPercent')?.value?.toString() || ''\"\r\n              (valueChange)=\"form.patchValue({takeProfitPercent: +$event})\"\r\n              [label]=\"translate('bybitStrategy.risk.takeProfit')\"\r\n              placeholder=\"90\"\r\n              [min]=\"1\"\r\n              [max]=\"100\"\r\n              [error]=\"isFieldInvalid('takeProfitPercent') ? getErrorMessage('takeProfitPercent') : ''\"\r\n              [fullWidth]=\"true\">\r\n            </ui-input>\r\n            <div class=\"field-hint\">\r\n              {{ takeProfitAmount() | number: '1.2-2' }} USDT\r\n              ({{ form.get('takeProfitPercent')?.value }}% {{ translate('bybitStrategy.risk.takeProfitHint') }})\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Stop Loss -->\r\n          <div class=\"risk-field\">\r\n            <ui-input\r\n              type=\"number\"\r\n              [value]=\"form.get('stopLossPercent')?.value?.toString() || ''\"\r\n              (valueChange)=\"form.patchValue({stopLossPercent: +$event})\"\r\n              [label]=\"translate('bybitStrategy.risk.stopLoss')\"\r\n              placeholder=\"50\"\r\n              [min]=\"1\"\r\n              [max]=\"100\"\r\n              [error]=\"isFieldInvalid('stopLossPercent') ? getErrorMessage('stopLossPercent') : ''\"\r\n              [fullWidth]=\"true\">\r\n            </ui-input>\r\n            <div class=\"field-hint\">\r\n              {{ stopLossAmount() | number: '1.2-2' }} USDT\r\n              ({{ form.get('stopLossPercent')?.value }}% {{ translate('bybitStrategy.risk.stopLossHint') }})\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Advanced Settings (only for Precise Timing) -->\r\n      @if (isPreciseStrategy()) {\r\n        <div class=\"advanced-settings-section\">\r\n          <button type=\"button\" class=\"toggle-advanced\" (click)=\"toggleAdvancedSettings()\">\r\n            <span class=\"icon\">‚öô</span>\r\n            <span>{{ translate('bybitStrategy.advanced.title') }}</span>\r\n            <span class=\"toggle-icon\">{{ showAdvancedSettings() ? '‚ñº' : '‚ñ∂' }}</span>\r\n          </button>\r\n          @if (showAdvancedSettings()) {\r\n            <div class=\"advanced-settings-content\">\r\n            <!-- Timing Offset -->\r\n            <ui-input\r\n              type=\"number\"\r\n              [value]=\"form.get('timingOffset')?.value?.toString() || ''\"\r\n              (valueChange)=\"form.patchValue({timingOffset: +$event})\"\r\n              [label]=\"translate('bybitStrategy.advanced.timingOffset')\"\r\n              placeholder=\"20\"\r\n              [min]=\"0\"\r\n              [max]=\"1000\"\r\n              [step]=\"10\"\r\n              [error]=\"isFieldInvalid('timingOffset') ? getErrorMessage('timingOffset') : ''\"\r\n              [fullWidth]=\"true\">\r\n            </ui-input>\r\n            <div class=\"field-hint\">{{ translate('bybitStrategy.advanced.timingOffsetHint') }} (ms)</div>\r\n\r\n            <!-- Auto Repeat -->\r\n            <div class=\"checkbox-field\">\r\n              <label class=\"checkbox-label\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  [checked]=\"form.get('autoRepeat')?.value\"\r\n                  (change)=\"form.patchValue({autoRepeat: !form.get('autoRepeat')?.value})\">\r\n                <span>{{ translate('bybitStrategy.advanced.autoRepeat') }}</span>\r\n              </label>\r\n              <div class=\"field-hint\">\r\n                {{ translate('bybitStrategy.advanced.autoRepeatHint') }}\r\n              </div>\r\n            </div>\r\n\r\n            <!-- WebSocket Monitoring -->\r\n            <div class=\"checkbox-field\">\r\n              <label class=\"checkbox-label\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  [checked]=\"form.get('enableWebSocketMonitoring')?.value\"\r\n                  (change)=\"form.patchValue({enableWebSocketMonitoring: !form.get('enableWebSocketMonitoring')?.value})\">\r\n                <span>{{ translate('bybitStrategy.advanced.websocket') }}</span>\r\n              </label>\r\n              <div class=\"field-hint\">\r\n                {{ translate('bybitStrategy.advanced.websocketHint') }}\r\n              </div>\r\n            </div>\r\n            </div>\r\n          }\r\n        </div>\r\n      }\r\n\r\n      <!-- Expected Results Summary -->\r\n      <div class=\"summary-section\">\r\n        <h4 class=\"section-title\">\r\n          <span class=\"icon\">üìä</span>\r\n          {{ translate('bybitStrategy.expected.title') }}\r\n        </h4>\r\n        <div class=\"summary-grid\">\r\n          <div class=\"summary-item\">\r\n            <span class=\"label\">{{ translate('bybitStrategy.expected.positionValue') }}</span>\r\n            <span class=\"value\">{{ positionValue() | number: '1.2-2' }} USDT</span>\r\n          </div>\r\n          <div class=\"summary-item\">\r\n            <span class=\"label\">{{ translate('bybitStrategy.expected.expectedFunding') }}</span>\r\n            <span class=\"value positive\">{{ expectedFunding() | number: '1.2-2' }} USDT</span>\r\n          </div>\r\n          <div class=\"summary-item\">\r\n            <span class=\"label\">{{ translate('bybitStrategy.expected.takeProfitTarget') }}</span>\r\n            <span class=\"value\">{{ takeProfitAmount() | number: '1.2-2' }} USDT</span>\r\n          </div>\r\n          <div class=\"summary-item\">\r\n            <span class=\"label\">{{ translate('bybitStrategy.expected.stopLoss') }}</span>\r\n            <span class=\"value negative\">{{ stopLossAmount() | number: '1.2-2' }} USDT</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Success/Error Messages -->\r\n      @if (successMessage()) {\r\n        <div class=\"message success-message\">\r\n          <span class=\"icon\">‚úì</span>\r\n          <span>{{ successMessage() }}</span>\r\n        </div>\r\n      }\r\n\r\n      @if (errorMessage()) {\r\n        <div class=\"message error-message\">\r\n          <span class=\"icon\">‚úï</span>\r\n          <span>{{ errorMessage() }}</span>\r\n        </div>\r\n      }\r\n    </form>\r\n  </ui-dialog-content>\r\n\r\n  <!-- Modal Actions -->\r\n  <ui-dialog-footer>\r\n    <ui-button\r\n      variant=\"secondary\"\r\n      (clicked)=\"onCancel()\"\r\n      [disabled]=\"isSubmitting()\">\r\n      {{ translate('bybitStrategy.actions.cancel') }}\r\n    </ui-button>\r\n    <ui-button\r\n      variant=\"primary\"\r\n      (clicked)=\"onSubmit()\"\r\n      [disabled]=\"form.invalid || isSubmitting()\"\r\n      [loading]=\"isSubmitting()\">\r\n      {{ translate('bybitStrategy.actions.start') }}\r\n    </ui-button>\r\n  </ui-dialog-footer>\r\n</ui-dialog>\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\trading\\start-bybit-strategy-modal\\start-bybit-strategy-modal.component.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'PositionSideConfig' is defined but never used.","line":40,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":40,"endColumn":21},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":106,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":106,"endColumn":58},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":107,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":107,"endColumn":61},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":113,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":113,"endColumn":79},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":118,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":118,"endColumn":75},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":134,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":134,"endColumn":58},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":135,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":135,"endColumn":61},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":226,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":226,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":231,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":231,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .leverage on an `any` value.","line":231,"column":29,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":231,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":232,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":232,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .margin on an `any` value.","line":232,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":232,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":233,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":233,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .positionSide on an `any` value.","line":233,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":233,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":234,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":234,"endColumn":55},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .takeProfitPercent on an `any` value.","line":234,"column":38,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":234,"endColumn":55},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":235,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":235,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .stopLossPercent on an `any` value.","line":235,"column":36,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":235,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":236,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":236,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .timingOffset on an `any` value.","line":236,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":236,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":237,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":237,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .autoRepeat on an `any` value.","line":237,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":237,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":238,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":238,"endColumn":71},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .enableWebSocketMonitoring on an `any` value.","line":238,"column":46,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":238,"endColumn":71},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .strategyType on an `any` value.","line":243,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":243,"endColumn":33},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":252,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":252,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8162,8165],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8162,8165],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .positionSide on an `any` value.","line":252,"column":39,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":252,"endColumn":51},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":253,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":253,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8215,8218],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8215,8218],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .timingOffset on an `any` value.","line":253,"column":39,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":253,"endColumn":51},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":255,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":255,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8325,8328],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8325,8328],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":270,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":270,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8862,8865],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8862,8865],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":272,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":272,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .min on an `any` value.","line":303,"column":93,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":303,"endColumn":96},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .max on an `any` value.","line":306,"column":93,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":306,"endColumn":96}],"suppressedMessages":[],"errorCount":34,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Start Bybit Funding Strategy Modal Component\r\n *\r\n * Modal dialog for configuring and starting a Bybit funding rate strategy.\r\n * Features:\r\n * - Display symbol info (funding rate, time until funding)\r\n * - Configure strategy type (precise timing vs regular)\r\n * - Select credentials and configure position parameters\r\n * - Set leverage, margin, position side, TP/SL\r\n * - Advanced settings for precise timing strategy\r\n * - Real-time validation and calculated expected results\r\n * - Success/error feedback\r\n */\r\n\r\nimport {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  inject,\r\n  signal,\r\n  computed,\r\n  OnInit,\r\n} from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { ReactiveFormsModule, FormBuilder, FormGroup, Validators } from '@angular/forms';\r\nimport { firstValueFrom } from 'rxjs';\r\nimport {\r\n  DialogComponent,\r\n  DialogContentComponent,\r\n  DialogFooterComponent,\r\n} from '../../ui/dialog/dialog.component';\r\nimport { ButtonComponent } from '../../ui/button/button.component';\r\nimport { InputComponent } from '../../ui/input/input.component';\r\nimport { DropdownComponent } from '../../ui/dropdown/dropdown.component';\r\n\r\nimport { BybitFundingStrategyService } from '../../../services/bybit-funding-strategy.service';\r\nimport { TranslationService } from '../../../services/translation.service';\r\nimport type {\r\n  PositionSideConfig,\r\n  StartPreciseTimingStrategyRequest,\r\n} from '../../../models/bybit-funding-strategy.model';\r\n\r\nexport interface StartBybitStrategyModalData {\r\n  symbol: string;\r\n  fundingRate: number;\r\n  nextFundingTime: number;\r\n  credentialId: string; // Credential ID from parent component\r\n}\r\n\r\n@Component({\r\n  selector: 'app-start-bybit-strategy-modal',\r\n  standalone: true,\r\n  imports: [\r\n    CommonModule,\r\n    ReactiveFormsModule,\r\n    DialogComponent,\r\n    DialogContentComponent,\r\n    DialogFooterComponent,\r\n    ButtonComponent,\r\n    InputComponent,\r\n    DropdownComponent,\r\n  ],\r\n  templateUrl: './start-bybit-strategy-modal.component.html',\r\n  styleUrls: ['./start-bybit-strategy-modal.component.scss'],\r\n})\r\nexport class StartBybitStrategyModalComponent implements OnInit {\r\n  // Component inputs/outputs\r\n  @Input() isOpen = false;\r\n  @Input() data!: StartBybitStrategyModalData;\r\n  @Output() close = new EventEmitter<void>();\r\n  @Output() strategyStarted = new EventEmitter<void>();\r\n\r\n  // Injected services\r\n  private fb = inject(FormBuilder);\r\n  private strategyService = inject(BybitFundingStrategyService);\r\n  private translationService = inject(TranslationService);\r\n\r\n  // Modal data as signal for computed values\r\n  dataSignal = computed(() => this.data);\r\n\r\n  // Form state\r\n  form!: FormGroup;\r\n  isSubmitting = signal<boolean>(false);\r\n  errorMessage = signal<string | null>(null);\r\n  successMessage = signal<string | null>(null);\r\n\r\n  // Advanced settings expansion state\r\n  showAdvancedSettings = signal<boolean>(false);\r\n\r\n  // Strategy type options\r\n  strategyTypeOptions = [\r\n    { value: 'precise', label: '' },\r\n    { value: 'regular', label: '' },\r\n  ];\r\n\r\n  // Position side options\r\n  positionSideOptions = [\r\n    { value: 'Auto', label: '' },\r\n    { value: 'Buy', label: '' },\r\n    { value: 'Sell', label: '' },\r\n  ];\r\n\r\n  // Computed values\r\n  expectedFunding = computed(() => {\r\n    const margin = this.form?.get('margin')?.value || 100;\r\n    const leverage = this.form?.get('leverage')?.value || 10;\r\n    const fundingRate = this.dataSignal().fundingRate || 0;\r\n    return this.strategyService.calculateExpectedFunding(margin, leverage, fundingRate);\r\n  });\r\n\r\n  takeProfitAmount = computed(() => {\r\n    const takeProfitPercent = this.form?.get('takeProfitPercent')?.value || 90;\r\n    return this.strategyService.calculateTakeProfit(this.expectedFunding(), takeProfitPercent);\r\n  });\r\n\r\n  stopLossAmount = computed(() => {\r\n    const stopLossPercent = this.form?.get('stopLossPercent')?.value || 50;\r\n    return this.strategyService.calculateStopLoss(this.expectedFunding(), stopLossPercent);\r\n  });\r\n\r\n  secondsUntilFunding = computed(() => {\r\n    const nextFundingTime = this.dataSignal().nextFundingTime;\r\n    if (!nextFundingTime) return 0;\r\n    const now = Date.now();\r\n    return Math.max(0, Math.floor((nextFundingTime - now) / 1000));\r\n  });\r\n\r\n  timeRemainingFormatted = computed(() => {\r\n    return this.strategyService.formatTimeRemaining(this.secondsUntilFunding());\r\n  });\r\n\r\n  positionValue = computed(() => {\r\n    const margin = this.form?.get('margin')?.value || 100;\r\n    const leverage = this.form?.get('leverage')?.value || 10;\r\n    return margin * leverage;\r\n  });\r\n\r\n  // Helper to check if strategy type is 'precise'\r\n  isPreciseStrategy = computed(() => {\r\n    return this.form?.get('strategyType')?.value === 'precise';\r\n  });\r\n\r\n  ngOnInit(): void {\r\n    this.initializeTranslations();\r\n    this.initializeForm();\r\n  }\r\n\r\n  /**\r\n   * Initialize translations for dropdown options\r\n   */\r\n  private initializeTranslations(): void {\r\n    this.strategyTypeOptions = [\r\n      {\r\n        value: 'precise',\r\n        label: this.translate('bybitStrategy.type.precise'),\r\n      },\r\n      {\r\n        value: 'regular',\r\n        label: this.translate('bybitStrategy.type.regular'),\r\n      },\r\n    ];\r\n\r\n    this.positionSideOptions = [\r\n      {\r\n        value: 'Auto',\r\n        label: this.translate('bybitStrategy.side.auto'),\r\n      },\r\n      {\r\n        value: 'Buy',\r\n        label: this.translate('bybitStrategy.side.long'),\r\n      },\r\n      {\r\n        value: 'Sell',\r\n        label: this.translate('bybitStrategy.side.short'),\r\n      },\r\n    ];\r\n  }\r\n\r\n  /**\r\n   * Initialize the form with validators\r\n   */\r\n  private initializeForm(): void {\r\n    this.form = this.fb.group({\r\n      // Strategy configuration\r\n      strategyType: ['precise', [Validators.required]],\r\n\r\n      // Position settings\r\n      leverage: [10, [Validators.required, Validators.min(1), Validators.max(125)]],\r\n      margin: [100, [Validators.required, Validators.min(1)]],\r\n      positionSide: ['Auto', [Validators.required]],\r\n\r\n      // Risk management\r\n      takeProfitPercent: [90, [Validators.required, Validators.min(1), Validators.max(100)]],\r\n      stopLossPercent: [50, [Validators.required, Validators.min(1), Validators.max(100)]],\r\n\r\n      // Advanced settings (only for precise timing)\r\n      timingOffset: [20, [Validators.min(0), Validators.max(1000)]],\r\n      autoRepeat: [false],\r\n      enableWebSocketMonitoring: [true],\r\n    });\r\n  }\r\n\r\n\r\n  /**\r\n   * Format leverage value for slider display\r\n   */\r\n  formatLeverageLabel(value: number): string {\r\n    return `${value}x`;\r\n  }\r\n\r\n  /**\r\n   * Handle form submission\r\n   */\r\n  async onSubmit(): Promise<void> {\r\n    if (this.form.invalid || this.isSubmitting()) {\r\n      this.form.markAllAsTouched();\r\n      return;\r\n    }\r\n\r\n    this.isSubmitting.set(true);\r\n    this.errorMessage.set(null);\r\n    this.successMessage.set(null);\r\n\r\n    try {\r\n      const formValue = this.form.value;\r\n      const modalData = this.dataSignal();\r\n\r\n      const params: StartPreciseTimingStrategyRequest = {\r\n        symbol: modalData.symbol,\r\n        leverage: formValue.leverage,\r\n        margin: formValue.margin,\r\n        positionSide: formValue.positionSide,\r\n        takeProfitPercent: formValue.takeProfitPercent,\r\n        stopLossPercent: formValue.stopLossPercent,\r\n        timingOffset: formValue.timingOffset,\r\n        autoRepeat: formValue.autoRepeat,\r\n        enableWebSocketMonitoring: formValue.enableWebSocketMonitoring,\r\n        // Only include credentialId if provided (empty string means use active credential)\r\n        ...(modalData.credentialId && modalData.credentialId !== '' ? { credentialId: modalData.credentialId } : {})\r\n      };\r\n\r\n      if (formValue.strategyType === 'precise') {\r\n        await firstValueFrom(this.strategyService.startPreciseTimingStrategy(params));\r\n      } else {\r\n        // Convert to regular strategy params (side is required, not positionSide)\r\n        const regularParams = {\r\n          ...params,\r\n          side: params.positionSide === 'Auto' ? 'Buy' : params.positionSide,\r\n          executionDelay: 5,\r\n        };\r\n        delete (regularParams as any).positionSide;\r\n        delete (regularParams as any).timingOffset;\r\n\r\n        await firstValueFrom(this.strategyService.startRegularStrategy(regularParams as any));\r\n      }\r\n\r\n      // Success!\r\n      this.successMessage.set(this.translate('bybitStrategy.actions.success'));\r\n\r\n      // Emit strategy started event and close after short delay\r\n      console.log('[Modal] Strategy started successfully, waiting 1.5s before emitting events...');\r\n      setTimeout(() => {\r\n        console.log('[Modal] Emitting strategyStarted event');\r\n        this.strategyStarted.emit();\r\n        console.log('[Modal] Emitting close event');\r\n        this.close.emit();\r\n      }, 1500);\r\n\r\n    } catch (error: any) {\r\n      console.error('Failed to start strategy:', error);\r\n      this.errorMessage.set(error.message || this.translate('bybitStrategy.actions.error'));\r\n    } finally {\r\n      this.isSubmitting.set(false);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Close the modal without starting strategy\r\n   */\r\n  onCancel(): void {\r\n    this.close.emit();\r\n  }\r\n\r\n  /**\r\n   * Toggle advanced settings panel\r\n   */\r\n  toggleAdvancedSettings(): void {\r\n    this.showAdvancedSettings.update(val => !val);\r\n  }\r\n\r\n  /**\r\n   * Get form control error message\r\n   */\r\n  getErrorMessage(controlName: string): string {\r\n    const control = this.form.get(controlName);\r\n    if (!control || !control.errors) return '';\r\n\r\n    if (control.errors['required']) {\r\n      return this.translate('validation.required');\r\n    }\r\n    if (control.errors['min']) {\r\n      return this.translate('validation.minValue').replace('{value}', control.errors['min'].min);\r\n    }\r\n    if (control.errors['max']) {\r\n      return this.translate('validation.maxValue').replace('{value}', control.errors['max'].max);\r\n    }\r\n\r\n    return '';\r\n  }\r\n\r\n  /**\r\n   * Check if form control is invalid and touched\r\n   */\r\n  isFieldInvalid(controlName: string): boolean {\r\n    const control = this.form.get(controlName);\r\n    return !!(control && control.invalid && control.touched);\r\n  }\r\n\r\n  /**\r\n   * Translate a key using the translation service\r\n   */\r\n  translate(key: string): string {\r\n    return this.translationService.translate(key);\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\trading\\trade-history\\trade-history.component.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'inject' is defined but never used.","line":1,"column":77,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":83},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":112,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3308,3311],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3308,3311],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":117,"column":14,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":117,"endColumn":20},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exchange on an `any` value.","line":121,"column":14,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":121,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'duration' is assigned a value but never used.","line":276,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":276,"endColumn":19}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, OnInit, OnDestroy, signal, Input, Output, EventEmitter, inject } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { DialogComponent, DialogHeaderComponent, DialogTitleComponent, DialogContentComponent, DialogFooterComponent } from '../../ui/dialog/dialog.component';\r\nimport { ButtonComponent } from '../../ui/button/button.component';\r\nimport { CardComponent } from '../../ui/card/card.component';\r\nimport { SelectComponent } from '../../ui/select/select.component';\r\nimport { TradeHistoryService } from '../../../services/trade-history.service';\r\nimport { TradeHistoryRecord } from '../../../models/trade-history.model';\r\n\r\nexport interface TradeHistoryDialogData {\r\n  symbol?: string;\r\n  exchange?: string;\r\n}\r\n\r\n/**\r\n * Trade History Component\r\n *\r\n * Displays historical trading data with comprehensive statistics and filtering options.\r\n *\r\n * Features:\r\n * - Trade history table with sorting\r\n * - Real-time statistics (P&L, win rate, fees)\r\n * - Filter by symbol and exchange\r\n * - Responsive design\r\n * - Auto-refresh capability\r\n * - Uses reusable ui-dialog component for consistency\r\n */\r\n@Component({\r\n  selector: 'app-trade-history',\r\n  standalone: true,\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    DialogComponent,\r\n    DialogHeaderComponent,\r\n    DialogTitleComponent,\r\n    DialogContentComponent,\r\n    DialogFooterComponent,\r\n    ButtonComponent,\r\n    CardComponent,\r\n    SelectComponent\r\n  ],\r\n  templateUrl: './trade-history.component.html',\r\n  styleUrls: ['./trade-history.component.scss']\r\n})\r\nexport class TradeHistoryComponent implements OnInit, OnDestroy {\r\n  // Dialog state\r\n  @Input() set open(value: boolean) {\r\n    this._open.set(value);\r\n  }\r\n  get open() {\r\n    return this._open();\r\n  }\r\n  private _open = signal<boolean>(false);\r\n\r\n  @Input() initialSymbol = '';\r\n  @Input() initialExchange = '';\r\n  @Output() openChange = new EventEmitter<boolean>();\r\n  @Output() close = new EventEmitter<void>();\r\n\r\n  // Component state\r\n  displayedColumns: string[] = [\r\n    'symbol',\r\n    'exchange',\r\n    'positionType',\r\n    'executedAt',\r\n    'closedAt',\r\n    'entryPrice',\r\n    'exitPrice',\r\n    'pnl',\r\n    'funding',\r\n    'status'\r\n  ];\r\n\r\n  // Filters\r\n  selectedSymbol = '';\r\n  selectedExchange = '';\r\n  availableSymbols: string[] = [];\r\n  availableExchanges: string[] = ['BYBIT', 'BINGX', 'MEXC', 'BINANCE', 'OKX'];\r\n\r\n  // Auto-refresh\r\n  private refreshInterval?: number;\r\n  autoRefreshEnabled = false;\r\n\r\n  constructor(public tradeHistoryService: TradeHistoryService) {}\r\n\r\n  ngOnInit(): void {\r\n    console.log('[TradeHistoryComponent] Initializing...');\r\n\r\n    // Set initial filters from inputs if provided\r\n    if (this.initialSymbol) {\r\n      console.log('[TradeHistoryComponent] Opening with symbol:', this.initialSymbol);\r\n      this.selectedSymbol = this.initialSymbol;\r\n    }\r\n    if (this.initialExchange) {\r\n      console.log('[TradeHistoryComponent] Opening with exchange:', this.initialExchange);\r\n      this.selectedExchange = this.initialExchange;\r\n    }\r\n\r\n    this.loadTradeHistory();\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.stopAutoRefresh();\r\n  }\r\n\r\n  /**\r\n   * Load trade history from API\r\n   */\r\n  loadTradeHistory(): void {\r\n    const params: any = {\r\n      limit: 100\r\n    };\r\n\r\n    if (this.selectedSymbol) {\r\n      params.symbol = this.selectedSymbol;\r\n    }\r\n\r\n    if (this.selectedExchange) {\r\n      params.exchange = this.selectedExchange;\r\n    }\r\n\r\n    console.log('[TradeHistoryComponent] Loading trades with params:', params);\r\n\r\n    this.tradeHistoryService.getTradeHistory(params).subscribe({\r\n      next: (response) => {\r\n        console.log(`[TradeHistoryComponent] Loaded ${response.count} trades`);\r\n        this.updateAvailableFilters();\r\n      },\r\n      error: (error) => {\r\n        console.error('[TradeHistoryComponent] Error loading trades:', error);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Update available filter options based on loaded data\r\n   */\r\n  private updateAvailableFilters(): void {\r\n    const trades = this.tradeHistoryService.trades();\r\n\r\n    // Extract unique symbols\r\n    const symbols = new Set<string>();\r\n    trades.forEach(trade => symbols.add(trade.symbol));\r\n    this.availableSymbols = Array.from(symbols).sort();\r\n  }\r\n\r\n  /**\r\n   * Apply filters and reload data\r\n   */\r\n  applyFilters(): void {\r\n    console.log('[TradeHistoryComponent] Applying filters:', {\r\n      symbol: this.selectedSymbol,\r\n      exchange: this.selectedExchange\r\n    });\r\n    this.loadTradeHistory();\r\n  }\r\n\r\n  /**\r\n   * Clear all filters\r\n   */\r\n  clearFilters(): void {\r\n    this.selectedSymbol = '';\r\n    this.selectedExchange = '';\r\n    this.loadTradeHistory();\r\n  }\r\n\r\n  /**\r\n   * Refresh trade history\r\n   */\r\n  refresh(): void {\r\n    console.log('[TradeHistoryComponent] Refreshing trades...');\r\n    this.loadTradeHistory();\r\n  }\r\n\r\n  /**\r\n   * Toggle auto-refresh\r\n   */\r\n  toggleAutoRefresh(): void {\r\n    this.autoRefreshEnabled = !this.autoRefreshEnabled;\r\n\r\n    if (this.autoRefreshEnabled) {\r\n      this.startAutoRefresh();\r\n    } else {\r\n      this.stopAutoRefresh();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start auto-refresh (every 30 seconds)\r\n   */\r\n  private startAutoRefresh(): void {\r\n    this.stopAutoRefresh(); // Clear any existing interval\r\n\r\n    this.refreshInterval = window.setInterval(() => {\r\n      console.log('[TradeHistoryComponent] Auto-refreshing...');\r\n      this.loadTradeHistory();\r\n    }, 30000); // 30 seconds\r\n  }\r\n\r\n  /**\r\n   * Stop auto-refresh\r\n   */\r\n  private stopAutoRefresh(): void {\r\n    if (this.refreshInterval) {\r\n      clearInterval(this.refreshInterval);\r\n      this.refreshInterval = undefined;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Format timestamp to readable date\r\n   */\r\n  formatDate(date: string | null): string {\r\n    if (!date) return '-';\r\n\r\n    const d = new Date(date);\r\n    return d.toLocaleString('en-US', {\r\n      year: 'numeric',\r\n      month: 'short',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Format price with 2 decimals\r\n   */\r\n  formatPrice(price: number | null): string {\r\n    if (price === null || price === undefined) return '-';\r\n    return price.toFixed(2);\r\n  }\r\n\r\n  /**\r\n   * Format PnL with sign and color\r\n   */\r\n  formatPnl(pnl: number): { text: string; class: string } {\r\n    const formatted = this.tradeHistoryService.formatPnl(pnl);\r\n    return {\r\n      text: `${formatted.value} USDT`,\r\n      class: formatted.isPositive ? 'positive' : 'negative'\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get position type badge class\r\n   */\r\n  getPositionTypeClass(positionType: string | undefined): string {\r\n    if (!positionType) return '';\r\n    return positionType.toLowerCase() === 'long' ? 'long' : 'short';\r\n  }\r\n\r\n  /**\r\n   * Get status badge class\r\n   */\r\n  getStatusClass(status: string): string {\r\n    switch (status.toUpperCase()) {\r\n      case 'COMPLETED':\r\n        return 'completed';\r\n      case 'CANCELLED':\r\n        return 'cancelled';\r\n      case 'ERROR':\r\n        return 'error';\r\n      default:\r\n        return 'active';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Calculate trade duration in human-readable format\r\n   */\r\n  getTradeAdvice(trade: TradeHistoryRecord): string {\r\n    const pnl = trade.realizedPnl;\r\n    const duration = trade.duration || 0;\r\n\r\n    if (pnl > 10) {\r\n      return 'üéâ Great trade!';\r\n    } else if (pnl > 0) {\r\n      return '‚úÖ Profitable';\r\n    } else if (pnl < -10) {\r\n      return '‚ö†Ô∏è Large loss';\r\n    } else {\r\n      return '‚ùå Loss';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Export trades to CSV\r\n   */\r\n  exportToCSV(): void {\r\n    const trades = this.tradeHistoryService.trades();\r\n    if (trades.length === 0) {\r\n      console.warn('[TradeHistoryComponent] No trades to export');\r\n      return;\r\n    }\r\n\r\n    // CSV headers\r\n    const headers = [\r\n      'Symbol',\r\n      'Exchange',\r\n      'Position Type',\r\n      'Executed At',\r\n      'Closed At',\r\n      'Entry Price',\r\n      'Exit Price',\r\n      'Realized PnL',\r\n      'Funding Earned',\r\n      'Total Fees',\r\n      'Net Profit',\r\n      'Status'\r\n    ];\r\n\r\n    // CSV rows\r\n    const rows = trades.map(trade => [\r\n      trade.symbol,\r\n      trade.exchange,\r\n      trade.positionType,\r\n      trade.executedAt || '',\r\n      trade.closedAt || '',\r\n      trade.entryPrice,\r\n      trade.exitPrice || '',\r\n      trade.realizedPnl,\r\n      trade.fundingEarned,\r\n      ((trade.entryFee || 0) + (trade.exitFee || 0)),\r\n      (trade.realizedPnl - ((trade.entryFee || 0) + (trade.exitFee || 0))),\r\n      trade.status\r\n    ]);\r\n\r\n    // Combine headers and rows\r\n    const csvContent = [\r\n      headers.join(','),\r\n      ...rows.map(row => row.join(','))\r\n    ].join('\\n');\r\n\r\n    // Download file\r\n    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\r\n    const link = document.createElement('a');\r\n    const url = URL.createObjectURL(blob);\r\n\r\n    link.setAttribute('href', url);\r\n    link.setAttribute('download', `trade-history-${new Date().toISOString()}.csv`);\r\n    link.style.visibility = 'hidden';\r\n\r\n    document.body.appendChild(link);\r\n    link.click();\r\n    document.body.removeChild(link);\r\n\r\n    console.log('[TradeHistoryComponent] Exported trades to CSV');\r\n  }\r\n\r\n  /**\r\n   * Handle dialog open/close state changes\r\n   */\r\n  onDialogOpenChange(isOpen: boolean): void {\r\n    this._open.set(isOpen);\r\n    this.openChange.emit(isOpen);\r\n    if (!isOpen) {\r\n      this.close.emit();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Close the dialog\r\n   */\r\n  closeDialog(): void {\r\n    this._open.set(false);\r\n    this.openChange.emit(false);\r\n    this.close.emit();\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\trading\\trading-dashboard\\trading-dashboard.component.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'OrderRequest' is defined but never used.","line":14,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":15},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":75,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":94,"endColumn":7},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":96,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":96,"endColumn":92},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":105,"column":42,"nodeType":"Property","messageId":"anyAssignment","endLine":105,"endColumn":69},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":106,"column":40,"nodeType":"Property","messageId":"anyAssignment","endLine":106,"endColumn":71},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":138,"column":14,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":138,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .get on an `error` typed value.","line":138,"column":34,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":138,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .value on an `error` typed value.","line":138,"column":51,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":138,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":139,"column":14,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":139,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .get on an `error` typed value.","line":139,"column":34,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":139,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .value on an `error` typed value.","line":139,"column":49,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":139,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":140,"column":14,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":140,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .get on an `error` typed value.","line":140,"column":34,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":140,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .value on an `error` typed value.","line":140,"column":47,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":140,"endColumn":52},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":141,"column":14,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":141,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .get on an `error` typed value.","line":141,"column":34,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":141,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .value on an `error` typed value.","line":141,"column":47,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":141,"endColumn":52},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":142,"column":14,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":142,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .get on an `error` typed value.","line":142,"column":34,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":142,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .value on an `error` typed value.","line":142,"column":54,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":142,"endColumn":59},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an error typed value.","line":160,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":160,"endColumn":66},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":160,"column":31,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":160,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .get on an `error` typed value.","line":160,"column":51,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":160,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":161,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":161,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .setValue on an `error` typed value.","line":161,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":161,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .valid on an `error` typed value.","line":163,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":163,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .errors on an `error` typed value.","line":164,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":164,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an error typed value.","line":168,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":168,"endColumn":66},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":168,"column":31,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":168,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .get on an `error` typed value.","line":168,"column":51,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":168,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":169,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":169,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .setValue on an `error` typed value.","line":169,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":169,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .valid on an `error` typed value.","line":171,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":171,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .errors on an `error` typed value.","line":172,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":172,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":176,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":176,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .patchValue on an `error` typed value.","line":176,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":176,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an error typed value.","line":182,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":182,"endColumn":60},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":182,"column":28,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":182,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .get on an `error` typed value.","line":182,"column":48,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":182,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":183,"column":14,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":183,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .hasError on an `error` typed value.","line":183,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":183,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":187,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":187,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .patchValue on an `error` typed value.","line":187,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":187,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an error typed value.","line":193,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":193,"endColumn":60},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":193,"column":28,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":193,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .get on an `error` typed value.","line":193,"column":48,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":193,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":194,"column":14,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":194,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .hasError on an `error` typed value.","line":194,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":194,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an error typed value.","line":198,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":198,"endColumn":66},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":198,"column":31,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":198,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .get on an `error` typed value.","line":198,"column":51,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":198,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":199,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":199,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .setValue on an `error` typed value.","line":199,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":199,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .valid on an `error` typed value.","line":201,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":201,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .errors on an `error` typed value.","line":202,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":202,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an error typed value.","line":206,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":206,"endColumn":70},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":206,"column":33,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":206,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .get on an `error` typed value.","line":206,"column":53,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":206,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":207,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":207,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .setValue on an `error` typed value.","line":207,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":207,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .valid on an `error` typed value.","line":209,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":209,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .errors on an `error` typed value.","line":210,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":210,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":214,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":214,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .patchValue on an `error` typed value.","line":214,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":214,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .valid on an `error` typed value.","line":222,"column":34,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":222,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":226,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":226,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .patchValue on an `error` typed value.","line":226,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":226,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .valid on an `error` typed value.","line":235,"column":34,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":235,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":245,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":245,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .patchValue on an `error` typed value.","line":245,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":245,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":249,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":249,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":270,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":270,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .patchValue on an `error` typed value.","line":270,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":270,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":278,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":278,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":308,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":308,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .patchValue on an `error` typed value.","line":308,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":308,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":318,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":318,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":336,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":336,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .patchValue on an `error` typed value.","line":336,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":336,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":346,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":346,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":364,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":364,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .patchValue on an `error` typed value.","line":364,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":364,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":372,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":372,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":541,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":541,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .patchValue on an `error` typed value.","line":541,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":541,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":542,"column":14,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":542,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":544,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":544,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .patchValue on an `error` typed value.","line":544,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":544,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":545,"column":14,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":545,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":569,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":569,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":570,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":570,"endColumn":90},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":570,"column":29,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":570,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .querySelector on an `any` value.","line":570,"column":38,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":570,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":576,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":576,"endColumn":45},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'compiled' is assigned a value but never used.","line":576,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":576,"endColumn":21},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":578,"column":14,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":578,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .get on an `error` typed value.","line":578,"column":34,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":578,"endColumn":37}],"suppressedMessages":[],"errorCount":97,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { ComponentFixture, TestBed } from '@angular/core/testing';\r\nimport { HttpClientTestingModule } from '@angular/common/http/testing';\r\nimport { ReactiveFormsModule } from '@angular/forms';\r\nimport { of, throwError } from 'rxjs';\r\nimport { signal } from '@angular/core';\r\n\r\nimport { TradingDashboardComponent } from './trading-dashboard.component';\r\nimport { ManualTradingService } from '../../../services/manual-trading.service';\r\nimport { TranslationService } from '../../../services/translation.service';\r\nimport {\r\n  Position,\r\n  Order,\r\n  Balance,\r\n  OrderRequest,\r\n  OrderResponse\r\n} from '../../../models/trading.model';\r\n\r\ndescribe('TradingDashboardComponent', () => {\r\n  let component: TradingDashboardComponent;\r\n  let fixture: ComponentFixture<TradingDashboardComponent>;\r\n  let tradingService: jasmine.SpyObj<ManualTradingService>;\r\n  let translationService: jasmine.SpyObj<TranslationService>;\r\n\r\n  // Mock data\r\n  const mockPositions: Position[] = [\r\n    {\r\n      id: '1',\r\n      exchange: 'bybit',\r\n      symbol: 'BTCUSDT',\r\n      side: 'Buy',\r\n      size: 0.1,\r\n      entryPrice: 50000,\r\n      markPrice: 51000,\r\n      liquidationPrice: 45000,\r\n      leverage: 10,\r\n      unrealizedPnl: 100,\r\n      unrealizedPnlPercent: 2,\r\n      marginType: 'Cross',\r\n      positionMargin: 500,\r\n      createdAt: new Date(),\r\n      updatedAt: new Date()\r\n    }\r\n  ];\r\n\r\n  const mockOrders: Order[] = [\r\n    {\r\n      orderId: 'order-1',\r\n      exchange: 'bybit',\r\n      symbol: 'BTCUSDT',\r\n      side: 'Buy',\r\n      type: 'Limit',\r\n      quantity: 0.1,\r\n      price: 49000,\r\n      status: 'New',\r\n      timeInForce: 'GTC',\r\n      filledQuantity: 0,\r\n      createdAt: new Date(),\r\n      updatedAt: new Date()\r\n    }\r\n  ];\r\n\r\n  const mockBalance: Balance = {\r\n    exchange: 'bybit',\r\n    totalBalance: 10175,\r\n    availableBalance: 8675,\r\n    usedMargin: 1400,\r\n    unrealizedPnl: 175,\r\n    walletBalance: 10000,\r\n    currency: 'USDT',\r\n    updatedAt: new Date()\r\n  };\r\n\r\n  beforeEach(async () => {\r\n    // Create spy objects for services\r\n    const tradingServiceSpy = jasmine.createSpyObj('ManualTradingService', [\r\n      'placeOrder',\r\n      'getPositions',\r\n      'getOrders',\r\n      'getAccountBalance',\r\n      'closePosition',\r\n      'cancelOrder',\r\n      'getMockPositions',\r\n      'getMockOrders',\r\n      'getMockBalance',\r\n      'setupAutoRefresh'\r\n    ], {\r\n      isPlacingOrder: signal(false),\r\n      isLoadingPositions: signal(false),\r\n      isLoadingOrders: signal(false),\r\n      isLoadingBalance: signal(false),\r\n      positions$: of(mockPositions),\r\n      orders$: of(mockOrders),\r\n      balance$: of(mockBalance)\r\n    });\r\n\r\n    const translationServiceSpy = jasmine.createSpyObj('TranslationService', ['translate']);\r\n\r\n    await TestBed.configureTestingModule({\r\n      imports: [\r\n        TradingDashboardComponent,\r\n        HttpClientTestingModule,\r\n        ReactiveFormsModule\r\n      ],\r\n      providers: [\r\n        { provide: ManualTradingService, useValue: tradingServiceSpy },\r\n        { provide: TranslationService, useValue: translationServiceSpy }\r\n      ]\r\n    }).compileComponents();\r\n\r\n    tradingService = TestBed.inject(ManualTradingService) as jasmine.SpyObj<ManualTradingService>;\r\n    translationService = TestBed.inject(TranslationService) as jasmine.SpyObj<TranslationService>;\r\n\r\n    // Set up default spy returns\r\n    tradingService.getMockPositions.and.returnValue(mockPositions);\r\n    tradingService.getMockOrders.and.returnValue(mockOrders);\r\n    tradingService.getMockBalance.and.returnValue(mockBalance);\r\n    translationService.translate.and.returnValue('Translated Text');\r\n\r\n    fixture = TestBed.createComponent(TradingDashboardComponent);\r\n    component = fixture.componentInstance;\r\n  });\r\n\r\n  describe('Component Initialization', () => {\r\n    it('should create the component', () => {\r\n      expect(component).toBeTruthy();\r\n    });\r\n\r\n    it('should initialize with default values', () => {\r\n      expect(component.selectedExchange()).toBe('bybit');\r\n      expect(component.selectedSymbol()).toBe('BTCUSDT');\r\n      expect(component.autoRefreshEnabled()).toBe(false);\r\n    });\r\n\r\n    it('should initialize the order form with default values', () => {\r\n      fixture.detectChanges();\r\n\r\n      expect(component.orderForm).toBeDefined();\r\n      expect(component.orderForm.get('exchange')?.value).toBe('bybit');\r\n      expect(component.orderForm.get('symbol')?.value).toBe('BTCUSDT');\r\n      expect(component.orderForm.get('type')?.value).toBe('Market');\r\n      expect(component.orderForm.get('side')?.value).toBe('Buy');\r\n      expect(component.orderForm.get('timeInForce')?.value).toBe('GTC');\r\n    });\r\n\r\n    it('should load mock data on initialization', () => {\r\n      fixture.detectChanges();\r\n\r\n      expect(component.positions().length).toBeGreaterThan(0);\r\n      expect(component.orders().length).toBeGreaterThan(0);\r\n      expect(component.balance()).toBeTruthy();\r\n    });\r\n  });\r\n\r\n  describe('Order Form Validation', () => {\r\n    beforeEach(() => {\r\n      fixture.detectChanges();\r\n    });\r\n\r\n    it('should require quantity field', () => {\r\n      const quantityControl = component.orderForm.get('quantity');\r\n      quantityControl?.setValue(null);\r\n\r\n      expect(quantityControl?.valid).toBe(false);\r\n      expect(quantityControl?.errors?.['required']).toBe(true);\r\n    });\r\n\r\n    it('should validate quantity minimum value', () => {\r\n      const quantityControl = component.orderForm.get('quantity');\r\n      quantityControl?.setValue(0);\r\n\r\n      expect(quantityControl?.valid).toBe(false);\r\n      expect(quantityControl?.errors?.['min']).toBeTruthy();\r\n    });\r\n\r\n    it('should require price for limit orders', () => {\r\n      component.orderForm.patchValue({\r\n        type: 'Limit',\r\n        quantity: 0.1\r\n      });\r\n      fixture.detectChanges();\r\n\r\n      const priceControl = component.orderForm.get('price');\r\n      expect(priceControl?.hasError('required')).toBe(true);\r\n    });\r\n\r\n    it('should not require price for market orders', () => {\r\n      component.orderForm.patchValue({\r\n        type: 'Market',\r\n        quantity: 0.1\r\n      });\r\n      fixture.detectChanges();\r\n\r\n      const priceControl = component.orderForm.get('price');\r\n      expect(priceControl?.hasError('required')).toBeFalsy();\r\n    });\r\n\r\n    it('should validate stop loss minimum value', () => {\r\n      const stopLossControl = component.orderForm.get('stopLoss');\r\n      stopLossControl?.setValue(0);\r\n\r\n      expect(stopLossControl?.valid).toBe(false);\r\n      expect(stopLossControl?.errors?.['min']).toBeTruthy();\r\n    });\r\n\r\n    it('should validate take profit minimum value', () => {\r\n      const takeProfitControl = component.orderForm.get('takeProfit');\r\n      takeProfitControl?.setValue(0);\r\n\r\n      expect(takeProfitControl?.valid).toBe(false);\r\n      expect(takeProfitControl?.errors?.['min']).toBeTruthy();\r\n    });\r\n\r\n    it('should be valid with correct market order data', () => {\r\n      component.orderForm.patchValue({\r\n        exchange: 'bybit',\r\n        symbol: 'BTCUSDT',\r\n        type: 'Market',\r\n        side: 'Buy',\r\n        quantity: 0.1\r\n      });\r\n\r\n      expect(component.orderForm.valid).toBe(true);\r\n    });\r\n\r\n    it('should be valid with correct limit order data', () => {\r\n      component.orderForm.patchValue({\r\n        exchange: 'bybit',\r\n        symbol: 'BTCUSDT',\r\n        type: 'Limit',\r\n        side: 'Buy',\r\n        quantity: 0.1,\r\n        price: 50000\r\n      });\r\n\r\n      expect(component.orderForm.valid).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe('Place Order Functionality', () => {\r\n    beforeEach(() => {\r\n      fixture.detectChanges();\r\n    });\r\n\r\n    it('should not place order if form is invalid', () => {\r\n      component.orderForm.patchValue({\r\n        quantity: null // Invalid\r\n      });\r\n\r\n      component.placeOrder();\r\n\r\n      expect(tradingService.placeOrder).not.toHaveBeenCalled();\r\n    });\r\n\r\n    it('should place market order with valid data', () => {\r\n      const mockResponse: OrderResponse = {\r\n        orderId: 'test-order-1',\r\n        exchange: 'bybit',\r\n        symbol: 'BTCUSDT',\r\n        side: 'Buy',\r\n        type: 'Market',\r\n        quantity: 0.1,\r\n        status: 'Filled',\r\n        timeInForce: 'GTC',\r\n        createdAt: new Date(),\r\n        updatedAt: new Date()\r\n      };\r\n\r\n      tradingService.placeOrder.and.returnValue(of(mockResponse));\r\n\r\n      component.orderForm.patchValue({\r\n        exchange: 'bybit',\r\n        symbol: 'BTCUSDT',\r\n        type: 'Market',\r\n        side: 'Buy',\r\n        quantity: 0.1\r\n      });\r\n\r\n      component.placeOrder();\r\n\r\n      expect(tradingService.placeOrder).toHaveBeenCalledWith(\r\n        jasmine.objectContaining({\r\n          exchange: 'bybit',\r\n          symbol: 'BTCUSDT',\r\n          type: 'Market',\r\n          side: 'Buy',\r\n          quantity: 0.1\r\n        })\r\n      );\r\n    });\r\n\r\n    it('should place limit order with price', () => {\r\n      const mockResponse: OrderResponse = {\r\n        orderId: 'test-order-2',\r\n        exchange: 'bybit',\r\n        symbol: 'ETHUSDT',\r\n        side: 'Sell',\r\n        type: 'Limit',\r\n        quantity: 1,\r\n        price: 3000,\r\n        status: 'New',\r\n        timeInForce: 'GTC',\r\n        createdAt: new Date(),\r\n        updatedAt: new Date()\r\n      };\r\n\r\n      tradingService.placeOrder.and.returnValue(of(mockResponse));\r\n\r\n      component.orderForm.patchValue({\r\n        exchange: 'bybit',\r\n        symbol: 'ETHUSDT',\r\n        type: 'Limit',\r\n        side: 'Sell',\r\n        quantity: 1,\r\n        price: 3000,\r\n        timeInForce: 'GTC'\r\n      });\r\n\r\n      component.placeOrder();\r\n\r\n      expect(tradingService.placeOrder).toHaveBeenCalledWith(\r\n        jasmine.objectContaining({\r\n          exchange: 'bybit',\r\n          symbol: 'ETHUSDT',\r\n          type: 'Limit',\r\n          side: 'Sell',\r\n          quantity: 1,\r\n          price: 3000,\r\n          timeInForce: 'GTC'\r\n        })\r\n      );\r\n    });\r\n\r\n    it('should include stop loss and take profit if provided', () => {\r\n      tradingService.placeOrder.and.returnValue(of({} as OrderResponse));\r\n\r\n      component.orderForm.patchValue({\r\n        exchange: 'bybit',\r\n        symbol: 'BTCUSDT',\r\n        type: 'Market',\r\n        side: 'Buy',\r\n        quantity: 0.1,\r\n        stopLoss: 48000,\r\n        takeProfit: 52000\r\n      });\r\n\r\n      component.placeOrder();\r\n\r\n      expect(tradingService.placeOrder).toHaveBeenCalledWith(\r\n        jasmine.objectContaining({\r\n          stopLoss: 48000,\r\n          takeProfit: 52000\r\n        })\r\n      );\r\n    });\r\n\r\n    it('should handle order placement error', () => {\r\n      const errorMessage = 'Insufficient balance';\r\n      tradingService.placeOrder.and.returnValue(\r\n        throwError(() => new Error(errorMessage))\r\n      );\r\n\r\n      spyOn(console, 'error');\r\n\r\n      component.orderForm.patchValue({\r\n        exchange: 'bybit',\r\n        symbol: 'BTCUSDT',\r\n        type: 'Market',\r\n        side: 'Buy',\r\n        quantity: 0.1\r\n      });\r\n\r\n      component.placeOrder();\r\n\r\n      expect(console.error).toHaveBeenCalled();\r\n    });\r\n  });\r\n\r\n  describe('Position Management', () => {\r\n    beforeEach(() => {\r\n      fixture.detectChanges();\r\n    });\r\n\r\n    it('should close position when confirmed', () => {\r\n      spyOn(window, 'confirm').and.returnValue(true);\r\n      tradingService.closePosition.and.returnValue(of({} as OrderResponse));\r\n\r\n      const position = mockPositions[0];\r\n      component.closePosition(position);\r\n\r\n      expect(tradingService.closePosition).toHaveBeenCalledWith({\r\n        exchange: position.exchange,\r\n        symbol: position.symbol,\r\n        side: position.side\r\n      });\r\n    });\r\n\r\n    it('should not close position if not confirmed', () => {\r\n      spyOn(window, 'confirm').and.returnValue(false);\r\n\r\n      const position = mockPositions[0];\r\n      component.closePosition(position);\r\n\r\n      expect(tradingService.closePosition).not.toHaveBeenCalled();\r\n    });\r\n\r\n    it('should calculate total unrealized PnL correctly', () => {\r\n      component.positions.set([\r\n        { ...mockPositions[0], unrealizedPnl: 100 },\r\n        { ...mockPositions[0], id: '2', unrealizedPnl: 50 },\r\n        { ...mockPositions[0], id: '3', unrealizedPnl: -30 }\r\n      ]);\r\n\r\n      expect(component.totalUnrealizedPnl()).toBe(120);\r\n    });\r\n\r\n    it('should detect if there are open positions', () => {\r\n      component.positions.set(mockPositions);\r\n      expect(component.hasOpenPositions()).toBe(true);\r\n\r\n      component.positions.set([]);\r\n      expect(component.hasOpenPositions()).toBe(false);\r\n    });\r\n  });\r\n\r\n  describe('Order Management', () => {\r\n    beforeEach(() => {\r\n      fixture.detectChanges();\r\n    });\r\n\r\n    it('should cancel order when confirmed', () => {\r\n      spyOn(window, 'confirm').and.returnValue(true);\r\n      tradingService.cancelOrder.and.returnValue(of(void 0));\r\n\r\n      const order = mockOrders[0];\r\n      component.cancelOrder(order);\r\n\r\n      expect(tradingService.cancelOrder).toHaveBeenCalledWith({\r\n        exchange: order.exchange,\r\n        orderId: order.orderId,\r\n        symbol: order.symbol\r\n      });\r\n    });\r\n\r\n    it('should not cancel order if not confirmed', () => {\r\n      spyOn(window, 'confirm').and.returnValue(false);\r\n\r\n      const order = mockOrders[0];\r\n      component.cancelOrder(order);\r\n\r\n      expect(tradingService.cancelOrder).not.toHaveBeenCalled();\r\n    });\r\n\r\n    it('should not cancel order if status is not New', () => {\r\n      const filledOrder = { ...mockOrders[0], status: 'Filled' as const };\r\n      component.cancelOrder(filledOrder);\r\n\r\n      expect(tradingService.cancelOrder).not.toHaveBeenCalled();\r\n    });\r\n\r\n    it('should correctly identify cancellable orders', () => {\r\n      const newOrder = { ...mockOrders[0], status: 'New' as const };\r\n      const filledOrder = { ...mockOrders[0], status: 'Filled' as const };\r\n\r\n      expect(component.canCancelOrder(newOrder)).toBe(true);\r\n      expect(component.canCancelOrder(filledOrder)).toBe(false);\r\n    });\r\n\r\n    it('should detect if there are pending orders', () => {\r\n      component.orders.set([{ ...mockOrders[0], status: 'New' }]);\r\n      expect(component.hasPendingOrders()).toBe(true);\r\n\r\n      component.orders.set([{ ...mockOrders[0], status: 'Filled' }]);\r\n      expect(component.hasPendingOrders()).toBe(false);\r\n    });\r\n  });\r\n\r\n  describe('Auto-Refresh Functionality', () => {\r\n    beforeEach(() => {\r\n      fixture.detectChanges();\r\n    });\r\n\r\n    it('should toggle auto-refresh on', () => {\r\n      tradingService.setupAutoRefresh.and.returnValue(of(1));\r\n\r\n      expect(component.autoRefreshEnabled()).toBe(false);\r\n\r\n      component.toggleAutoRefresh();\r\n\r\n      expect(component.autoRefreshEnabled()).toBe(true);\r\n      expect(tradingService.setupAutoRefresh).toHaveBeenCalledWith('bybit', 10000);\r\n    });\r\n\r\n    it('should toggle auto-refresh off', () => {\r\n      tradingService.setupAutoRefresh.and.returnValue(of(1));\r\n\r\n      component.toggleAutoRefresh(); // Turn on\r\n      component.toggleAutoRefresh(); // Turn off\r\n\r\n      expect(component.autoRefreshEnabled()).toBe(false);\r\n    });\r\n  });\r\n\r\n  describe('Utility Methods', () => {\r\n    it('should return correct PnL class for positive value', () => {\r\n      expect(component.getPnlClass(100)).toBe('pnl-positive');\r\n    });\r\n\r\n    it('should return correct PnL class for negative value', () => {\r\n      expect(component.getPnlClass(-50)).toBe('pnl-negative');\r\n    });\r\n\r\n    it('should return correct PnL class for zero', () => {\r\n      expect(component.getPnlClass(0)).toBe('pnl-positive');\r\n    });\r\n\r\n    it('should return correct side class for Buy', () => {\r\n      expect(component.getSideClass('Buy')).toBe('side-buy');\r\n    });\r\n\r\n    it('should return correct side class for Sell', () => {\r\n      expect(component.getSideClass('Sell')).toBe('side-sell');\r\n    });\r\n\r\n    it('should format PnL with correct sign', () => {\r\n      expect(component.formatPnl(100)).toBe('+$100.00');\r\n      expect(component.formatPnl(-50)).toBe('-$50.00');\r\n      expect(component.formatPnl(0)).toBe('+$0.00');\r\n    });\r\n\r\n    it('should format PnL percentage correctly', () => {\r\n      expect(component.formatPnlPercent(2.5)).toBe('+2.50%');\r\n      expect(component.formatPnlPercent(-1.25)).toBe('-1.25%');\r\n    });\r\n\r\n    it('should format currency correctly', () => {\r\n      expect(component.formatCurrency(1234.56)).toBe('$1234.56');\r\n      expect(component.formatCurrency(0.01)).toBe('$0.01');\r\n    });\r\n\r\n    it('should detect limit order type', () => {\r\n      component.orderForm.patchValue({ type: 'Limit' });\r\n      expect(component.isLimitOrder()).toBe(true);\r\n\r\n      component.orderForm.patchValue({ type: 'Market' });\r\n      expect(component.isLimitOrder()).toBe(false);\r\n    });\r\n  });\r\n\r\n  describe('Component Cleanup', () => {\r\n    it('should unsubscribe on destroy', () => {\r\n      fixture.detectChanges();\r\n\r\n      spyOn(component['destroy$'], 'next');\r\n      spyOn(component['destroy$'], 'complete');\r\n\r\n      component.ngOnDestroy();\r\n\r\n      expect(component['destroy$'].next).toHaveBeenCalled();\r\n      expect(component['destroy$'].complete).toHaveBeenCalled();\r\n    });\r\n  });\r\n\r\n  describe('Accessibility', () => {\r\n    beforeEach(() => {\r\n      fixture.detectChanges();\r\n    });\r\n\r\n    it('should have proper ARIA labels on buttons', () => {\r\n      const compiled = fixture.nativeElement;\r\n      const refreshButton = compiled.querySelector('[aria-label=\"Refresh trading data\"]');\r\n\r\n      expect(refreshButton).toBeTruthy();\r\n    });\r\n\r\n    it('should have proper form labels', () => {\r\n      const compiled = fixture.nativeElement;\r\n      // Form labels are handled by ui-input and ui-select components\r\n      expect(component.orderForm.get('quantity')).toBeTruthy();\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\trading\\trading-dashboard\\trading-dashboard.component.ts","messages":[{"ruleId":"@angular-eslint/component-selector","severity":2,"message":"The selector should start with one of these prefixes: \"app\" (https://angular.dev/style-guide#style-02-07)","line":60,"column":13,"nodeType":"Literal","messageId":"prefixFailure","endLine":60,"endColumn":32},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":277,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":277,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10623,10626],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10623,10626],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":286,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":290,"endColumn":6}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, OnInit, OnDestroy, signal, computed, inject, effect } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { ReactiveFormsModule, FormsModule } from '@angular/forms';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Subject, takeUntil, Subscription } from 'rxjs';\r\n\r\n// UI Components\r\nimport { CardComponent, CardHeaderComponent, CardTitleComponent, CardContentComponent } from '../../ui/card/card.component';\r\nimport { ButtonComponent } from '../../ui/button/button.component';\r\nimport { SelectComponent, SelectOption } from '../../ui/select/select.component';\r\nimport { DropdownOption } from '../../ui/dropdown/dropdown.component';\r\nimport { InputComponent } from '../../ui/input/input.component';\r\nimport { TableComponent, TableColumn } from '../../ui/table/table.component';\r\nimport { LightweightChartComponent } from '../../lightweight-chart/lightweight-chart.component';\r\nimport { OrderFormComponent } from '../order-form/order-form.component';\r\n\r\n// Services\r\nimport { ManualTradingService } from '../../../services/manual-trading.service';\r\nimport { TranslationService } from '../../../services/translation.service';\r\nimport { ExchangeCredentialsService } from '../../../services/exchange-credentials.service';\r\nimport { BybitService } from '../../../services/bybit.service';\r\n\r\n// Models\r\nimport {\r\n  Exchange,\r\n  OrderRequest,\r\n  OrderSide,\r\n  Position,\r\n  Order,\r\n  Balance,\r\n  TradingSymbol\r\n} from '../../../models/trading.model';\r\nimport { ExchangeCredential, getExchangeName } from '../../../models/exchange-credentials.model';\r\n\r\n/**\r\n * Trading Dashboard Component\r\n *\r\n * Comprehensive manual trading interface for cryptocurrency exchanges.\r\n * Provides functionality for:\r\n * - Placing market and limit orders with advanced options\r\n * - Monitoring open positions with real-time PnL updates\r\n * - Viewing order history with filtering and pagination\r\n * - Tracking account balance and margin usage\r\n *\r\n * Features:\r\n * - Reactive forms with real-time validation\r\n * - Angular Signals for efficient state management\r\n * - Auto-refresh capability for real-time data\r\n * - Responsive design for all device sizes\r\n * - Comprehensive error handling and user feedback\r\n * - Accessibility support (ARIA labels, keyboard navigation)\r\n *\r\n * @example\r\n * Usage in template:\r\n * ```html\r\n * <trading-dashboard></trading-dashboard>\r\n * ```\r\n */\r\n@Component({\r\n  selector: 'trading-dashboard',\r\n  standalone: true,\r\n  imports: [\r\n    CommonModule,\r\n    ReactiveFormsModule,\r\n    FormsModule,\r\n    CardComponent,\r\n    CardHeaderComponent,\r\n    CardTitleComponent,\r\n    CardContentComponent,\r\n    ButtonComponent,\r\n    SelectComponent,\r\n    InputComponent,\r\n    TableComponent,\r\n    LightweightChartComponent,\r\n    OrderFormComponent\r\n  ],\r\n  templateUrl: './trading-dashboard.component.html',\r\n  styleUrls: ['./trading-dashboard.component.css']\r\n})\r\nexport class TradingDashboardComponent implements OnInit, OnDestroy {\r\n  // Injected services\r\n  private http = inject(HttpClient);\r\n  private tradingService = inject(ManualTradingService);\r\n  protected translationService = inject(TranslationService);\r\n  private credentialsService = inject(ExchangeCredentialsService);\r\n  private bybitService = inject(BybitService);\r\n\r\n  // Component lifecycle\r\n  private destroy$ = new Subject<void>();\r\n  private autoRefreshSubscription?: Subscription;\r\n\r\n  // State signals\r\n  private _selectedCredentialId = signal<string | null>(null);\r\n  private _selectedSymbol = signal<TradingSymbol>('BTCUSDT');\r\n  positions = signal<Position[]>([]);\r\n  orders = signal<Order[]>([]);\r\n  balance = signal<Balance | null>(null);\r\n  autoRefreshEnabled = signal<boolean>(false);\r\n\r\n  // Symbol options for dropdown\r\n  symbolOptions = signal<DropdownOption[]>([]);\r\n  isLoadingSymbols = signal<boolean>(false);\r\n\r\n  // Getters and setters for ngModel binding\r\n  get selectedCredentialId() { return this._selectedCredentialId(); }\r\n  set selectedCredentialId(value: string | null) { this._selectedCredentialId.set(value); }\r\n\r\n  get selectedSymbol() { return this._selectedSymbol(); }\r\n  set selectedSymbol(value: TradingSymbol) { this._selectedSymbol.set(value); }\r\n\r\n  // Credentials from service\r\n  credentials = this.credentialsService.credentials;\r\n  isLoadingCredentials = this.credentialsService.loading;\r\n\r\n  // Computed signals\r\n  totalUnrealizedPnl = computed(() => {\r\n    return this.positions().reduce((sum, pos) => sum + pos.unrealizedPnl, 0);\r\n  });\r\n\r\n  hasOpenPositions = computed(() => this.positions().length > 0);\r\n  hasPendingOrders = computed(() => this.orders().some(o => o.status === 'New'));\r\n\r\n  // Computed signal for credential dropdown options\r\n  credentialOptions = computed((): DropdownOption[] => {\r\n    return this.credentials()\r\n      .filter(cred => cred.isActive)\r\n      .map(cred => ({\r\n        value: cred.id,\r\n        label: this.formatCredentialLabel(cred)\r\n      }));\r\n  });\r\n\r\n  // Get selected credential object\r\n  selectedCredential = computed(() => {\r\n    const credId = this._selectedCredentialId();\r\n    if (!credId) return null;\r\n    return this.credentials().find(c => c.id === credId) ?? null;\r\n  });\r\n\r\n  // Get selected exchange from credential\r\n  selectedExchange = computed(() => {\r\n    const cred = this.selectedCredential();\r\n    return cred ? cred.exchange.toLowerCase() as Exchange : null;\r\n  });\r\n\r\n  // Get chart symbol with exchange prefix (computed)\r\n  private _chartSymbol = computed(() => {\r\n    const cred = this.selectedCredential();\r\n    const symbol = this._selectedSymbol();\r\n\r\n    if (!cred || !symbol) return '';\r\n\r\n    // Map exchange to TradingView exchange code\r\n    const exchangeMap: Record<string, string> = {\r\n      'BYBIT': 'BYBIT',\r\n      'BINANCE': 'BINANCE',\r\n      'OKX': 'OKX',\r\n      'COINBASE': 'COINBASE'\r\n    };\r\n\r\n    const exchangeCode = exchangeMap[cred.exchange.toUpperCase()] || 'BYBIT';\r\n    return `${exchangeCode}:${symbol}`;\r\n  });\r\n\r\n  // Regular property for chart binding (updated via effect)\r\n  chartSymbol = '';\r\n\r\n  // Loading and error states from service\r\n  isPlacingOrder = this.tradingService.isPlacingOrder;\r\n  isLoadingPositions = this.tradingService.isLoadingPositions;\r\n  isLoadingOrders = this.tradingService.isLoadingOrders;\r\n  isLoadingBalance = this.tradingService.isLoadingBalance;\r\n\r\n  // Table columns\r\n  positionsColumns: TableColumn[] = [\r\n    { key: 'symbol', label: this.translate('trading.table.symbol'), sortable: true },\r\n    { key: 'side', label: this.translate('trading.table.side'), sortable: true },\r\n    { key: 'size', label: this.translate('trading.table.size'), sortable: true, type: 'number', align: 'right' },\r\n    { key: 'entryPrice', label: this.translate('trading.table.entryPrice'), sortable: true, type: 'currency', align: 'right' },\r\n    { key: 'markPrice', label: this.translate('trading.table.markPrice'), sortable: true, type: 'currency', align: 'right' },\r\n    { key: 'unrealizedPnl', label: this.translate('trading.table.unrealizedPnl'), sortable: true, type: 'currency', align: 'right' },\r\n    { key: 'leverage', label: this.translate('trading.table.leverage'), sortable: true, type: 'number', align: 'center' },\r\n    { key: 'actions', label: this.translate('trading.table.actions'), sortable: false, align: 'center' }\r\n  ];\r\n\r\n  ordersColumns: TableColumn[] = [\r\n    { key: 'symbol', label: this.translate('trading.table.symbol'), sortable: true },\r\n    { key: 'type', label: this.translate('trading.table.type'), sortable: true },\r\n    { key: 'side', label: this.translate('trading.table.side'), sortable: true },\r\n    { key: 'quantity', label: this.translate('trading.table.quantity'), sortable: true, type: 'number', align: 'right' },\r\n    { key: 'price', label: this.translate('trading.table.price'), sortable: true, type: 'currency', align: 'right' },\r\n    { key: 'status', label: this.translate('trading.table.status'), sortable: true },\r\n    { key: 'createdAt', label: this.translate('trading.table.time'), sortable: true, type: 'date' },\r\n    { key: 'actions', label: this.translate('trading.table.actions'), sortable: false, align: 'center' }\r\n  ];\r\n\r\n  // Pagination\r\n  currentPage = signal<number>(1);\r\n  pageSize = signal<number>(10);\r\n\r\n  constructor() {\r\n    // No form initialization needed - using OrderFormComponent\r\n\r\n    // Effect to sync computed chartSymbol to property for change detection\r\n    effect(() => {\r\n      const newSymbol = this._chartSymbol();\r\n      if (newSymbol && newSymbol !== this.chartSymbol) {\r\n        console.log('Chart symbol changed:', this.chartSymbol, '->', newSymbol);\r\n        this.chartSymbol = newSymbol;\r\n      }\r\n    });\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    // Load credentials first\r\n    this.credentialsService.fetchCredentials().subscribe({\r\n      next: () => {\r\n        // Auto-select first active credential if available\r\n        const firstActive = this.credentialOptions()[0];\r\n        if (firstActive) {\r\n          this._selectedCredentialId.set(firstActive.value);\r\n          this.loadTradingSymbols();\r\n        }\r\n        this.loadMockData();\r\n      },\r\n      error: (err) => console.error('Failed to load credentials:', err)\r\n    });\r\n\r\n    // Subscribe to cached data from service\r\n    this.tradingService.positions$\r\n      .pipe(takeUntil(this.destroy$))\r\n      .subscribe(positions => this.positions.set(positions));\r\n\r\n    this.tradingService.orders$\r\n      .pipe(takeUntil(this.destroy$))\r\n      .subscribe(orders => this.orders.set(orders));\r\n\r\n    this.tradingService.balance$\r\n      .pipe(takeUntil(this.destroy$))\r\n      .subscribe(balance => this.balance.set(balance));\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.destroy$.next();\r\n    this.destroy$.complete();\r\n    this.stopAutoRefresh();\r\n  }\r\n\r\n  /**\r\n   * Load all trading data (positions, orders, balance)\r\n   */\r\n  loadAllData(): void {\r\n    const exchange = this.selectedExchange();\r\n    if (!exchange) return;\r\n\r\n    // For development, use mock data\r\n    // In production, uncomment the following:\r\n    // this.tradingService.getPositions(exchange).subscribe();\r\n    // this.tradingService.getOrders(exchange).subscribe();\r\n    // this.tradingService.getAccountBalance(exchange).subscribe();\r\n\r\n    this.loadMockData();\r\n  }\r\n\r\n  /**\r\n   * Load mock data for development/testing\r\n   */\r\n  private loadMockData(): void {\r\n    this.positions.set(this.tradingService.getMockPositions());\r\n    this.orders.set(this.tradingService.getMockOrders());\r\n    this.balance.set(this.tradingService.getMockBalance());\r\n  }\r\n\r\n  /**\r\n   * Handle order placed from OrderFormComponent\r\n   */\r\n  handleOrderPlaced(orderRequest: any): void {\r\n    const credential = this.selectedCredential();\r\n\r\n    if (!credential) {\r\n      console.error('No credential selected');\r\n      return;\r\n    }\r\n\r\n    // Add credential and exchange to order request\r\n    const completeOrderRequest: OrderRequest = {\r\n      ...orderRequest,\r\n      exchange: credential.exchange.toLowerCase() as Exchange,\r\n      credentialId: credential.id\r\n    };\r\n\r\n    this.tradingService.placeOrder(completeOrderRequest).subscribe({\r\n      next: (response) => {\r\n        console.log('Order placed successfully:', response);\r\n        this.loadAllData();\r\n        // TODO: Show success toast notification\r\n      },\r\n      error: (error) => {\r\n        console.error('Failed to place order:', error);\r\n        // TODO: Show error toast notification\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Close a position\r\n   */\r\n  closePosition(position: Position): void {\r\n    if (confirm(this.translate('trading.confirmClosePosition'))) {\r\n      this.tradingService.closePosition({\r\n        exchange: position.exchange,\r\n        symbol: position.symbol,\r\n        side: position.side\r\n      }).subscribe({\r\n        next: () => {\r\n          console.log('Position closed successfully');\r\n          this.loadAllData();\r\n          // TODO: Show success toast notification\r\n        },\r\n        error: (error) => {\r\n          console.error('Failed to close position:', error);\r\n          // TODO: Show error toast notification\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Cancel an order\r\n   */\r\n  cancelOrder(order: Order): void {\r\n    if (order.status !== 'New') {\r\n      return;\r\n    }\r\n\r\n    if (confirm(this.translate('trading.confirmCancelOrder'))) {\r\n      this.tradingService.cancelOrder({\r\n        exchange: order.exchange,\r\n        orderId: order.orderId,\r\n        symbol: order.symbol\r\n      }).subscribe({\r\n        next: () => {\r\n          console.log('Order cancelled successfully');\r\n          this.loadAllData();\r\n          // TODO: Show success toast notification\r\n        },\r\n        error: (error) => {\r\n          console.error('Failed to cancel order:', error);\r\n          // TODO: Show error toast notification\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Refresh all data manually\r\n   */\r\n  refreshData(): void {\r\n    this.loadAllData();\r\n  }\r\n\r\n  /**\r\n   * Toggle auto-refresh\r\n   */\r\n  toggleAutoRefresh(): void {\r\n    const enabled = !this.autoRefreshEnabled();\r\n    this.autoRefreshEnabled.set(enabled);\r\n\r\n    if (enabled) {\r\n      this.startAutoRefresh();\r\n    } else {\r\n      this.stopAutoRefresh();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start auto-refresh\r\n   */\r\n  private startAutoRefresh(): void {\r\n    const exchange = this.selectedExchange();\r\n    if (!exchange) return;\r\n\r\n    this.autoRefreshSubscription = this.tradingService\r\n      .setupAutoRefresh(exchange, 10000) // Refresh every 10 seconds\r\n      .pipe(takeUntil(this.destroy$))\r\n      .subscribe();\r\n  }\r\n\r\n  /**\r\n   * Stop auto-refresh\r\n   */\r\n  private stopAutoRefresh(): void {\r\n    this.autoRefreshSubscription?.unsubscribe();\r\n  }\r\n\r\n  /**\r\n   * Get CSS class for PnL value (green for profit, red for loss)\r\n   */\r\n  getPnlClass(pnl: number): string {\r\n    return pnl >= 0 ? 'pnl-positive' : 'pnl-negative';\r\n  }\r\n\r\n  /**\r\n   * Get CSS class for order side (green for buy, red for sell)\r\n   */\r\n  getSideClass(side: OrderSide): string {\r\n    return side === 'Buy' ? 'side-buy' : 'side-sell';\r\n  }\r\n\r\n  /**\r\n   * Format PnL value with + or - sign\r\n   */\r\n  formatPnl(pnl: number): string {\r\n    const sign = pnl >= 0 ? '+' : '';\r\n    return `${sign}$${pnl.toFixed(2)}`;\r\n  }\r\n\r\n  /**\r\n   * Format PnL percentage\r\n   */\r\n  formatPnlPercent(percent: number): string {\r\n    const sign = percent >= 0 ? '+' : '';\r\n    return `${sign}${percent.toFixed(2)}%`;\r\n  }\r\n\r\n  /**\r\n   * Check if order can be cancelled\r\n   */\r\n  canCancelOrder(order: Order): boolean {\r\n    return order.status === 'New';\r\n  }\r\n\r\n  /**\r\n   * Translate a key using the translation service\r\n   */\r\n  protected translate(key: string): string {\r\n    return this.translationService.translate(key);\r\n  }\r\n\r\n  /**\r\n   * Format date for display\r\n   */\r\n  formatDate(date: Date): string {\r\n    return new Date(date).toLocaleString();\r\n  }\r\n\r\n  /**\r\n   * Format currency value\r\n   */\r\n  formatCurrency(value: number): string {\r\n    return `$${value.toFixed(2)}`;\r\n  }\r\n\r\n  /**\r\n   * Format credential label for dropdown\r\n   */\r\n  private formatCredentialLabel(credential: ExchangeCredential): string {\r\n    const exchangeName = getExchangeName(credential.exchange);\r\n    const label = credential.label ? ` - ${credential.label}` : '';\r\n    return `${exchangeName}${label}`;\r\n  }\r\n\r\n  /**\r\n   * Handle credential change from dropdown\r\n   */\r\n  onCredentialChange(credentialId: string): void {\r\n    console.log('Credential changed to:', credentialId);\r\n    this._selectedCredentialId.set(credentialId);\r\n\r\n    const cred = this.selectedCredential();\r\n    console.log('Selected credential:', cred);\r\n    console.log('Chart symbol before load:', this.chartSymbol);\r\n\r\n    this.loadTradingSymbols();\r\n    this.loadAllData();\r\n\r\n    // Log after a brief delay to see if computed updated\r\n    setTimeout(() => {\r\n      console.log('Chart symbol after change:', this.chartSymbol);\r\n    }, 100);\r\n  }\r\n\r\n  /**\r\n   * Handle symbol change from dropdown\r\n   */\r\n  onSymbolChange(symbol: TradingSymbol): void {\r\n    this._selectedSymbol.set(symbol);\r\n    // Chart will update automatically via binding\r\n  }\r\n\r\n  /**\r\n   * Load trading symbols for selected exchange\r\n   */\r\n  private loadTradingSymbols(): void {\r\n    const exchange = this.selectedExchange();\r\n    if (!exchange) {\r\n      this.symbolOptions.set([]);\r\n      return;\r\n    }\r\n\r\n    this.isLoadingSymbols.set(true);\r\n\r\n    this.tradingService.getSymbols(exchange).subscribe({\r\n      next: (symbols) => {\r\n        const options = symbols.map(s => ({\r\n          value: s.symbol as TradingSymbol,\r\n          label: s.symbol\r\n        }));\r\n        this.symbolOptions.set(options);\r\n        this.isLoadingSymbols.set(false);\r\n\r\n        // Auto-select BTCUSDT if available, otherwise first symbol\r\n        const btcOption = options.find(opt => opt.value === 'BTCUSDT');\r\n        if (btcOption) {\r\n          this._selectedSymbol.set('BTCUSDT');\r\n        } else if (options.length > 0) {\r\n          this._selectedSymbol.set(options[0].value);\r\n        }\r\n      },\r\n      error: (error) => {\r\n        console.error('Failed to load trading symbols:', error);\r\n        // Fallback to default popular trading pairs\r\n        this.loadDefaultSymbols();\r\n        this.isLoadingSymbols.set(false);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Load default trading symbols as fallback\r\n   */\r\n  private loadDefaultSymbols(): void {\r\n    const defaultSymbols: SelectOption[] = [\r\n      { value: 'BTCUSDT', label: 'BTCUSDT' },\r\n      { value: 'ETHUSDT', label: 'ETHUSDT' },\r\n      { value: 'BNBUSDT', label: 'BNBUSDT' },\r\n      { value: 'SOLUSDT', label: 'SOLUSDT' },\r\n      { value: 'XRPUSDT', label: 'XRPUSDT' },\r\n      { value: 'ADAUSDT', label: 'ADAUSDT' },\r\n      { value: 'DOGEUSDT', label: 'DOGEUSDT' },\r\n      { value: 'MATICUSDT', label: 'MATICUSDT' },\r\n      { value: 'DOTUSDT', label: 'DOTUSDT' },\r\n      { value: 'AVAXUSDT', label: 'AVAXUSDT' }\r\n    ];\r\n\r\n    this.symbolOptions.set(defaultSymbols);\r\n    this._selectedSymbol.set('BTCUSDT');\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\ui\\button\\button.component.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'signal' is defined but never used.","line":1,"column":50,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":56},{"ruleId":"@angular-eslint/component-selector","severity":2,"message":"The selector should start with one of these prefixes: \"app\" (https://angular.dev/style-guide#style-02-07)","line":34,"column":13,"nodeType":"Literal","messageId":"prefixFailure","endLine":34,"endColumn":24}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, Input, Output, EventEmitter, signal, computed, inject } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { ThemeService } from '../../../services/theme.service';\r\n\r\nexport type ButtonVariant = 'primary' | 'secondary' | 'tertiary' | 'danger' | 'warning' | 'link' | 'ghost';\r\nexport type ButtonSize = 'small' | 'medium' | 'large';\r\n\r\n/**\r\n * Custom Button Component\r\n *\r\n * Features:\r\n * - Theme support (light/dark mode)\r\n * - Multiple variants (primary, secondary, tertiary, danger, link, ghost)\r\n * - Multiple sizes (small, medium, large)\r\n * - Loading state with spinner\r\n * - Disabled state\r\n * - Icon-only mode\r\n * - Full-width mode\r\n * - Custom className support\r\n *\r\n * @example\r\n * ```html\r\n * <ui-button\r\n *   variant=\"primary\"\r\n *   size=\"medium\"\r\n *   [loading]=\"isLoading\"\r\n *   [disabled]=\"isDisabled\"\r\n *   (clicked)=\"handleClick()\">\r\n *   Click Me\r\n * </ui-button>\r\n * ```\r\n */\r\n@Component({\r\n  selector: 'ui-button',\r\n  standalone: true,\r\n  imports: [CommonModule],\r\n  templateUrl: './button.component.html',\r\n  styleUrl: './button.component.scss'\r\n})\r\nexport class ButtonComponent {\r\n  @Input() variant: ButtonVariant = 'primary';\r\n  @Input() size: ButtonSize = 'medium';\r\n  @Input() disabled = false;\r\n  @Input() loading = false;\r\n  @Input() iconOnly = false;\r\n  @Input() fullWidth = false;\r\n  @Input() type: 'button' | 'submit' | 'reset' = 'button';\r\n  @Input() className = '';\r\n\r\n  @Output() clicked = new EventEmitter<Event>();\r\n\r\n  // Inject theme service\r\n  private themeService = inject(ThemeService);\r\n  isDarkMode = computed(() => this.themeService.isDark());\r\n\r\n  /**\r\n   * Handle button click\r\n   */\r\n  handleClick(event: Event): void {\r\n    if (this.disabled || this.loading) {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n      return;\r\n    }\r\n    this.clicked.emit(event);\r\n  }\r\n\r\n  /**\r\n   * Get button classes\r\n   */\r\n  getButtonClasses(): string {\r\n    const classes = [\r\n      'ui-button',\r\n      `ui-button--${this.variant}`,\r\n      `ui-button--${this.size}`,\r\n      this.isDarkMode() ? 'ui-button--dark' : 'ui-button--light'\r\n    ];\r\n\r\n    if (this.disabled) classes.push('ui-button--disabled');\r\n    if (this.loading) classes.push('ui-button--loading');\r\n    if (this.iconOnly) classes.push('ui-button--icon-only');\r\n    if (this.fullWidth) classes.push('ui-button--full-width');\r\n    if (this.className) classes.push(this.className);\r\n\r\n    return classes.join(' ');\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\ui\\card\\card.component.ts","messages":[{"ruleId":"@angular-eslint/component-selector","severity":2,"message":"The selector should start with one of these prefixes: \"app\" (https://angular.dev/style-guide#style-02-07)","line":5,"column":13,"nodeType":"Literal","messageId":"prefixFailure","endLine":5,"endColumn":22},{"ruleId":"@angular-eslint/component-selector","severity":2,"message":"The selector should start with one of these prefixes: \"app\" (https://angular.dev/style-guide#style-02-07)","line":31,"column":13,"nodeType":"Literal","messageId":"prefixFailure","endLine":31,"endColumn":29},{"ruleId":"@angular-eslint/component-selector","severity":2,"message":"The selector should start with one of these prefixes: \"app\" (https://angular.dev/style-guide#style-02-07)","line":40,"column":13,"nodeType":"Literal","messageId":"prefixFailure","endLine":40,"endColumn":28},{"ruleId":"@angular-eslint/component-selector","severity":2,"message":"The selector should start with one of these prefixes: \"app\" (https://angular.dev/style-guide#style-02-07)","line":49,"column":13,"nodeType":"Literal","messageId":"prefixFailure","endLine":49,"endColumn":31},{"ruleId":"@angular-eslint/component-selector","severity":2,"message":"The selector should start with one of these prefixes: \"app\" (https://angular.dev/style-guide#style-02-07)","line":58,"column":13,"nodeType":"Literal","messageId":"prefixFailure","endLine":58,"endColumn":30},{"ruleId":"@angular-eslint/component-selector","severity":2,"message":"The selector should start with one of these prefixes: \"app\" (https://angular.dev/style-guide#style-02-07)","line":67,"column":13,"nodeType":"Literal","messageId":"prefixFailure","endLine":67,"endColumn":30}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, Input } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\n@Component({\r\n  selector: 'ui-card',\r\n  standalone: true,\r\n  imports: [CommonModule],\r\n  templateUrl: './card.component.html',\r\n  styleUrls: ['./card.component.css']\r\n})\r\nexport class CardComponent {\r\n  @Input() variant: 'default' | 'outlined' | 'elevated' = 'default';\r\n  @Input() padding: 'none' | 'small' | 'medium' | 'large' = 'medium';\r\n  @Input() hover = false;\r\n\r\n  getCardClasses(): string {\r\n    const classes = ['card'];\r\n\r\n    classes.push(`card-${this.variant}`);\r\n    classes.push(`card-padding-${this.padding}`);\r\n\r\n    if (this.hover) {\r\n      classes.push('card-hover');\r\n    }\r\n\r\n    return classes.join(' ');\r\n  }\r\n}\r\n\r\n@Component({\r\n  selector: 'ui-card-header',\r\n  standalone: true,\r\n  imports: [CommonModule],\r\n  templateUrl: './card-header.component.html',\r\n  styleUrls: ['./card-header.component.css']\r\n})\r\nexport class CardHeaderComponent {}\r\n\r\n@Component({\r\n  selector: 'ui-card-title',\r\n  standalone: true,\r\n  imports: [CommonModule],\r\n  templateUrl: './card-title.component.html',\r\n  styleUrls: ['./card-title.component.css']\r\n})\r\nexport class CardTitleComponent {}\r\n\r\n@Component({\r\n  selector: 'ui-card-subtitle',\r\n  standalone: true,\r\n  imports: [CommonModule],\r\n  templateUrl: './card-subtitle.component.html',\r\n  styleUrls: ['./card-subtitle.component.css']\r\n})\r\nexport class CardSubtitleComponent {}\r\n\r\n@Component({\r\n  selector: 'ui-card-content',\r\n  standalone: true,\r\n  imports: [CommonModule],\r\n  templateUrl: './card-content.component.html',\r\n  styleUrls: ['./card-content.component.css']\r\n})\r\nexport class CardContentComponent {}\r\n\r\n@Component({\r\n  selector: 'ui-card-actions',\r\n  standalone: true,\r\n  imports: [CommonModule],\r\n  templateUrl: './card-actions.component.html',\r\n  styleUrls: ['./card-actions.component.css']\r\n})\r\nexport class CardActionsComponent {}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\ui\\confirmation-modal\\confirmation-modal.component.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'DebugElement' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":22},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":13,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":13,"endColumn":92},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":18,"column":40,"nodeType":"Property","messageId":"anyAssignment","endLine":18,"endColumn":71},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'params' is defined but never used.","line":27,"column":61,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":67},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .textContent on an `any` value.","line":188,"column":43,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":188,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .disabled on an `any` value.","line":234,"column":41,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":234,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .loading on an `any` value.","line":244,"column":46,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":244,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":255,"column":14,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":255,"endColumn":59},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .textContent on an `any` value.","line":255,"column":43,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":255,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .textContent on an `any` value.","line":264,"column":43,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":264,"endColumn":54}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { ComponentFixture, TestBed } from '@angular/core/testing';\r\nimport { ConfirmationModalComponent } from './confirmation-modal.component';\r\nimport { TranslationService } from '../../../services/translation.service';\r\nimport { DebugElement } from '@angular/core';\r\nimport { By } from '@angular/platform-browser';\r\n\r\ndescribe('ConfirmationModalComponent', () => {\r\n  let component: ConfirmationModalComponent;\r\n  let fixture: ComponentFixture<ConfirmationModalComponent>;\r\n  let translationService: jasmine.SpyObj<TranslationService>;\r\n\r\n  beforeEach(async () => {\r\n    const translationServiceSpy = jasmine.createSpyObj('TranslationService', ['translate']);\r\n\r\n    await TestBed.configureTestingModule({\r\n      imports: [ConfirmationModalComponent],\r\n      providers: [\r\n        { provide: TranslationService, useValue: translationServiceSpy }\r\n      ]\r\n    }).compileComponents();\r\n\r\n    fixture = TestBed.createComponent(ConfirmationModalComponent);\r\n    component = fixture.componentInstance;\r\n    translationService = TestBed.inject(TranslationService) as jasmine.SpyObj<TranslationService>;\r\n\r\n    // Set up default translation mock\r\n    translationService.translate.and.callFake((key: string, params?: Record<string, string>) => {\r\n      const translations: Record<string, string> = {\r\n        'modal.confirmTitle': 'Confirm Action',\r\n        'modal.confirm': 'Confirm',\r\n        'modal.cancel': 'Cancel'\r\n      };\r\n      return translations[key] || key;\r\n    });\r\n  });\r\n\r\n  it('should create', () => {\r\n    expect(component).toBeTruthy();\r\n  });\r\n\r\n  describe('Component Initialization', () => {\r\n    it('should initialize with default values', () => {\r\n      expect(component.open).toBe(false);\r\n      expect(component.title).toBe('');\r\n      expect(component.message).toBe('');\r\n      expect(component.confirmText).toBe('');\r\n      expect(component.cancelText).toBe('');\r\n      expect(component.confirmVariant).toBe('primary');\r\n      expect(component.loading).toBe(false);\r\n    });\r\n\r\n    it('should accept input properties', () => {\r\n      component.open = true;\r\n      component.title = 'Delete Item';\r\n      component.message = 'Are you sure?';\r\n      component.confirmText = 'Delete';\r\n      component.cancelText = 'No';\r\n      component.confirmVariant = 'danger';\r\n      component.loading = true;\r\n\r\n      fixture.detectChanges();\r\n\r\n      expect(component.open).toBe(true);\r\n      expect(component.title).toBe('Delete Item');\r\n      expect(component.message).toBe('Are you sure?');\r\n      expect(component.confirmText).toBe('Delete');\r\n      expect(component.cancelText).toBe('No');\r\n      expect(component.confirmVariant).toBe('danger');\r\n      expect(component.loading).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe('Text Methods', () => {\r\n    it('should return confirmText when provided', () => {\r\n      component.confirmText = 'Delete';\r\n      expect(component.getConfirmText()).toBe('Delete');\r\n    });\r\n\r\n    it('should return translated confirm text when not provided', () => {\r\n      component.confirmText = '';\r\n      expect(component.getConfirmText()).toBe('Confirm');\r\n      expect(translationService.translate).toHaveBeenCalledWith('modal.confirm', undefined);\r\n    });\r\n\r\n    it('should return cancelText when provided', () => {\r\n      component.cancelText = 'No';\r\n      expect(component.getCancelText()).toBe('No');\r\n    });\r\n\r\n    it('should return translated cancel text when not provided', () => {\r\n      component.cancelText = '';\r\n      expect(component.getCancelText()).toBe('Cancel');\r\n      expect(translationService.translate).toHaveBeenCalledWith('modal.cancel', undefined);\r\n    });\r\n\r\n    it('should return title when provided', () => {\r\n      component.title = 'Custom Title';\r\n      expect(component.getTitle()).toBe('Custom Title');\r\n    });\r\n\r\n    it('should return translated title when not provided', () => {\r\n      component.title = '';\r\n      expect(component.getTitle()).toBe('Confirm Action');\r\n      expect(translationService.translate).toHaveBeenCalledWith('modal.confirmTitle', undefined);\r\n    });\r\n  });\r\n\r\n  describe('Confirm Action', () => {\r\n    it('should emit confirm event when confirm is clicked', () => {\r\n      spyOn(component.confirm, 'emit');\r\n      component.loading = false;\r\n\r\n      component.onConfirm();\r\n\r\n      expect(component.confirm.emit).toHaveBeenCalled();\r\n    });\r\n\r\n    it('should not emit confirm event when loading is true', () => {\r\n      spyOn(component.confirm, 'emit');\r\n      component.loading = true;\r\n\r\n      component.onConfirm();\r\n\r\n      expect(component.confirm.emit).not.toHaveBeenCalled();\r\n    });\r\n  });\r\n\r\n  describe('Cancel Action', () => {\r\n    it('should emit cancel event and close modal when cancel is clicked', () => {\r\n      spyOn(component.cancel, 'emit');\r\n      spyOn(component.openChange, 'emit');\r\n      component.loading = false;\r\n      component.open = true;\r\n\r\n      component.onCancel();\r\n\r\n      expect(component.cancel.emit).toHaveBeenCalled();\r\n      expect(component.open).toBe(false);\r\n      expect(component.openChange.emit).toHaveBeenCalledWith(false);\r\n    });\r\n\r\n    it('should not emit cancel event when loading is true', () => {\r\n      spyOn(component.cancel, 'emit');\r\n      component.loading = true;\r\n      component.open = true;\r\n\r\n      component.onCancel();\r\n\r\n      expect(component.cancel.emit).not.toHaveBeenCalled();\r\n      expect(component.open).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe('Dialog Close', () => {\r\n    it('should emit cancel event and close modal when dialog is closed', () => {\r\n      spyOn(component.cancel, 'emit');\r\n      spyOn(component.openChange, 'emit');\r\n      component.loading = false;\r\n      component.open = true;\r\n\r\n      component.onDialogClose();\r\n\r\n      expect(component.cancel.emit).toHaveBeenCalled();\r\n      expect(component.open).toBe(false);\r\n      expect(component.openChange.emit).toHaveBeenCalledWith(false);\r\n    });\r\n\r\n    it('should not close modal when loading is true', () => {\r\n      spyOn(component.cancel, 'emit');\r\n      component.loading = true;\r\n      component.open = true;\r\n\r\n      component.onDialogClose();\r\n\r\n      expect(component.cancel.emit).not.toHaveBeenCalled();\r\n      expect(component.open).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe('Accessibility', () => {\r\n    it('should display message text', () => {\r\n      component.open = true;\r\n      component.message = 'Are you sure you want to delete this item?';\r\n      fixture.detectChanges();\r\n\r\n      const messageElement = fixture.debugElement.query(By.css('.confirmation-message'));\r\n      expect(messageElement).toBeTruthy();\r\n      expect(messageElement.nativeElement.textContent).toContain('Are you sure you want to delete this item?');\r\n    });\r\n\r\n    it('should have keyboard-accessible buttons', () => {\r\n      component.open = true;\r\n      fixture.detectChanges();\r\n\r\n      const buttons = fixture.debugElement.queryAll(By.css('ui-button'));\r\n      expect(buttons.length).toBe(2);\r\n    });\r\n  });\r\n\r\n  describe('Variant Styles', () => {\r\n    it('should apply primary variant to confirm button', () => {\r\n      component.open = true;\r\n      component.confirmVariant = 'primary';\r\n      fixture.detectChanges();\r\n\r\n      expect(component.confirmVariant).toBe('primary');\r\n    });\r\n\r\n    it('should apply danger variant to confirm button', () => {\r\n      component.open = true;\r\n      component.confirmVariant = 'danger';\r\n      fixture.detectChanges();\r\n\r\n      expect(component.confirmVariant).toBe('danger');\r\n    });\r\n\r\n    it('should apply warning variant to confirm button', () => {\r\n      component.open = true;\r\n      component.confirmVariant = 'warning';\r\n      fixture.detectChanges();\r\n\r\n      expect(component.confirmVariant).toBe('warning');\r\n    });\r\n  });\r\n\r\n  describe('Loading State', () => {\r\n    it('should disable buttons when loading is true', () => {\r\n      component.open = true;\r\n      component.loading = true;\r\n      fixture.detectChanges();\r\n\r\n      const buttons = fixture.debugElement.queryAll(By.css('ui-button'));\r\n      buttons.forEach(button => {\r\n        expect(button.componentInstance.disabled).toBe(true);\r\n      });\r\n    });\r\n\r\n    it('should show loading state on confirm button', () => {\r\n      component.open = true;\r\n      component.loading = true;\r\n      fixture.detectChanges();\r\n\r\n      const confirmButton = fixture.debugElement.queryAll(By.css('ui-button'))[1];\r\n      expect(confirmButton.componentInstance.loading).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe('Edge Cases', () => {\r\n    it('should handle empty message', () => {\r\n      component.open = true;\r\n      component.message = '';\r\n      fixture.detectChanges();\r\n\r\n      const messageElement = fixture.debugElement.query(By.css('.confirmation-message'));\r\n      expect(messageElement.nativeElement.textContent.trim()).toBe('');\r\n    });\r\n\r\n    it('should handle very long message', () => {\r\n      component.open = true;\r\n      component.message = 'A'.repeat(500);\r\n      fixture.detectChanges();\r\n\r\n      const messageElement = fixture.debugElement.query(By.css('.confirmation-message'));\r\n      expect(messageElement.nativeElement.textContent).toBe('A'.repeat(500));\r\n    });\r\n\r\n    it('should handle rapid open/close', () => {\r\n      spyOn(component.openChange, 'emit');\r\n\r\n      component.open = true;\r\n      fixture.detectChanges();\r\n\r\n      component.onCancel();\r\n      expect(component.open).toBe(false);\r\n\r\n      component.open = true;\r\n      fixture.detectChanges();\r\n\r\n      component.onCancel();\r\n      expect(component.open).toBe(false);\r\n\r\n      expect(component.openChange.emit).toHaveBeenCalledTimes(2);\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\ui\\confirmation-modal\\confirmation-modal.component.ts","messages":[{"ruleId":"@angular-eslint/component-selector","severity":2,"message":"The selector should start with one of these prefixes: \"app\" (https://angular.dev/style-guide#style-02-07)","line":8,"column":13,"nodeType":"Literal","messageId":"prefixFailure","endLine":8,"endColumn":36}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, Input, Output, EventEmitter, inject } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { DialogComponent } from '../dialog/dialog.component';\r\nimport { ButtonComponent } from '../button/button.component';\r\nimport { TranslationService } from '../../../services/translation.service';\r\n\r\n@Component({\r\n  selector: 'ui-confirmation-modal',\r\n  standalone: true,\r\n  imports: [CommonModule, DialogComponent, ButtonComponent],\r\n  templateUrl: './confirmation-modal.component.html',\r\n  styleUrls: ['./confirmation-modal.component.css']\r\n})\r\nexport class ConfirmationModalComponent {\r\n  @Input() open = false;\r\n  @Input() title = '';\r\n  @Input() message = '';\r\n  @Input() confirmText = '';\r\n  @Input() cancelText = '';\r\n  @Input() confirmVariant: 'primary' | 'danger' | 'warning' = 'primary';\r\n  @Input() loading = false;\r\n\r\n  @Output() openChange = new EventEmitter<boolean>();\r\n  @Output() confirm = new EventEmitter<void>();\r\n  @Output() cancel = new EventEmitter<void>();\r\n\r\n  protected translationService = inject(TranslationService);\r\n\r\n  translate(key: string, params?: Record<string, string>): string {\r\n    return this.translationService.translate(key, params);\r\n  }\r\n\r\n  onConfirm(): void {\r\n    if (!this.loading) {\r\n      this.confirm.emit();\r\n    }\r\n  }\r\n\r\n  onCancel(): void {\r\n    if (!this.loading) {\r\n      this.cancel.emit();\r\n      this.closeModal();\r\n    }\r\n  }\r\n\r\n  onDialogClose(): void {\r\n    if (!this.loading) {\r\n      this.cancel.emit();\r\n      this.closeModal();\r\n    }\r\n  }\r\n\r\n  private closeModal(): void {\r\n    this.open = false;\r\n    this.openChange.emit(false);\r\n  }\r\n\r\n  getConfirmText(): string {\r\n    return this.confirmText || this.translate('modal.confirm');\r\n  }\r\n\r\n  getCancelText(): string {\r\n    return this.cancelText || this.translate('modal.cancel');\r\n  }\r\n\r\n  getTitle(): string {\r\n    return this.title || this.translate('modal.confirmTitle');\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\ui\\dialog\\dialog.component.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'state' is defined but never used.","line":16,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":24},{"ruleId":"@angular-eslint/component-selector","severity":2,"message":"The selector should start with one of these prefixes: \"app\" (https://angular.dev/style-guide#style-02-07)","line":32,"column":13,"nodeType":"Literal","messageId":"prefixFailure","endLine":32,"endColumn":24},{"ruleId":"@angular-eslint/component-selector","severity":2,"message":"The selector should start with one of these prefixes: \"app\" (https://angular.dev/style-guide#style-02-07)","line":287,"column":13,"nodeType":"Literal","messageId":"prefixFailure","endLine":287,"endColumn":31},{"ruleId":"@angular-eslint/component-selector","severity":2,"message":"The selector should start with one of these prefixes: \"app\" (https://angular.dev/style-guide#style-02-07)","line":296,"column":13,"nodeType":"Literal","messageId":"prefixFailure","endLine":296,"endColumn":30},{"ruleId":"@angular-eslint/component-selector","severity":2,"message":"The selector should start with one of these prefixes: \"app\" (https://angular.dev/style-guide#style-02-07)","line":305,"column":13,"nodeType":"Literal","messageId":"prefixFailure","endLine":305,"endColumn":32},{"ruleId":"@angular-eslint/component-selector","severity":2,"message":"The selector should start with one of these prefixes: \"app\" (https://angular.dev/style-guide#style-02-07)","line":314,"column":13,"nodeType":"Literal","messageId":"prefixFailure","endLine":314,"endColumn":31}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\r\n  Component,\r\n  Input,\r\n  Output,\r\n  EventEmitter,\r\n  OnInit,\r\n  OnDestroy,\r\n  OnChanges,\r\n  SimpleChanges,\r\n  inject,\r\n  ElementRef,\r\n  ViewChild,\r\n  AfterViewInit\r\n} from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { trigger, state, style, transition, animate } from '@angular/animations';\r\nimport { TranslationService } from '../../../services/translation.service';\r\n\r\n/**\r\n * Professional Dialog Component\r\n *\r\n * A fully accessible, theme-aware modal dialog component with:\r\n * - Smooth animations (fade-in overlay, slide-up content)\r\n * - Focus trap for keyboard navigation\r\n * - ESC key to close\r\n * - Backdrop click to close\r\n * - Mobile-responsive with bottom sheet on small screens\r\n * - Light/dark theme support using CSS variables\r\n * - WCAG 2.1 AA compliant accessibility\r\n */\r\n@Component({\r\n  selector: 'ui-dialog',\r\n  standalone: true,\r\n  imports: [CommonModule],\r\n  templateUrl: './dialog.component.html',\r\n  styleUrls: ['./dialog.component.css'],\r\n  animations: [\r\n    trigger('fadeIn', [\r\n      transition(':enter', [\r\n        style({ opacity: 0 }),\r\n        animate('250ms cubic-bezier(0.4, 0, 0.2, 1)', style({ opacity: 1 }))\r\n      ]),\r\n      transition(':leave', [\r\n        animate('200ms cubic-bezier(0.4, 0, 0.2, 1)', style({ opacity: 0 }))\r\n      ])\r\n    ]),\r\n    trigger('slideUp', [\r\n      transition(':enter', [\r\n        style({ opacity: 0, transform: 'translateY(20px) scale(0.96)' }),\r\n        animate('300ms cubic-bezier(0.4, 0, 0.2, 1)', style({ opacity: 1, transform: 'translateY(0) scale(1)' }))\r\n      ]),\r\n      transition(':leave', [\r\n        animate('200ms cubic-bezier(0.4, 0, 0.2, 1)', style({ opacity: 0, transform: 'translateY(20px) scale(0.96)' }))\r\n      ])\r\n    ])\r\n  ]\r\n})\r\nexport class DialogComponent implements OnInit, OnDestroy, OnChanges, AfterViewInit {\r\n  @Input() open = false;\r\n  @Input() title = '';\r\n  @Input() size: 'small' | 'medium' | 'large' | 'xlarge' | 'fullscreen' = 'medium';\r\n  @Input() closable = true;\r\n  @Input() closeOnBackdrop = true;\r\n  @Input() showHeader = true;\r\n  @Input() showFooter = false;\r\n\r\n  @Output() openChange = new EventEmitter<boolean>();\r\n  @Output() close = new EventEmitter<void>();\r\n\r\n  @ViewChild('dialogElement') dialogElement?: ElementRef;\r\n\r\n  // Inject TranslationService\r\n  protected translationService = inject(TranslationService);\r\n\r\n  private previousActiveElement: HTMLElement | null = null;\r\n  private focusableElements: HTMLElement[] = [];\r\n  private scrollbarWidth = 0;\r\n\r\n  translate(key: string): string {\r\n    return this.translationService.translate(key);\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    if (this.open) {\r\n      this.calculateScrollbarWidth();\r\n      this.addBodyClass();\r\n      this.addEscapeListener();\r\n      this.saveFocusState();\r\n    }\r\n  }\r\n\r\n  ngAfterViewInit(): void {\r\n    if (this.open) {\r\n      setTimeout(() => this.setInitialFocus(), 0);\r\n    }\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.removeBodyClass();\r\n    this.removeEscapeListener();\r\n    this.restoreFocusState();\r\n  }\r\n\r\n  ngOnChanges(changes: SimpleChanges): void {\r\n    if (changes['open']) {\r\n      if (this.open) {\r\n        this.calculateScrollbarWidth();\r\n        this.addBodyClass();\r\n        this.addEscapeListener();\r\n        this.saveFocusState();\r\n        setTimeout(() => this.setInitialFocus(), 100);\r\n      } else {\r\n        this.removeBodyClass();\r\n        this.removeEscapeListener();\r\n        this.restoreFocusState();\r\n      }\r\n    }\r\n  }\r\n\r\n  onBackdropClick(event: Event): void {\r\n    if (this.closeOnBackdrop && event.target === event.currentTarget) {\r\n      this.closeDialog();\r\n    }\r\n  }\r\n\r\n  onCloseClick(): void {\r\n    if (this.closable) {\r\n      this.closeDialog();\r\n    }\r\n  }\r\n\r\n  private closeDialog(): void {\r\n    this.open = false;\r\n    this.openChange.emit(false);\r\n    this.close.emit();\r\n  }\r\n\r\n  /**\r\n   * Handle keyboard events for accessibility\r\n   */\r\n  private handleEscape = (event: KeyboardEvent): void => {\r\n    if (event.key === 'Escape' && this.open && this.closable) {\r\n      event.preventDefault();\r\n      this.closeDialog();\r\n    }\r\n\r\n    // Focus trap - Tab navigation\r\n    if (event.key === 'Tab' && this.open) {\r\n      this.handleTabKey(event);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Implement focus trap for keyboard navigation\r\n   */\r\n  private handleTabKey(event: KeyboardEvent): void {\r\n    this.updateFocusableElements();\r\n\r\n    if (this.focusableElements.length === 0) return;\r\n\r\n    const firstElement = this.focusableElements[0];\r\n    const lastElement = this.focusableElements[this.focusableElements.length - 1];\r\n\r\n    if (event.shiftKey) {\r\n      // Shift + Tab: move focus backwards\r\n      if (document.activeElement === firstElement) {\r\n        event.preventDefault();\r\n        lastElement.focus();\r\n      }\r\n    } else {\r\n      // Tab: move focus forwards\r\n      if (document.activeElement === lastElement) {\r\n        event.preventDefault();\r\n        firstElement.focus();\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update list of focusable elements within the dialog\r\n   */\r\n  private updateFocusableElements(): void {\r\n    const dialog = document.querySelector('.dialog');\r\n    if (!dialog) return;\r\n\r\n    const focusableSelectors = [\r\n      'button:not([disabled])',\r\n      'a[href]',\r\n      'input:not([disabled])',\r\n      'select:not([disabled])',\r\n      'textarea:not([disabled])',\r\n      '[tabindex]:not([tabindex=\"-1\"])',\r\n      '[contenteditable=\"true\"]'\r\n    ].join(', ');\r\n\r\n    this.focusableElements = Array.from(\r\n      dialog.querySelectorAll<HTMLElement>(focusableSelectors)\r\n    ).filter(el => {\r\n      return el.offsetParent !== null && // Element is visible\r\n             !el.hasAttribute('disabled') &&\r\n             el.tabIndex !== -1;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Set initial focus when dialog opens\r\n   */\r\n  private setInitialFocus(): void {\r\n    this.updateFocusableElements();\r\n\r\n    if (this.focusableElements.length > 0) {\r\n      // Focus the first focusable element (usually the close button or first input)\r\n      this.focusableElements[0].focus();\r\n    } else {\r\n      // If no focusable elements, focus the dialog itself\r\n      const dialog = document.querySelector('.dialog') as HTMLElement;\r\n      if (dialog) {\r\n        dialog.focus();\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Save the currently focused element before opening dialog\r\n   */\r\n  private saveFocusState(): void {\r\n    this.previousActiveElement = document.activeElement as HTMLElement;\r\n  }\r\n\r\n  /**\r\n   * Restore focus to the previously focused element after closing dialog\r\n   */\r\n  private restoreFocusState(): void {\r\n    if (this.previousActiveElement && this.previousActiveElement.focus) {\r\n      setTimeout(() => {\r\n        this.previousActiveElement?.focus();\r\n        this.previousActiveElement = null;\r\n      }, 0);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Calculate scrollbar width to prevent layout shift\r\n   */\r\n  private calculateScrollbarWidth(): void {\r\n    const outer = document.createElement('div');\r\n    outer.style.visibility = 'hidden';\r\n    outer.style.overflow = 'scroll';\r\n    document.body.appendChild(outer);\r\n\r\n    const inner = document.createElement('div');\r\n    outer.appendChild(inner);\r\n\r\n    this.scrollbarWidth = outer.offsetWidth - inner.offsetWidth;\r\n    document.body.removeChild(outer);\r\n  }\r\n\r\n  private addEscapeListener(): void {\r\n    document.addEventListener('keydown', this.handleEscape);\r\n  }\r\n\r\n  private removeEscapeListener(): void {\r\n    document.removeEventListener('keydown', this.handleEscape);\r\n  }\r\n\r\n  private addBodyClass(): void {\r\n    document.body.classList.add('dialog-open');\r\n    // Prevent layout shift by adding padding equal to scrollbar width\r\n    if (this.scrollbarWidth > 0) {\r\n      document.body.style.paddingRight = `${this.scrollbarWidth}px`;\r\n    }\r\n  }\r\n\r\n  private removeBodyClass(): void {\r\n    document.body.classList.remove('dialog-open');\r\n    document.body.style.paddingRight = '';\r\n  }\r\n\r\n  getDialogClasses(): string {\r\n    const classes = ['dialog'];\r\n    classes.push(`dialog-${this.size}`);\r\n    return classes.join(' ');\r\n  }\r\n}\r\n\r\n@Component({\r\n  selector: 'ui-dialog-header',\r\n  standalone: true,\r\n  imports: [CommonModule],\r\n  templateUrl: './dialog-header.component.html',\r\n  styleUrls: ['./dialog-header.component.css']\r\n})\r\nexport class DialogHeaderComponent {}\r\n\r\n@Component({\r\n  selector: 'ui-dialog-title',\r\n  standalone: true,\r\n  imports: [CommonModule],\r\n  templateUrl: './dialog-title.component.html',\r\n  styleUrls: ['./dialog-title.component.css']\r\n})\r\nexport class DialogTitleComponent {}\r\n\r\n@Component({\r\n  selector: 'ui-dialog-content',\r\n  standalone: true,\r\n  imports: [CommonModule],\r\n  templateUrl: './dialog-content.component.html',\r\n  styleUrls: ['./dialog-content.component.css']\r\n})\r\nexport class DialogContentComponent {}\r\n\r\n@Component({\r\n  selector: 'ui-dialog-footer',\r\n  standalone: true,\r\n  imports: [CommonModule],\r\n  templateUrl: './dialog-footer.component.html',\r\n  styleUrls: ['./dialog-footer.component.css']\r\n})\r\nexport class DialogFooterComponent {}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\ui\\dropdown\\dropdown.component.html","messages":[{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":4,"column":5,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":4,"endColumn":54},{"ruleId":"@angular-eslint/template/click-events-have-key-events","severity":2,"message":"click must be accompanied by either keyup, keydown or keypress event for accessibility.","line":72,"column":13,"nodeType":null,"messageId":"clickEventsHaveKeyEvents","endLine":85,"endColumn":19},{"ruleId":"@angular-eslint/template/interactive-supports-focus","severity":2,"message":"Elements with interaction handlers must be focusable.","line":72,"column":13,"nodeType":null,"messageId":"interactiveSupportsFocus","endLine":85,"endColumn":19}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<div class=\"dropdown-wrapper\" [class.dropdown-disabled]=\"disabled\">\r\n  <!-- Label -->\r\n  @if (label) {\r\n    <label class=\"dropdown-label\">{{ label }}</label>\r\n  }\r\n\r\n  <!-- Dropdown Trigger -->\r\n  <button\r\n    type=\"button\"\r\n    class=\"dropdown-trigger\"\r\n    [class.dropdown-open]=\"isOpen()\"\r\n    [class.dropdown-small]=\"size === 'small'\"\r\n    [class.dropdown-medium]=\"size === 'medium'\"\r\n    [class.dropdown-large]=\"size === 'large'\"\r\n    [class.width-normal]=\"width === 'normal'\"\r\n    [class.width-medium]=\"width === 'medium'\"\r\n    [class.width-wide]=\"width === 'wide'\"\r\n    [class.dropdown-dark]=\"isDark()\"\r\n    [disabled]=\"disabled\"\r\n    (click)=\"toggle()\"\r\n    (keydown)=\"onKeyDown($event)\"\r\n    [attr.aria-expanded]=\"isOpen()\"\r\n    [attr.aria-haspopup]=\"true\">\r\n    <span class=\"dropdown-value\">\r\n      @if (selectedOption()) {\r\n        <span class=\"dropdown-selected\">\r\n          @if (selectedOption()?.icon) {\r\n            <span class=\"dropdown-icon\">{{ selectedOption()?.icon }}</span>\r\n          }\r\n          <span [innerHTML]=\"(selectedOption()?.label ?? '') | safeHtml\"></span>\r\n        </span>\r\n      } @else {\r\n        <span class=\"dropdown-placeholder\">{{ placeholder }}</span>\r\n      }\r\n    </span>\r\n    <span class=\"dropdown-arrow\" [class.dropdown-arrow-up]=\"isOpen()\">‚ñº</span>\r\n    @if (selectedValue() && !disabled && showClearButton) {\r\n      <button\r\n        type=\"button\"\r\n        class=\"dropdown-clear\"\r\n        (click)=\"clearSelection($event)\"\r\n        aria-label=\"Clear selection\">\r\n        ‚úï\r\n      </button>\r\n    }\r\n  </button>\r\n\r\n  <!-- Dropdown Panel -->\r\n  @if (isOpen()) {\r\n    <div class=\"dropdown-panel\" [class.dropdown-dark]=\"isDark()\">\r\n      <!-- Search Input -->\r\n      @if (searchable) {\r\n        <div class=\"dropdown-search\">\r\n          <input\r\n            #searchInput\r\n            type=\"text\"\r\n            class=\"dropdown-search-input\"\r\n            [placeholder]=\"searchPlaceholder\"\r\n            [(ngModel)]=\"searchQuery\"\r\n            (ngModelChange)=\"onSearchChange($event)\"\r\n            (keydown)=\"onKeyDown($event)\"\r\n            autocomplete=\"off\">\r\n        </div>\r\n      }\r\n\r\n      <!-- Options List -->\r\n      <div class=\"dropdown-options\">\r\n        @if (filteredOptions().length === 0) {\r\n          <div class=\"dropdown-empty\">No options found</div>\r\n        } @else {\r\n          @for (option of filteredOptions(); track option.value; let i = $index) {\r\n            <div\r\n              class=\"option\"\r\n              [class.option-selected]=\"isSelected(option)\"\r\n              [class.option-highlighted]=\"isHighlighted(i)\"\r\n              [class.option-disabled]=\"option.disabled\"\r\n              (click)=\"selectOption(option)\"\r\n              (mouseenter)=\"onOptionHover(i)\"\r\n              role=\"option\"\r\n              [attr.aria-selected]=\"isSelected(option)\">\r\n              @if (option.icon) {\r\n                <span class=\"option-icon\">{{ option.icon }}</span>\r\n              }\r\n              <span class=\"option-label\" [innerHTML]=\"option.label | safeHtml\"></span>\r\n            </div>\r\n          }\r\n        }\r\n      </div>\r\n    </div>\r\n  }\r\n</div>\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\ui\\dropdown\\dropdown.component.ts","messages":[{"ruleId":"@angular-eslint/component-selector","severity":2,"message":"The selector should start with one of these prefixes: \"app\" (https://angular.dev/style-guide#style-02-07)","line":39,"column":13,"nodeType":"Literal","messageId":"prefixFailure","endLine":39,"endColumn":26},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":95,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2968,2971],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2968,2971],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-empty-function","severity":2,"message":"Unexpected empty method 'onChange'.","line":95,"column":50,"nodeType":"ArrowFunctionExpression","messageId":"unexpected","endLine":95,"endColumn":52,"suggestions":[{"messageId":"suggestComment","data":{"name":"method 'onChange'"},"fix":{"range":[2990,2990],"text":" /* empty */ "},"desc":"Add comment inside empty method 'onChange'."}]},{"ruleId":"@typescript-eslint/no-empty-function","severity":2,"message":"Unexpected empty method 'onTouched'.","line":96,"column":41,"nodeType":"ArrowFunctionExpression","messageId":"unexpected","endLine":96,"endColumn":43,"suggestions":[{"messageId":"suggestComment","data":{"name":"method 'onTouched'"},"fix":{"range":[3035,3035],"text":" /* empty */ "},"desc":"Add comment inside empty method 'onTouched'."}]},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":107,"column":16,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":107,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .contains on an `any` value.","line":107,"column":46,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":107,"endColumn":54},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":124,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3749,3752],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3749,3752],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":128,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3829,3832],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3829,3832],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":129,"column":5,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":129,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":132,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3899,3902],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3899,3902],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":133,"column":5,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":133,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":240,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":240,"endColumn":95},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":240,"column":29,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":240,"endColumn":72},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .querySelector on an `any` value.","line":240,"column":59,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":240,"endColumn":72},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":242,"column":9,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":242,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .scrollIntoView on an `any` value.","line":242,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":242,"endColumn":37}],"suppressedMessages":[],"errorCount":16,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, Input, Output, EventEmitter, forwardRef, signal, computed, effect, ElementRef, ViewChild } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule, NG_VALUE_ACCESSOR, ControlValueAccessor } from '@angular/forms';\r\nimport { ThemeService } from '../../../services/theme.service';\r\nimport { DomSanitizer } from '@angular/platform-browser';\r\nimport { SafeHtmlPipe } from '../../../pipes';\r\n\r\nexport interface DropdownOption {\r\n  value: string;\r\n  label: string;\r\n  disabled?: boolean;\r\n  icon?: string;\r\n}\r\n\r\n/**\r\n * Custom Dropdown Component\r\n *\r\n * Features:\r\n * - Theme support (light/dark mode)\r\n * - Built-in search functionality\r\n * - Keyboard navigation (Arrow keys, Enter, Escape)\r\n * - Reactive Forms support (ControlValueAccessor)\r\n * - Customizable styling\r\n * - Disabled state support\r\n * - Icon support for options\r\n *\r\n * @example\r\n * ```html\r\n * <ui-dropdown\r\n *   [options]=\"options\"\r\n *   [(ngModel)]=\"selectedValue\"\r\n *   [searchable]=\"true\"\r\n *   placeholder=\"Select an option\"\r\n *   (selectionChange)=\"onSelect($event)\">\r\n * </ui-dropdown>\r\n * ```\r\n */\r\n@Component({\r\n  selector: 'ui-dropdown',\r\n  standalone: true,\r\n  imports: [CommonModule, FormsModule, SafeHtmlPipe],\r\n  templateUrl: './dropdown.component.html',\r\n  styleUrl: './dropdown.component.scss',\r\n  providers: [\r\n    {\r\n      provide: NG_VALUE_ACCESSOR,\r\n      useExisting: forwardRef(() => DropdownComponent),\r\n      multi: true\r\n    }\r\n  ]\r\n})\r\nexport class DropdownComponent implements ControlValueAccessor {\r\n  @ViewChild('searchInput') searchInput?: ElementRef<HTMLInputElement>;\r\n\r\n  @Input() options: DropdownOption[] = [];\r\n  @Input() placeholder = 'Select an option';\r\n  @Input() label?: string;\r\n  @Input() searchable = true;\r\n  @Input() showClearButton = true;\r\n  @Input() disabled = false;\r\n  @Input() size: 'small' | 'medium' | 'large' = 'medium';\r\n  @Input() width: 'normal' | 'medium' | 'wide' = 'normal';\r\n  @Input() searchPlaceholder = 'Search...';\r\n\r\n  @Output() selectionChange = new EventEmitter<string>();\r\n\r\n  // Internal state\r\n  isOpen = signal<boolean>(false);\r\n  searchQuery = signal<string>('');\r\n  selectedValue = signal<string | null>(null);\r\n  highlightedIndex = signal<number>(-1);\r\n\r\n  // Theme integration\r\n  readonly currentTheme = this.themeService.currentTheme;\r\n  readonly isDark = computed(() => this.currentTheme() === 'dark');\r\n\r\n  // Filtered options based on search\r\n  filteredOptions = computed(() => {\r\n    const query = this.searchQuery().toLowerCase();\r\n    if (!query) return this.options;\r\n\r\n    return this.options.filter(option =>\r\n      option.label.toLowerCase().includes(query) ||\r\n      option.value.toLowerCase().includes(query)\r\n    );\r\n  });\r\n\r\n  // Selected option display\r\n  selectedOption = computed(() => {\r\n    const value = this.selectedValue();\r\n    return this.options.find(opt => opt.value === value);\r\n  });\r\n\r\n  // ControlValueAccessor\r\n  private onChange: (value: any) => void = () => {};\r\n  private onTouched: () => void = () => {};\r\n\r\n  constructor(\r\n    private themeService: ThemeService,\r\n    private elementRef: ElementRef,\r\n    public sanitizer: DomSanitizer\r\n  ) {\r\n    // Close dropdown when clicking outside\r\n    effect((onCleanup) => {\r\n      if (this.isOpen()) {\r\n        const clickHandler = (event: MouseEvent) => {\r\n          if (!this.elementRef.nativeElement.contains(event.target)) {\r\n            this.close();\r\n          }\r\n        };\r\n\r\n        setTimeout(() => {\r\n          document.addEventListener('click', clickHandler);\r\n        });\r\n\r\n        onCleanup(() => {\r\n          document.removeEventListener('click', clickHandler);\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  // ControlValueAccessor methods\r\n  writeValue(value: any): void {\r\n    this.selectedValue.set(value);\r\n  }\r\n\r\n  registerOnChange(fn: any): void {\r\n    this.onChange = fn;\r\n  }\r\n\r\n  registerOnTouched(fn: any): void {\r\n    this.onTouched = fn;\r\n  }\r\n\r\n  setDisabledState(isDisabled: boolean): void {\r\n    this.disabled = isDisabled;\r\n  }\r\n\r\n  // Dropdown actions\r\n  toggle(): void {\r\n    if (this.disabled) return;\r\n\r\n    if (this.isOpen()) {\r\n      this.close();\r\n    } else {\r\n      this.open();\r\n    }\r\n  }\r\n\r\n  open(): void {\r\n    if (this.disabled) return;\r\n    this.isOpen.set(true);\r\n    this.searchQuery.set('');\r\n    this.highlightedIndex.set(-1);\r\n\r\n    // Focus search input after dropdown opens\r\n    if (this.searchable) {\r\n      setTimeout(() => {\r\n        this.searchInput?.nativeElement.focus();\r\n      }, 100);\r\n    }\r\n  }\r\n\r\n  close(): void {\r\n    // Use setTimeout to avoid ExpressionChangedAfterItHasBeenCheckedError\r\n    setTimeout(() => {\r\n      this.isOpen.set(false);\r\n      this.searchQuery.set('');\r\n      this.highlightedIndex.set(-1);\r\n    });\r\n    this.onTouched();\r\n  }\r\n\r\n  selectOption(option: DropdownOption): void {\r\n    if (option.disabled) return;\r\n\r\n    this.selectedValue.set(option.value);\r\n    this.onChange(option.value);\r\n    this.selectionChange.emit(option.value);\r\n    this.close();\r\n  }\r\n\r\n  // Search functionality\r\n  onSearchChange(query: string): void {\r\n    this.searchQuery.set(query);\r\n    this.highlightedIndex.set(0); // Reset highlight to first result\r\n  }\r\n\r\n  // Keyboard navigation\r\n  onKeyDown(event: KeyboardEvent): void {\r\n    const filtered = this.filteredOptions();\r\n\r\n    switch (event.key) {\r\n      case 'ArrowDown':\r\n        event.preventDefault();\r\n        if (!this.isOpen()) {\r\n          this.open();\r\n        } else {\r\n          const nextIndex = Math.min(this.highlightedIndex() + 1, filtered.length - 1);\r\n          this.highlightedIndex.set(nextIndex);\r\n          this.scrollToHighlighted();\r\n        }\r\n        break;\r\n\r\n      case 'ArrowUp':\r\n        event.preventDefault();\r\n        if (this.isOpen()) {\r\n          const prevIndex = Math.max(this.highlightedIndex() - 1, 0);\r\n          this.highlightedIndex.set(prevIndex);\r\n          this.scrollToHighlighted();\r\n        }\r\n        break;\r\n\r\n      case 'Enter':\r\n        event.preventDefault();\r\n        if (this.isOpen()) {\r\n          const highlighted = filtered[this.highlightedIndex()];\r\n          if (highlighted) {\r\n            this.selectOption(highlighted);\r\n          }\r\n        } else {\r\n          this.open();\r\n        }\r\n        break;\r\n\r\n      case 'Escape':\r\n        event.preventDefault();\r\n        this.close();\r\n        break;\r\n\r\n      case 'Tab':\r\n        this.close();\r\n        break;\r\n    }\r\n  }\r\n\r\n  private scrollToHighlighted(): void {\r\n    setTimeout(() => {\r\n      const highlightedEl = this.elementRef.nativeElement.querySelector('.option.highlighted');\r\n      if (highlightedEl) {\r\n        highlightedEl.scrollIntoView({ block: 'nearest', behavior: 'smooth' });\r\n      }\r\n    });\r\n  }\r\n\r\n  // Utility methods\r\n  isSelected(option: DropdownOption): boolean {\r\n    return this.selectedValue() === option.value;\r\n  }\r\n\r\n  isHighlighted(index: number): boolean {\r\n    return this.highlightedIndex() === index;\r\n  }\r\n\r\n  onOptionHover(index: number): void {\r\n    this.highlightedIndex.set(index);\r\n  }\r\n\r\n  clearSelection(event: Event): void {\r\n    event.stopPropagation();\r\n    this.selectedValue.set(null);\r\n    this.onChange(null);\r\n    this.selectionChange.emit('');\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\ui\\icon\\icon.component.ts","messages":[{"ruleId":"@angular-eslint/component-selector","severity":2,"message":"The selector should start with one of these prefixes: \"app\" (https://angular.dev/style-guide#style-02-07)","line":14,"column":13,"nodeType":"Literal","messageId":"prefixFailure","endLine":14,"endColumn":22}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, Input } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\n/**\r\n * Icon Component\r\n *\r\n * Custom icon component using inline SVG icons\r\n * Replaces Angular Material mat-icon\r\n *\r\n * Usage:\r\n * <ui-icon name=\"refresh\" size=\"20\"></ui-icon>\r\n */\r\n@Component({\r\n  selector: 'ui-icon',\r\n  standalone: true,\r\n  imports: [CommonModule],\r\n  template: `\r\n    <svg\r\n      [class]=\"'icon icon-' + name + ' ' + class\"\r\n      [attr.width]=\"size\"\r\n      [attr.height]=\"size\"\r\n      viewBox=\"0 0 24 24\"\r\n      fill=\"none\"\r\n      stroke=\"currentColor\"\r\n      stroke-width=\"2\"\r\n      stroke-linecap=\"round\"\r\n      stroke-linejoin=\"round\"\r\n    >\r\n      <ng-container [ngSwitch]=\"name\">\r\n        <!-- Refresh -->\r\n        <g *ngSwitchCase=\"'refresh'\">\r\n          <path d=\"M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2\"/>\r\n        </g>\r\n\r\n        <!-- Schedule/Clock -->\r\n        <g *ngSwitchCase=\"'schedule'\">\r\n          <circle cx=\"12\" cy=\"12\" r=\"10\"/>\r\n          <path d=\"M12 6v6l4 2\"/>\r\n        </g>\r\n\r\n        <!-- Clear/X Circle -->\r\n        <g *ngSwitchCase=\"'clear'\">\r\n          <circle cx=\"12\" cy=\"12\" r=\"10\"/>\r\n          <path d=\"m15 9-6 6M9 9l6 6\"/>\r\n        </g>\r\n\r\n        <!-- Close/X -->\r\n        <g *ngSwitchCase=\"'close'\">\r\n          <path d=\"M18 6 6 18M6 6l12 12\"/>\r\n        </g>\r\n\r\n        <!-- Error -->\r\n        <g *ngSwitchCase=\"'error'\">\r\n          <circle cx=\"12\" cy=\"12\" r=\"10\"/>\r\n          <path d=\"M12 8v4M12 16h.01\"/>\r\n        </g>\r\n\r\n        <!-- Info -->\r\n        <g *ngSwitchCase=\"'info'\">\r\n          <circle cx=\"12\" cy=\"12\" r=\"10\"/>\r\n          <path d=\"M12 16v-4M12 8h.01\"/>\r\n        </g>\r\n\r\n        <!-- Show Chart/Trending Up -->\r\n        <g *ngSwitchCase=\"'show_chart'\">\r\n          <path d=\"M3 3v18h18\"/>\r\n          <path d=\"m19 9-5 5-4-4-5 5\"/>\r\n        </g>\r\n\r\n        <!-- Trending Up -->\r\n        <g *ngSwitchCase=\"'trending_up'\">\r\n          <path d=\"m23 6-9.5 9.5-5-5L1 18\"/>\r\n          <path d=\"M17 6h6v6\"/>\r\n        </g>\r\n\r\n        <!-- Trending Down -->\r\n        <g *ngSwitchCase=\"'trending_down'\">\r\n          <path d=\"m23 18-9.5-9.5-5 5L1 6\"/>\r\n          <path d=\"M17 18h6v-6\"/>\r\n        </g>\r\n\r\n        <!-- Arrow Upward -->\r\n        <g *ngSwitchCase=\"'arrow_upward'\">\r\n          <path d=\"M12 19V5M5 12l7-7 7 7\"/>\r\n        </g>\r\n\r\n        <!-- Arrow Downward -->\r\n        <g *ngSwitchCase=\"'arrow_downward'\">\r\n          <path d=\"M12 5v14M19 12l-7 7-7-7\"/>\r\n        </g>\r\n\r\n        <!-- Check Circle -->\r\n        <g *ngSwitchCase=\"'check_circle'\">\r\n          <path d=\"M22 11.08V12a10 10 0 1 1-5.93-9.14\"/>\r\n          <path d=\"m9 11 3 3L22 4\"/>\r\n        </g>\r\n\r\n        <!-- Settings -->\r\n        <g *ngSwitchCase=\"'settings'\">\r\n          <circle cx=\"12\" cy=\"12\" r=\"3\"/>\r\n          <path d=\"M12 1v6m0 6v6\"/>\r\n          <path d=\"m4.93 4.93 4.24 4.24m5.66 5.66 4.24 4.24\"/>\r\n          <path d=\"m1 12h6m6 0h6\"/>\r\n          <path d=\"m4.93 19.07 4.24-4.24m5.66-5.66 4.24-4.24\"/>\r\n        </g>\r\n\r\n        <!-- Tune/Sliders -->\r\n        <g *ngSwitchCase=\"'tune'\">\r\n          <path d=\"M4 21v-7M4 10V3M12 21v-9M12 8V3M20 21v-5M20 12V3M1 14h6M9 8h6M17 16h6\"/>\r\n        </g>\r\n\r\n        <!-- Default/Unknown icon -->\r\n        <g *ngSwitchDefault>\r\n          <circle cx=\"12\" cy=\"12\" r=\"10\"/>\r\n          <path d=\"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3M12 17h.01\"/>\r\n        </g>\r\n      </ng-container>\r\n    </svg>\r\n  `,\r\n  styles: [`\r\n    :host {\r\n      display: inline-flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n    }\r\n\r\n    .icon {\r\n      display: inline-block;\r\n      color: inherit;\r\n      vertical-align: middle;\r\n      transition: all 0.2s ease;\r\n    }\r\n\r\n    .icon.spinning {\r\n      animation: spin 1s linear infinite;\r\n    }\r\n\r\n    @keyframes spin {\r\n      from {\r\n        transform: rotate(0deg);\r\n      }\r\n      to {\r\n        transform: rotate(360deg);\r\n      }\r\n    }\r\n  `]\r\n})\r\nexport class IconComponent {\r\n  @Input() name = '';\r\n  @Input() size: string | number = 24;\r\n  @Input() class = '';\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\ui\\input\\input.component.html","messages":[{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":2,"column":3,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":2,"endColumn":63}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<div [class]=\"getWrapperClasses()\">\r\n  <label *ngIf=\"label\" class=\"input-label\">{{ label }}</label>\r\n  <div class=\"input-container\">\r\n    <span *ngIf=\"icon && iconPosition === 'left'\" [class]=\"'input-icon input-icon-left ' + icon\"></span>\r\n    <input\r\n      [type]=\"type\"\r\n      [class]=\"getInputClasses()\"\r\n      [placeholder]=\"placeholder\"\r\n      [disabled]=\"disabled\"\r\n      [value]=\"value\"\r\n      [min]=\"min\"\r\n      [max]=\"max\"\r\n      [step]=\"step\"\r\n      (input)=\"onInput($event)\"\r\n      (blur)=\"onBlur()\"\r\n    />\r\n    <span *ngIf=\"suffix\" class=\"input-suffix\">{{ suffix }}</span>\r\n    <span *ngIf=\"icon && iconPosition === 'right'\" [class]=\"'input-icon input-icon-right ' + icon\"></span>\r\n  </div>\r\n  <div *ngIf=\"hint && !error\" class=\"input-hint-text\">{{ hint }}</div>\r\n  <div *ngIf=\"error\" class=\"input-error-text\">{{ error }}</div>\r\n</div>","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\ui\\input\\input.component.ts","messages":[{"ruleId":"@angular-eslint/component-selector","severity":2,"message":"The selector should start with one of these prefixes: \"app\" (https://angular.dev/style-guide#style-02-07)","line":6,"column":13,"nodeType":"Literal","messageId":"prefixFailure","endLine":6,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1180,1183],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1180,1183],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":37,"column":5,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":37,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":39,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1232,1235],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1232,1235],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":40,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":40,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":42,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1312,1315],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1312,1315],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1341,1344],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1341,1344],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'value' is defined but never used.","line":47,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":47,"endColumn":28},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1403,1406],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1403,1406],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-empty-function","severity":2,"message":"Unexpected empty method 'onChange'.","line":47,"column":38,"nodeType":"ArrowFunctionExpression","messageId":"unexpected","endLine":47,"endColumn":40,"suggestions":[{"messageId":"suggestComment","data":{"name":"method 'onChange'"},"fix":{"range":[1412,1412],"text":" /* empty */ "},"desc":"Add comment inside empty method 'onChange'."}]},{"ruleId":"@typescript-eslint/no-empty-function","severity":2,"message":"Unexpected empty method 'onTouched'.","line":48,"column":29,"nodeType":"ArrowFunctionExpression","messageId":"unexpected","endLine":48,"endColumn":31,"suggestions":[{"messageId":"suggestComment","data":{"name":"method 'onTouched'"},"fix":{"range":[1445,1445],"text":" /* empty */ "},"desc":"Add comment inside empty method 'onTouched'."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":50,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1471,1474],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1471,1474],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":51,"column":5,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":51,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":54,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1541,1544],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1541,1544],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":55,"column":5,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":55,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":58,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1611,1614],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1611,1614],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":59,"column":5,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":59,"endColumn":24},{"ruleId":"@angular-eslint/component-selector","severity":2,"message":"The selector should start with one of these prefixes: \"app\" (https://angular.dev/style-guide#style-02-07)","line":110,"column":13,"nodeType":"Literal","messageId":"prefixFailure","endLine":110,"endColumn":26},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":148,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":148,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3722,3725],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3722,3725],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":149,"column":5,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":149,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":151,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3774,3777],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3774,3777],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":152,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":152,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":154,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":154,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3854,3857],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3854,3857],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":156,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":156,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3883,3886],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3883,3886],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'value' is defined but never used.","line":159,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":159,"endColumn":28},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":159,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":159,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3945,3948],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3945,3948],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-empty-function","severity":2,"message":"Unexpected empty method 'onChange'.","line":159,"column":38,"nodeType":"ArrowFunctionExpression","messageId":"unexpected","endLine":159,"endColumn":40,"suggestions":[{"messageId":"suggestComment","data":{"name":"method 'onChange'"},"fix":{"range":[3954,3954],"text":" /* empty */ "},"desc":"Add comment inside empty method 'onChange'."}]},{"ruleId":"@typescript-eslint/no-empty-function","severity":2,"message":"Unexpected empty method 'onTouched'.","line":160,"column":29,"nodeType":"ArrowFunctionExpression","messageId":"unexpected","endLine":160,"endColumn":31,"suggestions":[{"messageId":"suggestComment","data":{"name":"method 'onTouched'"},"fix":{"range":[3987,3987],"text":" /* empty */ "},"desc":"Add comment inside empty method 'onTouched'."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":162,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":162,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4013,4016],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4013,4016],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":163,"column":5,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":163,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":166,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":166,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4083,4086],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4083,4086],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":167,"column":5,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":167,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":170,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":170,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4153,4156],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4153,4156],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":171,"column":5,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":171,"endColumn":24}],"suppressedMessages":[],"errorCount":34,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, Input, Output, EventEmitter, forwardRef } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\r\n\r\n@Component({\r\n  selector: 'ui-input',\r\n  standalone: true,\r\n  imports: [CommonModule],\r\n  templateUrl: './input.component.html',\r\n  styleUrls: ['./input.component.css'],\r\n  providers: [\r\n    {\r\n      provide: NG_VALUE_ACCESSOR,\r\n      useExisting: forwardRef(() => InputComponent),\r\n      multi: true\r\n    }\r\n  ]\r\n})\r\nexport class InputComponent implements ControlValueAccessor {\r\n  @Input() type: 'text' | 'email' | 'password' | 'number' | 'tel' | 'url' = 'text';\r\n  @Input() placeholder = '';\r\n  @Input() label = '';\r\n  @Input() hint = '';\r\n  @Input() error = '';\r\n  @Input() disabled = false;\r\n  @Input() size: 'small' | 'medium' | 'large' = 'medium';\r\n  @Input() fullWidth = false;\r\n  @Input() icon?: string;\r\n  @Input() iconPosition: 'left' | 'right' = 'left';\r\n  @Input() suffix?: string;\r\n  @Input() min?: number | string;\r\n  @Input() max?: number | string;\r\n  @Input() step?: number | string;\r\n\r\n  // Support for direct value binding\r\n  @Input() set value(val: any) {\r\n    this._value = val;\r\n  }\r\n  get value(): any {\r\n    return this._value;\r\n  }\r\n  @Output() valueChange = new EventEmitter<any>();\r\n\r\n  private _value: any = '';\r\n  touched = false;\r\n\r\n  private onChange = (value: any) => {};\r\n  private onTouched = () => {};\r\n\r\n  writeValue(value: any): void {\r\n    this._value = value;\r\n  }\r\n\r\n  registerOnChange(fn: any): void {\r\n    this.onChange = fn;\r\n  }\r\n\r\n  registerOnTouched(fn: any): void {\r\n    this.onTouched = fn;\r\n  }\r\n\r\n  setDisabledState(isDisabled: boolean): void {\r\n    this.disabled = isDisabled;\r\n  }\r\n\r\n  onInput(event: Event): void {\r\n    const target = event.target as HTMLInputElement;\r\n    this._value = target.value;\r\n    this.onChange(this._value);\r\n    this.valueChange.emit(this._value);\r\n  }\r\n\r\n  onBlur(): void {\r\n    this.touched = true;\r\n    this.onTouched();\r\n  }\r\n\r\n  getInputClasses(): string {\r\n    const classes = ['input'];\r\n\r\n    classes.push(`input-${this.size}`);\r\n\r\n    if (this.error) {\r\n      classes.push('input-error');\r\n    }\r\n\r\n    if (this.fullWidth) {\r\n      classes.push('input-full-width');\r\n    }\r\n\r\n    if (this.icon) {\r\n      classes.push(`input-with-icon-${this.iconPosition}`);\r\n    }\r\n\r\n    return classes.join(' ');\r\n  }\r\n\r\n  getWrapperClasses(): string {\r\n    const classes = ['input-wrapper'];\r\n\r\n    if (this.fullWidth) {\r\n      classes.push('input-wrapper-full-width');\r\n    }\r\n\r\n    return classes.join(' ');\r\n  }\r\n}\r\n\r\n@Component({\r\n  selector: 'ui-textarea',\r\n  standalone: true,\r\n  imports: [CommonModule],\r\n  template: `\r\n    <div [class]=\"getWrapperClasses()\">\r\n      <label *ngIf=\"label\" class=\"input-label\">{{ label }}</label>\r\n      <div class=\"textarea-container\">\r\n        <textarea\r\n          [class]=\"getTextareaClasses()\"\r\n          [placeholder]=\"placeholder\"\r\n          [disabled]=\"disabled\"\r\n          [rows]=\"rows\"\r\n          [value]=\"value\"\r\n          (input)=\"onInput($event)\"\r\n          (blur)=\"onBlur()\">\r\n        </textarea>\r\n      </div>\r\n      <div *ngIf=\"error\" class=\"input-error-text\">{{ error }}</div>\r\n    </div>\r\n  `,\r\n  styleUrls: ['./input.component.css'],\r\n  providers: [\r\n    {\r\n      provide: NG_VALUE_ACCESSOR,\r\n      useExisting: forwardRef(() => TextareaComponent),\r\n      multi: true\r\n    }\r\n  ]\r\n})\r\nexport class TextareaComponent implements ControlValueAccessor {\r\n  @Input() placeholder = '';\r\n  @Input() label = '';\r\n  @Input() error = '';\r\n  @Input() disabled = false;\r\n  @Input() rows = 4;\r\n  @Input() fullWidth = false;\r\n\r\n  // Support for direct value binding\r\n  @Input() set value(val: any) {\r\n    this._value = val;\r\n  }\r\n  get value(): any {\r\n    return this._value;\r\n  }\r\n  @Output() valueChange = new EventEmitter<any>();\r\n\r\n  private _value: any = '';\r\n  touched = false;\r\n\r\n  private onChange = (value: any) => {};\r\n  private onTouched = () => {};\r\n\r\n  writeValue(value: any): void {\r\n    this._value = value;\r\n  }\r\n\r\n  registerOnChange(fn: any): void {\r\n    this.onChange = fn;\r\n  }\r\n\r\n  registerOnTouched(fn: any): void {\r\n    this.onTouched = fn;\r\n  }\r\n\r\n  setDisabledState(isDisabled: boolean): void {\r\n    this.disabled = isDisabled;\r\n  }\r\n\r\n  onInput(event: Event): void {\r\n    const target = event.target as HTMLTextAreaElement;\r\n    this._value = target.value;\r\n    this.onChange(this._value);\r\n    this.valueChange.emit(this._value);\r\n  }\r\n\r\n  onBlur(): void {\r\n    this.touched = true;\r\n    this.onTouched();\r\n  }\r\n\r\n  getTextareaClasses(): string {\r\n    const classes = ['textarea'];\r\n\r\n    if (this.error) {\r\n      classes.push('textarea-error');\r\n    }\r\n\r\n    if (this.fullWidth) {\r\n      classes.push('textarea-full-width');\r\n    }\r\n\r\n    return classes.join(' ');\r\n  }\r\n\r\n  getWrapperClasses(): string {\r\n    const classes = ['input-wrapper'];\r\n\r\n    if (this.fullWidth) {\r\n      classes.push('input-wrapper-full-width');\r\n    }\r\n\r\n    return classes.join(' ');\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\ui\\select\\select.component.html","messages":[{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":2,"column":3,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":2,"endColumn":64}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<div [class]=\"getWrapperClasses()\">\r\n  <label *ngIf=\"label\" class=\"select-label\">{{ label }}</label>\r\n  <div class=\"select-container\">\r\n    <select\r\n      [class]=\"getSelectClasses()\"\r\n      [disabled]=\"disabled\"\r\n      [multiple]=\"multiple\"\r\n      [value]=\"value\"\r\n      (change)=\"onSelectionChange($event)\"\r\n      (blur)=\"onBlur()\"\r\n    >\r\n      <option *ngIf=\"!multiple && placeholder\" value=\"\" disabled [selected]=\"!value\">\r\n        {{ placeholder }}\r\n      </option>\r\n      <option\r\n        *ngFor=\"let option of options\"\r\n        [value]=\"option.value\"\r\n        [disabled]=\"option.disabled\"\r\n        [selected]=\"isSelected(option.value)\"\r\n      >\r\n        {{ option.label }}\r\n      </option>\r\n    </select>\r\n    <span class=\"select-arrow\">\r\n      <svg width=\"12\" height=\"8\" viewBox=\"0 0 12 8\" fill=\"none\">\r\n        <path d=\"M1 1.5L6 6.5L11 1.5\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n      </svg>\r\n    </span>\r\n  </div>\r\n  <div *ngIf=\"error\" class=\"select-error-text\">{{ error }}</div>\r\n</div>","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\ui\\select\\select.component.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[253,256],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[253,256],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@angular-eslint/component-selector","severity":2,"message":"The selector should start with one of these prefixes: \"app\" (https://angular.dev/style-guide#style-02-07)","line":12,"column":13,"nodeType":"Literal","messageId":"prefixFailure","endLine":12,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1044,1047],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1044,1047],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":37,"column":5,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":37,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":39,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1096,1099],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1096,1099],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":40,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":40,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":42,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1176,1179],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1176,1179],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1205,1208],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1205,1208],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'value' is defined but never used.","line":47,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":47,"endColumn":28},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1269,1272],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1269,1272],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-empty-function","severity":2,"message":"Unexpected empty method 'onChange'.","line":47,"column":38,"nodeType":"ArrowFunctionExpression","messageId":"unexpected","endLine":47,"endColumn":40,"suggestions":[{"messageId":"suggestComment","data":{"name":"method 'onChange'"},"fix":{"range":[1278,1278],"text":" /* empty */ "},"desc":"Add comment inside empty method 'onChange'."}]},{"ruleId":"@typescript-eslint/no-empty-function","severity":2,"message":"Unexpected empty method 'onTouched'.","line":48,"column":29,"nodeType":"ArrowFunctionExpression","messageId":"unexpected","endLine":48,"endColumn":31,"suggestions":[{"messageId":"suggestComment","data":{"name":"method 'onTouched'"},"fix":{"range":[1311,1311],"text":" /* empty */ "},"desc":"Add comment inside empty method 'onTouched'."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":50,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1337,1340],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1337,1340],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":51,"column":5,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":51,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":54,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1407,1410],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1407,1410],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":55,"column":5,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":55,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":58,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1477,1480],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1477,1480],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":59,"column":5,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":59,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":111,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2609,2612],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2609,2612],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":19,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, Input, Output, EventEmitter, forwardRef } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\r\n\r\nexport interface SelectOption {\r\n  value: any;\r\n  label: string;\r\n  disabled?: boolean;\r\n}\r\n\r\n@Component({\r\n  selector: 'ui-select',\r\n  standalone: true,\r\n  imports: [CommonModule],\r\n  templateUrl: './select.component.html',\r\n  styleUrls: ['./select.component.css'],\r\n  providers: [\r\n    {\r\n      provide: NG_VALUE_ACCESSOR,\r\n      useExisting: forwardRef(() => SelectComponent),\r\n      multi: true\r\n    }\r\n  ]\r\n})\r\nexport class SelectComponent implements ControlValueAccessor {\r\n  @Input() options: SelectOption[] = [];\r\n  @Input() placeholder = 'Select an option';\r\n  @Input() label = '';\r\n  @Input() error = '';\r\n  @Input() disabled = false;\r\n  @Input() size: 'small' | 'medium' | 'large' = 'medium';\r\n  @Input() fullWidth = false;\r\n  @Input() multiple = false;\r\n\r\n  // Support for direct value binding\r\n  @Input() set value(val: any) {\r\n    this._value = val;\r\n  }\r\n  get value(): any {\r\n    return this._value;\r\n  }\r\n  @Output() valueChange = new EventEmitter<any>();\r\n\r\n  private _value: any = null;\r\n  touched = false;\r\n\r\n  private onChange = (value: any) => {};\r\n  private onTouched = () => {};\r\n\r\n  writeValue(value: any): void {\r\n    this._value = value;\r\n  }\r\n\r\n  registerOnChange(fn: any): void {\r\n    this.onChange = fn;\r\n  }\r\n\r\n  registerOnTouched(fn: any): void {\r\n    this.onTouched = fn;\r\n  }\r\n\r\n  setDisabledState(isDisabled: boolean): void {\r\n    this.disabled = isDisabled;\r\n  }\r\n\r\n  onSelectionChange(event: Event): void {\r\n    const target = event.target as HTMLSelectElement;\r\n\r\n    if (this.multiple) {\r\n      const selectedOptions = Array.from(target.selectedOptions).map(option => option.value);\r\n      this._value = selectedOptions;\r\n    } else {\r\n      this._value = target.value;\r\n    }\r\n\r\n    this.onChange(this._value);\r\n    this.valueChange.emit(this._value);\r\n  }\r\n\r\n  onBlur(): void {\r\n    this.touched = true;\r\n    this.onTouched();\r\n  }\r\n\r\n  getSelectClasses(): string {\r\n    const classes = ['select'];\r\n\r\n    classes.push(`select-${this.size}`);\r\n\r\n    if (this.error) {\r\n      classes.push('select-error');\r\n    }\r\n\r\n    if (this.fullWidth) {\r\n      classes.push('select-full-width');\r\n    }\r\n\r\n    return classes.join(' ');\r\n  }\r\n\r\n  getWrapperClasses(): string {\r\n    const classes = ['select-wrapper'];\r\n\r\n    if (this.fullWidth) {\r\n      classes.push('select-wrapper-full-width');\r\n    }\r\n\r\n    return classes.join(' ');\r\n  }\r\n\r\n  isSelected(optionValue: any): boolean {\r\n    if (this.multiple && Array.isArray(this._value)) {\r\n      return this._value.includes(optionValue);\r\n    }\r\n    return this._value === optionValue;\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\ui\\table\\table.component.ts","messages":[{"ruleId":"@angular-eslint/component-selector","severity":2,"message":"The selector should start with one of these prefixes: \"app\" (https://angular.dev/style-guide#style-02-07)","line":20,"column":13,"nodeType":"Literal","messageId":"prefixFailure","endLine":20,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[782,785],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[782,785],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1130,1133],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1130,1133],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1942,1945],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1942,1945],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":70,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2018,2021],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2018,2021],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":75,"column":9,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":75,"endColumn":75},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":77,"column":9,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":77,"endColumn":75},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":79,"column":9,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":79,"endColumn":75},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":81,"column":9,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":81,"endColumn":75},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'item' is defined but never used.","line":150,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":150,"endColumn":35},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":150,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":150,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4063,4066],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4063,4066],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, Input, Output, EventEmitter, inject } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { TranslationService } from '../../../services/translation.service';\r\n\r\nexport interface TableColumn {\r\n  key: string;\r\n  label: string;\r\n  sortable?: boolean;\r\n  type?: 'text' | 'number' | 'date' | 'currency' | 'percentage';\r\n  width?: string;\r\n  align?: 'left' | 'center' | 'right';\r\n}\r\n\r\nexport interface SortEvent {\r\n  column: string;\r\n  direction: 'asc' | 'desc' | null;\r\n}\r\n\r\n@Component({\r\n  selector: 'ui-table',\r\n  standalone: true,\r\n  imports: [CommonModule],\r\n  templateUrl: './table.component.html',\r\n  styleUrls: ['./table.component.css']\r\n})\r\nexport class TableComponent {\r\n  @Input() columns: TableColumn[] = [];\r\n  @Input() data: any[] = [];\r\n  @Input() loading = false;\r\n  @Input() striped = true;\r\n  @Input() hoverable = true;\r\n  @Input() bordered = false;\r\n  @Input() size: 'small' | 'medium' | 'large' = 'medium';\r\n  @Input() stickyHeader = false;\r\n  @Input() maxHeight?: string;\r\n\r\n  @Output() sort = new EventEmitter<SortEvent>();\r\n  @Output() rowClick = new EventEmitter<any>();\r\n\r\n  currentSort: { column: string; direction: 'asc' | 'desc' | null } = { column: '', direction: null };\r\n\r\n  // Inject TranslationService\r\n  protected translationService = inject(TranslationService);\r\n\r\n  translate(key: string): string {\r\n    return this.translationService.translate(key);\r\n  }\r\n\r\n  onSort(column: TableColumn): void {\r\n    if (!column.sortable) return;\r\n\r\n    let direction: 'asc' | 'desc' | null = 'asc';\r\n\r\n    if (this.currentSort.column === column.key) {\r\n      if (this.currentSort.direction === 'asc') {\r\n        direction = 'desc';\r\n      } else if (this.currentSort.direction === 'desc') {\r\n        direction = null;\r\n      }\r\n    }\r\n\r\n    this.currentSort = { column: column.key, direction };\r\n    this.sort.emit({ column: column.key, direction });\r\n  }\r\n\r\n  onRowClick(row: any): void {\r\n    this.rowClick.emit(row);\r\n  }\r\n\r\n  formatCellValue(value: any, column: TableColumn): string {\r\n    if (value === null || value === undefined) return '';\r\n\r\n    switch (column.type) {\r\n      case 'currency':\r\n        return typeof value === 'number' ? `$${value.toFixed(2)}` : value;\r\n      case 'percentage':\r\n        return typeof value === 'number' ? `${value.toFixed(2)}%` : value;\r\n      case 'number':\r\n        return typeof value === 'number' ? value.toLocaleString() : value;\r\n      case 'date':\r\n        return value instanceof Date ? value.toLocaleDateString() : value;\r\n      default:\r\n        return String(value);\r\n    }\r\n  }\r\n\r\n  getTableClasses(): string {\r\n    const classes = ['table'];\r\n\r\n    classes.push(`table-${this.size}`);\r\n\r\n    if (this.striped) {\r\n      classes.push('table-striped');\r\n    }\r\n\r\n    if (this.hoverable) {\r\n      classes.push('table-hoverable');\r\n    }\r\n\r\n    if (this.bordered) {\r\n      classes.push('table-bordered');\r\n    }\r\n\r\n    if (this.stickyHeader) {\r\n      classes.push('table-sticky-header');\r\n    }\r\n\r\n    return classes.join(' ');\r\n  }\r\n\r\n  getColumnHeaderClasses(column: TableColumn): string {\r\n    const classes = ['table-header'];\r\n\r\n    if (column.sortable) {\r\n      classes.push('table-header-sortable');\r\n    }\r\n\r\n    if (column.align) {\r\n      classes.push(`table-header-${column.align}`);\r\n    }\r\n\r\n    if (this.currentSort.column === column.key && this.currentSort.direction) {\r\n      classes.push(`table-header-sorted-${this.currentSort.direction}`);\r\n    }\r\n\r\n    return classes.join(' ');\r\n  }\r\n\r\n  getCellClasses(column: TableColumn): string {\r\n    const classes = ['table-cell'];\r\n\r\n    if (column.align) {\r\n      classes.push(`table-cell-${column.align}`);\r\n    }\r\n\r\n    return classes.join(' ');\r\n  }\r\n\r\n  getSortIcon(column: TableColumn): string {\r\n    if (!column.sortable) return '';\r\n\r\n    if (this.currentSort.column === column.key) {\r\n      return this.currentSort.direction === 'asc' ? '‚Üë' :\r\n             this.currentSort.direction === 'desc' ? '‚Üì' : '‚Üï';\r\n    }\r\n\r\n    return '‚Üï';\r\n  }\r\n\r\n  trackByIndex(index: number, item: any): number {\r\n    return index;\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\ui\\tabs\\tabs.component.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ContentChildren' is defined but never used.","line":1,"column":50,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":65},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'QueryList' is defined but never used.","line":1,"column":67,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":76},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'AfterContentInit' is defined but never used.","line":1,"column":78,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":94},{"ruleId":"@angular-eslint/component-selector","severity":2,"message":"The selector should start with one of these prefixes: \"app\" (https://angular.dev/style-guide#style-02-07)","line":12,"column":13,"nodeType":"Literal","messageId":"prefixFailure","endLine":12,"endColumn":22},{"ruleId":"@angular-eslint/component-selector","severity":2,"message":"The selector should start with one of these prefixes: \"app\" (https://angular.dev/style-guide#style-02-07)","line":67,"column":13,"nodeType":"Literal","messageId":"prefixFailure","endLine":67,"endColumn":29}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, Input, Output, EventEmitter, ContentChildren, QueryList, AfterContentInit } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\n\r\nexport interface Tab {\r\n  id: string;\r\n  label: string;\r\n  disabled?: boolean;\r\n  icon?: string;\r\n}\r\n\r\n@Component({\r\n  selector: 'ui-tabs',\r\n  standalone: true,\r\n  imports: [CommonModule],\r\n  templateUrl: './tabs.component.html',\r\n  styleUrls: ['./tabs.component.css']\r\n})\r\nexport class TabsComponent {\r\n  @Input() tabs: Tab[] = [];\r\n  @Input() activeTabId = '';\r\n  @Input() variant: 'default' | 'pills' | 'underline' = 'default';\r\n  @Input() size: 'small' | 'medium' | 'large' = 'medium';\r\n  @Input() fullWidth = false;\r\n\r\n  @Output() tabChange = new EventEmitter<string>();\r\n\r\n  selectTab(tabId: string): void {\r\n    const tab = this.tabs.find(t => t.id === tabId);\r\n    if (tab && !tab.disabled) {\r\n      this.activeTabId = tabId;\r\n      this.tabChange.emit(tabId);\r\n    }\r\n  }\r\n\r\n  getTabsClasses(): string {\r\n    const classes = ['tabs'];\r\n\r\n    classes.push(`tabs-${this.variant}`);\r\n    classes.push(`tabs-${this.size}`);\r\n\r\n    if (this.fullWidth) {\r\n      classes.push('tabs-full-width');\r\n    }\r\n\r\n    return classes.join(' ');\r\n  }\r\n\r\n  getTabClasses(tab: Tab): string {\r\n    const classes = ['tab'];\r\n\r\n    classes.push(`tab-${this.variant}`);\r\n    classes.push(`tab-${this.size}`);\r\n\r\n    if (tab.id === this.activeTabId) {\r\n      classes.push('tab-active');\r\n    }\r\n\r\n    if (tab.disabled) {\r\n      classes.push('tab-disabled');\r\n    }\r\n\r\n    return classes.join(' ');\r\n  }\r\n}\r\n\r\n@Component({\r\n  selector: 'ui-tab-content',\r\n  standalone: true,\r\n  imports: [CommonModule],\r\n  templateUrl: './tab-content.component.html',\r\n  styleUrls: ['./tab-content.component.css']\r\n})\r\nexport class TabContentComponent {\r\n  @Input() tabId = '';\r\n  @Input() active = false;\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\ui\\tooltip\\tooltip.component.ts","messages":[{"ruleId":"@angular-eslint/component-selector","severity":2,"message":"The selector should start with one of these prefixes: \"app\" (https://angular.dev/style-guide#style-02-07)","line":13,"column":13,"nodeType":"Literal","messageId":"prefixFailure","endLine":13,"endColumn":33}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, inject, computed } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { ToastService, Toast } from '../../../services/toast.service';\r\nimport { ThemeService } from '../../../services/theme.service';\r\n\r\n/**\r\n * Toast notification component\r\n *\r\n * Displays toast notifications at the top-right of the screen\r\n * Supports multiple variants: error, warning, info, success\r\n */\r\n@Component({\r\n  selector: 'ui-toast-container',\r\n  standalone: true,\r\n  imports: [CommonModule],\r\n  templateUrl: './tooltip.component.html',\r\n  styleUrl: './tooltip.component.scss'\r\n})\r\nexport class ToastContainerComponent {\r\n  private toastService = inject(ToastService);\r\n  private themeService = inject(ThemeService);\r\n\r\n  toasts = this.toastService.getToasts;\r\n  isDarkMode = computed(() => this.themeService.isDark());\r\n\r\n  /**\r\n   * Close a toast\r\n   */\r\n  close(toast: Toast): void {\r\n    this.toastService.remove(toast.id);\r\n  }\r\n\r\n  /**\r\n   * Get toast classes\r\n   */\r\n  getToastClasses(toast: Toast): string {\r\n    const classes = [\r\n      'toast',\r\n      `toast--${toast.variant}`,\r\n      this.isDarkMode() ? 'toast--dark' : 'toast--light'\r\n    ];\r\n    return classes.join(' ');\r\n  }\r\n\r\n  /**\r\n   * Get icon for toast variant\r\n   */\r\n  getIcon(variant: string): string {\r\n    switch (variant) {\r\n      case 'error':\r\n        return '‚úï';\r\n      case 'warning':\r\n        return '‚ö†';\r\n      case 'info':\r\n        return '‚ìò';\r\n      case 'success':\r\n        return '‚úì';\r\n      default:\r\n        return '‚ìò';\r\n    }\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\components\\websocket-test\\websocket-test.component.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":107,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3258,3261],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3258,3261],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":149,"column":36,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":149,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .lastPrice on an `any` value.","line":164,"column":48,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":164,"endColumn":57},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .price24hPcnt on an `any` value.","line":164,"column":74,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":164,"endColumn":86},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .timestamp on an `any` value.","line":168,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":168,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":169,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":169,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .prevPrice24h on an `any` value.","line":169,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":169,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":170,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":170,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .highPrice24h on an `any` value.","line":170,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":170,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":171,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":171,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .lowPrice24h on an `any` value.","line":171,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":171,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":172,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":172,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .lastPrice on an `any` value.","line":172,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":172,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":182,"column":36,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":182,"endColumn":43}],"suppressedMessages":[],"errorCount":14,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, OnInit, OnDestroy } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { BybitService } from '../../services/bybit.service';\r\nimport { Subscription } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'app-websocket-test',\r\n  standalone: true,\r\n  imports: [CommonModule],\r\n  template: `\r\n    <div class=\"websocket-test\">\r\n      <h2>WebSocket Test - Real-time BTCUSDT Data</h2>\r\n\r\n      <div class=\"connection-info\">\r\n        <p><strong>Connection Status:</strong>\r\n          <span [class]=\"'status-' + connectionStatus\">{{ connectionStatus }}</span>\r\n        </p>\r\n        <p><strong>WebSocket URL:</strong> wss://stream.bybit.com/v5/public/spot</p>\r\n        <p><strong>Active Subscriptions:</strong> {{ activeSubscriptions.length }}</p>\r\n        <ul>\r\n          <li *ngFor=\"let sub of activeSubscriptions\">{{ sub }}</li>\r\n        </ul>\r\n      </div>\r\n\r\n      <div class=\"controls\">\r\n        <button (click)=\"startTest()\" [disabled]=\"isRunning\">Start Kline Test</button>\r\n        <button (click)=\"startTickerTest()\" [disabled]=\"isRunning\">Start Ticker Test</button>\r\n        <button (click)=\"stopTest()\" [disabled]=\"!isRunning\">Stop Test</button>\r\n      </div>\r\n\r\n      <div class=\"data-display\">\r\n        <h3>Latest Data Points (Last 10):</h3>\r\n        <div class=\"data-items\">\r\n          <div *ngFor=\"let data of latestData\" class=\"data-item\">\r\n            <strong>{{ formatTime(data.time) }}</strong>:\r\n            O: {{ data.open }} | H: {{ data.high }} | L: {{ data.low }} | C: {{ data.close }}\r\n            <span [class]=\"data.close > data.open ? 'green' : 'red'\">\r\n              ({{ data.close > data.open ? '+' : '' }}{{ ((data.close - data.open) / data.open * 100).toFixed(2) }}%)\r\n            </span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"logs\">\r\n        <h3>Logs:</h3>\r\n        <div class=\"log-items\">\r\n          <div *ngFor=\"let log of logs\" class=\"log-item\">\r\n            {{ log.time }}: {{ log.message }}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `,\r\n  styles: [`\r\n    .websocket-test {\r\n      padding: 20px;\r\n      max-width: 800px;\r\n      margin: 0 auto;\r\n      font-family: monospace;\r\n    }\r\n\r\n    .connection-info {\r\n      background: #f5f5f5;\r\n      padding: 15px;\r\n      border-radius: 5px;\r\n      margin: 10px 0;\r\n    }\r\n\r\n    .status-connected { color: green; font-weight: bold; }\r\n    .status-connecting { color: orange; font-weight: bold; }\r\n    .status-disconnected { color: red; font-weight: bold; }\r\n\r\n    .controls {\r\n      margin: 20px 0;\r\n    }\r\n\r\n    .controls button {\r\n      margin-right: 10px;\r\n      padding: 10px 20px;\r\n      font-size: 14px;\r\n    }\r\n\r\n    .data-display, .logs {\r\n      margin: 20px 0;\r\n    }\r\n\r\n    .data-item, .log-item {\r\n      padding: 5px;\r\n      margin: 2px 0;\r\n      background: #f9f9f9;\r\n      border-left: 3px solid #ddd;\r\n      font-size: 12px;\r\n    }\r\n\r\n    .green { color: green; }\r\n    .red { color: red; }\r\n\r\n    .log-items {\r\n      max-height: 200px;\r\n      overflow-y: auto;\r\n    }\r\n  `]\r\n})\r\nexport class WebSocketTestComponent implements OnInit, OnDestroy {\r\n  connectionStatus: 'disconnected' | 'connecting' | 'connected' = 'disconnected';\r\n  activeSubscriptions: string[] = [];\r\n  latestData: any[] = [];\r\n  logs: { time: string, message: string }[] = [];\r\n  isRunning = false;\r\n\r\n  private subscription?: Subscription;\r\n  private statusSubscription?: Subscription;\r\n\r\n  constructor(private bybitService: BybitService) {}\r\n\r\n  ngOnInit(): void {\r\n    this.log('Component initialized');\r\n\r\n    // Subscribe to connection status\r\n    this.statusSubscription = this.bybitService.getWebSocketConnectionState().subscribe(status => {\r\n      this.connectionStatus = status;\r\n      this.activeSubscriptions = this.bybitService.getActiveSubscriptions();\r\n      this.log(`Connection status changed to: ${status}`);\r\n    });\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.stopTest();\r\n    this.statusSubscription?.unsubscribe();\r\n  }\r\n\r\n  startTest(): void {\r\n    this.log('Starting Bybit V5 WebSocket kline test...');\r\n    this.isRunning = true;\r\n    this.latestData = [];\r\n\r\n    // Subscribe to real-time BTCUSDT kline data\r\n    this.subscription = this.bybitService.subscribeToRealtimeKline('BTCUSDT', '1').subscribe({\r\n      next: (data) => {\r\n        this.log(`üìä Kline Data: Close=${data.close}, Volume=${data.volume}`);\r\n\r\n        // Add to latest data (keep only last 10)\r\n        this.latestData.unshift(data);\r\n        if (this.latestData.length > 10) {\r\n          this.latestData = this.latestData.slice(0, 10);\r\n        }\r\n      },\r\n      error: (error) => {\r\n        this.log(`‚ùå Error: ${error.message || error}`);\r\n      }\r\n    });\r\n\r\n    this.activeSubscriptions = this.bybitService.getActiveSubscriptions();\r\n  }\r\n\r\n  startTickerTest(): void {\r\n    this.log('Starting Bybit V5 WebSocket ticker test...');\r\n    this.isRunning = true;\r\n    this.latestData = [];\r\n\r\n    // Subscribe to real-time BTCUSDT ticker data\r\n    this.subscription = this.bybitService.subscribeToRealtimeTicker('BTCUSDT').subscribe({\r\n      next: (data) => {\r\n        this.log(`üìà Ticker Data: Price=${data.lastPrice}, Change=${data.price24hPcnt}%`);\r\n\r\n        // Convert ticker data to display format\r\n        const displayData = {\r\n          time: new Date(data.timestamp).toISOString(),\r\n          open: data.prevPrice24h,\r\n          high: data.highPrice24h,\r\n          low: data.lowPrice24h,\r\n          close: data.lastPrice\r\n        };\r\n\r\n        // Add to latest data (keep only last 10)\r\n        this.latestData.unshift(displayData);\r\n        if (this.latestData.length > 10) {\r\n          this.latestData = this.latestData.slice(0, 10);\r\n        }\r\n      },\r\n      error: (error) => {\r\n        this.log(`‚ùå Error: ${error.message || error}`);\r\n      }\r\n    });\r\n\r\n    this.activeSubscriptions = this.bybitService.getActiveSubscriptions();\r\n  }\r\n\r\n  stopTest(): void {\r\n    this.log('Stopping WebSocket test...');\r\n    this.isRunning = false;\r\n\r\n    if (this.subscription) {\r\n      this.subscription.unsubscribe();\r\n    }\r\n\r\n    // Unsubscribe from both kline and ticker\r\n    this.bybitService.unsubscribeFromRealtimeKline('BTCUSDT', '1');\r\n    this.bybitService.unsubscribeFromRealtimeTicker('BTCUSDT');\r\n    this.activeSubscriptions = this.bybitService.getActiveSubscriptions();\r\n  }\r\n\r\n  formatTime(time: string | number): string {\r\n    const timestamp = typeof time === 'number' ? time * 1000 : new Date(time).getTime();\r\n    return new Date(timestamp).toLocaleTimeString();\r\n  }\r\n\r\n  private log(message: string): void {\r\n    this.logs.unshift({\r\n      time: new Date().toLocaleTimeString(),\r\n      message\r\n    });\r\n\r\n    // Keep only last 50 logs\r\n    if (this.logs.length > 50) {\r\n      this.logs = this.logs.slice(0, 50);\r\n    }\r\n\r\n    console.log(`WebSocket Test: ${message}`);\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\interceptors\\auth.interceptor.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .status on an `any` value.","line":22,"column":61,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":22,"endColumn":67},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .status on an `any` value.","line":23,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":23,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":43,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":43,"endColumn":38}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { HttpInterceptorFn } from '@angular/common/http';\r\nimport { inject } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { catchError } from 'rxjs/operators';\r\nimport { throwError } from 'rxjs';\r\n\r\nexport const authInterceptor: HttpInterceptorFn = (req, next) => {\r\n  const router = inject(Router);\r\n  const token = localStorage.getItem('auth_token');\r\n\r\n  if (token) {\r\n    const authReq = req.clone({\r\n      headers: req.headers\r\n        .set('Authorization', `Bearer ${token}`)\r\n        .set('Cache-Control', 'no-cache, no-store, must-revalidate')\r\n        .set('Pragma', 'no-cache')\r\n        .set('Expires', '0')\r\n    });\r\n\r\n    return next(authReq).pipe(\r\n      catchError((error) => {\r\n        console.log('Auth interceptor caught error:', error.status, error);\r\n        if (error.status === 401) {\r\n          console.log('401 error - handling session expiry');\r\n\r\n          // Clear auth data from localStorage\r\n          localStorage.removeItem('auth_token');\r\n          localStorage.removeItem('user_data');\r\n\r\n          // Only redirect if not already on login page\r\n          if (!router.url.includes('/login')) {\r\n            console.log('Redirecting to login from:', router.url);\r\n            router.navigate(['/login'], {\r\n              queryParams: {\r\n                returnUrl: router.url,\r\n                reason: 'session_expired'\r\n              }\r\n            });\r\n          } else {\r\n            console.log('Already on login page, not redirecting');\r\n          }\r\n        }\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n\r\n  // Add cache-control headers even for requests without auth token\r\n  const noCacheReq = req.clone({\r\n    headers: req.headers\r\n      .set('Cache-Control', 'no-cache, no-store, must-revalidate')\r\n      .set('Pragma', 'no-cache')\r\n      .set('Expires', '0')\r\n  });\r\n\r\n  return next(noCacheReq);\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\models\\exchange-credentials.model.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1404,1407],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1404,1407],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":133,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":133,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3386,3389],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3386,3389],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":168,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":168,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4113,4116],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4113,4116],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":250,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":250,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6509,6512],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6509,6512],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .id on an `any` value.","line":254,"column":16,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":254,"endColumn":18},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .userId on an `any` value.","line":255,"column":16,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":255,"endColumn":22},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exchange on an `any` value.","line":256,"column":46,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":256,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .apiKeyPreview on an `any` value.","line":257,"column":16,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":257,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .isActive on an `any` value.","line":258,"column":16,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":258,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":265,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":265,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6948,6951],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6948,6951],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .success on an `any` value.","line":269,"column":14,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":269,"endColumn":21},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .error on an `any` value.","line":270,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":270,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .error on an `any` value.","line":271,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":271,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .error on an `any` value.","line":272,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":272,"endColumn":26},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":540,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":540,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14601,14604],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14601,14604],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":541,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":541,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14623,14626],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14623,14626],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":16,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Exchange Credentials Type Definitions\r\n *\r\n * Complete type system for exchange credentials management with testnet/mainnet support.\r\n */\r\n\r\n// ============================================================================\r\n// ENUMS\r\n// ============================================================================\r\n\r\n/**\r\n * Supported cryptocurrency exchange platforms\r\n */\r\nexport enum ExchangeType {\r\n  BYBIT = 'BYBIT',\r\n  BINANCE = 'BINANCE',\r\n  OKX = 'OKX',\r\n  COINBASE = 'COINBASE',\r\n  KRAKEN = 'KRAKEN',\r\n  BINGX = 'BINGX',\r\n  MEXC = 'MEXC',\r\n  GATEIO = 'GATEIO',\r\n  BITGET = 'BITGET'\r\n}\r\n\r\n\r\n/**\r\n * Credential status\r\n */\r\nexport enum CredentialStatus {\r\n  ACTIVE = 'ACTIVE',\r\n  INACTIVE = 'INACTIVE',\r\n  ERROR = 'ERROR',\r\n  EXPIRED = 'EXPIRED',\r\n  INSUFFICIENT_PERMISSIONS = 'INSUFFICIENT_PERMISSIONS'\r\n}\r\n\r\n// ============================================================================\r\n// CORE DOMAIN MODELS\r\n// ============================================================================\r\n\r\n/**\r\n * Exchange Credential Entity\r\n * Represents a single API credential for an exchange\r\n */\r\nexport interface ExchangeCredential {\r\n  id: string;\r\n  userId: string;\r\n  exchange: ExchangeType;\r\n  apiKeyPreview: string;\r\n  label?: string;\r\n  isActive: boolean;\r\n  status?: CredentialStatus;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n  lastConnectedAt?: string;\r\n  metadata?: Record<string, any>;\r\n}\r\n\r\n// ============================================================================\r\n// REQUEST/RESPONSE MODELS\r\n// ============================================================================\r\n\r\n/**\r\n * Request to create a new exchange credential\r\n */\r\nexport interface CreateExchangeCredentialRequest {\r\n  exchange: ExchangeType;\r\n  apiKey: string;\r\n  apiSecret: string;\r\n  authToken?: string; // Browser session token (for MEXC futures trading)\r\n  label?: string;\r\n  isActive?: boolean; // Optional flag to set credential as active (defaults to true)\r\n}\r\n\r\n/**\r\n * Request to update an existing credential\r\n * All fields are optional - only provided fields will be updated\r\n */\r\nexport interface UpdateExchangeCredentialRequest {\r\n  label?: string;\r\n  apiKey?: string;\r\n  apiSecret?: string;\r\n  authToken?: string; // Browser session token (for MEXC)\r\n  isActive?: boolean;  // Set active status (true/false) - no automatic deactivation of others\r\n}\r\n\r\n/**\r\n * Response for single credential operations\r\n */\r\nexport interface ExchangeCredentialResponse {\r\n  success: boolean;\r\n  data: ExchangeCredential;\r\n  message?: string;\r\n  timestamp: string;\r\n}\r\n\r\n/**\r\n * Response for list operations\r\n */\r\nexport interface ExchangeCredentialsListResponse {\r\n  success: boolean;\r\n  data: {\r\n    credentials: ExchangeCredential[];\r\n    totalCount: number;\r\n    activeCredentials?: Record<ExchangeType, ExchangeCredential>;\r\n  };\r\n  timestamp: string;\r\n}\r\n\r\n/**\r\n * Request to test credential connection\r\n */\r\nexport interface TestConnectionRequest {\r\n  exchange: ExchangeType;\r\n  apiKey: string;\r\n  apiSecret: string;\r\n  authToken?: string; // Browser session token (for MEXC)\r\n}\r\n\r\n/**\r\n * Response for connection test\r\n */\r\nexport interface TestConnectionResponse {\r\n  success: boolean;\r\n  message: string;\r\n  accountPreview?: {\r\n    accountId?: string;\r\n    totalEquity?: string;\r\n    totalBalance?: string;\r\n    currency?: string;\r\n    accountType?: string;\r\n    [key: string]: any;\r\n  };\r\n  permissions?: string[];\r\n  warnings?: string[];\r\n  timestamp: string;\r\n}\r\n\r\n/**\r\n * Request to activate a credential\r\n */\r\nexport interface ActivateCredentialRequest {\r\n  credentialId: string;\r\n}\r\n\r\n/**\r\n * Response for delete operation\r\n */\r\nexport interface DeleteCredentialResponse {\r\n  success: boolean;\r\n  message: string;\r\n  timestamp: string;\r\n}\r\n\r\n// ============================================================================\r\n// ERROR MODELS\r\n// ============================================================================\r\n\r\n/**\r\n * Generic error response from API\r\n */\r\nexport interface ExchangeCredentialError {\r\n  success: false;\r\n  error: {\r\n    code: string;\r\n    message: string;\r\n    details?: any;\r\n    fieldErrors?: Record<string, string[]>;\r\n  };\r\n  timestamp: string;\r\n}\r\n\r\n/**\r\n * Error codes that can be returned from the API\r\n */\r\nexport enum ExchangeCredentialErrorCode {\r\n  INVALID_API_KEY = 'INVALID_API_KEY',\r\n  INVALID_API_SECRET = 'INVALID_API_SECRET',\r\n  INVALID_EXCHANGE = 'INVALID_EXCHANGE',\r\n  INVALID_ENVIRONMENT = 'INVALID_ENVIRONMENT',\r\n  DUPLICATE_CREDENTIAL = 'DUPLICATE_CREDENTIAL',\r\n  CREDENTIAL_NOT_FOUND = 'CREDENTIAL_NOT_FOUND',\r\n  CANNOT_DELETE_ACTIVE_CREDENTIAL = 'CANNOT_DELETE_ACTIVE_CREDENTIAL',\r\n  EXCHANGE_API_ERROR = 'EXCHANGE_API_ERROR',\r\n  EXCHANGE_CONNECTION_FAILED = 'EXCHANGE_CONNECTION_FAILED',\r\n  EXCHANGE_RATE_LIMITED = 'EXCHANGE_RATE_LIMITED',\r\n  INSUFFICIENT_PERMISSIONS = 'INSUFFICIENT_PERMISSIONS',\r\n  INTERNAL_SERVER_ERROR = 'INTERNAL_SERVER_ERROR',\r\n  DATABASE_ERROR = 'DATABASE_ERROR',\r\n  UNAUTHORIZED = 'UNAUTHORIZED',\r\n  FORBIDDEN = 'FORBIDDEN'\r\n}\r\n\r\n// ============================================================================\r\n// UI-SPECIFIC MODELS\r\n// ============================================================================\r\n\r\n/**\r\n * Credential display model with computed properties\r\n */\r\nexport interface CredentialDisplayModel extends ExchangeCredential {\r\n  exchangeName: string;\r\n  exchangeLogo: string;\r\n  statusColor: string;\r\n  createdAtFormatted: string;\r\n  updatedAtFormatted: string;\r\n}\r\n\r\n/**\r\n * Form model for credential creation/editing\r\n */\r\nexport interface CredentialFormModel {\r\n  exchange: ExchangeType | null;\r\n  apiKey: string;\r\n  apiSecret: string;\r\n  label: string;\r\n}\r\n\r\n/**\r\n * Filter options for credential list\r\n */\r\nexport interface CredentialFilterOptions {\r\n  exchange?: ExchangeType;\r\n  isActive?: boolean;\r\n  searchQuery?: string;\r\n  sortBy?: 'createdAt' | 'updatedAt' | 'exchange' | 'label';\r\n  sortDirection?: 'asc' | 'desc';\r\n}\r\n\r\n/**\r\n * Grouped credentials by exchange\r\n */\r\nexport interface GroupedCredentials {\r\n  exchange: ExchangeType;\r\n  exchangeName: string;\r\n  exchangeLogo: string;\r\n  credentials: ExchangeCredential[];\r\n  activeCredential: ExchangeCredential | null;\r\n  count: number;\r\n}\r\n\r\n// ============================================================================\r\n// TYPE GUARDS\r\n// ============================================================================\r\n\r\n/**\r\n * Type guard to check if object is ExchangeCredential\r\n */\r\nexport function isExchangeCredential(obj: any): obj is ExchangeCredential {\r\n  return (\r\n    typeof obj === 'object' &&\r\n    obj !== null &&\r\n    typeof obj.id === 'string' &&\r\n    typeof obj.userId === 'string' &&\r\n    Object.values(ExchangeType).includes(obj.exchange) &&\r\n    typeof obj.apiKeyPreview === 'string' &&\r\n    typeof obj.isActive === 'boolean'\r\n  );\r\n}\r\n\r\n/**\r\n * Type guard to check if response is an error\r\n */\r\nexport function isExchangeCredentialError(response: any): response is ExchangeCredentialError {\r\n  return (\r\n    typeof response === 'object' &&\r\n    response !== null &&\r\n    response.success === false &&\r\n    typeof response.error === 'object' &&\r\n    typeof response.error.code === 'string' &&\r\n    typeof response.error.message === 'string'\r\n  );\r\n}\r\n\r\n/**\r\n * Type guard to check if string is valid ExchangeType\r\n */\r\nexport function isValidExchangeType(value: string): value is ExchangeType {\r\n  return Object.values(ExchangeType).includes(value as ExchangeType);\r\n}\r\n\r\n\r\n// ============================================================================\r\n// CONSTANTS\r\n// ============================================================================\r\n\r\n/**\r\n * Exchange metadata - display names, logos, colors, etc.\r\n */\r\nexport const EXCHANGE_METADATA: Record<ExchangeType, {\r\n  name: string;\r\n  logo: string;\r\n  color: string;\r\n  website: string;\r\n  supportsTestnet: boolean;\r\n}> = {\r\n  [ExchangeType.BYBIT]: {\r\n    name: 'Bybit',\r\n    logo: '/assets/images/exchanges/bybit.svg',\r\n    color: '#F7A600',\r\n    website: 'https://www.bybit.com',\r\n    supportsTestnet: false\r\n  },\r\n  [ExchangeType.BINANCE]: {\r\n    name: 'Binance',\r\n    logo: '/assets/images/exchanges/binance.svg',\r\n    color: '#F3BA2F',\r\n    website: 'https://www.binance.com',\r\n    supportsTestnet: false\r\n  },\r\n  [ExchangeType.OKX]: {\r\n    name: 'OKX',\r\n    logo: '/assets/images/exchanges/okx.svg',\r\n    color: '#000000',\r\n    website: 'https://www.okx.com',\r\n    supportsTestnet: false\r\n  },\r\n  [ExchangeType.COINBASE]: {\r\n    name: 'Coinbase',\r\n    logo: '/assets/images/exchanges/coinbase.svg',\r\n    color: '#0052FF',\r\n    website: 'https://www.coinbase.com',\r\n    supportsTestnet: false\r\n  },\r\n  [ExchangeType.KRAKEN]: {\r\n    name: 'Kraken',\r\n    logo: '/assets/images/exchanges/kraken.svg',\r\n    color: '#5741D9',\r\n    website: 'https://www.kraken.com',\r\n    supportsTestnet: false\r\n  },\r\n  [ExchangeType.BINGX]: {\r\n    name: 'BingX',\r\n    logo: '/assets/images/exchanges/bingx.svg',\r\n    color: '#1E73FA',\r\n    website: 'https://www.bingx.com',\r\n    supportsTestnet: false\r\n  },\r\n  [ExchangeType.MEXC]: {\r\n    name: 'MEXC',\r\n    logo: '/assets/images/exchanges/mexc.svg',\r\n    color: '#00D4AA',\r\n    website: 'https://www.mexc.com',\r\n    supportsTestnet: false\r\n  },\r\n  [ExchangeType.GATEIO]: {\r\n    name: 'Gate.io',\r\n    logo: '/assets/images/exchanges/gateio.svg',\r\n    color: '#17E0A4',\r\n    website: 'https://www.gate.io',\r\n    supportsTestnet: false\r\n  },\r\n  [ExchangeType.BITGET]: {\r\n    name: 'Bitget',\r\n    logo: '/assets/images/exchanges/bitget.svg',\r\n    color: '#00F0FF',\r\n    website: 'https://www.bitget.com',\r\n    supportsTestnet: false\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * Status metadata\r\n */\r\nexport const STATUS_METADATA: Record<CredentialStatus, {\r\n  name: string;\r\n  color: string;\r\n  icon: string;\r\n}> = {\r\n  [CredentialStatus.ACTIVE]: {\r\n    name: 'Active',\r\n    color: '#4CAF50',\r\n    icon: 'check_circle'\r\n  },\r\n  [CredentialStatus.INACTIVE]: {\r\n    name: 'Inactive',\r\n    color: '#9E9E9E',\r\n    icon: 'radio_button_unchecked'\r\n  },\r\n  [CredentialStatus.ERROR]: {\r\n    name: 'Error',\r\n    color: '#F44336',\r\n    icon: 'error'\r\n  },\r\n  [CredentialStatus.EXPIRED]: {\r\n    name: 'Expired',\r\n    color: '#FF9800',\r\n    icon: 'schedule'\r\n  },\r\n  [CredentialStatus.INSUFFICIENT_PERMISSIONS]: {\r\n    name: 'Insufficient Permissions',\r\n    color: '#FFC107',\r\n    icon: 'warning'\r\n  }\r\n};\r\n\r\n// ============================================================================\r\n// HELPER FUNCTIONS\r\n// ============================================================================\r\n\r\n/**\r\n * Get exchange display name\r\n */\r\nexport function getExchangeName(exchange: ExchangeType): string {\r\n  return EXCHANGE_METADATA[exchange]?.name ?? exchange;\r\n}\r\n\r\n/**\r\n * Get exchange logo URL\r\n */\r\nexport function getExchangeLogo(exchange: ExchangeType): string {\r\n  return EXCHANGE_METADATA[exchange]?.logo ?? '/assets/images/exchanges/default.svg';\r\n}\r\n\r\n/**\r\n * Get exchange color\r\n */\r\nexport function getExchangeColor(exchange: ExchangeType): string {\r\n  return EXCHANGE_METADATA[exchange]?.color ?? '#000000';\r\n}\r\n\r\n\r\n/**\r\n * Get status display name\r\n */\r\nexport function getStatusName(status: CredentialStatus): string {\r\n  return STATUS_METADATA[status]?.name ?? status;\r\n}\r\n\r\n/**\r\n * Get status color\r\n */\r\nexport function getStatusColor(status: CredentialStatus): string {\r\n  return STATUS_METADATA[status]?.color ?? '#000000';\r\n}\r\n\r\n/**\r\n * Check if exchange supports testnet\r\n */\r\nexport function exchangeSupportsTestnet(exchange: ExchangeType): boolean {\r\n  return EXCHANGE_METADATA[exchange]?.supportsTestnet ?? false;\r\n}\r\n\r\n/**\r\n * Mask API key for display - shows only last 4 characters\r\n */\r\nexport function maskApiKey(apiKey: string): string {\r\n  if (!apiKey || apiKey.length <= 4) {\r\n    return '****';\r\n  }\r\n  return '****' + apiKey.slice(-4);\r\n}\r\n\r\n/**\r\n * Convert credential to display model\r\n */\r\nexport function toDisplayModel(credential: ExchangeCredential): CredentialDisplayModel {\r\n  return {\r\n    ...credential,\r\n    exchangeName: getExchangeName(credential.exchange),\r\n    exchangeLogo: getExchangeLogo(credential.exchange),\r\n    statusColor: credential.status ? getStatusColor(credential.status) : '#9E9E9E',\r\n    createdAtFormatted: formatRelativeTime(credential.createdAt),\r\n    updatedAtFormatted: formatRelativeTime(credential.updatedAt)\r\n  };\r\n}\r\n\r\n/**\r\n * Format date as relative time (e.g., \"2 hours ago\")\r\n */\r\nexport function formatRelativeTime(dateString: string): string {\r\n  const date = new Date(dateString);\r\n  const now = new Date();\r\n  const diffMs = now.getTime() - date.getTime();\r\n  const diffSec = Math.floor(diffMs / 1000);\r\n  const diffMin = Math.floor(diffSec / 60);\r\n  const diffHour = Math.floor(diffMin / 60);\r\n  const diffDay = Math.floor(diffHour / 24);\r\n\r\n  if (diffSec < 60) return 'just now';\r\n  if (diffMin < 60) return `${diffMin} minute${diffMin !== 1 ? 's' : ''} ago`;\r\n  if (diffHour < 24) return `${diffHour} hour${diffHour !== 1 ? 's' : ''} ago`;\r\n  if (diffDay < 30) return `${diffDay} day${diffDay !== 1 ? 's' : ''} ago`;\r\n\r\n  return date.toLocaleDateString();\r\n}\r\n\r\n/**\r\n * Group credentials by exchange\r\n */\r\nexport function groupCredentialsByExchange(credentials: ExchangeCredential[]): GroupedCredentials[] {\r\n  const grouped = new Map<ExchangeType, ExchangeCredential[]>();\r\n\r\n  credentials.forEach(cred => {\r\n    const existing = grouped.get(cred.exchange) ?? [];\r\n    grouped.set(cred.exchange, [...existing, cred]);\r\n  });\r\n\r\n  return Array.from(grouped.entries()).map(([exchange, creds]) => ({\r\n    exchange,\r\n    exchangeName: getExchangeName(exchange),\r\n    exchangeLogo: getExchangeLogo(exchange),\r\n    credentials: creds,\r\n    activeCredential: creds.find(c => c.isActive) ?? null,\r\n    count: creds.length\r\n  }));\r\n}\r\n\r\n/**\r\n * Filter credentials based on options\r\n */\r\nexport function filterCredentials(\r\n  credentials: ExchangeCredential[],\r\n  options: CredentialFilterOptions\r\n): ExchangeCredential[] {\r\n  let filtered = [...credentials];\r\n\r\n  if (options.exchange) {\r\n    filtered = filtered.filter(c => c.exchange === options.exchange);\r\n  }\r\n\r\n  if (options.isActive !== undefined) {\r\n    filtered = filtered.filter(c => c.isActive === options.isActive);\r\n  }\r\n\r\n  if (options.searchQuery) {\r\n    const query = options.searchQuery.toLowerCase();\r\n    filtered = filtered.filter(c =>\r\n      c.label?.toLowerCase().includes(query) ||\r\n      c.apiKeyPreview.toLowerCase().includes(query) ||\r\n      getExchangeName(c.exchange).toLowerCase().includes(query)\r\n    );\r\n  }\r\n\r\n  // Sort\r\n  if (options.sortBy) {\r\n    filtered.sort((a, b) => {\r\n      let aVal: any;\r\n      let bVal: any;\r\n\r\n      switch (options.sortBy) {\r\n        case 'createdAt':\r\n          aVal = new Date(a.createdAt).getTime();\r\n          bVal = new Date(b.createdAt).getTime();\r\n          break;\r\n        case 'updatedAt':\r\n          aVal = new Date(a.updatedAt).getTime();\r\n          bVal = new Date(b.updatedAt).getTime();\r\n          break;\r\n        case 'exchange':\r\n          aVal = a.exchange;\r\n          bVal = b.exchange;\r\n          break;\r\n        case 'label':\r\n          aVal = a.label ?? '';\r\n          bVal = b.label ?? '';\r\n          break;\r\n        default:\r\n          return 0;\r\n      }\r\n\r\n      if (aVal < bVal) return options.sortDirection === 'asc' ? -1 : 1;\r\n      if (aVal > bVal) return options.sortDirection === 'asc' ? 1 : -1;\r\n      return 0;\r\n    });\r\n  }\r\n\r\n  return filtered;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\models\\price-arbitrage.model.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":280,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":280,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7639,7642],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7639,7642],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":350,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":350,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9364,9367],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9364,9367],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .success on an `any` value.","line":354,"column":14,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":354,"endColumn":21},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .error on an `any` value.","line":355,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":355,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .error on an `any` value.","line":356,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":356,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .error on an `any` value.","line":357,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":357,"endColumn":26}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Price Arbitrage Types for Angular Frontend\r\n *\r\n * Type definitions for price arbitrage trading system.\r\n * Matches backend types from /backend/src/types/price-arbitrage.ts\r\n */\r\n\r\n/**\r\n * Price arbitrage status enum\r\n */\r\nexport enum PriceArbitrageStatus {\r\n  PENDING = 'PENDING',\r\n  ACTIVE = 'ACTIVE',\r\n  COMPLETED = 'COMPLETED',\r\n  ERROR = 'ERROR',\r\n  CANCELLED = 'CANCELLED'\r\n}\r\n\r\n/**\r\n * Parameters for starting a new price arbitrage position\r\n */\r\nexport interface StartPriceArbitrageParams {\r\n  symbol: string; // Normalized format (e.g., \"BTCUSDT\")\r\n\r\n  // Primary exchange configuration (higher price - SHORT position)\r\n  primaryExchange: string;\r\n  primaryCredentialId: string;\r\n  primaryLeverage: number; // 1-100x\r\n  primaryMargin: number; // USDT amount\r\n\r\n  // Hedge exchange configuration (lower price - LONG position)\r\n  hedgeExchange: string;\r\n  hedgeCredentialId: string;\r\n  hedgeLeverage: number; // 1-100x\r\n  hedgeMargin: number; // USDT amount\r\n\r\n  // Entry prices at time of start\r\n  entryPrimaryPrice: number;\r\n  entryHedgePrice: number;\r\n\r\n  // Convergence configuration (optional)\r\n  targetSpread?: number; // Auto-close when spread <= this (e.g., 0.001 = 0.1%)\r\n  stopLoss?: number; // Stop-loss spread % (e.g., 0.03 = 3%)\r\n  maxHoldingTime?: number; // Max seconds to hold (e.g., 3600 = 1 hour)\r\n}\r\n\r\n/**\r\n * Price arbitrage position state for frontend\r\n */\r\nexport interface PriceArbitragePositionDTO {\r\n  id: string;\r\n  userId: string;\r\n  symbol: string;\r\n\r\n  // Exchanges\r\n  primaryExchange: string;\r\n  hedgeExchange: string;\r\n\r\n  // Configuration\r\n  primaryLeverage: number;\r\n  primaryMargin: number;\r\n  hedgeLeverage: number;\r\n  hedgeMargin: number;\r\n\r\n  // Entry data\r\n  entryPrimaryPrice: number;\r\n  entryHedgePrice: number;\r\n  entrySpread: number;\r\n  entrySpreadPercent: number;\r\n\r\n  // Current data (if active)\r\n  currentPrimaryPrice?: number;\r\n  currentHedgePrice?: number;\r\n  currentSpread?: number;\r\n  currentSpreadPercent?: number;\r\n\r\n  // Exit data (if closed)\r\n  exitPrimaryPrice?: number;\r\n  exitHedgePrice?: number;\r\n  exitSpread?: number;\r\n  exitSpreadPercent?: number;\r\n\r\n  // Financial results\r\n  primaryPnl?: number;\r\n  hedgePnl?: number;\r\n  totalPnl?: number;\r\n  primaryFees: number;\r\n  hedgeFees: number;\r\n\r\n  // Status\r\n  status: PriceArbitrageStatus;\r\n  errorMessage?: string;\r\n\r\n  // Timestamps\r\n  createdAt: Date | string;\r\n  openedAt?: Date | string;\r\n  closedAt?: Date | string;\r\n  holdingTimeSeconds?: number;\r\n}\r\n\r\n/**\r\n * Arbitrage opportunity (combined price + funding rate arbitrage)\r\n */\r\nexport interface PriceArbitrageOpportunity {\r\n  symbol: string;\r\n\r\n  // Exchange with higher price (PRIMARY - will open SHORT)\r\n  primaryExchange: {\r\n    name: string;\r\n    credentialId: string;\r\n    price: number;\r\n    environment: string;\r\n  };\r\n\r\n  // Exchange with lower price (HEDGE - will open LONG)\r\n  hedgeExchange: {\r\n    name: string;\r\n    credentialId: string;\r\n    price: number;\r\n    environment: string;\r\n  };\r\n\r\n  // Price spread\r\n  spread: number; // As decimal (e.g., 0.015 = 1.5%)\r\n  spreadPercent: number; // As percentage (e.g., 1.5)\r\n\r\n  // Opportunity flags\r\n  arbitrageOpportunity: boolean; // true if spread > threshold\r\n\r\n  // Additional exchange data\r\n  allExchanges: {\r\n    exchange: string;\r\n    credentialId: string;\r\n    price: number;\r\n    environment: string;\r\n  }[];\r\n\r\n  // NEW FIELDS FOR COMBINED STRATEGY\r\n  // Funding rate data (optional - may not be available for all symbols)\r\n  primaryFundingRate?: number; // Funding rate on primary exchange (% per interval)\r\n  hedgeFundingRate?: number; // Funding rate on hedge exchange (% per interval)\r\n  primaryFundingInterval?: string; // Funding interval (e.g., \"1h\", \"4h\", \"8h\")\r\n  hedgeFundingInterval?: string; // Funding interval (e.g., \"1h\", \"4h\", \"8h\")\r\n  fundingDifferential?: number; // Difference in funding rates (% per 8h - normalized)\r\n\r\n  // Combined strategy metrics (LEGACY - simple calculations)\r\n  combinedScore?: number; // Combined score (price spread + funding)\r\n  expectedDailyReturn?: number; // Expected daily return (%) - LEGACY\r\n  estimatedMonthlyROI?: number; // Estimated monthly ROI (%) - LEGACY\r\n\r\n  // REALISTIC METRICS - based on historical data (NEW)\r\n  realisticMetrics?: {\r\n    // Daily return scenarios (%)\r\n    dailyReturn: {\r\n      pessimistic: number; // avg - 1 stddev\r\n      realistic: number; // avg\r\n      optimistic: number; // avg + 1 stddev\r\n    };\r\n    // Monthly ROI scenarios (%)\r\n    monthlyROI: {\r\n      pessimistic: number;\r\n      realistic: number;\r\n      optimistic: number;\r\n    };\r\n    // Confidence score (0-100)\r\n    // Higher = more reliable historical data\r\n    confidence: number;\r\n    // Data quality indicators\r\n    dataPoints?: number; // Number of historical samples\r\n    historicalPeriodDays?: number; // Period of analysis (usually 7 days)\r\n  };\r\n\r\n  // Strategy type\r\n  strategyType: 'price_only' | 'funding_only' | 'combined'; // Type of strategy\r\n\r\n  // NEW FIELDS FOR SPOT+FUTURES STRATEGY DISPLAY\r\n  // Best exchange for funding (positive funding - where you go LONG spot + SHORT futures)\r\n  bestFundingExchange?: {\r\n    exchange: string;\r\n    fundingRate: number; // As decimal (e.g., 0.001 = 0.1%)\r\n    nextFundingTime: number; // Timestamp in milliseconds\r\n    currentPrice: number;\r\n  };\r\n\r\n  // Best exchange for shorting (negative funding - where you go SHORT)\r\n  bestShortExchange?: {\r\n    exchange: string;\r\n    fundingRate: number; // As decimal (e.g., -0.001 = -0.1%)\r\n    nextFundingTime: number; // Timestamp in milliseconds\r\n    currentPrice: number;\r\n  };\r\n}\r\n\r\n/**\r\n * API Response wrapper for single position\r\n */\r\nexport interface PriceArbitragePositionResponse {\r\n  success: boolean;\r\n  data: PriceArbitragePositionDTO;\r\n  message?: string;\r\n  timestamp: string;\r\n}\r\n\r\n/**\r\n * API Response wrapper for position list\r\n */\r\nexport interface PriceArbitragePositionListResponse {\r\n  success: boolean;\r\n  data: PriceArbitragePositionDTO[]; // Direct array, not nested\r\n  pagination?: {\r\n    total: number;\r\n    limit: number;\r\n    offset: number;\r\n    hasMore: boolean;\r\n  };\r\n  timestamp: string;\r\n}\r\n\r\n/**\r\n * API Response wrapper for opportunities\r\n */\r\nexport interface PriceArbitrageOpportunitiesResponse {\r\n  success: boolean;\r\n  data: PriceArbitrageOpportunity[]; // Direct array, not nested\r\n  stats?: {\r\n    totalOpportunities: number;\r\n    combinedStrategy: number; // Number of combined strategy opportunities\r\n    priceOnly: number; // Number of price-only opportunities\r\n    minSpread: number;\r\n    exchangesAnalyzed: number;\r\n    fundingDataAvailable: boolean; // Whether funding data is available\r\n  };\r\n  timestamp: string;\r\n}\r\n\r\n/**\r\n * Funding Rate Data (from /api/funding-rates endpoint)\r\n */\r\nexport interface FundingRateData {\r\n  exchange: string;\r\n  symbol: string;\r\n  fundingRate: number; // percentage (e.g., 0.01 = 0.01%)\r\n  credentialId: string;\r\n  environment: string;\r\n}\r\n\r\n/**\r\n * API Response wrapper for funding rates (hybrid approach)\r\n */\r\nexport interface FundingRatesResponse {\r\n  success: boolean;\r\n  data: FundingRateData[];\r\n  timestamp: string;\r\n  cached: boolean; // indicates if data is from cache\r\n}\r\n\r\n/**\r\n * API Response wrapper for close position operation\r\n */\r\nexport interface ClosePositionResponse {\r\n  success: boolean;\r\n  data: {\r\n    position: PriceArbitragePositionDTO;\r\n    totalPnl: number;\r\n    primaryPnl: number;\r\n    hedgePnl: number;\r\n  };\r\n  message?: string;\r\n  timestamp: string;\r\n}\r\n\r\n/**\r\n * Error response from API\r\n */\r\nexport interface PriceArbitrageError {\r\n  success: false;\r\n  error: {\r\n    code: string;\r\n    message: string;\r\n    details?: any;\r\n  };\r\n  timestamp: string;\r\n}\r\n\r\n/**\r\n * Position profit calculation for display\r\n */\r\nexport interface PositionProfitDisplay {\r\n  unrealizedPnl: number;\r\n  unrealizedPnlPercent: number;\r\n  color: 'green' | 'red' | 'gray';\r\n  textClass: string;\r\n}\r\n\r\n/**\r\n * Position holding time display\r\n */\r\nexport interface HoldingTimeDisplay {\r\n  hours: number;\r\n  minutes: number;\r\n  seconds: number;\r\n  formatted: string;\r\n}\r\n\r\n/**\r\n * Helper function to calculate holding time\r\n */\r\nexport function calculateHoldingTime(openedAt: Date | string): HoldingTimeDisplay {\r\n  const opened = typeof openedAt === 'string' ? new Date(openedAt) : openedAt;\r\n  const now = new Date();\r\n  const diffMs = now.getTime() - opened.getTime();\r\n  const diffSeconds = Math.floor(diffMs / 1000);\r\n\r\n  const hours = Math.floor(diffSeconds / 3600);\r\n  const minutes = Math.floor((diffSeconds % 3600) / 60);\r\n  const seconds = diffSeconds % 60;\r\n\r\n  return {\r\n    hours,\r\n    minutes,\r\n    seconds,\r\n    formatted: `${hours}h ${minutes}m ${seconds}s`\r\n  };\r\n}\r\n\r\n/**\r\n * Helper function to format P&L display\r\n */\r\nexport function formatPnlDisplay(pnl: number | undefined): PositionProfitDisplay {\r\n  if (pnl === undefined || pnl === null) {\r\n    return {\r\n      unrealizedPnl: 0,\r\n      unrealizedPnlPercent: 0,\r\n      color: 'gray',\r\n      textClass: 'text-gray-500'\r\n    };\r\n  }\r\n\r\n  return {\r\n    unrealizedPnl: pnl,\r\n    unrealizedPnlPercent: 0, // Calculated separately if needed\r\n    color: pnl > 0 ? 'green' : pnl < 0 ? 'red' : 'gray',\r\n    textClass: pnl > 0 ? 'text-green-600' : pnl < 0 ? 'text-red-600' : 'text-gray-500'\r\n  };\r\n}\r\n\r\n/**\r\n * Type guard to check if response is an error\r\n */\r\nexport function isPriceArbitrageError(response: any): response is PriceArbitrageError {\r\n  return (\r\n    typeof response === 'object' &&\r\n    response !== null &&\r\n    response.success === false &&\r\n    typeof response.error === 'object' &&\r\n    typeof response.error.code === 'string' &&\r\n    typeof response.error.message === 'string'\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\models\\triangular-arbitrage.model.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":213,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":213,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6093,6096],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6093,6096],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Triangular Arbitrage Models\r\n *\r\n * Defines all TypeScript interfaces and types for the triangular arbitrage feature\r\n */\r\n\r\n/**\r\n * Exchange identifier\r\n */\r\nexport type Exchange = 'BYBIT' | 'BINANCE' | 'BINGX' | 'MEXC' | 'GATEIO' | 'BITGET' | 'OKX';\r\n\r\n/**\r\n * Trading triangle direction\r\n */\r\nexport type TriangleDirection = 'forward' | 'backward';\r\n\r\n/**\r\n * Position status through execution lifecycle\r\n */\r\nexport type PositionStatus = 'pending' | 'executing' | 'completed' | 'failed' | 'cancelled';\r\n\r\n/**\r\n * Individual leg status\r\n */\r\nexport type LegStatus = 'pending' | 'executing' | 'completed' | 'error';\r\n\r\n/**\r\n * Scanner status\r\n */\r\nexport type ScannerStatus = 'stopped' | 'scanning' | 'error';\r\n\r\n/**\r\n * Triangle path configuration\r\n * Represents the three assets in a triangular arbitrage path\r\n */\r\nexport interface TrianglePath {\r\n  assetA: string;  // Starting asset (e.g., 'USDT')\r\n  assetB: string;  // Intermediate asset 1 (e.g., 'BTC')\r\n  assetC: string;  // Intermediate asset 2 (e.g., 'ETH')\r\n  direction: TriangleDirection;\r\n}\r\n\r\n/**\r\n * Price information for a trading pair\r\n */\r\nexport interface PairPrice {\r\n  symbol: string;       // e.g., 'BTC/USDT'\r\n  bidPrice: number;     // Best bid price\r\n  askPrice: number;     // Best ask price\r\n  lastPrice: number;    // Last traded price\r\n  timestamp: number;\r\n}\r\n\r\n/**\r\n * Arbitrage opportunity detected by the scanner\r\n */\r\nexport interface TriangularOpportunity {\r\n  id: string;\r\n  exchange: Exchange;\r\n  triangle: TrianglePath;\r\n\r\n  // Price information for each leg\r\n  leg1: PairPrice;  // Asset A ‚Üí Asset B\r\n  leg2: PairPrice;  // Asset B ‚Üí Asset C\r\n  leg3: PairPrice;  // Asset C ‚Üí Asset A\r\n\r\n  // Profitability metrics\r\n  profitPercentage: number;         // Theoretical profit in % (mid prices, no spread)\r\n  profitAmount: number;              // Theoretical profit in starting asset (USDT)\r\n  estimatedSlippage: number;         // Estimated slippage in %\r\n  netProfitPercentage: number;       // Profit after fees and slippage (legacy calculation)\r\n  realisticProfitPercentage?: number; // Realistic profit accounting for bid/ask spread, fees, slippage, cost buffer\r\n  realisticProfitAmount?: number;     // Realistic profit in starting asset (USDT)\r\n\r\n  // Metadata\r\n  detectedAt: number;            // Timestamp when detected\r\n  expiresAt?: number;            // Optional expiration timestamp\r\n  volume24h?: number;            // 24h volume indicator\r\n\r\n  // Execution readiness\r\n  isExecutable: boolean;         // Whether it meets execution criteria\r\n  warningMessage?: string;       // Optional warning about execution\r\n}\r\n\r\n/**\r\n * Scanner configuration\r\n * Note: credentialId is optional - backend auto-selects active credential for the exchange\r\n */\r\nexport interface ScannerConfig {\r\n  exchange: Exchange;\r\n  credentialId?: string;         // Optional: ID of exchange credentials (auto-selected if not provided)\r\n  minProfitPercentage: number;   // Minimum profit % to detect (default: 0.1)\r\n  maxSlippage: number;           // Maximum acceptable slippage % (default: 0.1)\r\n  positionSize: number;          // Position size in USDT\r\n  autoExecute: boolean;          // Whether to auto-execute opportunities\r\n  trianglePaths?: TrianglePath[]; // Specific paths to scan (optional)\r\n}\r\n\r\n/**\r\n * Scanner statistics\r\n */\r\nexport interface ScannerStats {\r\n  status: ScannerStatus;\r\n  opportunitiesDetectedToday: number;\r\n  opportunitiesExecutedToday: number;\r\n  totalProfitToday: number;      // Total profit in USDT\r\n  avgProfitPercentage: number;\r\n  scanningDuration: number;       // Time in ms scanner has been running\r\n  lastOpportunityAt?: number;     // Timestamp of last opportunity\r\n}\r\n\r\n/**\r\n * Individual execution leg\r\n */\r\nexport interface ExecutionLeg {\r\n  legNumber: 1 | 2 | 3;\r\n  symbol: string;              // Trading pair symbol\r\n  side: 'buy' | 'sell';\r\n  status: LegStatus;\r\n\r\n  // Order details\r\n  orderId?: string;\r\n  targetQuantity: number;\r\n  filledQuantity: number;\r\n  averagePrice?: number;\r\n\r\n  // Execution metrics\r\n  estimatedPrice: number;\r\n  actualPrice?: number;\r\n  slippage?: number;           // Actual slippage in %\r\n  fee?: number;                // Trading fee in quote asset\r\n  feePercentage?: number;      // Fee as percentage\r\n\r\n  // Timing\r\n  startedAt?: number;\r\n  completedAt?: number;\r\n  executionTimeMs?: number;\r\n\r\n  // Error handling\r\n  error?: string;\r\n  retryCount?: number;\r\n}\r\n\r\n/**\r\n * Triangular arbitrage position\r\n */\r\nexport interface TriangularPosition {\r\n  id: string;\r\n  opportunityId: string;\r\n\r\n  // Configuration\r\n  exchange: Exchange;\r\n  triangle: TrianglePath;\r\n  config: ScannerConfig;\r\n\r\n  // Status\r\n  status: PositionStatus;\r\n\r\n  // Financial metrics\r\n  entryAmount: number;         // Starting amount in USDT\r\n  expectedProfit: number;      // Expected profit in USDT\r\n  expectedProfitPercentage: number;\r\n  actualProfit?: number;       // Actual profit in USDT (when completed)\r\n  actualProfitPercentage?: number;\r\n\r\n  // Execution details\r\n  legs: [ExecutionLeg, ExecutionLeg, ExecutionLeg];\r\n  totalFees: number;\r\n  totalSlippage: number;\r\n\r\n  // Timing\r\n  createdAt: number;\r\n  startedAt?: number;\r\n  completedAt?: number;\r\n  executionTimeMs?: number;\r\n\r\n  // Error handling\r\n  error?: string;\r\n  errorLeg?: 1 | 2 | 3;        // Which leg failed\r\n}\r\n\r\n/**\r\n * Position filter criteria\r\n */\r\nexport interface PositionFilter {\r\n  status?: PositionStatus[];\r\n  exchange?: Exchange[];\r\n  dateFrom?: Date;\r\n  dateTo?: Date;\r\n  minProfit?: number;\r\n  maxProfit?: number;\r\n}\r\n\r\n/**\r\n * Position summary for display\r\n */\r\nexport interface PositionSummary {\r\n  totalPositions: number;\r\n  activePositions: number;\r\n  completedPositions: number;\r\n  failedPositions: number;\r\n  totalProfit: number;\r\n  totalLoss: number;\r\n  avgProfitPercentage: number;\r\n  successRate: number;          // Percentage of successful executions\r\n}\r\n\r\n/**\r\n * Real-time update message from SSE\r\n */\r\nexport interface TriangularArbitrageUpdate {\r\n  type: 'connected' | 'heartbeat' | 'opportunity' | 'position' | 'scanner' | 'stats' | 'error';\r\n  data: any; // Can be various types depending on event type\r\n  timestamp: number;\r\n}\r\n\r\n/**\r\n * Execution request payload\r\n */\r\nexport interface ExecuteOpportunityRequest {\r\n  opportunityId: string;\r\n  positionSize?: number;        // Override default position size\r\n  maxSlippage?: number;         // Override max slippage\r\n}\r\n\r\n/**\r\n * Execution response\r\n */\r\nexport interface ExecuteOpportunityResponse {\r\n  success: boolean;\r\n  positionId?: string;\r\n  position?: TriangularPosition;\r\n  error?: string;\r\n}\r\n\r\n/**\r\n * Export data format\r\n */\r\nexport interface PositionExportData {\r\n  positions: TriangularPosition[];\r\n  summary: PositionSummary;\r\n  exportedAt: number;\r\n  filters?: PositionFilter;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\pages\\active-arbitrage-positions\\active-arbitrage-positions.component.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'signal' is defined but never used.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":16},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":77,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":81,"endColumn":7},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":82,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":84,"endColumn":7},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":89,"column":43,"nodeType":"Property","messageId":"anyAssignment","endLine":89,"endColumn":77},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":90,"column":40,"nodeType":"Property","messageId":"anyAssignment","endLine":90,"endColumn":71}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { ComponentFixture, TestBed, fakeAsync, tick } from '@angular/core/testing';\r\nimport { signal } from '@angular/core';\r\nimport { of, throwError } from 'rxjs';\r\n\r\nimport { ActiveArbitragePositionsComponent } from './active-arbitrage-positions.component';\r\nimport { PriceArbitrageService } from '../../services/price-arbitrage.service';\r\nimport { TranslationService } from '../../services/translation.service';\r\nimport {\r\n  PriceArbitragePositionDTO,\r\n  PriceArbitrageStatus\r\n} from '../../models/price-arbitrage.model';\r\n\r\ndescribe('ActiveArbitragePositionsComponent', () => {\r\n  let component: ActiveArbitragePositionsComponent;\r\n  let fixture: ComponentFixture<ActiveArbitragePositionsComponent>;\r\n  let mockPriceArbitrageService: jasmine.SpyObj<PriceArbitrageService>;\r\n  let mockTranslationService: jasmine.SpyObj<TranslationService>;\r\n\r\n  const mockPositions: PriceArbitragePositionDTO[] = [\r\n    {\r\n      id: '1',\r\n      userId: 'user1',\r\n      symbol: 'BTCUSDT',\r\n      primaryExchange: 'BYBIT',\r\n      hedgeExchange: 'BINGX',\r\n      primaryLeverage: 10,\r\n      primaryMargin: 1000,\r\n      hedgeLeverage: 10,\r\n      hedgeMargin: 1000,\r\n      entryPrimaryPrice: 50000,\r\n      entryHedgePrice: 49925,\r\n      entrySpread: 75,\r\n      entrySpreadPercent: 0.15,\r\n      currentPrimaryPrice: 50050,\r\n      currentHedgePrice: 49990,\r\n      currentSpread: 60,\r\n      currentSpreadPercent: 0.12,\r\n      primaryFees: 10,\r\n      hedgeFees: 10,\r\n      status: PriceArbitrageStatus.ACTIVE,\r\n      createdAt: new Date('2023-01-01T09:30:00Z').toISOString(),\r\n      openedAt: new Date('2023-01-01T10:00:00Z').toISOString(),\r\n      totalPnl: 150.50\r\n    },\r\n    {\r\n      id: '2',\r\n      userId: 'user1',\r\n      symbol: 'ETHUSDT',\r\n      primaryExchange: 'BINGX',\r\n      hedgeExchange: 'BYBIT',\r\n      primaryLeverage: 5,\r\n      primaryMargin: 500,\r\n      hedgeLeverage: 5,\r\n      hedgeMargin: 500,\r\n      entryPrimaryPrice: 3000,\r\n      entryHedgePrice: 2994,\r\n      entrySpread: 6,\r\n      entrySpreadPercent: 0.20,\r\n      exitPrimaryPrice: 2998,\r\n      exitHedgePrice: 2992,\r\n      exitSpread: 6,\r\n      exitSpreadPercent: 0.20,\r\n      primaryPnl: 40,\r\n      hedgePnl: 35.25,\r\n      totalPnl: 75.25,\r\n      primaryFees: 5,\r\n      hedgeFees: 5,\r\n      status: PriceArbitrageStatus.COMPLETED,\r\n      createdAt: new Date('2023-01-01T08:30:00Z').toISOString(),\r\n      openedAt: new Date('2023-01-01T09:00:00Z').toISOString(),\r\n      closedAt: new Date('2023-01-01T11:00:00Z').toISOString(),\r\n      holdingTimeSeconds: 7200\r\n    }\r\n  ];\r\n\r\n  beforeEach(async () => {\r\n    const priceArbitrageServiceSpy = jasmine.createSpyObj('PriceArbitrageService', [\r\n      'getPositions',\r\n      'closePosition',\r\n      'calculateUnrealizedPnl'\r\n    ]);\r\n    const translationServiceSpy = jasmine.createSpyObj('TranslationService', [\r\n      'translate'\r\n    ]);\r\n\r\n    await TestBed.configureTestingModule({\r\n      imports: [ActiveArbitragePositionsComponent],\r\n      providers: [\r\n        { provide: PriceArbitrageService, useValue: priceArbitrageServiceSpy },\r\n        { provide: TranslationService, useValue: translationServiceSpy }\r\n      ]\r\n    }).compileComponents();\r\n\r\n    fixture = TestBed.createComponent(ActiveArbitragePositionsComponent);\r\n    component = fixture.componentInstance;\r\n    mockPriceArbitrageService = TestBed.inject(PriceArbitrageService) as jasmine.SpyObj<PriceArbitrageService>;\r\n    mockTranslationService = TestBed.inject(TranslationService) as jasmine.SpyObj<TranslationService>;\r\n\r\n    // Setup default mocks\r\n    mockPriceArbitrageService.getPositions.and.returnValue(of(mockPositions));\r\n    mockPriceArbitrageService.calculateUnrealizedPnl.and.returnValue(150.50);\r\n    mockTranslationService.translate.and.returnValue('Mock Translation');\r\n  });\r\n\r\n  describe('Component Initialization', () => {\r\n    it('should create', () => {\r\n      expect(component).toBeTruthy();\r\n    });\r\n\r\n    it('should load positions on init', () => {\r\n      component.ngOnInit();\r\n      \r\n      expect(mockPriceArbitrageService.getPositions).toHaveBeenCalledWith(PriceArbitrageStatus.ACTIVE);\r\n      expect(component.positions()).toEqual(mockPositions);\r\n      expect(component.isLoading()).toBe(false);\r\n    });\r\n\r\n    it('should start auto-refresh on init', fakeAsync(() => {\r\n      component.ngOnInit();\r\n      tick(5000);\r\n      \r\n      expect(mockPriceArbitrageService.getPositions).toHaveBeenCalledTimes(2);\r\n    }));\r\n\r\n    it('should stop auto-refresh on destroy', () => {\r\n      component.ngOnInit();\r\n      spyOn(component['refreshSubscription']!, 'unsubscribe');\r\n      \r\n      component.ngOnDestroy();\r\n      \r\n      expect(component['refreshSubscription']!.unsubscribe).toHaveBeenCalled();\r\n    });\r\n  });\r\n\r\n  describe('Position Loading', () => {\r\n    it('should set loading state while fetching positions', () => {\r\n      component.loadPositions();\r\n      \r\n      expect(component.isLoading()).toBe(true);\r\n      expect(component.error()).toBe(null);\r\n    });\r\n\r\n    it('should handle loading error', () => {\r\n      const errorMessage = 'Failed to load positions';\r\n      mockPriceArbitrageService.getPositions.and.returnValue(throwError(() => new Error(errorMessage)));\r\n      \r\n      component.loadPositions();\r\n      \r\n      expect(component.isLoading()).toBe(false);\r\n      expect(component.error()).toBe(errorMessage);\r\n      expect(component.positions()).toEqual([]);\r\n    });\r\n\r\n    it('should pass correct status filter to service', () => {\r\n      component.selectedStatus.set(PriceArbitrageStatus.COMPLETED);\r\n      \r\n      component.loadPositions();\r\n      \r\n      expect(mockPriceArbitrageService.getPositions).toHaveBeenCalledWith(PriceArbitrageStatus.COMPLETED);\r\n    });\r\n\r\n    it('should pass undefined when ALL filter is selected', () => {\r\n      component.selectedStatus.set('ALL');\r\n      \r\n      component.loadPositions();\r\n      \r\n      expect(mockPriceArbitrageService.getPositions).toHaveBeenCalledWith(undefined);\r\n    });\r\n  });\r\n\r\n  describe('Status Filtering', () => {\r\n    beforeEach(() => {\r\n      component.positions.set(mockPositions);\r\n    });\r\n\r\n    it('should filter positions by status', () => {\r\n      component.selectedStatus.set(PriceArbitrageStatus.ACTIVE);\r\n      \r\n      const filtered = component.filteredPositions();\r\n      \r\n      expect(filtered.length).toBe(1);\r\n      expect(filtered[0].status).toBe(PriceArbitrageStatus.ACTIVE);\r\n    });\r\n\r\n    it('should show all positions when ALL filter is selected', () => {\r\n      component.selectedStatus.set('ALL');\r\n      \r\n      const filtered = component.filteredPositions();\r\n      \r\n      expect(filtered.length).toBe(2);\r\n    });\r\n\r\n    it('should reload positions when filter changes', () => {\r\n      spyOn(component, 'loadPositions');\r\n      \r\n      component.changeStatusFilter(PriceArbitrageStatus.COMPLETED);\r\n      \r\n      expect(component.selectedStatus()).toBe(PriceArbitrageStatus.COMPLETED);\r\n      expect(component.loadPositions).toHaveBeenCalled();\r\n    });\r\n  });\r\n\r\n  describe('Position Statistics', () => {\r\n    beforeEach(() => {\r\n      component.positions.set(mockPositions);\r\n    });\r\n\r\n    it('should calculate active count correctly', () => {\r\n      expect(component.activeCount()).toBe(1);\r\n    });\r\n\r\n    it('should calculate completed count correctly', () => {\r\n      expect(component.completedCount()).toBe(1);\r\n    });\r\n\r\n    it('should calculate error count correctly', () => {\r\n      expect(component.errorCount()).toBe(0);\r\n    });\r\n  });\r\n\r\n  describe('Position Closing', () => {\r\n    const mockPosition = mockPositions[0];\r\n    const mockCloseResult = {\r\n      position: { ...mockPosition, status: PriceArbitrageStatus.COMPLETED },\r\n      totalPnl: 150.50,\r\n      primaryPnl: 75.25,\r\n      hedgePnl: 75.25\r\n    };\r\n\r\n    beforeEach(() => {\r\n      component.positions.set(mockPositions);\r\n    });\r\n\r\n    it('should open close dialog', () => {\r\n      component.openCloseDialog(mockPosition);\r\n      \r\n      expect(component.showCloseDialog()).toBe(true);\r\n      expect(component.positionToClose()).toBe(mockPosition);\r\n    });\r\n\r\n    it('should cancel close dialog', () => {\r\n      component.positionToClose.set(mockPosition);\r\n      component.showCloseDialog.set(true);\r\n      \r\n      component.cancelClose();\r\n      \r\n      expect(component.showCloseDialog()).toBe(false);\r\n      expect(component.positionToClose()).toBe(null);\r\n    });\r\n\r\n    it('should close position successfully', () => {\r\n      mockPriceArbitrageService.closePosition.and.returnValue(of(mockCloseResult));\r\n      spyOn(window, 'alert');\r\n      component.positionToClose.set(mockPosition);\r\n      \r\n      component.confirmClose();\r\n      \r\n      expect(mockPriceArbitrageService.closePosition).toHaveBeenCalledWith(mockPosition.id);\r\n      expect(component.showCloseDialog()).toBe(false);\r\n      expect(component.positionToClose()).toBe(null);\r\n      expect(component.isClosing()).toBe(false);\r\n      expect(window.alert).toHaveBeenCalled();\r\n    });\r\n\r\n    it('should handle close position error', () => {\r\n      const errorMessage = 'Failed to close position';\r\n      mockPriceArbitrageService.closePosition.and.returnValue(throwError(() => new Error(errorMessage)));\r\n      spyOn(window, 'alert');\r\n      component.positionToClose.set(mockPosition);\r\n      \r\n      component.confirmClose();\r\n      \r\n      expect(component.isClosing()).toBe(false);\r\n      expect(window.alert).toHaveBeenCalled();\r\n    });\r\n\r\n    it('should update position in list after successful close', () => {\r\n      mockPriceArbitrageService.closePosition.and.returnValue(of(mockCloseResult));\r\n      spyOn(window, 'alert');\r\n      component.positionToClose.set(mockPosition);\r\n      \r\n      component.confirmClose();\r\n      \r\n      const updatedPositions = component.positions();\r\n      const closedPosition = updatedPositions.find(p => p.id === mockPosition.id);\r\n      expect(closedPosition?.status).toBe(PriceArbitrageStatus.COMPLETED);\r\n    });\r\n\r\n    it('should do nothing if no position to close', () => {\r\n      component.positionToClose.set(null);\r\n      \r\n      component.confirmClose();\r\n      \r\n      expect(mockPriceArbitrageService.closePosition).not.toHaveBeenCalled();\r\n    });\r\n  });\r\n\r\n  describe('Display Methods', () => {\r\n    const mockPosition = mockPositions[0];\r\n\r\n    it('should get unrealized PnL', () => {\r\n      const result = component.getUnrealizedPnl(mockPosition);\r\n      \r\n      expect(mockPriceArbitrageService.calculateUnrealizedPnl).toHaveBeenCalledWith(mockPosition);\r\n      expect(result).toBe(150.50);\r\n    });\r\n\r\n    it('should format entry spread display', () => {\r\n      const result = component.getEntrySpreadDisplay(mockPosition);\r\n      \r\n      expect(result).toBe('0.1500%');\r\n    });\r\n\r\n    it('should format current spread display', () => {\r\n      const result = component.getCurrentSpreadDisplay(mockPosition);\r\n      \r\n      expect(result).toBe('0.1200%');\r\n    });\r\n\r\n    it('should return N/A for undefined current spread', () => {\r\n      const positionWithoutSpread = { ...mockPosition, currentSpreadPercent: undefined };\r\n      mockTranslationService.translate.and.returnValue('N/A');\r\n      \r\n      const result = component.getCurrentSpreadDisplay(positionWithoutSpread);\r\n      \r\n      expect(result).toBe('N/A');\r\n    });\r\n\r\n    it('should format price correctly', () => {\r\n      const result = component.formatPrice(50000.123);\r\n      \r\n      expect(result).toBe('$50000.12');\r\n    });\r\n\r\n    it('should format positive PnL correctly', () => {\r\n      const result = component.formatPnl(150.50);\r\n      \r\n      expect(result).toBe('+$150.50');\r\n    });\r\n\r\n    it('should format negative PnL correctly', () => {\r\n      const result = component.formatPnl(-75.25);\r\n      \r\n      expect(result).toBe('-$75.25');\r\n    });\r\n\r\n    it('should return N/A for undefined PnL', () => {\r\n      mockTranslationService.translate.and.returnValue('N/A');\r\n      \r\n      const result = component.formatPnl(undefined);\r\n      \r\n      expect(result).toBe('N/A');\r\n    });\r\n\r\n    it('should get correct status class', () => {\r\n      expect(component.getStatusClass(PriceArbitrageStatus.ACTIVE)).toBe('status-active');\r\n      expect(component.getStatusClass(PriceArbitrageStatus.COMPLETED)).toBe('status-completed');\r\n      expect(component.getStatusClass(PriceArbitrageStatus.ERROR)).toBe('status-error');\r\n      expect(component.getStatusClass(PriceArbitrageStatus.PENDING)).toBe('status-pending');\r\n      expect(component.getStatusClass(PriceArbitrageStatus.CANCELLED)).toBe('status-cancelled');\r\n    });\r\n\r\n    it('should call translation service', () => {\r\n      const key = 'test.key';\r\n      \r\n      component.translate(key);\r\n      \r\n      expect(mockTranslationService.translate).toHaveBeenCalledWith(key);\r\n    });\r\n  });\r\n\r\n  describe('Auto Refresh', () => {\r\n    it('should refresh positions automatically', fakeAsync(() => {\r\n      component.ngOnInit();\r\n      \r\n      // Initial load\r\n      expect(mockPriceArbitrageService.getPositions).toHaveBeenCalledTimes(1);\r\n      \r\n      // After 5 seconds\r\n      tick(5000);\r\n      expect(mockPriceArbitrageService.getPositions).toHaveBeenCalledTimes(2);\r\n      \r\n      // After another 5 seconds\r\n      tick(5000);\r\n      expect(mockPriceArbitrageService.getPositions).toHaveBeenCalledTimes(3);\r\n    }));\r\n\r\n    it('should handle refresh errors silently', fakeAsync(() => {\r\n      component.ngOnInit();\r\n      \r\n      // Make subsequent calls fail\r\n      mockPriceArbitrageService.getPositions.and.returnValue(throwError(() => new Error('Refresh error')));\r\n      \r\n      tick(5000);\r\n      \r\n      // Should not affect component state\r\n      expect(component.positions()).toEqual(mockPositions);\r\n      expect(component.isLoading()).toBe(false);\r\n    }));\r\n\r\n    it('should use current filter status in auto refresh', fakeAsync(() => {\r\n      component.selectedStatus.set(PriceArbitrageStatus.COMPLETED);\r\n      component.ngOnInit();\r\n      \r\n      tick(5000);\r\n      \r\n      expect(mockPriceArbitrageService.getPositions).toHaveBeenCalledWith(PriceArbitrageStatus.COMPLETED);\r\n    }));\r\n  });\r\n});","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\pages\\active-arbitrage-positions\\active-arbitrage-positions.component.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":198,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":198,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":365,"column":78,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":365,"endColumn":85},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'key' is assigned a value but never used.","line":460,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":460,"endColumn":16}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, OnInit, OnDestroy, inject, signal, computed, effect } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { interval, Subscription, forkJoin } from 'rxjs';\r\nimport { switchMap } from 'rxjs/operators';\r\n\r\nimport { PriceArbitrageService } from '../../services/price-arbitrage.service';\r\nimport { GraduatedEntryService, GraduatedEntryPosition } from '../../services/graduated-entry.service';\r\nimport { RealtimeService, PriceUpdate } from '../../services/realtime.service';\r\nimport { TranslationService } from '../../services/translation.service';\r\nimport {\r\n  PriceArbitragePositionDTO,\r\n  PriceArbitrageStatus,\r\n  calculateHoldingTime,\r\n  formatPnlDisplay\r\n} from '../../models/price-arbitrage.model';\r\n\r\nimport { CardComponent, CardHeaderComponent, CardTitleComponent, CardContentComponent } from '../../components/ui/card/card.component';\r\nimport { ButtonComponent } from '../../components/ui/button/button.component';\r\nimport { DialogComponent, DialogHeaderComponent, DialogTitleComponent, DialogContentComponent, DialogFooterComponent } from '../../components/ui/dialog/dialog.component';\r\n\r\n// Unified position interface combining both Price Arbitrage and Graduated Entry\r\ninterface UnifiedArbitragePosition {\r\n  id: string;\r\n  type: 'price' | 'graduated';\r\n  symbol: string;\r\n  primaryExchange: string;\r\n  hedgeExchange: string;\r\n  primaryLeverage: number;\r\n  hedgeLeverage: number;\r\n  primaryMargin: number;\r\n  hedgeMargin: number;\r\n  primarySide: string;\r\n  hedgeSide: string;\r\n  status: string;\r\n  entryPrimaryPrice: number;\r\n  entryHedgePrice: number;\r\n  currentPrimaryPrice?: number;\r\n  currentHedgePrice?: number;\r\n  entrySpreadPercent: number;\r\n  currentSpreadPercent?: number;\r\n  grossProfit: number;\r\n  netProfit: number;\r\n  totalFundingEarned: number;\r\n  totalFees: number;\r\n  unrealizedPnl: number;\r\n  openedAt?: Date;\r\n  // Original position data\r\n  original: PriceArbitragePositionDTO | GraduatedEntryPosition;\r\n}\r\n\r\n@Component({\r\n  selector: 'app-active-arbitrage-positions',\r\n  standalone: true,\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    CardComponent,\r\n    CardHeaderComponent,\r\n    CardTitleComponent,\r\n    CardContentComponent,\r\n    ButtonComponent,\r\n    DialogComponent,\r\n    DialogHeaderComponent,\r\n    DialogTitleComponent,\r\n    DialogContentComponent,\r\n    DialogFooterComponent\r\n  ],\r\n  templateUrl: './active-arbitrage-positions.component.html',\r\n  styleUrl: './active-arbitrage-positions.component.scss'\r\n})\r\nexport class ActiveArbitragePositionsComponent implements OnInit, OnDestroy {\r\n  private priceArbitrageService = inject(PriceArbitrageService);\r\n  private graduatedEntryService = inject(GraduatedEntryService);\r\n  private realtimeService = inject(RealtimeService);\r\n  private translationService = inject(TranslationService);\r\n\r\n  positions = signal<UnifiedArbitragePosition[]>([]);\r\n  isLoading = signal<boolean>(false);\r\n  error = signal<string | null>(null);\r\n  selectedStatus = signal<'ALL' | PriceArbitrageStatus>(PriceArbitrageStatus.ACTIVE);\r\n\r\n  showCloseDialog = signal<boolean>(false);\r\n  positionToClose = signal<UnifiedArbitragePosition | null>(null);\r\n  isClosing = signal<boolean>(false);\r\n\r\n  // Real-time price cache: Map<exchange:symbol, price>\r\n  private priceCache = signal<Map<string, number>>(new Map());\r\n\r\n  // Positions with real-time calculated profits\r\n  positionsWithRealtimeProfit = computed(() => {\r\n    const positions = this.positions();\r\n    const prices = this.priceCache();\r\n\r\n    return positions.map(pos => {\r\n      // Get real-time prices from cache\r\n      const primaryKey = `${pos.primaryExchange}:${pos.symbol}`;\r\n      const hedgeKey = `${pos.hedgeExchange}:${pos.symbol}`;\r\n\r\n      const primaryPrice = prices.get(primaryKey);\r\n      const hedgePrice = prices.get(hedgeKey);\r\n\r\n      // If we have real-time prices, recalculate profits\r\n      if (primaryPrice && hedgePrice) {\r\n        const realtimeProfit = this.calculateRealtimeProfit(pos, primaryPrice, hedgePrice);\r\n        return {\r\n          ...pos,\r\n          currentPrimaryPrice: primaryPrice,\r\n          currentHedgePrice: hedgePrice,\r\n          grossProfit: realtimeProfit.grossProfit,\r\n          netProfit: realtimeProfit.netProfit,\r\n          unrealizedPnl: realtimeProfit.totalUnrealizedPnl\r\n        };\r\n      }\r\n\r\n      // Return original position if no real-time prices\r\n      return pos;\r\n    });\r\n  });\r\n\r\n  private refreshSubscription?: Subscription;\r\n  private priceSubscription?: Subscription;\r\n  private readonly REFRESH_INTERVAL = 5000;\r\n\r\n  // Effect to resubscribe to symbols when positions change\r\n  constructor() {\r\n    effect(() => {\r\n      const positions = this.positions();\r\n      if (positions.length > 0) {\r\n        // Resubscribe to all position symbols whenever positions change\r\n        const symbols = new Set(positions.map(p => p.symbol));\r\n        symbols.forEach(symbol => {\r\n          if (!this.realtimeService.isConnected(symbol)) {\r\n            this.realtimeService.subscribeToSymbol(symbol);\r\n          }\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  filteredPositions = computed(() => {\r\n    const status = this.selectedStatus();\r\n    const allPositions = this.positionsWithRealtimeProfit(); // Use real-time calculated positions\r\n\r\n    if (status === 'ALL') {\r\n      return allPositions;\r\n    }\r\n\r\n    return allPositions.filter(p => p.status === status);\r\n  });\r\n\r\n  activeCount = computed(() =>\r\n    this.positions().filter(p => p.status === PriceArbitrageStatus.ACTIVE).length\r\n  );\r\n\r\n  completedCount = computed(() =>\r\n    this.positions().filter(p => p.status === PriceArbitrageStatus.COMPLETED).length\r\n  );\r\n\r\n  errorCount = computed(() =>\r\n    this.positions().filter(p => p.status === PriceArbitrageStatus.ERROR).length\r\n  );\r\n\r\n  ngOnInit(): void {\r\n    this.loadPositions();\r\n    this.startAutoRefresh();\r\n    this.subscribeToRealtimePrices();\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.stopAutoRefresh();\r\n    this.unsubscribeFromRealtimePrices();\r\n  }\r\n\r\n  loadPositions(): void {\r\n    this.isLoading.set(true);\r\n    this.error.set(null);\r\n\r\n    const status = this.selectedStatus() === 'ALL' ? undefined : this.selectedStatus();\r\n\r\n    // Load both Price Arbitrage and Graduated Entry positions in parallel\r\n    forkJoin({\r\n      priceArbitrage: this.priceArbitrageService.getPositions(status as PriceArbitrageStatus | undefined),\r\n      graduatedEntry: this.graduatedEntryService.getPositions(false) // Only active positions\r\n    }).subscribe({\r\n      next: ({ priceArbitrage, graduatedEntry }) => {\r\n        // Convert both types to unified format\r\n        const unifiedPositions: UnifiedArbitragePosition[] = [\r\n          ...this.convertPriceArbitragePositions(priceArbitrage),\r\n          ...this.convertGraduatedEntryPositions(graduatedEntry)\r\n        ];\r\n\r\n        this.positions.set(unifiedPositions);\r\n        this.isLoading.set(false);\r\n      },\r\n      error: (err) => {\r\n        console.error('Error loading positions:', err);\r\n        this.error.set(err.message || 'Failed to load positions');\r\n        this.isLoading.set(false);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Convert Price Arbitrage positions to unified format\r\n   */\r\n  private convertPriceArbitragePositions(positions: PriceArbitragePositionDTO[]): UnifiedArbitragePosition[] {\r\n    return positions.map(pos => ({\r\n      id: pos.id,\r\n      type: 'price' as const,\r\n      symbol: pos.symbol,\r\n      primaryExchange: pos.primaryExchange,\r\n      hedgeExchange: pos.hedgeExchange,\r\n      primaryLeverage: pos.primaryLeverage,\r\n      hedgeLeverage: pos.hedgeLeverage,\r\n      primaryMargin: pos.primaryMargin,\r\n      hedgeMargin: pos.hedgeMargin,\r\n      primarySide: 'SHORT', // Price arbitrage is always SHORT primary\r\n      hedgeSide: 'LONG', // and LONG hedge\r\n      status: pos.status,\r\n      entryPrimaryPrice: pos.entryPrimaryPrice,\r\n      entryHedgePrice: pos.entryHedgePrice,\r\n      currentPrimaryPrice: pos.currentPrimaryPrice,\r\n      currentHedgePrice: pos.currentHedgePrice,\r\n      entrySpreadPercent: pos.entrySpreadPercent,\r\n      currentSpreadPercent: pos.currentSpreadPercent,\r\n      grossProfit: pos.totalPnl || 0,\r\n      netProfit: pos.totalPnl || 0,\r\n      totalFundingEarned: 0, // Price arbitrage doesn't track funding separately\r\n      totalFees: pos.primaryFees + pos.hedgeFees,\r\n      unrealizedPnl: this.priceArbitrageService.calculateUnrealizedPnl(pos),\r\n      openedAt: pos.openedAt ? (typeof pos.openedAt === 'string' ? new Date(pos.openedAt) : pos.openedAt) : undefined,\r\n      original: pos\r\n    }));\r\n  }\r\n\r\n  /**\r\n   * Convert Graduated Entry positions to unified format\r\n   */\r\n  private convertGraduatedEntryPositions(positions: GraduatedEntryPosition[]): UnifiedArbitragePosition[] {\r\n    return positions.map(pos => {\r\n      // Calculate entry spread percent\r\n      const primaryEntryPrice = pos.primary.entryPrice || 0;\r\n      const hedgeEntryPrice = pos.hedge.entryPrice || 0;\r\n      const entrySpreadPercent = primaryEntryPrice > 0\r\n        ? ((hedgeEntryPrice - primaryEntryPrice) / primaryEntryPrice) * 100\r\n        : 0;\r\n\r\n      // Calculate current spread percent\r\n      const primaryCurrentPrice = pos.primary.currentPrice || primaryEntryPrice;\r\n      const hedgeCurrentPrice = pos.hedge.currentPrice || hedgeEntryPrice;\r\n      const currentSpreadPercent = primaryCurrentPrice > 0\r\n        ? ((hedgeCurrentPrice - primaryCurrentPrice) / primaryCurrentPrice) * 100\r\n        : 0;\r\n\r\n      // Backend already handles funding check (returns 0 if fundingUpdateCount === 0)\r\n      const totalFundingEarned = pos.primary.totalFundingEarned + pos.hedge.totalFundingEarned;\r\n\r\n      return {\r\n        id: pos.positionId,\r\n        type: 'graduated' as const,\r\n        symbol: pos.symbol,\r\n        primaryExchange: pos.primary.exchange,\r\n        hedgeExchange: pos.hedge.exchange,\r\n        primaryLeverage: pos.primary.leverage,\r\n        hedgeLeverage: pos.hedge.leverage,\r\n        primaryMargin: (pos.primary.entryPrice || 0) * (pos.primary.filledQuantity || 0) / pos.primary.leverage,\r\n        hedgeMargin: (pos.hedge.entryPrice || 0) * (pos.hedge.filledQuantity || 0) / pos.hedge.leverage,\r\n        primarySide: pos.primary.side,\r\n        hedgeSide: pos.hedge.side,\r\n        status: pos.status.toUpperCase(),\r\n        entryPrimaryPrice: primaryEntryPrice,\r\n        entryHedgePrice: hedgeEntryPrice,\r\n        currentPrimaryPrice: primaryCurrentPrice,\r\n        currentHedgePrice: hedgeCurrentPrice,\r\n        entrySpreadPercent,\r\n        currentSpreadPercent,\r\n        // Backend already calculated with actual funding only\r\n        grossProfit: pos.grossProfit,\r\n        netProfit: pos.netProfit,\r\n        totalFundingEarned,\r\n        totalFees: pos.primary.tradingFees + pos.hedge.tradingFees,\r\n        unrealizedPnl: pos.totalUnrealizedPnl,\r\n        openedAt: pos.startedAt,\r\n        original: pos\r\n      };\r\n    });\r\n  }\r\n\r\n  private startAutoRefresh(): void {\r\n    this.refreshSubscription = interval(this.REFRESH_INTERVAL)\r\n      .pipe(\r\n        switchMap(() => {\r\n          const status = this.selectedStatus() === 'ALL' ? undefined : this.selectedStatus();\r\n          return forkJoin({\r\n            priceArbitrage: this.priceArbitrageService.getPositions(status as PriceArbitrageStatus | undefined),\r\n            graduatedEntry: this.graduatedEntryService.getPositions(false)\r\n          });\r\n        })\r\n      )\r\n      .subscribe({\r\n        next: ({ priceArbitrage, graduatedEntry }) => {\r\n          const unifiedPositions: UnifiedArbitragePosition[] = [\r\n            ...this.convertPriceArbitragePositions(priceArbitrage),\r\n            ...this.convertGraduatedEntryPositions(graduatedEntry)\r\n          ];\r\n          this.positions.set(unifiedPositions);\r\n        },\r\n        error: (err) => {\r\n          console.error('Error refreshing positions:', err);\r\n        }\r\n      });\r\n  }\r\n\r\n  private stopAutoRefresh(): void {\r\n    if (this.refreshSubscription) {\r\n      this.refreshSubscription.unsubscribe();\r\n    }\r\n  }\r\n\r\n  changeStatusFilter(status: 'ALL' | PriceArbitrageStatus): void {\r\n    this.selectedStatus.set(status);\r\n    this.loadPositions();\r\n  }\r\n\r\n  openCloseDialog(position: UnifiedArbitragePosition): void {\r\n    // Only allow closing Price Arbitrage positions for now\r\n    // Graduated Entry positions have their own closing mechanism\r\n    if (position.type !== 'price') {\r\n      alert('Graduated Entry positions cannot be closed from this page.');\r\n      return;\r\n    }\r\n    this.positionToClose.set(position);\r\n    this.showCloseDialog.set(true);\r\n  }\r\n\r\n  cancelClose(): void {\r\n    this.showCloseDialog.set(false);\r\n    this.positionToClose.set(null);\r\n  }\r\n\r\n  confirmClose(): void {\r\n    const position = this.positionToClose();\r\n    if (!position || position.type !== 'price') return;\r\n\r\n    this.isClosing.set(true);\r\n\r\n    this.priceArbitrageService.closePosition(position.id)\r\n      .subscribe({\r\n        next: (result) => {\r\n          console.log('Position closed successfully:', result);\r\n\r\n          // Reload all positions after closing\r\n          this.loadPositions();\r\n\r\n          this.showCloseDialog.set(false);\r\n          this.positionToClose.set(null);\r\n          this.isClosing.set(false);\r\n\r\n          alert(`${this.translate('arbitrage.positions.close.success')} Total P&L: $${result.totalPnl.toFixed(2)}`);\r\n        },\r\n        error: (err) => {\r\n          console.error('Error closing position:', err);\r\n          this.isClosing.set(false);\r\n          alert(`${this.translate('arbitrage.positions.close.error')}: ${err.message}`);\r\n        }\r\n      });\r\n  }\r\n\r\n  getUnrealizedPnl(position: UnifiedArbitragePosition): number {\r\n    return position.unrealizedPnl;\r\n  }\r\n\r\n  getPnlDisplay(position: UnifiedArbitragePosition) {\r\n    const pnl = this.getUnrealizedPnl(position);\r\n    return formatPnlDisplay(pnl);\r\n  }\r\n\r\n  getHoldingTimeDisplay(position: UnifiedArbitragePosition): string {\r\n    if (!position.openedAt) return this.translate('arbitrage.positions.na');\r\n    return calculateHoldingTime(position.openedAt).formatted;\r\n  }\r\n\r\n  getCurrentSpreadDisplay(position: UnifiedArbitragePosition): string {\r\n    if (position.currentSpreadPercent !== undefined) {\r\n      return `${position.currentSpreadPercent.toFixed(4)}%`;\r\n    }\r\n    return this.translate('arbitrage.positions.na');\r\n  }\r\n\r\n  getEntrySpreadDisplay(position: UnifiedArbitragePosition): string {\r\n    return `${position.entrySpreadPercent.toFixed(4)}%`;\r\n  }\r\n\r\n  getStatusClass(status: string): string {\r\n    const normalizedStatus = status.toUpperCase();\r\n    switch (normalizedStatus) {\r\n      case 'ACTIVE':\r\n        return 'status-active';\r\n      case 'COMPLETED':\r\n        return 'status-completed';\r\n      case 'ERROR':\r\n        return 'status-error';\r\n      case 'PENDING':\r\n      case 'INITIALIZING':\r\n      case 'EXECUTING':\r\n        return 'status-pending';\r\n      case 'CANCELLED':\r\n        return 'status-cancelled';\r\n      case 'LIQUIDATED':\r\n        return 'status-liquidated';\r\n      default:\r\n        return 'status-unknown';\r\n    }\r\n  }\r\n\r\n  translate(key: string): string {\r\n    return this.translationService.translate(key);\r\n  }\r\n\r\n  formatPrice(price: number): string {\r\n    return `$${price.toFixed(2)}`;\r\n  }\r\n\r\n  formatPnl(pnl: number | undefined): string {\r\n    if (pnl === undefined || pnl === null) return this.translate('arbitrage.positions.na');\r\n    const sign = pnl >= 0 ? '+' : '';\r\n    return `${sign}$${pnl.toFixed(2)}`;\r\n  }\r\n\r\n  formatEntryTime(date: Date | undefined): string {\r\n    if (!date) return this.translate('arbitrage.positions.na');\r\n\r\n    const entryDate = typeof date === 'string' ? new Date(date) : date;\r\n    const now = new Date();\r\n    const diffMs = now.getTime() - entryDate.getTime();\r\n    const diffMins = Math.floor(diffMs / 60000);\r\n\r\n    // If less than 60 minutes, show \"X min ago\"\r\n    if (diffMins < 60) {\r\n      return `${diffMins}m ago`;\r\n    }\r\n\r\n    // Otherwise show time in HH:MM format\r\n    const hours = entryDate.getHours().toString().padStart(2, '0');\r\n    const minutes = entryDate.getMinutes().toString().padStart(2, '0');\r\n    return `${hours}:${minutes}`;\r\n  }\r\n\r\n  getFilterEnumValue(status: string): PriceArbitrageStatus {\r\n    return status as PriceArbitrageStatus;\r\n  }\r\n\r\n  /**\r\n   * Subscribe to real-time price updates for all position symbols\r\n   */\r\n  private subscribeToRealtimePrices(): void {\r\n    this.priceSubscription = this.realtimeService.price$.subscribe((update: PriceUpdate) => {\r\n      // Update price cache with exchange:symbol key\r\n      const key = `${update.symbol}`;\r\n      const currentCache = this.priceCache();\r\n      const newCache = new Map(currentCache);\r\n\r\n      // We need to map this to exchange-specific prices\r\n      // For now, update all exchanges with the same symbol\r\n      this.positions().forEach(pos => {\r\n        if (pos.symbol === update.symbol) {\r\n          newCache.set(`${pos.primaryExchange}:${pos.symbol}`, update.price);\r\n          newCache.set(`${pos.hedgeExchange}:${pos.symbol}`, update.price);\r\n        }\r\n      });\r\n\r\n      this.priceCache.set(newCache);\r\n    });\r\n\r\n    // Subscribe to symbols from positions\r\n    const symbols = new Set(this.positions().map(p => p.symbol));\r\n    symbols.forEach(symbol => {\r\n      this.realtimeService.subscribeToSymbol(symbol);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe from real-time price updates\r\n   */\r\n  private unsubscribeFromRealtimePrices(): void {\r\n    if (this.priceSubscription) {\r\n      this.priceSubscription.unsubscribe();\r\n    }\r\n    this.realtimeService.closeAllConnections();\r\n  }\r\n\r\n  /**\r\n   * Calculate real-time profit for a position using WebSocket prices\r\n   */\r\n  private calculateRealtimeProfit(\r\n    position: UnifiedArbitragePosition,\r\n    primaryPrice: number,\r\n    hedgePrice: number\r\n  ): {\r\n    primaryUnrealizedPnl: number;\r\n    hedgeUnrealizedPnl: number;\r\n    totalUnrealizedPnl: number;\r\n    grossProfit: number;\r\n    netProfit: number;\r\n  } {\r\n    const primaryEntryPrice = position.entryPrimaryPrice || 0;\r\n    const primaryQuantity = position.primaryMargin * position.primaryLeverage / primaryEntryPrice;\r\n\r\n    const hedgeEntryPrice = position.entryHedgePrice || 0;\r\n    const hedgeQuantity = position.hedgeMargin * position.hedgeLeverage / hedgeEntryPrice;\r\n\r\n    // Calculate unrealized PnL for each side\r\n    const primaryUnrealizedPnl = position.primarySide === 'LONG'\r\n      ? (primaryPrice - primaryEntryPrice) * primaryQuantity\r\n      : (primaryEntryPrice - primaryPrice) * primaryQuantity;\r\n\r\n    const hedgeUnrealizedPnl = position.hedgeSide === 'LONG'\r\n      ? (hedgePrice - hedgeEntryPrice) * hedgeQuantity\r\n      : (hedgeEntryPrice - hedgePrice) * hedgeQuantity;\r\n\r\n    const totalUnrealizedPnl = primaryUnrealizedPnl + hedgeUnrealizedPnl;\r\n\r\n    // Calculate entry spread profit\r\n    const primaryNotional = primaryEntryPrice * primaryQuantity;\r\n    const hedgeNotional = hedgeEntryPrice * hedgeQuantity;\r\n    const entrySpreadProfit = position.primarySide === 'LONG'\r\n      ? hedgeNotional - primaryNotional\r\n      : primaryNotional - hedgeNotional;\r\n\r\n    // Total funding earned\r\n    const totalFunding = position.totalFundingEarned;\r\n\r\n    // Real-time Gross Profit = Entry Spread + Funding + Unrealized PnL\r\n    const grossProfit = entrySpreadProfit + totalFunding + totalUnrealizedPnl;\r\n\r\n    // Real-time Net Profit = Gross Profit - Fees\r\n    const netProfit = grossProfit - position.totalFees;\r\n\r\n    return {\r\n      primaryUnrealizedPnl,\r\n      hedgeUnrealizedPnl,\r\n      totalUnrealizedPnl,\r\n      grossProfit,\r\n      netProfit\r\n    };\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\pages\\arbitrage-funding\\arbitrage-funding.component.html","messages":[{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":13,"column":9,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":13,"endColumn":37},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":25,"column":9,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":25,"endColumn":46},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":38,"column":9,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":38,"endColumn":43},{"ruleId":"@angular-eslint/template/click-events-have-key-events","severity":2,"message":"click must be accompanied by either keyup, keydown or keypress event for accessibility.","line":222,"column":17,"nodeType":null,"messageId":"clickEventsHaveKeyEvents","endLine":222,"endColumn":147},{"ruleId":"@angular-eslint/template/interactive-supports-focus","severity":2,"message":"Elements with interaction handlers must be focusable.","line":222,"column":17,"nodeType":null,"messageId":"interactiveSupportsFocus","endLine":222,"endColumn":147},{"ruleId":"@angular-eslint/template/click-events-have-key-events","severity":2,"message":"click must be accompanied by either keyup, keydown or keypress event for accessibility.","line":232,"column":17,"nodeType":null,"messageId":"clickEventsHaveKeyEvents","endLine":232,"endColumn":149},{"ruleId":"@angular-eslint/template/interactive-supports-focus","severity":2,"message":"Elements with interaction handlers must be focusable.","line":232,"column":17,"nodeType":null,"messageId":"interactiveSupportsFocus","endLine":232,"endColumn":149},{"ruleId":"@angular-eslint/template/click-events-have-key-events","severity":2,"message":"click must be accompanied by either keyup, keydown or keypress event for accessibility.","line":303,"column":3,"nodeType":null,"messageId":"clickEventsHaveKeyEvents","endLine":489,"endColumn":9},{"ruleId":"@angular-eslint/template/interactive-supports-focus","severity":2,"message":"Elements with interaction handlers must be focusable.","line":303,"column":3,"nodeType":null,"messageId":"interactiveSupportsFocus","endLine":489,"endColumn":9},{"ruleId":"@angular-eslint/template/click-events-have-key-events","severity":2,"message":"click must be accompanied by either keyup, keydown or keypress event for accessibility.","line":304,"column":5,"nodeType":null,"messageId":"clickEventsHaveKeyEvents","endLine":488,"endColumn":11},{"ruleId":"@angular-eslint/template/interactive-supports-focus","severity":2,"message":"Elements with interaction handlers must be focusable.","line":304,"column":5,"nodeType":null,"messageId":"interactiveSupportsFocus","endLine":488,"endColumn":11},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":336,"column":13,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":341,"endColumn":21},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":355,"column":13,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":360,"endColumn":21},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":399,"column":15,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":405,"endColumn":23},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":429,"column":13,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":435,"endColumn":21},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":450,"column":13,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":455,"endColumn":21}],"suppressedMessages":[],"errorCount":16,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<div class=\"arbitrage-funding-page\">\r\n  <!-- Header -->\r\n  <div class=\"page-header\">\r\n    <h1 class=\"page-title\">Funding Rate Arbitrage</h1>\r\n    <p class=\"page-subtitle\">Public funding rates from all exchanges - No API keys required</p>\r\n  </div>\r\n\r\n  <!-- Controls -->\r\n  <div class=\"controls-section\">\r\n    <div class=\"filters\">\r\n      <!-- Search by symbol -->\r\n      <div class=\"filter-group\">\r\n        <label>Search Symbol</label>\r\n        <input\r\n          type=\"text\"\r\n          placeholder=\"BTC, ETH, SOL...\"\r\n          [(ngModel)]=\"searchQuery\"\r\n          (ngModelChange)=\"searchQuery.set($event)\"\r\n          class=\"search-input\"\r\n        />\r\n      </div>\r\n\r\n      <!-- Minimum funding spread filter -->\r\n      <div class=\"filter-group\">\r\n        <label>Min Funding Spread (%)</label>\r\n        <input\r\n          type=\"number\"\r\n          step=\"0.01\"\r\n          placeholder=\"0.05\"\r\n          [(ngModel)]=\"minFundingSpread\"\r\n          (ngModelChange)=\"minFundingSpread.set($event)\"\r\n          class=\"number-input\"\r\n        />\r\n      </div>\r\n\r\n      <!-- Exchange filter -->\r\n      <div class=\"filter-group exchange-filter-group\">\r\n        <label>Filter by Exchanges</label>\r\n        <div class=\"exchanges-container\">\r\n          <div class=\"exchanges-chips\">\r\n            @for (exchange of availableExchanges(); track exchange) {\r\n              <button\r\n                type=\"button\"\r\n                class=\"exchange-chip\"\r\n                [class.active]=\"isExchangeSelected(exchange)\"\r\n                (click)=\"toggleExchange(exchange)\"\r\n                [title]=\"isExchangeSelected(exchange) ? 'Click to hide ' + exchange : 'Click to show ' + exchange\"\r\n              >\r\n                {{ exchange }}\r\n              </button>\r\n            }\r\n          </div>\r\n          @if (availableExchanges().length > 0) {\r\n            <div class=\"exchange-actions\">\r\n              <button\r\n                type=\"button\"\r\n                class=\"btn-exchange-action\"\r\n                (click)=\"selectAllExchanges()\"\r\n                title=\"Select all exchanges\"\r\n              >\r\n                All\r\n              </button>\r\n              <button\r\n                type=\"button\"\r\n                class=\"btn-exchange-action\"\r\n                (click)=\"deselectAllExchanges()\"\r\n                title=\"Deselect all exchanges\"\r\n              >\r\n                None\r\n              </button>\r\n            </div>\r\n          }\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Clear filters button -->\r\n      <button\r\n        *ngIf=\"searchQuery() || minFundingSpread() || selectedExchanges().size !== availableExchanges().length\"\r\n        (click)=\"clearFilters()\"\r\n        class=\"btn-clear\"\r\n      >\r\n        <ui-icon name=\"clear\" [size]=\"18\"></ui-icon>\r\n        Clear Filters\r\n      </button>\r\n    </div>\r\n\r\n    <!-- Refresh and status -->\r\n    <div class=\"status-section\">\r\n      <div class=\"last-updated\">\r\n        <ui-icon name=\"schedule\" [size]=\"18\"></ui-icon>\r\n        <span>{{ timeSinceUpdate() }}</span>\r\n      </div>\r\n      <button\r\n        (click)=\"openSettingsDialog()\"\r\n        class=\"btn-settings\"\r\n        title=\"Settings\"\r\n      >\r\n        <ui-icon name=\"settings\" [size]=\"20\"></ui-icon>\r\n        Settings\r\n      </button>\r\n      <button\r\n        (click)=\"refresh()\"\r\n        [disabled]=\"isLoading()\"\r\n        class=\"btn-refresh\"\r\n      >\r\n        <ui-icon name=\"refresh\" [size]=\"20\" [class]=\"isLoading() ? 'spinning' : ''\"></ui-icon>\r\n        Refresh\r\n      </button>\r\n    </div>\r\n  </div>\r\n\r\n  <!-- Error message -->\r\n  <div *ngIf=\"error()\" class=\"error-message\">\r\n    <ui-icon name=\"error\" [size]=\"24\"></ui-icon>\r\n    <span>{{ error() }}</span>\r\n  </div>\r\n\r\n  <!-- Loading spinner -->\r\n  <div *ngIf=\"isLoading() && opportunities().length === 0\" class=\"loading-container\">\r\n    <ui-icon name=\"refresh\" [size]=\"40\" class=\"spinning\"></ui-icon>\r\n    <p>Loading funding rates...</p>\r\n  </div>\r\n\r\n  <!-- Opportunities table -->\r\n  <div *ngIf=\"!isLoading() || opportunities().length > 0\" class=\"table-container\">\r\n    <div class=\"results-count\">\r\n      Found {{ filteredOpportunities().length }} opportunities\r\n    </div>\r\n\r\n    <table class=\"opportunities-table\">\r\n      <thead>\r\n        <tr>\r\n          <th (click)=\"toggleSort('symbol')\" class=\"sortable\">\r\n            Symbol\r\n            <ui-icon\r\n              *ngIf=\"sortColumn() === 'symbol'\"\r\n              [name]=\"sortDirection() === 'asc' ? 'arrow_upward' : 'arrow_downward'\"\r\n              [size]=\"16\"\r\n            ></ui-icon>\r\n          </th>\r\n          <th (click)=\"toggleSort('fundingSpread')\" class=\"sortable\">\r\n            Spread\r\n            <ui-icon\r\n              *ngIf=\"sortColumn() === 'fundingSpread'\"\r\n              [name]=\"sortDirection() === 'asc' ? 'arrow_upward' : 'arrow_downward'\"\r\n              [size]=\"16\"\r\n            ></ui-icon>\r\n          </th>\r\n          <th (click)=\"toggleSort('estimatedAPR')\" class=\"sortable\">\r\n            Estimated APR\r\n            <ui-icon\r\n              *ngIf=\"sortColumn() === 'estimatedAPR'\"\r\n              [name]=\"sortDirection() === 'asc' ? 'arrow_upward' : 'arrow_downward'\"\r\n              [size]=\"16\"\r\n            ></ui-icon>\r\n          </th>\r\n          <th>Total Fees</th>\r\n          <th (click)=\"toggleSort('netAPR')\" class=\"sortable\">\r\n            Net APR\r\n            <ui-icon\r\n              *ngIf=\"sortColumn() === 'netAPR'\"\r\n              [name]=\"sortDirection() === 'asc' ? 'arrow_upward' : 'arrow_downward'\"\r\n              [size]=\"16\"\r\n            ></ui-icon>\r\n          </th>\r\n          <th>Best Long</th>\r\n          <th>Best Short</th>\r\n          <th (click)=\"toggleSort('priceSpread')\" class=\"sortable\">\r\n            Price Spread\r\n            <ui-icon\r\n              *ngIf=\"sortColumn() === 'priceSpread'\"\r\n              [name]=\"sortDirection() === 'asc' ? 'arrow_upward' : 'arrow_downward'\"\r\n              [size]=\"16\"\r\n            ></ui-icon>\r\n          </th>\r\n          <th>Volatility (24h)</th>\r\n          <th>24h Volume</th>\r\n          <th>Open Interest</th>\r\n          <th>Actions</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        <ng-container *ngFor=\"let opp of filteredOpportunities()\">\r\n          <tr class=\"opportunity-row\">\r\n            <!-- Symbol -->\r\n            <td class=\"symbol-cell\">\r\n              <span class=\"symbol\" [title]=\"getExchangesTooltip(opp)\">{{ opp.symbol }}</span>\r\n            </td>\r\n\r\n            <!-- Max Funding Spread -->\r\n            <td class=\"funding-spread-cell\">\r\n              <span\r\n                class=\"funding-spread\"\r\n                [ngClass]=\"getFundingSpreadColorClass(opp.maxFundingSpread)\"\r\n              >\r\n                {{ opp.maxFundingSpreadPercent }}\r\n              </span>\r\n            </td>\r\n\r\n            <!-- Estimated APR -->\r\n            <td class=\"estimated-apr-cell\">\r\n              <span class=\"estimated-apr\" [ngClass]=\"getAPRColorClass(opp.estimatedAPR)\">\r\n                {{ opp.estimatedAPRFormatted }}\r\n              </span>\r\n            </td>\r\n\r\n            <!-- Total Fees -->\r\n            <td class=\"total-fees-cell\">\r\n              <span class=\"total-fees\">{{ opp.totalFeesFormatted }}</span>\r\n            </td>\r\n\r\n            <!-- Net APR -->\r\n            <td class=\"net-apr-cell\">\r\n              <span class=\"net-apr\" [ngClass]=\"getAPRColorClass(opp.netAPR)\">\r\n                {{ opp.netAPRFormatted }}\r\n              </span>\r\n            </td>\r\n\r\n            <!-- Best Long -->\r\n            <td class=\"best-long-cell\">\r\n              <div class=\"best-exchange\">\r\n                <span class=\"exchange-name clickable\" (click)=\"openExchange(opp.bestLong.exchange, opp.symbol)\">{{ opp.bestLong.exchange }}</span>\r\n                <span class=\"funding-rate\" [ngClass]=\"getFundingRateColorClass(opp.bestLong.fundingRate)\">{{ formatFundingRate(opp.bestLong.fundingRate) }}</span>\r\n                <span class=\"price\">${{ opp.bestLong.lastPrice }}</span>\r\n                <span class=\"time-to-funding\">{{ formatTimeToFundingWithInterval(opp.bestLong) }}</span>\r\n              </div>\r\n            </td>\r\n\r\n            <!-- Best Short -->\r\n            <td class=\"best-short-cell\">\r\n              <div class=\"best-exchange\">\r\n                <span class=\"exchange-name clickable\" (click)=\"openExchange(opp.bestShort.exchange, opp.symbol)\">{{ opp.bestShort.exchange }}</span>\r\n                <span class=\"funding-rate\" [ngClass]=\"getFundingRateColorClass(opp.bestShort.fundingRate)\">{{ formatFundingRate(opp.bestShort.fundingRate) }}</span>\r\n                <span class=\"price\">${{ opp.bestShort.lastPrice }}</span>\r\n                <span class=\"time-to-funding\">{{ formatTimeToFundingWithInterval(opp.bestShort) }}</span>\r\n              </div>\r\n            </td>\r\n\r\n            <!-- Price Spread -->\r\n            <td class=\"price-spread-cell\">\r\n              <div class=\"price-spread-info\">\r\n                <span class=\"spread-percent\">{{ opp.priceSpreadPercent }}</span>\r\n                <span class=\"spread-usdt\">{{ opp.priceSpreadUsdt }}</span>\r\n              </div>\r\n            </td>\r\n\r\n            <!-- Volatility (24h) -->\r\n            <td class=\"volatility-cell\">\r\n              <span\r\n                class=\"volatility\"\r\n                [ngClass]=\"getVolatilityColorClass(opp.volatility24h)\"\r\n                [title]=\"getVolatilityTooltip(opp.volatility24h)\"\r\n              >\r\n                {{ opp.volatility24hFormatted || '‚Äî' }}\r\n              </span>\r\n            </td>\r\n\r\n            <!-- 24h Volume -->\r\n            <td class=\"volume-cell\">\r\n              <span class=\"volume\">{{ opp.volume24hFormatted || '‚Äî' }}</span>\r\n            </td>\r\n\r\n            <!-- Open Interest -->\r\n            <td class=\"open-interest-cell\">\r\n              <span class=\"open-interest\">{{ opp.openInterestFormatted || '‚Äî' }}</span>\r\n            </td>\r\n\r\n            <!-- Actions -->\r\n            <td class=\"actions-cell\">\r\n              <!-- PHASE2: Button to open details modal -->\r\n              <button\r\n                (click)=\"openDetailsModal(opp)\"\r\n                class=\"btn-expand\"\r\n                title=\"View historical stability metrics\"\r\n              >\r\n                <ui-icon name=\"analytics\" [size]=\"20\"></ui-icon>\r\n              </button>\r\n              <a\r\n                [routerLink]=\"['/arbitrage/chart', opp.symbol, opp.bestLong.exchange, opp.bestShort.exchange]\"\r\n                class=\"btn-view-chart\"\r\n                title=\"View Chart\"\r\n              >\r\n                <ui-icon name=\"show_chart\" [size]=\"18\"></ui-icon>\r\n              </a>\r\n            </td>\r\n          </tr>\r\n        </ng-container>\r\n\r\n        <!-- Empty state -->\r\n        <tr *ngIf=\"filteredOpportunities().length === 0\" class=\"empty-row\">\r\n          <td colspan=\"12\" class=\"empty-cell\">\r\n            <ui-icon name=\"info\" [size]=\"48\"></ui-icon>\r\n            <p>No opportunities found. Try adjusting your filters.</p>\r\n          </td>\r\n        </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n</div>\r\n\r\n<!-- Settings Dialog -->\r\n@if (showSettingsDialog()) {\r\n  <div class=\"settings-overlay\" (click)=\"closeSettingsDialog()\">\r\n    <div class=\"settings-modal\" (click)=\"$event.stopPropagation()\">\r\n      <!-- Header with Gradient -->\r\n      <div class=\"settings-header\">\r\n        <div class=\"settings-header-content\">\r\n          <div class=\"settings-icon\">\r\n            <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n              <path d=\"M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n              <path d=\"M19.4 15C19.2669 15.3016 19.2272 15.6362 19.286 15.9606C19.3448 16.285 19.4995 16.5843 19.73 16.82L19.79 16.88C19.976 17.0657 20.1235 17.2863 20.2241 17.5291C20.3248 17.7719 20.3766 18.0322 20.3766 18.295C20.3766 18.5578 20.3248 18.8181 20.2241 19.0609C20.1235 19.3037 19.976 19.5243 19.79 19.71C19.6043 19.896 19.3837 20.0435 19.1409 20.1441C18.8981 20.2448 18.6378 20.2966 18.375 20.2966C18.1122 20.2966 17.8519 20.2448 17.6091 20.1441C17.3663 20.0435 17.1457 19.896 16.96 19.71L16.9 19.65C16.6643 19.4195 16.365 19.2648 16.0406 19.206C15.7162 19.1472 15.3816 19.1869 15.08 19.32C14.7842 19.4468 14.532 19.6572 14.3543 19.9255C14.1766 20.1938 14.0813 20.5082 14.08 20.83V21C14.08 21.5304 13.8693 22.0391 13.4942 22.4142C13.1191 22.7893 12.6104 23 12.08 23C11.5496 23 11.0409 22.7893 10.6658 22.4142C10.2907 22.0391 10.08 21.5304 10.08 21V20.91C10.0723 20.579 9.96512 20.258 9.77251 19.9887C9.5799 19.7194 9.31074 19.5143 9 19.4C8.69838 19.2669 8.36381 19.2272 8.03941 19.286C7.71502 19.3448 7.41568 19.4995 7.18 19.73L7.12 19.79C6.93425 19.976 6.71368 20.1235 6.47088 20.2241C6.22808 20.3248 5.96783 20.3766 5.705 20.3766C5.44217 20.3766 5.18192 20.3248 4.93912 20.2241C4.69632 20.1235 4.47575 19.976 4.29 19.79C4.10405 19.6043 3.95653 19.3837 3.85588 19.1409C3.75523 18.8981 3.70343 18.6378 3.70343 18.375C3.70343 18.1122 3.75523 17.8519 3.85588 17.6091C3.95653 17.3663 4.10405 17.1457 4.29 16.96L4.35 16.9C4.58054 16.6643 4.73519 16.365 4.794 16.0406C4.85282 15.7162 4.81312 15.3816 4.68 15.08C4.55324 14.7842 4.34276 14.532 4.07447 14.3543C3.80618 14.1766 3.49179 14.0813 3.17 14.08H3C2.46957 14.08 1.96086 13.8693 1.58579 13.4942C1.21071 13.1191 1 12.6104 1 12.08C1 11.5496 1.21071 11.0409 1.58579 10.6658C1.96086 10.2907 2.46957 10.08 3 10.08H3.09C3.42099 10.0723 3.742 9.96512 4.0113 9.77251C4.28059 9.5799 4.48572 9.31074 4.6 9C4.73312 8.69838 4.77282 8.36381 4.714 8.03941C4.65519 7.71502 4.50054 7.41568 4.27 7.18L4.21 7.12C4.02405 6.93425 3.87653 6.71368 3.77588 6.47088C3.67523 6.22808 3.62343 5.96783 3.62343 5.705C3.62343 5.44217 3.67523 5.18192 3.77588 4.93912C3.87653 4.69632 4.02405 4.47575 4.21 4.29C4.39575 4.10405 4.61632 3.95653 4.85912 3.85588C5.10192 3.75523 5.36217 3.70343 5.625 3.70343C5.88783 3.70343 6.14808 3.75523 6.39088 3.85588C6.63368 3.95653 6.85425 4.10405 7.04 4.29L7.1 4.35C7.33568 4.58054 7.63502 4.73519 7.95941 4.794C8.28381 4.85282 8.61838 4.81312 8.92 4.68H9C9.29577 4.55324 9.54802 4.34276 9.72569 4.07447C9.90337 3.80618 9.99872 3.49179 10 3.17V3C10 2.46957 10.2107 1.96086 10.5858 1.58579C10.9609 1.21071 11.4696 1 12 1C12.5304 1 13.0391 1.21071 13.4142 1.58579C13.7893 1.96086 14 2.46957 14 3V3.09C14.0013 3.41179 14.0966 3.72618 14.2743 3.99447C14.452 4.26276 14.7042 4.47324 15 4.6C15.3016 4.73312 15.6362 4.77282 15.9606 4.714C16.285 4.65519 16.5843 4.50054 16.82 4.27L16.88 4.21C17.0657 4.02405 17.2863 3.87653 17.5291 3.77588C17.7719 3.67523 18.0322 3.62343 18.295 3.62343C18.5578 3.62343 18.8181 3.67523 19.0609 3.77588C19.3037 3.87653 19.5243 4.02405 19.71 4.21C19.896 4.39575 20.0435 4.61632 20.1441 4.85912C20.2448 5.10192 20.2966 5.36217 20.2966 5.625C20.2966 5.88783 20.2448 6.14808 20.1441 6.39088C20.0435 6.63368 19.896 6.85425 19.71 7.04L19.65 7.1C19.4195 7.33568 19.2648 7.63502 19.206 7.95941C19.1472 8.28381 19.1869 8.61838 19.32 8.92V9C19.4468 9.29577 19.6572 9.54802 19.9255 9.72569C20.1938 9.90337 20.5082 9.99872 20.83 10H21C21.5304 10 22.0391 10.2107 22.4142 10.5858C22.7893 10.9609 23 11.4696 23 12C23 12.5304 22.7893 13.0391 22.4142 13.4142C22.0391 13.7893 21.5304 14 21 14H20.91C20.5882 14.0013 20.2738 14.0966 20.0055 14.2743C19.7372 14.452 19.5268 14.7042 19.4 15Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n            </svg>\r\n          </div>\r\n          <h3 class=\"settings-title\">{{ translate('fundingRates.settings.title') }}</h3>\r\n        </div>\r\n        <button class=\"settings-close\" (click)=\"closeSettingsDialog()\" aria-label=\"Close\">\r\n          <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n            <path d=\"M18 6L6 18M6 6L18 18\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n          </svg>\r\n        </button>\r\n      </div>\r\n\r\n      <!-- Body with Organized Sections -->\r\n      <div class=\"settings-body\">\r\n        <!-- Trading Configuration Section -->\r\n        <div class=\"settings-section\">\r\n          <div class=\"section-header\">\r\n            <svg class=\"section-icon\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n              <path d=\"M16 21V5C16 4.46957 15.7893 3.96086 15.4142 3.58579C15.0391 3.21071 14.5304 3 14 3H10C9.46957 3 8.96086 3.21071 8.58579 3.58579C8.21071 3.96086 8 4.46957 8 5V21M4 7H20M4 15H20M3 21H21\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n            </svg>\r\n            <h4 class=\"section-title\">Trading Configuration</h4>\r\n          </div>\r\n\r\n          <!-- Default Quantity -->\r\n          <div class=\"settings-field\">\r\n            <label class=\"field-label\">\r\n              <svg class=\"field-icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                <path d=\"M12 2V22M17 5H9.5C8.57174 5 7.6815 5.36875 7.02513 6.02513C6.36875 6.6815 6 7.57174 6 8.5C6 9.42826 6.36875 10.3185 7.02513 10.9749C7.6815 11.6313 8.57174 12 9.5 12H14.5C15.4283 12 16.3185 12.3687 16.9749 13.0251C17.6313 13.6815 18 14.5717 18 15.5C18 16.4283 17.6313 17.3185 16.9749 17.9749C16.3185 18.6313 15.4283 19 14.5 19H6\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n              </svg>\r\n              {{ translate('fundingRates.settings.defaultQuantity') }} ({{ translate('fundingRates.dialog.coins') }})\r\n            </label>\r\n            <input\r\n              type=\"number\"\r\n              class=\"field-input\"\r\n              [(ngModel)]=\"subscriptionSettings().defaultQuantity\"\r\n              step=\"0.001\"\r\n              min=\"0.001\"\r\n              placeholder=\"0.01\"\r\n              aria-label=\"Default quantity\">\r\n            <p class=\"field-help\">{{ translate('fundingRates.settings.defaultQuantityHelp') }}</p>\r\n          </div>\r\n\r\n          <!-- Leverage -->\r\n          <div class=\"settings-field\">\r\n            <label class=\"field-label\">\r\n              <svg class=\"field-icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                <path d=\"M13 2L3 14H12L11 22L21 10H12L13 2Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n              </svg>\r\n              {{ translate('fundingRates.settings.leverage') }}\r\n            </label>\r\n            <input\r\n              type=\"number\"\r\n              class=\"field-input\"\r\n              [(ngModel)]=\"subscriptionSettings().leverage\"\r\n              min=\"1\"\r\n              max=\"20\"\r\n              step=\"1\"\r\n              placeholder=\"3\"\r\n              aria-label=\"Leverage\">\r\n            <p class=\"field-help\">{{ translate('fundingRates.settings.leverageHelp') }}</p>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Auto-Cancel Configuration Section -->\r\n        <div class=\"settings-section\">\r\n          <div class=\"section-header\">\r\n            <svg class=\"section-icon\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n              <path d=\"M12 8V12L15 15M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n            </svg>\r\n            <h4 class=\"section-title\">Auto-Cancel Settings</h4>\r\n          </div>\r\n\r\n          <!-- Auto-Cancel Toggle -->\r\n          <div class=\"settings-field\">\r\n            <label class=\"field-checkbox\">\r\n              <input\r\n                type=\"checkbox\"\r\n                [(ngModel)]=\"subscriptionSettings().enableAutoCancel\"\r\n                class=\"checkbox-input\">\r\n              <span class=\"checkbox-custom\"></span>\r\n              <span class=\"checkbox-label\">{{ translate('fundingRates.settings.enableAutoCancel') }}</span>\r\n            </label>\r\n            <p class=\"field-help\">{{ translate('fundingRates.settings.autoCancelHelp') }}</p>\r\n          </div>\r\n\r\n          <!-- Auto-Cancel Threshold (only show if enabled) -->\r\n          @if (subscriptionSettings().enableAutoCancel) {\r\n            <div class=\"settings-field\">\r\n              <label class=\"field-label\">\r\n                <svg class=\"field-icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                  <path d=\"M22 11.08V12C21.9988 14.1564 21.3005 16.2547 20.0093 17.9818C18.7182 19.7088 16.9033 20.9725 14.8354 21.5839C12.7674 22.1953 10.5573 22.1219 8.53447 21.3746C6.51168 20.6273 4.78465 19.2461 3.61096 17.4371C2.43727 15.628 1.87979 13.4881 2.02168 11.3363C2.16356 9.18455 2.99721 7.13631 4.39828 5.49706C5.79935 3.85781 7.69279 2.71537 9.79619 2.24013C11.8996 1.76489 14.1003 1.98232 16.07 2.86\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                  <path d=\"M22 4L12 14.01L9 11.01\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                </svg>\r\n                {{ translate('fundingRates.settings.autoCancelThreshold') }} (%)\r\n              </label>\r\n              <input\r\n                type=\"number\"\r\n                class=\"field-input\"\r\n                [(ngModel)]=\"subscriptionSettings().autoCancelThreshold\"\r\n                step=\"0.0001\"\r\n                placeholder=\"0.01\"\r\n                aria-label=\"Auto-cancel threshold\">\r\n              <p class=\"field-help\">{{ translate('fundingRates.settings.autoCancelThresholdHelp') }}</p>\r\n            </div>\r\n          }\r\n        </div>\r\n\r\n        <!-- Execution Settings Section -->\r\n        <div class=\"settings-section\">\r\n          <div class=\"section-header\">\r\n            <svg class=\"section-icon\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n              <path d=\"M13 2L3 14H12L11 22L21 10H12L13 2Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n            </svg>\r\n            <h4 class=\"section-title\">Execution Settings</h4>\r\n          </div>\r\n\r\n          <!-- Execution Delay -->\r\n          <div class=\"settings-field\">\r\n            <label class=\"field-label\">\r\n              <svg class=\"field-icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                <path d=\"M12 6V12L16 14\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                <path d=\"M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n              </svg>\r\n              {{ translate('fundingRates.settings.executionDelay') }} ({{ translate('fundingRates.dialog.seconds') }})\r\n            </label>\r\n            <input\r\n              type=\"number\"\r\n              class=\"field-input\"\r\n              [(ngModel)]=\"subscriptionSettings().executionDelay\"\r\n              min=\"1\"\r\n              max=\"60\"\r\n              step=\"1\"\r\n              placeholder=\"5\"\r\n              aria-label=\"Execution delay\">\r\n            <p class=\"field-help\">{{ translate('fundingRates.settings.executionDelayHelp') }}</p>\r\n          </div>\r\n\r\n          <!-- Arbitrage Spread Threshold -->\r\n          <div class=\"settings-field\">\r\n            <label class=\"field-label\">\r\n              <svg class=\"field-icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                <path d=\"M3 3V21M21 21V3M7 8H17M7 12H17M7 16H17\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n              </svg>\r\n              {{ translate('fundingRates.settings.arbitrageSpreadThreshold') }} (%)\r\n            </label>\r\n            <input\r\n              type=\"number\"\r\n              class=\"field-input\"\r\n              [(ngModel)]=\"subscriptionSettings().arbitrageSpreadThreshold\"\r\n              step=\"0.001\"\r\n              min=\"0\"\r\n              placeholder=\"0.01\"\r\n              aria-label=\"Arbitrage spread threshold\">\r\n            <p class=\"field-help\">{{ translate('fundingRates.settings.arbitrageSpreadThresholdHelp') }}</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Footer with Action Buttons -->\r\n      <div class=\"settings-footer\">\r\n        <ui-button\r\n          variant=\"ghost\"\r\n          (clicked)=\"closeSettingsDialog()\">\r\n          {{ translate('fundingRates.actions.cancel') }}\r\n        </ui-button>\r\n        <ui-button\r\n          variant=\"primary\"\r\n          (clicked)=\"saveSettings()\">\r\n          <span class=\"button-with-icon\">\r\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n              <path d=\"M19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H16L21 8V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n              <path d=\"M17 21V13H7V21M7 3V8H15\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n            </svg>\r\n            {{ translate('fundingRates.actions.save') }}\r\n          </span>\r\n        </ui-button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n}\r\n\r\n<!-- Details Modal -->\r\n<ui-dialog\r\n  [open]=\"showDetailsModal()\"\r\n  [title]=\"selectedOpportunity() ? selectedOpportunity()!.symbol + ' - Spread Stability Analysis' : 'Loading...'\"\r\n  size=\"xlarge\"\r\n  [closable]=\"true\"\r\n  [closeOnBackdrop]=\"true\"\r\n  (close)=\"closeDetailsModal()\"\r\n>\r\n  <ui-dialog-content>\r\n    @if (selectedOpportunity(); as opp) {\r\n      <app-funding-spread-details\r\n        [opportunity]=\"mapToDetailsOpportunity(opp)\"\r\n      ></app-funding-spread-details>\r\n    }\r\n  </ui-dialog-content>\r\n</ui-dialog>\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\pages\\arbitrage-funding\\arbitrage-funding.component.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'SpreadStabilityMetrics' is defined but never used.","line":8,"column":34,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":56},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":68,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3028,3031],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3028,3031],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":244,"column":65,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":244,"endColumn":72},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":276,"column":63,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":276,"endColumn":70},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":644,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":644,"endColumn":66,"suggestions":[{"messageId":"addBrackets","fix":{"range":[20154,20276],"text":"{ const bingxSymbol = this.normalizeSymbolForBingX(symbol);\r\n        return `https://bingx.com/en/perpetual/${bingxSymbol}`; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":647,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":647,"endColumn":119,"suggestions":[{"messageId":"addBrackets","fix":{"range":[20306,20479],"text":"{ const mexcSymbol = symbol.includes('_') ? symbol : symbol.replace(/USDT$/, '_USDT').replace(/USDC$/, '_USDC');\r\n        return `https://www.mexc.com/exchange/${mexcSymbol}`; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":650,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":650,"endColumn":121,"suggestions":[{"messageId":"addBrackets","fix":{"range":[20511,20684],"text":"{ const gateioSymbol = symbol.includes('_') ? symbol : symbol.replace(/USDT$/, '_USDT').replace(/USDC$/, '_USDC');\r\n        return `https://www.gate.io/trade/${gateioSymbol}`; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":674,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":674,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21335,21338],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21335,21338],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, OnInit, OnDestroy, ViewEncapsulation, signal, computed, effect, inject } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { RouterModule } from '@angular/router';\r\nimport { interval, Subscription } from 'rxjs';\r\nimport { startWith, switchMap } from 'rxjs/operators';\r\nimport { PublicFundingRatesService } from '../../services/public-funding-rates.service';\r\nimport { FundingRateOpportunity, SpreadStabilityMetrics } from '../../models/public-funding-rate.model';\r\nimport { CardComponent, CardHeaderComponent, CardTitleComponent, CardContentComponent } from '../../components/ui/card/card.component';\r\nimport { ButtonComponent } from '../../components/ui/button/button.component';\r\nimport { IconComponent } from '../../components/ui/icon/icon.component';\r\nimport { DialogComponent, DialogHeaderComponent, DialogTitleComponent, DialogContentComponent, DialogFooterComponent } from '../../components/ui/dialog/dialog.component';\r\nimport { TradingSettingsService, TradingSettings } from '../../services/trading-settings.service';\r\nimport { ThemeService } from '../../services/theme.service';\r\nimport { FundingRateSpreadChartComponent } from '../../components/trading/funding-rate-spread-chart/funding-rate-spread-chart.component';\r\nimport { FundingSpreadDetailsComponent } from '../../components/trading/funding-spread-details/funding-spread-details.component';\r\n\r\n/**\r\n * Arbitrage Funding Page\r\n *\r\n * Displays funding rate arbitrage opportunities fetched directly from exchange public APIs.\r\n * NO API KEYS REQUIRED - all data is public.\r\n *\r\n * Features:\r\n * - Real-time funding rates from multiple exchanges\r\n * - Automatic calculation of funding spreads\r\n * - Price spread analysis\r\n * - Sortable by funding spread, price spread, or symbol\r\n * - Auto-refresh every 30 seconds\r\n */\r\n@Component({\r\n  selector: 'app-arbitrage-funding',\r\n  standalone: true,\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    RouterModule,\r\n    CardComponent,\r\n    CardHeaderComponent,\r\n    CardTitleComponent,\r\n    CardContentComponent,\r\n    ButtonComponent,\r\n    IconComponent,\r\n    DialogComponent,\r\n    DialogHeaderComponent,\r\n    DialogTitleComponent,\r\n    DialogContentComponent,\r\n    DialogFooterComponent,\r\n    FundingRateSpreadChartComponent,\r\n    FundingSpreadDetailsComponent,\r\n  ],\r\n  templateUrl: './arbitrage-funding.component.html',\r\n  styleUrls: ['./arbitrage-funding.component.scss'],\r\n  encapsulation: ViewEncapsulation.None,\r\n})\r\nexport class ArbitrageFundingComponent implements OnInit, OnDestroy {\r\n  // State\r\n  opportunities = signal<FundingRateOpportunity[]>([]);\r\n  isLoading = signal<boolean>(false);\r\n  error = signal<string | null>(null);\r\n  lastUpdated = signal<Date | null>(null);\r\n\r\n  // Current time signal - updates every second to calculate time differences\r\n  private currentTime = signal<number>(Date.now());\r\n\r\n  // Auto-refresh\r\n  private refreshSubscription?: Subscription;\r\n  private timeUpdateInterval?: any;\r\n  private readonly REFRESH_INTERVAL_MS = 30 * 1000; // 30 seconds\r\n\r\n  // Filters\r\n  searchQuery = signal<string>('');\r\n  minFundingSpread = signal<number | null>(null);\r\n\r\n  // Computed list of unique exchanges from all opportunities\r\n  availableExchanges = computed(() => {\r\n    const exchanges = new Set<string>();\r\n    this.opportunities().forEach(opp => {\r\n      opp.exchanges.forEach(ex => exchanges.add(ex.exchange));\r\n    });\r\n    return Array.from(exchanges).sort();\r\n  });\r\n\r\n  // Selected exchanges filter\r\n  selectedExchanges = signal<Set<string>>(new Set());\r\n\r\n  // Sorting\r\n  sortColumn = signal<'fundingSpread' | 'priceSpread' | 'symbol' | 'estimatedAPR' | 'netAPR'>('fundingSpread');\r\n  sortDirection = signal<'asc' | 'desc'>('asc');\r\n\r\n  // PHASE2: Modal for detailed metrics\r\n  showDetailsModal = signal<boolean>(false);\r\n  selectedOpportunity = signal<FundingRateOpportunity | null>(null);\r\n  loadingPhase2Metrics = signal<Set<string>>(new Set());\r\n  phase2MetricsCache = signal<Map<string, FundingRateOpportunity>>(new Map());\r\n\r\n  // Settings Dialog\r\n  showSettingsDialog = signal<boolean>(false);\r\n  // Writable settings for the dialog (cloned from service)\r\n  private _subscriptionSettings = signal<TradingSettings>({\r\n    defaultQuantity: 0.01,\r\n    leverage: 3,\r\n    autoCancelThreshold: 0.003,\r\n    enableAutoCancel: true,\r\n    executionDelay: 5,\r\n    arbitrageSpreadThreshold: null\r\n  });\r\n\r\n  // Computed time since update - uses currentTime signal to avoid NG0100\r\n  timeSinceUpdate = computed(() => {\r\n    const lastUpdate = this.lastUpdated();\r\n    if (!lastUpdate) return '‚Äî';\r\n\r\n    const now = this.currentTime();\r\n    const seconds = Math.floor((now - lastUpdate.getTime()) / 1000);\r\n    if (seconds < 60) return `${seconds}s ago`;\r\n\r\n    const minutes = Math.floor(seconds / 60);\r\n    return `${minutes}m ago`;\r\n  });\r\n\r\n  // Computed filtered & sorted opportunities\r\n  filteredOpportunities = computed(() => {\r\n    let filtered = [...this.opportunities()];\r\n\r\n    // Filter by search query (symbol)\r\n    const query = this.searchQuery().trim().toUpperCase();\r\n    if (query) {\r\n      filtered = filtered.filter(o => o.symbol.toUpperCase().includes(query));\r\n    }\r\n\r\n    // Filter by minimum funding spread\r\n    const minSpread = this.minFundingSpread();\r\n    if (minSpread !== null) {\r\n      filtered = filtered.filter(o => Math.abs(o.maxFundingSpread * 100) >= minSpread);\r\n    }\r\n\r\n    // Filter by selected exchanges\r\n    // Show only opportunities where BOTH bestLong and bestShort exchanges are selected\r\n    const selected = this.selectedExchanges();\r\n    if (selected.size > 0) {\r\n      filtered = filtered.filter(opp =>\r\n        selected.has(opp.bestLong.exchange) && selected.has(opp.bestShort.exchange)\r\n      );\r\n    }\r\n\r\n    // Sort\r\n    const column = this.sortColumn();\r\n    const direction = this.sortDirection();\r\n\r\n    filtered.sort((a, b) => {\r\n      let comparison = 0;\r\n\r\n      switch (column) {\r\n        case 'fundingSpread':\r\n          comparison = Math.abs(b.maxFundingSpread) - Math.abs(a.maxFundingSpread);\r\n          break;\r\n        case 'priceSpread':\r\n          comparison = Math.abs(b.priceSpread) - Math.abs(a.priceSpread);\r\n          break;\r\n        case 'estimatedAPR':\r\n          comparison = b.estimatedAPR - a.estimatedAPR;\r\n          break;\r\n        case 'netAPR':\r\n          comparison = b.netAPR - a.netAPR;\r\n          break;\r\n        case 'symbol':\r\n          comparison = a.symbol.localeCompare(b.symbol);\r\n          break;\r\n      }\r\n\r\n      return direction === 'asc' ? comparison : -comparison;\r\n    });\r\n\r\n    return filtered;\r\n  });\r\n\r\n  private themeService = inject(ThemeService);\r\n\r\n  constructor(\r\n    private fundingRatesService: PublicFundingRatesService,\r\n    private tradingSettingsService: TradingSettingsService\r\n  ) {\r\n    // Constructor simplified - chart rendering now handled by child component\r\n\r\n    // Auto-select all exchanges when they become available\r\n    effect(() => {\r\n      const exchanges = this.availableExchanges();\r\n      if (exchanges.length > 0 && this.selectedExchanges().size === 0) {\r\n        this.selectAllExchanges();\r\n      }\r\n    }, { allowSignalWrites: true });\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.startAutoRefresh();\r\n    this.startTimeUpdates();\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.stopAutoRefresh();\r\n    this.stopTimeUpdates();\r\n  }\r\n\r\n  /**\r\n   * Start updating currentTime every second\r\n   * This allows time-based displays to update without causing NG0100\r\n   */\r\n  private startTimeUpdates(): void {\r\n    this.timeUpdateInterval = setInterval(() => {\r\n      this.currentTime.set(Date.now());\r\n    }, 1000); // Update every second\r\n  }\r\n\r\n  /**\r\n   * Stop time update interval\r\n   */\r\n  private stopTimeUpdates(): void {\r\n    if (this.timeUpdateInterval) {\r\n      clearInterval(this.timeUpdateInterval);\r\n      this.timeUpdateInterval = undefined;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start auto-refresh timer\r\n   * Fetches funding rates every 30 seconds\r\n   */\r\n  private startAutoRefresh(): void {\r\n    this.refreshSubscription = interval(this.REFRESH_INTERVAL_MS)\r\n      .pipe(\r\n        startWith(0), // Load immediately\r\n        switchMap(() => this.fundingRatesService.getFundingRatesOpportunities())\r\n      )\r\n      .subscribe({\r\n        next: (opportunities) => {\r\n          this.opportunities.set(opportunities);\r\n          this.error.set(null);\r\n          this.isLoading.set(false);\r\n          // Update lastUpdated after change detection to avoid NG0100\r\n          setTimeout(() => this.lastUpdated.set(new Date()), 0);\r\n        },\r\n        error: (err) => {\r\n          this.error.set('Failed to load funding rates: ' + err.message);\r\n          this.isLoading.set(false);\r\n        },\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Stop auto-refresh timer\r\n   */\r\n  private stopAutoRefresh(): void {\r\n    if (this.refreshSubscription) {\r\n      this.refreshSubscription.unsubscribe();\r\n      this.refreshSubscription = undefined;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Manually refresh funding rates\r\n   */\r\n  refresh(): void {\r\n    this.isLoading.set(true);\r\n    this.error.set(null);\r\n\r\n    this.fundingRatesService.getFundingRatesOpportunities().subscribe({\r\n      next: (opportunities) => {\r\n        this.opportunities.set(opportunities);\r\n        this.error.set(null);\r\n        this.isLoading.set(false);\r\n        // Update lastUpdated after change detection to avoid NG0100\r\n        setTimeout(() => this.lastUpdated.set(new Date()), 0);\r\n      },\r\n      error: (err) => {\r\n        this.error.set('Failed to load funding rates: ' + err.message);\r\n        this.isLoading.set(false);\r\n      },\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Toggle sort column\r\n   */\r\n  toggleSort(column: 'fundingSpread' | 'priceSpread' | 'symbol' | 'estimatedAPR' | 'netAPR'): void {\r\n    if (this.sortColumn() === column) {\r\n      // Toggle direction\r\n      this.sortDirection.set(this.sortDirection() === 'asc' ? 'desc' : 'asc');\r\n    } else {\r\n      // Change column, default to desc\r\n      this.sortColumn.set(column);\r\n      this.sortDirection.set('desc');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear all filters\r\n   */\r\n  clearFilters(): void {\r\n    this.searchQuery.set('');\r\n    this.minFundingSpread.set(null);\r\n    this.selectAllExchanges();\r\n  }\r\n\r\n  /**\r\n   * Toggle exchange selection\r\n   */\r\n  toggleExchange(exchange: string): void {\r\n    const selected = new Set(this.selectedExchanges());\r\n    if (selected.has(exchange)) {\r\n      selected.delete(exchange);\r\n    } else {\r\n      selected.add(exchange);\r\n    }\r\n    this.selectedExchanges.set(selected);\r\n  }\r\n\r\n  /**\r\n   * Select all exchanges\r\n   */\r\n  selectAllExchanges(): void {\r\n    this.selectedExchanges.set(new Set(this.availableExchanges()));\r\n  }\r\n\r\n  /**\r\n   * Deselect all exchanges\r\n   */\r\n  deselectAllExchanges(): void {\r\n    this.selectedExchanges.set(new Set());\r\n  }\r\n\r\n  /**\r\n   * Check if exchange is selected\r\n   */\r\n  isExchangeSelected(exchange: string): boolean {\r\n    return this.selectedExchanges().has(exchange);\r\n  }\r\n\r\n  /**\r\n   * Format funding rate for display\r\n   */\r\n  formatFundingRate(rate: string): string {\r\n    const rateNum = parseFloat(rate);\r\n    return (rateNum * 100).toFixed(4) + '%';\r\n  }\r\n\r\n  /**\r\n   * Get color class for funding rate\r\n   * Negative (paying) = red, Positive (receiving) = green\r\n   */\r\n  getFundingRateColorClass(rate: string): string {\r\n    const rateNum = parseFloat(rate);\r\n    if (rateNum < 0) return 'text-red-600 dark:text-red-400';\r\n    if (rateNum > 0) return 'text-green-600 dark:text-green-400';\r\n    return 'text-gray-600 dark:text-gray-400';\r\n  }\r\n\r\n  /**\r\n   * Get color class for funding spread\r\n   */\r\n  getFundingSpreadColorClass(spread: number): string {\r\n    const absSpread = Math.abs(spread * 100);\r\n    if (absSpread >= 0.1) return 'text-green-600 dark:text-green-400';\r\n    if (absSpread >= 0.05) return 'text-yellow-600 dark:text-yellow-400';\r\n    return 'text-gray-600 dark:text-gray-400';\r\n  }\r\n\r\n  /**\r\n   * Get color class for APR values\r\n   */\r\n  getAPRColorClass(apr: number): string {\r\n    const aprPercent = apr * 100;\r\n    if (aprPercent >= 50) return 'text-green-600 dark:text-green-400';\r\n    if (aprPercent >= 20) return 'text-yellow-600 dark:text-yellow-400';\r\n    return 'text-gray-600 dark:text-gray-400';\r\n  }\r\n\r\n\r\n  /**\r\n   * Get exchanges tooltip text\r\n   */\r\n  getExchangesTooltip(opp: FundingRateOpportunity): string {\r\n    return opp.exchanges.map(ex =>\r\n      `${ex.exchange}: ${this.formatFundingRate(ex.fundingRate)} | $${ex.lastPrice}`\r\n    ).join('\\n');\r\n  }\r\n\r\n  // ===== PHASE 2: Details Modal Methods =====\r\n\r\n  /**\r\n   * Open details modal for displaying Phase 2 metrics\r\n   * PHASE2: Triggers loading of historical stability metrics\r\n   */\r\n  openDetailsModal(opp: FundingRateOpportunity): void {\r\n    this.selectedOpportunity.set(opp);\r\n    this.showDetailsModal.set(true);\r\n    // Trigger Phase 2 load\r\n    this.loadPhase2MetricsForSymbol(opp.symbol);\r\n  }\r\n\r\n  /**\r\n   * Close details modal\r\n   */\r\n  closeDetailsModal(): void {\r\n    this.showDetailsModal.set(false);\r\n    // Don't clear selectedOpportunity immediately to avoid flicker during close animation\r\n    setTimeout(() => {\r\n      if (!this.showDetailsModal()) {\r\n        this.selectedOpportunity.set(null);\r\n      }\r\n    }, 300);\r\n  }\r\n\r\n  /**\r\n   * Load Phase 2 historical stability metrics for a symbol\r\n   * PHASE2: Fetches historical funding rates and calculates stability metrics\r\n   */\r\n  async loadPhase2MetricsForSymbol(symbol: string): Promise<void> {\r\n    // Check cache\r\n    if (this.phase2MetricsCache().has(symbol)) {\r\n      // Data already loaded\r\n      return;\r\n    }\r\n\r\n    // Find opportunity\r\n    const opp = this.filteredOpportunities().find(o => o.symbol === symbol);\r\n    if (!opp) return;\r\n\r\n    // Set loading\r\n    const loading = new Set(this.loadingPhase2Metrics());\r\n    loading.add(symbol);\r\n    this.loadingPhase2Metrics.set(loading);\r\n\r\n    try {\r\n      // Load metrics via service\r\n      const updated = await this.fundingRatesService.loadPhase2Metrics(opp);\r\n\r\n      // Update cache\r\n      const cache = new Map(this.phase2MetricsCache());\r\n      cache.set(symbol, updated);\r\n      this.phase2MetricsCache.set(cache);\r\n    } catch (error) {\r\n      console.error('[Phase 2] Load failed:', error);\r\n    } finally {\r\n      // Clear loading\r\n      const loading = new Set(this.loadingPhase2Metrics());\r\n      loading.delete(symbol);\r\n      this.loadingPhase2Metrics.set(loading);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if Phase 2 metrics are currently loading for a symbol\r\n   * PHASE2: Used to show loading spinner in UI\r\n   */\r\n  isLoadingPhase2(symbol: string): boolean {\r\n    return this.loadingPhase2Metrics().has(symbol);\r\n  }\r\n\r\n  /**\r\n   * Get Phase 2 metrics from cache\r\n   * PHASE2: Returns cached metrics or undefined if not loaded\r\n   */\r\n  getPhase2Metrics(symbol: string): FundingRateOpportunity | undefined {\r\n    return this.phase2MetricsCache().get(symbol);\r\n  }\r\n\r\n  /**\r\n   * Get icon name for stability trend\r\n   * PHASE2: Maps trend to Material icon name\r\n   */\r\n  getTrendIcon(trend: string): string {\r\n    switch (trend) {\r\n      case 'improving': return 'trending_up';\r\n      case 'declining': return 'trending_down';\r\n      default: return 'trending_flat';\r\n    }\r\n  }\r\n\r\n  // ===== Settings Dialog Methods =====\r\n\r\n  /**\r\n   * Get subscription settings (writable for ngModel binding)\r\n   */\r\n  subscriptionSettings() {\r\n    return this._subscriptionSettings();\r\n  }\r\n\r\n  /**\r\n   * Open settings dialog\r\n   */\r\n  openSettingsDialog(): void {\r\n    // Clone current settings from service\r\n    const currentSettings = this.tradingSettingsService.getSettings()();\r\n    this._subscriptionSettings.set({ ...currentSettings });\r\n    this.showSettingsDialog.set(true);\r\n  }\r\n\r\n  /**\r\n   * Close settings dialog\r\n   */\r\n  closeSettingsDialog(): void {\r\n    this.showSettingsDialog.set(false);\r\n  }\r\n\r\n  /**\r\n   * Save settings to service\r\n   */\r\n  saveSettings(): void {\r\n    // Save the modified settings to the service\r\n    this.tradingSettingsService.updateSettings(this._subscriptionSettings());\r\n    this.closeSettingsDialog();\r\n  }\r\n\r\n  /**\r\n   * Translation stub method\r\n   * Returns the key as-is for now\r\n   */\r\n  translate(key: string): string {\r\n    return key;\r\n  }\r\n\r\n  /**\r\n   * Calculate time to funding for a specific exchange\r\n   * Uses currentTime signal to avoid NG0100\r\n   */\r\n  getTimeToFunding(exchange: { nextFundingTime: number }): string {\r\n    const now = this.currentTime();\r\n    const diff = exchange.nextFundingTime - now;\r\n\r\n    if (diff <= 0) return '0m';\r\n\r\n    const hours = Math.floor(diff / (1000 * 60 * 60));\r\n    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));\r\n\r\n    if (hours > 0) {\r\n      return `${hours}h ${minutes}m`;\r\n    }\r\n    return `${minutes}m`;\r\n  }\r\n\r\n  /**\r\n   * Format time to funding with interval like \"2h 15m / 8h\"\r\n   * Dynamically calculates the funding interval based on time until next funding\r\n   * Uses currentTime signal to avoid NG0100\r\n   */\r\n  formatTimeToFundingWithInterval(exchange: { nextFundingTime: number; fundingInterval?: string }): string {\r\n    const timeToFunding = this.getTimeToFunding(exchange);\r\n\r\n    // Calculate interval dynamically based on time until next funding\r\n    const now = this.currentTime();\r\n    const timeUntilFunding = exchange.nextFundingTime - now;\r\n\r\n    let interval = '8h'; // Default\r\n    if (timeUntilFunding > 0) {\r\n      if (timeUntilFunding <= 1 * 60 * 60 * 1000) {\r\n        interval = '1h';\r\n      } else if (timeUntilFunding <= 4 * 60 * 60 * 1000) {\r\n        interval = '4h';\r\n      }\r\n    }\r\n\r\n    return `${timeToFunding} / ${interval}`;\r\n  }\r\n\r\n  /**\r\n   * Get color class for volatility\r\n   * Higher volatility = higher risk\r\n   */\r\n  getVolatilityColorClass(volatility?: number): string {\r\n    if (!volatility) return 'text-gray-600 dark:text-gray-400';\r\n\r\n    const volatilityPercent = volatility * 100;\r\n\r\n    if (volatilityPercent < 2) {\r\n      // Low volatility = low risk (green)\r\n      return 'text-green-600 dark:text-green-400';\r\n    } else if (volatilityPercent < 5) {\r\n      // Medium volatility = medium risk (yellow)\r\n      return 'text-yellow-600 dark:text-yellow-400';\r\n    } else {\r\n      // High volatility = high risk (red)\r\n      return 'text-red-600 dark:text-red-400';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get tooltip for volatility explaining the risk level\r\n   */\r\n  getVolatilityTooltip(volatility?: number): string {\r\n    if (!volatility) return 'Volatility data not available';\r\n\r\n    const volatilityPercent = volatility * 100;\r\n\r\n    if (volatilityPercent < 2) {\r\n      return 'Low volatility (< 2%) - Low risk, stable price movement';\r\n    } else if (volatilityPercent < 5) {\r\n      return 'Medium volatility (2-5%) - Moderate risk, normal price fluctuations';\r\n    } else {\r\n      return 'High volatility (> 5%) - High risk, significant price swings';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Convert symbol to BingX format (e.g., BTCUSDT -> BTC-USDT)\r\n   * Also handles CCXT perpetual contract format (e.g., BTC/USDT:USDT -> BTC-USDT)\r\n   */\r\n  private normalizeSymbolForBingX(symbol: string): string {\r\n    // First, remove CCXT perpetual contract suffix (e.g., :USDT)\r\n    let cleanSymbol = symbol.replace(/:.*$/, '');\r\n\r\n    // Remove slashes (CCXT format BTC/USDT -> BTCUSDT)\r\n    cleanSymbol = cleanSymbol.replace(/\\//g, '');\r\n\r\n    // If already has hyphen, return as-is\r\n    if (cleanSymbol.includes('-')) {\r\n      return cleanSymbol;\r\n    }\r\n\r\n    // BingX perpetual futures use USDT or USDC as quote currency\r\n    if (cleanSymbol.endsWith('USDT')) {\r\n      const base = cleanSymbol.slice(0, -4);\r\n      return `${base}-USDT`;\r\n    }\r\n\r\n    if (cleanSymbol.endsWith('USDC')) {\r\n      const base = cleanSymbol.slice(0, -4);\r\n      return `${base}-USDC`;\r\n    }\r\n\r\n    return cleanSymbol;\r\n  }\r\n\r\n  /**\r\n   * Get exchange URL for opening in new window\r\n   */\r\n  getExchangeUrl(exchange: string, symbol: string): string {\r\n    const exchangeUpper = exchange.toUpperCase();\r\n\r\n    switch (exchangeUpper) {\r\n      case 'BYBIT':\r\n        return `https://www.bybit.com/trade/usdt/${symbol}`;\r\n      case 'BINGX':\r\n        const bingxSymbol = this.normalizeSymbolForBingX(symbol);\r\n        return `https://bingx.com/en/perpetual/${bingxSymbol}`;\r\n      case 'MEXC':\r\n        const mexcSymbol = symbol.includes('_') ? symbol : symbol.replace(/USDT$/, '_USDT').replace(/USDC$/, '_USDC');\r\n        return `https://www.mexc.com/exchange/${mexcSymbol}`;\r\n      case 'GATEIO':\r\n        const gateioSymbol = symbol.includes('_') ? symbol : symbol.replace(/USDT$/, '_USDT').replace(/USDC$/, '_USDC');\r\n        return `https://www.gate.io/trade/${gateioSymbol}`;\r\n      case 'BITGET':\r\n        return `https://www.bitget.com/futures/usdt/${symbol}`;\r\n      case 'OKX':\r\n        return `https://www.okx.com/trade-swap/${symbol.toLowerCase()}`;\r\n      default:\r\n        return '#';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Open exchange page in new window\r\n   */\r\n  openExchange(exchange: string, symbol: string): void {\r\n    const url = this.getExchangeUrl(exchange, symbol);\r\n    if (url !== '#') {\r\n      window.open(url, '_blank', 'noopener,noreferrer');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Map FundingRateOpportunity to format expected by FundingSpreadDetailsComponent\r\n   */\r\n  mapToDetailsOpportunity(opp: FundingRateOpportunity): any {\r\n    // Get Phase 2 metrics if available\r\n    const metrics = this.phase2MetricsCache().get(opp.symbol);\r\n    const spreadHistory7d = metrics?.spreadHistory7d;\r\n    const spreadHistory30d = metrics?.spreadHistory30d;\r\n\r\n    return {\r\n      symbol: opp.symbol,\r\n      spread: opp.maxFundingSpread,\r\n      spreadPercentage: Math.abs(opp.maxFundingSpread * 100),\r\n      bestLongExchange: opp.bestLong.exchange,\r\n      bestShortExchange: opp.bestShort.exchange,\r\n      longFundingRate: parseFloat(opp.bestLong.fundingRate),\r\n      shortFundingRate: parseFloat(opp.bestShort.fundingRate),\r\n      currentPrice: parseFloat(opp.bestLong.lastPrice),\r\n      volume24h: opp.volume24h,\r\n      metrics: {\r\n        historicalStability: spreadHistory7d?.stabilityScore ? spreadHistory7d.stabilityScore / 100 : 0.5,\r\n        avgSpread7d: spreadHistory7d?.average || 0,\r\n        avgSpread30d: spreadHistory30d?.average || 0,\r\n        spreadVolatility: spreadHistory7d?.standardDeviation || 0,\r\n        trendDirection: metrics?.spreadStabilityTrend === 'improving' ? 'increasing' :\r\n                       metrics?.spreadStabilityTrend === 'declining' ? 'decreasing' : 'stable'\r\n      }\r\n    };\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\pages\\price-arbitrage-opportunities\\price-arbitrage-opportunities.component.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'forkJoin' is defined but never used.","line":5,"column":34,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":42},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'of' is defined but never used.","line":5,"column":44,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":46},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'catchError' is defined but never used.","line":6,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":42},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":130,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5029,5032],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5029,5032],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":355,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":355,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13060,13063],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13060,13063],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .fundingRate on an `any` value.","line":356,"column":44,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":356,"endColumn":55},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":365,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":365,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13455,13458],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13455,13458],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":365,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":365,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13463,13466],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13463,13466],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .fundingRate on an `any` value.","line":366,"column":30,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":366,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .fundingRate on an `any` value.","line":366,"column":58,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":366,"endColumn":69},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":383,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":383,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14160,14163],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14160,14163],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":384,"column":78,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":384,"endColumn":85},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":397,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":397,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14758,14761],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14758,14761],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":398,"column":65,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":398,"endColumn":72},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":441,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":441,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16196,16199],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16196,16199],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":445,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":447,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .fundingRateNormalized on an `any` value.","line":445,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":445,"endColumn":48},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .fundingRateNormalized on an `any` value.","line":446,"column":18,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":446,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .fundingRate on an `any` value.","line":447,"column":29,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":447,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":904,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":904,"endColumn":70},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":905,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":905,"endColumn":72},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exchange on an `any` value.","line":912,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":912,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exchange on an `any` value.","line":913,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":913,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exchange on an `any` value.","line":917,"column":82,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":917,"endColumn":90},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exchange on an `any` value.","line":917,"column":117,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":917,"endColumn":125},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1008,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1008,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[34291,34294],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[34291,34294],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1098,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1098,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[37456,37459],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[37456,37459],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1113,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1113,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[38023,38026],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[38023,38026],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1128,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1128,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[38611,38614],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[38611,38614],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1143,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1143,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[39313,39316],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[39313,39316],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1161,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":1161,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exchange on an `any` value.","line":1161,"column":17,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1161,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exchange on an `any` value.","line":1162,"column":43,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1162,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .fundingRate on an `any` value.","line":1162,"column":89,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1162,"endColumn":100},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .fundingInterval on an `any` value.","line":1162,"column":110,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1162,"endColumn":125},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1172,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":1172,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exchange on an `any` value.","line":1172,"column":17,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1172,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exchange on an `any` value.","line":1173,"column":43,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1173,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .fundingRate on an `any` value.","line":1173,"column":89,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1173,"endColumn":100},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .fundingInterval on an `any` value.","line":1173,"column":110,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1173,"endColumn":125},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1210,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":1210,"endColumn":60},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1211,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":1211,"endColumn":62},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1216,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":1218,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .fundingRateNormalized on an `any` value.","line":1216,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1216,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .fundingRateNormalized on an `any` value.","line":1217,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1217,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .fundingRate on an `any` value.","line":1218,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1218,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":1220,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":1222,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .fundingRateNormalized on an `any` value.","line":1220,"column":37,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1220,"endColumn":58},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .fundingRateNormalized on an `any` value.","line":1221,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1221,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .fundingRate on an `any` value.","line":1222,"column":34,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1222,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exchange on an `any` value.","line":1233,"column":60,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1233,"endColumn":68},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exchange on an `any` value.","line":1233,"column":84,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":1233,"endColumn":92}],"suppressedMessages":[],"errorCount":52,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, OnInit, OnDestroy, ViewEncapsulation, signal, computed, inject } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { Router, RouterModule } from '@angular/router';\r\nimport { interval, Subscription, forkJoin, of } from 'rxjs';\r\nimport { startWith, switchMap, catchError } from 'rxjs/operators';\r\nimport { PublicFundingRatesService } from '../../services/public-funding-rates.service';\r\nimport { FundingRateOpportunity } from '../../models/public-funding-rate.model';\r\nimport { IconComponent } from '../../components/ui/icon/icon.component';\r\nimport { ButtonComponent } from '../../components/ui/button/button.component';\r\nimport { DialogComponent, DialogHeaderComponent, DialogTitleComponent, DialogContentComponent, DialogFooterComponent } from '../../components/ui/dialog/dialog.component';\r\nimport { FundingSpreadDetailsComponent } from '../../components/trading/funding-spread-details/funding-spread-details.component';\r\nimport { DropdownComponent, DropdownOption } from '../../components/ui/dropdown/dropdown.component';\r\nimport { InputComponent } from '../../components/ui/input/input.component';\r\n\r\n/**\r\n * Unified opportunity type that supports all strategies\r\n */\r\ntype UnifiedOpportunity = FundingRateOpportunity & {\r\n  // Additional fields beyond FundingRateOpportunity\r\n  maxFundingSpread?: number;\r\n  maxFundingSpreadPercent?: string;\r\n  priceSpread?: number;\r\n  priceSpreadPercent?: string;\r\n  priceSpreadUsdt?: string;\r\n  combinedScore?: number;\r\n  volatility24h?: number;\r\n  volatility24hFormatted?: string;\r\n  // NEW FIELDS FOR SPOT+FUTURES STRATEGY DISPLAY\r\n  bestFundingExchange?: {\r\n    exchange: string;\r\n    fundingRate: number;\r\n    nextFundingTime: number;\r\n    currentPrice: number;\r\n  };\r\n  bestShortExchange?: {\r\n    exchange: string;\r\n    fundingRate: number;\r\n    nextFundingTime: number;\r\n    currentPrice: number;\r\n  };\r\n};\r\n\r\n/**\r\n * Price Arbitrage Opportunities Component\r\n *\r\n * Displays price arbitrage opportunities with support for multiple strategies:\r\n * - Cross-Exchange Arbitrage (combined price spread + funding rates)\r\n * - Graduated Entry (Spot + Futures on same exchange)\r\n * Features:\r\n * - Real-time price and funding rate data\r\n * - Combined score calculation (price + funding)\r\n * - Strategy type filtering (Combined / Price Only / Spot + Futures / Graduated Entry)\r\n * - Sortable columns\r\n * - Auto-refresh every 30 seconds\r\n */\r\n@Component({\r\n  selector: 'app-price-arbitrage-opportunities',\r\n  standalone: true,\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    RouterModule,\r\n    IconComponent,\r\n    ButtonComponent,\r\n    DialogComponent,\r\n    DialogHeaderComponent,\r\n    DialogTitleComponent,\r\n    DialogContentComponent,\r\n    DialogFooterComponent,\r\n    FundingSpreadDetailsComponent,\r\n    DropdownComponent,\r\n    InputComponent,\r\n  ],\r\n  templateUrl: './price-arbitrage-opportunities.component.html',\r\n  styleUrls: ['./price-arbitrage-opportunities.component.scss'],\r\n  encapsulation: ViewEncapsulation.None\r\n})\r\n\r\nexport class PriceArbitrageOpportunitiesComponent implements OnInit, OnDestroy {\r\n  private fundingRatesService = inject(PublicFundingRatesService);\r\n  private router = inject(Router);\r\n\r\n  // State\r\n  opportunities = signal<UnifiedOpportunity[]>([]);\r\n  isLoading = signal<boolean>(false);\r\n  error = signal<string | null>(null);\r\n  lastUpdated = signal<Date | null>(null);\r\n\r\n  // Stats from API\r\n  stats = signal<{\r\n    totalOpportunities: number;\r\n    combinedStrategy: number;\r\n    priceOnly: number;\r\n    fundingDataAvailable: boolean;\r\n  } | null>(null);\r\n\r\n  // Auto-refresh\r\n  private refreshSubscription?: Subscription;\r\n  private readonly REFRESH_INTERVAL_MS = 30 * 1000; // 30 seconds\r\n\r\n  // LocalStorage keys\r\n  private readonly SELECTED_EXCHANGES_KEY = 'priceArbitrage_selectedExchanges';\r\n\r\n  // Available exchanges\r\n  availableExchanges = ['BINGX', 'BYBIT', 'BINANCE', 'MEXC', 'GATEIO', 'BITGET'];\r\n\r\n  // Strategy type dropdown options\r\n  strategyTypeOptions: DropdownOption[] = [\r\n    { value: 'combined', label: 'Combined' },\r\n    { value: 'price_only', label: 'Price Only' },\r\n    { value: 'spot_futures', label: 'Spot + Futures' },\r\n    { value: 'funding_farm', label: 'Funding Farm (Œî-Neutral)' },\r\n  ];\r\n\r\n  // Filters\r\n  searchQuery = signal<string>('');\r\n  minCombinedScore = signal<number | null>(null);\r\n  minFundingRate = signal<number | null>(null);\r\n  minPriceSpread = signal<number | null>(null);\r\n  strategyTypeFilter = signal<'combined' | 'price_only' | 'spot_futures' | 'funding_farm'>('combined');\r\n  selectedExchanges = signal<string[]>([]);\r\n\r\n  // Sorting\r\n  sortColumn = signal<'symbol' | 'spreadPercent' | 'fundingDifferential' | 'combinedScore' | 'expectedDailyReturn' | 'estimatedMonthlyROI' | 'volatility'>('combinedScore');\r\n  sortDirection = signal<'asc' | 'desc'>('desc');\r\n\r\n  // Current time for time-since-update display\r\n  private currentTime = signal<number>(Date.now());\r\n  private timeUpdateInterval?: any;\r\n  private _debugLogged = false;\r\n\r\n  // Modal for detailed spread stability metrics\r\n  showDetailsModal = signal<boolean>(false);\r\n  selectedOpportunity = signal<FundingRateOpportunity | null>(null);\r\n  loadingPhase2Metrics = signal<Set<string>>(new Set());\r\n  phase2MetricsCache = signal<Map<string, FundingRateOpportunity>>(new Map());\r\n\r\n  // User-selected exchange pairs for each symbol (overrides backend defaults)\r\n  // Map<symbol, { longExchange: string, shortExchange: string }>\r\n  selectedExchangePairs = signal<Map<string, { longExchange: string; shortExchange: string }>>(new Map());\r\n\r\n  // Computed time since update\r\n  timeSinceUpdate = computed(() => {\r\n    const lastUpdate = this.lastUpdated();\r\n    if (!lastUpdate) return '‚Äî';\r\n\r\n    const now = this.currentTime();\r\n    const seconds = Math.floor((now - lastUpdate.getTime()) / 1000);\r\n    if (seconds < 60) return `${seconds}s ago`;\r\n\r\n    const minutes = Math.floor(seconds / 60);\r\n    return `${minutes}m ago`;\r\n  });\r\n\r\n  // Check if spot-futures filter is active\r\n  isSpotFuturesMode = computed(() => {\r\n    return this.strategyTypeFilter() === 'spot_futures';\r\n  });\r\n\r\n  // Check if funding farm filter is active\r\n  isFundingFarmMode = computed(() => {\r\n    return this.strategyTypeFilter() === 'funding_farm';\r\n  });\r\n\r\n\r\n  // Computed filtered & sorted opportunities\r\n  filteredOpportunities = computed(() => {\r\n    let filtered = [...this.opportunities()];\r\n\r\n    // Filter by search query (symbol)\r\n    const query = this.searchQuery().trim().toUpperCase();\r\n    if (query) {\r\n      filtered = filtered.filter(o => o.symbol.toUpperCase().includes(query));\r\n    }\r\n\r\n    // Filter by strategy type\r\n    const strategyFilter = this.strategyTypeFilter();\r\n    if (strategyFilter === 'spot_futures') {\r\n      // For spot+futures, already filtered by loadOpportunities()\r\n      // Keep all opportunities as they're already spot+futures type\r\n    } else if (strategyFilter === 'funding_farm') {\r\n      // For funding farm, show all opportunities with positive funding differential\r\n      // (we'll compensate price difference with delta-neutral hedging)\r\n      filtered = filtered.filter(o => o.maxFundingSpread && o.maxFundingSpread > 0);\r\n    } else {\r\n      filtered = filtered.filter(o => o.strategyType === strategyFilter);\r\n    }\r\n\r\n    // Filter by selected exchanges (case-insensitive comparison)\r\n    const exchanges = this.selectedExchanges();\r\n    if (exchanges.length > 0 && strategyFilter !== 'spot_futures') {\r\n      const exchangesUpper = exchanges.map(e => e.toUpperCase());\r\n      filtered = filtered.filter(o => {\r\n        // Type guard: check if this is a FundingRateOpportunity with bestShort/bestLong\r\n        if ('bestShort' in o && 'bestLong' in o && o.bestShort && o.bestLong) {\r\n          return exchangesUpper.includes(o.bestShort.exchange.toUpperCase()) &&\r\n                 exchangesUpper.includes(o.bestLong.exchange.toUpperCase());\r\n        }\r\n        return false;\r\n      });\r\n    } else if (exchanges.length > 0 && strategyFilter === 'spot_futures') {\r\n      // For spot+futures, filter by futures exchange (bestShort)\r\n      const exchangesUpper = exchanges.map(e => e.toUpperCase());\r\n      filtered = filtered.filter(o => {\r\n        // Type guard: check if this is a spot+futures opportunity with bestShort\r\n        if ('bestShort' in o && o.bestShort && typeof o.bestShort.exchange === 'string') {\r\n          return exchangesUpper.includes(o.bestShort.exchange.toUpperCase());\r\n        }\r\n        return false;\r\n      });\r\n    }\r\n\r\n    // Filter by minimum combined score\r\n    const minScore = this.minCombinedScore();\r\n    if (minScore !== null) {\r\n      filtered = filtered.filter(o => {\r\n        const score = o.combinedScore !== undefined ? o.combinedScore : ((o.priceSpread || 0) * 100);\r\n        return score >= minScore;\r\n      });\r\n    }\r\n\r\n    // Filter by minimum funding rate (by absolute value)\r\n    const minFunding = this.minFundingRate();\r\n    if (minFunding !== null) {\r\n      filtered = filtered.filter(o => {\r\n        const fundingRate = o.maxFundingSpread ? o.maxFundingSpread * 100 : 0;\r\n        return Math.abs(fundingRate) >= minFunding;\r\n      });\r\n    }\r\n\r\n    // Filter by minimum price spread\r\n    const minSpread = this.minPriceSpread();\r\n    if (minSpread !== null) {\r\n      filtered = filtered.filter(o => {\r\n        const priceSpread = (o.priceSpread || 0) * 100;\r\n        return priceSpread >= minSpread;\r\n      });\r\n    }\r\n\r\n    // Sort\r\n    const column = this.sortColumn();\r\n    const direction = this.sortDirection();\r\n\r\n    filtered.sort((a, b) => {\r\n      let aValue: number;\r\n      let bValue: number;\r\n\r\n      switch (column) {\r\n        case 'symbol':\r\n          return direction === 'asc'\r\n            ? a.symbol.localeCompare(b.symbol)\r\n            : b.symbol.localeCompare(a.symbol);\r\n\r\n        case 'spreadPercent':\r\n          aValue = (a.priceSpread || 0) * 100;\r\n          bValue = (b.priceSpread || 0) * 100;\r\n          break;\r\n\r\n        case 'fundingDifferential':\r\n          aValue = (a.maxFundingSpread ?? 0) * 100;\r\n          bValue = (b.maxFundingSpread ?? 0) * 100;\r\n          break;\r\n\r\n        case 'combinedScore':\r\n          aValue = a.combinedScore ?? ((a.priceSpread || 0) * 100);\r\n          bValue = b.combinedScore ?? ((b.priceSpread || 0) * 100);\r\n          break;\r\n\r\n        case 'expectedDailyReturn':\r\n          aValue = a.expectedDailyReturn ?? ((a.priceSpread || 0) * 100);\r\n          bValue = b.expectedDailyReturn ?? ((b.priceSpread || 0) * 100);\r\n          break;\r\n\r\n        case 'estimatedMonthlyROI':\r\n          aValue = a.estimatedMonthlyROI ?? ((a.priceSpread || 0) * 100);\r\n          bValue = b.estimatedMonthlyROI ?? ((b.priceSpread || 0) * 100);\r\n          break;\r\n\r\n        case 'volatility':\r\n          aValue = a.volatility24h ?? 0;\r\n          bValue = b.volatility24h ?? 0;\r\n          break;\r\n\r\n        default:\r\n          aValue = 0;\r\n          bValue = 0;\r\n      }\r\n\r\n      return direction === 'asc' ? aValue - bValue : bValue - aValue;\r\n    });\r\n\r\n    return filtered;\r\n  });\r\n\r\n  ngOnInit(): void {\r\n    // Load saved exchange filters from localStorage\r\n    this.loadSavedExchangeFilters();\r\n\r\n    // Start time update interval\r\n    this.timeUpdateInterval = setInterval(() => {\r\n      const now = Date.now();\r\n      this.currentTime.set(now);\r\n      // DEBUG: Log every 10 seconds to check if time is correct\r\n      if (now % 10000 < 1000) {\r\n        console.error('[DEBUG currentTime]', {\r\n          now,\r\n          nowUTC: new Date(now).toISOString(),\r\n          nowLocal: new Date(now).toString()\r\n        });\r\n      }\r\n    }, 1000);\r\n\r\n    // Initial load\r\n    this.loadOpportunities();\r\n\r\n    // Setup auto-refresh\r\n    this.refreshSubscription = interval(this.REFRESH_INTERVAL_MS)\r\n      .pipe(\r\n        startWith(0),\r\n        switchMap(() => {\r\n          this.loadOpportunities();\r\n          return [];\r\n        })\r\n      )\r\n      .subscribe();\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    if (this.refreshSubscription) {\r\n      this.refreshSubscription.unsubscribe();\r\n    }\r\n    if (this.timeUpdateInterval) {\r\n      clearInterval(this.timeUpdateInterval);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Load arbitrage opportunities from public APIs (with combined strategy metrics)\r\n   */\r\n  loadOpportunities(): void {\r\n    this.isLoading.set(true);\r\n    this.error.set(null);\r\n\r\n    const strategyFilter = this.strategyTypeFilter();\r\n\r\n    if (strategyFilter === 'spot_futures') {\r\n      // Load spot + futures opportunities (filter for positive funding only)\r\n      this.fundingRatesService.getFundingRatesOpportunities().subscribe({\r\n        next: (allOpportunities: FundingRateOpportunity[]) => {\r\n          // Filter: only show coins with positive funding rate on at least one exchange\r\n          const spotFuturesOpportunities = allOpportunities\r\n            .map((opp: FundingRateOpportunity) => {\r\n              // Find exchange with highest positive funding rate\r\n              const positiveFundingExchanges = opp.exchanges.filter((ex: any) => {\r\n                const rate = parseFloat(ex.fundingRate);\r\n                return rate > 0;\r\n              });\r\n\r\n              if (positiveFundingExchanges.length === 0) {\r\n                return null; // Skip coins without positive funding\r\n              }\r\n\r\n              // Sort by funding rate (highest first)\r\n              const bestFutures = positiveFundingExchanges.sort((a: any, b: any) =>\r\n                parseFloat(b.fundingRate) - parseFloat(a.fundingRate)\r\n              )[0];\r\n\r\n              return {\r\n                ...opp,\r\n                strategyType: 'spot_futures' as const,\r\n                bestShort: bestFutures, // Best exchange for SHORT (highest funding)\r\n                // TODO: Add bestLong for SPOT (lowest price) when spot prices available\r\n              };\r\n            })\r\n            .filter(opp => opp !== null) as UnifiedOpportunity[];\r\n\r\n          this.opportunities.set(spotFuturesOpportunities);\r\n          this.error.set(null);\r\n          this.isLoading.set(false);\r\n          this.lastUpdated.set(new Date());\r\n        },\r\n        error: (err: any) => {\r\n          this.error.set('Failed to load spot+futures opportunities: ' + err.message);\r\n          this.isLoading.set(false);\r\n        },\r\n      });\r\n    } else {\r\n      // Load cross-exchange opportunities (existing behavior)\r\n      this.fundingRatesService.getFundingRatesOpportunities().subscribe({\r\n        next: (opportunities: FundingRateOpportunity[]) => {\r\n          this.opportunities.set(opportunities as UnifiedOpportunity[]);\r\n          this.error.set(null);\r\n          this.isLoading.set(false);\r\n          this.lastUpdated.set(new Date());\r\n        },\r\n        error: (err: any) => {\r\n          this.error.set('Failed to load opportunities: ' + err.message);\r\n          this.isLoading.set(false);\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set sorting column\r\n   */\r\n  setSortColumn(column: 'symbol' | 'spreadPercent' | 'fundingDifferential' | 'combinedScore' | 'expectedDailyReturn' | 'estimatedMonthlyROI' | 'volatility'): void {\r\n    if (this.sortColumn() === column) {\r\n      // Toggle direction\r\n      this.sortDirection.set(this.sortDirection() === 'asc' ? 'desc' : 'asc');\r\n    } else {\r\n      // New column, default to descending\r\n      this.sortColumn.set(column);\r\n      this.sortDirection.set('desc');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Format percentage for display\r\n   */\r\n  formatPercent(value: number | undefined, decimals = 2): string {\r\n    if (value === undefined || value === null) return '‚Äî';\r\n    return `${value.toFixed(decimals)}%`;\r\n  }\r\n\r\n  /**\r\n   * Format funding rate for display (convert from decimal to %)\r\n   * Now shows NORMALIZED rate (per 8h) for fair comparison\r\n   */\r\n  formatFundingRate(rate: string | undefined): string {\r\n    if (rate === undefined || rate === null) return '‚Äî';\r\n    const rateNum = parseFloat(rate);\r\n    return (rateNum * 100).toFixed(4) + '%';\r\n  }\r\n\r\n  /**\r\n   * Format NORMALIZED funding rate from ExchangeFundingRate object\r\n   * Shows the normalized rate (per 8h) for fair comparison across exchanges\r\n   */\r\n  formatNormalizedFundingRate(exchange: any): string {\r\n    if (!exchange) return '‚Äî';\r\n\r\n    // Use normalized rate if available, otherwise fall back to original\r\n    const rate = exchange.fundingRateNormalized !== undefined\r\n      ? exchange.fundingRateNormalized\r\n      : parseFloat(exchange.fundingRate);\r\n\r\n    return (rate * 100).toFixed(4) + '%';\r\n  }\r\n\r\n  /**\r\n   * Get strategy type badge class\r\n   */\r\n  getStrategyBadgeClass(strategyType: string): string {\r\n    switch (strategyType) {\r\n      case 'combined':\r\n        return 'badge-combined';\r\n      case 'price_only':\r\n        return 'badge-price-only';\r\n      case 'funding_only':\r\n        return 'badge-funding-only';\r\n      default:\r\n        return 'badge-default';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get strategy type display text\r\n   */\r\n  getStrategyTypeText(strategyType: string): string {\r\n    switch (strategyType) {\r\n      case 'combined':\r\n        return 'Combined';\r\n      case 'price_only':\r\n        return 'Price Only';\r\n      case 'funding_only':\r\n        return 'Funding Only';\r\n      case 'spot_futures':\r\n        return 'Spot+Futures';\r\n      default:\r\n        return 'Unknown';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get time to funding for graduated entry opportunity\r\n   */\r\n  getSpotFuturesTimeToFunding(nextFundingTime: Date | number): string {\r\n    const now = this.currentTime();\r\n    // Handle both Date objects and timestamps\r\n    const fundingTime = typeof nextFundingTime === 'number'\r\n      ? nextFundingTime\r\n      : (typeof nextFundingTime === 'string' ? new Date(nextFundingTime).getTime() : nextFundingTime.getTime());\r\n    const diff = fundingTime - now;\r\n\r\n    // DEBUG\r\n    if (!this._debugLogged) {\r\n      this._debugLogged = true;\r\n      console.error('[DEBUG getSpotFuturesTimeToFunding]', {\r\n        nextFundingTime,\r\n        nextFundingTimeType: typeof nextFundingTime,\r\n        fundingTime,\r\n        fundingTimeUTC: new Date(fundingTime).toISOString(),\r\n        now,\r\n        nowUTC: new Date(now).toISOString(),\r\n        diff,\r\n        diffMinutes: Math.floor(diff / (1000 * 60))\r\n      });\r\n    }\r\n\r\n    if (diff <= 0) return '0m';\r\n\r\n    const hours = Math.floor(diff / (1000 * 60 * 60));\r\n    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));\r\n\r\n    if (hours > 0) {\r\n      return `${hours}h ${minutes}m`;\r\n    }\r\n    return `${minutes}m`;\r\n  }\r\n\r\n  /**\r\n   * Format time to funding with interval for graduated entry\r\n   */\r\n  formatSpotFuturesFundingTime(nextFundingTime: Date | number, fundingInterval: number): string {\r\n    const timeToFunding = this.getSpotFuturesTimeToFunding(nextFundingTime);\r\n    return `${timeToFunding} / ${fundingInterval}h`;\r\n  }\r\n\r\n  /**\r\n   * Type guard: check if opportunity has spot_futures strategy\r\n   */\r\n  isSpotFuturesStrategy(opp: UnifiedOpportunity): boolean {\r\n    return opp.strategyType === 'spot_futures';\r\n  }\r\n\r\n  /**\r\n   * Cast to FundingRateOpportunity for template use\r\n   */\r\n  asFundingRateOpportunity(opp: UnifiedOpportunity): FundingRateOpportunity {\r\n    return opp;\r\n  }\r\n\r\n  /**\r\n   * Cast to UnifiedOpportunity with spot_futures strategy for template use\r\n   */\r\n  asSpotFuturesOpportunity(opp: UnifiedOpportunity): UnifiedOpportunity | null {\r\n    return this.isSpotFuturesStrategy(opp) ? opp : null;\r\n  }\r\n\r\n  /**\r\n   * Parse funding rate string to number for display\r\n   */\r\n  parseFundingRateToNumber(rate: string | undefined): number {\r\n    if (!rate) return 0;\r\n    return parseFloat(rate) * 100; // Convert decimal to percentage\r\n  }\r\n\r\n  /**\r\n   * Convert timestamp to Date and format funding time with interval\r\n   */\r\n  formatFundingTimeFromTimestamp(timestamp: number, intervalStr: string | undefined): string {\r\n    const intervalNum = intervalStr ? parseInt(intervalStr) : 8; // Default to 8h\r\n    return this.formatSpotFuturesFundingTime(timestamp, intervalNum);\r\n  }\r\n\r\n  /**\r\n   * Refresh opportunities manually\r\n   */\r\n  refresh(): void {\r\n    this.loadOpportunities();\r\n  }\r\n\r\n  /**\r\n   * Handle strategy type change\r\n   */\r\n  onStrategyTypeChange(value: 'combined' | 'price_only' | 'spot_futures' | 'funding_farm'): void {\r\n    this.strategyTypeFilter.set(value);\r\n    this.loadOpportunities();\r\n  }\r\n\r\n  /**\r\n   * Clear all filters\r\n   */\r\n  clearFilters(): void {\r\n    this.searchQuery.set('');\r\n    this.minCombinedScore.set(null);\r\n    this.minFundingRate.set(null);\r\n    this.minPriceSpread.set(null);\r\n    this.strategyTypeFilter.set('combined');\r\n    this.selectedExchanges.set([...this.availableExchanges]); // Select all exchanges\r\n    this.saveExchangeFilters(); // Save cleared state to localStorage\r\n  }\r\n\r\n  /**\r\n   * Load saved exchange filters from localStorage\r\n   */\r\n  private loadSavedExchangeFilters(): void {\r\n    try {\r\n      const saved = localStorage.getItem(this.SELECTED_EXCHANGES_KEY);\r\n      if (saved) {\r\n        const exchanges = JSON.parse(saved) as string[];\r\n        // Validate that saved exchanges are still in availableExchanges\r\n        const validExchanges = exchanges.filter(ex => this.availableExchanges.includes(ex));\r\n        this.selectedExchanges.set(validExchanges);\r\n      } else {\r\n        // Default: select all exchanges on first load\r\n        this.selectedExchanges.set([...this.availableExchanges]);\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to load saved exchange filters:', error);\r\n      // On error, default to all exchanges\r\n      this.selectedExchanges.set([...this.availableExchanges]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Save exchange filters to localStorage\r\n   */\r\n  private saveExchangeFilters(): void {\r\n    try {\r\n      localStorage.setItem(this.SELECTED_EXCHANGES_KEY, JSON.stringify(this.selectedExchanges()));\r\n    } catch (error) {\r\n      console.error('Failed to save exchange filters:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Toggle exchange selection\r\n   */\r\n  toggleExchange(exchange: string): void {\r\n    const current = this.selectedExchanges();\r\n    if (current.includes(exchange)) {\r\n      this.selectedExchanges.set(current.filter(e => e !== exchange));\r\n    } else {\r\n      this.selectedExchanges.set([...current, exchange]);\r\n    }\r\n    this.saveExchangeFilters();\r\n  }\r\n\r\n  /**\r\n   * Check if exchange is selected\r\n   */\r\n  isExchangeSelected(exchange: string): boolean {\r\n    return this.selectedExchanges().includes(exchange);\r\n  }\r\n\r\n  /**\r\n   * Select all exchanges\r\n   */\r\n  selectAllExchanges(): void {\r\n    this.selectedExchanges.set([...this.availableExchanges]);\r\n    this.saveExchangeFilters();\r\n  }\r\n\r\n  /**\r\n   * Deselect all exchanges\r\n   */\r\n  deselectAllExchanges(): void {\r\n    this.selectedExchanges.set([]);\r\n    this.saveExchangeFilters();\r\n  }\r\n\r\n  /**\r\n   * Get funding spread color class\r\n   */\r\n  getFundingSpreadColorClass(spread: number | undefined): string {\r\n    if (!spread) return 'text-gray-600';\r\n    if (spread >= 0.001) return 'text-green-600';\r\n    if (spread >= 0.0005) return 'text-yellow-600';\r\n    return 'text-gray-600';\r\n  }\r\n\r\n  /**\r\n   * Get funding rate color class\r\n   */\r\n  getFundingRateColorClass(rate: string | undefined): string {\r\n    if (!rate) return '';\r\n    const numRate = parseFloat(rate);\r\n    if (numRate > 0) return 'positive';\r\n    if (numRate < 0) return 'negative';\r\n    return '';\r\n  }\r\n\r\n  /**\r\n   * Get spot price for an opportunity\r\n   */\r\n  getSpotPrice(opp: UnifiedOpportunity): number | null {\r\n    if (!opp.bestLong || !opp.bestLong.lastPrice) {\r\n      return null;\r\n    }\r\n\r\n    if (this.isSpotFuturesStrategy(opp)) {\r\n      // For spot_futures strategy: return bestLong price (lowest spot price)\r\n      // TODO: Implement actual spot prices when available\r\n      return parseFloat(opp.bestLong.lastPrice);\r\n    } else if (!this.isSpotFuturesStrategy(opp)) {\r\n      // For cross-exchange, the lower price is considered \"spot\"\r\n      return parseFloat(opp.bestLong.lastPrice);\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Get futures price for an opportunity\r\n   */\r\n  getFuturesPrice(opp: UnifiedOpportunity): number | null {\r\n    if (!opp.bestShort || !opp.bestShort.lastPrice) {\r\n      return null;\r\n    }\r\n\r\n    if (this.isSpotFuturesStrategy(opp)) {\r\n      // For spot_futures strategy: return bestShort price (futures with highest funding)\r\n      return parseFloat(opp.bestShort.lastPrice);\r\n    } else if (!this.isSpotFuturesStrategy(opp)) {\r\n      // For cross-exchange, the higher price is considered \"futures\"\r\n      return parseFloat(opp.bestShort.lastPrice);\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Get price spread with direction indicator\r\n   * Returns object with spread value, percentage, and indicator\r\n   */\r\n  getPriceSpreadInfo(opp: UnifiedOpportunity): {\r\n    spread: number;\r\n    spreadPercent: number;\r\n    spreadUsdt: number;\r\n    isFavorable: boolean;\r\n    indicator: string;\r\n    colorClass: string;\r\n  } {\r\n    const spotPrice = this.getSpotPrice(opp);\r\n    const futuresPrice = this.getFuturesPrice(opp);\r\n\r\n    if (!spotPrice || !futuresPrice) {\r\n      return {\r\n        spread: 0,\r\n        spreadPercent: 0,\r\n        spreadUsdt: 0,\r\n        isFavorable: false,\r\n        indicator: '‚ö™',\r\n        colorClass: 'neutral'\r\n      };\r\n    }\r\n\r\n    const spreadUsdt = futuresPrice - spotPrice;\r\n    const spreadPercent = (spreadUsdt / spotPrice) * 100;\r\n\r\n    // For funding arbitrage: LONG price > SHORT price is favorable (inverted from price arbitrage)\r\n    // spotPrice = bestLong (LONG position), futuresPrice = bestShort (SHORT position)\r\n    // We want LONG price > SHORT price for entry spread profit\r\n    const isFavorable = spotPrice > futuresPrice; // LONG > SHORT is favorable\r\n\r\n    return {\r\n      spread: opp.priceSpread || 0,\r\n      spreadPercent,\r\n      spreadUsdt,\r\n      isFavorable,\r\n      indicator: isFavorable ? 'üü¢' : 'üî¥',\r\n      colorClass: isFavorable ? 'favorable' : 'unfavorable'\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Format price for display\r\n   */\r\n  formatPrice(price: number | null): string {\r\n    if (price === null || price === undefined) return '‚Äî';\r\n\r\n    // For very large prices (> 1000), show 2 decimals\r\n    if (price >= 1000) {\r\n      return `$${price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;\r\n    }\r\n\r\n    // For medium prices (10-1000), show 2-4 decimals\r\n    if (price >= 10) {\r\n      return `$${price.toFixed(2)}`;\r\n    }\r\n\r\n    // For small prices (< 10), show up to 6 decimals\r\n    return `$${price.toFixed(6)}`;\r\n  }\r\n\r\n  /**\r\n   * Get exchange label for spot/futures display\r\n   */\r\n  getExchangeLabel(opp: UnifiedOpportunity, type: 'spot' | 'futures'): string {\r\n    if (this.isSpotFuturesStrategy(opp)) {\r\n      // For spot_futures: bestShort has the futures exchange (highest funding)\r\n      // TODO: bestLong should have the spot exchange (lowest price) when implemented\r\n      return type === 'futures'\r\n        ? (opp.bestShort?.exchange || '‚Äî')\r\n        : (opp.bestLong?.exchange || '‚Äî');\r\n    } else if (!this.isSpotFuturesStrategy(opp)) {\r\n      return type === 'spot' ? opp.bestLong.exchange : opp.bestShort.exchange;\r\n    }\r\n    return '‚Äî';\r\n  }\r\n\r\n  /**\r\n   * Calculate delta-neutral hedge ratio for funding farm strategy\r\n   * Returns the ratio of long position size to short position size\r\n   */\r\n  calculateHedgeRatio(opportunity: UnifiedOpportunity): number {\r\n    // Type guard: only calculate for FundingRateOpportunity\r\n    if ('bestLong' in opportunity && 'bestShort' in opportunity && opportunity.bestLong && opportunity.bestShort) {\r\n      const longPrice = parseFloat(opportunity.bestLong.lastPrice);\r\n      const shortPrice = parseFloat(opportunity.bestShort.lastPrice);\r\n\r\n      if (longPrice === 0 || shortPrice === 0) return 1;\r\n\r\n      // To be delta-neutral: Long value = Short value\r\n      // If Short price is higher, we need MORE long contracts\r\n      return shortPrice / longPrice;\r\n    }\r\n    return 1;\r\n  }\r\n\r\n  /**\r\n   * Format hedge ratio for display\r\n   */\r\n  formatHedgeRatio(opportunity: UnifiedOpportunity): string {\r\n    const ratio = this.calculateHedgeRatio(opportunity);\r\n    return ratio.toFixed(4);\r\n  }\r\n\r\n  /**\r\n   * Calculate time to funding for a specific exchange\r\n   * Uses currentTime signal to avoid NG0100\r\n   */\r\n  getTimeToFunding(exchange: { nextFundingTime: number }): string {\r\n    const now = this.currentTime();\r\n    const diff = exchange.nextFundingTime - now;\r\n\r\n    if (diff <= 0) return '0m';\r\n\r\n    const hours = Math.floor(diff / (1000 * 60 * 60));\r\n    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));\r\n\r\n    if (hours > 0) {\r\n      return `${hours}h ${minutes}m`;\r\n    }\r\n    return `${minutes}m`;\r\n  }\r\n\r\n  /**\r\n   * Format time to funding with interval like \"2h 15m / 8h\"\r\n   * Uses fundingInterval from exchange if available, otherwise estimates it\r\n   * Uses currentTime signal to avoid NG0100\r\n   */\r\n  formatTimeToFundingWithInterval(exchange: { nextFundingTime: number; fundingInterval?: string }): string {\r\n    const timeToFunding = this.getTimeToFunding(exchange);\r\n\r\n    // Use provided funding interval if available\r\n    if (exchange.fundingInterval) {\r\n      return `${timeToFunding} / ${exchange.fundingInterval}`;\r\n    }\r\n\r\n    // Fallback: estimate interval based on time until next funding\r\n    const now = this.currentTime();\r\n    const timeUntilFunding = exchange.nextFundingTime - now;\r\n\r\n    let interval = '8h'; // Default\r\n    if (timeUntilFunding > 0) {\r\n      if (timeUntilFunding <= 60 * 60 * 1000) {\r\n        interval = '1h';\r\n      } else if (timeUntilFunding <= 4 * 60 * 60 * 1000) {\r\n        interval = '4h';\r\n      }\r\n    }\r\n\r\n    return `${timeToFunding} / ${interval}`;\r\n  }\r\n\r\n  /**\r\n   * Start arbitrage position - navigate to arbitrage chart page\r\n   */\r\n  startPosition(opportunity: UnifiedOpportunity): void {\r\n    console.log('[PriceArbitrageOpportunities] Starting position for:', opportunity.symbol);\r\n\r\n    // Determine strategy type based on current filter\r\n    const strategy = this.strategyTypeFilter();\r\n\r\n    if (strategy === 'spot_futures') {\r\n      // For spot_futures strategy (spot + futures)\r\n      // Navigate with spot_futures strategy parameter\r\n      const graduatedOpp = opportunity as UnifiedOpportunity & { strategyType: 'spot_futures' };\r\n      // Use bestShort exchange (highest funding rate) for futures\r\n      const futuresExchange = graduatedOpp.bestShort?.exchange || '';\r\n      const spotExchange = graduatedOpp.bestLong?.exchange || futuresExchange; // TODO: use actual spot exchange\r\n      this.router.navigate([\r\n        '/arbitrage/chart',\r\n        graduatedOpp.symbol,\r\n        spotExchange,\r\n        futuresExchange,\r\n        'spot_futures' // Use spot_futures strategy for graduated entry\r\n      ]);\r\n    } else {\r\n      // For cross-exchange arbitrage\r\n      // Use effective exchanges (respects user's dropdown selection)\r\n      const longExchange = this.getEffectiveLongExchange(opportunity);\r\n      const shortExchange = this.getEffectiveShortExchange(opportunity);\r\n\r\n      // Navigate to arbitrage chart with symbol, exchanges, and strategy\r\n      // Format: /arbitrage/chart/:symbol/:longExchange/:shortExchange/:strategy\r\n      this.router.navigate([\r\n        '/arbitrage/chart',\r\n        opportunity.symbol,\r\n        longExchange.exchange,\r\n        shortExchange.exchange,\r\n        strategy\r\n      ]);\r\n\r\n      console.log(`[PriceArbitrageOpportunities] Navigating with: ${longExchange.exchange} (LONG) / ${shortExchange.exchange} (SHORT)`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Open details modal for displaying spread stability metrics\r\n   * Triggers loading of historical stability metrics\r\n   */\r\n  openDetailsModal(opp: UnifiedOpportunity): void {\r\n    // Only open modal for cross-exchange opportunities\r\n    if ('bestShort' in opp && 'bestLong' in opp) {\r\n      this.selectedOpportunity.set(opp as FundingRateOpportunity);\r\n      this.showDetailsModal.set(true);\r\n      // Trigger Phase 2 load\r\n      this.loadPhase2MetricsForSymbol(opp.symbol);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Close details modal\r\n   */\r\n  closeDetailsModal(): void {\r\n    this.showDetailsModal.set(false);\r\n    // Don't clear selectedOpportunity immediately to avoid flicker during close animation\r\n    setTimeout(() => {\r\n      if (!this.showDetailsModal()) {\r\n        this.selectedOpportunity.set(null);\r\n      }\r\n    }, 300);\r\n  }\r\n\r\n  /**\r\n   * Load Phase 2 historical stability metrics for a symbol\r\n   * Fetches historical funding rates and calculates stability metrics\r\n   */\r\n  async loadPhase2MetricsForSymbol(symbol: string): Promise<void> {\r\n    // Check cache\r\n    if (this.phase2MetricsCache().has(symbol)) {\r\n      // Data already loaded\r\n      return;\r\n    }\r\n\r\n    // Find opportunity\r\n    const opp = this.filteredOpportunities().find(o => o.symbol === symbol);\r\n    if (!opp) return;\r\n\r\n    // Only load for FundingRateOpportunity (not SpotFutures)\r\n    if (this.isSpotFuturesStrategy(opp)) return;\r\n\r\n    // Set loading\r\n    const loading = new Set(this.loadingPhase2Metrics());\r\n    loading.add(symbol);\r\n    this.loadingPhase2Metrics.set(loading);\r\n\r\n    try {\r\n      // Load metrics via service\r\n      const updated = await this.fundingRatesService.loadPhase2Metrics(opp);\r\n\r\n      // Update cache\r\n      const cache = new Map(this.phase2MetricsCache());\r\n      cache.set(symbol, updated);\r\n      this.phase2MetricsCache.set(cache);\r\n    } catch (error) {\r\n      console.error('[Phase 2] Load failed:', error);\r\n    } finally {\r\n      // Clear loading\r\n      const loading = new Set(this.loadingPhase2Metrics());\r\n      loading.delete(symbol);\r\n      this.loadingPhase2Metrics.set(loading);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if Phase 2 metrics are currently loading for a symbol\r\n   * Used to show loading spinner in UI\r\n   */\r\n  isLoadingPhase2(symbol: string): boolean {\r\n    return this.loadingPhase2Metrics().has(symbol);\r\n  }\r\n\r\n  /**\r\n   * Get Phase 2 metrics from cache\r\n   * Returns cached metrics or undefined if not loaded\r\n   */\r\n  getPhase2Metrics(symbol: string): FundingRateOpportunity | undefined {\r\n    return this.phase2MetricsCache().get(symbol);\r\n  }\r\n\r\n  /**\r\n   * Map FundingRateOpportunity to format expected by FundingSpreadDetailsComponent\r\n   */\r\n  mapToDetailsOpportunity(opp: FundingRateOpportunity): any {\r\n    // Get Phase 2 metrics if available\r\n    const metrics = this.phase2MetricsCache().get(opp.symbol);\r\n    const spreadHistory7d = metrics?.spreadHistory7d;\r\n    const spreadHistory30d = metrics?.spreadHistory30d;\r\n\r\n    return {\r\n      symbol: opp.symbol,\r\n      spread: opp.maxFundingSpread,\r\n      spreadPercentage: Math.abs((opp.maxFundingSpread || 0) * 100),\r\n      bestLongExchange: opp.bestLong.exchange,\r\n      bestShortExchange: opp.bestShort.exchange,\r\n      longFundingRate: parseFloat(opp.bestLong.fundingRate || '0'),\r\n      shortFundingRate: parseFloat(opp.bestShort.fundingRate || '0'),\r\n      currentPrice: parseFloat(opp.bestLong.lastPrice),\r\n      volume24h: opp.volume24h,\r\n      metrics: {\r\n        historicalStability: spreadHistory7d?.stabilityScore ? spreadHistory7d.stabilityScore / 100 : 0.5,\r\n        avgSpread7d: spreadHistory7d?.average || 0,\r\n        avgSpread30d: spreadHistory30d?.average || 0,\r\n        spreadVolatility: spreadHistory7d?.standardDeviation || 0,\r\n        trendDirection: metrics?.spreadStabilityTrend === 'improving' ? 'increasing' :\r\n                       metrics?.spreadStabilityTrend === 'declining' ? 'decreasing' : 'stable'\r\n      }\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Format funding rate as percentage\r\n   */\r\n  formatFundingRatePercent(rate: number | undefined): string {\r\n    if (rate === undefined || rate === null) return '‚Äî';\r\n    return `${(rate * 100).toFixed(4)}%`;\r\n  }\r\n\r\n  /**\r\n   * Get funding rate color class\r\n   */\r\n  getFundingRateColorClassFromNumber(rate: number | undefined): string {\r\n    if (rate === undefined || rate === null) return '';\r\n    if (rate > 0) return 'positive';\r\n    if (rate < 0) return 'negative';\r\n    return '';\r\n  }\r\n\r\n  /**\r\n   * Format time to next funding with interval\r\n   */\r\n  formatTimeToNextFunding(nextFundingTime: number | undefined): string {\r\n    if (!nextFundingTime) return '‚Äî';\r\n\r\n    const now = this.currentTime();\r\n    const diff = nextFundingTime - now;\r\n\r\n    // DEBUG: Log first call to see values\r\n    if (!this._debugLogged) {\r\n      this._debugLogged = true;\r\n      console.error('[DEBUG formatTimeToNextFunding]', {\r\n        nextFundingTime,\r\n        nextFundingTimeType: typeof nextFundingTime,\r\n        nextFundingTimeUTC: new Date(nextFundingTime).toISOString(),\r\n        now,\r\n        nowUTC: new Date(now).toISOString(),\r\n        diff,\r\n        diffMinutes: Math.floor(diff / (1000 * 60))\r\n      });\r\n    }\r\n\r\n    if (diff <= 0) return '0m';\r\n\r\n    const hours = Math.floor(diff / (1000 * 60 * 60));\r\n    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));\r\n\r\n    // Calculate interval dynamically based on time until next funding\r\n    let interval = '8h'; // Default\r\n    if (diff > 0) {\r\n      if (diff <= 1 * 60 * 60 * 1000) {\r\n        interval = '1h';\r\n      } else if (diff <= 4 * 60 * 60 * 1000) {\r\n        interval = '4h';\r\n      }\r\n    }\r\n\r\n    const timeStr = hours > 0 ? `${hours}h ${minutes}m` : `${minutes}m`;\r\n    return `${timeStr} / ${interval}`;\r\n  }\r\n\r\n  /**\r\n   * Get effective long exchange for a symbol (user selection or backend default)\r\n   */\r\n  getEffectiveLongExchange(opp: UnifiedOpportunity): any {\r\n    const fundingOpp = this.asFundingRateOpportunity(opp);\r\n    if (!fundingOpp) return null;\r\n\r\n    const selectedPair = this.selectedExchangePairs().get(opp.symbol);\r\n    if (selectedPair) {\r\n      // Find the selected exchange in exchanges array\r\n      return fundingOpp.exchanges.find(e => e.exchange === selectedPair.longExchange) || fundingOpp.bestLong;\r\n    }\r\n    return fundingOpp.bestLong;\r\n  }\r\n\r\n  /**\r\n   * Get effective short exchange for a symbol (user selection or backend default)\r\n   */\r\n  getEffectiveShortExchange(opp: UnifiedOpportunity): any {\r\n    const fundingOpp = this.asFundingRateOpportunity(opp);\r\n    if (!fundingOpp) return null;\r\n\r\n    const selectedPair = this.selectedExchangePairs().get(opp.symbol);\r\n    if (selectedPair) {\r\n      // Find the selected exchange in exchanges array\r\n      return fundingOpp.exchanges.find(e => e.exchange === selectedPair.shortExchange) || fundingOpp.bestShort;\r\n    }\r\n    return fundingOpp.bestShort;\r\n  }\r\n\r\n  /**\r\n   * Get available exchanges for long position (sorted by normalized funding rate - lowest first)\r\n   */\r\n  getAvailableExchangesForLong(opp: UnifiedOpportunity): any[] {\r\n    const fundingOpp = this.asFundingRateOpportunity(opp);\r\n    if (!fundingOpp || !fundingOpp.exchanges) return [];\r\n\r\n    // Sort by normalized rate (lowest first) - best for LONG position\r\n    return [...fundingOpp.exchanges].sort((a, b) => {\r\n      const rateA = a.fundingRateNormalized !== undefined ? a.fundingRateNormalized : parseFloat(a.fundingRate);\r\n      const rateB = b.fundingRateNormalized !== undefined ? b.fundingRateNormalized : parseFloat(b.fundingRate);\r\n      return rateA - rateB;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get available exchanges for short position (sorted by normalized funding rate - highest first)\r\n   */\r\n  getAvailableExchangesForShort(opp: UnifiedOpportunity): any[] {\r\n    const fundingOpp = this.asFundingRateOpportunity(opp);\r\n    if (!fundingOpp || !fundingOpp.exchanges) return [];\r\n\r\n    // Sort by normalized rate (highest first) - best for SHORT position\r\n    return [...fundingOpp.exchanges].sort((a, b) => {\r\n      const rateA = a.fundingRateNormalized !== undefined ? a.fundingRateNormalized : parseFloat(a.fundingRate);\r\n      const rateB = b.fundingRateNormalized !== undefined ? b.fundingRateNormalized : parseFloat(b.fundingRate);\r\n      return rateB - rateA;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get dropdown options for long exchanges\r\n   */\r\n  getLongExchangeOptions(opp: UnifiedOpportunity): DropdownOption[] {\r\n    const exchanges = this.getAvailableExchangesForLong(opp);\r\n    return exchanges.map(ex => ({\r\n      value: ex.exchange,\r\n      label: `<span class=\"exchange\">${ex.exchange}</span> (${this.formatFundingRate(ex.fundingRate)} | ${ex.fundingInterval || '8h'})`\r\n    }));\r\n  }\r\n\r\n  /**\r\n   * Get dropdown options for short exchanges\r\n   */\r\n  getShortExchangeOptions(opp: UnifiedOpportunity): DropdownOption[] {\r\n    const exchanges = this.getAvailableExchangesForShort(opp);\r\n    return exchanges.map(ex => ({\r\n      value: ex.exchange,\r\n      label: `<span class=\"exchange\">${ex.exchange}</span> (${this.formatFundingRate(ex.fundingRate)} | ${ex.fundingInterval || '8h'})`\r\n    }));\r\n  }\r\n\r\n  /**\r\n   * Handle exchange selection change\r\n   */\r\n  onExchangeChange(symbol: string, type: 'long' | 'short', newExchange: string): void {\r\n    const currentPairs = this.selectedExchangePairs();\r\n    const currentPair = currentPairs.get(symbol);\r\n\r\n    const newPair = {\r\n      longExchange: type === 'long' ? newExchange : (currentPair?.longExchange || ''),\r\n      shortExchange: type === 'short' ? newExchange : (currentPair?.shortExchange || '')\r\n    };\r\n\r\n    // Update the map\r\n    const updatedPairs = new Map(currentPairs);\r\n    updatedPairs.set(symbol, newPair);\r\n    this.selectedExchangePairs.set(updatedPairs);\r\n\r\n    console.log(`[ExchangeSelection] ${symbol}: ${type} changed to ${newExchange}`, newPair);\r\n  }\r\n\r\n  /**\r\n   * Get recalculated metrics for custom exchange pair\r\n   * Returns formatted metrics for display\r\n   */\r\n  getRecalculatedMetrics(opp: UnifiedOpportunity): {\r\n    fundingSpread: string;\r\n    fundingSpreadPercent: string;\r\n    estimatedAPR: string;\r\n    netAPR: string;\r\n    combinedScore: number;\r\n    dailyReturn: number;\r\n    monthlyROI: number;\r\n  } | null {\r\n    const longExchange = this.getEffectiveLongExchange(opp);\r\n    const shortExchange = this.getEffectiveShortExchange(opp);\r\n\r\n    if (!longExchange || !shortExchange) return null;\r\n\r\n    // Calculate funding spread using normalized rates\r\n    const longRate = longExchange.fundingRateNormalized !== undefined\r\n      ? longExchange.fundingRateNormalized\r\n      : parseFloat(longExchange.fundingRate);\r\n\r\n    const shortRate = shortExchange.fundingRateNormalized !== undefined\r\n      ? shortExchange.fundingRateNormalized\r\n      : parseFloat(shortExchange.fundingRate);\r\n\r\n    const fundingSpread = shortRate - longRate;\r\n    const fundingSpreadPercent = (fundingSpread * 100).toFixed(4);\r\n\r\n    // Estimated APR (gross)\r\n    const fundingPeriodsPerYear = 3 * 365; // 8h intervals (normalized)\r\n    const estimatedAPR = fundingSpread * fundingPeriodsPerYear;\r\n    const estimatedAPRFormatted = (estimatedAPR * 100).toFixed(2) + '%';\r\n\r\n    // Total Fees\r\n    const totalFees = this.calculateTotalFees(longExchange.exchange, shortExchange.exchange);\r\n\r\n    // Net APR\r\n    const annualFees = totalFees * 3 * 365;\r\n    const netAPR = estimatedAPR - annualFees;\r\n    const netAPRFormatted = (netAPR * 100).toFixed(2) + '%';\r\n\r\n    // Combined Score (price spread + funding spread for 7 days)\r\n    const priceSpread = opp.priceSpread || 0;\r\n    const fundingFor7Days = fundingSpread * 3 * 7; // 3 funding periods per day * 7 days\r\n    const combinedScore = (priceSpread + fundingFor7Days) * 100;\r\n\r\n    // Daily Return (funding * 3 periods per day)\r\n    const dailyReturn = fundingSpread * 3 * 100;\r\n\r\n    // Monthly ROI (price spread + funding for 30 days)\r\n    const fundingFor30Days = fundingSpread * 3 * 30;\r\n    const monthlyROI = (priceSpread + fundingFor30Days) * 100;\r\n\r\n    return {\r\n      fundingSpread: fundingSpread.toFixed(6),\r\n      fundingSpreadPercent: fundingSpreadPercent + '%',\r\n      estimatedAPR: estimatedAPRFormatted,\r\n      netAPR: netAPRFormatted,\r\n      combinedScore,\r\n      dailyReturn,\r\n      monthlyROI\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Calculate total trading fees for arbitrage (4 trades total)\r\n   */\r\n  private calculateTotalFees(longExchange: string, shortExchange: string): number {\r\n    const EXCHANGE_FEES: Record<string, number> = {\r\n      'BYBIT': 0.055,\r\n      'BINANCE': 0.04,\r\n      'BINGX': 0.045,\r\n      'MEXC': 0.02,\r\n      'GATEIO': 0.05,\r\n      'BITGET': 0.04,\r\n      'OKX': 0.05,\r\n    };\r\n\r\n    const longFee = EXCHANGE_FEES[longExchange] || 0.055;\r\n    const shortFee = EXCHANGE_FEES[shortExchange] || 0.055;\r\n\r\n    // 4 trades: open long, open short, close long, close short\r\n    return (longFee + shortFee) * 2 / 100; // Convert from percentage to decimal\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\pages\\triangular-arbitrage\\components\\opportunity-list\\opportunity-list.component.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'computed' is defined but never used.","line":1,"column":58,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":66},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":105,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3757,3760],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3757,3760],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":202,"column":11,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":202,"endColumn":71,"suggestions":[{"messageId":"addBrackets","fix":{"range":[6810,7009],"text":"{ const aRealistic = a.realisticProfitPercentage ?? -Infinity;\r\n          const bRealistic = b.realisticProfitPercentage ?? -Infinity;\r\n          comparison = bRealistic - aRealistic;\r\n          break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":203,"column":11,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":203,"endColumn":71,"suggestions":[{"messageId":"addBrackets","fix":{"range":[6810,7009],"text":"{ const aRealistic = a.realisticProfitPercentage ?? -Infinity;\r\n          const bRealistic = b.realisticProfitPercentage ?? -Infinity;\r\n          comparison = bRealistic - aRealistic;\r\n          break; }"},"desc":"Add {} brackets around the case block."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, Input, Output, EventEmitter, signal, computed } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { TriangularOpportunity, ScannerStatus } from '../../../../models/triangular-arbitrage.model';\r\nimport { TranslationService } from '../../../../services/translation.service';\r\nimport { ButtonComponent } from '../../../../components/ui/button/button.component';\r\nimport {\r\n  DialogComponent,\r\n  DialogHeaderComponent,\r\n  DialogTitleComponent,\r\n  DialogContentComponent,\r\n  DialogFooterComponent\r\n} from '../../../../components/ui/dialog/dialog.component';\r\nimport { TriangleVisualizerComponent } from '../triangle-visualizer/triangle-visualizer.component';\r\n\r\n/**\r\n * Opportunity List Component\r\n *\r\n * Displays real-time triangular arbitrage opportunities in a sortable table.\r\n * Features:\r\n * - Auto-refresh display\r\n * - Sort by profit, slippage, or time\r\n * - Execute opportunities\r\n * - Visual indicators for profitability\r\n */\r\n@Component({\r\n  selector: 'app-opportunity-list',\r\n  standalone: true,\r\n  imports: [\r\n    CommonModule,\r\n    ButtonComponent,\r\n    DialogComponent,\r\n    DialogHeaderComponent,\r\n    DialogTitleComponent,\r\n    DialogContentComponent,\r\n    DialogFooterComponent,\r\n    TriangleVisualizerComponent\r\n  ],\r\n  templateUrl: './opportunity-list.component.html',\r\n  styleUrls: ['./opportunity-list.component.scss']\r\n})\r\nexport class OpportunityListComponent {\r\n  @Input() set opportunities(value: TriangularOpportunity[]) {\r\n    console.log('[OpportunityList] Received opportunities:', value.length);\r\n    this._opportunities = value;\r\n\r\n    // Log deduplication stats\r\n    const deduplicated = this.deduplicateOpportunities(value);\r\n    console.log('[OpportunityList] After deduplication:', {\r\n      original: value.length,\r\n      deduplicated: deduplicated.length,\r\n      removed: value.length - deduplicated.length\r\n    });\r\n  }\r\n  get opportunities(): TriangularOpportunity[] {\r\n    return this._opportunities;\r\n  }\r\n  private _opportunities: TriangularOpportunity[] = [];\r\n\r\n  @Input() set isLoading(value: boolean) {\r\n    console.log('[OpportunityList] isLoading changed to:', value);\r\n    this._isLoading = value;\r\n  }\r\n  get isLoading(): boolean {\r\n    return this._isLoading;\r\n  }\r\n  private _isLoading = false;\r\n\r\n  @Input() set scannerStatus(value: ScannerStatus) {\r\n    console.log('[OpportunityList] scannerStatus changed to:', value);\r\n    this._scannerStatus = value;\r\n  }\r\n  get scannerStatus(): ScannerStatus {\r\n    return this._scannerStatus;\r\n  }\r\n  private _scannerStatus: ScannerStatus = 'stopped';\r\n\r\n  @Output() executeOpportunity = new EventEmitter<TriangularOpportunity>();\r\n\r\n  // Sort configuration\r\n  readonly sortColumn = signal<'profitPercentage' | 'profitAmount' | 'realisticProfitPercentage' | 'detectedAt'>('profitPercentage');\r\n  readonly sortDirection = signal<'asc' | 'desc'>('desc');\r\n\r\n  // Filter configuration\r\n  readonly showProblematicTokens = signal<boolean>(true);\r\n\r\n  // Problematic tokens with high minimum order sizes\r\n  // These tokens often cause \"order size too small\" errors with small positions (50-100 USDT)\r\n  private readonly PROBLEMATIC_TOKENS = [\r\n    'FLOKI',  // min: 1.0+\r\n    'SAGA',   // min: 1.0+\r\n    'WLFI',   // min: 0.01\r\n    'BTRST',  // min: 0.001\r\n    'OMG',    // min: 0.001\r\n    'SHIB',   // min: varies, often high\r\n    'PEPE',   // min: varies, often high\r\n    'BONK',   // min: varies, often high\r\n  ];\r\n\r\n  // Selected opportunity for detail modal\r\n  readonly selectedOpportunity = signal<TriangularOpportunity | null>(null);\r\n  readonly showDetailModal = signal<boolean>(false);\r\n\r\n  // Current time for relative timestamps\r\n  private currentTime = signal<number>(Date.now());\r\n  private timeUpdateInterval?: any;\r\n\r\n  constructor(private translationService: TranslationService) {\r\n    // Update current time every second for relative timestamps\r\n    this.timeUpdateInterval = setInterval(() => {\r\n      this.currentTime.set(Date.now());\r\n    }, 1000);\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    if (this.timeUpdateInterval) {\r\n      clearInterval(this.timeUpdateInterval);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if opportunity contains problematic tokens\r\n   */\r\n  hasProblematicToken(opp: TriangularOpportunity): boolean {\r\n    const { assetA, assetB, assetC } = opp.triangle;\r\n    const assets = [assetA, assetB, assetC];\r\n    return assets.some(asset => this.PROBLEMATIC_TOKENS.includes(asset));\r\n  }\r\n\r\n  /**\r\n   * Toggle problematic tokens filter\r\n   */\r\n  toggleProblematicFilter(): void {\r\n    this.showProblematicTokens.set(!this.showProblematicTokens());\r\n  }\r\n\r\n  /**\r\n   * Get unique triangle key for deduplication\r\n   */\r\n  private getTriangleKey(opp: TriangularOpportunity): string {\r\n    const { assetA, assetB, assetC, direction } = opp.triangle;\r\n    return `${opp.exchange}:${assetA}-${assetB}-${assetC}:${direction}`;\r\n  }\r\n\r\n  /**\r\n   * Deduplicate opportunities - keep only latest version of each triangle\r\n   */\r\n  private deduplicateOpportunities(opportunities: TriangularOpportunity[]): TriangularOpportunity[] {\r\n    const latestByTriangle = new Map<string, TriangularOpportunity>();\r\n\r\n    for (const opp of opportunities) {\r\n      const key = this.getTriangleKey(opp);\r\n      const existing = latestByTriangle.get(key);\r\n\r\n      // Keep the one with latest detection time\r\n      if (!existing || opp.detectedAt > existing.detectedAt) {\r\n        latestByTriangle.set(key, opp);\r\n      }\r\n    }\r\n\r\n    return Array.from(latestByTriangle.values());\r\n  }\r\n\r\n  /**\r\n   * Get filtered opportunities (by problematic tokens and profit)\r\n   */\r\n  get filteredOpportunities(): TriangularOpportunity[] {\r\n    // First deduplicate\r\n    const deduplicated = this.deduplicateOpportunities(this.opportunities);\r\n\r\n    // Filter out opportunities with negative profit\r\n    const positiveProfit = deduplicated.filter(opp => {\r\n      const profit = opp.realisticProfitPercentage ?? opp.profitPercentage;\r\n      return profit > 0;\r\n    });\r\n\r\n    // Then filter by problematic tokens if needed\r\n    if (this.showProblematicTokens()) {\r\n      return positiveProfit;\r\n    }\r\n    return positiveProfit.filter(opp => !this.hasProblematicToken(opp));\r\n  }\r\n\r\n  /**\r\n   * Sorted opportunities (after filtering)\r\n   */\r\n  get sortedOpportunities(): TriangularOpportunity[] {\r\n    const sorted = [...this.filteredOpportunities];\r\n    const column = this.sortColumn();\r\n    const direction = this.sortDirection();\r\n\r\n    sorted.sort((a, b) => {\r\n      let comparison = 0;\r\n\r\n      switch (column) {\r\n        case 'profitPercentage':\r\n          comparison = b.profitPercentage - a.profitPercentage;\r\n          break;\r\n        case 'profitAmount':\r\n          comparison = b.profitAmount - a.profitAmount;\r\n          break;\r\n        case 'realisticProfitPercentage':\r\n          const aRealistic = a.realisticProfitPercentage ?? -Infinity;\r\n          const bRealistic = b.realisticProfitPercentage ?? -Infinity;\r\n          comparison = bRealistic - aRealistic;\r\n          break;\r\n        case 'detectedAt':\r\n          comparison = b.detectedAt - a.detectedAt;\r\n          break;\r\n      }\r\n\r\n      return direction === 'asc' ? -comparison : comparison;\r\n    });\r\n\r\n    return sorted;\r\n  }\r\n\r\n  /**\r\n   * Toggle sort column\r\n   */\r\n  toggleSort(column: 'profitPercentage' | 'profitAmount' | 'realisticProfitPercentage' | 'detectedAt'): void {\r\n    if (this.sortColumn() === column) {\r\n      this.sortDirection.set(this.sortDirection() === 'asc' ? 'desc' : 'asc');\r\n    } else {\r\n      this.sortColumn.set(column);\r\n      this.sortDirection.set('desc');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get sort icon for column\r\n   */\r\n  getSortIcon(column: string): string {\r\n    if (this.sortColumn() !== column) return '';\r\n    return this.sortDirection() === 'asc' ? '‚Üë' : '‚Üì';\r\n  }\r\n\r\n  /**\r\n   * Format triangle path\r\n   */\r\n  formatTriangle(opp: TriangularOpportunity): string {\r\n    const { assetA, assetB, assetC } = opp.triangle;\r\n    return `${assetA} ‚Üí ${assetB} ‚Üí ${assetC}`;\r\n  }\r\n\r\n  /**\r\n   * Get direction icon\r\n   */\r\n  getDirectionIcon(opp: TriangularOpportunity): string {\r\n    return opp.triangle.direction === 'forward' ? '‚Üí' : '‚Üê';\r\n  }\r\n\r\n  /**\r\n   * Get profit color class\r\n   */\r\n  getProfitColorClass(profit: number): string {\r\n    if (profit >= 0.5) return 'profit-excellent';\r\n    if (profit >= 0.2) return 'profit-good';\r\n    if (profit >= 0.1) return 'profit-moderate';\r\n    return 'profit-low';\r\n  }\r\n\r\n  /**\r\n   * Calculate execution cost (theoretical - realistic profit)\r\n   */\r\n  getExecutionCost(opp: TriangularOpportunity): number {\r\n    if (opp.realisticProfitPercentage === undefined) {\r\n      return 0;\r\n    }\r\n    return opp.profitPercentage - opp.realisticProfitPercentage;\r\n  }\r\n\r\n  /**\r\n   * Get relative time string\r\n   */\r\n  getRelativeTime(timestamp: number): string {\r\n    const now = this.currentTime();\r\n    const diff = now - timestamp;\r\n    const seconds = Math.floor(diff / 1000);\r\n\r\n    if (seconds < 5) return 'just now';\r\n    if (seconds < 60) return `${seconds}s ago`;\r\n\r\n    const minutes = Math.floor(seconds / 60);\r\n    if (minutes < 60) return `${minutes}m ago`;\r\n\r\n    const hours = Math.floor(minutes / 60);\r\n    return `${hours}h ago`;\r\n  }\r\n\r\n  /**\r\n   * Check if opportunity is fresh (< 10 seconds)\r\n   */\r\n  isFresh(opp: TriangularOpportunity): boolean {\r\n    const now = this.currentTime();\r\n    const diff = now - opp.detectedAt;\r\n    return diff < 10000; // 10 seconds\r\n  }\r\n\r\n  /**\r\n   * Open opportunity detail modal\r\n   */\r\n  openDetail(opp: TriangularOpportunity): void {\r\n    this.selectedOpportunity.set(opp);\r\n    this.showDetailModal.set(true);\r\n  }\r\n\r\n  /**\r\n   * Close detail modal\r\n   */\r\n  closeDetail(): void {\r\n    this.showDetailModal.set(false);\r\n    setTimeout(() => {\r\n      if (!this.showDetailModal()) {\r\n        this.selectedOpportunity.set(null);\r\n      }\r\n    }, 300);\r\n  }\r\n\r\n  /**\r\n   * Execute opportunity\r\n   */\r\n  onExecute(opp: TriangularOpportunity): void {\r\n    console.log('[OpportunityList] Execute button clicked:', {\r\n      id: opp.id,\r\n      exchange: opp.exchange,\r\n      isExecutable: opp.isExecutable,\r\n      profitPercentage: opp.profitPercentage,\r\n      triangle: opp.triangle\r\n    });\r\n    this.executeOpportunity.emit(opp);\r\n  }\r\n\r\n  /**\r\n   * Execute from modal\r\n   */\r\n  executeFromModal(): void {\r\n    const opp = this.selectedOpportunity();\r\n    if (opp) {\r\n      this.onExecute(opp);\r\n      this.closeDetail();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Translation helper\r\n   */\r\n  translate(key: string): string {\r\n    return this.translationService.translate(key);\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\pages\\triangular-arbitrage\\components\\opportunity-scanner\\opportunity-scanner.component.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Input' is defined but never used.","line":1,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'DatePipe' is defined but never used.","line":2,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":32},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Observable' is defined but never used.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":20},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":99,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":99,"endColumn":52},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exchange on an `any` value.","line":99,"column":44,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":99,"endColumn":52},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":103,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":103,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":104,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":104,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":105,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":105,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":116,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":116,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":117,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":117,"endColumn":69},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .minProfitPercentage on an `any` value.","line":117,"column":50,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":117,"endColumn":69},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":118,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":118,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .maxSlippage on an `any` value.","line":118,"column":42,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":118,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":119,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":119,"endColumn":55},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .positionSize on an `any` value.","line":119,"column":43,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":119,"endColumn":55},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":120,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":120,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .autoExecute on an `any` value.","line":120,"column":42,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":120,"endColumn":53}],"suppressedMessages":[],"errorCount":17,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, Input, Output, EventEmitter, OnInit, signal, computed } from '@angular/core';\r\nimport { CommonModule, DatePipe } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule, FormBuilder, FormGroup, Validators } from '@angular/forms';\r\nimport { ScannerConfig, ScannerStats, ScannerStatus, Exchange } from '../../../../models/triangular-arbitrage.model';\r\nimport { TranslationService } from '../../../../services/translation.service';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Observable } from 'rxjs';\r\n\r\n// UI Components\r\nimport { ButtonComponent } from '../../../../components/ui/button/button.component';\r\nimport { InputComponent } from '../../../../components/ui/input/input.component';\r\nimport { SelectComponent } from '../../../../components/ui/select/select.component';\r\n\r\n/**\r\n * Exchange Scanner State\r\n * Tracks the state of a scanner for a specific exchange\r\n */\r\nexport interface ExchangeScannerState {\r\n  exchange: Exchange;\r\n  status: ScannerStatus;\r\n  stats: ScannerStats | null;\r\n  config: ScannerConfig | null;\r\n}\r\n\r\n/**\r\n * Opportunity Scanner Component\r\n *\r\n * Provides controls for starting/stopping arbitrage scanners on multiple exchanges simultaneously.\r\n *\r\n * Note: Credentials are automatically selected based on active exchange credentials.\r\n */\r\n@Component({\r\n  selector: 'app-opportunity-scanner',\r\n  standalone: true,\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    ButtonComponent,\r\n    InputComponent,\r\n    SelectComponent\r\n  ],\r\n  templateUrl: './opportunity-scanner.component.html',\r\n  styleUrls: ['./opportunity-scanner.component.scss']\r\n})\r\nexport class OpportunityScannerComponent implements OnInit {\r\n  // Track scanner states for all exchanges\r\n  readonly activeScanners = signal<Map<Exchange, ExchangeScannerState>>(new Map());\r\n\r\n  // Computed: List of active scanner states\r\n  readonly activeScannersList = computed(() => Array.from(this.activeScanners().values()));\r\n\r\n  // Computed: Check if any scanner is running\r\n  readonly isAnyScanning = computed(() =>\r\n    Array.from(this.activeScanners().values()).some(s => s.status === 'scanning')\r\n  );\r\n\r\n  @Output() startScanning = new EventEmitter<ScannerConfig>();\r\n  @Output() stopScanning = new EventEmitter<Exchange | null>(); // null = stop all\r\n\r\n  configForm!: FormGroup;\r\n  readonly availableExchanges: Exchange[] = ['BYBIT', 'BINANCE', 'BINGX', 'MEXC', 'GATEIO', 'BITGET', 'OKX'];\r\n  readonly showAdvanced = signal<boolean>(false);\r\n\r\n  constructor(\r\n    private fb: FormBuilder,\r\n    private translationService: TranslationService,\r\n    private http: HttpClient\r\n  ) {\r\n    this.initForm();\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    // No need to load credentials - backend auto-selects active credential\r\n  }\r\n\r\n  /**\r\n   * Initialize the configuration form\r\n   */\r\n  private initForm(): void {\r\n    this.configForm = this.fb.group({\r\n      exchange: ['GATEIO', Validators.required], // Default to Gate.io (optimized for this exchange)\r\n      minProfitPercentage: [0.5, [Validators.required, Validators.min(-10), Validators.max(10)]], // 0.5% min realistic profit (optimized)\r\n      maxSlippage: [0.5, [Validators.required, Validators.min(0.01), Validators.max(5)]], // 0.5% max slippage (based on real data)\r\n      positionSize: [50, [Validators.required, Validators.min(10), Validators.max(100000)]], // $50 default (safer for testing)\r\n      autoExecute: [false]\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Start scanning on selected exchange\r\n   */\r\n  onStart(): void {\r\n    if (this.configForm.invalid) {\r\n      this.configForm.markAllAsTouched();\r\n      return;\r\n    }\r\n\r\n    const exchange = this.configForm.value.exchange;\r\n\r\n    // DEBUG: Log what exchange we're actually sending\r\n    console.log('üîç [Scanner] Form values:', {\r\n      exchange: exchange,\r\n      allFormValues: this.configForm.value,\r\n      formRawValue: this.configForm.getRawValue()\r\n    });\r\n\r\n    // Check if already scanning this exchange\r\n    const current = this.activeScanners().get(exchange);\r\n    if (current && current.status === 'scanning') {\r\n      console.log(`Already scanning ${exchange}`);\r\n      return;\r\n    }\r\n\r\n    const config: ScannerConfig = {\r\n      exchange: exchange,\r\n      minProfitPercentage: this.configForm.value.minProfitPercentage,\r\n      maxSlippage: this.configForm.value.maxSlippage,\r\n      positionSize: this.configForm.value.positionSize,\r\n      autoExecute: this.configForm.value.autoExecute\r\n    };\r\n\r\n    console.log('üîç [Scanner] Sending config to backend:', config);\r\n\r\n    this.startScanning.emit(config);\r\n  }\r\n\r\n  /**\r\n   * Stop scanning for a specific exchange\r\n   */\r\n  onStopExchange(exchange: Exchange): void {\r\n    this.stopScanning.emit(exchange);\r\n  }\r\n\r\n  /**\r\n   * Stop all active scanners\r\n   */\r\n  onStopAll(): void {\r\n    this.stopScanning.emit(null);\r\n  }\r\n\r\n  /**\r\n   * Update scanner state for a specific exchange\r\n   * Called from parent component when receiving SSE updates\r\n   */\r\n  updateScannerState(exchange: Exchange, status: ScannerStatus, stats: ScannerStats | null = null, config: ScannerConfig | null = null): void {\r\n    const scanners = this.activeScanners();\r\n\r\n    if (status === 'stopped') {\r\n      // Remove scanner if stopped\r\n      scanners.delete(exchange);\r\n    } else {\r\n      // Update or add scanner\r\n      const existing = scanners.get(exchange);\r\n      scanners.set(exchange, {\r\n        exchange,\r\n        status,\r\n        stats: stats || existing?.stats || null,\r\n        config: config || existing?.config || null\r\n      });\r\n    }\r\n\r\n    // Trigger update\r\n    this.activeScanners.set(new Map(scanners));\r\n  }\r\n\r\n  /**\r\n   * Check if a specific exchange is scanning\r\n   */\r\n  isExchangeScanning(exchange: Exchange): boolean {\r\n    const scanner = this.activeScanners().get(exchange);\r\n    return scanner?.status === 'scanning';\r\n  }\r\n\r\n  /**\r\n   * Get available exchanges (not currently scanning)\r\n   */\r\n  getAvailableExchanges(): Exchange[] {\r\n    return this.availableExchanges.filter(ex => !this.isExchangeScanning(ex));\r\n  }\r\n\r\n  /**\r\n   * Toggle advanced settings\r\n   */\r\n  toggleAdvanced(): void {\r\n    this.showAdvanced.set(!this.showAdvanced());\r\n  }\r\n\r\n  /**\r\n   * Get status indicator class for a scanner\r\n   */\r\n  getStatusClass(status: ScannerStatus): string {\r\n    switch (status) {\r\n      case 'scanning': return 'status-scanning';\r\n      case 'stopped': return 'status-stopped';\r\n      case 'error': return 'status-error';\r\n      default: return '';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get status text for a scanner\r\n   */\r\n  getStatusText(status: ScannerStatus): string {\r\n    switch (status) {\r\n      case 'scanning': return this.translate('triangularArbitrage.scanner.status.scanning');\r\n      case 'stopped': return this.translate('triangularArbitrage.scanner.status.stopped');\r\n      case 'error': return this.translate('triangularArbitrage.scanner.status.error');\r\n      default: return '';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get exchange display name\r\n   */\r\n  getExchangeName(exchange: Exchange): string {\r\n    return exchange;\r\n  }\r\n\r\n  /**\r\n   * Format duration in ms to human-readable string\r\n   */\r\n  formatDuration(ms: number): string {\r\n    const seconds = Math.floor(ms / 1000);\r\n    const minutes = Math.floor(seconds / 60);\r\n    const hours = Math.floor(minutes / 60);\r\n\r\n    if (hours > 0) {\r\n      return `${hours}h ${minutes % 60}m`;\r\n    } else if (minutes > 0) {\r\n      return `${minutes}m ${seconds % 60}s`;\r\n    } else {\r\n      return `${seconds}s`;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Translation helper\r\n   */\r\n  translate(key: string): string {\r\n    return this.translationService.translate(key);\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\pages\\triangular-arbitrage\\components\\position-history\\position-history.component.html","messages":[{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":23,"column":9,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":23,"endColumn":87},{"ruleId":"@angular-eslint/template/label-has-associated-control","severity":2,"message":"A label component must be associated with a form element","line":38,"column":9,"nodeType":null,"messageId":"labelHasAssociatedControl","endLine":38,"endColumn":85}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"<div class=\"position-history\">\r\n  <!-- Toolbar -->\r\n  <div class=\"toolbar\">\r\n    <ui-button variant=\"ghost\" (clicked)=\"showFilters.set(!showFilters())\">\r\n      <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\">\r\n        <path d=\"M3 4h18M3 12h12M3 20h6\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\"/>\r\n      </svg>\r\n      {{ translate('triangularArbitrage.positions.filters') }}\r\n    </ui-button>\r\n\r\n    <ui-button variant=\"ghost\" (clicked)=\"exportToCSV()\" [disabled]=\"positions.length === 0\">\r\n      <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\">\r\n        <path d=\"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n      </svg>\r\n      {{ translate('triangularArbitrage.positions.export') }}\r\n    </ui-button>\r\n  </div>\r\n\r\n  <!-- Filters Panel -->\r\n  @if (showFilters()) {\r\n    <div class=\"filters-panel\">\r\n      <div class=\"filter-section\">\r\n        <label>{{ translate('triangularArbitrage.positions.filterByStatus') }}</label>\r\n        <div class=\"status-filters\">\r\n          @for (status of availableStatuses; track status) {\r\n            <button\r\n              class=\"filter-chip\"\r\n              [class.active]=\"isStatusFiltered(status)\"\r\n              (click)=\"toggleStatusFilter(status)\"\r\n            >\r\n              <span [class]=\"getStatusBadgeClass(status)\">{{ translate('triangularArbitrage.positions.status.' + status) }}</span>\r\n            </button>\r\n          }\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"filter-section\">\r\n        <label>{{ translate('triangularArbitrage.positions.filterByDate') }}</label>\r\n        <div class=\"date-filters\">\r\n          <input\r\n            type=\"date\"\r\n            [(ngModel)]=\"dateFrom\"\r\n            class=\"date-input\"\r\n            (change)=\"applyDateFilter()\"\r\n          />\r\n          <span>to</span>\r\n          <input\r\n            type=\"date\"\r\n            [(ngModel)]=\"dateTo\"\r\n            class=\"date-input\"\r\n            (change)=\"applyDateFilter()\"\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      <ui-button variant=\"ghost\" size=\"small\" (clicked)=\"clearFilters()\">\r\n        {{ translate('triangularArbitrage.positions.clearFilters') }}\r\n      </ui-button>\r\n    </div>\r\n  }\r\n\r\n  <!-- Loading State -->\r\n  @if (isLoading) {\r\n    <div class=\"loading-container\">\r\n      <div class=\"spinner\"></div>\r\n      <p>{{ translate('triangularArbitrage.positions.loading') }}</p>\r\n    </div>\r\n  }\r\n\r\n  <!-- Empty State -->\r\n  @else if (positions.length === 0) {\r\n    <div class=\"empty-state\">\r\n      <svg width=\"64\" height=\"64\" viewBox=\"0 0 24 24\" fill=\"none\" class=\"empty-icon\">\r\n        <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" stroke=\"currentColor\" stroke-width=\"2\"/>\r\n        <path d=\"M3 9h18M9 21V9\" stroke=\"currentColor\" stroke-width=\"2\"/>\r\n      </svg>\r\n      <h3>{{ translate('triangularArbitrage.positions.noPositions') }}</h3>\r\n      <p>{{ translate('triangularArbitrage.positions.noPositionsHint') }}</p>\r\n    </div>\r\n  }\r\n\r\n  <!-- Positions Table -->\r\n  @else {\r\n    <div class=\"table-container\">\r\n      <table class=\"positions-table\">\r\n        <thead>\r\n          <tr>\r\n            <th>{{ translate('triangularArbitrage.positions.table.id') }}</th>\r\n            <th>{{ translate('triangularArbitrage.positions.table.triangle') }}</th>\r\n            <th>{{ translate('triangularArbitrage.positions.table.status') }}</th>\r\n            <th>{{ translate('triangularArbitrage.positions.table.entryAmount') }}</th>\r\n            <th>{{ translate('triangularArbitrage.positions.table.expectedProfit') }}</th>\r\n            <th>{{ translate('triangularArbitrage.positions.table.actualProfit') }}</th>\r\n            <th>{{ translate('triangularArbitrage.positions.table.executionTime') }}</th>\r\n            <th>{{ translate('triangularArbitrage.positions.table.actions') }}</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          @for (position of positions; track position.id) {\r\n            <tr (click)=\"openDetail(position)\">\r\n              <td>\r\n                <span class=\"position-id\">{{ position.id.substring(0, 8) }}...</span>\r\n              </td>\r\n              <td>\r\n                <span class=\"triangle-path\">{{ formatTriangle(position) }}</span>\r\n              </td>\r\n              <td>\r\n                <span [class]=\"getStatusBadgeClass(position.status)\">\r\n                  {{ translate('triangularArbitrage.positions.status.' + position.status) }}\r\n                </span>\r\n              </td>\r\n              <td>\r\n                <span class=\"amount\">${{ position.entryAmount.toFixed(2) }}</span>\r\n              </td>\r\n              <td>\r\n                <span class=\"profit-expected\">\r\n                  ${{ position.expectedProfit.toFixed(2) }}\r\n                  <span class=\"percentage\">({{ position.expectedProfitPercentage.toFixed(2) }}%)</span>\r\n                </span>\r\n              </td>\r\n              <td>\r\n                @if (position.actualProfit !== undefined) {\r\n                  <span [class]=\"'profit-actual ' + getProfitClass(position.actualProfit)\">\r\n                    ${{ position.actualProfit.toFixed(2) }}\r\n                    <span class=\"percentage\">({{ position.actualProfitPercentage?.toFixed(2) }}%)</span>\r\n                  </span>\r\n                } @else {\r\n                  <span class=\"text-muted\">‚Äî</span>\r\n                }\r\n              </td>\r\n              <td>\r\n                <span class=\"execution-time\">{{ formatExecutionTime(position.executionTimeMs) }}</span>\r\n              </td>\r\n              <td class=\"actions-cell\" (click)=\"$event.stopPropagation()\">\r\n                <div class=\"action-buttons\">\r\n                  @if (position.status === 'executing' || position.status === 'pending') {\r\n                    <ui-button variant=\"danger\" size=\"small\" (clicked)=\"onCancel(position)\">\r\n                      {{ translate('triangularArbitrage.positions.cancel') }}\r\n                    </ui-button>\r\n                  } @else {\r\n                    <ui-button variant=\"ghost\" size=\"small\" (clicked)=\"openDetail(position)\">\r\n                      {{ translate('triangularArbitrage.positions.viewDetails') }}\r\n                    </ui-button>\r\n                    <ui-button variant=\"danger\" size=\"small\" (clicked)=\"onDelete(position)\">\r\n                      <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\">\r\n                        <path d=\"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2M10 11v6M14 11v6\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                      </svg>\r\n                      {{ translate('triangularArbitrage.positions.delete') }}\r\n                    </ui-button>\r\n                  }\r\n                </div>\r\n              </td>\r\n            </tr>\r\n          }\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n  }\r\n\r\n  <!-- Detail Modal -->\r\n  @if (showDetailModal() && selectedPosition(); as position) {\r\n    <ui-dialog [open]=\"showDetailModal()\" (openChange)=\"closeDetail()\">\r\n      <ui-dialog-header>\r\n        <ui-dialog-title>\r\n          {{ translate('triangularArbitrage.positions.details.title') }} - {{ position.id.substring(0, 12) }}\r\n        </ui-dialog-title>\r\n      </ui-dialog-header>\r\n      <ui-dialog-content>\r\n        <div class=\"position-details\">\r\n          <!-- Overview -->\r\n          <div class=\"overview-section\">\r\n            <div class=\"overview-grid\">\r\n              <div class=\"overview-item\">\r\n                <span class=\"overview-label\">{{ translate('triangularArbitrage.positions.details.exchange') }}</span>\r\n                <span class=\"overview-value\">{{ position.exchange }}</span>\r\n              </div>\r\n              <div class=\"overview-item\">\r\n                <span class=\"overview-label\">{{ translate('triangularArbitrage.positions.details.triangle') }}</span>\r\n                <span class=\"overview-value\">{{ formatTriangle(position) }}</span>\r\n              </div>\r\n              <div class=\"overview-item\">\r\n                <span class=\"overview-label\">{{ translate('triangularArbitrage.positions.details.status') }}</span>\r\n                <span [class]=\"getStatusBadgeClass(position.status)\">\r\n                  {{ translate('triangularArbitrage.positions.status.' + position.status) }}\r\n                </span>\r\n              </div>\r\n              <div class=\"overview-item\">\r\n                <span class=\"overview-label\">{{ translate('triangularArbitrage.positions.details.created') }}</span>\r\n                <span class=\"overview-value\">{{ formatDate(position.createdAt) }}</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Execution Progress -->\r\n          <app-execution-progress [position]=\"position\" />\r\n\r\n          <!-- Error Message -->\r\n          @if (position.error) {\r\n            <div class=\"error-section\">\r\n              <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\">\r\n                <circle cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"2\"/>\r\n                <path d=\"M12 8v4m0 4h.01\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\"/>\r\n              </svg>\r\n              <div>\r\n                <strong>{{ translate('triangularArbitrage.positions.details.error') }}</strong>\r\n                <p>{{ position.error }}</p>\r\n                @if (position.errorLeg) {\r\n                  <p>{{ translate('triangularArbitrage.positions.details.failedAtLeg') }} {{ position.errorLeg }}</p>\r\n                }\r\n              </div>\r\n            </div>\r\n          }\r\n        </div>\r\n      </ui-dialog-content>\r\n      <ui-dialog-footer>\r\n        <ui-button variant=\"ghost\" (clicked)=\"closeDetail()\">\r\n          {{ translate('triangularArbitrage.positions.details.close') }}\r\n        </ui-button>\r\n        @if (position.status === 'executing' || position.status === 'pending') {\r\n          <ui-button variant=\"danger\" (clicked)=\"onCancel(position); closeDetail()\">\r\n            {{ translate('triangularArbitrage.positions.cancel') }}\r\n          </ui-button>\r\n        } @else {\r\n          <ui-button variant=\"danger\" (clicked)=\"onDelete(position); closeDetail()\">\r\n            {{ translate('triangularArbitrage.positions.delete') }}\r\n          </ui-button>\r\n        }\r\n      </ui-dialog-footer>\r\n    </ui-dialog>\r\n  }\r\n</div>\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\pages\\triangular-arbitrage\\services\\triangular-arbitrage.service.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'BehaviorSubject' is defined but never used.","line":3,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":46},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":32,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[983,986],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[983,986],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1100,1103],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1100,1103],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":127,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4283,4286],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4283,4286],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":128,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4316,4319],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4316,4319],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .isScanning on an `any` value.","line":132,"column":48,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":132,"endColumn":58},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .isScanning on an `any` value.","line":133,"column":116,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":133,"endColumn":126},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":139,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":139,"endColumn":86},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .stats on an `any` value.","line":139,"column":48,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":139,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":140,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":140,"endColumn":86},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .stats on an `any` value.","line":140,"column":48,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":140,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":141,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":141,"endColumn":66},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .stats on an `any` value.","line":141,"column":38,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":141,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":142,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":142,"endColumn":72},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .stats on an `any` value.","line":142,"column":41,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":142,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":143,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":143,"endColumn":60},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .stats on an `any` value.","line":143,"column":38,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":143,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":148,"column":9,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":148,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":303,"column":7,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":303,"endColumn":35},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":303,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":303,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10079,10082],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10079,10082],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":314,"column":17,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":314,"endColumn":75},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":360,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":360,"endColumn":48,"suggestions":[{"messageId":"addBrackets","fix":{"range":[11909,12706],"text":"{ const scannerData = update.data as any;\r\n        console.log('[Service] Received scanner event:', scannerData);\r\n        if (scannerData.status) {\r\n          console.log('[Service] Setting scannerStatus to:', scannerData.status);\r\n          this._scannerStatus.set(scannerData.status);\r\n        } else {\r\n          console.warn('[Service] Scanner event has no status!', scannerData);\r\n        }\r\n        if (scannerData.stats) {\r\n          this.scannerStats.set(scannerData.stats);\r\n        }\r\n        // Emit scanner update with exchange information\r\n        if (scannerData.exchange) {\r\n          this.scannerUpdateSubject.next({\r\n            exchange: scannerData.exchange,\r\n            status: scannerData.status,\r\n            stats: scannerData.stats\r\n          });\r\n        }\r\n        break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":360,"column":15,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":360,"endColumn":47},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":360,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":360,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11944,11947],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11944,11947],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .status on an `any` value.","line":362,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":362,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .status on an `any` value.","line":363,"column":74,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":363,"endColumn":80},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .status on an `any` value.","line":364,"column":47,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":364,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .stats on an `any` value.","line":368,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":368,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .stats on an `any` value.","line":369,"column":45,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":369,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exchange on an `any` value.","line":372,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":372,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":374,"column":13,"nodeType":"Property","messageId":"anyAssignment","endLine":374,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exchange on an `any` value.","line":374,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":374,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":375,"column":13,"nodeType":"Property","messageId":"anyAssignment","endLine":375,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .status on an `any` value.","line":375,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":375,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":376,"column":13,"nodeType":"Property","messageId":"anyAssignment","endLine":376,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .stats on an `any` value.","line":376,"column":32,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":376,"endColumn":37},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":387,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":387,"endColumn":63,"suggestions":[{"messageId":"addBrackets","fix":{"range":[12840,13059],"text":"{ console.error('[TriangularArbitrage] Server error:', update.data);\r\n        const errorData = update.data as { message?: string };\r\n        this.connectionError.set(errorData?.message || 'Server error');\r\n        break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'message' is defined but never used.","line":399,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":399,"endColumn":30},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":399,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":399,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13278,13281],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13278,13281],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":430,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":430,"endColumn":29},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":430,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":430,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14245,14248],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14245,14248],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .close on an `any` value.","line":430,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":430,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":443,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":443,"endColumn":29},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":443,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":443,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14509,14512],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14509,14512],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .close on an `any` value.","line":443,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":443,"endColumn":29}],"suppressedMessages":[],"errorCount":45,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Injectable, signal, computed } from '@angular/core';\r\nimport { HttpClient, HttpParams } from '@angular/common/http';\r\nimport { Observable, Subject, BehaviorSubject } from 'rxjs';\r\nimport { map, catchError } from 'rxjs/operators';\r\nimport {\r\n  TriangularOpportunity,\r\n  TriangularPosition,\r\n  ScannerConfig,\r\n  ScannerStats,\r\n  PositionFilter,\r\n  PositionSummary,\r\n  ExecuteOpportunityRequest,\r\n  ExecuteOpportunityResponse,\r\n  TriangularArbitrageUpdate,\r\n  ScannerStatus\r\n} from '../../../models/triangular-arbitrage.model';\r\n\r\n/**\r\n * Triangular Arbitrage Service\r\n *\r\n * Manages all API interactions for the triangular arbitrage feature:\r\n * - Scanner control (start/stop)\r\n * - Opportunity detection and retrieval\r\n * - Position execution and management\r\n * - Real-time updates via WebSocket\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class TriangularArbitrageService {\r\n  private readonly API_BASE = '/api/triangular-arbitrage';\r\n  private ws?: EventSource | any;\r\n  private reconnectAttempts = 0;\r\n  private readonly MAX_RECONNECT_ATTEMPTS = 5;\r\n  private reconnectTimeout?: any;\r\n\r\n  // State signals\r\n  private _scannerStatus = signal<ScannerStatus>('stopped');\r\n  readonly scannerStatus = computed(() => {\r\n    const status = this._scannerStatus();\r\n    console.log('[Service] scannerStatus getter called, returning:', status);\r\n    return status;\r\n  });\r\n  readonly currentConfig = signal<ScannerConfig | null>(null);\r\n  readonly scannerStats = signal<ScannerStats>({\r\n    status: 'stopped',\r\n    opportunitiesDetectedToday: 0,\r\n    opportunitiesExecutedToday: 0,\r\n    totalProfitToday: 0,\r\n    avgProfitPercentage: 0,\r\n    scanningDuration: 0\r\n  });\r\n\r\n  // Real-time data streams\r\n  private readonly opportunitySubject = new Subject<TriangularOpportunity>();\r\n  private readonly positionSubject = new Subject<TriangularPosition>();\r\n  private readonly statsSubject = new Subject<ScannerStats>();\r\n  private readonly scannerUpdateSubject = new Subject<{ exchange: string; status: ScannerStatus; stats?: ScannerStats }>();\r\n\r\n  // Public observables\r\n  readonly opportunities$ = this.opportunitySubject.asObservable();\r\n  readonly positions$ = this.positionSubject.asObservable();\r\n  readonly stats$ = this.statsSubject.asObservable();\r\n  readonly scannerUpdates$ = this.scannerUpdateSubject.asObservable();\r\n\r\n  // Connection status\r\n  readonly isConnected = signal<boolean>(false);\r\n  readonly connectionError = signal<string | null>(null);\r\n\r\n  constructor(private http: HttpClient) {\r\n    this.initializeWebSocket();\r\n  }\r\n\r\n  // ============= Scanner Control =============\r\n\r\n  /**\r\n   * Start scanning for arbitrage opportunities\r\n   */\r\n  startScanning(config: ScannerConfig): Observable<{ success: boolean; message?: string }> {\r\n    return this.http.post<{ success: boolean; message?: string }>(\r\n      `${this.API_BASE}/scan/start`,\r\n      config\r\n    ).pipe(\r\n      map(response => {\r\n        if (response.success) {\r\n          this.currentConfig.set(config);\r\n          console.log('[Service] Setting scannerStatus to: scanning (from startScanning)');\r\n          this._scannerStatus.set('scanning');\r\n        }\r\n        return response;\r\n      }),\r\n      catchError(error => {\r\n        console.log('[Service] Setting scannerStatus to: error (from startScanning error)');\r\n        this._scannerStatus.set('error');\r\n        throw error;\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Stop scanning\r\n   * @param exchange - Optional: specific exchange to stop. If not provided, stops all scanners\r\n   */\r\n  stopScanning(exchange?: string): Observable<{ success: boolean; message?: string }> {\r\n    const body = exchange ? { exchange } : {};\r\n    return this.http.post<{ success: boolean; message?: string }>(\r\n      `${this.API_BASE}/scan/stop`,\r\n      body\r\n    ).pipe(\r\n      map(response => {\r\n        if (response.success) {\r\n          // Only update global status if stopping all\r\n          if (!exchange) {\r\n            console.log('[Service] Setting scannerStatus to: stopped (from stopScanning)');\r\n            this._scannerStatus.set('stopped');\r\n            this.currentConfig.set(null);\r\n          }\r\n        }\r\n        return response;\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get current scanner status\r\n   */\r\n  getScannerStatus(): Observable<any> {\r\n    return this.http.get<any>(`${this.API_BASE}/scan/status`).pipe(\r\n      map(response => {\r\n        // API returns { success, isScanning, scanners, stats }\r\n        // Derive status from isScanning\r\n        const status: ScannerStatus = response.isScanning ? 'scanning' : 'stopped';\r\n        console.log('[Service] Setting scannerStatus to:', status, '(from getScannerStatus, isScanning:', response.isScanning + ')');\r\n        this._scannerStatus.set(status);\r\n\r\n        // Set aggregated stats with derived status\r\n        const stats: ScannerStats = {\r\n          status,\r\n          opportunitiesDetectedToday: response.stats?.opportunitiesDetectedToday || 0,\r\n          opportunitiesExecutedToday: response.stats?.opportunitiesExecutedToday || 0,\r\n          totalProfitToday: response.stats?.totalProfitToday || 0,\r\n          avgProfitPercentage: response.stats?.avgProfitPercentage || 0,\r\n          scanningDuration: response.stats?.runningFor || 0,\r\n        };\r\n        this.scannerStats.set(stats);\r\n\r\n        // Return full response including scanners array\r\n        return response;\r\n      })\r\n    );\r\n  }\r\n\r\n  // ============= Opportunities =============\r\n\r\n  /**\r\n   * Get current opportunities\r\n   */\r\n  getOpportunities(filters?: {\r\n    minProfit?: number;\r\n    maxSlippage?: number;\r\n    exchange?: string;\r\n  }): Observable<TriangularOpportunity[]> {\r\n    let params = new HttpParams();\r\n\r\n    if (filters?.minProfit !== undefined) {\r\n      params = params.set('minProfit', filters.minProfit.toString());\r\n    }\r\n    if (filters?.maxSlippage !== undefined) {\r\n      params = params.set('maxSlippage', filters.maxSlippage.toString());\r\n    }\r\n    if (filters?.exchange) {\r\n      params = params.set('exchange', filters.exchange);\r\n    }\r\n\r\n    return this.http.get<{ opportunities: TriangularOpportunity[]; count: number }>(\r\n      `${this.API_BASE}/opportunities`,\r\n      { params }\r\n    ).pipe(\r\n      map(response => response.opportunities)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Execute a specific opportunity\r\n   */\r\n  executeOpportunity(\r\n    request: ExecuteOpportunityRequest\r\n  ): Observable<ExecuteOpportunityResponse> {\r\n    return this.http.post<ExecuteOpportunityResponse>(\r\n      `${this.API_BASE}/execute`,\r\n      request\r\n    );\r\n  }\r\n\r\n  // ============= Positions =============\r\n\r\n  /**\r\n   * Get positions with optional filters\r\n   */\r\n  getPositions(filters?: PositionFilter): Observable<TriangularPosition[]> {\r\n    let params = new HttpParams();\r\n\r\n    if (filters?.status && filters.status.length > 0) {\r\n      params = params.set('status', filters.status.join(','));\r\n    }\r\n    if (filters?.exchange && filters.exchange.length > 0) {\r\n      params = params.set('exchange', filters.exchange.join(','));\r\n    }\r\n    if (filters?.dateFrom) {\r\n      params = params.set('dateFrom', filters.dateFrom.toISOString());\r\n    }\r\n    if (filters?.dateTo) {\r\n      params = params.set('dateTo', filters.dateTo.toISOString());\r\n    }\r\n    if (filters?.minProfit !== undefined) {\r\n      params = params.set('minProfit', filters.minProfit.toString());\r\n    }\r\n    if (filters?.maxProfit !== undefined) {\r\n      params = params.set('maxProfit', filters.maxProfit.toString());\r\n    }\r\n\r\n    return this.http.get<{ positions: TriangularPosition[]; count: number; summary: PositionSummary }>(\r\n      `${this.API_BASE}/positions`,\r\n      { params }\r\n    ).pipe(\r\n      map(response => response.positions)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get a specific position by ID\r\n   */\r\n  getPosition(id: string): Observable<TriangularPosition> {\r\n    return this.http.get<TriangularPosition>(`${this.API_BASE}/positions/${id}`);\r\n  }\r\n\r\n  /**\r\n   * Cancel an in-progress position\r\n   */\r\n  cancelPosition(id: string): Observable<{ success: boolean; message?: string }> {\r\n    return this.http.delete<{ success: boolean; message?: string }>(\r\n      `${this.API_BASE}/positions/${id}`\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Delete a completed position from history\r\n   */\r\n  deletePosition(id: string): Observable<{ success: boolean; message?: string }> {\r\n    return this.http.delete<{ success: boolean; message?: string }>(\r\n      `${this.API_BASE}/positions/${id}/delete`\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get position summary statistics\r\n   */\r\n  getPositionSummary(filters?: PositionFilter): Observable<PositionSummary> {\r\n    let params = new HttpParams();\r\n\r\n    if (filters?.dateFrom) {\r\n      params = params.set('dateFrom', filters.dateFrom.toISOString());\r\n    }\r\n    if (filters?.dateTo) {\r\n      params = params.set('dateTo', filters.dateTo.toISOString());\r\n    }\r\n\r\n    return this.http.get<PositionSummary>(\r\n      `${this.API_BASE}/positions/summary`,\r\n      { params }\r\n    );\r\n  }\r\n\r\n  // ============= Server-Sent Events Connection =============\r\n\r\n  /**\r\n   * Initialize SSE connection for real-time updates\r\n   */\r\n  private initializeWebSocket(): void {\r\n    // For SSE, we need to use full URL in development because EventSource\r\n    // doesn't go through Angular proxy like HttpClient does\r\n    const isDev = window.location.port === '4200';\r\n    const baseUrl = isDev ? 'http://localhost:3000' : '';\r\n\r\n    // Get auth token from localStorage\r\n    const token = localStorage.getItem('auth_token');\r\n    if (!token) {\r\n      console.error('[TriangularArbitrage] No auth token found');\r\n      this.connectionError.set('Authentication required');\r\n      return;\r\n    }\r\n\r\n    // Add token as query parameter since EventSource doesn't support headers\r\n    const sseUrl = `${baseUrl}${this.API_BASE}/stream?token=${encodeURIComponent(token)}`;\r\n\r\n    console.log('[TriangularArbitrage] Connecting to SSE:', sseUrl.replace(/token=[^&]+/, 'token=***'));\r\n\r\n    try {\r\n      const eventSource = new EventSource(sseUrl, {\r\n        withCredentials: true\r\n      });\r\n\r\n      this.ws = eventSource as any; // Store as 'ws' to maintain compatibility\r\n\r\n      eventSource.onopen = () => {\r\n        console.log('[TriangularArbitrage] SSE connected');\r\n        this.isConnected.set(true);\r\n        this.connectionError.set(null);\r\n        this.reconnectAttempts = 0;\r\n      };\r\n\r\n      eventSource.onmessage = (event) => {\r\n        try {\r\n          const update: TriangularArbitrageUpdate = JSON.parse(event.data);\r\n          this.handleWebSocketUpdate(update);\r\n        } catch (error) {\r\n          console.error('[TriangularArbitrage] Failed to parse SSE message:', error);\r\n        }\r\n      };\r\n\r\n      eventSource.onerror = (error) => {\r\n        console.error('[TriangularArbitrage] SSE error:', error);\r\n        this.connectionError.set('Connection error');\r\n        this.isConnected.set(false);\r\n\r\n        // Close and attempt reconnect\r\n        eventSource.close();\r\n        this.attemptReconnect();\r\n      };\r\n    } catch (error) {\r\n      console.error('[TriangularArbitrage] Failed to create SSE:', error);\r\n      this.connectionError.set('Failed to create connection');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle incoming SSE updates\r\n   */\r\n  private handleWebSocketUpdate(update: TriangularArbitrageUpdate): void {\r\n    switch (update.type) {\r\n      case 'connected':\r\n        console.log('[TriangularArbitrage] Connected:', update.data);\r\n        break;\r\n\r\n      case 'heartbeat':\r\n        // Update connection timestamp\r\n        this.isConnected.set(true);\r\n        break;\r\n\r\n      case 'opportunity':\r\n        console.log('[TriangularArbitrage] Received opportunity event:', update.data);\r\n        this.opportunitySubject.next(update.data as TriangularOpportunity);\r\n        break;\r\n\r\n      case 'position':\r\n        this.positionSubject.next(update.data as TriangularPosition);\r\n        break;\r\n\r\n      case 'scanner':\r\n        const scannerData = update.data as any;\r\n        console.log('[Service] Received scanner event:', scannerData);\r\n        if (scannerData.status) {\r\n          console.log('[Service] Setting scannerStatus to:', scannerData.status);\r\n          this._scannerStatus.set(scannerData.status);\r\n        } else {\r\n          console.warn('[Service] Scanner event has no status!', scannerData);\r\n        }\r\n        if (scannerData.stats) {\r\n          this.scannerStats.set(scannerData.stats);\r\n        }\r\n        // Emit scanner update with exchange information\r\n        if (scannerData.exchange) {\r\n          this.scannerUpdateSubject.next({\r\n            exchange: scannerData.exchange,\r\n            status: scannerData.status,\r\n            stats: scannerData.stats\r\n          });\r\n        }\r\n        break;\r\n\r\n      case 'stats':\r\n        this.statsSubject.next(update.data as ScannerStats);\r\n        break;\r\n\r\n      case 'error':\r\n        console.error('[TriangularArbitrage] Server error:', update.data);\r\n        const errorData = update.data as { message?: string };\r\n        this.connectionError.set(errorData?.message || 'Server error');\r\n        break;\r\n\r\n      default:\r\n        console.warn('[TriangularArbitrage] Unknown update type:', update.type);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Send a message (not used with SSE - SSE is one-way)\r\n   */\r\n  private sendMessage(message: any): void {\r\n    // SSE is server-to-client only, no need to send messages\r\n    console.log('[TriangularArbitrage] SSE does not support sending messages');\r\n  }\r\n\r\n  /**\r\n   * Attempt to reconnect WebSocket\r\n   */\r\n  private attemptReconnect(): void {\r\n    if (this.reconnectAttempts >= this.MAX_RECONNECT_ATTEMPTS) {\r\n      console.error('[TriangularArbitrage] Max reconnection attempts reached');\r\n      this.connectionError.set('Connection lost. Please refresh the page.');\r\n      return;\r\n    }\r\n\r\n    this.reconnectAttempts++;\r\n    const delay = Math.min(1000 * Math.pow(2, this.reconnectAttempts), 30000);\r\n\r\n    console.log(`[TriangularArbitrage] Reconnecting in ${delay}ms (attempt ${this.reconnectAttempts})`);\r\n\r\n    this.reconnectTimeout = setTimeout(() => {\r\n      this.initializeWebSocket();\r\n    }, delay);\r\n  }\r\n\r\n  /**\r\n   * Manually reconnect SSE\r\n   */\r\n  reconnect(): void {\r\n    this.reconnectAttempts = 0;\r\n    if (this.ws) {\r\n      (this.ws as any).close();\r\n    }\r\n    this.initializeWebSocket();\r\n  }\r\n\r\n  /**\r\n   * Cleanup when service is destroyed\r\n   */\r\n  ngOnDestroy(): void {\r\n    if (this.reconnectTimeout) {\r\n      clearTimeout(this.reconnectTimeout);\r\n    }\r\n    if (this.ws) {\r\n      (this.ws as any).close();\r\n    }\r\n  }\r\n\r\n  // ============= Utility Methods =============\r\n\r\n  /**\r\n   * Format triangle path for display\r\n   */\r\n  formatTriangle(assetA: string, assetB: string, assetC: string): string {\r\n    return `${assetA} ‚Üí ${assetB} ‚Üí ${assetC}`;\r\n  }\r\n\r\n  /**\r\n   * Calculate estimated execution time based on historical data\r\n   */\r\n  getEstimatedExecutionTime(): number {\r\n    // Returns estimated time in milliseconds\r\n    // TODO: Calculate from historical position data\r\n    return 5000; // 5 seconds default\r\n  }\r\n\r\n  /**\r\n   * Export positions to CSV\r\n   */\r\n  exportPositionsToCSV(positions: TriangularPosition[]): string {\r\n    const headers = [\r\n      'Position ID',\r\n      'Exchange',\r\n      'Triangle',\r\n      'Status',\r\n      'Entry Amount',\r\n      'Expected Profit',\r\n      'Actual Profit',\r\n      'Profit %',\r\n      'Total Fees',\r\n      'Total Slippage',\r\n      'Execution Time (ms)',\r\n      'Created At',\r\n      'Completed At'\r\n    ];\r\n\r\n    const rows = positions.map(pos => [\r\n      pos.id,\r\n      pos.exchange,\r\n      this.formatTriangle(pos.triangle.assetA, pos.triangle.assetB, pos.triangle.assetC),\r\n      pos.status,\r\n      pos.entryAmount.toFixed(2),\r\n      pos.expectedProfit.toFixed(2),\r\n      pos.actualProfit?.toFixed(2) || 'N/A',\r\n      pos.actualProfitPercentage?.toFixed(2) || 'N/A',\r\n      pos.totalFees.toFixed(4),\r\n      pos.totalSlippage.toFixed(4),\r\n      pos.executionTimeMs || 'N/A',\r\n      new Date(pos.createdAt).toISOString(),\r\n      pos.completedAt ? new Date(pos.completedAt).toISOString() : 'N/A'\r\n    ]);\r\n\r\n    const csvContent = [\r\n      headers.join(','),\r\n      ...rows.map(row => row.join(','))\r\n    ].join('\\n');\r\n\r\n    return csvContent;\r\n  }\r\n\r\n  /**\r\n   * Download CSV file\r\n   */\r\n  downloadCSV(csvContent: string, filename = 'triangular-arbitrage-positions.csv'): void {\r\n    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\r\n    const link = document.createElement('a');\r\n    const url = URL.createObjectURL(blob);\r\n\r\n    link.setAttribute('href', url);\r\n    link.setAttribute('download', filename);\r\n    link.style.visibility = 'hidden';\r\n\r\n    document.body.appendChild(link);\r\n    link.click();\r\n    document.body.removeChild(link);\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\pages\\triangular-arbitrage\\triangular-arbitrage.component.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ScannerStatus' is defined but never used.","line":11,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":16},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":112,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3697,3700],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3697,3700],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .isScanning on an `any` value.","line":116,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":116,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .scanners on an `any` value.","line":116,"column":45,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":116,"endColumn":53},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .scanners on an `any` value.","line":116,"column":80,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":116,"endColumn":88},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .scanners on an `any` value.","line":118,"column":46,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":118,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exchange on an `any` value.","line":119,"column":42,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":119,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .config on an `any` value.","line":120,"column":40,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":120,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":121,"column":19,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":121,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .stats on an `any` value.","line":121,"column":46,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":121,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":135,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":135,"endColumn":87},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .opportunitiesDetectedToday on an `any` value.","line":135,"column":56,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":135,"endColumn":82},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":137,"column":15,"nodeType":"Property","messageId":"anyAssignment","endLine":137,"endColumn":67},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .totalProfitToday on an `any` value.","line":137,"column":46,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":137,"endColumn":62},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":139,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5093,5096],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5093,5096],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .runningFor on an `any` value.","line":139,"column":56,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":139,"endColumn":66},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'stats' is defined but never used.","line":229,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":229,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":251,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":251,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9175,9178],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9175,9178],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":254,"column":13,"nodeType":"Property","messageId":"anyAssignment","endLine":254,"endColumn":85},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .opportunitiesDetectedToday on an `any` value.","line":254,"column":54,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":254,"endColumn":80},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":256,"column":13,"nodeType":"Property","messageId":"anyAssignment","endLine":256,"endColumn":65},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .totalProfitToday on an `any` value.","line":256,"column":44,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":256,"endColumn":60},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .runningFor on an `any` value.","line":258,"column":45,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":258,"endColumn":55},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":288,"column":63,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":288,"endColumn":70},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":307,"column":59,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":307,"endColumn":66},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":337,"column":58,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":337,"endColumn":65},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":374,"column":57,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":374,"endColumn":64},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":410,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":410,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14542,14545],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14542,14545],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .positionSize on an `any` value.","line":412,"column":15,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":412,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":427,"column":64,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":427,"endColumn":71},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":443,"column":60,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":443,"endColumn":67},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":460,"column":60,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":460,"endColumn":67}],"suppressedMessages":[],"errorCount":32,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Component, OnInit, OnDestroy, ViewChild, signal, computed } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { TriangularArbitrageService } from './services/triangular-arbitrage.service';\r\nimport { TranslationService } from '../../services/translation.service';\r\nimport {\r\n  TriangularOpportunity,\r\n  TriangularPosition,\r\n  ScannerConfig,\r\n  PositionFilter,\r\n  Exchange,\r\n  ScannerStatus,\r\n  ScannerStats\r\n} from '../../models/triangular-arbitrage.model';\r\nimport { Subscription } from 'rxjs';\r\n\r\n// Child components\r\nimport { OpportunityScannerComponent } from './components/opportunity-scanner/opportunity-scanner.component';\r\nimport { OpportunityListComponent } from './components/opportunity-list/opportunity-list.component';\r\nimport { PositionHistoryComponent } from './components/position-history/position-history.component';\r\n\r\n// UI components\r\nimport {\r\n  CardComponent,\r\n  CardHeaderComponent,\r\n  CardTitleComponent,\r\n  CardContentComponent\r\n} from '../../components/ui/card/card.component';\r\n\r\n/**\r\n * Triangular Arbitrage Main Page\r\n *\r\n * Container component that orchestrates all triangular arbitrage functionality:\r\n * - Opportunity scanning controls\r\n * - Real-time opportunity display\r\n * - Position tracking and history\r\n */\r\n@Component({\r\n  selector: 'app-triangular-arbitrage',\r\n  standalone: true,\r\n  imports: [\r\n    CommonModule,\r\n    CardComponent,\r\n    CardHeaderComponent,\r\n    CardTitleComponent,\r\n    CardContentComponent,\r\n    OpportunityScannerComponent,\r\n    OpportunityListComponent,\r\n    PositionHistoryComponent\r\n  ],\r\n  templateUrl: './triangular-arbitrage.component.html',\r\n  styleUrls: ['./triangular-arbitrage.component.scss']\r\n})\r\nexport class TriangularArbitrageComponent implements OnInit, OnDestroy {\r\n  // Child component reference\r\n  @ViewChild(OpportunityScannerComponent) scannerComponent?: OpportunityScannerComponent;\r\n\r\n  // State\r\n  readonly opportunities = signal<TriangularOpportunity[]>([]);\r\n  readonly positions = signal<TriangularPosition[]>([]);\r\n  readonly isLoadingOpportunities = signal<boolean>(false);\r\n  readonly isLoadingPositions = signal<boolean>(false);\r\n  readonly error = signal<string | null>(null);\r\n\r\n  // Service state\r\n  readonly scannerStatus = this.arbitrageService.scannerStatus;\r\n  readonly scannerStats = this.arbitrageService.scannerStats;\r\n  readonly isConnected = this.arbitrageService.isConnected;\r\n  readonly connectionError = this.arbitrageService.connectionError;\r\n\r\n  // Active tab\r\n  readonly activeTab = signal<'opportunities' | 'positions'>('opportunities');\r\n\r\n  // Filters\r\n  readonly positionFilter = signal<PositionFilter>({});\r\n\r\n  // Scanner configuration per exchange (to track position size)\r\n  private scannerConfigs = new Map<Exchange, ScannerConfig>();\r\n\r\n  // Computed values\r\n  readonly activePositions = computed(() =>\r\n    this.positions().filter(p => p.status === 'executing' || p.status === 'pending')\r\n  );\r\n\r\n  readonly completedPositions = computed(() =>\r\n    this.positions().filter(p => p.status === 'completed')\r\n  );\r\n\r\n  readonly hasActivePositions = computed(() => this.activePositions().length > 0);\r\n\r\n  private subscriptions = new Subscription();\r\n\r\n  constructor(\r\n    private arbitrageService: TriangularArbitrageService,\r\n    private translationService: TranslationService\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.loadInitialData();\r\n    this.subscribeToRealtimeUpdates();\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.subscriptions.unsubscribe();\r\n  }\r\n\r\n  /**\r\n   * Load initial data\r\n   */\r\n  private loadInitialData(): void {\r\n    // Load scanner status\r\n    this.arbitrageService.getScannerStatus().subscribe({\r\n      next: (response: any) => {\r\n        // Response has: { isScanning, scanners: [...], stats }\r\n        const activeExchanges = new Set<string>();\r\n\r\n        if (response.isScanning && response.scanners && Array.isArray(response.scanners)) {\r\n          // Restore only actively running scanners from backend\r\n          for (const scannerData of response.scanners) {\r\n            const exchange = scannerData.exchange as Exchange;\r\n            const config = scannerData.config as ScannerConfig;\r\n            const backendStats = scannerData.stats;\r\n\r\n            activeExchanges.add(exchange);\r\n\r\n            // Store config in memory\r\n            if (config) {\r\n              this.scannerConfigs.set(exchange, config);\r\n              // Also persist to localStorage for future use\r\n              localStorage.setItem(`scanner_config_${exchange}`, JSON.stringify(config));\r\n            }\r\n\r\n            // Transform backend stats to frontend ScannerStats format\r\n            const stats: ScannerStats | null = backendStats ? {\r\n              status: 'scanning',\r\n              opportunitiesDetectedToday: backendStats.opportunitiesDetectedToday || 0,\r\n              opportunitiesExecutedToday: 0, // Not yet tracked by backend\r\n              totalProfitToday: backendStats.totalProfitToday || 0,\r\n              avgProfitPercentage: 0, // Not yet tracked by backend\r\n              scanningDuration: ((backendStats as any).runningFor || 0) * 1000, // Convert seconds to ms\r\n              lastOpportunityAt: undefined // Not yet tracked by backend\r\n            } : null;\r\n\r\n            // Update scanner component with current state\r\n            this.scannerComponent?.updateScannerState(\r\n              exchange,\r\n              'scanning',\r\n              stats,\r\n              config || null\r\n            );\r\n          }\r\n        }\r\n\r\n        // Clean up localStorage for inactive scanners\r\n        const allExchanges: Exchange[] = ['BYBIT', 'BINANCE', 'BINGX', 'MEXC', 'GATEIO', 'BITGET', 'OKX'];\r\n        for (const exchange of allExchanges) {\r\n          if (!activeExchanges.has(exchange)) {\r\n            // Remove inactive scanner from localStorage\r\n            localStorage.removeItem(`scanner_config_${exchange}`);\r\n            // Ensure scanner component doesn't show it\r\n            this.scannerComponent?.updateScannerState(exchange, 'stopped');\r\n          }\r\n        }\r\n      },\r\n      error: (err) => console.error('Failed to load scanner status:', err)\r\n    });\r\n\r\n    // Load opportunities if scanner is active\r\n    if (this.scannerStatus() === 'scanning') {\r\n      this.loadOpportunities();\r\n    }\r\n\r\n    // Load recent positions\r\n    this.loadPositions();\r\n  }\r\n\r\n  /**\r\n   * Subscribe to real-time WebSocket updates\r\n   */\r\n  private subscribeToRealtimeUpdates(): void {\r\n    // Opportunity updates\r\n    this.subscriptions.add(\r\n      this.arbitrageService.opportunities$.subscribe({\r\n        next: (opportunity) => {\r\n          console.log('[Component] Received opportunity from observable:', opportunity);\r\n          const current = this.opportunities();\r\n          console.log('[Component] Current opportunities count:', current.length);\r\n          const index = current.findIndex(o => o.id === opportunity.id);\r\n\r\n          if (index >= 0) {\r\n            // Update existing\r\n            console.log('[Component] Updating existing opportunity at index:', index);\r\n            const updated = [...current];\r\n            updated[index] = opportunity;\r\n            this.opportunities.set(updated);\r\n          } else {\r\n            // Add new\r\n            console.log('[Component] Adding new opportunity, total will be:', current.length + 1);\r\n            this.opportunities.set([opportunity, ...current]);\r\n          }\r\n        },\r\n        error: (err) => console.error('Opportunity stream error:', err)\r\n      })\r\n    );\r\n\r\n    // Position updates\r\n    this.subscriptions.add(\r\n      this.arbitrageService.positions$.subscribe({\r\n        next: (position) => {\r\n          const current = this.positions();\r\n          const index = current.findIndex(p => p.id === position.id);\r\n\r\n          if (index >= 0) {\r\n            // Update existing\r\n            const updated = [...current];\r\n            updated[index] = position;\r\n            this.positions.set(updated);\r\n          } else {\r\n            // Add new\r\n            this.positions.set([position, ...current]);\r\n          }\r\n        },\r\n        error: (err) => console.error('Position stream error:', err)\r\n      })\r\n    );\r\n\r\n    // Scanner stats updates\r\n    this.subscriptions.add(\r\n      this.arbitrageService.stats$.subscribe({\r\n        next: (stats) => {\r\n          // Stats are automatically updated in the service\r\n        },\r\n        error: (err) => console.error('Stats stream error:', err)\r\n      })\r\n    );\r\n\r\n    // Scanner updates (for multi-exchange support)\r\n    this.subscriptions.add(\r\n      this.arbitrageService.scannerUpdates$.subscribe({\r\n        next: (update) => {\r\n          // Get config from memory or localStorage\r\n          let config = this.scannerConfigs.get(update.exchange as Exchange);\r\n          if (!config) {\r\n            const stored = localStorage.getItem(`scanner_config_${update.exchange}`);\r\n            if (stored) {\r\n              config = JSON.parse(stored) as ScannerConfig;\r\n              this.scannerConfigs.set(update.exchange as Exchange, config);\r\n            }\r\n          }\r\n\r\n          // Transform backend stats to frontend ScannerStats format\r\n          const backendStats: any = update.stats; // Backend uses different format\r\n          const stats: ScannerStats | null = backendStats ? {\r\n            status: update.status,\r\n            opportunitiesDetectedToday: backendStats.opportunitiesDetectedToday || 0,\r\n            opportunitiesExecutedToday: 0, // Not yet tracked by backend\r\n            totalProfitToday: backendStats.totalProfitToday || 0,\r\n            avgProfitPercentage: 0, // Not yet tracked by backend\r\n            scanningDuration: (backendStats.runningFor || 0) * 1000, // Convert seconds to ms\r\n            lastOpportunityAt: undefined // Not yet tracked by backend\r\n          } : null;\r\n\r\n          // Update scanner component with exchange-specific status\r\n          this.scannerComponent?.updateScannerState(\r\n            update.exchange as Exchange,\r\n            update.status,\r\n            stats,\r\n            config || null\r\n          );\r\n        },\r\n        error: (err) => console.error('Scanner update stream error:', err)\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Load opportunities from API\r\n   */\r\n  loadOpportunities(): void {\r\n    this.isLoadingOpportunities.set(true);\r\n    this.error.set(null);\r\n\r\n    this.arbitrageService.getOpportunities().subscribe({\r\n      next: (opportunities) => {\r\n        this.opportunities.set(opportunities);\r\n        this.isLoadingOpportunities.set(false);\r\n      },\r\n      error: (err) => {\r\n        this.error.set('Failed to load opportunities: ' + err.message);\r\n        this.isLoadingOpportunities.set(false);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Load positions from API\r\n   */\r\n  loadPositions(filter?: PositionFilter): void {\r\n    this.isLoadingPositions.set(true);\r\n    this.error.set(null);\r\n\r\n    this.arbitrageService.getPositions(filter).subscribe({\r\n      next: (positions) => {\r\n        this.positions.set(positions);\r\n        this.isLoadingPositions.set(false);\r\n      },\r\n      error: (err) => {\r\n        this.error.set('Failed to load positions: ' + err.message);\r\n        this.isLoadingPositions.set(false);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Handle scanner start\r\n   */\r\n  onScannerStart(config: ScannerConfig): void {\r\n    // Store scanner config for later use (e.g., when executing opportunities)\r\n    this.scannerConfigs.set(config.exchange, config);\r\n\r\n    // Persist to localStorage to survive page reloads\r\n    localStorage.setItem(`scanner_config_${config.exchange}`, JSON.stringify(config));\r\n\r\n    this.arbitrageService.startScanning(config).subscribe({\r\n      next: (response) => {\r\n        if (response.success) {\r\n          // Update scanner component with initial state\r\n          this.scannerComponent?.updateScannerState(\r\n            config.exchange,\r\n            'scanning',\r\n            null,\r\n            config\r\n          );\r\n          this.loadOpportunities();\r\n        }\r\n      },\r\n      error: (err) => {\r\n        this.error.set('Failed to start scanner: ' + err.message);\r\n        // Update scanner component with error state\r\n        this.scannerComponent?.updateScannerState(\r\n          config.exchange,\r\n          'error',\r\n          null,\r\n          config\r\n        );\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Handle scanner stop\r\n   * @param exchange - Specific exchange to stop, or null to stop all\r\n   */\r\n  onScannerStop(exchange: Exchange | null): void {\r\n    this.arbitrageService.stopScanning(exchange || undefined).subscribe({\r\n      next: (response) => {\r\n        if (response.success) {\r\n          // Update scanner component state\r\n          if (exchange) {\r\n            // Stopped specific exchange\r\n            this.scannerComponent?.updateScannerState(exchange, 'stopped');\r\n          } else {\r\n            // Stopped all - clear all scanners in component\r\n            // Get all active scanners and update them\r\n            const activeScanners = this.scannerComponent?.activeScannersList() || [];\r\n            activeScanners.forEach(scanner => {\r\n              this.scannerComponent?.updateScannerState(scanner.exchange, 'stopped');\r\n            });\r\n            // Clear opportunities only when stopping all\r\n            this.opportunities.set([]);\r\n          }\r\n        }\r\n      },\r\n      error: (err) => {\r\n        this.error.set('Failed to stop scanner: ' + err.message);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Handle opportunity execution\r\n   */\r\n  onExecuteOpportunity(opportunity: TriangularOpportunity): void {\r\n    // Get position size from scanner config for this exchange\r\n    let config = this.scannerConfigs.get(opportunity.exchange);\r\n    let restoredFromStorage = false;\r\n\r\n    // If not in memory, try to restore from localStorage\r\n    if (!config) {\r\n      const stored = localStorage.getItem(`scanner_config_${opportunity.exchange}`);\r\n      if (stored) {\r\n        const parsedConfig = JSON.parse(stored) as ScannerConfig;\r\n        config = parsedConfig;\r\n        this.scannerConfigs.set(opportunity.exchange, parsedConfig);\r\n        restoredFromStorage = true;\r\n      }\r\n    }\r\n\r\n    const positionSize = config?.positionSize;\r\n\r\n    console.log('[TriArb Execute] Executing opportunity:', {\r\n      exchange: opportunity.exchange,\r\n      hasConfig: !!config,\r\n      positionSize: positionSize,\r\n      scannerConfigsSize: this.scannerConfigs.size,\r\n      allExchanges: Array.from(this.scannerConfigs.keys()),\r\n      restoredFromStorage\r\n    });\r\n\r\n    // Build execution request\r\n    const request: any = { opportunityId: opportunity.id };\r\n    if (positionSize) {\r\n      request.positionSize = positionSize;\r\n    }\r\n\r\n    console.log('[TriArb Execute] Request payload:', request);\r\n\r\n    this.arbitrageService.executeOpportunity(request).subscribe({\r\n      next: (response) => {\r\n        if (response.success && response.position) {\r\n          // Add to positions list\r\n          this.positions.set([response.position, ...this.positions()]);\r\n          // Switch to positions tab to show execution\r\n          this.activeTab.set('positions');\r\n        }\r\n      },\r\n      error: (err) => {\r\n        this.error.set('Failed to execute opportunity: ' + err.message);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Handle position cancellation\r\n   */\r\n  onCancelPosition(positionId: string): void {\r\n    this.arbitrageService.cancelPosition(positionId).subscribe({\r\n      next: (response) => {\r\n        if (response.success) {\r\n          this.loadPositions();\r\n        }\r\n      },\r\n      error: (err) => {\r\n        this.error.set('Failed to cancel position: ' + err.message);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Handle position deletion\r\n   */\r\n  onDeletePosition(positionId: string): void {\r\n    this.arbitrageService.deletePosition(positionId).subscribe({\r\n      next: (response) => {\r\n        if (response.success) {\r\n          // Remove from local state\r\n          this.positions.set(this.positions().filter(p => p.id !== positionId));\r\n        }\r\n      },\r\n      error: (err) => {\r\n        this.error.set('Failed to delete position: ' + err.message);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Handle filter change\r\n   */\r\n  onFilterChange(filter: PositionFilter): void {\r\n    this.positionFilter.set(filter);\r\n    this.loadPositions(filter);\r\n  }\r\n\r\n  /**\r\n   * Switch active tab\r\n   */\r\n  setActiveTab(tab: 'opportunities' | 'positions'): void {\r\n    this.activeTab.set(tab);\r\n  }\r\n\r\n  /**\r\n   * Reconnect WebSocket\r\n   */\r\n  reconnect(): void {\r\n    this.arbitrageService.reconnect();\r\n  }\r\n\r\n  /**\r\n   * Translation helper\r\n   */\r\n  translate(key: string): string {\r\n    return this.translationService.translate(key);\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\services\\arbitrage-stream.service.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":73,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1683,1686],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1683,1686],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":170,"column":15,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":170,"endColumn":62},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":180,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":180,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5362,5365],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5362,5365],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":181,"column":77,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":181,"endColumn":84}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Injectable, OnDestroy } from '@angular/core';\r\nimport { BehaviorSubject, Observable, Subject } from 'rxjs';\r\nimport { environment } from '../../environments/environment';\r\n\r\n/**\r\n * Real-time price update from SSE stream\r\n */\r\nexport interface PriceUpdate {\r\n  type: 'price_update';\r\n  symbol: string;\r\n  exchange: string;\r\n  credentialId: string;\r\n  price: number;\r\n  spread: string;\r\n  spreadPercent: string;\r\n  timestamp: number;\r\n}\r\n\r\n/**\r\n * Connection status message\r\n */\r\nexport interface ConnectionMessage {\r\n  type: 'connected';\r\n  userId: string;\r\n  symbols: string[];\r\n  exchangeCount: number;\r\n  timestamp: number;\r\n}\r\n\r\n/**\r\n * Error message from stream\r\n */\r\nexport interface ErrorMessage {\r\n  type: 'error';\r\n  exchange: string;\r\n  symbol: string;\r\n  message: string;\r\n  timestamp: number;\r\n}\r\n\r\n/**\r\n * Any stream message type\r\n */\r\nexport type StreamMessage = PriceUpdate | ConnectionMessage | ErrorMessage;\r\n\r\n/**\r\n * Stream configuration for subscribing to arbitrage opportunities\r\n */\r\nexport interface StreamSubscription {\r\n  symbols: string[];\r\n  exchanges: {\r\n    exchange: string;\r\n    symbol: string;\r\n    credentialId: string;\r\n    apiKey?: string;\r\n    apiSecret?: string;\r\n    authToken?: string;\r\n    environment: string;\r\n  }[];\r\n}\r\n\r\n/**\r\n * ArbitrageStreamService\r\n *\r\n * Service for consuming real-time arbitrage price updates via Server-Sent Events (SSE).\r\n * Manages the connection lifecycle, handles reconnection, and distributes updates to subscribers.\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ArbitrageStreamService implements OnDestroy {\r\n  private eventSource: EventSource | null = null;\r\n  private reconnectTimer: any = null;\r\n  private destroy$ = new Subject<void>();\r\n\r\n  // Connection state\r\n  private connectionState$ = new BehaviorSubject<'disconnected' | 'connecting' | 'connected'>('disconnected');\r\n\r\n  // Stream data\r\n  private priceUpdates$ = new Subject<PriceUpdate>();\r\n  private errors$ = new Subject<ErrorMessage>();\r\n\r\n  // Price cache for quick access\r\n  private priceCache = new Map<string, { price: number; timestamp: number; change: 'up' | 'down' | 'neutral' }>();\r\n\r\n  constructor() {\r\n    console.log('[ArbitrageStream] Service initialized');\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.disconnect();\r\n    this.destroy$.next();\r\n    this.destroy$.complete();\r\n  }\r\n\r\n  /**\r\n   * Get connection state observable\r\n   */\r\n  getConnectionState(): Observable<'disconnected' | 'connecting' | 'connected'> {\r\n    return this.connectionState$.asObservable();\r\n  }\r\n\r\n  /**\r\n   * Get price updates observable\r\n   */\r\n  getPriceUpdates(): Observable<PriceUpdate> {\r\n    return this.priceUpdates$.asObservable();\r\n  }\r\n\r\n  /**\r\n   * Get errors observable\r\n   */\r\n  getErrors(): Observable<ErrorMessage> {\r\n    return this.errors$.asObservable();\r\n  }\r\n\r\n  /**\r\n   * Get cached price for a specific exchange-symbol pair\r\n   */\r\n  getCachedPrice(exchange: string, symbol: string): { price: number; timestamp: number; change: 'up' | 'down' | 'neutral' } | null {\r\n    const key = `${exchange}:${symbol}`;\r\n    return this.priceCache.get(key) || null;\r\n  }\r\n\r\n  /**\r\n   * Subscribe to real-time price updates for arbitrage opportunities\r\n   *\r\n   * @param subscription - Configuration for symbols and exchanges to monitor\r\n   * @param authToken - JWT authentication token\r\n   */\r\n  subscribe(subscription: StreamSubscription, authToken: string): void {\r\n    // Disconnect existing connection if any\r\n    if (this.eventSource) {\r\n      console.log('[ArbitrageStream] Closing existing connection');\r\n      this.disconnect();\r\n    }\r\n\r\n    console.log('[ArbitrageStream] Connecting to SSE stream');\r\n    this.connectionState$.next('connecting');\r\n\r\n    // Build query parameters\r\n    const symbols = subscription.symbols.join(',');\r\n    const exchanges = JSON.stringify(subscription.exchanges);\r\n\r\n    // Construct SSE URL with auth token as query parameter\r\n    // Note: EventSource doesn't support custom headers, so we pass token via URL\r\n    const baseUrl = environment.apiUrl || '/api';\r\n    const url = `${baseUrl}/arbitrage/funding-rates/stream?symbols=${encodeURIComponent(symbols)}&exchanges=${encodeURIComponent(exchanges)}&token=${encodeURIComponent(authToken)}`;\r\n\r\n    console.log('[ArbitrageStream] Connecting to:', url);\r\n\r\n    // Create EventSource connection\r\n    this.eventSource = new EventSource(url);\r\n\r\n    // Handle connection open\r\n    this.eventSource.onopen = () => {\r\n      console.log('[ArbitrageStream] ‚úÖ Connected to SSE stream');\r\n      this.connectionState$.next('connected');\r\n\r\n      // Clear reconnect timer\r\n      if (this.reconnectTimer) {\r\n        clearTimeout(this.reconnectTimer);\r\n        this.reconnectTimer = null;\r\n      }\r\n    };\r\n\r\n    // Handle incoming messages\r\n    this.eventSource.onmessage = (event: MessageEvent) => {\r\n      try {\r\n        const message: StreamMessage = JSON.parse(event.data);\r\n\r\n        if (message.type === 'connected') {\r\n          console.log('[ArbitrageStream] Connection confirmed:', message);\r\n        } else if (message.type === 'price_update') {\r\n          this.handlePriceUpdate(message as PriceUpdate);\r\n        } else if (message.type === 'error') {\r\n          console.error('[ArbitrageStream] Stream error:', message);\r\n          this.errors$.next(message as ErrorMessage);\r\n        }\r\n      } catch (error: any) {\r\n        console.error('[ArbitrageStream] Error parsing SSE message:', error.message, event.data);\r\n      }\r\n    };\r\n\r\n    // Handle errors\r\n    this.eventSource.onerror = (error: Event) => {\r\n      console.error('[ArbitrageStream] ‚ùå SSE connection error:', error);\r\n      this.connectionState$.next('disconnected');\r\n\r\n      // Close the connection\r\n      if (this.eventSource) {\r\n        this.eventSource.close();\r\n        this.eventSource = null;\r\n      }\r\n\r\n      // Attempt to reconnect after 5 seconds\r\n      console.log('[ArbitrageStream] Attempting to reconnect in 5 seconds...');\r\n      this.reconnectTimer = setTimeout(() => {\r\n        console.log('[ArbitrageStream] Reconnecting...');\r\n        this.subscribe(subscription, authToken);\r\n      }, 5000);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Handle price update from stream\r\n   */\r\n  private handlePriceUpdate(update: PriceUpdate): void {\r\n    const key = `${update.exchange}:${update.symbol}`;\r\n\r\n    // Determine price change direction\r\n    const cached = this.priceCache.get(key);\r\n    let change: 'up' | 'down' | 'neutral' = 'neutral';\r\n\r\n    if (cached) {\r\n      if (update.price > cached.price) {\r\n        change = 'up';\r\n      } else if (update.price < cached.price) {\r\n        change = 'down';\r\n      }\r\n    }\r\n\r\n    // Update cache\r\n    this.priceCache.set(key, {\r\n      price: update.price,\r\n      timestamp: update.timestamp,\r\n      change,\r\n    });\r\n\r\n    // Emit update to subscribers\r\n    this.priceUpdates$.next(update);\r\n\r\n    console.log(`[ArbitrageStream] Price update: ${update.exchange} ${update.symbol} = $${update.price.toFixed(2)} (${change})`);\r\n  }\r\n\r\n  /**\r\n   * Disconnect from SSE stream\r\n   */\r\n  disconnect(): void {\r\n    console.log('[ArbitrageStream] Disconnecting from SSE stream');\r\n\r\n    // Clear reconnect timer\r\n    if (this.reconnectTimer) {\r\n      clearTimeout(this.reconnectTimer);\r\n      this.reconnectTimer = null;\r\n    }\r\n\r\n    // Close EventSource\r\n    if (this.eventSource) {\r\n      this.eventSource.close();\r\n      this.eventSource = null;\r\n    }\r\n\r\n    // Update state\r\n    this.connectionState$.next('disconnected');\r\n\r\n    // Clear cache\r\n    this.priceCache.clear();\r\n\r\n    console.log('[ArbitrageStream] Disconnected');\r\n  }\r\n\r\n  /**\r\n   * Check if currently connected\r\n   */\r\n  isConnected(): boolean {\r\n    return this.connectionState$.value === 'connected';\r\n  }\r\n\r\n  /**\r\n   * Clear price cache\r\n   */\r\n  clearCache(): void {\r\n    this.priceCache.clear();\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\services\\auth.service.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":90,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":90,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .error on an `any` value.","line":90,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":90,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":92,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":92,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":110,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":110,"endColumn":63},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .error on an `any` value.","line":110,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":110,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":112,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":112,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":128,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":128,"endColumn":63},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .error on an `any` value.","line":128,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":128,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":130,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":130,"endColumn":38},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":135,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":135,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3902,3905],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3902,3905],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":157,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":157,"endColumn":38},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":240,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":240,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6777,6780],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6777,6780],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":246,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":246,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":249,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":249,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exp on an `any` value.","line":249,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":249,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exp on an `any` value.","line":250,"column":42,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":250,"endColumn":45},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exp on an `any` value.","line":253,"column":34,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":253,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exp on an `any` value.","line":253,"column":49,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":253,"endColumn":52},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":268,"column":9,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":268,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .status on an `any` value.","line":292,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":292,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":296,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":296,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":315,"column":13,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":315,"endColumn":48},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .status on an `any` value.","line":335,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":335,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":392,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":392,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exp on an `any` value.","line":393,"column":32,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":393,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exp on an `any` value.","line":399,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":399,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exp on an `any` value.","line":402,"column":56,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":402,"endColumn":59},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exp on an `any` value.","line":404,"column":60,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":404,"endColumn":63},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":414,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":414,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12156,12159],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12156,12159],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":432,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":432,"endColumn":51},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exp on an `any` value.","line":433,"column":30,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":433,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .exp on an `any` value.","line":434,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":434,"endColumn":36}],"suppressedMessages":[],"errorCount":32,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { computed, effect, Injectable, signal } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { BehaviorSubject, catchError, Observable, tap, throwError, map, take, of } from 'rxjs';\r\nimport { getEndpointUrl } from '../config/app.config';\r\n\r\nexport interface User {\r\n  id: string;\r\n  email: string;\r\n  name?: string;\r\n  role: string;\r\n  avatar?: string;\r\n  subscriptionActive: boolean;\r\n  subscriptionExpiry?: string;\r\n  googleLinked?: boolean;\r\n}\r\n\r\nexport interface AuthResponse {\r\n  token: string;\r\n  user: User;\r\n}\r\n\r\nexport interface AuthState {\r\n  user: User | null;\r\n  token: string | null;\r\n  isLoading: boolean;\r\n  error: string | null;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class AuthService {\r\n  public isReady = new BehaviorSubject<boolean>(false);\r\n  private readonly tokenKey = 'auth_token';\r\n  private readonly userKey = 'auth_user';\r\n  private _authState = signal<AuthState>({\r\n    user: null,\r\n    token: null,\r\n    isLoading: false,\r\n    error: null\r\n  });\r\n\r\n  private sessionCheckInterval?: number;\r\n  private readonly SESSION_CHECK_INTERVAL = 5 * 60 * 1000; // 5 minutes\r\n\r\n  // Public computed signals\r\n  public readonly authState = this._authState.asReadonly();\r\n  public readonly currentUser = computed(() => this._authState().user);\r\n  public readonly isAuthenticated = computed(() => !!this._authState().token);\r\n  public readonly isLoading = computed(() => this._authState().isLoading);\r\n  public readonly error = computed(() => this._authState().error);\r\n\r\n  constructor(private http: HttpClient) {\r\n    this.loadAuthDataFromStorage();\r\n    this.setupWindowFocusListener();\r\n\r\n    effect(() => {\r\n      const state = this._authState();\r\n\r\n      // Persist token\r\n      if (state.token) {\r\n        localStorage.setItem(this.tokenKey, state.token);\r\n        this.startSessionMonitoring();\r\n      } else {\r\n        localStorage.removeItem(this.tokenKey);\r\n        this.stopSessionMonitoring();\r\n      }\r\n\r\n      // Persist user data\r\n      if (state.user) {\r\n        localStorage.setItem(this.userKey, JSON.stringify(state.user));\r\n      } else {\r\n        localStorage.removeItem(this.userKey);\r\n      }\r\n    });\r\n  }\r\n\r\n  login(email: string, password: string): Observable<AuthResponse> {\r\n    this.updateAuthState({ isLoading: true, error: null, user: null });\r\n\r\n    return this.http.post<AuthResponse>(getEndpointUrl('auth', 'login'), {\r\n      email,\r\n      password\r\n    }).pipe(\r\n      take(1),\r\n      tap(response => this.setAuthData(response)),\r\n      catchError(error => {\r\n        this.updateAuthState({\r\n          isLoading: false,\r\n          error: error.error?.message || 'Login failed'\r\n        });\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n\r\n  register(email: string, password: string, name?: string): Observable<AuthResponse> {\r\n    this.updateAuthState({ isLoading: true, error: null });\r\n\r\n    return this.http.post<AuthResponse>(getEndpointUrl('auth', 'register'), {\r\n      email,\r\n      password,\r\n      name\r\n    }).pipe(\r\n      take(1),\r\n      tap(response => this.setAuthData(response)),\r\n      catchError(error => {\r\n        this.updateAuthState({\r\n          isLoading: false,\r\n          error: error.error?.message || 'Registration failed'\r\n        });\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n\r\n  loginWithGoogle(idToken: string): Observable<AuthResponse> {\r\n    this.updateAuthState({ isLoading: true, error: null });\r\n\r\n    return this.http.post<AuthResponse>(getEndpointUrl('google', 'auth'), {\r\n      idToken\r\n    }).pipe(\r\n      take(1),\r\n      tap(response => this.setAuthData(response)),\r\n      catchError(error => {\r\n        this.updateAuthState({\r\n          isLoading: false,\r\n          error: error.error?.message || 'Google login failed'\r\n        });\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n\r\n  logout(): Observable<any> {\r\n    return this.http.post(getEndpointUrl('auth', 'logout'), {}).pipe(\r\n      take(1),\r\n      tap(() => {\r\n        this.clearAuthData();\r\n      }),\r\n      catchError(() => {\r\n        this.clearAuthData();\r\n        return throwError(() => 'Logout completed locally');\r\n      })\r\n    );\r\n  }\r\n\r\n  getUserProfile(): Observable<User> {\r\n    const url = getEndpointUrl('user', 'profile');\r\n\r\n    return this.http.get<User>(url).pipe(\r\n      take(1),\r\n      tap((user: User) => {\r\n        this.updateAuthState({ user })\r\n      }),\r\n      catchError((error) => {\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n\r\n  updateProfile(data: { name?: string; avatar?: string }): Observable<User> {\r\n    return this.http.put<User>(getEndpointUrl('user', 'profile'), data).pipe(\r\n      take(1),\r\n      tap(user => this.updateAuthState({ user }))\r\n    );\r\n  }\r\n\r\n  hasRole(role: string): boolean {\r\n    const user = this.currentUser();\r\n    if (!user) return false;\r\n\r\n    const roleHierarchy = {\r\n      'BASIC': 0,\r\n      'PREMIUM': 1,\r\n      'ENTERPRISE': 2,\r\n      'ADMIN': 3,\r\n    } as const;\r\n\r\n    const userLevel = roleHierarchy[user.role as keyof typeof roleHierarchy] ?? 0;\r\n    const requiredLevel = roleHierarchy[role as keyof typeof roleHierarchy] ?? 0;\r\n\r\n    return userLevel >= requiredLevel;\r\n  }\r\n\r\n  clearError() {\r\n    this.updateAuthState({ error: null });\r\n  }\r\n\r\n  handleSessionExpired() {\r\n    console.log('handleSessionExpired called');\r\n    this.clearAuthData();\r\n    this.updateAuthState({\r\n      error: 'Your session has expired. Please log in again.'\r\n    });\r\n    console.log('Session expiry handled, auth state cleared');\r\n  }\r\n\r\n  private handleExpiredToken() {\r\n    console.log('handleExpiredToken called - clearing local storage and auth state');\r\n    localStorage.removeItem(this.tokenKey);\r\n    localStorage.removeItem(this.userKey);\r\n    this.updateAuthState({\r\n      user: null,\r\n      token: null,\r\n      isLoading: false,\r\n      error: 'Your session has expired. Please log in again.'\r\n    });\r\n  }\r\n\r\n  // For testing - simulate session expiry\r\n  simulateSessionExpiry() {\r\n    console.log('Simulating session expiry...');\r\n    this.handleSessionExpired();\r\n  }\r\n\r\n  // For testing - validate current token manually\r\n  validateCurrentToken(): boolean {\r\n    const token = localStorage.getItem(this.tokenKey);\r\n    if (!token) {\r\n      console.log('No token found for validation');\r\n      return false;\r\n    }\r\n\r\n    const isValid = this.isTokenValid(token);\r\n    console.log('Current token validation result:', isValid);\r\n\r\n    if (!isValid) {\r\n      const expTime = this.getTokenExpirationTime(token);\r\n      if (expTime) {\r\n        console.log('Token expired at:', expTime);\r\n        console.log('Current time:', new Date());\r\n      }\r\n    }\r\n\r\n    return isValid;\r\n  }\r\n\r\n  // For testing - get token info\r\n  getTokenInfo(): any {\r\n    const token = localStorage.getItem(this.tokenKey);\r\n    if (!token) {\r\n      return null;\r\n    }\r\n\r\n    const payload = this.decodeJwtPayload(token);\r\n    if (payload) {\r\n      return {\r\n        exp: payload.exp,\r\n        expirationDate: new Date(payload.exp * 1000),\r\n        currentDate: new Date(),\r\n        isValid: this.isTokenValid(token),\r\n        timeUntilExpiry: payload.exp ? (payload.exp * 1000 - Date.now()) / 1000 : null\r\n      };\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  // For testing - get stored auth data\r\n  getStoredAuthData(): { token: string | null; user: User | null } {\r\n    const token = localStorage.getItem(this.tokenKey);\r\n    const userDataStr = localStorage.getItem(this.userKey);\r\n\r\n    let user: User | null = null;\r\n    if (userDataStr) {\r\n      try {\r\n        user = JSON.parse(userDataStr);\r\n      } catch (error) {\r\n        console.log('Failed to parse stored user data:', error);\r\n      }\r\n    }\r\n\r\n    return { token, user };\r\n  }\r\n\r\n  // Force session validation check\r\n  forceSessionCheck(): Observable<boolean> {\r\n    console.log('Force session check triggered');\r\n    if (!this.isAuthenticated()) {\r\n      console.log('Not authenticated, skipping session check');\r\n      return of(false);\r\n    }\r\n\r\n    return this.getUserProfile().pipe(\r\n      map(() => {\r\n        console.log('Session check passed - user profile retrieved');\r\n        return true;\r\n      }),\r\n      catchError((error) => {\r\n        console.log('Session check failed:', error);\r\n        if (error.status === 401) {\r\n          console.log('401 during session check - handling session expiry');\r\n          this.handleSessionExpired();\r\n        }\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n\r\n  private loadAuthDataFromStorage() {\r\n    const token = localStorage.getItem(this.tokenKey);\r\n    const userDataStr = localStorage.getItem(this.userKey);\r\n\r\n    if (token) {\r\n      console.log('Found token in localStorage, validating...');\r\n\r\n      if (this.isTokenValid(token)) {\r\n        console.log('Token is valid, loading auth data from localStorage');\r\n\r\n        // Load user data from localStorage if available\r\n        let savedUser: User | null = null;\r\n        if (userDataStr) {\r\n          try {\r\n            savedUser = JSON.parse(userDataStr);\r\n            console.log('Loaded user data from localStorage:', savedUser);\r\n          } catch (error) {\r\n            console.log('Failed to parse saved user data:', error);\r\n            localStorage.removeItem(this.userKey);\r\n          }\r\n        }\r\n\r\n        // Set auth state with saved data\r\n        this.updateAuthState({ token, user: savedUser });\r\n\r\n        // Fetch fresh user profile from server to ensure data is up-to-date\r\n        this.getUserProfile().subscribe({\r\n          next: (user) => {\r\n            console.log('User profile fetched successfully and updated');\r\n            this.isReady.next(true);\r\n            this.updateAuthState({ user });\r\n          },\r\n          error: (error) => {\r\n            console.log('Failed to fetch user profile:', error);\r\n            if (error.status === 401) {\r\n              console.log('401 error - token might be invalid on server side');\r\n              this.handleExpiredToken();\r\n            } else {\r\n              console.log('Network error - using cached user data if available');\r\n              // Keep using cached user data if network error\r\n              if (savedUser) {\r\n                console.log('Using cached user data due to network error');\r\n              }\r\n            }\r\n            this.isReady.next(true);\r\n          }\r\n        });\r\n      } else {\r\n        console.log('Token is expired or invalid, clearing auth data');\r\n        this.handleExpiredToken();\r\n        this.isReady.next(true);\r\n      }\r\n    } else {\r\n      console.log('No token found in localStorage');\r\n      this.isReady.next(true);\r\n    }\r\n  }\r\n\r\n  private updateAuthState(partial: Partial<AuthState>) {\r\n    this._authState.update(state => {\r\n      const newState = { ...state, ...partial };\r\n      // Ensure isLoading is false if there's an error\r\n      if (newState.error) {\r\n        newState.isLoading = false;\r\n      }\r\n      return newState;\r\n    });\r\n  }\r\n\r\n  private setAuthData(response: AuthResponse) {\r\n    this.updateAuthState({\r\n      token: response.token,\r\n      user: response.user,\r\n      isLoading: false,\r\n      error: null\r\n    });\r\n  }\r\n\r\n  clearAuthData() {\r\n    localStorage.removeItem(this.tokenKey);\r\n    localStorage.removeItem(this.userKey);\r\n    this.updateAuthState({\r\n      user: null,\r\n      token: null,\r\n      isLoading: false,\r\n      error: null\r\n    });\r\n  }\r\n\r\n  private isTokenValid(token: string): boolean {\r\n    try {\r\n      const payload = this.decodeJwtPayload(token);\r\n      if (!payload || !payload.exp) {\r\n        console.log('Token missing expiration claim');\r\n        return false;\r\n      }\r\n\r\n      const currentTime = Math.floor(Date.now() / 1000);\r\n      const isValid = payload.exp > currentTime;\r\n\r\n      if (!isValid) {\r\n        console.log('Token expired:', new Date(payload.exp * 1000), 'Current:', new Date());\r\n      } else {\r\n        console.log('Token valid until:', new Date(payload.exp * 1000));\r\n      }\r\n\r\n      return isValid;\r\n    } catch (error) {\r\n      console.log('Token validation error:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  private decodeJwtPayload(token: string): any {\r\n    try {\r\n      const parts = token.split('.');\r\n      if (parts.length !== 3) {\r\n        throw new Error('Invalid JWT format');\r\n      }\r\n\r\n      const payload = parts[1];\r\n      const decoded = atob(payload.replace(/-/g, '+').replace(/_/g, '/'));\r\n      return JSON.parse(decoded);\r\n    } catch (error) {\r\n      console.log('JWT decode error:', error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  private getTokenExpirationTime(token: string): Date | null {\r\n    try {\r\n      const payload = this.decodeJwtPayload(token);\r\n      if (payload && payload.exp) {\r\n        return new Date(payload.exp * 1000);\r\n      }\r\n    } catch (error) {\r\n      console.log('Error getting token expiration:', error);\r\n    }\r\n    return null;\r\n  }\r\n\r\n  private startSessionMonitoring() {\r\n    if (this.sessionCheckInterval) {\r\n      clearInterval(this.sessionCheckInterval);\r\n    }\r\n\r\n    console.log('Starting session monitoring with 5-minute intervals');\r\n    this.sessionCheckInterval = window.setInterval(() => {\r\n      console.log('Periodic session check triggered');\r\n      this.forceSessionCheck().subscribe({\r\n        next: (valid) => {\r\n          console.log('Periodic session check result:', valid ? 'valid' : 'invalid');\r\n        },\r\n        error: (error) => {\r\n          console.log('Periodic session check error:', error);\r\n        }\r\n      });\r\n    }, this.SESSION_CHECK_INTERVAL);\r\n  }\r\n\r\n  private stopSessionMonitoring() {\r\n    if (this.sessionCheckInterval) {\r\n      console.log('Stopping session monitoring');\r\n      clearInterval(this.sessionCheckInterval);\r\n      this.sessionCheckInterval = undefined;\r\n    }\r\n  }\r\n\r\n  private setupWindowFocusListener() {\r\n    window.addEventListener('focus', () => {\r\n      if (this.isAuthenticated()) {\r\n        console.log('Window focused - performing session check');\r\n        this.forceSessionCheck().subscribe({\r\n          next: (valid) => {\r\n            console.log('Window focus session check result:', valid ? 'valid' : 'invalid');\r\n          },\r\n          error: (error) => {\r\n            console.log('Window focus session check error:', error);\r\n          }\r\n        });\r\n      }\r\n    });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\services\\bingx-user.service.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'map' is defined but never used.","line":4,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":224,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":224,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5539,5542],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5539,5542],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":228,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":228,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5663,5666],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5663,5666],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":231,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":231,"endColumn":38},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":239,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":239,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5914,5917],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5914,5917],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":247,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":247,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6167,6170],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6167,6170],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":250,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":250,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":261,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":261,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":262,"column":7,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":262,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":262,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":262,"endColumn":33}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Injectable } from '@angular/core';\r\nimport { HttpClient, HttpErrorResponse } from '@angular/common/http';\r\nimport { Observable, throwError, BehaviorSubject } from 'rxjs';\r\nimport { catchError, map, tap } from 'rxjs/operators';\r\nimport { getEndpointUrl, buildUrlWithQuery } from '../config/app.config';\r\n\r\n/**\r\n * BingX Account Information Interface\r\n */\r\nexport interface BingXAccountInfo {\r\n  balance: {\r\n    userId: string;\r\n    asset: string;\r\n    balance: string;\r\n    equity: string;\r\n    unrealizedProfit: string;\r\n    realisedProfit: string;\r\n    availableMargin: string;\r\n    usedMargin: string;\r\n    freezedMargin: string;\r\n  };\r\n}\r\n\r\n/**\r\n * BingX Wallet Balance Information\r\n */\r\nexport interface BingXWalletBalance {\r\n  asset: string;\r\n  balance: {\r\n    asset: string;\r\n    balance: string;\r\n    equity: string;\r\n    unrealizedProfit: string;\r\n    realisedProfit: string;\r\n    availableMargin: string;\r\n    usedMargin: string;\r\n    freezedMargin: string;\r\n  };\r\n}\r\n\r\n/**\r\n * BingX Position Information\r\n */\r\nexport interface BingXPosition {\r\n  symbol: string;\r\n  positionId: string;\r\n  positionSide: 'LONG' | 'SHORT';\r\n  isolated: boolean;\r\n  positionAmt: string;\r\n  availableAmt: string;\r\n  unrealizedProfit: string;\r\n  realisedProfit: string;\r\n  initialMargin: string;\r\n  markPrice: string;\r\n  entryPrice: string;\r\n  leverage: string;\r\n  isolatedWallet: string;\r\n}\r\n\r\n/**\r\n * BingX Ticker Information\r\n */\r\nexport interface BingXTicker {\r\n  symbol: string;\r\n  priceChange: string;\r\n  priceChangePercent: string;\r\n  lastPrice: string;\r\n  lastQty: string;\r\n  highPrice: string;\r\n  lowPrice: string;\r\n  volume: string;\r\n  quoteVolume: string;\r\n  openPrice: string;\r\n  openTime: number;\r\n  closeTime: number;\r\n}\r\n\r\n/**\r\n * Complete BingX User Information Response\r\n */\r\nexport interface BingXUserInfo {\r\n  success: boolean;\r\n  timestamp: string;\r\n  testnet: boolean;\r\n  data: {\r\n    accountInfo: BingXAccountInfo | { error: string };\r\n    walletBalance: BingXWalletBalance | { error: string };\r\n    positions: BingXPosition[];\r\n    positionsCount: number;\r\n    marketReference: BingXTicker | null;\r\n  };\r\n}\r\n\r\n/**\r\n * BingX User Service\r\n *\r\n * Handles all BingX user-related operations including:\r\n * - Fetching user account information\r\n * - Managing account balance data\r\n * - Retrieving positions\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class BingXUserService {\r\n  private userInfoSubject = new BehaviorSubject<BingXUserInfo | null>(null);\r\n  private loadingSubject = new BehaviorSubject<boolean>(false);\r\n  private errorSubject = new BehaviorSubject<string | null>(null);\r\n\r\n  public readonly userInfo$ = this.userInfoSubject.asObservable();\r\n  public readonly loading$ = this.loadingSubject.asObservable();\r\n  public readonly error$ = this.errorSubject.asObservable();\r\n\r\n  constructor(\r\n    private http: HttpClient\r\n  ) {\r\n    // BingX User Service initialized\r\n  }\r\n\r\n  /**\r\n   * Get comprehensive BingX user information using stored API keys\r\n   * This method uses the active BingX credentials from the backend\r\n   * @returns Observable<BingXUserInfo>\r\n   */\r\n  getUserInfo(): Observable<BingXUserInfo> {\r\n    this.loadingSubject.next(true);\r\n    this.errorSubject.next(null);\r\n\r\n    const url = getEndpointUrl('bingx', 'userInfo');\r\n\r\n    return this.http.get<BingXUserInfo>(url).pipe(\r\n      tap(info => {\r\n        this.userInfoSubject.next(info);\r\n        this.loadingSubject.next(false);\r\n      }),\r\n      catchError(error => {\r\n        this.loadingSubject.next(false);\r\n        const errorMessage = this.handleError(error);\r\n        this.errorSubject.next(errorMessage);\r\n        return throwError(() => new Error(errorMessage));\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Refresh user information using stored API keys\r\n   */\r\n  refreshUserInfo(): Observable<BingXUserInfo> {\r\n    return this.getUserInfo();\r\n  }\r\n\r\n  /**\r\n   * Get current user info from cache (if available)\r\n   */\r\n  getCurrentUserInfo(): BingXUserInfo | null {\r\n    return this.userInfoSubject.value;\r\n  }\r\n\r\n  /**\r\n   * Clear cached user info\r\n   */\r\n  clearUserInfo(): void {\r\n    this.userInfoSubject.next(null);\r\n    this.errorSubject.next(null);\r\n  }\r\n\r\n  /**\r\n   * Check if user info is currently loading\r\n   */\r\n  isLoading(): boolean {\r\n    return this.loadingSubject.value;\r\n  }\r\n\r\n  /**\r\n   * Get current error (if any)\r\n   */\r\n  getCurrentError(): string | null {\r\n    return this.errorSubject.value;\r\n  }\r\n\r\n  /**\r\n   * Calculate total portfolio value in USD\r\n   */\r\n  calculateTotalValue(userInfo: BingXUserInfo): number {\r\n    if (!userInfo.success || !userInfo.data.accountInfo) {\r\n      return 0;\r\n    }\r\n\r\n    const accountInfo = userInfo.data.accountInfo;\r\n    if ('error' in accountInfo) {\r\n      return 0;\r\n    }\r\n\r\n    return parseFloat(accountInfo.balance.equity || '0');\r\n  }\r\n\r\n  /**\r\n   * Get active (non-zero) positions\r\n   */\r\n  getActivePositions(userInfo: BingXUserInfo): BingXPosition[] {\r\n    if (!userInfo.success || !userInfo.data.positions) {\r\n      return [];\r\n    }\r\n\r\n    return userInfo.data.positions.filter(\r\n      position => parseFloat(position.positionAmt) > 0\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Calculate total unrealized PnL from positions\r\n   */\r\n  calculateUnrealizedPnl(userInfo: BingXUserInfo): number {\r\n    const activePositions = this.getActivePositions(userInfo);\r\n    return activePositions.reduce(\r\n      (total, position) => total + parseFloat(position.unrealizedProfit || '0'),\r\n      0\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get wallet balance\r\n   */\r\n  getWalletBalance(): Observable<any> {\r\n    const baseUrl = getEndpointUrl('bingx', 'walletBalance');\r\n    const url = baseUrl;\r\n\r\n    return this.http.get<any>(url).pipe(\r\n      catchError(error => {\r\n        console.error('Error fetching wallet balance:', error);\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get tickers\r\n   */\r\n  getTickers(symbol?: string): Observable<any> {\r\n    const baseUrl = getEndpointUrl('bingx', 'tickers');\r\n    const params: Record<string, string> = {};\r\n    if (symbol) {\r\n      params['symbol'] = symbol;\r\n    }\r\n    const url = buildUrlWithQuery(baseUrl, params);\r\n\r\n    return this.http.get<any>(url).pipe(\r\n      catchError(error => {\r\n        console.error('Error fetching tickers:', error);\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Handle HTTP errors and return user-friendly messages\r\n   */\r\n  private handleError(error: HttpErrorResponse): string {\r\n    console.error('BingX User Service Error:', error);\r\n\r\n    if (error.error?.message) {\r\n      return error.error.message;\r\n    }\r\n\r\n    if (error.status === 0) {\r\n      return 'Unable to connect to the server. Please check your internet connection.';\r\n    }\r\n\r\n    if (error.status === 401) {\r\n      return 'Invalid API credentials. Please check your BingX API key and secret.';\r\n    }\r\n\r\n    if (error.status === 403) {\r\n      return 'Access forbidden. Please check your API key permissions.';\r\n    }\r\n\r\n    if (error.status === 429) {\r\n      return 'Too many requests. Please wait a moment and try again.';\r\n    }\r\n\r\n    if (error.status >= 500) {\r\n      return 'Server error. Please try again later.';\r\n    }\r\n\r\n    return error.message || 'An unexpected error occurred. Please try again.';\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\services\\bybit-funding-strategy.service.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'getEndpointUrl' is defined but never used.","line":11,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":64,"column":17,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":65,"endColumn":94},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .error on an `any` value.","line":65,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":65,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":65,"column":41,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":65,"endColumn":48},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":95,"column":17,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":96,"endColumn":93},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .error on an `any` value.","line":96,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":96,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":96,"column":41,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":96,"endColumn":48},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":123,"column":35,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":123,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":150,"column":17,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":150,"endColumn":96},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .error on an `any` value.","line":150,"column":38,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":150,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":150,"column":60,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":150,"endColumn":67}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Bybit Funding Strategy Service\r\n *\r\n * Service for managing Bybit funding strategies (both regular and precise timing)\r\n */\r\n\r\nimport { Injectable, inject } from '@angular/core';\r\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\r\nimport { Observable, throwError } from 'rxjs';\r\nimport { catchError, map } from 'rxjs/operators';\r\nimport { getEndpointUrl } from '../config/app.config';\r\nimport {\r\n  StartFundingStrategyRequest,\r\n  StartFundingStrategyResponse,\r\n  StartPreciseTimingStrategyRequest,\r\n  StartPreciseTimingStrategyResponse,\r\n  GetActiveStrategiesResponse,\r\n  StopStrategyResponse,\r\n  ActiveStrategy,\r\n} from '../models/bybit-funding-strategy.model';\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class BybitFundingStrategyService {\r\n  private http = inject(HttpClient);\r\n  private baseUrl = '/api/bybit-funding-strategy';\r\n\r\n  /**\r\n   * Get HTTP headers with authentication token\r\n   */\r\n  private getHeaders(): HttpHeaders {\r\n    const token = localStorage.getItem('auth_token');\r\n    return new HttpHeaders({\r\n      'Content-Type': 'application/json',\r\n      ...(token && { Authorization: `Bearer ${token}` }),\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Start Regular Funding Strategy (opens 5s BEFORE funding time)\r\n   *\r\n   * @param params Strategy configuration\r\n   * @returns Observable of start response\r\n   */\r\n  startRegularStrategy(\r\n    params: StartFundingStrategyRequest\r\n  ): Observable<StartFundingStrategyResponse['data']> {\r\n    const url = `${this.baseUrl}/start`;\r\n\r\n    return this.http\r\n      .post<StartFundingStrategyResponse>(url, params, {\r\n        headers: this.getHeaders(),\r\n      })\r\n      .pipe(\r\n        map((response) => {\r\n          if (response.success && response.data) {\r\n            return response.data;\r\n          }\r\n          throw new Error(response.error || 'Failed to start regular funding strategy');\r\n        }),\r\n        catchError((error) => {\r\n          console.error('Error starting regular funding strategy:', error);\r\n          const errorMessage =\r\n            error.error?.error || error.message || 'Failed to start regular funding strategy';\r\n          return throwError(() => new Error(errorMessage));\r\n        })\r\n      );\r\n  }\r\n\r\n  /**\r\n   * Start Precise Timing Strategy (opens 20ms AFTER funding time)\r\n   *\r\n   * @param params Strategy configuration\r\n   * @returns Observable of start response\r\n   */\r\n  startPreciseTimingStrategy(\r\n    params: StartPreciseTimingStrategyRequest\r\n  ): Observable<StartPreciseTimingStrategyResponse['data']> {\r\n    const url = `${this.baseUrl}/start-precise-timing`;\r\n\r\n    return this.http\r\n      .post<StartPreciseTimingStrategyResponse>(url, params, {\r\n        headers: this.getHeaders(),\r\n      })\r\n      .pipe(\r\n        map((response) => {\r\n          if (response.success && response.data) {\r\n            return response.data;\r\n          }\r\n          throw new Error(response.error || 'Failed to start precise timing strategy');\r\n        }),\r\n        catchError((error) => {\r\n          console.error('Error starting precise timing strategy:', error);\r\n          const errorMessage =\r\n            error.error?.error || error.message || 'Failed to start precise timing strategy';\r\n          return throwError(() => new Error(errorMessage));\r\n        })\r\n      );\r\n  }\r\n\r\n  /**\r\n   * Get all active funding strategies\r\n   *\r\n   * @returns Observable of active strategies\r\n   */\r\n  getActiveStrategies(): Observable<ActiveStrategy[]> {\r\n    const url = this.baseUrl;\r\n\r\n    return this.http\r\n      .get<GetActiveStrategiesResponse>(url, {\r\n        headers: this.getHeaders(),\r\n      })\r\n      .pipe(\r\n        map((response) => {\r\n          if (response.success && response.data) {\r\n            return response.data;\r\n          }\r\n          throw new Error('Failed to fetch active strategies');\r\n        }),\r\n        catchError((error) => {\r\n          console.error('Error fetching active strategies:', error);\r\n          return throwError(() => error);\r\n        })\r\n      );\r\n  }\r\n\r\n  /**\r\n   * Stop a specific strategy\r\n   *\r\n   * @param strategyId Strategy ID to stop\r\n   * @returns Observable of stop response\r\n   */\r\n  stopStrategy(strategyId: string): Observable<void> {\r\n    const url = `${this.baseUrl}/${strategyId}`;\r\n\r\n    return this.http\r\n      .delete<StopStrategyResponse>(url, {\r\n        headers: this.getHeaders(),\r\n      })\r\n      .pipe(\r\n        map((response) => {\r\n          if (response.success) {\r\n            return;\r\n          }\r\n          throw new Error(response.error || 'Failed to stop strategy');\r\n        }),\r\n        catchError((error) => {\r\n          console.error('Error stopping strategy:', error);\r\n          const errorMessage = error.error?.error || error.message || 'Failed to stop strategy';\r\n          return throwError(() => new Error(errorMessage));\r\n        })\r\n      );\r\n  }\r\n\r\n  /**\r\n   * Format funding rate for display\r\n   *\r\n   * @param rate Funding rate as decimal (e.g., 0.0001)\r\n   * @param decimals Number of decimal places\r\n   * @returns Formatted rate string (e.g., \"0.01%\")\r\n   */\r\n  formatFundingRate(rate: number, decimals = 4): string {\r\n    return `${(rate * 100).toFixed(decimals)}%`;\r\n  }\r\n\r\n  /**\r\n   * Calculate expected funding payment\r\n   *\r\n   * @param margin Margin in USDT\r\n   * @param leverage Leverage multiplier\r\n   * @param fundingRate Funding rate as decimal\r\n   * @returns Expected funding payment in USDT\r\n   */\r\n  calculateExpectedFunding(margin: number, leverage: number, fundingRate: number): number {\r\n    return margin * leverage * Math.abs(fundingRate);\r\n  }\r\n\r\n  /**\r\n   * Calculate take profit amount in USDT\r\n   *\r\n   * @param expectedFunding Expected funding payment\r\n   * @param takeProfitPercent TP percentage (e.g., 90)\r\n   * @returns Take profit amount in USDT\r\n   */\r\n  calculateTakeProfit(expectedFunding: number, takeProfitPercent: number): number {\r\n    return expectedFunding * (takeProfitPercent / 100);\r\n  }\r\n\r\n  /**\r\n   * Calculate stop loss amount in USDT\r\n   *\r\n   * @param expectedFunding Expected funding payment\r\n   * @param stopLossPercent SL percentage (e.g., 50)\r\n   * @returns Stop loss amount in USDT\r\n   */\r\n  calculateStopLoss(expectedFunding: number, stopLossPercent: number): number {\r\n    return expectedFunding * (stopLossPercent / 100);\r\n  }\r\n\r\n  /**\r\n   * Format time remaining until funding\r\n   *\r\n   * @param secondsRemaining Seconds remaining\r\n   * @returns Formatted time string (e.g., \"5m 30s\")\r\n   */\r\n  formatTimeRemaining(secondsRemaining: number): string {\r\n    const hours = Math.floor(secondsRemaining / 3600);\r\n    const minutes = Math.floor((secondsRemaining % 3600) / 60);\r\n    const seconds = secondsRemaining % 60;\r\n\r\n    if (hours > 0) {\r\n      return `${hours}h ${minutes}m ${seconds}s`;\r\n    } else if (minutes > 0) {\r\n      return `${minutes}m ${seconds}s`;\r\n    } else {\r\n      return `${seconds}s`;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if funding rate is favorable for trading\r\n   *\r\n   * @param fundingRate Funding rate as decimal\r\n   * @param minThreshold Minimum absolute threshold (default: 0.01%)\r\n   * @returns True if rate meets threshold\r\n   */\r\n  isFundingRateFavorable(fundingRate: number, minThreshold = 0.0001): boolean {\r\n    return Math.abs(fundingRate) >= minThreshold;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\services\\bybit-user.service.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'HttpHeaders' is defined but never used.","line":2,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'map' is defined but never used.","line":4,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":121,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2926,2929],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2926,2929],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":223,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":223,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4826,4829],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4826,4829],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":246,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":246,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5393,5396],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5393,5396],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":562,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":562,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":640,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":640,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":641,"column":7,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":641,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":641,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":641,"endColumn":33}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Injectable } from '@angular/core';\r\nimport { HttpClient, HttpHeaders, HttpErrorResponse } from '@angular/common/http';\r\nimport { Observable, throwError, BehaviorSubject } from 'rxjs';\r\nimport { catchError, map, tap } from 'rxjs/operators';\r\nimport { getEndpointUrl, buildUrlWithQuery } from '../config/app.config';\r\n\r\n/**\r\n * Bybit Account Information Interface\r\n */\r\nexport interface BybitAccountInfo {\r\n  totalEquity: string;\r\n  totalWalletBalance: string;\r\n  totalMarginBalance: string;\r\n  totalAvailableBalance: string;\r\n  totalPerpUPL: string;\r\n  totalInitialMargin: string;\r\n  totalMaintenanceMargin: string;\r\n  coin: BybitCoinBalance[];\r\n}\r\n\r\n/**\r\n * Individual coin balance in account\r\n */\r\nexport interface BybitCoinBalance {\r\n  coin: string;\r\n  equity: string;\r\n  usdValue: string;\r\n  walletBalance: string;\r\n  availableToWithdraw: string;\r\n  availableToBorrow: string;\r\n  borrowAmount: string;\r\n  accruedInterest: string;\r\n  totalOrderIM: string;\r\n  totalPositionIM: string;\r\n  totalPositionMM: string;\r\n  unrealisedPnl: string;\r\n  cumRealisedPnl: string;\r\n}\r\n\r\n/**\r\n * Bybit Wallet Balance Information\r\n */\r\nexport interface BybitWalletBalance {\r\n  accountType: string;\r\n  accountIMRate: string;\r\n  accountMMRate: string;\r\n  totalEquity: string;\r\n  totalWalletBalance: string;\r\n  totalMarginBalance: string;\r\n  totalAvailableBalance: string;\r\n  totalPerpUPL: string;\r\n  totalInitialMargin: string;\r\n  totalMaintenanceMargin: string;\r\n  accountLTV: string;\r\n  coin: BybitCoinBalance[];\r\n}\r\n\r\n/**\r\n * Bybit Position Information\r\n */\r\nexport interface BybitPosition {\r\n  symbol: string;\r\n  side: 'Buy' | 'Sell' | 'None';\r\n  size: string;\r\n  positionValue: string;\r\n  entryPrice: string;\r\n  markPrice: string;\r\n  liqPrice: string;\r\n  bustPrice: string;\r\n  positionMM: string;\r\n  positionIM: string;\r\n  tpslMode: string;\r\n  takeProfit: string;\r\n  stopLoss: string;\r\n  trailingStop: string;\r\n  unrealisedPnl: string;\r\n  cumRealisedPnl: string;\r\n  createdTime: string;\r\n  updatedTime: string;\r\n  leverage: string;\r\n}\r\n\r\n/**\r\n * Bybit Order Information\r\n */\r\nexport interface BybitOrder {\r\n  orderId: string;\r\n  orderLinkId: string;\r\n  symbol: string;\r\n  side: 'Buy' | 'Sell';\r\n  orderType: string;\r\n  qty: string;\r\n  price: string;\r\n  orderStatus: string;\r\n  timeInForce: string;\r\n  createdTime: string;\r\n  updatedTime: string;\r\n  avgPrice: string;\r\n  cumExecQty: string;\r\n  cumExecValue: string;\r\n  cumExecFee: string;\r\n}\r\n\r\n/**\r\n * Complete Bybit User Information Response\r\n */\r\nexport interface BybitUserInfo {\r\n  success: boolean;\r\n  timestamp: string;\r\n  testnet: boolean;\r\n  data: {\r\n    accountInfo: BybitAccountInfo | { error: string };\r\n    walletBalance: {\r\n      list: BybitWalletBalance[];\r\n    } | { error: string };\r\n    positions: BybitPosition[];\r\n    positionsCount: number;\r\n    activeOrders: BybitOrder[];\r\n    activeOrdersCount: number;\r\n    orderHistory: BybitOrder[];\r\n    marketReference: any;\r\n  };\r\n}\r\n\r\n/**\r\n * API Credentials Test Request\r\n */\r\nexport interface BybitCredentialsTest {\r\n  apiKey: string;\r\n  apiSecret: string;\r\n  testnet?: boolean;\r\n}\r\n\r\n/**\r\n * API Credentials Test Response\r\n */\r\nexport interface BybitCredentialsTestResponse {\r\n  success: boolean;\r\n  message: string;\r\n  testnet: boolean;\r\n  accountPreview?: {\r\n    totalEquity: string;\r\n    totalWalletBalance: string;\r\n    totalAvailableBalance: string;\r\n  };\r\n  timestamp: string;\r\n}\r\n\r\n/**\r\n * Stored API Keys Response\r\n */\r\nexport interface BybitStoredApiKeysResponse {\r\n  success: boolean;\r\n  data: {\r\n    hasKeys: boolean;\r\n    testnet: boolean;\r\n    apiKeyPreview: string;\r\n    createdAt?: string;\r\n    updatedAt?: string;\r\n  };\r\n  timestamp: string;\r\n}\r\n\r\n/**\r\n * API Keys Save Request\r\n */\r\nexport interface BybitSaveApiKeysRequest {\r\n  apiKey: string;\r\n  apiSecret: string;\r\n  testnet: boolean;\r\n}\r\n\r\n/**\r\n * API Keys Save Response\r\n */\r\nexport interface BybitSaveApiKeysResponse {\r\n  success: boolean;\r\n  message: string;\r\n}\r\n\r\n/**\r\n * Delete API Keys Response\r\n */\r\nexport interface BybitDeleteApiKeysResponse {\r\n  success: boolean;\r\n  message: string;\r\n}\r\n\r\n/**\r\n * Detailed Wallet Balance Response\r\n */\r\nexport interface BybitWalletBalanceResponse {\r\n  success: boolean;\r\n  data: {\r\n    list: {\r\n      accountType: string;\r\n      totalEquity: string;\r\n      totalWalletBalance: string;\r\n      totalAvailableBalance: string;\r\n      totalMarginBalance?: string;\r\n      coin: {\r\n        coin: string;\r\n        equity: string;\r\n        walletBalance: string;\r\n        availableToWithdraw: string;\r\n        locked: string;\r\n        usdValue: string;\r\n      }[];\r\n    }[];\r\n  };\r\n  accountType: string;\r\n  timestamp: string;\r\n}\r\n\r\n/**\r\n * Asset Information for a single coin\r\n */\r\nexport interface BybitAssetItem {\r\n  coin: string;\r\n  frozen: string;\r\n  free: string;\r\n  withdraw: string;\r\n  [key: string]: any; // Allow for additional fields from API\r\n}\r\n\r\n/**\r\n * Asset Information for an account type\r\n */\r\nexport interface BybitAccountAssetInfo {\r\n  status: string;\r\n  assets: BybitAssetItem[];\r\n}\r\n\r\n/**\r\n * Complete Asset Information Response\r\n */\r\nexport interface BybitAssetInfoResponse {\r\n  success: boolean;\r\n  data: {\r\n    spot?: BybitAccountAssetInfo;\r\n    contract?: BybitAccountAssetInfo;\r\n    unified?: BybitAccountAssetInfo;\r\n    investment?: BybitAccountAssetInfo;\r\n    option?: BybitAccountAssetInfo;\r\n    fund?: BybitAccountAssetInfo;\r\n    [key: string]: any; // Allow for dynamic account types\r\n  };\r\n  accountType?: string;\r\n  coin?: string;\r\n  testnet: boolean;\r\n  timestamp: string;\r\n}\r\n\r\n/**\r\n * Single coin balance in All Coins Balance response\r\n */\r\nexport interface BybitCoinBalanceItem {\r\n  coin: string;\r\n  transferBalance: string;\r\n  walletBalance: string;\r\n  bonus: string;\r\n}\r\n\r\n/**\r\n * All Coins Balance Response\r\n * Used for querying all coins in a specific account type (especially FUND)\r\n */\r\nexport interface BybitAllCoinsBalanceResponse {\r\n  success: boolean;\r\n  data: {\r\n    memberId: string;\r\n    accountType: string;\r\n    balance: BybitCoinBalanceItem[];\r\n  };\r\n  accountType: string;\r\n  coin?: string;\r\n  testnet: boolean;\r\n  timestamp: string;\r\n}\r\n\r\n/**\r\n * Bybit User Service\r\n *\r\n * Handles all Bybit user-related operations including:\r\n * - Fetching user account information\r\n * - Testing API credentials\r\n * - Managing account balance data\r\n * - Retrieving positions and orders\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class BybitUserService {\r\n  private userInfoSubject = new BehaviorSubject<BybitUserInfo | null>(null);\r\n  private loadingSubject = new BehaviorSubject<boolean>(false);\r\n  private errorSubject = new BehaviorSubject<string | null>(null);\r\n  private storedKeysSubject = new BehaviorSubject<BybitStoredApiKeysResponse | null>(null);\r\n\r\n  public readonly userInfo$ = this.userInfoSubject.asObservable();\r\n  public readonly loading$ = this.loadingSubject.asObservable();\r\n  public readonly error$ = this.errorSubject.asObservable();\r\n  public readonly storedKeys$ = this.storedKeysSubject.asObservable();\r\n\r\n  constructor(\r\n    private http: HttpClient\r\n  ) {\r\n    // Bybit User Service initialized\r\n  }\r\n\r\n  /**\r\n   * Get comprehensive Bybit user information using stored API keys\r\n   * This method now only works with stored credentials in the backend\r\n   * @returns Observable<BybitUserInfo>\r\n   */\r\n  getUserInfo(): Observable<BybitUserInfo> {\r\n    this.loadingSubject.next(true);\r\n    this.errorSubject.next(null);\r\n\r\n    const url = getEndpointUrl('bybit', 'userInfo');\r\n\r\n    return this.http.get<BybitUserInfo>(url).pipe(\r\n      tap(info => {\r\n        this.userInfoSubject.next(info);\r\n        this.loadingSubject.next(false);\r\n      }),\r\n      catchError(error => {\r\n        this.loadingSubject.next(false);\r\n        const errorMessage = this.handleError(error);\r\n        this.errorSubject.next(errorMessage);\r\n        return throwError(() => new Error(errorMessage));\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Refresh user information using stored API keys\r\n   */\r\n  refreshUserInfo(): Observable<BybitUserInfo> {\r\n    return this.getUserInfo();\r\n  }\r\n\r\n  /**\r\n   * Get current user info from cache (if available)\r\n   */\r\n  getCurrentUserInfo(): BybitUserInfo | null {\r\n    return this.userInfoSubject.value;\r\n  }\r\n\r\n  /**\r\n   * Clear cached user info\r\n   */\r\n  clearUserInfo(): void {\r\n    this.userInfoSubject.next(null);\r\n    this.errorSubject.next(null);\r\n  }\r\n\r\n  /**\r\n   * Check if user info is currently loading\r\n   */\r\n  isLoading(): boolean {\r\n    return this.loadingSubject.value;\r\n  }\r\n\r\n  /**\r\n   * Get current error (if any)\r\n   */\r\n  getCurrentError(): string | null {\r\n    return this.errorSubject.value;\r\n  }\r\n\r\n  /**\r\n   * Calculate total portfolio value in USD\r\n   */\r\n  calculateTotalValue(userInfo: BybitUserInfo): number {\r\n    if (!userInfo.success || !userInfo.data.accountInfo) {\r\n      return 0;\r\n    }\r\n\r\n    const accountInfo = userInfo.data.accountInfo;\r\n    if ('error' in accountInfo) {\r\n      return 0;\r\n    }\r\n\r\n    return parseFloat(accountInfo.totalEquity || '0');\r\n  }\r\n\r\n  /**\r\n   * Get all non-zero coin balances\r\n   */\r\n  getNonZeroBalances(userInfo: BybitUserInfo): BybitCoinBalance[] {\r\n    if (!userInfo.success || !userInfo.data.walletBalance) {\r\n      return [];\r\n    }\r\n\r\n    const walletBalance = userInfo.data.walletBalance;\r\n    if ('error' in walletBalance || !walletBalance.list || walletBalance.list.length === 0) {\r\n      return [];\r\n    }\r\n\r\n    const coins = walletBalance.list[0].coin || [];\r\n    return coins.filter(coin => parseFloat(coin.walletBalance) > 0);\r\n  }\r\n\r\n  /**\r\n   * Get active (non-zero) positions\r\n   */\r\n  getActivePositions(userInfo: BybitUserInfo): BybitPosition[] {\r\n    if (!userInfo.success || !userInfo.data.positions) {\r\n      return [];\r\n    }\r\n\r\n    return userInfo.data.positions.filter(\r\n      position => parseFloat(position.size) > 0 && position.side !== 'None'\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Calculate total unrealized PnL from positions\r\n   */\r\n  calculateUnrealizedPnl(userInfo: BybitUserInfo): number {\r\n    const activePositions = this.getActivePositions(userInfo);\r\n    return activePositions.reduce(\r\n      (total, position) => total + parseFloat(position.unrealisedPnl || '0'),\r\n      0\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Save API keys to the database\r\n   * This method now validates AND saves the keys in a single operation\r\n   * The backend tests the credentials before storing them\r\n   * @param apiKey - Bybit API key\r\n   * @param apiSecret - Bybit API secret\r\n   * @param testnet - Whether to use testnet\r\n   * @returns Observable<BybitSaveApiKeysResponse>\r\n   */\r\n  saveApiKeys(apiKey: string, apiSecret: string, testnet: boolean): Observable<BybitSaveApiKeysResponse> {\r\n    this.loadingSubject.next(true);\r\n    this.errorSubject.next(null);\r\n\r\n    const request: BybitSaveApiKeysRequest = {\r\n      apiKey,\r\n      apiSecret,\r\n      testnet\r\n    };\r\n\r\n    return this.http.post<BybitSaveApiKeysResponse>(\r\n      getEndpointUrl('bybit', 'apiKeys'),\r\n      request\r\n    ).pipe(\r\n      tap(response => {\r\n        this.loadingSubject.next(false);\r\n        if (response.success) {\r\n          // Update stored keys status\r\n          this.storedKeysSubject.next({\r\n            success: true,\r\n            data: {\r\n              hasKeys: true,\r\n              testnet,\r\n              apiKeyPreview: this.maskApiKey(apiKey)\r\n            },\r\n            timestamp: new Date().toISOString()\r\n          });\r\n        }\r\n      }),\r\n      catchError(error => {\r\n        this.loadingSubject.next(false);\r\n        const errorMessage = this.handleError(error);\r\n        this.errorSubject.next(errorMessage);\r\n        return throwError(() => new Error(errorMessage));\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get stored API keys information (without exposing actual keys)\r\n   * @returns Observable<BybitStoredApiKeysResponse>\r\n   */\r\n  getStoredApiKeys(): Observable<BybitStoredApiKeysResponse> {\r\n    this.loadingSubject.next(true);\r\n    this.errorSubject.next(null);\r\n\r\n    return this.http.get<BybitStoredApiKeysResponse>(\r\n      getEndpointUrl('bybit', 'storedApiKeys')\r\n    ).pipe(\r\n      tap(response => {\r\n        this.loadingSubject.next(false);\r\n        this.storedKeysSubject.next(response);\r\n      }),\r\n      catchError(error => {\r\n        this.loadingSubject.next(false);\r\n        const errorMessage = this.handleError(error);\r\n        this.errorSubject.next(errorMessage);\r\n        return throwError(() => new Error(errorMessage));\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Delete stored API keys from the database\r\n   * @returns Observable<BybitDeleteApiKeysResponse>\r\n   */\r\n  deleteApiKeys(): Observable<BybitDeleteApiKeysResponse> {\r\n    this.loadingSubject.next(true);\r\n    this.errorSubject.next(null);\r\n\r\n    return this.http.delete<BybitDeleteApiKeysResponse>(\r\n      getEndpointUrl('bybit', 'deleteApiKeys')\r\n    ).pipe(\r\n      tap(response => {\r\n        this.loadingSubject.next(false);\r\n        if (response.success) {\r\n          // Clear stored keys status\r\n          this.storedKeysSubject.next(null);\r\n          // Clear user info as well\r\n          this.userInfoSubject.next(null);\r\n        }\r\n      }),\r\n      catchError(error => {\r\n        this.loadingSubject.next(false);\r\n        const errorMessage = this.handleError(error);\r\n        this.errorSubject.next(errorMessage);\r\n        return throwError(() => new Error(errorMessage));\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get current stored keys status\r\n   */\r\n  getStoredKeysStatus(): BybitStoredApiKeysResponse | null {\r\n    return this.storedKeysSubject.value;\r\n  }\r\n\r\n  /**\r\n   * Check if user has stored API keys\r\n   */\r\n  hasStoredKeys(): boolean {\r\n    const storedKeys = this.storedKeysSubject.value;\r\n    return storedKeys?.data?.hasKeys ?? false;\r\n  }\r\n\r\n  /**\r\n   * Get detailed wallet balance from Bybit\r\n   * @param accountType - Account type (UNIFIED or CONTRACT)\r\n   * @param coin - Optional specific coin to query\r\n   * @returns Observable<BybitWalletBalanceResponse>\r\n   */\r\n  getWalletBalance(accountType: 'UNIFIED' | 'CONTRACT' = 'UNIFIED', coin?: string): Observable<BybitWalletBalanceResponse> {\r\n    const baseUrl = getEndpointUrl('bybit', 'walletBalance');\r\n    const params: Record<string, string> = {\r\n      accountType\r\n    };\r\n    if (coin) {\r\n      params['coin'] = coin;\r\n    }\r\n    const url = buildUrlWithQuery(baseUrl, params);\r\n\r\n    return this.http.get<BybitWalletBalanceResponse>(url).pipe(\r\n      catchError(error => {\r\n        console.error('Error fetching wallet balance:', error);\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get asset information from Bybit\r\n   * Retrieves detailed asset information for different account types\r\n   * @param accountType - Optional account type (SPOT, CONTRACT, UNIFIED, etc.)\r\n   * @param coin - Optional specific coin to query (BTC, ETH, USDT, etc.)\r\n   * @returns Observable<BybitAssetInfoResponse>\r\n   */\r\n  getAssetInfo(accountType?: string, coin?: string): Observable<BybitAssetInfoResponse> {\r\n    const baseUrl = getEndpointUrl('bybit', 'assetInfo');\r\n    const params: Record<string, string> = {};\r\n    if (accountType) {\r\n      params['accountType'] = accountType.toUpperCase();\r\n    }\r\n    if (coin) {\r\n      params['coin'] = coin.toUpperCase();\r\n    }\r\n    const url = buildUrlWithQuery(baseUrl, params);\r\n\r\n    return this.http.get<BybitAssetInfoResponse>(url).pipe(\r\n      catchError(error => {\r\n        console.error('Error fetching asset info:', error);\r\n        const errorMessage = this.handleError(error);\r\n        return throwError(() => new Error(errorMessage));\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get all coins balance from Bybit\r\n   * Retrieves comprehensive balance information for all coins in a specific account type.\r\n   * This endpoint can query the FUND (Funding wallet) where balances may be stored.\r\n   *\r\n   * @param accountType - Optional account type (UNIFIED, SPOT, CONTRACT, FUND, OPTION, etc.)\r\n   *                      Default: FUND (Funding wallet)\r\n   * @param coin - Optional specific coin to query (BTC, ETH, USDT, etc.)\r\n   * @returns Observable<BybitAllCoinsBalanceResponse>\r\n   */\r\n  getAllCoinsBalance(accountType?: string, coin?: string): Observable<BybitAllCoinsBalanceResponse> {\r\n    const baseUrl = getEndpointUrl('bybit', 'allCoinsBalance');\r\n    const params: Record<string, string> = {};\r\n    if (accountType) {\r\n      params['accountType'] = accountType.toUpperCase();\r\n    }\r\n    if (coin) {\r\n      params['coin'] = coin.toUpperCase();\r\n    }\r\n    const url = buildUrlWithQuery(baseUrl, params);\r\n\r\n    return this.http.get<BybitAllCoinsBalanceResponse>(url).pipe(\r\n      catchError(error => {\r\n        console.error('Error fetching all coins balance:', error);\r\n        const errorMessage = this.handleError(error);\r\n        return throwError(() => new Error(errorMessage));\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Mask API key for display (show only last 4 characters)\r\n   */\r\n  private maskApiKey(apiKey: string): string {\r\n    if (apiKey.length <= 4) {\r\n      return '****';\r\n    }\r\n    return '****' + apiKey.slice(-4);\r\n  }\r\n\r\n  /**\r\n   * Handle HTTP errors and return user-friendly messages\r\n   */\r\n  private handleError(error: HttpErrorResponse): string {\r\n    console.error('Bybit User Service Error:', error);\r\n\r\n    if (error.error?.message) {\r\n      return error.error.message;\r\n    }\r\n\r\n    if (error.status === 0) {\r\n      return 'Unable to connect to the server. Please check your internet connection.';\r\n    }\r\n\r\n    if (error.status === 401) {\r\n      return 'Invalid API credentials. Please check your Bybit API key and secret.';\r\n    }\r\n\r\n    if (error.status === 403) {\r\n      return 'Access forbidden. Please check your API key permissions.';\r\n    }\r\n\r\n    if (error.status === 429) {\r\n      return 'Too many requests. Please wait a moment and try again.';\r\n    }\r\n\r\n    if (error.status >= 500) {\r\n      return 'Server error. Please try again later.';\r\n    }\r\n\r\n    return error.message || 'An unexpected error occurred. Please try again.';\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\services\\bybit-websocket.service.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'retry' is defined but never used.","line":4,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'map' is defined but never used.","line":4,"column":40,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":43},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":144,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4000,4003],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4000,4003],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":158,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":158,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4557,4560],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4557,4560],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":159,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":159,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4605,4608],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4605,4608],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":407,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":407,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12234,12237],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12234,12237],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .op on an `any` value.","line":410,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":410,"endColumn":21},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .success on an `any` value.","line":416,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":416,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .success on an `any` value.","line":417,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":417,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .conn_id on an `any` value.","line":419,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":419,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .conn_id on an `any` value.","line":420,"column":54,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":420,"endColumn":61},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .topic on an `any` value.","line":429,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":429,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":429,"column":36,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":429,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":431,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":431,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .topic on an `any` value.","line":431,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":431,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":432,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":432,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .type on an `any` value.","line":432,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":432,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":433,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":433,"endColumn":76},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":433,"column":45,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":433,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":433,"column":61,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":433,"endColumn":65},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":434,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":434,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .ts on an `any` value.","line":434,"column":30,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":434,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":437,"column":13,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":437,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .topic on an `any` value.","line":437,"column":21,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":437,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":438,"column":98,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":438,"endColumn":102},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":440,"column":20,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":440,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .topic on an `any` value.","line":440,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":440,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":442,"column":20,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":442,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .topic on an `any` value.","line":442,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":442,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":444,"column":20,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":444,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .topic on an `any` value.","line":444,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":444,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .topic on an `any` value.","line":447,"column":52,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":447,"endColumn":57},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .type on an `any` value.","line":449,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":449,"endColumn":30},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":493,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":493,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15504,15507],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15504,15507],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .start on an `any` value.","line":495,"column":38,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":495,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .open on an `any` value.","line":496,"column":38,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":496,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .high on an `any` value.","line":497,"column":38,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":497,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .low on an `any` value.","line":498,"column":37,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":498,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .close on an `any` value.","line":499,"column":39,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":499,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .volume on an `any` value.","line":500,"column":40,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":500,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":510,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":510,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .confirm on an `any` value.","line":510,"column":32,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":510,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of type `Observable<any>` from function with return type `Observable<TickerData>`.","line":599,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturnAssignment","endLine":599,"endColumn":68},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of type `Observable<any>` from function with return type `Observable<OrderbookData>`.","line":626,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturnAssignment","endLine":626,"endColumn":68},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of type `Observable<any>` from function with return type `Observable<TradeData>`.","line":653,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturnAssignment","endLine":653,"endColumn":68},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":676,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":676,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20899,20902],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20899,20902],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":680,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":680,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":680,"column":25,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":680,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .lastPrice on an `any` value.","line":681,"column":39,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":681,"endColumn":48},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .highPrice24h on an `any` value.","line":682,"column":42,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":682,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .lowPrice24h on an `any` value.","line":683,"column":41,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":683,"endColumn":52},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .prevPrice24h on an `any` value.","line":684,"column":42,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":684,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .volume24h on an `any` value.","line":685,"column":39,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":685,"endColumn":48},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .turnover24h on an `any` value.","line":686,"column":41,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":686,"endColumn":52},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .price24hPcnt on an `any` value.","line":687,"column":42,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":687,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .usdIndexPrice on an `any` value.","line":688,"column":43,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":688,"endColumn":56},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":776,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":776,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24293,24296],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24293,24296],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":778,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":778,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":778,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":778,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":779,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":779,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .execId on an `any` value.","line":779,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":779,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .price on an `any` value.","line":780,"column":38,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":780,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .size on an `any` value.","line":781,"column":37,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":781,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":782,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":782,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .side on an `any` value.","line":782,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":782,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":783,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":783,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .time on an `any` value.","line":783,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":783,"endColumn":35},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":784,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":784,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .isBlockTrade on an `any` value.","line":784,"column":34,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":784,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .execId on an `any` value.","line":787,"column":59,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":787,"endColumn":65},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":858,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":858,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26555,26558],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26555,26558],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":71,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Injectable, OnDestroy } from '@angular/core';\r\nimport { BehaviorSubject, Observable, Subject, timer, EMPTY, Subscription } from 'rxjs';\r\nimport { webSocket, WebSocketSubject } from 'rxjs/webSocket';\r\nimport { catchError, retry, takeUntil, map, filter } from 'rxjs/operators';\r\n\r\n/**\r\n * Bybit WebSocket V5 kline/candlestick data structure\r\n * Raw format received from WebSocket stream\r\n */\r\nexport interface BybitWsKlineData {\r\n  start: number; // Bybit V5 uses 'start' for the candle start time (milliseconds)\r\n  end: number;   // Bybit V5 uses 'end' for the candle end time (milliseconds)\r\n  interval: string;\r\n  open: string;\r\n  close: string;\r\n  high: string;\r\n  low: string;\r\n  volume: string;\r\n  turnover: string;\r\n  confirm: boolean; // true means this kline is closed\r\n  timestamp: number; // Message timestamp\r\n}\r\n\r\nexport interface BybitWsTickerData {\r\n  symbol: string;\r\n  lastPrice: string;\r\n  highPrice24h: string;\r\n  lowPrice24h: string;\r\n  prevPrice24h: string;\r\n  volume24h: string;\r\n  turnover24h: string;\r\n  price24hPcnt: string;\r\n  usdIndexPrice: string;\r\n}\r\n\r\nexport interface BybitWsOrderbookData {\r\n  symbol: string;\r\n  bids: [string, string][]; // [price, size]\r\n  asks: [string, string][]; // [price, size]\r\n  ts: number;\r\n  u: number; // update id\r\n}\r\n\r\nexport interface BybitWsTradeData {\r\n  symbol: string;\r\n  execId: string;\r\n  price: string;\r\n  size: string;\r\n  side: 'Buy' | 'Sell';\r\n  time: number;\r\n  isBlockTrade: boolean;\r\n}\r\n\r\nexport interface BybitWsMessage {\r\n  topic: string;\r\n  type: string;\r\n  data: BybitWsKlineData[] | BybitWsTickerData[] | BybitWsOrderbookData | BybitWsTradeData[];\r\n  cs: number;\r\n  ts: number;\r\n}\r\n\r\nexport interface CandlestickData {\r\n  time: number;\r\n  open: number;\r\n  high: number;\r\n  low: number;\r\n  close: number;\r\n  volume?: number;\r\n}\r\n\r\nexport interface TickerData {\r\n  symbol: string;\r\n  lastPrice: number;\r\n  highPrice24h: number;\r\n  lowPrice24h: number;\r\n  prevPrice24h: number;\r\n  volume24h: number;\r\n  turnover24h: number;\r\n  price24hPcnt: number;\r\n  usdIndexPrice: number;\r\n  timestamp: number;\r\n}\r\n\r\nexport interface OrderbookData {\r\n  symbol: string;\r\n  bids: { price: number; size: number }[];\r\n  asks: { price: number; size: number }[];\r\n  timestamp: number;\r\n}\r\n\r\nexport interface TradeData {\r\n  symbol: string;\r\n  execId: string;\r\n  price: number;\r\n  size: number;\r\n  side: 'Buy' | 'Sell';\r\n  timestamp: number;\r\n  isBlockTrade: boolean;\r\n}\r\n\r\n/**\r\n * Bybit WebSocket Service - Low-level WebSocket connection manager\r\n *\r\n * This service manages the WebSocket connection to Bybit V5 public API, handling:\r\n * - Connection lifecycle (connect, disconnect, reconnect)\r\n * - Subscription management for multiple data streams\r\n * - Message routing and transformation\r\n * - Heartbeat/ping mechanism to keep connection alive\r\n * - Auto-reconnection on connection failure\r\n * - Data caching for latest values\r\n *\r\n * The service maintains a single WebSocket connection and multiplexes multiple\r\n * subscriptions through it, providing separate Observable streams for each subscription.\r\n *\r\n * @example\r\n * ```typescript\r\n * // Subscribe to kline data\r\n * this.wsService.subscribeToKline('BTCUSDT', '1').subscribe(candle => {\r\n *   console.log('New candle:', candle);\r\n * });\r\n *\r\n * // Check connection state\r\n * this.wsService.getConnectionState().subscribe(state => {\r\n *   console.log('Connection state:', state);\r\n * });\r\n *\r\n * // Clean up on destroy\r\n * this.wsService.unsubscribeFromKline('BTCUSDT', '1');\r\n * ```\r\n *\r\n * @see {@link BybitService} for high-level API combining REST and WebSocket\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class BybitWebSocketService implements OnDestroy {\r\n  // WebSocket URLs for different environments\r\n  private readonly WS_URLS = {\r\n    mainnet: 'wss://stream.bybit.com/v5/public/spot',\r\n    testnet: 'wss://stream-testnet.bybit.com/v5/public/spot'\r\n  };\r\n\r\n  private currentEnvironment: 'mainnet' | 'testnet' = 'mainnet';\r\n  private socket$: WebSocketSubject<any> | null = null;\r\n  private destroy$ = new Subject<void>();\r\n  private pingTimer?: Subscription;\r\n\r\n  // Connection state\r\n  private connectionState$ = new BehaviorSubject<'disconnected' | 'connecting' | 'connected'>('disconnected');\r\n\r\n  // Data streams\r\n  private klineData$ = new Subject<CandlestickData>();\r\n  private tickerData$ = new Subject<TickerData>();\r\n  private orderbookData$ = new Subject<OrderbookData>();\r\n  private tradeData$ = new Subject<TradeData>();\r\n\r\n  // Subscription management\r\n  private subscriptions = new Map<string, Subject<any>>();\r\n  private dataCache = new Map<string, any>(); // Cache latest data for each stream\r\n\r\n  constructor() {\r\n    console.log('BybitWebSocketService initialized');\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.stopPing();\r\n    this.disconnect();\r\n    this.destroy$.next();\r\n    this.destroy$.complete();\r\n  }\r\n\r\n  /**\r\n   * Get connection state as observable\r\n   */\r\n  getConnectionState(): Observable<'disconnected' | 'connecting' | 'connected'> {\r\n    return this.connectionState$.asObservable();\r\n  }\r\n\r\n  /**\r\n   * Set WebSocket environment (mainnet or testnet)\r\n   * Will disconnect and reconnect if already connected\r\n   */\r\n  setEnvironment(environment: 'MAINNET' | 'TESTNET'): void {\r\n    const normalizedEnv = environment.toLowerCase() as 'mainnet' | 'testnet';\r\n\r\n    if (this.currentEnvironment === normalizedEnv) {\r\n      console.log(`Already using ${normalizedEnv} WebSocket`);\r\n      return;\r\n    }\r\n\r\n    console.log(`Switching WebSocket from ${this.currentEnvironment} to ${normalizedEnv}`);\r\n    this.currentEnvironment = normalizedEnv;\r\n\r\n    // If currently connected, disconnect and reconnect with new environment\r\n    if (this.socket$ && !this.socket$.closed) {\r\n      const activeSubscriptions = this.getActiveSubscriptions();\r\n      console.log('Reconnecting with active subscriptions:', activeSubscriptions);\r\n\r\n      this.disconnect();\r\n\r\n      // Give a moment for clean disconnect\r\n      setTimeout(() => {\r\n        this.connect();\r\n      }, 500);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get current environment\r\n   */\r\n  getCurrentEnvironment(): 'mainnet' | 'testnet' {\r\n    return this.currentEnvironment;\r\n  }\r\n\r\n  /**\r\n   * Connect to Bybit WebSocket\r\n   */\r\n  private connect(): void {\r\n    if (this.socket$ && !this.socket$.closed) {\r\n      console.log('WebSocket already connected');\r\n      return;\r\n    }\r\n\r\n    const wsUrl = this.WS_URLS[this.currentEnvironment];\r\n    console.log(`Connecting to Bybit WebSocket (${this.currentEnvironment}):`, wsUrl);\r\n    this.connectionState$.next('connecting');\r\n\r\n    this.socket$ = webSocket({\r\n      url: wsUrl,\r\n      openObserver: {\r\n        next: () => {\r\n          console.log(`‚úÖ Connected to Bybit V5 WebSocket (${this.currentEnvironment}):`, wsUrl);\r\n          this.connectionState$.next('connected');\r\n          this.startPing(); // Start ping immediately after connection\r\n        }\r\n      },\r\n      closeObserver: {\r\n        next: (event) => {\r\n          console.log('‚ùå Disconnected from Bybit WebSocket:', event);\r\n          this.connectionState$.next('disconnected');\r\n        }\r\n      }\r\n    });\r\n\r\n    // Handle incoming messages\r\n    this.socket$.pipe(\r\n      takeUntil(this.destroy$),\r\n      catchError(error => {\r\n        console.error('WebSocket error:', error);\r\n        this.connectionState$.next('disconnected');\r\n\r\n        // Auto-reconnect after 5 seconds\r\n        timer(5000).pipe(takeUntil(this.destroy$)).subscribe(() => {\r\n          console.log('Attempting to reconnect...');\r\n          this.connect();\r\n        });\r\n\r\n        return EMPTY;\r\n      })\r\n    ).subscribe((message: BybitWsMessage) => {\r\n      this.handleMessage(message);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Disconnect from WebSocket\r\n   */\r\n  disconnect(): void {\r\n    this.stopPing();\r\n    if (this.socket$) {\r\n      this.socket$.complete();\r\n      this.socket$ = null;\r\n    }\r\n    this.subscriptions.clear();\r\n    this.connectionState$.next('disconnected');\r\n    console.log('üîå WebSocket disconnected');\r\n  }\r\n\r\n  /**\r\n   * Subscribe to kline data for a specific symbol and interval\r\n   */\r\n  subscribeToKline(symbol: string, interval = '1'): Observable<CandlestickData> {\r\n    const topic = `kline.${interval}.${symbol}`;\r\n    const subscriptionKey = `${symbol}_${interval}`;\r\n\r\n    console.log(`[WS SERVICE] subscribeToKline called - topic: ${topic}, key: ${subscriptionKey}`);\r\n\r\n    // Create or get existing subject for this subscription\r\n    if (!this.subscriptions.has(subscriptionKey)) {\r\n      console.log(`[WS SERVICE] Creating new Subject for ${subscriptionKey}`);\r\n      this.subscriptions.set(subscriptionKey, new Subject<CandlestickData>());\r\n    } else {\r\n      console.log(`[WS SERVICE] Reusing existing Subject for ${subscriptionKey}`);\r\n    }\r\n\r\n    // Connect if not already connected\r\n    if (!this.socket$ || this.socket$.closed) {\r\n      console.log('[WS SERVICE] WebSocket not connected, initiating connection...');\r\n      this.connect();\r\n    } else {\r\n      console.log('[WS SERVICE] WebSocket already connected');\r\n    }\r\n\r\n    // Wait for connection and then subscribe\r\n    console.log('[WS SERVICE] Setting up connection state listener...');\r\n    this.connectionState$.pipe(\r\n      filter(state => {\r\n        console.log(`[WS SERVICE] Connection state changed: ${state}`);\r\n        return state === 'connected';\r\n      }),\r\n      takeUntil(this.destroy$)\r\n    ).subscribe(() => {\r\n      console.log(`[WS SERVICE] Connection established, sending subscription for ${topic}`);\r\n      this.sendSubscription(topic);\r\n    });\r\n\r\n    const observable = this.subscriptions.get(subscriptionKey)!.asObservable();\r\n    console.log(`[WS SERVICE] Returning observable for ${subscriptionKey}`);\r\n\r\n    // Add logging to the returned observable\r\n    return new Observable<CandlestickData>(observer => {\r\n      console.log(`[WS SERVICE] Observer subscribed to ${subscriptionKey}`);\r\n\r\n      const subscription = observable.subscribe({\r\n        next: (value) => {\r\n          console.log(`[WS SERVICE] Passing data through observable for ${subscriptionKey}:`, value);\r\n          observer.next(value);\r\n        },\r\n        error: (err) => {\r\n          console.error(`[WS SERVICE] Error in observable for ${subscriptionKey}:`, err);\r\n          observer.error(err);\r\n        },\r\n        complete: () => {\r\n          console.log(`[WS SERVICE] Observable completed for ${subscriptionKey}`);\r\n          observer.complete();\r\n        }\r\n      });\r\n\r\n      return () => {\r\n        console.log(`[WS SERVICE] Observer unsubscribed from ${subscriptionKey}`);\r\n        subscription.unsubscribe();\r\n      };\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe from kline data\r\n   */\r\n  unsubscribeFromKline(symbol: string, interval = '1'): void {\r\n    const topic = `kline.${interval}.${symbol}`;\r\n    const subscriptionKey = `${symbol}_${interval}`;\r\n\r\n    console.log(`Unsubscribing from kline data: ${topic}`);\r\n\r\n    // Send unsubscribe message\r\n    if (this.socket$ && !this.socket$.closed) {\r\n      this.sendUnsubscription(topic);\r\n    }\r\n\r\n    // Clean up subscription\r\n    const subject = this.subscriptions.get(subscriptionKey);\r\n    if (subject) {\r\n      subject.complete();\r\n      this.subscriptions.delete(subscriptionKey);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Send subscription message\r\n   */\r\n  private sendSubscription(topic: string): void {\r\n    if (!this.socket$ || this.socket$.closed) {\r\n      console.error('Cannot subscribe: WebSocket not connected');\r\n      return;\r\n    }\r\n\r\n    const subscribeMessage = {\r\n      op: 'subscribe',\r\n      args: [topic]\r\n    };\r\n\r\n    console.log('Sending subscription:', subscribeMessage);\r\n    this.socket$.next(subscribeMessage);\r\n  }\r\n\r\n  /**\r\n   * Send unsubscription message\r\n   */\r\n  private sendUnsubscription(topic: string): void {\r\n    if (!this.socket$ || this.socket$.closed) {\r\n      console.error('Cannot unsubscribe: WebSocket not connected');\r\n      return;\r\n    }\r\n\r\n    const unsubscribeMessage = {\r\n      op: 'unsubscribe',\r\n      args: [topic]\r\n    };\r\n\r\n    console.log('Sending unsubscription:', unsubscribeMessage);\r\n    this.socket$.next(unsubscribeMessage);\r\n  }\r\n\r\n  /**\r\n   * Handle incoming WebSocket messages (Bybit V5 format)\r\n   */\r\n  private handleMessage(message: any): void {\r\n    try {\r\n      // Handle pong responses\r\n      if (message.op === 'pong') {\r\n        console.log('üèì Received pong from Bybit WebSocket');\r\n        return;\r\n      }\r\n\r\n      // Handle subscription confirmations\r\n      if (message.success !== undefined) {\r\n        if (message.success) {\r\n          console.log('‚úÖ Subscription confirmed:', message);\r\n          if (message.conn_id) {\r\n            console.log('üì° Connection ID:', message.conn_id);\r\n          }\r\n        } else {\r\n          console.error('‚ùå Subscription failed:', message);\r\n        }\r\n        return;\r\n      }\r\n\r\n      // Handle data updates by topic\r\n      if (message.topic && message.data) {\r\n        console.log('[WS SERVICE] Received data message:', {\r\n          topic: message.topic,\r\n          type: message.type,\r\n          dataLength: Array.isArray(message.data) ? message.data.length : 1,\r\n          timestamp: message.ts\r\n        });\r\n\r\n        if (message.topic.startsWith('kline.')) {\r\n          console.log('[WS SERVICE] Routing to kline handler, raw data:', JSON.stringify(message.data).substring(0, 500));\r\n          this.handleKlineData(message);\r\n        } else if (message.topic.startsWith('tickers.')) {\r\n          this.handleTickerData(message);\r\n        } else if (message.topic.startsWith('orderbook.')) {\r\n          this.handleOrderbookData(message);\r\n        } else if (message.topic.startsWith('publicTrade.')) {\r\n          this.handleTradeData(message);\r\n        } else {\r\n          console.log('üì® Unknown topic:', message.topic, message);\r\n        }\r\n      } else if (message.type === 'error') {\r\n        console.error('‚ùå WebSocket error message:', message);\r\n      } else {\r\n        console.log('üì® Received message:', message);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error handling WebSocket message:', error, message);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle kline data from WebSocket\r\n   */\r\n  private handleKlineData(message: BybitWsMessage): void {\r\n    try {\r\n      console.log('[WS SERVICE] Received kline message:', message.topic);\r\n\r\n      const topicParts = message.topic.split('.');\r\n      if (topicParts.length < 3) {\r\n        console.error('[WS SERVICE] Invalid kline topic format:', message.topic);\r\n        return;\r\n      }\r\n\r\n      const interval = topicParts[1];\r\n      const symbol = topicParts[2];\r\n      const subscriptionKey = `${symbol}_${interval}`;\r\n\r\n      console.log(`[WS SERVICE] Looking for subscription: ${subscriptionKey}`);\r\n      console.log('[WS SERVICE] Active subscriptions:', Array.from(this.subscriptions.keys()));\r\n\r\n      // Find the subscription subject\r\n      const subject = this.subscriptions.get(subscriptionKey);\r\n      if (!subject) {\r\n        console.warn(`[WS SERVICE] No subscription found for ${subscriptionKey}`);\r\n        console.warn('[WS SERVICE] Available subscriptions:', this.getActiveSubscriptions());\r\n        return;\r\n      }\r\n\r\n      console.log(`[WS SERVICE] Found subject for ${subscriptionKey}, processing data...`);\r\n\r\n      // Process each kline data point\r\n      const klineDataArray = Array.isArray(message.data) ? message.data : [message.data];\r\n      console.log(`[WS SERVICE] Processing ${klineDataArray.length} kline data points`);\r\n\r\n      klineDataArray.forEach((klineData: any) => {\r\n        const candlestick: CandlestickData = {\r\n          time: Math.floor(klineData.start / 1000), // Use start time, not closeTime\r\n          open: parseFloat(klineData.open),\r\n          high: parseFloat(klineData.high),\r\n          low: parseFloat(klineData.low),\r\n          close: parseFloat(klineData.close),\r\n          volume: parseFloat(klineData.volume)\r\n        };\r\n\r\n        console.log(`[WS SERVICE] Emitting kline update for ${symbol} (${interval}):`, {\r\n          time: new Date(candlestick.time * 1000).toISOString(),\r\n          open: candlestick.open,\r\n          high: candlestick.high,\r\n          low: candlestick.low,\r\n          close: candlestick.close,\r\n          volume: candlestick.volume,\r\n          confirmed: klineData.confirm\r\n        });\r\n\r\n        console.log(`[WS SERVICE] Calling subject.next() for ${subscriptionKey}`);\r\n        subject.next(candlestick);\r\n        console.log(`[WS SERVICE] subject.next() completed for ${subscriptionKey}`);\r\n      });\r\n    } catch (error) {\r\n      console.error('[WS SERVICE] Error processing kline data:', error, message);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get list of active subscriptions\r\n   */\r\n  getActiveSubscriptions(): string[] {\r\n    return Array.from(this.subscriptions.keys());\r\n  }\r\n\r\n  /**\r\n   * Check if WebSocket is connected\r\n   */\r\n  isConnected(): boolean {\r\n    return this.connectionState$.value === 'connected';\r\n  }\r\n\r\n  /**\r\n   * Ping to keep connection alive (Bybit V5 format)\r\n   */\r\n  private ping(): void {\r\n    if (this.socket$ && !this.socket$.closed) {\r\n      this.socket$.next({ op: 'ping' });\r\n      console.log('üèì Sent ping to Bybit WebSocket');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start periodic ping to keep connection alive (Bybit V5 requires ping every 20s)\r\n   */\r\n  private startPing(): void {\r\n    // Clear any existing ping timer\r\n    if (this.pingTimer) {\r\n      this.pingTimer.unsubscribe();\r\n    }\r\n\r\n    // Start pinging every 20 seconds as per Bybit documentation\r\n    this.pingTimer = timer(20000, 20000) // First ping after 20s, then every 20s\r\n      .pipe(takeUntil(this.destroy$))\r\n      .subscribe(() => {\r\n        if (this.isConnected()) {\r\n          this.ping();\r\n        }\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Stop ping timer\r\n   */\r\n  private stopPing(): void {\r\n    if (this.pingTimer) {\r\n      this.pingTimer.unsubscribe();\r\n      this.pingTimer = undefined;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Subscribe to ticker data for a specific symbol (Bybit V5 format)\r\n   */\r\n  subscribeToTicker(symbol: string): Observable<TickerData> {\r\n    const topic = `tickers.${symbol}`;\r\n    const subscriptionKey = `ticker_${symbol}`;\r\n\r\n    console.log(`üìä Subscribing to ticker data: ${topic}`);\r\n\r\n    if (!this.subscriptions.has(subscriptionKey)) {\r\n      this.subscriptions.set(subscriptionKey, new Subject<TickerData>());\r\n    }\r\n\r\n    if (!this.socket$ || this.socket$.closed) {\r\n      this.connect();\r\n    }\r\n\r\n    this.connectionState$.pipe(\r\n      filter(state => state === 'connected'),\r\n      takeUntil(this.destroy$)\r\n    ).subscribe(() => {\r\n      this.sendSubscription(topic);\r\n    });\r\n\r\n    return this.subscriptions.get(subscriptionKey)!.asObservable();\r\n  }\r\n\r\n  /**\r\n   * Subscribe to orderbook data for a specific symbol (Bybit V5 format)\r\n   */\r\n  subscribeToOrderbook(symbol: string, depth = 50): Observable<OrderbookData> {\r\n    const topic = `orderbook.${depth}.${symbol}`;\r\n    const subscriptionKey = `orderbook_${symbol}_${depth}`;\r\n\r\n    console.log(`üìà Subscribing to orderbook data: ${topic}`);\r\n\r\n    if (!this.subscriptions.has(subscriptionKey)) {\r\n      this.subscriptions.set(subscriptionKey, new Subject<OrderbookData>());\r\n    }\r\n\r\n    if (!this.socket$ || this.socket$.closed) {\r\n      this.connect();\r\n    }\r\n\r\n    this.connectionState$.pipe(\r\n      filter(state => state === 'connected'),\r\n      takeUntil(this.destroy$)\r\n    ).subscribe(() => {\r\n      this.sendSubscription(topic);\r\n    });\r\n\r\n    return this.subscriptions.get(subscriptionKey)!.asObservable();\r\n  }\r\n\r\n  /**\r\n   * Subscribe to trade data for a specific symbol (Bybit V5 format)\r\n   */\r\n  subscribeToTrades(symbol: string): Observable<TradeData> {\r\n    const topic = `publicTrade.${symbol}`;\r\n    const subscriptionKey = `trades_${symbol}`;\r\n\r\n    console.log(`üí∞ Subscribing to trade data: ${topic}`);\r\n\r\n    if (!this.subscriptions.has(subscriptionKey)) {\r\n      this.subscriptions.set(subscriptionKey, new Subject<TradeData>());\r\n    }\r\n\r\n    if (!this.socket$ || this.socket$.closed) {\r\n      this.connect();\r\n    }\r\n\r\n    this.connectionState$.pipe(\r\n      filter(state => state === 'connected'),\r\n      takeUntil(this.destroy$)\r\n    ).subscribe(() => {\r\n      this.sendSubscription(topic);\r\n    });\r\n\r\n    return this.subscriptions.get(subscriptionKey)!.asObservable();\r\n  }\r\n\r\n  /**\r\n   * Handle ticker data from WebSocket\r\n   */\r\n  private handleTickerData(message: BybitWsMessage): void {\r\n    try {\r\n      const topicParts = message.topic.split('.');\r\n      if (topicParts.length < 2) {\r\n        console.error('Invalid ticker topic format:', message.topic);\r\n        return;\r\n      }\r\n\r\n      const symbol = topicParts[1];\r\n      const subscriptionKey = `ticker_${symbol}`;\r\n      const subject = this.subscriptions.get(subscriptionKey);\r\n\r\n      if (!subject) {\r\n        console.warn(`No ticker subscription found for ${subscriptionKey}`);\r\n        return;\r\n      }\r\n\r\n      const rawData: any = Array.isArray(message.data) ? message.data[0] : message.data;\r\n      if (!rawData) return;\r\n\r\n      const tickerData: TickerData = {\r\n        symbol: rawData.symbol || symbol,\r\n        lastPrice: parseFloat(rawData.lastPrice || '0'),\r\n        highPrice24h: parseFloat(rawData.highPrice24h || '0'),\r\n        lowPrice24h: parseFloat(rawData.lowPrice24h || '0'),\r\n        prevPrice24h: parseFloat(rawData.prevPrice24h || '0'),\r\n        volume24h: parseFloat(rawData.volume24h || '0'),\r\n        turnover24h: parseFloat(rawData.turnover24h || '0'),\r\n        price24hPcnt: parseFloat(rawData.price24hPcnt || '0'),\r\n        usdIndexPrice: parseFloat(rawData.usdIndexPrice || '0'),\r\n        timestamp: message.ts\r\n      };\r\n\r\n      this.dataCache.set(subscriptionKey, tickerData);\r\n      subject.next(tickerData);\r\n\r\n      console.log(`üìà Ticker update for ${symbol}:`, {\r\n        lastPrice: tickerData.lastPrice,\r\n        change24h: tickerData.price24hPcnt\r\n      });\r\n    } catch (error) {\r\n      console.error('Error processing ticker data:', error, message);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle orderbook data from WebSocket\r\n   */\r\n  private handleOrderbookData(message: BybitWsMessage): void {\r\n    try {\r\n      const topicParts = message.topic.split('.');\r\n      if (topicParts.length < 3) {\r\n        console.error('Invalid orderbook topic format:', message.topic);\r\n        return;\r\n      }\r\n\r\n      const depth = topicParts[1];\r\n      const symbol = topicParts[2];\r\n      const subscriptionKey = `orderbook_${symbol}_${depth}`;\r\n      const subject = this.subscriptions.get(subscriptionKey);\r\n\r\n      if (!subject) {\r\n        console.warn(`No orderbook subscription found for ${subscriptionKey}`);\r\n        return;\r\n      }\r\n\r\n      const rawData = message.data as BybitWsOrderbookData;\r\n      if (!rawData) return;\r\n\r\n      const orderbookData: OrderbookData = {\r\n        symbol: rawData.symbol,\r\n        bids: rawData.bids.map(([price, size]) => ({\r\n          price: parseFloat(price),\r\n          size: parseFloat(size)\r\n        })),\r\n        asks: rawData.asks.map(([price, size]) => ({\r\n          price: parseFloat(price),\r\n          size: parseFloat(size)\r\n        })),\r\n        timestamp: rawData.ts\r\n      };\r\n\r\n      this.dataCache.set(subscriptionKey, orderbookData);\r\n      subject.next(orderbookData);\r\n\r\n      console.log(`üìä Orderbook update for ${symbol}:`, {\r\n        bestBid: orderbookData.bids[0]?.price,\r\n        bestAsk: orderbookData.asks[0]?.price,\r\n        spread: orderbookData.asks[0]?.price - orderbookData.bids[0]?.price\r\n      });\r\n    } catch (error) {\r\n      console.error('Error processing orderbook data:', error, message);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle trade data from WebSocket\r\n   */\r\n  private handleTradeData(message: BybitWsMessage): void {\r\n    try {\r\n      const topicParts = message.topic.split('.');\r\n      if (topicParts.length < 2) {\r\n        console.error('Invalid trade topic format:', message.topic);\r\n        return;\r\n      }\r\n\r\n      const symbol = topicParts[1];\r\n      const subscriptionKey = `trades_${symbol}`;\r\n      const subject = this.subscriptions.get(subscriptionKey);\r\n\r\n      if (!subject) {\r\n        console.warn(`No trade subscription found for ${subscriptionKey}`);\r\n        return;\r\n      }\r\n\r\n      const tradesArray = Array.isArray(message.data) ? message.data : [message.data];\r\n\r\n      tradesArray.forEach((rawTrade: any) => {\r\n        const tradeData: TradeData = {\r\n          symbol: rawTrade.symbol,\r\n          execId: rawTrade.execId,\r\n          price: parseFloat(rawTrade.price),\r\n          size: parseFloat(rawTrade.size),\r\n          side: rawTrade.side,\r\n          timestamp: rawTrade.time,\r\n          isBlockTrade: rawTrade.isBlockTrade\r\n        };\r\n\r\n        this.dataCache.set(`${subscriptionKey}_${rawTrade.execId}`, tradeData);\r\n        subject.next(tradeData);\r\n\r\n        console.log(`üíπ Trade for ${symbol}:`, {\r\n          price: tradeData.price,\r\n          size: tradeData.size,\r\n          side: tradeData.side\r\n        });\r\n      });\r\n    } catch (error) {\r\n      console.error('Error processing trade data:', error, message);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe from ticker data\r\n   */\r\n  unsubscribeFromTicker(symbol: string): void {\r\n    const topic = `tickers.${symbol}`;\r\n    const subscriptionKey = `ticker_${symbol}`;\r\n\r\n    if (this.socket$ && !this.socket$.closed) {\r\n      this.sendUnsubscription(topic);\r\n    }\r\n\r\n    const subject = this.subscriptions.get(subscriptionKey);\r\n    if (subject) {\r\n      subject.complete();\r\n      this.subscriptions.delete(subscriptionKey);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe from orderbook data\r\n   */\r\n  unsubscribeFromOrderbook(symbol: string, depth = 50): void {\r\n    const topic = `orderbook.${depth}.${symbol}`;\r\n    const subscriptionKey = `orderbook_${symbol}_${depth}`;\r\n\r\n    if (this.socket$ && !this.socket$.closed) {\r\n      this.sendUnsubscription(topic);\r\n    }\r\n\r\n    const subject = this.subscriptions.get(subscriptionKey);\r\n    if (subject) {\r\n      subject.complete();\r\n      this.subscriptions.delete(subscriptionKey);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe from trade data\r\n   */\r\n  unsubscribeFromTrades(symbol: string): void {\r\n    const topic = `publicTrade.${symbol}`;\r\n    const subscriptionKey = `trades_${symbol}`;\r\n\r\n    if (this.socket$ && !this.socket$.closed) {\r\n      this.sendUnsubscription(topic);\r\n    }\r\n\r\n    const subject = this.subscriptions.get(subscriptionKey);\r\n    if (subject) {\r\n      subject.complete();\r\n      this.subscriptions.delete(subscriptionKey);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get cached data for a subscription\r\n   */\r\n  getCachedData(subscriptionKey: string): any {\r\n    return this.dataCache.get(subscriptionKey);\r\n  }\r\n\r\n  /**\r\n   * Clear cache for a specific subscription or all cache\r\n   */\r\n  clearCache(subscriptionKey?: string): void {\r\n    if (subscriptionKey) {\r\n      this.dataCache.delete(subscriptionKey);\r\n    } else {\r\n      this.dataCache.clear();\r\n    }\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\services\\bybit.service.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'throwError' is defined but never used.","line":3,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":32},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'startWith' is defined but never used.","line":4,"column":36,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":45},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'TickerData' is defined but never used.","line":5,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":43},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'OrderbookData' is defined but never used.","line":5,"column":45,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":58},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'TradeData' is defined but never used.","line":5,"column":60,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":69},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":131,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4262,4265],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4262,4265],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .retCode on an `any` value.","line":134,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":134,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .result on an `any` value.","line":134,"column":48,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":134,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":135,"column":11,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":138,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":135,"column":18,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":138,"endColumn":19},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":135,"column":18,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":137,"endColumn":17},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":135,"column":18,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":136,"endColumn":20},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .result on an `any` value.","line":135,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":135,"endColumn":33},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":136,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4476,4479],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4476,4479],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":136,"column":36,"nodeType":"CallExpression","messageId":"unsafeReturn","endLine":136,"endColumn":64},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":136,"column":36,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":136,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":136,"column":41,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":136,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .map on an `any` value.","line":137,"column":14,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":137,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":137,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":137,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4539,4542],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4539,4542],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":137,"column":33,"nodeType":"MemberExpression","messageId":"unsafeReturn","endLine":137,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .symbol on an `any` value.","line":137,"column":38,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":137,"endColumn":44},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .slice on an `any` value.","line":138,"column":14,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":138,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'originalTimestamp' is defined but never used.","line":188,"column":41,"nodeType":null,"messageId":"unusedVar","endLine":188,"endColumn":58},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":286,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":286,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9552,9555],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9552,9555],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .retCode on an `any` value.","line":288,"column":32,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":288,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":341,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":341,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":473,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":473,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16317,16320],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16317,16320],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":484,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":484,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16751,16754],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16751,16754],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":494,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":494,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17144,17147],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17144,17147],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":528,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":528,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18279,18282],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18279,18282],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":545,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":545,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18823,18826],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18823,18826],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":557,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":557,"endColumn":15},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":558,"column":9,"nodeType":"Property","messageId":"anyAssignment","endLine":558,"endColumn":18},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .asks on an `any` value.","line":559,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":559,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .bids on an `any` value.","line":559,"column":58,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":559,"endColumn":62}],"suppressedMessages":[],"errorCount":35,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Injectable } from '@angular/core';\r\nimport { HttpClient, HttpErrorResponse } from '@angular/common/http';\r\nimport { Observable, throwError, of, combineLatest, BehaviorSubject } from 'rxjs';\r\nimport { catchError, map, timeout, startWith, take, switchMap } from 'rxjs/operators';\r\nimport { BybitWebSocketService, TickerData, OrderbookData, TradeData } from './bybit-websocket.service';\r\n\r\n/**\r\n * Bybit API kline/candlestick data structure\r\n * Represents the raw response format from Bybit V5 REST API\r\n */\r\nexport interface BybitKlineData {\r\n  symbol: string;\r\n  category: string;\r\n  list: string[][]; // [timestamp, open, high, low, close, volume, turnover]\r\n}\r\n\r\n/**\r\n * Bybit API response wrapper for kline endpoint\r\n */\r\nexport interface BybitKlineResponse {\r\n  retCode: number;\r\n  retMsg: string;\r\n  result: BybitKlineData;\r\n  time: number;\r\n}\r\n\r\n/**\r\n * Normalized candlestick data format used throughout the application\r\n * Compatible with lightweight-charts library\r\n */\r\nexport interface CandlestickData {\r\n  time: string | number; // Support both string (YYYY-MM-DD) and number (timestamp)\r\n  open: number;\r\n  high: number;\r\n  low: number;\r\n  close: number;\r\n  volume?: number;\r\n}\r\n\r\n/**\r\n * Bybit Service - Main integration layer for Bybit exchange\r\n *\r\n * This service provides a high-level API for interacting with Bybit exchange,\r\n * combining both REST API and WebSocket real-time data streams. It handles:\r\n * - Historical kline/candlestick data retrieval\r\n * - Real-time market data subscriptions\r\n * - Data transformation and normalization\r\n * - Error handling and fallback mechanisms\r\n *\r\n * @example\r\n * ```typescript\r\n * // Get real-time candlestick data\r\n * this.bybitService.getRealTimeKlineData('BTCUSDT', '1').subscribe(candles => {\r\n *   console.log('Received candles:', candles);\r\n * });\r\n *\r\n * // Get available symbols\r\n * this.bybitService.getSymbols().subscribe(symbols => {\r\n *   console.log('Available symbols:', symbols);\r\n * });\r\n * ```\r\n *\r\n * @see {@link BybitWebSocketService} for WebSocket connection management\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class BybitService {\r\n  private readonly baseUrl = 'https://api.bybit.com';\r\n  private readonly timeout = 10000; // 10 seconds timeout\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private webSocketService: BybitWebSocketService\r\n  ) {}\r\n\r\n  /**\r\n   * Fetch historical kline/candlestick data from Bybit REST API\r\n   *\r\n   * Retrieves historical market data for a specified trading pair and time interval.\r\n   * Data is automatically transformed to application format and validated for correctness.\r\n   *\r\n   * @param symbol - Trading pair symbol (e.g., 'BTCUSDT', 'ETHUSDT')\r\n   * @param interval - Time interval for candles: '1', '5', '15', '30', '60', '240', 'D'\r\n   * @param limit - Number of candles to retrieve (max 1000, default 720)\r\n   * @returns Observable<CandlestickData[]> - Stream of candlestick data, sorted in ascending time order\r\n   *\r\n   * @throws Error if API returns error code or invalid data\r\n   * @example\r\n   * ```typescript\r\n   * // Get 100 hourly candles for Bitcoin\r\n   * this.bybitService.getKlineData('BTCUSDT', '60', 100).subscribe(candles => {\r\n   *   console.log('First candle:', candles[0]);\r\n   *   console.log('Latest candle:', candles[candles.length - 1]);\r\n   * });\r\n   * ```\r\n   */\r\n  getKlineData(\r\n    symbol = 'BTCUSDT',\r\n    interval = '60',\r\n    limit: number = 24*30\r\n  ): Observable<CandlestickData[]> {\r\n    // console.log(`Fetching Bybit data for ${symbol}, interval: ${interval}, limit: ${limit}`);\r\n\r\n    const params = {\r\n      category: 'spot',\r\n      symbol: symbol,\r\n      interval: interval,\r\n      limit: limit.toString()\r\n    };\r\n\r\n    const url = `${this.baseUrl}/v5/market/kline`;\r\n\r\n    return this.http.get<BybitKlineResponse>(url, { params }).pipe(\r\n      timeout(this.timeout),\r\n      map(response => this.transformBybitData(response)),\r\n      catchError(error => this.handleError(error, symbol))\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get available trading symbols from Bybit\r\n   */\r\n  getSymbols(): Observable<string[]> {\r\n    const url = `${this.baseUrl}/v5/market/instruments-info`;\r\n    const params = {\r\n      category: 'spot',\r\n      limit: '100'\r\n    };\r\n\r\n    return this.http.get<any>(url, { params }).pipe(\r\n      timeout(this.timeout),\r\n      map(response => {\r\n        if (response.retCode === 0 && response.result?.list) {\r\n          return response.result.list\r\n            .filter((item: any) => item.symbol.endsWith('USDT'))\r\n            .map((item: any) => item.symbol)\r\n            .slice(0, 20); // Limit to top 20 USDT pairs\r\n        }\r\n        return ['BTCUSDT', 'ETHUSDT', 'ADAUSDT', 'DOTUSDT', 'MATICUSDT']; // Fallback\r\n      }),\r\n      catchError(error => {\r\n        console.error('Failed to fetch symbols from Bybit:', error);\r\n        return of(['BTCUSDT', 'ETHUSDT', 'ADAUSDT', 'DOTUSDT', 'MATICUSDT']); // Fallback\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Transform Bybit API response to our CandlestickData format\r\n   */\r\n  private transformBybitData(response: BybitKlineResponse): CandlestickData[] {\r\n    // console.log('Bybit API response:', response);\r\n\r\n    if (response.retCode !== 0 || !response.result?.list) {\r\n      throw new Error(`Bybit API error: ${response.retMsg || 'Invalid response'}`);\r\n    }\r\n\r\n    const data = response.result.list.map(item => {\r\n      const [timestamp, open, high, low, close, volume] = item;\r\n\r\n      // Always use Unix timestamp in seconds for lightweight-charts\r\n      // This ensures proper ordering for all time intervals\r\n      const timestampMs = parseInt(timestamp);\r\n      const timestampSeconds = Math.floor(timestampMs / 1000);\r\n\r\n      return {\r\n        time: timestampSeconds, // Use Unix timestamp in seconds\r\n        open: parseFloat(open),\r\n        high: parseFloat(high),\r\n        low: parseFloat(low),\r\n        close: parseFloat(close),\r\n        volume: parseFloat(volume),\r\n        originalTimestamp: timestampMs // Keep original for debugging\r\n      };\r\n    });\r\n\r\n    // Sort by time to ensure ascending order\r\n    const sortedData = data.sort((a, b) => (a.time as number) - (b.time as number));\r\n\r\n    // Remove duplicates based on time\r\n    const uniqueData = sortedData.filter((item, index, arr) => {\r\n      if (index === 0) return true;\r\n      return item.time !== arr[index - 1].time;\r\n    });\r\n\r\n    // Remove the temporary originalTimestamp property\r\n    const finalData = uniqueData.map(({ originalTimestamp, ...rest }) => rest);\r\n\r\n    // console.log(`Transformed ${finalData.length} data points from Bybit (removed ${data.length - finalData.length} duplicates)`);\r\n    // console.log('First data point:', finalData[0]);\r\n    // console.log('Last data point:', finalData[finalData.length - 1]);\r\n\r\n    // Validate data order\r\n    for (let i = 1; i < finalData.length; i++) {\r\n      const current = finalData[i].time as number;\r\n      const previous = finalData[i - 1].time as number;\r\n\r\n      if (current <= previous) {\r\n        console.warn(`Data ordering issue at index ${i}: current=${current}, previous=${previous}`);\r\n        console.warn('Current item:', finalData[i]);\r\n        console.warn('Previous item:', finalData[i - 1]);\r\n      }\r\n    }\r\n\r\n    return finalData;\r\n  }\r\n\r\n  /**\r\n   * Handle HTTP errors and provide fallback data\r\n   */\r\n  private handleError(error: HttpErrorResponse, symbol: string): Observable<CandlestickData[]> {\r\n    console.error('Bybit API Error:', error);\r\n\r\n    // Return fallback data when API fails\r\n    // console.log('Returning fallback data due to API error');\r\n    return of(this.generateFallbackData(symbol));\r\n  }\r\n\r\n  /**\r\n   * Generate fallback data when Bybit API is unavailable\r\n   */\r\n  private generateFallbackData(symbol: string): CandlestickData[] {\r\n    // console.log(`Generating fallback data for ${symbol}`);\r\n\r\n    const data: CandlestickData[] = [];\r\n    let currentPrice = this.getBasePrice(symbol);\r\n\r\n    // Generate 30 days of fallback data\r\n    for (let i = 29; i >= 0; i--) {\r\n      const date = new Date();\r\n      date.setDate(date.getDate() - i);\r\n      const time = date.toISOString().split('T')[0];\r\n\r\n      // Generate realistic OHLC data\r\n      const open = currentPrice;\r\n      const volatility = 0.03;\r\n      const dailyRange = currentPrice * volatility;\r\n\r\n      const high = open + (Math.random() * dailyRange);\r\n      const low = open - (Math.random() * dailyRange);\r\n      const closeVariation = (Math.random() - 0.5) * dailyRange * 0.5;\r\n      const close = Math.max(low, Math.min(high, open + closeVariation));\r\n\r\n      currentPrice = close;\r\n\r\n      data.push({\r\n        time,\r\n        open: Math.round(open * 100) / 100,\r\n        high: Math.round(high * 100) / 100,\r\n        low: Math.round(low * 100) / 100,\r\n        close: Math.round(close * 100) / 100,\r\n        volume: Math.round(Math.random() * 1000000)\r\n      });\r\n    }\r\n\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * Get base price for different symbols\r\n   */\r\n  private getBasePrice(symbol: string): number {\r\n    const basePrices: Record<string, number> = {\r\n      'BTCUSDT': 45000,\r\n      'ETHUSDT': 2500,\r\n      'ADAUSDT': 0.5,\r\n      'DOTUSDT': 15,\r\n      'MATICUSDT': 0.8,\r\n      'BNBUSDT': 300,\r\n      'SOLUSDT': 100,\r\n      'XRPUSDT': 0.6,\r\n      'DOGEUSDT': 0.1,\r\n      'AVAXUSDT': 25\r\n    };\r\n\r\n    return basePrices[symbol] || 100; // Default fallback price\r\n  }\r\n\r\n  /**\r\n   * Check if Bybit API is accessible\r\n   */\r\n  checkApiHealth(): Observable<boolean> {\r\n    const url = `${this.baseUrl}/v5/market/time`;\r\n\r\n    return this.http.get<any>(url).pipe(\r\n      timeout(5000),\r\n      map(response => response.retCode === 0),\r\n      catchError(() => of(false))\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get real-time kline data using WebSocket\r\n   * This method combines initial REST API data with real-time WebSocket updates\r\n   * @param symbol Trading pair symbol (e.g., 'BTCUSDT')\r\n   * @param interval Time interval ('1', '5', '15', '30', '60', '240', 'D')\r\n   * @returns Observable<CandlestickData[]> - Emits initial data then real-time updates\r\n   */\r\n  getRealTimeKlineData(\r\n    symbol = 'BTCUSDT',\r\n    interval = '1'\r\n  ): Observable<CandlestickData[]> {\r\n    // console.log(`[BYBIT SERVICE] Starting real-time kline data for ${symbol}, interval: ${interval}`);\r\n\r\n    // First get initial historical data via REST API\r\n    const initialData$ = this.getKlineData(symbol, interval, 100).pipe(\r\n      take(1),\r\n      catchError(error => {\r\n        console.error('[BYBIT SERVICE] Failed to get initial data, using fallback:', error);\r\n        return of(this.generateFallbackData(symbol));\r\n      })\r\n    );\r\n\r\n    // Then subscribe to real-time updates via WebSocket\r\n    const realtimeUpdates$ = this.webSocketService.subscribeToKline(symbol, interval);\r\n\r\n    // Combine initial data with real-time updates using merge strategy\r\n    return initialData$.pipe(\r\n      switchMap(initialData => {\r\n        // console.log(`[BYBIT SERVICE] Initial data loaded: ${initialData.length} candles`);\r\n        // console.log('[BYBIT SERVICE] Setting up real-time update stream...');\r\n\r\n        const dataSubject = new BehaviorSubject<CandlestickData[]>(initialData);\r\n\r\n        // Subscribe to real-time updates and emit through the subject\r\n        const subscription = realtimeUpdates$.subscribe({\r\n          next: (newCandle) => {\r\n            // console.log('[BYBIT SERVICE] Received WebSocket candle update:', {\r\n            //   time: new Date(newCandle.time * 1000).toISOString(),\r\n            //   close: newCandle.close,\r\n            //   volume: newCandle.volume\r\n            // });\r\n\r\n            const currentData = dataSubject.value;\r\n            const updatedData = this.updateCandlestickData(currentData, newCandle);\r\n\r\n            // console.log(`[BYBIT SERVICE] Emitting updated data array with ${updatedData.length} candles`);\r\n            dataSubject.next(updatedData);\r\n          },\r\n          error: (error) => {\r\n            // console.error('[BYBIT SERVICE] WebSocket error:', error);\r\n          },\r\n          complete: () => {\r\n            // console.log('[BYBIT SERVICE] WebSocket stream completed');\r\n          }\r\n        });\r\n\r\n        // Return the subject as observable and clean up subscription on unsubscribe\r\n        return new Observable<CandlestickData[]>(observer => {\r\n          const subjectSubscription = dataSubject.subscribe(observer);\r\n\r\n          return () => {\r\n            // console.log('[BYBIT SERVICE] Cleaning up real-time kline subscription');\r\n            subscription.unsubscribe();\r\n            subjectSubscription.unsubscribe();\r\n          };\r\n        });\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Subscribe to real-time kline updates only (no initial data)\r\n   * @param symbol Trading pair symbol\r\n   * @param interval Time interval\r\n   * @returns Observable<CandlestickData> - Emits individual candle updates\r\n   */\r\n  subscribeToRealtimeKline(\r\n    symbol = 'BTCUSDT',\r\n    interval = '1'\r\n  ): Observable<CandlestickData> {\r\n    // console.log(`Subscribing to real-time updates for ${symbol}, interval: ${interval}`);\r\n    return this.webSocketService.subscribeToKline(symbol, interval);\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe from real-time kline data\r\n   * @param symbol Trading pair symbol\r\n   * @param interval Time interval\r\n   */\r\n  unsubscribeFromRealtimeKline(symbol: string, interval = '1'): void {\r\n    // console.log(`Unsubscribing from real-time updates for ${symbol}, interval: ${interval}`);\r\n    this.webSocketService.unsubscribeFromKline(symbol, interval);\r\n  }\r\n\r\n  /**\r\n   * Get WebSocket connection state\r\n   */\r\n  getWebSocketConnectionState(): Observable<'disconnected' | 'connecting' | 'connected'> {\r\n    return this.webSocketService.getConnectionState();\r\n  }\r\n\r\n  /**\r\n   * Check if WebSocket is connected\r\n   */\r\n  isWebSocketConnected(): boolean {\r\n    return this.webSocketService.isConnected();\r\n  }\r\n\r\n  /**\r\n   * Get list of active WebSocket subscriptions\r\n   */\r\n  getActiveSubscriptions(): string[] {\r\n    return this.webSocketService.getActiveSubscriptions();\r\n  }\r\n\r\n  /**\r\n   * Update candlestick data array with new candle\r\n   * This handles both new candles and updates to the current candle\r\n   */\r\n  private updateCandlestickData(\r\n    currentData: CandlestickData[],\r\n    newCandle: CandlestickData\r\n  ): CandlestickData[] {\r\n    if (currentData.length === 0) {\r\n      return [newCandle];\r\n    }\r\n\r\n    const updatedData = [...currentData];\r\n    const lastCandle = updatedData[updatedData.length - 1];\r\n\r\n    // Convert time to number for comparison\r\n    const lastCandleTime = typeof lastCandle.time === 'number' ? lastCandle.time : parseInt(lastCandle.time);\r\n    const newCandleTime = typeof newCandle.time === 'number' ? newCandle.time : parseInt(newCandle.time);\r\n\r\n    // Check if this is an update to the current candle or a new candle\r\n    if (lastCandleTime === newCandleTime) {\r\n      // Update the current candle\r\n      updatedData[updatedData.length - 1] = newCandle;\r\n      // console.log(`üìä Updated current candle at ${new Date(newCandleTime * 1000).toISOString()}`);\r\n    } else if (newCandleTime > lastCandleTime) {\r\n      // Add new candle and limit the array size\r\n      updatedData.push(newCandle);\r\n\r\n      // Keep only the last 1000 candles to prevent memory issues\r\n      if (updatedData.length > 1000) {\r\n        updatedData.shift();\r\n      }\r\n\r\n      // console.log(`üìä Added new candle at ${new Date(newCandleTime * 1000).toISOString()}`);\r\n    } else {\r\n      // console.warn('Received candle with older timestamp, ignoring:', newCandle);\r\n    }\r\n\r\n    return updatedData;\r\n  }\r\n\r\n  /**\r\n   * Convert WebSocket interval format to REST API format if needed\r\n   */\r\n  private convertIntervalFormat(interval: string): string {\r\n    // Bybit WebSocket and REST API use the same interval format\r\n    // But we can add conversion logic here if needed\r\n    const intervalMap: Record<string, string> = {\r\n      '1m': '1',\r\n      '5m': '5',\r\n      '15m': '15',\r\n      '30m': '30',\r\n      '1h': '60',\r\n      '4h': '240',\r\n      '1d': 'D'\r\n    };\r\n\r\n    return intervalMap[interval] || interval;\r\n  }\r\n\r\n  /**\r\n   * Subscribe to real-time ticker data\r\n   * @param symbol Trading pair symbol\r\n   * @returns Observable<TickerData> - Emits ticker updates\r\n   */\r\n  subscribeToRealtimeTicker(symbol = 'BTCUSDT'): Observable<any> {\r\n    // console.log(`Subscribing to real-time ticker for ${symbol}`);\r\n    return this.webSocketService.subscribeToTicker(symbol);\r\n  }\r\n\r\n  /**\r\n   * Subscribe to real-time orderbook data\r\n   * @param symbol Trading pair symbol\r\n   * @param depth Orderbook depth (1, 50, 200)\r\n   * @returns Observable<OrderbookData> - Emits orderbook updates\r\n   */\r\n  subscribeToRealtimeOrderbook(symbol = 'BTCUSDT', depth = 50): Observable<any> {\r\n    // console.log(`Subscribing to real-time orderbook for ${symbol}, depth: ${depth}`);\r\n    return this.webSocketService.subscribeToOrderbook(symbol, depth);\r\n  }\r\n\r\n  /**\r\n   * Subscribe to real-time trade data\r\n   * @param symbol Trading pair symbol\r\n   * @returns Observable<TradeData> - Emits individual trades\r\n   */\r\n  subscribeToRealtimeTrades(symbol = 'BTCUSDT'): Observable<any> {\r\n    // console.log(`Subscribing to real-time trades for ${symbol}`);\r\n    return this.webSocketService.subscribeToTrades(symbol);\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe from real-time ticker data\r\n   */\r\n  unsubscribeFromRealtimeTicker(symbol: string): void {\r\n    // console.log(`Unsubscribing from real-time ticker for ${symbol}`);\r\n    this.webSocketService.unsubscribeFromTicker(symbol);\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe from real-time orderbook data\r\n   */\r\n  unsubscribeFromRealtimeOrderbook(symbol: string, depth = 50): void {\r\n    // console.log(`Unsubscribing from real-time orderbook for ${symbol}`);\r\n    this.webSocketService.unsubscribeFromOrderbook(symbol, depth);\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe from real-time trade data\r\n   */\r\n  unsubscribeFromRealtimeTrades(symbol: string): void {\r\n    // console.log(`Unsubscribing from real-time trades for ${symbol}`);\r\n    this.webSocketService.unsubscribeFromTrades(symbol);\r\n  }\r\n\r\n  /**\r\n   * Get cached data from WebSocket service\r\n   * @param subscriptionKey Key for cached data\r\n   * @returns Cached data or null\r\n   */\r\n  getCachedWebSocketData(subscriptionKey: string): any {\r\n    return this.webSocketService.getCachedData(subscriptionKey);\r\n  }\r\n\r\n  /**\r\n   * Clear WebSocket cache\r\n   * @param subscriptionKey Optional specific key to clear\r\n   */\r\n  clearWebSocketCache(subscriptionKey?: string): void {\r\n    this.webSocketService.clearCache(subscriptionKey);\r\n  }\r\n\r\n  /**\r\n   * Get comprehensive market data stream combining multiple data types\r\n   * @param symbol Trading pair symbol\r\n   * @returns Observable with combined market data\r\n   */\r\n  getComprehensiveMarketStream(symbol = 'BTCUSDT'): Observable<any> {\r\n    // console.log(`Starting comprehensive market stream for ${symbol}`);\r\n\r\n    return combineLatest([\r\n      this.subscribeToRealtimeKline(symbol, '1'),\r\n      this.subscribeToRealtimeTicker(symbol),\r\n      this.subscribeToRealtimeOrderbook(symbol, 50)\r\n    ]).pipe(\r\n      map(([kline, ticker, orderbook]) => ({\r\n        symbol,\r\n        timestamp: Date.now(),\r\n        kline,\r\n        ticker,\r\n        orderbook,\r\n        spread: orderbook?.asks?.[0]?.price - orderbook?.bids?.[0]?.price || 0\r\n      }))\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Set WebSocket environment (mainnet or testnet)\r\n   * Delegates to the underlying WebSocketService\r\n   */\r\n  setWebSocketEnvironment(environment: 'MAINNET' | 'TESTNET'): void {\r\n    this.webSocketService.setEnvironment(environment);\r\n  }\r\n\r\n  /**\r\n   * Get current WebSocket environment\r\n   */\r\n  getWebSocketEnvironment(): 'mainnet' | 'testnet' {\r\n    return this.webSocketService.getCurrentEnvironment();\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\services\\chart.service.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":130,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3028,3031],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3028,3031],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":131,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3077,3080],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3077,3080],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":387,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":387,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12095,12098],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12095,12098],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .from on an `any` value.","line":389,"column":64,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":389,"endColumn":68},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .to on an `any` value.","line":389,"column":83,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":389,"endColumn":85},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .firstDataRequest on an `any` value.","line":389,"column":100,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":389,"endColumn":116},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":396,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":396,"endColumn":34},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'onResetCacheNeededCallback' is defined but never used.","line":401,"column":136,"nodeType":null,"messageId":"unusedVar","endLine":401,"endColumn":162},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":419,"column":15,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":419,"endColumn":62}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Observable, BehaviorSubject } from 'rxjs';\r\nimport { map, catchError } from 'rxjs/operators';\r\n\r\n// TradingView-compatible interfaces based on official documentation\r\n\r\n// TradingView LibrarySymbolInfo structure\r\nexport interface LibrarySymbolInfo {\r\n  name: string;\r\n  full_name: string;\r\n  description: string;\r\n  exchange: string;\r\n  type: string;\r\n  session: string;\r\n  timezone: string;\r\n  ticker?: string;\r\n  minmov: number;\r\n  pricescale: number;\r\n  has_intraday: boolean;\r\n  has_daily: boolean;\r\n  has_weekly_and_monthly: boolean;\r\n  supported_resolutions: string[];\r\n  intraday_multipliers: string[];\r\n  data_status: string;\r\n  currency_code?: string;\r\n}\r\n\r\n// Search result symbol structure\r\nexport interface SearchSymbolResultItem {\r\n  symbol: string;\r\n  full_name: string;\r\n  description: string;\r\n  exchange: string;\r\n  type: string;\r\n}\r\n\r\n// Basic symbol info for API responses\r\nexport interface ChartSymbol {\r\n  symbol: string;\r\n  full_name: string;\r\n  description: string;\r\n  exchange: string;\r\n  type: string;\r\n  currency_code?: string;\r\n}\r\n\r\n// TradingView DatafeedConfiguration structure\r\nexport interface DatafeedConfiguration {\r\n  supported_resolutions: string[];\r\n  supports_group_request?: boolean;\r\n  supports_marks?: boolean;\r\n  supports_search?: boolean;\r\n  supports_timescale_marks?: boolean;\r\n  supports_time?: boolean;\r\n  exchanges?: Exchange[];\r\n  symbols_types?: SymbolType[];\r\n  currency_codes?: string[];\r\n}\r\n\r\nexport interface Exchange {\r\n  value: string;\r\n  name: string;\r\n  desc: string;\r\n}\r\n\r\nexport interface SymbolType {\r\n  name: string;\r\n  value: string;\r\n}\r\n\r\nexport interface ChartDataRequest {\r\n  symbol: string;\r\n  resolution: string;\r\n  from: number;\r\n  to: number;\r\n  firstDataRequest?: boolean;\r\n}\r\n\r\n// TradingView Bar structure\r\nexport interface Bar {\r\n  time: number; // Unix timestamp in milliseconds\r\n  open: number;\r\n  high: number;\r\n  low: number;\r\n  close: number;\r\n  volume?: number;\r\n}\r\n\r\n// TradingView GetBarsResult structure\r\nexport interface GetBarsResult {\r\n  bars: Bar[];\r\n  meta: HistoryMetadata;\r\n}\r\n\r\nexport interface HistoryMetadata {\r\n  noData?: boolean;\r\n  nextTime?: number;\r\n}\r\n\r\n// API response structure\r\nexport interface ChartDataResponse {\r\n  s: string; // status: 'ok', 'no_data', 'error'\r\n  t?: number[]; // time\r\n  o?: number[]; // open\r\n  h?: number[]; // high\r\n  l?: number[]; // low\r\n  c?: number[]; // close\r\n  v?: number[]; // volume\r\n  errmsg?: string;\r\n  nextTime?: number;\r\n}\r\n\r\nexport interface RealtimeData {\r\n  symbol: string;\r\n  price: number;\r\n  volume: number;\r\n  timestamp: number;\r\n  change: number;\r\n  changePercent: number;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ChartService {\r\n  private apiUrl = '/api/trading';\r\n  private realtimeDataSubject = new BehaviorSubject<RealtimeData | null>(null);\r\n  public realtimeData$ = this.realtimeDataSubject.asObservable();\r\n  private subscriberMap = new Map<string, any>();\r\n  private intervalMap = new Map<string, any>();\r\n\r\n  constructor(private http: HttpClient) {}\r\n\r\n  // Get TradingView datafeed configuration\r\n  getDatafeedConfiguration(): Observable<DatafeedConfiguration> {\r\n    return this.http.get<DatafeedConfiguration>(`${this.apiUrl}/config`).pipe(\r\n      catchError(error => {\r\n        console.error('Failed to get datafeed configuration:', error);\r\n        // Return default configuration with proper typing\r\n        const defaultConfig: DatafeedConfiguration = {\r\n          supported_resolutions: ['1', '5', '15', '30', '60', '240', '1D', '1W', '1M'],\r\n          supports_group_request: false,\r\n          supports_marks: false,\r\n          supports_search: true,\r\n          supports_timescale_marks: false,\r\n          supports_time: false,\r\n          exchanges: [{\r\n            value: 'BYBIT',\r\n            name: 'Bybit',\r\n            desc: 'Bybit Exchange'\r\n          }],\r\n          symbols_types: [{\r\n            name: 'crypto',\r\n            value: 'crypto'\r\n          }],\r\n          currency_codes: ['USDT', 'BTC', 'ETH']\r\n        };\r\n        return new Observable<DatafeedConfiguration>(subscriber => {\r\n          subscriber.next(defaultConfig);\r\n          subscriber.complete();\r\n        });\r\n      })\r\n    );\r\n  }\r\n\r\n  // Get TradingView configuration (legacy method)\r\n  getConfig(): Observable<DatafeedConfiguration> {\r\n    return this.getDatafeedConfiguration();\r\n  }\r\n\r\n  // Get available symbols\r\n  getSymbols(): Observable<ChartSymbol[]> {\r\n    return this.http.get<ChartSymbol[]>(`${this.apiUrl}/symbols`);\r\n  }\r\n\r\n  // Get specific symbol info\r\n  getSymbolInfo(symbol: string): Observable<ChartSymbol> {\r\n    return this.http.get<ChartSymbol>(`${this.apiUrl}/symbols?symbol=${symbol}`);\r\n  }\r\n\r\n  // Search symbols (legacy method)\r\n  searchSymbols(query: string): Observable<ChartSymbol[]> {\r\n    return this.getSymbols().pipe(\r\n      map(symbols => symbols.filter(symbol =>\r\n        symbol.symbol.toLowerCase().includes(query.toLowerCase()) ||\r\n        symbol.description.toLowerCase().includes(query.toLowerCase())\r\n      ))\r\n    );\r\n  }\r\n\r\n  // Search symbols with TradingView filters\r\n  searchSymbolsWithFilters(query: string, exchange?: string, symbolType?: string): Observable<SearchSymbolResultItem[]> {\r\n    return this.getSymbols().pipe(\r\n      map(symbols => {\r\n        let filtered = symbols.filter(symbol =>\r\n          symbol.symbol.toLowerCase().includes(query.toLowerCase()) ||\r\n          symbol.description.toLowerCase().includes(query.toLowerCase())\r\n        );\r\n\r\n        if (exchange && exchange !== '') {\r\n          filtered = filtered.filter(symbol => symbol.exchange === exchange);\r\n        }\r\n\r\n        if (symbolType && symbolType !== '') {\r\n          filtered = filtered.filter(symbol => symbol.type === symbolType);\r\n        }\r\n\r\n        return filtered.map(symbol => ({\r\n          symbol: symbol.symbol,\r\n          full_name: symbol.full_name,\r\n          description: symbol.description,\r\n          exchange: symbol.exchange,\r\n          type: symbol.type\r\n        }));\r\n      }),\r\n      catchError(error => {\r\n        console.error('Symbol search failed:', error);\r\n        return new Observable<SearchSymbolResultItem[]>(subscriber => {\r\n          subscriber.next([]);\r\n          subscriber.complete();\r\n        });\r\n      })\r\n    );\r\n  }\r\n\r\n  // Get chart data for TradingView\r\n  getChartData(request: ChartDataRequest): Observable<ChartDataResponse> {\r\n    const params = new URLSearchParams({\r\n      symbol: request.symbol,\r\n      resolution: request.resolution,\r\n      from: request.from.toString(),\r\n      to: request.to.toString()\r\n    });\r\n\r\n    if (request.firstDataRequest) {\r\n      params.append('firstDataRequest', 'true');\r\n    }\r\n\r\n    return this.http.get<ChartDataResponse>(`${this.apiUrl}/chart?${params.toString()}`);\r\n  }\r\n\r\n  // Convert API response to TradingView bars format\r\n  private convertToBars(response: ChartDataResponse): GetBarsResult {\r\n    if (response.s === 'ok' && response.t && response.o && response.h && response.l && response.c) {\r\n      const bars: Bar[] = response.t.map((time: number, index: number) => ({\r\n        time: time * 1000, // Convert to milliseconds\r\n        open: response.o![index],\r\n        high: response.h![index],\r\n        low: response.l![index],\r\n        close: response.c![index],\r\n        volume: response.v ? response.v[index] : 0\r\n      }));\r\n\r\n      return {\r\n        bars,\r\n        meta: {\r\n          noData: false,\r\n          nextTime: response.nextTime\r\n        }\r\n      };\r\n    } else if (response.s === 'no_data') {\r\n      return {\r\n        bars: [],\r\n        meta: {\r\n          noData: true,\r\n          nextTime: response.nextTime\r\n        }\r\n      };\r\n    } else {\r\n      throw new Error(response.errmsg || 'Failed to get chart data');\r\n    }\r\n  }\r\n\r\n  private calculatePricescale(symbol: string): number {\r\n    // Determine appropriate price scale based on symbol\r\n    if (symbol.includes('USDT') || symbol.includes('USD')) {\r\n      return 100; // 2 decimal places\r\n    } else if (symbol.includes('BTC')) {\r\n      return 100000000; // 8 decimal places\r\n    }\r\n    return 10000; // 4 decimal places default\r\n  }\r\n\r\n  // Resolve symbol to TradingView LibrarySymbolInfo format\r\n  resolveSymbolInfo(symbolName: string): Observable<LibrarySymbolInfo> {\r\n    return this.getSymbolInfo(symbolName).pipe(\r\n      map(symbolInfo => {\r\n        const pricescale = this.calculatePricescale(symbolInfo.symbol);\r\n        return {\r\n          name: symbolInfo.symbol,\r\n          full_name: symbolInfo.full_name,\r\n          description: symbolInfo.description,\r\n          exchange: symbolInfo.exchange,\r\n          type: symbolInfo.type,\r\n          session: '24x7',\r\n          timezone: 'UTC',\r\n          ticker: symbolInfo.symbol,\r\n          minmov: 1,\r\n          pricescale: pricescale,\r\n          has_intraday: true,\r\n          has_daily: true,\r\n          has_weekly_and_monthly: true,\r\n          supported_resolutions: ['1', '5', '15', '30', '60', '240', '1D', '1W'],\r\n          intraday_multipliers: ['1', '5', '15', '30', '60', '240'],\r\n          data_status: 'streaming',\r\n          currency_code: symbolInfo.currency_code\r\n        };\r\n      }),\r\n      catchError(error => {\r\n        console.error('Symbol resolve failed:', error);\r\n        throw new Error(`Unknown symbol: ${symbolName}`);\r\n      })\r\n    );\r\n  }\r\n\r\n  // Get bars in TradingView format\r\n  getChartBars(symbolInfo: LibrarySymbolInfo, resolution: string, from: number, to: number, firstDataRequest = false): Observable<GetBarsResult> {\r\n    const request: ChartDataRequest = {\r\n      symbol: symbolInfo.name,\r\n      resolution: resolution,\r\n      from: from,\r\n      to: to,\r\n      firstDataRequest: firstDataRequest\r\n    };\r\n\r\n    return this.getChartData(request).pipe(\r\n      map(response => this.convertToBars(response)),\r\n      catchError(error => {\r\n        console.error('Chart data failed:', error);\r\n        throw error;\r\n      })\r\n    );\r\n  }\r\n\r\n  // Create TradingView datafeed with enhanced error handling\r\n  createDatafeed() {\r\n    return {\r\n      onReady: (callback: (config: DatafeedConfiguration) => void) => {\r\n        this.getDatafeedConfiguration().subscribe({\r\n          next: (config) => {\r\n            console.log('Datafeed configuration loaded:', config);\r\n            callback(config);\r\n          },\r\n          error: (error) => {\r\n            console.error('Failed to get datafeed configuration:', error);\r\n            // Fallback configuration\r\n            callback({\r\n              supported_resolutions: ['1', '5', '15', '30', '60', '240', '1D', '1W'],\r\n              supports_group_request: false,\r\n              supports_marks: false,\r\n              supports_search: true,\r\n              supports_timescale_marks: false,\r\n              supports_time: false\r\n            });\r\n          }\r\n        });\r\n      },\r\n\r\n      searchSymbols: (userInput: string, exchange: string, symbolType: string, onResult: (symbols: SearchSymbolResultItem[]) => void) => {\r\n        this.searchSymbolsWithFilters(userInput, exchange, symbolType).subscribe({\r\n          next: (symbols) => {\r\n            console.log(`Search results for \"${userInput}\":`, symbols.length, 'symbols found');\r\n            onResult(symbols);\r\n          },\r\n          error: (error) => {\r\n            console.error('Symbol search failed:', error);\r\n            onResult([]);\r\n          }\r\n        });\r\n      },\r\n\r\n      resolveSymbol: (symbolName: string, onResolve: (symbolInfo: LibrarySymbolInfo) => void, onError: (error: string) => void) => {\r\n        console.log('Resolving symbol:', symbolName);\r\n        this.resolveSymbolInfo(symbolName).subscribe({\r\n          next: (symbolInfo) => {\r\n            console.log('Symbol resolved:', symbolInfo);\r\n            onResolve(symbolInfo);\r\n          },\r\n          error: (error) => {\r\n            console.error('Symbol resolve failed:', error);\r\n            onError(`Unknown symbol: ${symbolName}`);\r\n          }\r\n        });\r\n      },\r\n\r\n      getBars: (symbolInfo: LibrarySymbolInfo, resolution: string, periodParams: any, onResult: (bars: Bar[], meta: HistoryMetadata) => void, onError: (error: string) => void) => {\r\n        console.log('Getting bars for:', symbolInfo.name, resolution, periodParams);\r\n        this.getChartBars(symbolInfo, resolution, periodParams.from, periodParams.to, periodParams.firstDataRequest).subscribe({\r\n          next: (result) => {\r\n            console.log('Bars loaded:', result.bars.length, 'bars');\r\n            onResult(result.bars, result.meta);\r\n          },\r\n          error: (error) => {\r\n            console.error('Failed to get bars:', error);\r\n            onError(error.message || 'Failed to fetch chart data');\r\n          }\r\n        });\r\n      },\r\n\r\n      subscribeBars: (symbolInfo: LibrarySymbolInfo, resolution: string, onRealtimeCallback: (bar: Bar) => void, listenerGUID: string, onResetCacheNeededCallback?: () => void) => {\r\n        console.log('Subscribing to real-time data:', symbolInfo.name, listenerGUID);\r\n\r\n        // Store subscriber info for cleanup\r\n        this.subscriberMap.set(listenerGUID, {\r\n          symbol: symbolInfo.name,\r\n          resolution: resolution,\r\n          callback: onRealtimeCallback\r\n        });\r\n\r\n        // Start polling for real-time data\r\n        this.startRealtimeSubscription(symbolInfo.name, resolution, onRealtimeCallback, listenerGUID);\r\n      },\r\n\r\n      unsubscribeBars: (listenerGUID: string) => {\r\n        console.log('Unsubscribing from real-time data:', listenerGUID);\r\n\r\n        // Clean up interval if exists\r\n        const intervalId = this.intervalMap.get(listenerGUID);\r\n        if (intervalId) {\r\n          clearInterval(intervalId);\r\n          this.intervalMap.delete(listenerGUID);\r\n        }\r\n\r\n        // Remove subscriber info\r\n        this.subscriberMap.delete(listenerGUID);\r\n      }\r\n    };\r\n  }\r\n\r\n  // Enhanced real-time subscription management\r\n  private startRealtimeSubscription(symbol: string, resolution: string, callback: (bar: Bar) => void, listenerGUID: string) {\r\n    // This is a simplified implementation using polling\r\n    // In production, you would use WebSocket connections for real-time data\r\n\r\n    const interval = setInterval(() => {\r\n      // Fetch latest price data\r\n      const request: ChartDataRequest = {\r\n        symbol: symbol,\r\n        resolution: resolution,\r\n        from: Math.floor(Date.now() / 1000) - 300, // Last 5 minutes\r\n        to: Math.floor(Date.now() / 1000),\r\n        firstDataRequest: false\r\n      };\r\n\r\n      this.getChartData(request).subscribe({\r\n        next: (response) => {\r\n          if (response.s === 'ok' && response.t && response.t.length > 0) {\r\n            const lastIndex = response.t.length - 1;\r\n            const bar: Bar = {\r\n              time: response.t[lastIndex] * 1000, // Convert to milliseconds\r\n              open: response.o![lastIndex],\r\n              high: response.h![lastIndex],\r\n              low: response.l![lastIndex],\r\n              close: response.c![lastIndex],\r\n              volume: response.v ? response.v[lastIndex] : 0\r\n            };\r\n\r\n            // Only call callback if subscriber still exists\r\n            if (this.subscriberMap.has(listenerGUID)) {\r\n              callback(bar);\r\n            }\r\n          }\r\n        },\r\n        error: (error) => {\r\n          console.error('Real-time data error for', symbol, ':', error);\r\n        }\r\n      });\r\n    }, 5000); // Update every 5 seconds\r\n\r\n    // Store interval ID for cleanup\r\n    this.intervalMap.set(listenerGUID, interval);\r\n  }\r\n\r\n  // Cleanup all subscriptions (call on component destroy)\r\n  cleanupAllSubscriptions() {\r\n    this.intervalMap.forEach(intervalId => clearInterval(intervalId));\r\n    this.intervalMap.clear();\r\n    this.subscriberMap.clear();\r\n  }\r\n\r\n  // Get current market data\r\n  getCurrentPrice(symbol: string): Observable<number> {\r\n    return this.getChartData({\r\n      symbol: symbol,\r\n      resolution: '1',\r\n      from: Math.floor(Date.now() / 1000) - 60,\r\n      to: Math.floor(Date.now() / 1000)\r\n    }).pipe(\r\n      map(response => {\r\n        if (response.s === 'ok' && response.c && response.c.length > 0) {\r\n          return response.c[response.c.length - 1];\r\n        }\r\n        throw new Error('No price data available');\r\n      }),\r\n      catchError(error => {\r\n        console.error('Failed to get current price:', error);\r\n        throw error;\r\n      })\r\n    );\r\n  }\r\n\r\n  // Helper method to format price with appropriate decimal places\r\n  formatPrice(price: number, symbol: string): string {\r\n    // Default to 2 decimal places for USDT pairs, adjust as needed\r\n    const decimals = symbol.includes('USDT') ? 2 : 8;\r\n    return price.toFixed(decimals);\r\n  }\r\n\r\n  // Helper method to format volume\r\n  formatVolume(volume: number): string {\r\n    if (volume >= 1e9) {\r\n      return (volume / 1e9).toFixed(2) + 'B';\r\n    } else if (volume >= 1e6) {\r\n      return (volume / 1e6).toFixed(2) + 'M';\r\n    } else if (volume >= 1e3) {\r\n      return (volume / 1e3).toFixed(2) + 'K';\r\n    }\r\n    return volume.toFixed(2);\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\services\\exchange-credentials.service.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Signal' is defined but never used.","line":1,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'WritableSignal' is defined but never used.","line":1,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'effect' is defined but never used.","line":1,"column":64,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":70},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'take' is defined but never used.","line":3,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":26},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .error on an `any` value.","line":333,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":333,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":334,"column":7,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":334,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .error on an `any` value.","line":334,"column":34,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":334,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":335,"column":29,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":335,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":336,"column":7,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":336,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":336,"column":34,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":336,"endColumn":41}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Injectable, Signal, WritableSignal, signal, computed, effect } from '@angular/core';\r\nimport { HttpClient, HttpErrorResponse } from '@angular/common/http';\r\nimport { Observable, take, throwError } from 'rxjs';\r\nimport { catchError, tap, map } from 'rxjs/operators';\r\nimport { getEndpointUrl, getParameterizedUrl } from '../config/app.config';\r\nimport {\r\n  ExchangeCredential,\r\n  ExchangeType,\r\n  CreateExchangeCredentialRequest,\r\n  UpdateExchangeCredentialRequest,\r\n  ExchangeCredentialResponse,\r\n  ExchangeCredentialsListResponse,\r\n  TestConnectionRequest,\r\n  TestConnectionResponse\r\n} from '../models/exchange-credentials.model';\r\n\r\n/**\r\n * Service to manage exchange credentials for multiple exchanges and environments.\r\n *\r\n * This service provides:\r\n * - CRUD operations for exchange credentials\r\n * - Connection testing\r\n * - Active credential management\r\n * - Environment-aware state synchronization\r\n * - Reactive state via Angular signals\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ExchangeCredentialsService {\r\n  // ============================================================================\r\n  // SIGNALS - State Management\r\n  // ============================================================================\r\n\r\n  private readonly _credentials = signal<ExchangeCredential[]>([]);\r\n  public readonly credentials = this._credentials.asReadonly();\r\n\r\n  private readonly _activeCredential = signal<ExchangeCredential | null>(null);\r\n  public readonly activeCredential = this._activeCredential.asReadonly();\r\n\r\n  private readonly _loading = signal<boolean>(false);\r\n  public readonly loading = this._loading.asReadonly();\r\n\r\n  private readonly _error = signal<string | null>(null);\r\n  public readonly error = this._error.asReadonly();\r\n\r\n  // ============================================================================\r\n  // COMPUTED SIGNALS - Derived State\r\n  // ============================================================================\r\n\r\n  public readonly hasCredentials = computed(() => this.credentials().length > 0);\r\n\r\n  public readonly activeExchange = computed(() =>\r\n    this.activeCredential()?.exchange ?? null\r\n  );\r\n\r\n  public readonly credentialsByExchange = computed(() =>\r\n    this.groupByExchange(this.credentials())\r\n  );\r\n\r\n  public readonly credentialCountByExchange = computed(() => {\r\n    const grouped = this.credentialsByExchange();\r\n    const counts = new Map<ExchangeType, number>();\r\n\r\n    grouped.forEach((creds, exchange) => {\r\n      counts.set(exchange, creds.length);\r\n    });\r\n\r\n    return counts;\r\n  });\r\n\r\n  public readonly availableExchanges = computed(() =>\r\n    Array.from(this.credentialsByExchange().keys())\r\n  );\r\n\r\n  // ============================================================================\r\n  // CONSTRUCTOR\r\n  // ============================================================================\r\n\r\n  constructor(\r\n    private http: HttpClient\r\n  ) {\r\n    // Credentials service manages exchange credentials\r\n  }\r\n\r\n  // ============================================================================\r\n  // PUBLIC METHODS - CRUD Operations\r\n  // ============================================================================\r\n\r\n  /**\r\n   * Fetch all credentials from the backend\r\n   * Returns credentials for all environments\r\n   */\r\n  public fetchCredentials(): Observable<ExchangeCredential[]> {\r\n    this._loading.set(true);\r\n    this._error.set(null);\r\n\r\n    const url = getEndpointUrl('exchangeCredentials', 'list');\r\n\r\n    return this.http.get<ExchangeCredentialsListResponse>(url).pipe(\r\n      tap(response => {\r\n        console.log('[ExchangeCredentialsService] Fetched credentials:', response.data.credentials.length);\r\n        this.updateCredentialsState(response.data.credentials);\r\n        this._loading.set(false);\r\n      }),\r\n      map(response => response.data.credentials),\r\n      catchError(error => {\r\n        this._loading.set(false);\r\n        return this.handleError(error, 'Failed to fetch credentials');\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get a single credential by ID\r\n   */\r\n  public getCredentialById(id: string): Observable<ExchangeCredential> {\r\n    this._error.set(null);\r\n\r\n    const url = getParameterizedUrl('exchangeCredentials', 'getById', { id });\r\n\r\n    return this.http.get<ExchangeCredentialResponse>(url).pipe(\r\n      map(response => response.data),\r\n      catchError(error => {\r\n        return this.handleError(error, 'Failed to fetch credential');\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Create a new exchange credential\r\n   */\r\n  public createCredential(data: CreateExchangeCredentialRequest): Observable<ExchangeCredential> {\r\n    this._error.set(null);\r\n\r\n    const url = getEndpointUrl('exchangeCredentials', 'create');\r\n\r\n    return this.http.post<ExchangeCredentialResponse>(url, data).pipe(\r\n      tap(response => {\r\n        console.log('[ExchangeCredentialsService] Created credential:', response.data.id);\r\n\r\n        // Add new credential to existing list\r\n        const updatedCredentials = [...this.credentials(), response.data];\r\n        this._credentials.set(updatedCredentials);\r\n      }),\r\n      map(response => response.data),\r\n      catchError(error => {\r\n        return this.handleError(error, 'Failed to create credential');\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Update an existing credential (label, apiKey, apiSecret, isActive)\r\n   * Note: isActive is just a boolean flag - no automatic deactivation of other credentials\r\n   */\r\n  public updateCredential(\r\n    id: string,\r\n    data: UpdateExchangeCredentialRequest\r\n  ): Observable<ExchangeCredential> {\r\n    this._error.set(null);\r\n\r\n    const url = getParameterizedUrl('exchangeCredentials', 'update', { id });\r\n\r\n    return this.http.patch<ExchangeCredentialResponse>(url, data).pipe(\r\n      tap(response => {\r\n        console.log('[ExchangeCredentialsService] Updated credential:', id);\r\n\r\n        // Update the specific credential in the list\r\n        const currentCredentials = this.credentials();\r\n        const index = currentCredentials.findIndex(cred => cred.id === id);\r\n\r\n        if (index !== -1) {\r\n          const updatedCredentials = [...currentCredentials];\r\n          updatedCredentials[index] = response.data;\r\n          this._credentials.set(updatedCredentials);\r\n        }\r\n\r\n        // Update active credential reference if needed\r\n        if (this.activeCredential()?.id === id) {\r\n          this._activeCredential.set(response.data);\r\n        }\r\n      }),\r\n      map(response => response.data),\r\n      catchError(error => {\r\n        return this.handleError(error, 'Failed to update credential');\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Delete a credential\r\n   */\r\n  public deleteCredential(id: string): Observable<void> {\r\n    this._error.set(null);\r\n\r\n    const url = getParameterizedUrl('exchangeCredentials', 'delete', { id });\r\n\r\n    return this.http.delete<{ success: boolean }>(url).pipe(\r\n      tap(() => {\r\n        console.log('[ExchangeCredentialsService] Deleted credential:', id);\r\n\r\n        // Remove credential from list\r\n        const updatedCredentials = this.credentials().filter(cred => cred.id !== id);\r\n        this._credentials.set(updatedCredentials);\r\n\r\n        // Clear active credential if it was deleted\r\n        if (this.activeCredential()?.id === id) {\r\n          this._activeCredential.set(null);\r\n        }\r\n      }),\r\n      map(() => undefined),\r\n      catchError(error => {\r\n        return this.handleError(error, 'Failed to delete credential');\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Activate a credential (set as active for its exchange and environment)\r\n   * This now uses updateCredential with isActive: true\r\n   */\r\n  public activateCredential(id: string): Observable<ExchangeCredential> {\r\n    return this.updateCredential(id, { isActive: true });\r\n  }\r\n\r\n  // ============================================================================\r\n  // PUBLIC METHODS - Utility Functions\r\n  // ============================================================================\r\n\r\n  /**\r\n   * Test credential connection before saving\r\n   */\r\n  public testConnection(data: TestConnectionRequest): Observable<TestConnectionResponse> {\r\n    this._error.set(null);\r\n\r\n    const url = getEndpointUrl('exchangeCredentials', 'testConnection');\r\n\r\n    return this.http.post<TestConnectionResponse>(url, data).pipe(\r\n      tap(response => {\r\n        console.log('[ExchangeCredentialsService] Connection test result:', response.success);\r\n      }),\r\n      catchError(error => {\r\n        return this.handleError(error, 'Failed to test connection');\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get all credentials for a specific exchange\r\n   */\r\n  public getCredentialsForExchange(exchange: ExchangeType): ExchangeCredential[] {\r\n    return this.credentials().filter(cred => cred.exchange === exchange);\r\n  }\r\n\r\n  /**\r\n   * Get active credential for a specific exchange\r\n   */\r\n  public getActiveCredentialForExchange(exchange: ExchangeType): ExchangeCredential | null {\r\n    return this.credentials().find(cred => cred.exchange === exchange && cred.isActive) ?? null;\r\n  }\r\n\r\n  /**\r\n   * Check if user has credentials for a specific exchange\r\n   */\r\n  public hasCredentialsForExchange(exchange: ExchangeType): boolean {\r\n    return this.credentials().some(cred => cred.exchange === exchange);\r\n  }\r\n\r\n  /**\r\n   * Refresh credentials (re-fetch from backend)\r\n   */\r\n  public refreshCredentials(): void {\r\n    this.fetchCredentials().subscribe({\r\n      error: (err) => console.error('Failed to refresh credentials:', err)\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Clear error state\r\n   */\r\n  public clearError(): void {\r\n    this._error.set(null);\r\n  }\r\n\r\n  /**\r\n   * Clear all state (useful for logout)\r\n   */\r\n  public clearState(): void {\r\n    this._credentials.set([]);\r\n    this._activeCredential.set(null);\r\n    this._loading.set(false);\r\n    this._error.set(null);\r\n  }\r\n\r\n  // ============================================================================\r\n  // PRIVATE METHODS - Internal Helpers\r\n  // ============================================================================\r\n\r\n  /**\r\n   * Group credentials by exchange\r\n   */\r\n  private groupByExchange(credentials: ExchangeCredential[]): Map<ExchangeType, ExchangeCredential[]> {\r\n    const grouped = new Map<ExchangeType, ExchangeCredential[]>();\r\n\r\n    credentials.forEach(cred => {\r\n      const existing = grouped.get(cred.exchange) ?? [];\r\n      grouped.set(cred.exchange, [...existing, cred]);\r\n    });\r\n\r\n    return grouped;\r\n  }\r\n\r\n  /**\r\n   * Update internal state with new credentials\r\n   */\r\n  private updateCredentialsState(credentials: ExchangeCredential[]): void {\r\n    this._credentials.set(credentials);\r\n\r\n    // Find and set active credential (if any)\r\n    const active = credentials.find(cred => cred.isActive) ?? null;\r\n    this._activeCredential.set(active);\r\n  }\r\n\r\n  /**\r\n   * Centralized error handling\r\n   */\r\n  private handleError(error: HttpErrorResponse, context: string): Observable<never> {\r\n    console.error(`[ExchangeCredentialsService] ${context}:`, error);\r\n\r\n    let errorMessage = 'An unexpected error occurred';\r\n\r\n    if (error.error?.error?.message) {\r\n      errorMessage = error.error.error.message;\r\n    } else if (error.error?.message) {\r\n      errorMessage = error.error.message;\r\n    } else if (error.status === 0) {\r\n      errorMessage = 'Unable to connect to server. Please check your internet connection.';\r\n    } else if (error.status === 401) {\r\n      errorMessage = 'Authentication failed. Please log in again.';\r\n    } else if (error.status === 403) {\r\n      errorMessage = 'You do not have permission to perform this action.';\r\n    } else if (error.status === 404) {\r\n      errorMessage = 'The requested credential was not found.';\r\n    } else if (error.status === 409) {\r\n      errorMessage = 'A credential for this exchange and environment already exists.';\r\n    } else if (error.status === 422) {\r\n      errorMessage = 'Invalid data provided. Please check your input.';\r\n    } else if (error.status >= 500) {\r\n      errorMessage = 'Server error. Please try again later.';\r\n    } else if (error.message) {\r\n      errorMessage = error.message;\r\n    }\r\n\r\n    this._error.set(errorMessage);\r\n    return throwError(() => new Error(errorMessage));\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\services\\funding-arbitrage.service.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'HttpHeaders' is defined but never used.","line":2,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'map' is defined but never used.","line":4,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":317,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":317,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":318,"column":7,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":318,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":318,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":318,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":334,"column":7,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":334,"endColumn":68},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":334,"column":27,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":334,"endColumn":34}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Injectable } from '@angular/core';\r\nimport { HttpClient, HttpHeaders, HttpErrorResponse } from '@angular/common/http';\r\nimport { Observable, throwError, BehaviorSubject } from 'rxjs';\r\nimport { catchError, map, tap } from 'rxjs/operators';\r\nimport { getEndpointUrl, buildUrlWithQuery } from '../config/app.config';\r\n\r\n/**\r\n * Individual Deal Information\r\n */\r\nexport interface FundingArbitrageDeal {\r\n  id: string;\r\n  symbol: string;\r\n  primaryExchange: string;\r\n  hedgeExchange: string;\r\n  fundingRate: number;\r\n  positionType: 'long' | 'short';\r\n  quantity: number;\r\n  entryPrice: number;\r\n  hedgeEntryPrice: number;\r\n  primaryExitPrice: number | null;\r\n  hedgeExitPrice: number | null;\r\n  fundingEarned: number;\r\n  realizedPnl: number;\r\n  primaryTradingFees: number;\r\n  hedgeTradingFees: number;\r\n  executedAt: string | null;\r\n  closedAt: string | null;\r\n  duration: number | null; // in seconds\r\n}\r\n\r\n/**\r\n * Best/Worst Deal Summary\r\n */\r\nexport interface DealSummary {\r\n  symbol: string;\r\n  revenue: number;\r\n  date: string | null;\r\n}\r\n\r\n/**\r\n * Revenue Summary Statistics\r\n */\r\nexport interface RevenueSummary {\r\n  totalDeals: number;\r\n  totalRevenue: number;\r\n  totalFundingEarned: number;\r\n  totalTradingPnl: number;\r\n  avgRevenuePerDeal: number;\r\n  winRate: number;\r\n  profitableDeals: number;\r\n  losingDeals: number;\r\n  bestDeal: DealSummary | null;\r\n  worstDeal: DealSummary | null;\r\n}\r\n\r\n/**\r\n * Revenue By Symbol\r\n */\r\nexport interface RevenueBySymbol {\r\n  symbol: string;\r\n  deals: number;\r\n  revenue: number;\r\n  avgRevenue: number;\r\n  fundingEarned: number;\r\n}\r\n\r\n/**\r\n * Revenue By Exchange\r\n */\r\nexport interface RevenueByExchange {\r\n  exchange: string;\r\n  deals: number;\r\n  revenue: number;\r\n  avgRevenue: number;\r\n}\r\n\r\n/**\r\n * Daily Revenue Timeline\r\n */\r\nexport interface RevenueTimeline {\r\n  date: string; // YYYY-MM-DD\r\n  deals: number;\r\n  revenue: number;\r\n  fundingEarned: number;\r\n}\r\n\r\n/**\r\n * Applied Filters\r\n */\r\nexport interface RevenueFilters {\r\n  startDate: string;\r\n  endDate: string;\r\n  exchange: string | null;\r\n  symbol: string | null;\r\n}\r\n\r\n/**\r\n * Complete Revenue Response\r\n */\r\nexport interface FundingArbitrageRevenueResponse {\r\n  success: boolean;\r\n  data: {\r\n    summary: RevenueSummary;\r\n    bySymbol: RevenueBySymbol[];\r\n    byExchange: RevenueByExchange[];\r\n    deals: FundingArbitrageDeal[];\r\n    timeline: RevenueTimeline[];\r\n  };\r\n  filters: RevenueFilters;\r\n  timestamp: string;\r\n}\r\n\r\n/**\r\n * Subscribe to Hedged Arbitrage Request Parameters\r\n */\r\nexport interface FundingArbitrageSubscribeRequest {\r\n  symbol: string;\r\n  fundingRate: number;\r\n  nextFundingTime: number;\r\n  positionType: 'long' | 'short';\r\n  quantity: number;\r\n  primaryCredentialId: string;\r\n  hedgeExchange: string;\r\n  hedgeCredentialId: string;\r\n  leverage: number;\r\n  margin: number;\r\n  mode: 'HEDGED';\r\n}\r\n\r\n/**\r\n * Subscribe Response\r\n */\r\nexport interface FundingArbitrageSubscribeResponse {\r\n  success: boolean;\r\n  data: {\r\n    subscriptionId: string;\r\n    symbol: string;\r\n    fundingRate: number;\r\n    nextFundingTime: number;\r\n    positionType: string;\r\n    quantity: number;\r\n    leverage: number;\r\n    margin: number;\r\n    status: string;\r\n    createdAt: string;\r\n  };\r\n  message: string;\r\n  timestamp: string;\r\n}\r\n\r\n/**\r\n * Funding Arbitrage Service\r\n *\r\n * Handles all funding arbitrage revenue operations including:\r\n * - Fetching revenue statistics\r\n * - Filtering by date range, exchange, and symbol\r\n * - Managing revenue state with reactive BehaviorSubjects\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class FundingArbitrageService {\r\n  private revenueSubject = new BehaviorSubject<FundingArbitrageRevenueResponse | null>(null);\r\n  private loadingSubject = new BehaviorSubject<boolean>(false);\r\n  private errorSubject = new BehaviorSubject<string | null>(null);\r\n\r\n  public readonly revenue$ = this.revenueSubject.asObservable();\r\n  public readonly loading$ = this.loadingSubject.asObservable();\r\n  public readonly error$ = this.errorSubject.asObservable();\r\n\r\n  constructor(private http: HttpClient) {}\r\n\r\n  /**\r\n   * Get comprehensive revenue statistics for funding arbitrage\r\n   * @param startDate - Optional start date (ISO string)\r\n   * @param endDate - Optional end date (ISO string)\r\n   * @param exchange - Optional exchange filter\r\n   * @param symbol - Optional symbol filter\r\n   * @returns Observable<FundingArbitrageRevenueResponse>\r\n   */\r\n  getRevenue(\r\n    startDate?: string,\r\n    endDate?: string,\r\n    exchange?: string,\r\n    symbol?: string\r\n  ): Observable<FundingArbitrageRevenueResponse> {\r\n    this.loadingSubject.next(true);\r\n    this.errorSubject.next(null);\r\n\r\n    const baseUrl = getEndpointUrl('fundingArbitrage', 'revenue');\r\n    const params: Record<string, string> = {};\r\n\r\n    if (startDate) params['startDate'] = startDate;\r\n    if (endDate) params['endDate'] = endDate;\r\n    if (exchange) params['exchange'] = exchange;\r\n    if (symbol) params['symbol'] = symbol;\r\n\r\n    const url = Object.keys(params).length > 0 ? buildUrlWithQuery(baseUrl, params) : baseUrl;\r\n\r\n    return this.http.get<FundingArbitrageRevenueResponse>(url).pipe(\r\n      tap(response => {\r\n        this.revenueSubject.next(response);\r\n        this.loadingSubject.next(false);\r\n      }),\r\n      catchError(error => {\r\n        this.loadingSubject.next(false);\r\n        const errorMessage = this.handleError(error);\r\n        this.errorSubject.next(errorMessage);\r\n        return throwError(() => new Error(errorMessage));\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Refresh revenue data with current filters\r\n   */\r\n  refreshRevenue(): Observable<FundingArbitrageRevenueResponse> {\r\n    const currentRevenue = this.revenueSubject.value;\r\n    if (!currentRevenue) {\r\n      return this.getRevenue();\r\n    }\r\n\r\n    const filters = currentRevenue.filters;\r\n    return this.getRevenue(\r\n      filters.startDate,\r\n      filters.endDate,\r\n      filters.exchange || undefined,\r\n      filters.symbol || undefined\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Subscribe to funding arbitrage (start hedged arbitrage position)\r\n   * @param request - Subscription request parameters\r\n   * @returns Observable<FundingArbitrageSubscribeResponse>\r\n   */\r\n  subscribe(request: FundingArbitrageSubscribeRequest): Observable<FundingArbitrageSubscribeResponse> {\r\n    const url = getEndpointUrl('fundingArbitrage', 'subscribe');\r\n\r\n    return this.http.post<FundingArbitrageSubscribeResponse>(url, request).pipe(\r\n      catchError(error => {\r\n        const errorMessage = this.handleError(error);\r\n        return throwError(() => new Error(errorMessage));\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get current revenue data from cache (if available)\r\n   */\r\n  getCurrentRevenue(): FundingArbitrageRevenueResponse | null {\r\n    return this.revenueSubject.value;\r\n  }\r\n\r\n  /**\r\n   * Clear cached revenue data\r\n   */\r\n  clearRevenue(): void {\r\n    this.revenueSubject.next(null);\r\n    this.errorSubject.next(null);\r\n  }\r\n\r\n  /**\r\n   * Check if revenue data is currently loading\r\n   */\r\n  isLoading(): boolean {\r\n    return this.loadingSubject.value;\r\n  }\r\n\r\n  /**\r\n   * Get current error (if any)\r\n   */\r\n  getCurrentError(): string | null {\r\n    return this.errorSubject.value;\r\n  }\r\n\r\n  /**\r\n   * Calculate total fees from deals\r\n   */\r\n  calculateTotalFees(deals: FundingArbitrageDeal[]): number {\r\n    return deals.reduce(\r\n      (total, deal) => total + deal.primaryTradingFees + deal.hedgeTradingFees,\r\n      0\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Calculate net profit (revenue - fees)\r\n   */\r\n  calculateNetProfit(totalRevenue: number, totalFees: number): number {\r\n    return totalRevenue - totalFees;\r\n  }\r\n\r\n  /**\r\n   * Format duration in seconds to human-readable string\r\n   */\r\n  formatDuration(seconds: number): string {\r\n    const hours = Math.floor(seconds / 3600);\r\n    const minutes = Math.floor((seconds % 3600) / 60);\r\n    const secs = seconds % 60;\r\n\r\n    if (hours > 0) {\r\n      return `${hours}h ${minutes}m`;\r\n    } else if (minutes > 0) {\r\n      return `${minutes}m ${secs}s`;\r\n    } else {\r\n      return `${secs}s`;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle HTTP errors and return user-friendly messages\r\n   */\r\n  private handleError(error: HttpErrorResponse): string {\r\n    console.error('Funding Arbitrage Service Error:', error);\r\n\r\n    if (error.error?.message) {\r\n      return error.error.message;\r\n    }\r\n\r\n    if (error.status === 0) {\r\n      return 'Unable to connect to the server. Please check your internet connection.';\r\n    }\r\n\r\n    if (error.status === 401) {\r\n      return 'Unauthorized. Please log in again.';\r\n    }\r\n\r\n    if (error.status === 403) {\r\n      return 'Access forbidden. You do not have permission to view this data.';\r\n    }\r\n\r\n    if (error.status === 400) {\r\n      return error.error?.message || 'Invalid request parameters.';\r\n    }\r\n\r\n    if (error.status >= 500) {\r\n      return 'Server error. Please try again later.';\r\n    }\r\n\r\n    return error.message || 'An unexpected error occurred. Please try again.';\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\services\\google-auth.service.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[420,423],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[420,423],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":55,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":55,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":71,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":71,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":93,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":93,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":114,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":114,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":131,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":131,"endColumn":38},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":142,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":142,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4286,4289],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4286,4289],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .google on an `any` value.","line":142,"column":59,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":142,"endColumn":65},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":151,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4632,4635],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4632,4635],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .google on an `any` value.","line":151,"column":32,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":151,"endColumn":38},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":157,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":157,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4818,4821],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4818,4821],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .google on an `any` value.","line":157,"column":58,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":157,"endColumn":64},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":158,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":158,"endColumn":52},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":158,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":158,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4851,4854],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4851,4854],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .google on an `any` value.","line":158,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":158,"endColumn":29},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":160,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":160,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4966,4969],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4966,4969],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `any` typed value.","line":165,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":165,"endColumn":54},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":165,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":165,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5076,5079],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5076,5079],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .google on an `any` value.","line":165,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":165,"endColumn":29},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":178,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":178,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5409,5412],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5409,5412],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":180,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":180,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .credential on an `any` value.","line":180,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":180,"endColumn":43}],"suppressedMessages":[],"errorCount":22,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Injectable, signal } from '@angular/core';\r\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\r\nimport { Observable, tap, catchError, throwError } from 'rxjs';\r\nimport { getEndpointUrl } from '../config/app.config';\r\nimport { AuthService } from './auth.service';\r\nimport { environment } from '../../environments/environment';\r\n\r\nexport interface GoogleAuthResponse {\r\n  success: boolean;\r\n  user?: any;\r\n  message?: string;\r\n}\r\n\r\nexport interface GoogleLinkResponse {\r\n  success: boolean;\r\n  message: string;\r\n  googleEmail?: string;\r\n  linkedAt?: Date;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class GoogleAuthService {\r\n  private isLinking = signal<boolean>(false);\r\n  private isUnlinking = signal<boolean>(false);\r\n\r\n  readonly isLinking$ = this.isLinking.asReadonly();\r\n  readonly isUnlinking$ = this.isUnlinking.asReadonly();\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private authService: AuthService\r\n  ) {}\r\n\r\n  private getAuthHeaders(): HttpHeaders {\r\n    const token = this.authService.authState().token;\r\n    return new HttpHeaders({\r\n      'Authorization': `Bearer ${token}`,\r\n      'Content-Type': 'application/json'\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Initiate Google OAuth login\r\n   * This should redirect to Google OAuth or return a URL for redirect\r\n   */\r\n  loginWithGoogle(): Observable<{ redirectUrl?: string; success?: boolean }> {\r\n    return this.http.post<{ redirectUrl?: string; success?: boolean }>(\r\n      getEndpointUrl('google', 'auth'),\r\n      {}\r\n    ).pipe(\r\n      catchError(error => {\r\n        console.error('Error initiating Google login:', error);\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Handle Google OAuth callback\r\n   * This processes the authorization code received from Google\r\n   */\r\n  handleGoogleCallback(code: string, state?: string): Observable<GoogleAuthResponse> {\r\n    return this.http.post<GoogleAuthResponse>(\r\n      `${getEndpointUrl('google', 'auth')}/callback`,\r\n      { code, state }\r\n    ).pipe(\r\n      catchError(error => {\r\n        console.error('Error handling Google callback:', error);\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Link existing account with Google\r\n   * For users who are already logged in and want to connect their Google account\r\n   */\r\n  linkGoogleAccount(googleToken?: string): Observable<GoogleLinkResponse> {\r\n    this.isLinking.set(true);\r\n    const headers = this.getAuthHeaders();\r\n    \r\n    return this.http.post<GoogleLinkResponse>(\r\n      getEndpointUrl('google', 'link'),\r\n      { googleToken },\r\n      { headers }\r\n    ).pipe(\r\n      tap(() => this.isLinking.set(false)),\r\n      catchError(error => {\r\n        this.isLinking.set(false);\r\n        console.error('Error linking Google account:', error);\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Unlink Google account from current user\r\n   */\r\n  unlinkGoogleAccount(): Observable<GoogleLinkResponse> {\r\n    this.isUnlinking.set(true);\r\n    const headers = this.getAuthHeaders();\r\n    \r\n    return this.http.post<GoogleLinkResponse>(\r\n      getEndpointUrl('google', 'unlink'),\r\n      {},\r\n      { headers }\r\n    ).pipe(\r\n      tap(() => this.isUnlinking.set(false)),\r\n      catchError(error => {\r\n        this.isUnlinking.set(false);\r\n        console.error('Error unlinking Google account:', error);\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get Google account linking status\r\n   */\r\n  getGoogleLinkStatus(): Observable<{ linked: boolean; googleEmail?: string; linkedAt?: Date }> {\r\n    const headers = this.getAuthHeaders();\r\n    \r\n    return this.http.get<{ linked: boolean; googleEmail?: string; linkedAt?: Date }>(\r\n      `${getEndpointUrl('google', 'link')}/status`,\r\n      { headers }\r\n    ).pipe(\r\n      catchError(error => {\r\n        console.error('Error getting Google link status:', error);\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Initialize Google Sign-In button\r\n   * This sets up the Google Sign-In button for client-side authentication\r\n   */\r\n  initializeGoogleSignIn(containerId: string): void {\r\n    // Load Google Sign-In script if not already loaded\r\n    if (typeof window !== 'undefined' && !(window as any).google) {\r\n      const script = document.createElement('script');\r\n      script.src = 'https://accounts.google.com/gsi/client';\r\n      script.async = true;\r\n      script.defer = true;\r\n      script.onload = () => {\r\n        this.renderGoogleButton(containerId);\r\n      };\r\n      document.head.appendChild(script);\r\n    } else if ((window as any).google) {\r\n      this.renderGoogleButton(containerId);\r\n    }\r\n  }\r\n\r\n  private renderGoogleButton(containerId: string): void {\r\n    if (typeof window !== 'undefined' && (window as any).google) {\r\n      (window as any).google.accounts.id.initialize({\r\n        client_id: environment.googleClientId,\r\n        callback: (response: any) => {\r\n          this.handleClientSideGoogleResponse(response);\r\n        }\r\n      });\r\n\r\n      (window as any).google.accounts.id.renderButton(\r\n        document.getElementById(containerId),\r\n        {\r\n          theme: 'outline',\r\n          size: 'large',\r\n          type: 'standard',\r\n          text: 'continue_with',\r\n          shape: 'rectangular'\r\n        }\r\n      );\r\n    }\r\n  }\r\n\r\n  private handleClientSideGoogleResponse(response: any): void {\r\n    // Handle the JWT token from Google\r\n    const credential = response.credential;\r\n    if (credential) {\r\n      this.linkGoogleAccount(credential).subscribe({\r\n        next: (result) => {\r\n          console.log('Google account linked successfully:', result);\r\n          // Update user data or show success message\r\n        },\r\n        error: (error) => {\r\n          console.error('Failed to link Google account:', error);\r\n          // Show error message\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create Google OAuth URL for manual redirect\r\n   */\r\n  createGoogleAuthUrl(redirectUri: string, state?: string): string {\r\n    const params = new URLSearchParams({\r\n      client_id: environment.googleClientId,\r\n      redirect_uri: redirectUri,\r\n      response_type: 'code',\r\n      scope: 'openid email profile',\r\n      access_type: 'offline',\r\n      prompt: 'consent'\r\n    });\r\n\r\n    if (state) {\r\n      params.append('state', state);\r\n    }\r\n\r\n    return `https://accounts.google.com/o/oauth2/v2/auth?${params.toString()}`;\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\services\\grid-bot.service.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[677,680],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[677,680],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[695,698],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[695,698],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":37,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[833,836],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[833,836],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":49,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1063,1066],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1063,1066],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":53,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1211,1214],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1211,1214],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":54,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1246,1249],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1246,1249],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1325,1328],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1325,1328],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":59,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1416,1419],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1416,1419],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":62,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1521,1524],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1521,1524],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":62,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1538,1541],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1538,1541],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":63,"column":38,"nodeType":"Property","messageId":"anyAssignment","endLine":63,"endColumn":44},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1619,1622],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1619,1622],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1708,1711],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1708,1711],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":69,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1802,1805],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1802,1805],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":77,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2064,2067],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2064,2067],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":78,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2099,2102],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2099,2102],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":81,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2188,2191],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2188,2191],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":83,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2289,2292],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2289,2292],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":86,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2391,2394],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2391,2394],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":88,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2495,2498],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2495,2498],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":92,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2641,2644],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2641,2644],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":98,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2821,2824],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2821,2824],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":111,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3309,3312],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3309,3312],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":116,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":116,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3440,3443],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3440,3443],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":119,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3551,3554],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3551,3554],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":124,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3693,3696],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3693,3696],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":128,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3797,3800],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3797,3800],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of type `Observable<any>` from function with return type `Observable<{ valid: boolean; warnings?: string[] | undefined; errors?: string[] | undefined; }>`.","line":129,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturnAssignment","endLine":129,"endColumn":74},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":129,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3903,3906],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3903,3906],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":132,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3990,3993],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3990,3993],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of type `Observable<any>` from function with return type `Observable<{ totalInvestment: number; gridSpacing: number; potentialProfit: number; maxDrawdown: number; }>`.","line":138,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturnAssignment","endLine":138,"endColumn":76},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":138,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4156,4159],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4156,4159],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":142,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":142,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4282,4285],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4282,4285],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":145,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4415,4418],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4415,4418],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of type `Observable<any>` from function with return type `Observable<{ totalValue: number; totalPnL: number; activeBots: number; totalTrades: number; avgWinRate: number; }>`.","line":156,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturnAssignment","endLine":156,"endColumn":67},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":156,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":156,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4690,4693],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4690,4693],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":159,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":159,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4794,4797],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4794,4797],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":161,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":161,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4889,4892],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4889,4892],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":165,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":165,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5031,5034],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5031,5034],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":167,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":167,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5151,5154],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5151,5154],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":170,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":170,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5251,5254],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5251,5254],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":171,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":171,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5284,5287],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5284,5287],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":181,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5565,5568],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5565,5568],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":185,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":185,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5677,5680],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5677,5680],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":189,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":189,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5807,5810],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5807,5810],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":190,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":190,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5841,5844],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5841,5844],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of type `Observable<any>` from function with return type `Observable<{ suggestedUpperPrice: number; suggestedLowerPrice: number; suggestedGridLevels: number; suggestedOrderSize: number; reasoning: string; }>`.","line":204,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturnAssignment","endLine":204,"endColumn":84},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":204,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":204,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6274,6277],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6274,6277],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":48,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Injectable } from '@angular/core';\r\nimport { HttpClient, HttpParams } from '@angular/common/http';\r\nimport { Observable } from 'rxjs';\r\nimport { environment } from '../../environments/environment';\r\n\r\nexport interface GridBotResponse {\r\n  success: boolean;\r\n  botId?: string;\r\n  status?: string;\r\n  error?: string;\r\n}\r\n\r\nexport interface BacktestRequest {\r\n  symbol: string;\r\n  timeframe: string;\r\n  startDate: string;\r\n  endDate: string;\r\n  gridConfig: {\r\n    upperPrice: number;\r\n    lowerPrice: number;\r\n    gridLevels: number;\r\n    orderSize: number;\r\n    maxActiveOrders?: number;\r\n    stopLoss?: number;\r\n    takeProfit?: number;\r\n  };\r\n  filters: {\r\n    entry: any[];\r\n    exit: any[];\r\n  };\r\n  initialBalance: number;\r\n}\r\n\r\nexport interface BacktestResponse {\r\n  success: boolean;\r\n  backtestId: string;\r\n  results: any;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class GridBotService {\r\n  private apiUrl = `${environment.apiUrl}/trading`;\r\n\r\n  constructor(private http: HttpClient) {}\r\n\r\n  // Grid Bot Management\r\n  createBot(config: any): Observable<GridBotResponse> {\r\n    return this.http.post<GridBotResponse>(`${this.apiUrl}/grid-bot`, config);\r\n  }\r\n\r\n  getBots(): Observable<any[]> {\r\n    return this.http.get<any[]>(`${this.apiUrl}/grid-bot`);\r\n  }\r\n\r\n  getBot(botId: string): Observable<any> {\r\n    const params = new HttpParams().set('botId', botId);\r\n    return this.http.get<any>(`${this.apiUrl}/grid-bot`, { params });\r\n  }\r\n\r\n  updateBot(botId: string, action: string, config?: any): Observable<any> {\r\n    const payload = { botId, action, config };\r\n    return this.http.put<any>(`${this.apiUrl}/grid-bot`, payload);\r\n  }\r\n\r\n  deleteBot(botId: string): Observable<any> {\r\n    const params = new HttpParams().set('botId', botId);\r\n    return this.http.delete<any>(`${this.apiUrl}/grid-bot`, { params });\r\n  }\r\n\r\n  // Backtesting\r\n  runBacktest(request: BacktestRequest): Observable<BacktestResponse> {\r\n    return this.http.post<BacktestResponse>(`${this.apiUrl}/backtest`, request);\r\n  }\r\n\r\n  getBacktests(): Observable<any[]> {\r\n    return this.http.get<any[]>(`${this.apiUrl}/backtest`);\r\n  }\r\n\r\n  getBacktest(backtestId: string): Observable<any> {\r\n    const params = new HttpParams().set('backtestId', backtestId);\r\n    return this.http.get<any>(`${this.apiUrl}/backtest`, { params });\r\n  }\r\n\r\n  deleteBacktest(backtestId: string): Observable<any> {\r\n    const params = new HttpParams().set('backtestId', backtestId);\r\n    return this.http.delete<any>(`${this.apiUrl}/backtest`, { params });\r\n  }\r\n\r\n  // Market Data\r\n  getMarketData(symbol: string, timeframe = '1h', limit = 100): Observable<any[]> {\r\n    const params = new HttpParams()\r\n      .set('symbol', symbol)\r\n      .set('timeframe', timeframe)\r\n      .set('limit', limit.toString());\r\n\r\n    return this.http.get<any[]>(`${this.apiUrl}/market-data`, { params });\r\n  }\r\n\r\n  getCurrentPrice(symbol: string): Observable<{ price: number }> {\r\n    const params = new HttpParams().set('symbol', symbol);\r\n    return this.http.get<{ price: number }>(`${this.apiUrl}/market-data/price`, { params });\r\n  }\r\n\r\n  getSymbols(): Observable<string[]> {\r\n    return this.http.get<string[]>(`${this.apiUrl}/symbols`);\r\n  }\r\n\r\n  // Performance Analytics\r\n  getBotPerformance(botId: string, period = '24h'): Observable<any> {\r\n    const params = new HttpParams()\r\n      .set('botId', botId)\r\n      .set('period', period);\r\n\r\n    return this.http.get<any>(`${this.apiUrl}/performance`, { params });\r\n  }\r\n\r\n  getBotTrades(botId: string, limit = 100): Observable<any[]> {\r\n    const params = new HttpParams()\r\n      .set('botId', botId)\r\n      .set('limit', limit.toString());\r\n\r\n    return this.http.get<any[]>(`${this.apiUrl}/trades`, { params });\r\n  }\r\n\r\n  // Risk Management\r\n  validateGridConfig(config: any): Observable<{ valid: boolean; warnings?: string[]; errors?: string[] }> {\r\n    return this.http.post<any>(`${this.apiUrl}/validate-config`, config);\r\n  }\r\n\r\n  calculateGridMetrics(config: any): Observable<{\r\n    totalInvestment: number;\r\n    gridSpacing: number;\r\n    potentialProfit: number;\r\n    maxDrawdown: number;\r\n  }> {\r\n    return this.http.post<any>(`${this.apiUrl}/calculate-metrics`, config);\r\n  }\r\n\r\n  // Real-time Updates\r\n  subscribeToBot(botId: string): Observable<any> {\r\n    // This would typically use WebSocket or Server-Sent Events\r\n    // For now, we'll use polling\r\n    return this.http.get<any>(`${this.apiUrl}/bot-status/${botId}`);\r\n  }\r\n\r\n  // Portfolio Management\r\n  getPortfolioSummary(): Observable<{\r\n    totalValue: number;\r\n    totalPnL: number;\r\n    activeBots: number;\r\n    totalTrades: number;\r\n    avgWinRate: number;\r\n  }> {\r\n    return this.http.get<any>(`${this.apiUrl}/portfolio/summary`);\r\n  }\r\n\r\n  getPortfolioPerformance(period = '30d'): Observable<any[]> {\r\n    const params = new HttpParams().set('period', period);\r\n    return this.http.get<any[]>(`${this.apiUrl}/portfolio/performance`, { params });\r\n  }\r\n\r\n  // Alerts and Notifications\r\n  getBotAlerts(botId?: string): Observable<any[]> {\r\n    const params = botId ? new HttpParams().set('botId', botId) : new HttpParams();\r\n    return this.http.get<any[]>(`${this.apiUrl}/alerts`, { params });\r\n  }\r\n\r\n  markAlertAsRead(alertId: string): Observable<any> {\r\n    return this.http.put<any>(`${this.apiUrl}/alerts/${alertId}/read`, {});\r\n  }\r\n\r\n  // Export/Import\r\n  exportBotConfig(botId: string): Observable<Blob> {\r\n    return this.http.get(`${this.apiUrl}/export/${botId}`, {\r\n      responseType: 'blob'\r\n    });\r\n  }\r\n\r\n  importBotConfig(file: File): Observable<any> {\r\n    const formData = new FormData();\r\n    formData.append('config', file);\r\n\r\n    return this.http.post<any>(`${this.apiUrl}/import`, formData);\r\n  }\r\n\r\n  // Advanced Analytics\r\n  getCorrelationAnalysis(symbols: string[]): Observable<any> {\r\n    return this.http.post<any>(`${this.apiUrl}/analytics/correlation`, { symbols });\r\n  }\r\n\r\n  getOptimalGridParameters(symbol: string, period = '30d'): Observable<{\r\n    suggestedUpperPrice: number;\r\n    suggestedLowerPrice: number;\r\n    suggestedGridLevels: number;\r\n    suggestedOrderSize: number;\r\n    reasoning: string;\r\n  }> {\r\n    const params = new HttpParams()\r\n      .set('symbol', symbol)\r\n      .set('period', period);\r\n\r\n    return this.http.get<any>(`${this.apiUrl}/analytics/optimal-grid`, { params });\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\services\\manual-trading.service.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'map' is defined but never used.","line":4,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'retry' is defined but never used.","line":4,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'switchMap' is defined but never used.","line":4,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":48},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":426,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":426,"endColumn":88},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":426,"column":42,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":426,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .error on an `any` value.","line":426,"column":66,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":426,"endColumn":71},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":433,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":433,"endColumn":25}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Injectable, signal, computed } from '@angular/core';\r\nimport { HttpClient, HttpParams, HttpErrorResponse } from '@angular/common/http';\r\nimport { Observable, throwError, BehaviorSubject, interval } from 'rxjs';\r\nimport { tap, catchError, map, retry, switchMap, shareReplay } from 'rxjs/operators';\r\nimport {\r\n  OrderRequest,\r\n  OrderResponse,\r\n  Position,\r\n  Order,\r\n  Balance,\r\n  ClosePositionRequest,\r\n  CancelOrderRequest,\r\n  SymbolInfo,\r\n  TradingSymbol,\r\n  Exchange,\r\n  PaginatedResponse,\r\n  PaginationParams\r\n} from '../models/trading.model';\r\n\r\n/**\r\n * Manual Trading Service\r\n *\r\n * Comprehensive service for manual cryptocurrency trading operations.\r\n * Handles order placement, position management, balance tracking, and real-time updates.\r\n *\r\n * Features:\r\n * - Place market and limit orders\r\n * - Manage open positions\r\n * - Track order history\r\n * - Monitor account balance\r\n * - Support for multiple exchanges\r\n * - Real-time data updates preparation (WebSocket-ready)\r\n * - Error handling with retry logic\r\n * - Loading state management with Angular Signals\r\n *\r\n * @example\r\n * ```typescript\r\n * // Place a limit buy order\r\n * const order: OrderRequest = {\r\n *   exchange: 'bybit',\r\n *   symbol: 'BTCUSDT',\r\n *   side: 'Buy',\r\n *   type: 'Limit',\r\n *   quantity: 0.001,\r\n *   price: 50000,\r\n *   timeInForce: 'GTC'\r\n * };\r\n * this.tradingService.placeOrder(order).subscribe(response => {\r\n *   console.log('Order placed:', response);\r\n * });\r\n * ```\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ManualTradingService {\r\n  private readonly baseUrl = 'http://localhost:3000/api';\r\n\r\n  // Loading states using Angular Signals\r\n  private loadingStates = {\r\n    placeOrder: signal<boolean>(false),\r\n    positions: signal<boolean>(false),\r\n    orders: signal<boolean>(false),\r\n    balance: signal<boolean>(false),\r\n    closePosition: signal<boolean>(false),\r\n    cancelOrder: signal<boolean>(false)\r\n  };\r\n\r\n  // Public readonly signals\r\n  readonly isPlacingOrder = this.loadingStates.placeOrder.asReadonly();\r\n  readonly isLoadingPositions = this.loadingStates.positions.asReadonly();\r\n  readonly isLoadingOrders = this.loadingStates.orders.asReadonly();\r\n  readonly isLoadingBalance = this.loadingStates.balance.asReadonly();\r\n  readonly isClosingPosition = this.loadingStates.closePosition.asReadonly();\r\n  readonly isCancellingOrder = this.loadingStates.cancelOrder.asReadonly();\r\n\r\n  // Computed signal - true if any operation is loading\r\n  readonly isLoading = computed(() =>\r\n    this.loadingStates.placeOrder() ||\r\n    this.loadingStates.positions() ||\r\n    this.loadingStates.orders() ||\r\n    this.loadingStates.balance() ||\r\n    this.loadingStates.closePosition() ||\r\n    this.loadingStates.cancelOrder()\r\n  );\r\n\r\n  // Cached data streams with auto-refresh capability\r\n  private positionsCache$ = new BehaviorSubject<Position[]>([]);\r\n  private ordersCache$ = new BehaviorSubject<Order[]>([]);\r\n  private balanceCache$ = new BehaviorSubject<Balance | null>(null);\r\n\r\n  // Public observables for cached data\r\n  readonly positions$ = this.positionsCache$.asObservable();\r\n  readonly orders$ = this.ordersCache$.asObservable();\r\n  readonly balance$ = this.balanceCache$.asObservable();\r\n\r\n  constructor(private http: HttpClient) {}\r\n\r\n  /**\r\n   * Place a new order on the exchange\r\n   *\r\n   * @param order - Order request payload\r\n   * @returns Observable<OrderResponse> - Order confirmation from exchange\r\n   * @throws HttpErrorResponse if order placement fails\r\n   */\r\n  placeOrder(order: OrderRequest): Observable<OrderResponse> {\r\n    this.loadingStates.placeOrder.set(true);\r\n\r\n    // Validate order before sending\r\n    this.validateOrder(order);\r\n\r\n    const url = `${this.baseUrl}/${order.exchange}/order`;\r\n\r\n    return this.http.post<OrderResponse>(url, order).pipe(\r\n      tap(() => {\r\n        this.loadingStates.placeOrder.set(false);\r\n        // Refresh orders list after successful order placement\r\n        this.refreshOrders(order.exchange);\r\n      }),\r\n      catchError((error: HttpErrorResponse) => {\r\n        this.loadingStates.placeOrder.set(false);\r\n        return this.handleError('Failed to place order', error);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get all open positions for a specific exchange\r\n   *\r\n   * @param exchange - Exchange identifier\r\n   * @returns Observable<Position[]> - List of open positions\r\n   */\r\n  getPositions(exchange: Exchange): Observable<Position[]> {\r\n    this.loadingStates.positions.set(true);\r\n\r\n    const url = `${this.baseUrl}/${exchange}/positions`;\r\n\r\n    return this.http.get<Position[]>(url).pipe(\r\n      tap((positions) => {\r\n        this.loadingStates.positions.set(false);\r\n        this.positionsCache$.next(positions);\r\n      }),\r\n      catchError((error: HttpErrorResponse) => {\r\n        this.loadingStates.positions.set(false);\r\n        this.positionsCache$.next([]);\r\n        return this.handleError('Failed to fetch positions', error);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get order history with pagination\r\n   *\r\n   * @param exchange - Exchange identifier\r\n   * @param params - Pagination parameters (page, limit)\r\n   * @returns Observable<PaginatedResponse<Order>> - Paginated order history\r\n   */\r\n  getOrders(\r\n    exchange: Exchange,\r\n    params?: Partial<PaginationParams>\r\n  ): Observable<PaginatedResponse<Order>> {\r\n    this.loadingStates.orders.set(true);\r\n\r\n    const url = `${this.baseUrl}/${exchange}/orders`;\r\n    let httpParams = new HttpParams();\r\n\r\n    if (params?.page) {\r\n      httpParams = httpParams.set('page', params.page.toString());\r\n    }\r\n    if (params?.limit) {\r\n      httpParams = httpParams.set('limit', params.limit.toString());\r\n    }\r\n\r\n    return this.http.get<PaginatedResponse<Order>>(url, { params: httpParams }).pipe(\r\n      tap((response) => {\r\n        this.loadingStates.orders.set(false);\r\n        this.ordersCache$.next(response.data);\r\n      }),\r\n      catchError((error: HttpErrorResponse) => {\r\n        this.loadingStates.orders.set(false);\r\n        this.ordersCache$.next([]);\r\n        return this.handleError('Failed to fetch orders', error);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get account balance for a specific exchange\r\n   *\r\n   * @param exchange - Exchange identifier\r\n   * @returns Observable<Balance> - Account balance information\r\n   */\r\n  getAccountBalance(exchange: Exchange): Observable<Balance> {\r\n    this.loadingStates.balance.set(true);\r\n\r\n    const url = `${this.baseUrl}/${exchange}/balance`;\r\n\r\n    return this.http.get<Balance>(url).pipe(\r\n      tap((balance) => {\r\n        this.loadingStates.balance.set(false);\r\n        this.balanceCache$.next(balance);\r\n      }),\r\n      catchError((error: HttpErrorResponse) => {\r\n        this.loadingStates.balance.set(false);\r\n        return this.handleError('Failed to fetch balance', error);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Close an open position (market order in opposite direction)\r\n   *\r\n   * @param request - Close position request\r\n   * @returns Observable<OrderResponse> - Closing order confirmation\r\n   */\r\n  closePosition(request: ClosePositionRequest): Observable<OrderResponse> {\r\n    this.loadingStates.closePosition.set(true);\r\n\r\n    const url = `${this.baseUrl}/${request.exchange}/position/close`;\r\n\r\n    return this.http.post<OrderResponse>(url, request).pipe(\r\n      tap(() => {\r\n        this.loadingStates.closePosition.set(false);\r\n        // Refresh positions and orders after closing\r\n        this.refreshPositions(request.exchange);\r\n        this.refreshOrders(request.exchange);\r\n      }),\r\n      catchError((error: HttpErrorResponse) => {\r\n        this.loadingStates.closePosition.set(false);\r\n        return this.handleError('Failed to close position', error);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Cancel a pending order\r\n   *\r\n   * @param request - Cancel order request\r\n   * @returns Observable<void> - Confirmation of cancellation\r\n   */\r\n  cancelOrder(request: CancelOrderRequest): Observable<void> {\r\n    this.loadingStates.cancelOrder.set(true);\r\n\r\n    const url = `${this.baseUrl}/${request.exchange}/order/${request.orderId}`;\r\n    const params = new HttpParams().set('symbol', request.symbol);\r\n\r\n    return this.http.delete<void>(url, { params }).pipe(\r\n      tap(() => {\r\n        this.loadingStates.cancelOrder.set(false);\r\n        // Refresh orders list after cancellation\r\n        this.refreshOrders(request.exchange);\r\n      }),\r\n      catchError((error: HttpErrorResponse) => {\r\n        this.loadingStates.cancelOrder.set(false);\r\n        return this.handleError('Failed to cancel order', error);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get available trading symbols for an exchange\r\n   *\r\n   * @param exchange - Exchange identifier\r\n   * @returns Observable<SymbolInfo[]> - List of available trading pairs\r\n   */\r\n  getSymbols(exchange: Exchange): Observable<SymbolInfo[]> {\r\n    const url = `${this.baseUrl}/trading/symbols`;\r\n    const params = new HttpParams().set('exchange', exchange.toUpperCase());\r\n\r\n    return this.http.get<SymbolInfo[]>(url, { params }).pipe(\r\n      shareReplay(1), // Cache symbols data\r\n      catchError((error: HttpErrorResponse) => {\r\n        return this.handleError('Failed to fetch symbols', error);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get symbol information for a specific trading pair\r\n   *\r\n   * @param exchange - Exchange identifier\r\n   * @param symbol - Trading symbol\r\n   * @returns Observable<SymbolInfo> - Symbol details\r\n   */\r\n  getSymbolInfo(exchange: Exchange, symbol: TradingSymbol): Observable<SymbolInfo> {\r\n    const url = `${this.baseUrl}/${exchange}/symbols/${symbol}`;\r\n\r\n    return this.http.get<SymbolInfo>(url).pipe(\r\n      catchError((error: HttpErrorResponse) => {\r\n        return this.handleError('Failed to fetch symbol info', error);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Refresh positions data (manually trigger refresh)\r\n   *\r\n   * @param exchange - Exchange identifier\r\n   */\r\n  refreshPositions(exchange: Exchange): void {\r\n    this.getPositions(exchange).subscribe({\r\n      error: (error) => console.error('Failed to refresh positions:', error)\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Refresh orders data (manually trigger refresh)\r\n   *\r\n   * @param exchange - Exchange identifier\r\n   */\r\n  refreshOrders(exchange: Exchange): void {\r\n    this.getOrders(exchange).subscribe({\r\n      error: (error) => console.error('Failed to refresh orders:', error)\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Refresh balance data (manually trigger refresh)\r\n   *\r\n   * @param exchange - Exchange identifier\r\n   */\r\n  refreshBalance(exchange: Exchange): void {\r\n    this.getAccountBalance(exchange).subscribe({\r\n      error: (error) => console.error('Failed to refresh balance:', error)\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Refresh all trading data\r\n   *\r\n   * @param exchange - Exchange identifier\r\n   */\r\n  refreshAll(exchange: Exchange): void {\r\n    this.refreshPositions(exchange);\r\n    this.refreshOrders(exchange);\r\n    this.refreshBalance(exchange);\r\n  }\r\n\r\n  /**\r\n   * Set up auto-refresh for trading data\r\n   * Returns an observable that emits at regular intervals\r\n   *\r\n   * @param exchange - Exchange identifier\r\n   * @param intervalMs - Refresh interval in milliseconds (default: 10000ms = 10s)\r\n   * @returns Observable that triggers data refresh\r\n   */\r\n  setupAutoRefresh(exchange: Exchange, intervalMs = 10000): Observable<number> {\r\n    return interval(intervalMs).pipe(\r\n      tap(() => this.refreshAll(exchange))\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Clear all cached data\r\n   */\r\n  clearCache(): void {\r\n    this.positionsCache$.next([]);\r\n    this.ordersCache$.next([]);\r\n    this.balanceCache$.next(null);\r\n  }\r\n\r\n  /**\r\n   * Validate order before submission\r\n   * Throws error if validation fails\r\n   *\r\n   * @param order - Order to validate\r\n   * @private\r\n   */\r\n  private validateOrder(order: OrderRequest): void {\r\n    if (!order.symbol) {\r\n      throw new Error('Symbol is required');\r\n    }\r\n\r\n    if (!order.quantity || order.quantity <= 0) {\r\n      throw new Error('Quantity must be greater than 0');\r\n    }\r\n\r\n    if (order.type === 'Limit' && (!order.price || order.price <= 0)) {\r\n      throw new Error('Price is required for limit orders');\r\n    }\r\n\r\n    if (order.stopLoss && order.stopLoss <= 0) {\r\n      throw new Error('Stop loss must be greater than 0');\r\n    }\r\n\r\n    if (order.takeProfit && order.takeProfit <= 0) {\r\n      throw new Error('Take profit must be greater than 0');\r\n    }\r\n\r\n    // Validate stop loss and take profit relative to price\r\n    if (order.price && order.stopLoss && order.takeProfit) {\r\n      if (order.side === 'Buy') {\r\n        if (order.stopLoss >= order.price) {\r\n          throw new Error('Stop loss must be below entry price for buy orders');\r\n        }\r\n        if (order.takeProfit <= order.price) {\r\n          throw new Error('Take profit must be above entry price for buy orders');\r\n        }\r\n      } else {\r\n        if (order.stopLoss <= order.price) {\r\n          throw new Error('Stop loss must be above entry price for sell orders');\r\n        }\r\n        if (order.takeProfit >= order.price) {\r\n          throw new Error('Take profit must be below entry price for sell orders');\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Centralized error handling\r\n   *\r\n   * @param message - Error message prefix\r\n   * @param error - HTTP error response\r\n   * @returns Observable that emits error\r\n   * @private\r\n   */\r\n  private handleError(message: string, error: HttpErrorResponse): Observable<never> {\r\n    let errorMessage = message;\r\n\r\n    if (error.error instanceof ErrorEvent) {\r\n      // Client-side error\r\n      errorMessage = `${message}: ${error.error.message}`;\r\n    } else {\r\n      // Server-side error\r\n      const serverMessage = error.error?.message || error.error?.error || error.message;\r\n      errorMessage = `${message}: ${serverMessage}`;\r\n    }\r\n\r\n    console.error('Trading Service Error:', {\r\n      message: errorMessage,\r\n      status: error.status,\r\n      error: error.error\r\n    });\r\n\r\n    return throwError(() => new Error(errorMessage));\r\n  }\r\n\r\n  /**\r\n   * Generate mock data for development/testing\r\n   * This method provides realistic mock data when backend is not available\r\n   */\r\n  getMockPositions(): Position[] {\r\n    return [\r\n      {\r\n        id: '1',\r\n        exchange: 'bybit',\r\n        symbol: 'BTCUSDT',\r\n        side: 'Buy',\r\n        size: 0.1,\r\n        entryPrice: 50000,\r\n        markPrice: 51000,\r\n        liquidationPrice: 45000,\r\n        leverage: 10,\r\n        unrealizedPnl: 100,\r\n        unrealizedPnlPercent: 2,\r\n        marginType: 'Cross',\r\n        positionMargin: 500,\r\n        createdAt: new Date(),\r\n        updatedAt: new Date()\r\n      },\r\n      {\r\n        id: '2',\r\n        exchange: 'bybit',\r\n        symbol: 'ETHUSDT',\r\n        side: 'Sell',\r\n        size: 1.5,\r\n        entryPrice: 3000,\r\n        markPrice: 2950,\r\n        liquidationPrice: 3200,\r\n        leverage: 5,\r\n        unrealizedPnl: 75,\r\n        unrealizedPnlPercent: 1.67,\r\n        marginType: 'Isolated',\r\n        positionMargin: 900,\r\n        createdAt: new Date(Date.now() - 3600000),\r\n        updatedAt: new Date()\r\n      }\r\n    ];\r\n  }\r\n\r\n  getMockOrders(): Order[] {\r\n    return [\r\n      {\r\n        orderId: 'order-1',\r\n        exchange: 'bybit',\r\n        symbol: 'BTCUSDT',\r\n        side: 'Buy',\r\n        type: 'Limit',\r\n        quantity: 0.1,\r\n        price: 49000,\r\n        status: 'New',\r\n        timeInForce: 'GTC',\r\n        filledQuantity: 0,\r\n        createdAt: new Date(Date.now() - 1800000),\r\n        updatedAt: new Date(Date.now() - 1800000)\r\n      },\r\n      {\r\n        orderId: 'order-2',\r\n        exchange: 'bybit',\r\n        symbol: 'ETHUSDT',\r\n        side: 'Sell',\r\n        type: 'Market',\r\n        quantity: 1.5,\r\n        status: 'Filled',\r\n        timeInForce: 'GTC',\r\n        filledQuantity: 1.5,\r\n        averagePrice: 3000,\r\n        commission: 4.5,\r\n        commissionAsset: 'USDT',\r\n        createdAt: new Date(Date.now() - 3600000),\r\n        updatedAt: new Date(Date.now() - 3600000)\r\n      }\r\n    ];\r\n  }\r\n\r\n  getMockBalance(): Balance {\r\n    return {\r\n      exchange: 'bybit',\r\n      totalBalance: 10175,\r\n      availableBalance: 8675,\r\n      usedMargin: 1400,\r\n      unrealizedPnl: 175,\r\n      walletBalance: 10000,\r\n      currency: 'USDT',\r\n      updatedAt: new Date()\r\n    };\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\services\\price-arbitrage.service.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isPriceArbitrageError' is defined but never used.","line":26,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":66,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":66,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":89,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":89,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":114,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":114,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":199,"column":15,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":199,"endColumn":105},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .error on an `any` value.","line":199,"column":36,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":199,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":199,"column":67,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":199,"endColumn":74},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":228,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":228,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":252,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":252,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":281,"column":15,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":281,"endColumn":104},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .error on an `any` value.","line":281,"column":36,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":281,"endColumn":41},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":281,"column":67,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":281,"endColumn":74}],"suppressedMessages":[],"errorCount":12,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Price Arbitrage Service\r\n *\r\n * Service for managing price arbitrage positions across exchanges.\r\n * Handles:\r\n * - Fetching arbitrage opportunities\r\n * - Starting new arbitrage positions\r\n * - Monitoring active positions\r\n * - Closing positions\r\n */\r\n\r\nimport { Injectable, inject } from '@angular/core';\r\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\r\nimport { Observable, throwError } from 'rxjs';\r\nimport { catchError, map } from 'rxjs/operators';\r\nimport { getEndpointUrl } from '../config/app.config';\r\nimport {\r\n  PriceArbitrageOpportunity,\r\n  PriceArbitrageOpportunitiesResponse,\r\n  PriceArbitragePositionDTO,\r\n  PriceArbitragePositionResponse,\r\n  PriceArbitragePositionListResponse,\r\n  StartPriceArbitrageParams,\r\n  ClosePositionResponse,\r\n  PriceArbitrageStatus,\r\n  isPriceArbitrageError,\r\n  FundingRateData,\r\n  FundingRatesResponse\r\n} from '../models/price-arbitrage.model';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class PriceArbitrageService {\r\n  private http = inject(HttpClient);\r\n\r\n  /**\r\n   * Get HTTP headers with authentication token\r\n   */\r\n  private getHeaders(): HttpHeaders {\r\n    const token = localStorage.getItem('auth_token');\r\n    return new HttpHeaders({\r\n      'Content-Type': 'application/json',\r\n      ...(token && { 'Authorization': `Bearer ${token}` })\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Fetch price arbitrage opportunities across all exchanges\r\n   * @returns Observable of arbitrage opportunities\r\n   */\r\n  getOpportunities(): Observable<PriceArbitrageOpportunity[]> {\r\n    const url = getEndpointUrl('arbitrage', 'opportunities');\r\n\r\n    return this.http.get<PriceArbitrageOpportunitiesResponse>(url, {\r\n      headers: this.getHeaders()\r\n    }).pipe(\r\n      map(response => {\r\n        if (response.success && response.data) {\r\n          return response.data; // data is already the array\r\n        }\r\n        throw new Error('Failed to fetch opportunities');\r\n      }),\r\n      catchError(error => {\r\n        console.error('Error fetching arbitrage opportunities:', error);\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * HYBRID APPROACH: Fetch ONLY price opportunities (fast, without funding rates)\r\n   * @returns Observable of price-only arbitrage opportunities\r\n   */\r\n  getPricesOnly(): Observable<PriceArbitrageOpportunity[]> {\r\n    const url = getEndpointUrl('arbitrage', 'opportunities') + '?skipFunding=true';\r\n\r\n    return this.http.get<PriceArbitrageOpportunitiesResponse>(url, {\r\n      headers: this.getHeaders()\r\n    }).pipe(\r\n      map(response => {\r\n        if (response.success && response.data) {\r\n          return response.data;\r\n        }\r\n        throw new Error('Failed to fetch price opportunities');\r\n      }),\r\n      catchError(error => {\r\n        console.error('Error fetching price opportunities:', error);\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * HYBRID APPROACH: Fetch funding rates from all exchanges (with caching)\r\n   * @returns Observable of funding rates\r\n   */\r\n  getFundingRates(): Observable<FundingRateData[]> {\r\n    const url = '/api/funding-rates'; // Direct top-level endpoint with caching\r\n\r\n    return this.http.get<FundingRatesResponse>(url, {\r\n      headers: this.getHeaders()\r\n    }).pipe(\r\n      map(response => {\r\n        if (response.success && response.data) {\r\n          console.log(`[PriceArbitrageService] Fetched ${response.data.length} funding rates (cached: ${response.cached})`);\r\n          return response.data;\r\n        }\r\n        throw new Error('Failed to fetch funding rates');\r\n      }),\r\n      catchError(error => {\r\n        console.error('Error fetching funding rates:', error);\r\n        // Return empty array on error - we can still show price-only opportunities\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * HYBRID APPROACH: Combine price opportunities with funding rates\r\n   * @param priceOpps Price-only opportunities\r\n   * @param fundingRates Funding rates from all exchanges\r\n   * @returns Combined opportunities with funding rate metrics\r\n   */\r\n  combinePricesWithFunding(\r\n    priceOpps: PriceArbitrageOpportunity[],\r\n    fundingRates: FundingRateData[]\r\n  ): PriceArbitrageOpportunity[] {\r\n    // Create funding rate map: Map<exchange:symbol, fundingRate>\r\n    const fundingMap = new Map<string, number>();\r\n    fundingRates.forEach(fr => {\r\n      const key = `${fr.exchange}:${fr.symbol}`;\r\n      fundingMap.set(key, fr.fundingRate);\r\n    });\r\n\r\n    // Enrich opportunities with funding data\r\n    return priceOpps.map(opp => {\r\n      const primaryKey = `${opp.primaryExchange.name}:${opp.symbol}`;\r\n      const hedgeKey = `${opp.hedgeExchange.name}:${opp.symbol}`;\r\n\r\n      const primaryFundingRate = fundingMap.get(primaryKey);\r\n      const hedgeFundingRate = fundingMap.get(hedgeKey);\r\n\r\n      // If no funding data available, return as-is (price_only strategy)\r\n      if (primaryFundingRate === undefined || hedgeFundingRate === undefined) {\r\n        return {\r\n          ...opp,\r\n          strategyType: 'price_only' as const\r\n        };\r\n      }\r\n\r\n      // Calculate combined metrics\r\n      // PRIMARY (SHORT) = we RECEIVE funding if positive\r\n      // HEDGE (LONG) = we PAY funding if positive\r\n      const fundingDifferential = primaryFundingRate - hedgeFundingRate;\r\n\r\n      // Expected daily return = price spread + funding √ó 3 periods per day\r\n      const dailyFundingReturn = fundingDifferential * 3;\r\n      const expectedDailyReturn = opp.spreadPercent + dailyFundingReturn;\r\n\r\n      // Estimated monthly ROI\r\n      const estimatedMonthlyROI = opp.spreadPercent + (dailyFundingReturn * 30);\r\n\r\n      // Combined score = spread + funding for 7 days\r\n      const combinedScore = opp.spreadPercent + (dailyFundingReturn * 7);\r\n\r\n      return {\r\n        ...opp,\r\n        primaryFundingRate,\r\n        hedgeFundingRate,\r\n        fundingDifferential,\r\n        combinedScore,\r\n        expectedDailyReturn,\r\n        estimatedMonthlyROI,\r\n        strategyType: 'combined' as const\r\n      };\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Start a new price arbitrage position\r\n   * @param params Configuration for the arbitrage position\r\n   * @returns Observable of the created position\r\n   */\r\n  startArbitrage(params: StartPriceArbitrageParams): Observable<PriceArbitragePositionDTO> {\r\n    const url = getEndpointUrl('arbitrage', 'startPosition');\r\n\r\n    return this.http.post<PriceArbitragePositionResponse>(url, params, {\r\n      headers: this.getHeaders()\r\n    }).pipe(\r\n      map(response => {\r\n        if (response.success && response.data) {\r\n          return response.data;\r\n        }\r\n        throw new Error(response.message || 'Failed to start arbitrage');\r\n      }),\r\n      catchError(error => {\r\n        console.error('Error starting arbitrage:', error);\r\n        const errorMessage = error.error?.error?.message || error.message || 'Failed to start arbitrage';\r\n        return throwError(() => new Error(errorMessage));\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get list of arbitrage positions with optional status filter\r\n   * @param status Optional status filter (ACTIVE, COMPLETED, ERROR, etc.)\r\n   * @returns Observable of position list\r\n   */\r\n  getPositions(status?: PriceArbitrageStatus): Observable<PriceArbitragePositionDTO[]> {\r\n    let url = getEndpointUrl('arbitrage', 'positions');\r\n\r\n    if (status) {\r\n      url += `?status=${status}`;\r\n    }\r\n\r\n    return this.http.get<PriceArbitragePositionListResponse>(url, {\r\n      headers: this.getHeaders()\r\n    }).pipe(\r\n      map(response => {\r\n        if (response.success && response.data) {\r\n          return response.data; // data is already the array\r\n        }\r\n        throw new Error('Failed to fetch positions');\r\n      }),\r\n      catchError(error => {\r\n        console.error('Error fetching positions:', error);\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get a specific arbitrage position by ID\r\n   * @param id Position ID\r\n   * @returns Observable of the position\r\n   */\r\n  getPosition(id: string): Observable<PriceArbitragePositionDTO> {\r\n    const url = getEndpointUrl('arbitrage', `positions/${id}`);\r\n\r\n    return this.http.get<PriceArbitragePositionResponse>(url, {\r\n      headers: this.getHeaders()\r\n    }).pipe(\r\n      map(response => {\r\n        if (response.success && response.data) {\r\n          return response.data;\r\n        }\r\n        throw new Error('Failed to fetch position');\r\n      }),\r\n      catchError(error => {\r\n        console.error('Error fetching position:', error);\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Close an active arbitrage position\r\n   * @param id Position ID\r\n   * @returns Observable of the close operation result\r\n   */\r\n  closePosition(id: string): Observable<{\r\n    position: PriceArbitragePositionDTO;\r\n    totalPnl: number;\r\n    primaryPnl: number;\r\n    hedgePnl: number;\r\n  }> {\r\n    const url = getEndpointUrl('arbitrage', `positions/${id}/close`);\r\n\r\n    return this.http.post<ClosePositionResponse>(url, {}, {\r\n      headers: this.getHeaders()\r\n    }).pipe(\r\n      map(response => {\r\n        if (response.success && response.data) {\r\n          return response.data;\r\n        }\r\n        throw new Error(response.message || 'Failed to close position');\r\n      }),\r\n      catchError(error => {\r\n        console.error('Error closing position:', error);\r\n        const errorMessage = error.error?.error?.message || error.message || 'Failed to close position';\r\n        return throwError(() => new Error(errorMessage));\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get active positions only\r\n   * Convenience method that filters for ACTIVE status\r\n   * @returns Observable of active positions\r\n   */\r\n  getActivePositions(): Observable<PriceArbitragePositionDTO[]> {\r\n    return this.getPositions(PriceArbitrageStatus.ACTIVE);\r\n  }\r\n\r\n  /**\r\n   * Get completed positions only\r\n   * Convenience method that filters for COMPLETED status\r\n   * @returns Observable of completed positions\r\n   */\r\n  getCompletedPositions(): Observable<PriceArbitragePositionDTO[]> {\r\n    return this.getPositions(PriceArbitrageStatus.COMPLETED);\r\n  }\r\n\r\n  /**\r\n   * Get positions with errors\r\n   * Convenience method that filters for ERROR status\r\n   * @returns Observable of error positions\r\n   */\r\n  getErrorPositions(): Observable<PriceArbitragePositionDTO[]> {\r\n    return this.getPositions(PriceArbitrageStatus.ERROR);\r\n  }\r\n\r\n  /**\r\n   * Calculate unrealized P&L for an active position\r\n   * @param position The position to calculate P&L for\r\n   * @returns The unrealized P&L value\r\n   */\r\n  calculateUnrealizedPnl(position: PriceArbitragePositionDTO): number {\r\n    if (position.status !== PriceArbitrageStatus.ACTIVE) {\r\n      return position.totalPnl || 0;\r\n    }\r\n\r\n    if (!position.currentPrimaryPrice || !position.currentHedgePrice) {\r\n      return 0;\r\n    }\r\n\r\n    // Calculate P&L for SHORT position on primary exchange\r\n    const primaryQuantity = (position.primaryMargin * position.primaryLeverage) / position.entryPrimaryPrice;\r\n    const primaryPnl = primaryQuantity * (position.entryPrimaryPrice - position.currentPrimaryPrice);\r\n\r\n    // Calculate P&L for LONG position on hedge exchange\r\n    const hedgeQuantity = (position.hedgeMargin * position.hedgeLeverage) / position.entryHedgePrice;\r\n    const hedgePnl = hedgeQuantity * (position.currentHedgePrice - position.entryHedgePrice);\r\n\r\n    // Total unrealized P&L\r\n    const totalPnl = primaryPnl + hedgePnl - position.primaryFees - position.hedgeFees;\r\n\r\n    return totalPnl;\r\n  }\r\n\r\n  /**\r\n   * Format spread percentage for display\r\n   * @param spread Spread as decimal (e.g., 0.015)\r\n   * @param decimals Number of decimal places\r\n   * @returns Formatted spread string (e.g., \"1.50%\")\r\n   */\r\n  formatSpread(spread: number, decimals = 2): string {\r\n    return `${(spread * 100).toFixed(decimals)}%`;\r\n  }\r\n\r\n  /**\r\n   * Check if opportunity meets minimum spread threshold\r\n   * @param opportunity The opportunity to check\r\n   * @param minSpread Minimum spread threshold as decimal (e.g., 0.01 for 1%)\r\n   * @returns True if opportunity meets threshold\r\n   */\r\n  meetsSpreadThreshold(opportunity: PriceArbitrageOpportunity, minSpread: number): boolean {\r\n    return opportunity.spread >= minSpread;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\services\\realtime.service.ts","messages":[{"ruleId":"@typescript-eslint/no-empty-function","severity":2,"message":"Unexpected empty constructor.","line":53,"column":17,"nodeType":"FunctionExpression","messageId":"unexpected","endLine":53,"endColumn":19,"suggestions":[{"messageId":"suggestComment","data":{"name":"constructor"},"fix":{"range":[1534,1534],"text":" /* empty */ "},"desc":"Add comment inside empty constructor."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":83,"column":17,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":83,"endColumn":58}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Injectable, OnDestroy } from '@angular/core';\r\nimport { BehaviorSubject, Observable, Subject } from 'rxjs';\r\nimport { filter, map, takeUntil } from 'rxjs/operators';\r\n\r\nexport interface TickerData {\r\n  type: 'ticker' | 'connected' | 'error';\r\n  symbol: string;\r\n  price?: number;\r\n  volume?: number;\r\n  change24h?: number;\r\n  bid?: number;\r\n  ask?: number;\r\n  high24h?: number;\r\n  low24h?: number;\r\n  timestamp: number;\r\n  message?: string;\r\n}\r\n\r\nexport interface PriceUpdate {\r\n  symbol: string;\r\n  price: number;\r\n  change: number;\r\n  changePercent: number;\r\n  volume: number;\r\n  timestamp: number;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class RealtimeService implements OnDestroy {\r\n  private eventSources = new Map<string, EventSource>();\r\n  private destroy$ = new Subject<void>();\r\n\r\n  // Subject for all ticker updates\r\n  private tickerSubject = new BehaviorSubject<TickerData | null>(null);\r\n  public ticker$ = this.tickerSubject.asObservable().pipe(\r\n    filter(data => data !== null)\r\n  ) as Observable<TickerData>;\r\n\r\n  // Subject for price updates only\r\n  private priceSubject = new BehaviorSubject<PriceUpdate | null>(null);\r\n  public price$ = this.priceSubject.asObservable().pipe(\r\n    filter(data => data !== null)\r\n  ) as Observable<PriceUpdate>;\r\n\r\n  // Connection status\r\n  private connectionStatusSubject = new BehaviorSubject<Record<string, boolean>>({});\r\n  public connectionStatus$ = this.connectionStatusSubject.asObservable();\r\n\r\n  private baseUrl = '/api/trading';\r\n\r\n  constructor() {}\r\n\r\n  ngOnDestroy() {\r\n    this.destroy$.next();\r\n    this.destroy$.complete();\r\n    this.closeAllConnections();\r\n  }\r\n\r\n  // Subscribe to real-time data for a symbol\r\n  subscribeToSymbol(symbol: string): Observable<TickerData> {\r\n    const normalizedSymbol = symbol.toUpperCase();\r\n\r\n    // Close existing connection if any\r\n    this.unsubscribeFromSymbol(normalizedSymbol);\r\n\r\n    // Create new EventSource connection\r\n    const eventSource = new EventSource(`${this.baseUrl}/stream?symbol=${normalizedSymbol}`);\r\n    this.eventSources.set(normalizedSymbol, eventSource);\r\n\r\n    // Update connection status\r\n    this.updateConnectionStatus(normalizedSymbol, false);\r\n\r\n    return new Observable<TickerData>(observer => {\r\n      eventSource.onopen = () => {\r\n        console.log(`Connected to real-time stream for ${normalizedSymbol}`);\r\n        this.updateConnectionStatus(normalizedSymbol, true);\r\n      };\r\n\r\n      eventSource.onmessage = (event) => {\r\n        try {\r\n          const data: TickerData = JSON.parse(event.data);\r\n\r\n          // Emit to main ticker subject\r\n          this.tickerSubject.next(data);\r\n\r\n          // Emit to specific symbol observer\r\n          observer.next(data);\r\n\r\n          // If it's ticker data, also emit to price subject\r\n          if (data.type === 'ticker' && data.price !== undefined) {\r\n            const priceUpdate: PriceUpdate = {\r\n              symbol: data.symbol,\r\n              price: data.price,\r\n              change: 0, // Calculate based on previous price if needed\r\n              changePercent: data.change24h || 0,\r\n              volume: data.volume || 0,\r\n              timestamp: data.timestamp\r\n            };\r\n            this.priceSubject.next(priceUpdate);\r\n          }\r\n\r\n        } catch (error) {\r\n          console.error('Error parsing stream data:', error);\r\n          observer.error(error);\r\n        }\r\n      };\r\n\r\n      eventSource.onerror = (error) => {\r\n        console.error(`Stream error for ${normalizedSymbol}:`, error);\r\n        this.updateConnectionStatus(normalizedSymbol, false);\r\n\r\n        // Attempt to reconnect after a delay\r\n        setTimeout(() => {\r\n          if (this.eventSources.has(normalizedSymbol)) {\r\n            console.log(`Attempting to reconnect to ${normalizedSymbol}`);\r\n            this.subscribeToSymbol(normalizedSymbol);\r\n          }\r\n        }, 5000);\r\n\r\n        observer.error(error);\r\n      };\r\n\r\n      // Cleanup function\r\n      return () => {\r\n        this.unsubscribeFromSymbol(normalizedSymbol);\r\n      };\r\n    }).pipe(\r\n      takeUntil(this.destroy$)\r\n    );\r\n  }\r\n\r\n  // Unsubscribe from a specific symbol\r\n  unsubscribeFromSymbol(symbol: string): void {\r\n    const normalizedSymbol = symbol.toUpperCase();\r\n    const eventSource = this.eventSources.get(normalizedSymbol);\r\n\r\n    if (eventSource) {\r\n      eventSource.close();\r\n      this.eventSources.delete(normalizedSymbol);\r\n      this.updateConnectionStatus(normalizedSymbol, false);\r\n      console.log(`Unsubscribed from ${normalizedSymbol}`);\r\n    }\r\n  }\r\n\r\n  // Get real-time price for a specific symbol\r\n  getSymbolPrice$(symbol: string): Observable<PriceUpdate> {\r\n    return this.price$.pipe(\r\n      filter(update => update.symbol === symbol.toUpperCase())\r\n    );\r\n  }\r\n\r\n  // Get connection status for a symbol\r\n  isConnected(symbol: string): boolean {\r\n    const status = this.connectionStatusSubject.value;\r\n    return status[symbol.toUpperCase()] || false;\r\n  }\r\n\r\n  // Get all connected symbols\r\n  getConnectedSymbols(): string[] {\r\n    const status = this.connectionStatusSubject.value;\r\n    return Object.keys(status).filter(symbol => status[symbol]);\r\n  }\r\n\r\n  // Subscribe to multiple symbols\r\n  subscribeToMultipleSymbols(symbols: string[]): Observable<TickerData> {\r\n    symbols.forEach(symbol => {\r\n      this.subscribeToSymbol(symbol);\r\n    });\r\n\r\n    return this.ticker$;\r\n  }\r\n\r\n  // Close all connections\r\n  closeAllConnections(): void {\r\n    this.eventSources.forEach((eventSource, symbol) => {\r\n      eventSource.close();\r\n      console.log(`Closed connection for ${symbol}`);\r\n    });\r\n    this.eventSources.clear();\r\n    this.connectionStatusSubject.next({});\r\n  }\r\n\r\n  // Get current price from cache (last received price)\r\n  getCurrentPrice(symbol: string): number | null {\r\n    const currentTicker = this.tickerSubject.value;\r\n    if (currentTicker && currentTicker.symbol === symbol.toUpperCase() && currentTicker.price) {\r\n      return currentTicker.price;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  // Get market summary for connected symbols\r\n  getMarketSummary(): Observable<Record<string, PriceUpdate>> {\r\n    return this.price$.pipe(\r\n      map(update => {\r\n        // This is a simplified implementation\r\n        // In a real app, you'd maintain a map of all symbols\r\n        return { [update.symbol]: update };\r\n      })\r\n    );\r\n  }\r\n\r\n  // Helper method to format price change\r\n  formatPriceChange(change: number, changePercent: number): string {\r\n    const sign = change >= 0 ? '+' : '';\r\n    return `${sign}${change.toFixed(2)} (${sign}${changePercent.toFixed(2)}%)`;\r\n  }\r\n\r\n  // Helper method to get price change color class\r\n  getPriceChangeClass(change: number): string {\r\n    if (change > 0) return 'price-up';\r\n    if (change < 0) return 'price-down';\r\n    return 'price-neutral';\r\n  }\r\n\r\n  private updateConnectionStatus(symbol: string, connected: boolean): void {\r\n    const currentStatus = this.connectionStatusSubject.value;\r\n    const newStatus = { ...currentStatus, [symbol]: connected };\r\n    this.connectionStatusSubject.next(newStatus);\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\services\\statistical-utils.service.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":362,"column":54,"nodeType":null,"messageId":"unusedVar","endLine":362,"endColumn":55},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'i' is defined but never used.","line":362,"column":57,"nodeType":null,"messageId":"unusedVar","endLine":362,"endColumn":58}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { TestBed } from '@angular/core/testing';\r\nimport { StatisticalUtilsService } from './statistical-utils.service';\r\n\r\ndescribe('StatisticalUtilsService', () => {\r\n  let service: StatisticalUtilsService;\r\n\r\n  beforeEach(() => {\r\n    TestBed.configureTestingModule({\r\n      providers: [StatisticalUtilsService]\r\n    });\r\n    service = TestBed.inject(StatisticalUtilsService);\r\n  });\r\n\r\n  it('should be created', () => {\r\n    expect(service).toBeTruthy();\r\n  });\r\n\r\n  describe('calculateAverage', () => {\r\n    it('should calculate correct average for positive numbers', () => {\r\n      expect(service.calculateAverage([1, 2, 3, 4, 5])).toBe(3);\r\n    });\r\n\r\n    it('should calculate correct average for decimal values', () => {\r\n      const result = service.calculateAverage([0.1, 0.2, 0.3]);\r\n      expect(result).toBeCloseTo(0.2, 5);\r\n    });\r\n\r\n    it('should handle empty array', () => {\r\n      expect(service.calculateAverage([])).toBeNull();\r\n    });\r\n\r\n    it('should handle single value', () => {\r\n      expect(service.calculateAverage([5])).toBe(5);\r\n    });\r\n\r\n    it('should handle negative numbers', () => {\r\n      expect(service.calculateAverage([-1, -2, -3])).toBe(-2);\r\n    });\r\n\r\n    it('should handle mixed positive and negative numbers', () => {\r\n      expect(service.calculateAverage([-2, 0, 2])).toBe(0);\r\n    });\r\n\r\n    it('should handle very small decimal values', () => {\r\n      const result = service.calculateAverage([0.0001, 0.0002, 0.0003]);\r\n      expect(result).toBeCloseTo(0.0002, 6);\r\n    });\r\n  });\r\n\r\n  describe('calculateStandardDeviation', () => {\r\n    it('should calculate correct standard deviation', () => {\r\n      // Example: [2, 4, 4, 4, 5, 5, 7, 9]\r\n      // Mean = 5, Variance = 4, StdDev = 2\r\n      const result = service.calculateStandardDeviation([2, 4, 4, 4, 5, 5, 7, 9]);\r\n      expect(result).toBeCloseTo(2.0, 1);\r\n    });\r\n\r\n    it('should return 0 for identical values', () => {\r\n      expect(service.calculateStandardDeviation([5, 5, 5, 5])).toBe(0);\r\n    });\r\n\r\n    it('should handle empty array', () => {\r\n      expect(service.calculateStandardDeviation([])).toBeNull();\r\n    });\r\n\r\n    it('should handle single value', () => {\r\n      expect(service.calculateStandardDeviation([10])).toBe(0);\r\n    });\r\n\r\n    it('should handle two values', () => {\r\n      const result = service.calculateStandardDeviation([1, 3]);\r\n      expect(result).toBeCloseTo(1.0, 5);\r\n    });\r\n\r\n    it('should handle decimal values', () => {\r\n      const result = service.calculateStandardDeviation([0.1, 0.2, 0.3, 0.4]);\r\n      expect(result).toBeGreaterThan(0);\r\n      expect(result).toBeLessThan(0.2);\r\n    });\r\n\r\n    it('should handle negative numbers', () => {\r\n      const result = service.calculateStandardDeviation([-2, -1, 0, 1, 2]);\r\n      expect(result).toBeCloseTo(1.4142, 2);\r\n    });\r\n  });\r\n\r\n  describe('calculateStabilityScore', () => {\r\n    it('should return 100 for zero standard deviation', () => {\r\n      expect(service.calculateStabilityScore(0.5, 0)).toBe(100);\r\n    });\r\n\r\n    it('should return lower score for high coefficient of variation', () => {\r\n      // CV = 0.3 / 0.5 = 0.6\r\n      // Score = 100 * (1 - 0.6) = 40\r\n      const score = service.calculateStabilityScore(0.5, 0.3);\r\n      expect(score).toBeCloseTo(40, 0);\r\n    });\r\n\r\n    it('should return higher score for low coefficient of variation', () => {\r\n      // CV = 0.05 / 0.5 = 0.1\r\n      // Score = 100 * (1 - 0.1) = 90\r\n      const score = service.calculateStabilityScore(0.5, 0.05);\r\n      expect(score).toBeCloseTo(90, 0);\r\n    });\r\n\r\n    it('should handle edge case: stdDev > average', () => {\r\n      // CV = 0.5 / 0.1 = 5 (capped at 1)\r\n      // Score = 100 * (1 - 1) = 0\r\n      const score = service.calculateStabilityScore(0.1, 0.5);\r\n      expect(score).toBe(0);\r\n    });\r\n\r\n    it('should handle edge case: stdDev equals average', () => {\r\n      // CV = 0.5 / 0.5 = 1\r\n      // Score = 100 * (1 - 1) = 0\r\n      const score = service.calculateStabilityScore(0.5, 0.5);\r\n      expect(score).toBe(0);\r\n    });\r\n\r\n    it('should return value between 0 and 100', () => {\r\n      const score = service.calculateStabilityScore(0.3, 0.15);\r\n      expect(score).toBeGreaterThanOrEqual(0);\r\n      expect(score).toBeLessThanOrEqual(100);\r\n    });\r\n\r\n    it('should handle very small average (avoid division by zero)', () => {\r\n      const score = service.calculateStabilityScore(0.0001, 0.00005);\r\n      expect(score).toBeGreaterThan(0);\r\n      expect(score).toBeLessThanOrEqual(100);\r\n    });\r\n\r\n    it('should handle zero average gracefully', () => {\r\n      // When average is 0, return 0 score (can't calculate CV)\r\n      const score = service.calculateStabilityScore(0, 0.1);\r\n      expect(score).toBe(0);\r\n    });\r\n  });\r\n\r\n  describe('getStabilityRating', () => {\r\n    it('should return excellent for score >= 80', () => {\r\n      expect(service.getStabilityRating(100)).toBe('excellent');\r\n      expect(service.getStabilityRating(90)).toBe('excellent');\r\n      expect(service.getStabilityRating(80)).toBe('excellent');\r\n    });\r\n\r\n    it('should return good for score 60-79', () => {\r\n      expect(service.getStabilityRating(79)).toBe('good');\r\n      expect(service.getStabilityRating(70)).toBe('good');\r\n      expect(service.getStabilityRating(60)).toBe('good');\r\n    });\r\n\r\n    it('should return moderate for score 40-59', () => {\r\n      expect(service.getStabilityRating(59)).toBe('moderate');\r\n      expect(service.getStabilityRating(50)).toBe('moderate');\r\n      expect(service.getStabilityRating(40)).toBe('moderate');\r\n    });\r\n\r\n    it('should return poor for score < 40', () => {\r\n      expect(service.getStabilityRating(39)).toBe('poor');\r\n      expect(service.getStabilityRating(20)).toBe('poor');\r\n      expect(service.getStabilityRating(0)).toBe('poor');\r\n    });\r\n\r\n    it('should handle decimal scores', () => {\r\n      expect(service.getStabilityRating(79.5)).toBe('good');\r\n      expect(service.getStabilityRating(80.1)).toBe('excellent');\r\n    });\r\n\r\n    it('should handle edge case: negative score', () => {\r\n      expect(service.getStabilityRating(-10)).toBe('poor');\r\n    });\r\n\r\n    it('should handle edge case: score > 100', () => {\r\n      expect(service.getStabilityRating(150)).toBe('excellent');\r\n    });\r\n  });\r\n\r\n  describe('getDataQuality', () => {\r\n    it('should return high quality for sufficient samples', () => {\r\n      expect(service.getDataQuality(200, 100)).toBe('high');\r\n      expect(service.getDataQuality(100, 100)).toBe('high');\r\n    });\r\n\r\n    it('should return medium quality for partial samples', () => {\r\n      expect(service.getDataQuality(80, 100)).toBe('medium');\r\n      expect(service.getDataQuality(60, 100)).toBe('medium');\r\n      expect(service.getDataQuality(50, 100)).toBe('medium');\r\n    });\r\n\r\n    it('should return low quality for insufficient samples', () => {\r\n      expect(service.getDataQuality(49, 100)).toBe('low');\r\n      expect(service.getDataQuality(30, 100)).toBe('low');\r\n      expect(service.getDataQuality(0, 100)).toBe('low');\r\n    });\r\n\r\n    it('should handle zero expected minimum', () => {\r\n      expect(service.getDataQuality(10, 0)).toBe('high');\r\n    });\r\n\r\n    it('should handle very large sample sizes', () => {\r\n      expect(service.getDataQuality(10000, 1000)).toBe('high');\r\n    });\r\n  });\r\n\r\n  describe('calculateStabilityTrend', () => {\r\n    it('should detect improving trend (7d better than 30d)', () => {\r\n      // 7-day score improved by >10 points\r\n      expect(service.calculateStabilityTrend(80, 60)).toBe('improving');\r\n      expect(service.calculateStabilityTrend(90, 70)).toBe('improving');\r\n    });\r\n\r\n    it('should detect declining trend (7d worse than 30d)', () => {\r\n      // 7-day score declined by >10 points\r\n      expect(service.calculateStabilityTrend(50, 70)).toBe('declining');\r\n      expect(service.calculateStabilityTrend(40, 60)).toBe('declining');\r\n    });\r\n\r\n    it('should detect stable trend (difference <= 10 points)', () => {\r\n      expect(service.calculateStabilityTrend(70, 70)).toBe('stable');\r\n      expect(service.calculateStabilityTrend(70, 75)).toBe('stable');\r\n      expect(service.calculateStabilityTrend(75, 70)).toBe('stable');\r\n      expect(service.calculateStabilityTrend(70, 80)).toBe('stable');\r\n      expect(service.calculateStabilityTrend(80, 70)).toBe('stable');\r\n    });\r\n\r\n    it('should handle boundary case: exactly 10 points difference', () => {\r\n      expect(service.calculateStabilityTrend(70, 80)).toBe('stable');\r\n      expect(service.calculateStabilityTrend(80, 70)).toBe('stable');\r\n    });\r\n\r\n    it('should handle extreme scores', () => {\r\n      expect(service.calculateStabilityTrend(100, 50)).toBe('improving');\r\n      expect(service.calculateStabilityTrend(0, 50)).toBe('declining');\r\n    });\r\n  });\r\n\r\n  describe('calculateConfidenceScore', () => {\r\n    it('should return 1.0 for high quality on both periods', () => {\r\n      expect(service.calculateConfidenceScore('high', 'high')).toBe(1.0);\r\n    });\r\n\r\n    it('should return 0.7 for medium quality on both periods', () => {\r\n      expect(service.calculateConfidenceScore('medium', 'medium')).toBe(0.7);\r\n    });\r\n\r\n    it('should return 0.3 for low quality on both periods', () => {\r\n      expect(service.calculateConfidenceScore('low', 'low')).toBe(0.3);\r\n    });\r\n\r\n    it('should return average for mixed quality (high + medium)', () => {\r\n      const result = service.calculateConfidenceScore('high', 'medium');\r\n      expect(result).toBeCloseTo(0.85, 2);\r\n    });\r\n\r\n    it('should return average for mixed quality (high + low)', () => {\r\n      const result = service.calculateConfidenceScore('high', 'low');\r\n      expect(result).toBeCloseTo(0.65, 2);\r\n    });\r\n\r\n    it('should return average for mixed quality (medium + low)', () => {\r\n      const result = service.calculateConfidenceScore('medium', 'low');\r\n      expect(result).toBeCloseTo(0.5, 2);\r\n    });\r\n\r\n    it('should handle order independence', () => {\r\n      expect(service.calculateConfidenceScore('high', 'medium'))\r\n        .toBe(service.calculateConfidenceScore('medium', 'high'));\r\n      expect(service.calculateConfidenceScore('low', 'high'))\r\n        .toBe(service.calculateConfidenceScore('high', 'low'));\r\n    });\r\n  });\r\n\r\n  describe('formatPercentage', () => {\r\n    it('should format with default 2 decimal places', () => {\r\n      expect(service.formatPercentage(0.1234)).toBe('12.34%');\r\n      expect(service.formatPercentage(0.5)).toBe('50.00%');\r\n    });\r\n\r\n    it('should format with custom decimal places', () => {\r\n      expect(service.formatPercentage(0.123456, 4)).toBe('12.3456%');\r\n      expect(service.formatPercentage(0.5, 0)).toBe('50%');\r\n    });\r\n\r\n    it('should handle very small percentages', () => {\r\n      expect(service.formatPercentage(0.0001, 4)).toBe('0.0100%');\r\n    });\r\n\r\n    it('should handle very large percentages', () => {\r\n      expect(service.formatPercentage(1.5, 2)).toBe('150.00%');\r\n    });\r\n\r\n    it('should handle zero', () => {\r\n      expect(service.formatPercentage(0)).toBe('0.00%');\r\n    });\r\n\r\n    it('should handle negative percentages', () => {\r\n      expect(service.formatPercentage(-0.15)).toBe('-15.00%');\r\n    });\r\n\r\n    it('should round correctly', () => {\r\n      expect(service.formatPercentage(0.12345, 2)).toBe('12.35%');\r\n      expect(service.formatPercentage(0.12344, 2)).toBe('12.34%');\r\n    });\r\n  });\r\n\r\n  describe('Real-world scenarios', () => {\r\n    describe('Stable spread scenario', () => {\r\n      it('should analyze very stable spread data correctly', () => {\r\n        // Spread fluctuates minimally around 0.15%\r\n        const spreads = [0.15, 0.151, 0.149, 0.15, 0.150, 0.148, 0.152];\r\n\r\n        const avg = service.calculateAverage(spreads);\r\n        const stdDev = service.calculateStandardDeviation(spreads);\r\n        const score = service.calculateStabilityScore(avg!, stdDev!);\r\n        const rating = service.getStabilityRating(score);\r\n\r\n        expect(avg).toBeCloseTo(0.15, 3);\r\n        expect(stdDev).toBeLessThan(0.002);\r\n        expect(rating).toBe('excellent');\r\n      });\r\n    });\r\n\r\n    describe('Volatile spread scenario', () => {\r\n      it('should analyze highly volatile spread data correctly', () => {\r\n        // Spread varies dramatically\r\n        const spreads = [0.1, 0.5, 0.05, 0.8, 0.15, 0.6, 0.2];\r\n\r\n        const avg = service.calculateAverage(spreads);\r\n        const stdDev = service.calculateStandardDeviation(spreads);\r\n        const score = service.calculateStabilityScore(avg!, stdDev!);\r\n        const rating = service.getStabilityRating(score);\r\n\r\n        expect(avg).toBeGreaterThan(0.2);\r\n        expect(stdDev).toBeGreaterThan(0.2);\r\n        expect(rating).toMatch(/poor|moderate/);\r\n      });\r\n    });\r\n\r\n    describe('7-day hourly data scenario', () => {\r\n      it('should handle realistic 7-day hourly spread data', () => {\r\n        // Simulate 7 days * 24 hours = 168 data points\r\n        // With daily sinusoidal pattern (higher spreads at certain times)\r\n        const spreads = Array.from({ length: 168 }, (_, i) =>\r\n          0.15 + (Math.sin(i / 24 * Math.PI) * 0.02)\r\n        );\r\n\r\n        const avg = service.calculateAverage(spreads);\r\n        const stdDev = service.calculateStandardDeviation(spreads);\r\n        const score = service.calculateStabilityScore(avg!, stdDev!);\r\n        const quality = service.getDataQuality(spreads.length, 100);\r\n\r\n        expect(avg).toBeCloseTo(0.15, 2);\r\n        expect(stdDev).toBeGreaterThan(0);\r\n        expect(score).toBeGreaterThan(50);\r\n        expect(quality).toBe('high');\r\n      });\r\n    });\r\n\r\n    describe('30-day hourly data scenario', () => {\r\n      it('should handle realistic 30-day hourly spread data', () => {\r\n        // Simulate 30 days * 24 hours = 720 data points\r\n        const spreads = Array.from({ length: 720 }, (_, i) =>\r\n          0.15 + (Math.random() * 0.04 - 0.02) // Random ¬±0.02% variation\r\n        );\r\n\r\n        const avg = service.calculateAverage(spreads);\r\n        const stdDev = service.calculateStandardDeviation(spreads);\r\n        const score = service.calculateStabilityScore(avg!, stdDev!);\r\n        const quality = service.getDataQuality(spreads.length, 400);\r\n\r\n        expect(avg).toBeCloseTo(0.15, 1);\r\n        expect(stdDev).toBeGreaterThan(0);\r\n        expect(score).toBeGreaterThan(0);\r\n        expect(quality).toBe('high');\r\n      });\r\n    });\r\n\r\n    describe('Insufficient data scenario', () => {\r\n      it('should handle insufficient sample size correctly', () => {\r\n        // Only 30 data points instead of expected 168 (7 days hourly)\r\n        const spreads = Array.from({ length: 30 }, () => 0.15);\r\n\r\n        const quality = service.getDataQuality(spreads.length, 168);\r\n\r\n        expect(quality).toBe('low');\r\n      });\r\n    });\r\n\r\n    describe('Trend detection scenario', () => {\r\n      it('should detect improving stability trend', () => {\r\n        // 7-day: very stable (score ~95)\r\n        const spreads7d = Array.from({ length: 50 }, () => 0.15 + (Math.random() * 0.002));\r\n        const avg7d = service.calculateAverage(spreads7d)!;\r\n        const stdDev7d = service.calculateStandardDeviation(spreads7d)!;\r\n        const score7d = service.calculateStabilityScore(avg7d, stdDev7d);\r\n\r\n        // 30-day: more volatile (score ~60)\r\n        const spreads30d = Array.from({ length: 200 }, () => 0.15 + (Math.random() * 0.08));\r\n        const avg30d = service.calculateAverage(spreads30d)!;\r\n        const stdDev30d = service.calculateStandardDeviation(spreads30d)!;\r\n        const score30d = service.calculateStabilityScore(avg30d, stdDev30d);\r\n\r\n        const trend = service.calculateStabilityTrend(score7d, score30d);\r\n\r\n        expect(score7d).toBeGreaterThan(score30d);\r\n        expect(trend).toBe('improving');\r\n      });\r\n    });\r\n\r\n    describe('Complete metrics calculation', () => {\r\n      it('should calculate all metrics for a complete Phase 2 analysis', () => {\r\n        const spreads = [0.12, 0.15, 0.14, 0.16, 0.13, 0.15, 0.14];\r\n\r\n        const avg = service.calculateAverage(spreads);\r\n        const stdDev = service.calculateStandardDeviation(spreads);\r\n        const score = service.calculateStabilityScore(avg!, stdDev!);\r\n        const rating = service.getStabilityRating(score);\r\n        const quality = service.getDataQuality(spreads.length, 100);\r\n        const avgFormatted = service.formatPercentage(avg!, 2);\r\n        const stdDevFormatted = service.formatPercentage(stdDev!, 2);\r\n\r\n        expect(avg).toBeDefined();\r\n        expect(stdDev).toBeDefined();\r\n        expect(score).toBeGreaterThanOrEqual(0);\r\n        expect(score).toBeLessThanOrEqual(100);\r\n        expect(rating).toMatch(/excellent|good|moderate|poor/);\r\n        expect(quality).toBe('low'); // Only 7 samples vs 100 expected\r\n        expect(avgFormatted).toContain('%');\r\n        expect(stdDevFormatted).toContain('%');\r\n      });\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\services\\strategy.service.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of type `Observable<any>` from function with return type `Observable<{ success: boolean; strategy: Strategy; }>`.","line":90,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturnAssignment","endLine":90,"endColumn":55},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":90,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2179,2182],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2179,2182],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of type `Observable<any>` from function with return type `Observable<{ success: boolean; strategy: Strategy; }>`.","line":104,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturnAssignment","endLine":104,"endColumn":54},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":104,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2729,2732],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2729,2732],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of type `Observable<any>` from function with return type `Observable<{ success: boolean; }>`.","line":109,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturnAssignment","endLine":109,"endColumn":59},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":109,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":109,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2912,2915],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2912,2915],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of type `Observable<any>` from function with return type `Observable<{ valid: boolean; warnings: string[]; errors: string[]; suggestions: string[]; }>`.","line":131,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturnAssignment","endLine":131,"endColumn":69},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":131,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3559,3562],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3559,3562],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":142,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":142,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3821,3824],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3821,3824],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":162,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":162,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4661,4664],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4661,4664],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":163,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4682,4685],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4682,4685],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of type `Observable<any>` from function with return type `Observable<{ comparison: any[]; summary: any; }>`.","line":165,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturnAssignment","endLine":168,"endColumn":8},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":165,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":165,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4722,4725],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4722,4725],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":176,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":176,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4972,4975],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4972,4975],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of type `Observable<any>` from function with return type `Observable<{ matches: { symbol: string; score: number; signals: any[]; lastPrice: number; recommendation: \"BUY\" | \"SELL\" | \"HOLD\"; }[]; }>`.","line":181,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturnAssignment","endLine":184,"endColumn":8},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":181,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5098,5101],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5098,5101],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":195,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":195,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5394,5397],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5394,5397],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of type `Observable<any[]>` from function with return type `Observable<{ name: string; displayName: string; description: string; parameters: { name: string; type: string; default: any; min?: number | undefined; max?: number | undefined; options?: string[] | undefined; }[]; }[]>`.","line":201,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturnAssignment","endLine":201,"endColumn":62},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":201,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":201,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5514,5517],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5514,5517],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":209,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":209,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5699,5702],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5699,5702],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of type `Observable<any>` from function with return type `Observable<{ values: number[]; timestamps: string[]; current: number; }>`.","line":215,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturnAssignment","endLine":215,"endColumn":78},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":215,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":215,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5831,5834],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5831,5834],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":236,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":236,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6403,6406],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6403,6406],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":237,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":237,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6426,6429],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6426,6429],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of type `Observable<any>` from function with return type `Observable<{ optimizationId: string; status: \"completed\" | \"failed\" | \"running\"; progress?: number | undefined; bestParameters?: any; bestResult?: any; }>`.","line":239,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturnAssignment","endLine":239,"endColumn":67},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":239,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":239,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6466,6469],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6466,6469],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":242,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":242,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6575,6578],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6575,6578],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":243,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":243,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6608,6611],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6608,6611],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of type `Observable<any>` from function with return type `Observable<{ shareUrl: string; shareCode: string; }>`.","line":248,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturnAssignment","endLine":248,"endColumn":74},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":248,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":248,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6812,6815],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6812,6815],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of type `Observable<any>` from function with return type `Observable<{ success: boolean; }>`.","line":262,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturnAssignment","endLine":265,"endColumn":8},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":262,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":262,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7398,7401],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7398,7401],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of type `Observable<any>` from function with return type `Observable<{ averageRating: number; totalRatings: number; reviews: { rating: number; review: string; user: string; createdAt: Date; }[]; }>`.","line":278,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturnAssignment","endLine":278,"endColumn":71},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":278,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":278,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7749,7752],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7749,7752],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of type `Observable<any>` from function with return type `Observable<{ suggestions: { name: string; description: string; entryConditions: string[]; exitConditions: string[]; expectedWinRate: number; expectedReturn: number; riskLevel: string; }[]; }>`.","line":298,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturnAssignment","endLine":298,"endColumn":76},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":298,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":298,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8305,8308],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8305,8308],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":305,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":305,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8589,8592],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8589,8592],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of type `Observable<any>` from function with return type `Observable<{ suggestions: { type: \"add_filter\" | \"modify_filter\" | \"add_risk_rule\" | \"adjust_parameters\"; description: string; implementation: any; expectedImprovement: string; }[]; }>`.","line":309,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturnAssignment","endLine":311,"endColumn":8},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":309,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":309,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8675,8678],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8675,8678],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":39,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Injectable } from '@angular/core';\r\nimport { HttpClient, HttpParams } from '@angular/common/http';\r\nimport { Observable } from 'rxjs';\r\nimport { environment } from '../../environments/environment';\r\n\r\nexport interface Strategy {\r\n  id: string;\r\n  name: string;\r\n  description?: string;\r\n  entryFilters: IndicatorFilter[];\r\n  exitFilters: IndicatorFilter[];\r\n  riskManagement?: RiskManagementRules;\r\n  isPublic: boolean;\r\n  timesUsed: number;\r\n  averageReturn?: number;\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n  user?: {\r\n    id: string;\r\n    name: string;\r\n    email: string;\r\n  };\r\n}\r\n\r\nexport interface IndicatorFilter {\r\n  id: string;\r\n  indicator: 'RSI' | 'MACD' | 'SMA' | 'EMA' | 'BB' | 'Stochastic' | 'ADX' | 'Volume';\r\n  operator: '>' | '<' | '>=' | '<=' | '=';\r\n  value: number;\r\n  period?: number;\r\n  action: 'entry' | 'exit';\r\n  bandType?: 'upper' | 'lower' | 'middle';\r\n  enabled: boolean;\r\n}\r\n\r\nexport interface RiskManagementRules {\r\n  maxPositionSize?: number;\r\n  stopLoss?: number;\r\n  takeProfit?: number;\r\n  maxDailyLoss?: number;\r\n  maxConcurrentTrades?: number;\r\n  riskPerTrade?: number;\r\n}\r\n\r\nexport interface StrategyBacktest {\r\n  id: string;\r\n  strategyId: string;\r\n  symbol: string;\r\n  timeframe: string;\r\n  startDate: Date;\r\n  endDate: Date;\r\n  initialBalance: number;\r\n  results: {\r\n    totalPnL: number;\r\n    winRate: number;\r\n    maxDrawdown: number;\r\n    sharpeRatio: number;\r\n    profitFactor: number;\r\n    totalTrades: number;\r\n  };\r\n  createdAt: Date;\r\n}\r\n\r\nexport interface StrategyPerformance {\r\n  strategyId: string;\r\n  symbol: string;\r\n  period: string;\r\n  totalReturn: number;\r\n  winRate: number;\r\n  maxDrawdown: number;\r\n  volatility: number;\r\n  sharpeRatio: number;\r\n  calmarRatio: number;\r\n  trades: number;\r\n  avgTradeReturn: number;\r\n  bestTrade: number;\r\n  worstTrade: number;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class StrategyService {\r\n  private apiUrl = `${environment.apiUrl}/trading/strategies`;\r\n\r\n  constructor(private http: HttpClient) {}\r\n\r\n  // Strategy CRUD Operations\r\n  createStrategy(strategy: Partial<Strategy>): Observable<{ success: boolean; strategy: Strategy }> {\r\n    return this.http.post<any>(this.apiUrl, strategy);\r\n  }\r\n\r\n  getStrategies(includePublic = false): Observable<Strategy[]> {\r\n    const params = new HttpParams().set('includePublic', includePublic.toString());\r\n    return this.http.get<Strategy[]>(this.apiUrl, { params });\r\n  }\r\n\r\n  getStrategy(id: string): Observable<Strategy> {\r\n    const params = new HttpParams().set('id', id);\r\n    return this.http.get<Strategy>(this.apiUrl, { params });\r\n  }\r\n\r\n  updateStrategy(strategy: Strategy): Observable<{ success: boolean; strategy: Strategy }> {\r\n    return this.http.put<any>(this.apiUrl, strategy);\r\n  }\r\n\r\n  deleteStrategy(id: string): Observable<{ success: boolean }> {\r\n    const params = new HttpParams().set('id', id);\r\n    return this.http.delete<any>(this.apiUrl, { params });\r\n  }\r\n\r\n  // Strategy Templates\r\n  getStrategyTemplates(): Observable<Strategy[]> {\r\n    return this.http.get<Strategy[]>(`${this.apiUrl}/templates`);\r\n  }\r\n\r\n  createStrategyFromTemplate(templateId: string, customizations: Partial<Strategy>): Observable<Strategy> {\r\n    return this.http.post<Strategy>(`${this.apiUrl}/from-template`, {\r\n      templateId,\r\n      customizations\r\n    });\r\n  }\r\n\r\n  // Strategy Validation\r\n  validateStrategy(strategy: Partial<Strategy>): Observable<{\r\n    valid: boolean;\r\n    warnings: string[];\r\n    errors: string[];\r\n    suggestions: string[];\r\n  }> {\r\n    return this.http.post<any>(`${this.apiUrl}/validate`, strategy);\r\n  }\r\n\r\n  // Backtesting\r\n  backtestStrategy(request: {\r\n    strategyId: string;\r\n    symbol: string;\r\n    timeframe: string;\r\n    startDate: string;\r\n    endDate: string;\r\n    initialBalance: number;\r\n    gridConfig?: any;\r\n  }): Observable<StrategyBacktest> {\r\n    return this.http.post<StrategyBacktest>(`${this.apiUrl}/backtest`, request);\r\n  }\r\n\r\n  getStrategyBacktests(strategyId: string): Observable<StrategyBacktest[]> {\r\n    const params = new HttpParams().set('strategyId', strategyId);\r\n    return this.http.get<StrategyBacktest[]>(`${this.apiUrl}/backtests`, { params });\r\n  }\r\n\r\n  // Performance Analytics\r\n  getStrategyPerformance(strategyId: string, period = '30d'): Observable<StrategyPerformance> {\r\n    const params = new HttpParams()\r\n      .set('strategyId', strategyId)\r\n      .set('period', period);\r\n\r\n    return this.http.get<StrategyPerformance>(`${this.apiUrl}/performance`, { params });\r\n  }\r\n\r\n  compareStrategies(strategyIds: string[], metrics: string[] = ['totalReturn', 'winRate', 'maxDrawdown']): Observable<{\r\n    comparison: any[];\r\n    summary: any;\r\n  }> {\r\n    return this.http.post<any>(`${this.apiUrl}/compare`, {\r\n      strategyIds,\r\n      metrics\r\n    });\r\n  }\r\n\r\n  // Market Scanning\r\n  scanMarket(strategyId: string, symbols: string[]): Observable<{\r\n    matches: {\r\n      symbol: string;\r\n      score: number;\r\n      signals: any[];\r\n      lastPrice: number;\r\n      recommendation: 'BUY' | 'SELL' | 'HOLD';\r\n    }[];\r\n  }> {\r\n    return this.http.post<any>(`${this.apiUrl}/scan`, {\r\n      strategyId,\r\n      symbols\r\n    });\r\n  }\r\n\r\n  // Indicator Utilities\r\n  getAvailableIndicators(): Observable<{\r\n    name: string;\r\n    displayName: string;\r\n    description: string;\r\n    parameters: {\r\n      name: string;\r\n      type: string;\r\n      default: any;\r\n      min?: number;\r\n      max?: number;\r\n      options?: string[];\r\n    }[];\r\n  }[]> {\r\n    return this.http.get<any[]>(`${this.apiUrl}/indicators`);\r\n  }\r\n\r\n  calculateIndicator(params: {\r\n    indicator: string;\r\n    symbol: string;\r\n    timeframe: string;\r\n    period?: number;\r\n    parameters?: any;\r\n  }): Observable<{\r\n    values: number[];\r\n    timestamps: string[];\r\n    current: number;\r\n  }> {\r\n    return this.http.post<any>(`${this.apiUrl}/calculate-indicator`, params);\r\n  }\r\n\r\n  // Strategy Optimization\r\n  optimizeStrategy(params: {\r\n    baseStrategyId: string;\r\n    symbol: string;\r\n    timeframe: string;\r\n    startDate: string;\r\n    endDate: string;\r\n    optimizationTarget: 'profit' | 'winRate' | 'sharpeRatio' | 'profitFactor';\r\n    parameters: {\r\n      name: string;\r\n      min: number;\r\n      max: number;\r\n      step: number;\r\n    }[];\r\n  }): Observable<{\r\n    optimizationId: string;\r\n    status: 'running' | 'completed' | 'failed';\r\n    progress?: number;\r\n    bestParameters?: any;\r\n    bestResult?: any;\r\n  }> {\r\n    return this.http.post<any>(`${this.apiUrl}/optimize`, params);\r\n  }\r\n\r\n  getOptimizationStatus(optimizationId: string): Observable<any> {\r\n    return this.http.get<any>(`${this.apiUrl}/optimization/${optimizationId}`);\r\n  }\r\n\r\n  // Strategy Sharing\r\n  shareStrategy(strategyId: string): Observable<{ shareUrl: string; shareCode: string }> {\r\n    return this.http.post<any>(`${this.apiUrl}/${strategyId}/share`, {});\r\n  }\r\n\r\n  importSharedStrategy(shareCode: string): Observable<Strategy> {\r\n    return this.http.post<Strategy>(`${this.apiUrl}/import-shared`, { shareCode });\r\n  }\r\n\r\n  // Community Features\r\n  getPopularStrategies(limit = 10): Observable<Strategy[]> {\r\n    const params = new HttpParams().set('limit', limit.toString());\r\n    return this.http.get<Strategy[]>(`${this.apiUrl}/popular`, { params });\r\n  }\r\n\r\n  rateStrategy(strategyId: string, rating: number, review?: string): Observable<{ success: boolean }> {\r\n    return this.http.post<any>(`${this.apiUrl}/${strategyId}/rate`, {\r\n      rating,\r\n      review\r\n    });\r\n  }\r\n\r\n  getStrategyRatings(strategyId: string): Observable<{\r\n    averageRating: number;\r\n    totalRatings: number;\r\n    reviews: {\r\n      rating: number;\r\n      review: string;\r\n      user: string;\r\n      createdAt: Date;\r\n    }[];\r\n  }> {\r\n    return this.http.get<any>(`${this.apiUrl}/${strategyId}/ratings`);\r\n  }\r\n\r\n  // AI-Powered Features\r\n  generateStrategyIdeas(params: {\r\n    symbol: string;\r\n    marketCondition: 'trending' | 'sideways' | 'volatile';\r\n    riskTolerance: 'low' | 'medium' | 'high';\r\n    timeframe: string;\r\n  }): Observable<{\r\n    suggestions: {\r\n      name: string;\r\n      description: string;\r\n      entryConditions: string[];\r\n      exitConditions: string[];\r\n      expectedWinRate: number;\r\n      expectedReturn: number;\r\n      riskLevel: string;\r\n    }[];\r\n  }> {\r\n    return this.http.post<any>(`${this.apiUrl}/ai/generate-ideas`, params);\r\n  }\r\n\r\n  improveStrategy(strategyId: string, feedback: string): Observable<{\r\n    suggestions: {\r\n      type: 'add_filter' | 'modify_filter' | 'add_risk_rule' | 'adjust_parameters';\r\n      description: string;\r\n      implementation: any;\r\n      expectedImprovement: string;\r\n    }[];\r\n  }> {\r\n    return this.http.post<any>(`${this.apiUrl}/${strategyId}/ai/improve`, {\r\n      feedback\r\n    });\r\n  }\r\n\r\n  // Export/Import\r\n  exportStrategy(strategyId: string, format: 'json' | 'yaml' | 'pine'): Observable<Blob> {\r\n    const params = new HttpParams().set('format', format);\r\n    return this.http.get(`${this.apiUrl}/${strategyId}/export`, {\r\n      params,\r\n      responseType: 'blob'\r\n    });\r\n  }\r\n\r\n  importStrategy(file: File, format: 'json' | 'yaml' | 'pine'): Observable<Strategy> {\r\n    const formData = new FormData();\r\n    formData.append('strategy', file);\r\n    formData.append('format', format);\r\n\r\n    return this.http.post<Strategy>(`${this.apiUrl}/import`, formData);\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\services\\symbol-info.service.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":26,"column":5,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":28,"endColumn":7},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":175,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":175,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6390,6393],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6390,6393],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { TestBed } from '@angular/core/testing';\r\nimport { HttpClientTestingModule, HttpTestingController } from '@angular/common/http/testing';\r\nimport { SymbolInfoService, SymbolInfo } from './symbol-info.service';\r\nimport { AuthService } from './auth.service';\r\nimport { signal } from '@angular/core';\r\n\r\ndescribe('SymbolInfoService', () => {\r\n  let service: SymbolInfoService;\r\n  let httpMock: HttpTestingController;\r\n  let authServiceMock: jasmine.SpyObj<AuthService>;\r\n\r\n  const mockSymbolInfo: SymbolInfo = {\r\n    symbol: 'MERL-USDT',\r\n    exchange: 'BINGX',\r\n    minOrderQty: 5.292,\r\n    minOrderValue: 10,\r\n    qtyStep: 0.001,\r\n    pricePrecision: 2,\r\n    qtyPrecision: 3,\r\n    maxOrderQty: 10000,\r\n    maxLeverage: 125\r\n  };\r\n\r\n  beforeEach(() => {\r\n    // Create mock AuthService with signal\r\n    authServiceMock = jasmine.createSpyObj('AuthService', [], {\r\n      authState: signal({ token: 'test-token', user: null })\r\n    });\r\n\r\n    TestBed.configureTestingModule({\r\n      imports: [HttpClientTestingModule],\r\n      providers: [\r\n        SymbolInfoService,\r\n        { provide: AuthService, useValue: authServiceMock }\r\n      ]\r\n    });\r\n\r\n    service = TestBed.inject(SymbolInfoService);\r\n    httpMock = TestBed.inject(HttpTestingController);\r\n  });\r\n\r\n  afterEach(() => {\r\n    httpMock.verify();\r\n  });\r\n\r\n  describe('getSymbolInfo', () => {\r\n    it('should fetch symbol info from API', (done) => {\r\n      service.getSymbolInfo('BINGX', 'MERL-USDT').subscribe(result => {\r\n        expect(result).toEqual(mockSymbolInfo);\r\n        done();\r\n      });\r\n\r\n      const req = httpMock.expectOne(request =>\r\n        request.url.includes('/api/exchange/symbol-info') &&\r\n        request.params.get('exchange') === 'BINGX' &&\r\n        request.params.get('symbol') === 'MERL-USDT'\r\n      );\r\n      expect(req.request.method).toBe('GET');\r\n      expect(req.request.headers.get('Authorization')).toBe('Bearer test-token');\r\n\r\n      req.flush({ success: true, data: mockSymbolInfo });\r\n    });\r\n\r\n    it('should cache symbol info after first fetch', (done) => {\r\n      // First call - should hit API\r\n      service.getSymbolInfo('BINGX', 'MERL-USDT').subscribe(result => {\r\n        expect(result).toEqual(mockSymbolInfo);\r\n\r\n        // Second call - should use cache (no HTTP request)\r\n        service.getSymbolInfo('BINGX', 'MERL-USDT').subscribe(cachedResult => {\r\n          expect(cachedResult).toEqual(mockSymbolInfo);\r\n          done();\r\n        });\r\n\r\n        // Verify no second HTTP request was made\r\n        httpMock.expectNone(request =>\r\n          request.url.includes('/api/exchange/symbol-info')\r\n        );\r\n      });\r\n\r\n      const req = httpMock.expectOne(request =>\r\n        request.url.includes('/api/exchange/symbol-info')\r\n      );\r\n      req.flush({ success: true, data: mockSymbolInfo });\r\n    });\r\n\r\n    it('should return null if no token available', (done) => {\r\n      // Update mock to return no token\r\n      Object.defineProperty(authServiceMock, 'authState', {\r\n        value: signal({ token: null, user: null }),\r\n        writable: true\r\n      });\r\n\r\n      service.getSymbolInfo('BINGX', 'MERL-USDT').subscribe(result => {\r\n        expect(result).toBeNull();\r\n        done();\r\n      });\r\n\r\n      httpMock.expectNone(request =>\r\n        request.url.includes('/api/exchange/symbol-info')\r\n      );\r\n    });\r\n\r\n    it('should handle API errors gracefully', (done) => {\r\n      service.getSymbolInfo('BINGX', 'INVALID-SYMBOL').subscribe(result => {\r\n        expect(result).toBeNull();\r\n        done();\r\n      });\r\n\r\n      const req = httpMock.expectOne(request =>\r\n        request.url.includes('/api/exchange/symbol-info')\r\n      );\r\n      req.flush({ success: false, error: 'Symbol not found' }, { status: 404, statusText: 'Not Found' });\r\n    });\r\n  });\r\n\r\n  describe('validateOrderQuantity', () => {\r\n    it('should validate successfully when quantity per part meets minimum', () => {\r\n      const result = service.validateOrderQuantity(mockSymbolInfo, 30, 5);\r\n      expect(result.valid).toBe(true);\r\n      expect(result.error).toBeUndefined();\r\n      expect(result.suggestion).toBeUndefined();\r\n    });\r\n\r\n    it('should fail when quantity per part is below minimum', () => {\r\n      const result = service.validateOrderQuantity(mockSymbolInfo, 10, 5);\r\n      expect(result.valid).toBe(false);\r\n      expect(result.error).toContain('below minimum');\r\n      expect(result.suggestion).toContain('26.460');\r\n    });\r\n\r\n    it('should fail when single order is below minimum', () => {\r\n      const result = service.validateOrderQuantity(mockSymbolInfo, 5, 1);\r\n      expect(result.valid).toBe(false);\r\n      expect(result.error).toContain('below minimum');\r\n      expect(result.suggestion).toContain('5.292');\r\n      expect(result.suggestion).not.toContain('reduce graduated parts');\r\n    });\r\n\r\n    it('should suggest reducing parts when possible', () => {\r\n      const result = service.validateOrderQuantity(mockSymbolInfo, 15, 3);\r\n      expect(result.valid).toBe(false);\r\n      expect(result.suggestion).toContain('reduce graduated parts to 2');\r\n    });\r\n\r\n    it('should not suggest reducing parts below 1', () => {\r\n      const result = service.validateOrderQuantity(mockSymbolInfo, 3, 1);\r\n      expect(result.valid).toBe(false);\r\n      expect(result.suggestion).not.toContain('reduce graduated parts');\r\n    });\r\n\r\n    it('should validate exactly at minimum quantity', () => {\r\n      const result = service.validateOrderQuantity(mockSymbolInfo, 5.292, 1);\r\n      expect(result.valid).toBe(true);\r\n    });\r\n\r\n    it('should validate with multiple parts at minimum per part', () => {\r\n      const result = service.validateOrderQuantity(mockSymbolInfo, 26.46, 5);\r\n      expect(result.valid).toBe(true);\r\n    });\r\n\r\n    it('should fail when quantity per part exceeds maximum', () => {\r\n      const result = service.validateOrderQuantity(mockSymbolInfo, 50000, 1);\r\n      expect(result.valid).toBe(false);\r\n      expect(result.error).toContain('exceeds maximum');\r\n    });\r\n\r\n    it('should fail when quantity is not a multiple of step size', () => {\r\n      const result = service.validateOrderQuantity(mockSymbolInfo, 15.2345, 3);\r\n      expect(result.valid).toBe(false);\r\n      expect(result.error).toContain('multiple of');\r\n    });\r\n\r\n    it('should return error when symbolInfo is null', () => {\r\n      const result = service.validateOrderQuantity(null as any, 10, 1);\r\n      expect(result.valid).toBe(false);\r\n      expect(result.error).toBe('Symbol information not available');\r\n    });\r\n\r\n    it('should allow small floating point errors in step validation', () => {\r\n      // 5.292 * 5 = 26.46, which should be valid despite potential floating point issues\r\n      const result = service.validateOrderQuantity(mockSymbolInfo, 26.46, 5);\r\n      expect(result.valid).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe('clearCache', () => {\r\n    it('should clear cached symbol info', (done) => {\r\n      // First call - cache data\r\n      service.getSymbolInfo('BINGX', 'MERL-USDT').subscribe(() => {\r\n        // Clear cache\r\n        service.clearCache();\r\n\r\n        // Second call - should hit API again\r\n        service.getSymbolInfo('BINGX', 'MERL-USDT').subscribe(result => {\r\n          expect(result).toEqual(mockSymbolInfo);\r\n          done();\r\n        });\r\n\r\n        const req = httpMock.expectOne(request =>\r\n          request.url.includes('/api/exchange/symbol-info')\r\n        );\r\n        req.flush({ success: true, data: mockSymbolInfo });\r\n      });\r\n\r\n      const req = httpMock.expectOne(request =>\r\n        request.url.includes('/api/exchange/symbol-info')\r\n      );\r\n      req.flush({ success: true, data: mockSymbolInfo });\r\n    });\r\n  });\r\n\r\n  describe('Edge Cases', () => {\r\n    it('should handle zero quantity', () => {\r\n      const result = service.validateOrderQuantity(mockSymbolInfo, 0, 1);\r\n      expect(result.valid).toBe(false);\r\n    });\r\n\r\n    it('should handle very large graduated parts', () => {\r\n      const result = service.validateOrderQuantity(mockSymbolInfo, 100, 20);\r\n      expect(result.valid).toBe(false);\r\n      expect(result.error).toContain('below minimum');\r\n    });\r\n\r\n    it('should handle quantity exactly at step boundary', () => {\r\n      // 5.292 is exactly minOrderQty and should be at step boundary\r\n      const result = service.validateOrderQuantity(mockSymbolInfo, 5.292, 1);\r\n      expect(result.valid).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe('Real-world Scenarios', () => {\r\n    it('should handle BingX MERL-USDT original failing case', () => {\r\n      // Original issue: 10 MERL with 5 parts failed with \"minimum is 5.965 MERL\"\r\n      const result = service.validateOrderQuantity(mockSymbolInfo, 10, 5);\r\n      expect(result.valid).toBe(false);\r\n      expect(result.error).toContain('2.000');\r\n      expect(result.error).toContain('5.292');\r\n      expect(result.suggestion).toContain('26.460');\r\n    });\r\n\r\n    it('should allow corrected quantity for original failing case', () => {\r\n      // User increases to 26.46 MERL with 5 parts = 5.292 per part\r\n      const result = service.validateOrderQuantity(mockSymbolInfo, 26.46, 5);\r\n      expect(result.valid).toBe(true);\r\n    });\r\n\r\n    it('should allow reducing parts for original failing case', () => {\r\n      // User keeps 10 MERL but reduces to 1 part\r\n      const result = service.validateOrderQuantity(mockSymbolInfo, 10, 1);\r\n      expect(result.valid).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe('Comprehensive Graduated Entry Validation', () => {\r\n    // Test with different exchange configurations\r\n    const bybitSymbol: SymbolInfo = {\r\n      symbol: 'BTCUSDT',\r\n      exchange: 'BYBIT',\r\n      minOrderQty: 0.001,\r\n      qtyStep: 0.001,\r\n      pricePrecision: 2,\r\n      qtyPrecision: 3,\r\n      maxOrderQty: 1000,\r\n      maxLeverage: 125,\r\n      minOrderValue: 10\r\n    };\r\n\r\n    const gateioSymbol: SymbolInfo = {\r\n      symbol: 'BTC_USDT',\r\n      exchange: 'GATEIO',\r\n      minOrderQty: 1,\r\n      qtyStep: 1,\r\n      pricePrecision: 2,\r\n      qtyPrecision: 0,\r\n      maxOrderQty: 1000000,\r\n      maxLeverage: 25\r\n    };\r\n\r\n    const mexcSymbol: SymbolInfo = {\r\n      symbol: 'BTCUSDT',\r\n      exchange: 'MEXC',\r\n      minOrderQty: 0.0001,\r\n      qtyStep: 0.0001,\r\n      pricePrecision: 2,\r\n      qtyPrecision: 4,\r\n      maxOrderQty: 10000,\r\n      maxLeverage: 200,\r\n      minOrderValue: 5\r\n    };\r\n\r\n    describe('Bybit Exchange Validation', () => {\r\n      it('should validate typical arbitrage positions with graduated entry', () => {\r\n        const result = service.validateOrderQuantity(bybitSymbol, 0.1, 5);\r\n        expect(result.valid).toBe(true);\r\n        // Each part: 0.1 / 5 = 0.02, which is >= 0.001\r\n      });\r\n\r\n      it('should reject micro positions with too many parts', () => {\r\n        const result = service.validateOrderQuantity(bybitSymbol, 0.005, 10);\r\n        expect(result.valid).toBe(false);\r\n        expect(result.error).toContain('Each order part (0.0005) is below minimum (0.001)');\r\n        expect(result.suggestion).toContain('reduce graduated parts to 5');\r\n      });\r\n\r\n      it('should validate maximum order constraints with graduated entry', () => {\r\n        const result = service.validateOrderQuantity(bybitSymbol, 5000, 2);\r\n        expect(result.valid).toBe(false);\r\n        expect(result.error).toContain('Each order part (2500) exceeds maximum (1000)');\r\n      });\r\n\r\n      it('should handle precision edge cases', () => {\r\n        const result = service.validateOrderQuantity(bybitSymbol, 0.0033, 3);\r\n        // Each part: 0.0033 / 3 = 0.0011, which is >= 0.001\r\n        expect(result.valid).toBe(true);\r\n      });\r\n    });\r\n\r\n    describe('Gate.io Exchange Validation', () => {\r\n      it('should handle large minimum quantities typical of Gate.io', () => {\r\n        const result = service.validateOrderQuantity(gateioSymbol, 50, 5);\r\n        expect(result.valid).toBe(true);\r\n        // Each part: 50 / 5 = 10, which is >= 1\r\n      });\r\n\r\n      it('should reject positions where even single part fails minimum', () => {\r\n        const result = service.validateOrderQuantity(gateioSymbol, 0.5, 1);\r\n        expect(result.valid).toBe(false);\r\n        expect(result.error).toContain('Each order part (0.5) is below minimum (1)');\r\n        expect(result.suggestion).toBe('Increase total quantity to at least 1');\r\n      });\r\n\r\n      it('should force reduction to fewer parts when total barely meets requirement', () => {\r\n        const result = service.validateOrderQuantity(gateioSymbol, 3, 5);\r\n        expect(result.valid).toBe(false);\r\n        expect(result.error).toContain('Each order part (0.6) is below minimum (1)');\r\n        expect(result.suggestion).toContain('reduce graduated parts to 3');\r\n      });\r\n\r\n      it('should validate integer step requirements', () => {\r\n        const result = service.validateOrderQuantity(gateioSymbol, 15.7, 3);\r\n        // Each part: 15.7 / 3 = 5.233..., step is 1\r\n        expect(result.valid).toBe(false);\r\n        expect(result.error).toContain('Quantity per part must be a multiple of 1');\r\n      });\r\n    });\r\n\r\n    describe('MEXC Exchange Validation', () => {\r\n      it('should allow very precise micro-positions with many parts', () => {\r\n        const result = service.validateOrderQuantity(mexcSymbol, 0.01, 20);\r\n        expect(result.valid).toBe(true);\r\n        // Each part: 0.01 / 20 = 0.0005, which is >= 0.0001\r\n      });\r\n\r\n      it('should reject ultra-micro positions', () => {\r\n        const result = service.validateOrderQuantity(mexcSymbol, 0.0005, 10);\r\n        expect(result.valid).toBe(false);\r\n        expect(result.error).toContain('Each order part (0.00005) is below minimum (0.0001)');\r\n        expect(result.suggestion).toContain('reduce graduated parts to 5');\r\n      });\r\n\r\n      it('should validate high-precision step constraints', () => {\r\n        const result = service.validateOrderQuantity(mexcSymbol, 0.01234, 7);\r\n        // Each part: 0.01234 / 7 ‚âà 0.001763, step is 0.0001\r\n        expect(result.valid).toBe(true);\r\n      });\r\n    });\r\n\r\n    describe('Complex Graduated Entry Scenarios', () => {\r\n      it('should calculate optimal part suggestions correctly', () => {\r\n        const result = service.validateOrderQuantity(bybitSymbol, 0.007, 15);\r\n        expect(result.valid).toBe(false);\r\n        // Total: 0.007, minOrderQty: 0.001\r\n        // Max parts: floor(0.007 / 0.001) = 7\r\n        expect(result.suggestion).toContain('reduce graduated parts to 7');\r\n      });\r\n\r\n      it('should handle edge case where quantity equals minimum times parts', () => {\r\n        const result = service.validateOrderQuantity(bybitSymbol, 0.005, 5);\r\n        // Each part: 0.005 / 5 = 0.001, exactly equals minimum\r\n        expect(result.valid).toBe(true);\r\n      });\r\n\r\n      it('should suggest quantity increase when parts cannot be reduced further', () => {\r\n        const result = service.validateOrderQuantity(gateioSymbol, 0.5, 1);\r\n        expect(result.valid).toBe(false);\r\n        expect(result.suggestion).toBe('Increase total quantity to at least 1');\r\n      });\r\n\r\n      it('should validate maximum graduated parts scenarios', () => {\r\n        const result = service.validateOrderQuantity(mexcSymbol, 1.0, 100);\r\n        // Each part: 1.0 / 100 = 0.01, which is >= 0.0001\r\n        expect(result.valid).toBe(true);\r\n      });\r\n    });\r\n\r\n    describe('Floating Point Precision Edge Cases', () => {\r\n      it('should handle floating point arithmetic precision issues', () => {\r\n        // Test case where floating point math might cause precision issues\r\n        const result = service.validateOrderQuantity(bybitSymbol, 0.003, 3);\r\n        // Each part: 0.003 / 3 = 0.001, should be valid despite potential floating point errors\r\n        expect(result.valid).toBe(true);\r\n      });\r\n\r\n      it('should use tolerance for step validation', () => {\r\n        // Test with quantity very close to but not exactly divisible by step\r\n        const customSymbol: SymbolInfo = {\r\n          ...bybitSymbol,\r\n          qtyStep: 0.001,\r\n          qtyPrecision: 6\r\n        };\r\n\r\n        const result = service.validateOrderQuantity(customSymbol, 0.003001, 3);\r\n        // Each part: 0.003001 / 3 = 0.001000333..., should pass with tolerance\r\n        expect(result.valid).toBe(true);\r\n      });\r\n\r\n      it('should reject when step difference exceeds tolerance', () => {\r\n        const customSymbol: SymbolInfo = {\r\n          ...bybitSymbol,\r\n          qtyStep: 0.01,\r\n          qtyPrecision: 3\r\n        };\r\n\r\n        const result = service.validateOrderQuantity(customSymbol, 0.157, 3);\r\n        // Each part: 0.157 / 3 = 0.0523..., step: 0.01\r\n        // This difference is too large and should fail\r\n        expect(result.valid).toBe(false);\r\n        expect(result.error).toContain('must be a multiple of 0.01');\r\n      });\r\n    });\r\n\r\n    describe('Real-World Trading Scenarios', () => {\r\n      it('should validate typical $1000 arbitrage position at $100k BTC', () => {\r\n        // Scenario: $1000 position at $100k BTC = 0.01 BTC, split into 5 parts\r\n        const result = service.validateOrderQuantity(bybitSymbol, 0.01, 5);\r\n        expect(result.valid).toBe(true);\r\n        // Each part: 0.01 / 5 = 0.002, which is >= 0.001\r\n      });\r\n\r\n      it('should validate large institutional order splitting', () => {\r\n        // Scenario: 10 BTC split into 50 parts for gradual execution\r\n        const result = service.validateOrderQuantity(bybitSymbol, 10, 50);\r\n        expect(result.valid).toBe(true);\r\n        // Each part: 10 / 50 = 0.2, which is >= 0.001\r\n      });\r\n\r\n      it('should handle micro-trading test orders', () => {\r\n        // Scenario: Very small test trade\r\n        const result = service.validateOrderQuantity(bybitSymbol, 0.001, 3);\r\n        expect(result.valid).toBe(false);\r\n        // Each part: 0.001 / 3 = 0.000333..., which is < 0.001\r\n        expect(result.suggestion).toContain('reduce graduated parts to 1');\r\n      });\r\n\r\n      it('should validate approaching exchange maximum limits', () => {\r\n        // Scenario: Large order approaching exchange limits with graduation\r\n        const result = service.validateOrderQuantity(bybitSymbol, 1500, 2);\r\n        expect(result.valid).toBe(false);\r\n        // Each part: 1500 / 2 = 750, should be valid but total exceeds typical limits\r\n        expect(result.error).toContain('exceeds maximum');\r\n      });\r\n    });\r\n\r\n    describe('Error Message Quality', () => {\r\n      it('should provide actionable error messages with proper formatting', () => {\r\n        const result = service.validateOrderQuantity(gateioSymbol, 3, 5);\r\n        expect(result.valid).toBe(false);\r\n        expect(result.error).toMatch(/Each order part \\(\\d+(\\.\\d+)?\\) is below minimum \\(\\d+\\)/);\r\n        expect(result.suggestion).toMatch(/Increase total quantity to at least \\d+ or reduce graduated parts to \\d+/);\r\n      });\r\n\r\n      it('should format small numbers with appropriate precision', () => {\r\n        const result = service.validateOrderQuantity(bybitSymbol, 0.001, 5);\r\n        expect(result.error).toContain('(0.0002)'); // Should show appropriate decimal places\r\n        expect(result.suggestion).toContain('0.005'); // Should show appropriate precision\r\n      });\r\n\r\n      it('should provide clear step size violation messages', () => {\r\n        const result = service.validateOrderQuantity(mockSymbolInfo, 15.2345, 3);\r\n        expect(result.valid).toBe(false);\r\n        expect(result.error).toContain('must be a multiple of 0.001');\r\n        expect(result.suggestion).toMatch(/Adjust total quantity to \\d+\\.\\d+/);\r\n      });\r\n    });\r\n\r\n    describe('Boundary Conditions and Edge Cases', () => {\r\n      it('should handle zero quantity gracefully', () => {\r\n        const result = service.validateOrderQuantity(bybitSymbol, 0, 5);\r\n        expect(result.valid).toBe(false);\r\n        expect(result.error).toContain('is below minimum');\r\n      });\r\n\r\n      it('should handle zero graduated parts (division by zero)', () => {\r\n        const result = service.validateOrderQuantity(bybitSymbol, 1, 0);\r\n        expect(result.valid).toBe(false);\r\n        // Should handle gracefully without throwing\r\n      });\r\n\r\n      it('should handle very large quantities without precision loss', () => {\r\n        const result = service.validateOrderQuantity(mexcSymbol, 1000000, 1);\r\n        expect(result.valid).toBe(true);\r\n      });\r\n\r\n      it('should handle symbols without maximum order quantity', () => {\r\n        const symbolWithoutMax: SymbolInfo = {\r\n          ...bybitSymbol,\r\n          maxOrderQty: undefined\r\n        };\r\n\r\n        const result = service.validateOrderQuantity(symbolWithoutMax, 10000, 2);\r\n        expect(result.valid).toBe(true);\r\n        // Should not fail when no max quantity is defined\r\n      });\r\n\r\n      it('should handle negative quantities', () => {\r\n        const result = service.validateOrderQuantity(bybitSymbol, -1, 5);\r\n        expect(result.valid).toBe(false);\r\n      });\r\n\r\n      it('should handle extremely large graduated parts', () => {\r\n        const result = service.validateOrderQuantity(bybitSymbol, 1, 10000);\r\n        expect(result.valid).toBe(false);\r\n        expect(result.error).toContain('is below minimum');\r\n      });\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\services\\symbol-info.service.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":40,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1217,1220],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1217,1220],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .success on an `any` value.","line":42,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":42,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":42,"column":44,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":42,"endColumn":48},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":43,"column":39,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":43,"endColumn":43}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Injectable, inject } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Observable, of } from 'rxjs';\r\nimport { map, catchError } from 'rxjs/operators';\r\nimport { getEndpointUrl } from '../config/app.config';\r\n\r\nexport interface SymbolInfo {\r\n  symbol: string;\r\n  exchange: string;\r\n  minOrderQty: number;\r\n  minOrderValue?: number; // Minimum notional value in USDT\r\n  qtyStep: number; // Quantity step size\r\n  pricePrecision: number;\r\n  qtyPrecision: number;\r\n  maxOrderQty?: number;\r\n  maxLeverage?: number;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class SymbolInfoService {\r\n  private http = inject(HttpClient);\r\n  private cache = new Map<string, SymbolInfo>();\r\n\r\n  /**\r\n   * Get symbol information from backend API\r\n   * Includes caching to avoid unnecessary API calls\r\n   */\r\n  getSymbolInfo(exchange: string, symbol: string): Observable<SymbolInfo | null> {\r\n    const cacheKey = `${exchange}:${symbol}`;\r\n\r\n    // Check cache first\r\n    if (this.cache.has(cacheKey)) {\r\n      return of(this.cache.get(cacheKey)!);\r\n    }\r\n\r\n    const url = `${getEndpointUrl('exchange', 'symbolInfo')}?exchange=${exchange}&symbol=${symbol}`;\r\n\r\n    return this.http.get<any>(url).pipe(\r\n      map(response => {\r\n        if (response?.success && response?.data) {\r\n          const symbolInfo = response.data as SymbolInfo;\r\n          // Store in cache\r\n          this.cache.set(cacheKey, symbolInfo);\r\n          return symbolInfo;\r\n        }\r\n        return null;\r\n      }),\r\n      catchError(() => {\r\n        return of(null);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Clear cache (useful when switching symbols or exchanges)\r\n   */\r\n  clearCache(): void {\r\n    this.cache.clear();\r\n  }\r\n\r\n  /**\r\n   * Validate order quantity against minimum requirements and graduated entry parts\r\n   *\r\n   * @param symbolInfo Symbol trading rules\r\n   * @param totalQuantity Total order quantity\r\n   * @param graduatedParts Number of parts to split the order into\r\n   * @returns Validation result with error message if invalid\r\n   */\r\n  validateOrderQuantity(\r\n    symbolInfo: SymbolInfo,\r\n    totalQuantity: number,\r\n    graduatedParts = 1\r\n  ): { valid: boolean; error?: string; suggestion?: string } {\r\n    if (!symbolInfo) {\r\n      return { valid: false, error: 'Symbol information not available' };\r\n    }\r\n\r\n    // Calculate quantity per part\r\n    const qtyPerPart = totalQuantity / graduatedParts;\r\n\r\n    // Check if quantity per part meets minimum requirement\r\n    if (qtyPerPart < symbolInfo.minOrderQty) {\r\n      const minTotalQty = symbolInfo.minOrderQty * graduatedParts;\r\n      const maxParts = Math.floor(totalQuantity / symbolInfo.minOrderQty);\r\n\r\n      // Extract coin symbol for clearer suggestions\r\n      const coinSymbol = this.extractCoinSymbol(symbolInfo.symbol);\r\n      \r\n      // Different suggestions based on whether we can reduce parts\r\n      let suggestion: string;\r\n      if (graduatedParts === 1 || maxParts === 0) {\r\n        // Can't reduce parts further, only option is to increase quantity\r\n        suggestion = `Increase total quantity to at least ${minTotalQty.toFixed(symbolInfo.qtyPrecision)} ${coinSymbol}`;\r\n      } else {\r\n        // Can reduce parts or increase quantity\r\n        suggestion = `Increase total quantity to at least ${minTotalQty.toFixed(symbolInfo.qtyPrecision)} ${coinSymbol} or reduce graduated parts to ${maxParts}`;\r\n      }\r\n      \r\n      return {\r\n        valid: false,\r\n        error: `Each order part (${qtyPerPart.toFixed(symbolInfo.qtyPrecision)} ${coinSymbol}) is below minimum (${symbolInfo.minOrderQty} ${coinSymbol})`,\r\n        suggestion\r\n      };\r\n    }\r\n\r\n    // Check maximum quantity if defined\r\n    if (symbolInfo.maxOrderQty && qtyPerPart > symbolInfo.maxOrderQty) {\r\n      const coinSymbol = this.extractCoinSymbol(symbolInfo.symbol);\r\n      return {\r\n        valid: false,\r\n        error: `Each order part (${qtyPerPart.toFixed(symbolInfo.qtyPrecision)} ${coinSymbol}) exceeds maximum (${symbolInfo.maxOrderQty} ${coinSymbol})`,\r\n        suggestion: `Decrease quantity or increase graduated parts`\r\n      };\r\n    }\r\n\r\n    // Check quantity step\r\n    // Round to avoid floating point precision issues\r\n    const roundedQtyPerPart = Math.round(qtyPerPart / symbolInfo.qtyStep) * symbolInfo.qtyStep;\r\n    const difference = Math.abs(qtyPerPart - roundedQtyPerPart);\r\n\r\n    // If difference is significant (more than 0.1% of step size), quantity is not valid\r\n    if (difference > symbolInfo.qtyStep * 0.001) {\r\n      const coinSymbol = this.extractCoinSymbol(symbolInfo.symbol);\r\n      return {\r\n        valid: false,\r\n        error: `Quantity per part must be a multiple of ${symbolInfo.qtyStep} ${coinSymbol}`,\r\n        suggestion: `Adjust total quantity to ${(roundedQtyPerPart * graduatedParts).toFixed(symbolInfo.qtyPrecision)} ${coinSymbol}`\r\n      };\r\n    }\r\n\r\n    return { valid: true };\r\n  }\r\n\r\n  /**\r\n   * Extract coin symbol from trading pair for clearer error messages\r\n   * Examples: \r\n   * - FUSDT -> FUSDT\r\n   * - F-USDT -> F\r\n   * - BTC_USDT -> BTC\r\n   * - BTCUSDT -> BTC\r\n   */\r\n  private extractCoinSymbol(symbol: string): string {\r\n    // Handle hyphenated symbols (BingX format)\r\n    if (symbol.includes('-')) {\r\n      return symbol.split('-')[0];\r\n    }\r\n    \r\n    // Handle underscore symbols (Gate.io format)  \r\n    if (symbol.includes('_')) {\r\n      return symbol.split('_')[0];\r\n    }\r\n    \r\n    // Handle concatenated symbols (Bybit/MEXC format)\r\n    // Remove common quote currencies\r\n    const quoteCurrencies = ['USDT', 'USDC', 'USD', 'BTC', 'ETH'];\r\n    for (const quote of quoteCurrencies) {\r\n      if (symbol.endsWith(quote)) {\r\n        const base = symbol.slice(0, -quote.length);\r\n        if (base.length > 0) {\r\n          return base;\r\n        }\r\n      }\r\n    }\r\n    \r\n    // If no pattern matches, return the original symbol\r\n    return symbol;\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\services\\trade-history.service.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":114,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":114,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":128,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":128,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":140,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":140,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":152,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":152,"endColumn":31},{"ruleId":"@typescript-eslint/no-empty-function","severity":2,"message":"Unexpected empty method 'error'.","line":245,"column":58,"nodeType":"ArrowFunctionExpression","messageId":"unexpected","endLine":245,"endColumn":60,"suggestions":[{"messageId":"suggestComment","data":{"name":"method 'error'"},"fix":{"range":[7784,7784],"text":" /* empty */ "},"desc":"Add comment inside empty method 'error'."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { TestBed } from '@angular/core/testing';\r\nimport { HttpClientTestingModule, HttpTestingController } from '@angular/common/http/testing';\r\nimport { TradeHistoryService } from './trade-history.service';\r\nimport {\r\n  TradeHistoryRecord,\r\n  TradeHistoryResponse,\r\n  TradeHistoryQueryParams\r\n} from '../models/trade-history.model';\r\nimport { buildApiUrl } from '../config/app.config';\r\n\r\ndescribe('TradeHistoryService', () => {\r\n  let service: TradeHistoryService;\r\n  let httpMock: HttpTestingController;\r\n\r\n  const mockTradeRecord: TradeHistoryRecord = {\r\n    id: 'trade-1',\r\n    symbol: 'BTCUSDT',\r\n    exchange: 'bybit',\r\n    executedAt: '2025-10-01T10:00:00Z',\r\n    closedAt: '2025-10-01T12:00:00Z',\r\n    positionSizeUsdt: 1000,\r\n    fundingEarned: 5.5,\r\n    realizedPnl: 25.75,\r\n    entryPrice: 50000,\r\n    exitPrice: 50500,\r\n    leverage: 5,\r\n    quantity: 0.1,\r\n    status: 'CLOSED',\r\n    positionType: 'long',\r\n    entryFee: 0.5,\r\n    exitFee: 0.5,\r\n    duration: 7200,\r\n    roi: 2.5\r\n  };\r\n\r\n  const mockTradeResponse: TradeHistoryResponse = {\r\n    success: true,\r\n    data: [mockTradeRecord],\r\n    count: 1\r\n  };\r\n\r\n  beforeEach(() => {\r\n    TestBed.configureTestingModule({\r\n      imports: [HttpClientTestingModule],\r\n      providers: [TradeHistoryService]\r\n    });\r\n    service = TestBed.inject(TradeHistoryService);\r\n    httpMock = TestBed.inject(HttpTestingController);\r\n  });\r\n\r\n  afterEach(() => {\r\n    httpMock.verify();\r\n  });\r\n\r\n  it('should be created', () => {\r\n    expect(service).toBeTruthy();\r\n  });\r\n\r\n  describe('getTradeHistory', () => {\r\n    it('should fetch trade history successfully', (done) => {\r\n      service.getTradeHistory().subscribe(response => {\r\n        expect(response.success).toBe(true);\r\n        expect(response.data.length).toBe(1);\r\n        expect(response.data[0].symbol).toBe('BTCUSDT');\r\n        expect(service.trades().length).toBe(1);\r\n        expect(service.totalCount()).toBe(1);\r\n        expect(service.isLoading()).toBe(false);\r\n        done();\r\n      });\r\n\r\n      const req = httpMock.expectOne(buildApiUrl('/trading/history'));\r\n      expect(req.request.method).toBe('GET');\r\n      req.flush(mockTradeResponse);\r\n    });\r\n\r\n    it('should set loading state correctly during request', () => {\r\n      expect(service.isLoading()).toBe(false);\r\n\r\n      service.getTradeHistory().subscribe();\r\n\r\n      expect(service.isLoading()).toBe(true);\r\n\r\n      const req = httpMock.expectOne(buildApiUrl('/trading/history'));\r\n      req.flush(mockTradeResponse);\r\n\r\n      // After response, loading should be false\r\n      expect(service.isLoading()).toBe(false);\r\n    });\r\n\r\n    it('should build URL with query parameters correctly', (done) => {\r\n      const params: TradeHistoryQueryParams = {\r\n        symbol: 'BTCUSDT',\r\n        exchange: 'bybit',\r\n        limit: 50,\r\n        status: 'CLOSED'\r\n      };\r\n\r\n      service.getTradeHistory(params).subscribe(() => done());\r\n\r\n      const req = httpMock.expectOne(req =>\r\n        req.url.includes('/trading/history') &&\r\n        req.url.includes('symbol=BTCUSDT') &&\r\n        req.url.includes('exchange=bybit') &&\r\n        req.url.includes('limit=50') &&\r\n        req.url.includes('status=CLOSED')\r\n      );\r\n      expect(req.request.method).toBe('GET');\r\n      req.flush(mockTradeResponse);\r\n    });\r\n\r\n    it('should handle HTTP errors gracefully', (done) => {\r\n      service.getTradeHistory().subscribe({\r\n        error: (error) => {\r\n          expect(error.message).toContain('Server error');\r\n          expect(service.error()).toContain('Server error');\r\n          expect(service.isLoading()).toBe(false);\r\n          done();\r\n        }\r\n      });\r\n\r\n      const req = httpMock.expectOne(buildApiUrl('/trading/history'));\r\n      req.flush({ message: 'Internal server error' }, { status: 500, statusText: 'Server Error' });\r\n    });\r\n\r\n    it('should handle 401 unauthorized error', (done) => {\r\n      service.getTradeHistory().subscribe({\r\n        error: (error) => {\r\n          expect(error.message).toContain('Unauthorized');\r\n          done();\r\n        }\r\n      });\r\n\r\n      const req = httpMock.expectOne(buildApiUrl('/trading/history'));\r\n      req.flush({ message: 'Unauthorized' }, { status: 401, statusText: 'Unauthorized' });\r\n    });\r\n\r\n    it('should handle 403 forbidden error', (done) => {\r\n      service.getTradeHistory().subscribe({\r\n        error: (error) => {\r\n          expect(error.message).toContain('forbidden');\r\n          done();\r\n        }\r\n      });\r\n\r\n      const req = httpMock.expectOne(buildApiUrl('/trading/history'));\r\n      req.flush({ message: 'Forbidden' }, { status: 403, statusText: 'Forbidden' });\r\n    });\r\n\r\n    it('should handle network errors', (done) => {\r\n      service.getTradeHistory().subscribe({\r\n        error: (error) => {\r\n          expect(error.message).toContain('Unable to connect');\r\n          done();\r\n        }\r\n      });\r\n\r\n      const req = httpMock.expectOne(buildApiUrl('/trading/history'));\r\n      req.error(new ProgressEvent('error'), { status: 0 });\r\n    });\r\n  });\r\n\r\n  describe('getTradeHistoryBySymbol', () => {\r\n    it('should fetch trades for specific symbol and exchange', (done) => {\r\n      service.getTradeHistoryBySymbol('BTCUSDT', 'bybit', 100).subscribe(() => done());\r\n\r\n      const req = httpMock.expectOne(req =>\r\n        req.url.includes('symbol=BTCUSDT') &&\r\n        req.url.includes('exchange=bybit') &&\r\n        req.url.includes('limit=100')\r\n      );\r\n      req.flush(mockTradeResponse);\r\n    });\r\n  });\r\n\r\n  describe('getTradeHistoryByExchange', () => {\r\n    it('should fetch trades for specific exchange', (done) => {\r\n      service.getTradeHistoryByExchange('bybit', 50).subscribe(() => done());\r\n\r\n      const req = httpMock.expectOne(req =>\r\n        req.url.includes('exchange=bybit') &&\r\n        req.url.includes('limit=50')\r\n      );\r\n      req.flush(mockTradeResponse);\r\n    });\r\n  });\r\n\r\n  describe('getClosedTrades', () => {\r\n    it('should fetch only closed trades', (done) => {\r\n      service.getClosedTrades(25).subscribe(() => done());\r\n\r\n      const req = httpMock.expectOne(req =>\r\n        req.url.includes('status=CLOSED') &&\r\n        req.url.includes('limit=25')\r\n      );\r\n      req.flush(mockTradeResponse);\r\n    });\r\n  });\r\n\r\n  describe('getOpenTrades', () => {\r\n    it('should fetch only open trades', (done) => {\r\n      service.getOpenTrades(10).subscribe(() => done());\r\n\r\n      const req = httpMock.expectOne(req =>\r\n        req.url.includes('status=OPEN') &&\r\n        req.url.includes('limit=10')\r\n      );\r\n      req.flush(mockTradeResponse);\r\n    });\r\n  });\r\n\r\n  describe('getTradeHistoryByDateRange', () => {\r\n    it('should fetch trades within date range', (done) => {\r\n      const startDate = '2025-10-01T00:00:00Z';\r\n      const endDate = '2025-10-31T23:59:59Z';\r\n\r\n      service.getTradeHistoryByDateRange(startDate, endDate, 100).subscribe(() => done());\r\n\r\n      const req = httpMock.expectOne(req =>\r\n        req.url.includes('startDate=' + encodeURIComponent(startDate)) &&\r\n        req.url.includes('endDate=' + encodeURIComponent(endDate))\r\n      );\r\n      req.flush(mockTradeResponse);\r\n    });\r\n  });\r\n\r\n  describe('State Management', () => {\r\n    it('should clear trade history', () => {\r\n      // First load some data\r\n      service.getTradeHistory().subscribe();\r\n      const req = httpMock.expectOne(buildApiUrl('/trading/history'));\r\n      req.flush(mockTradeResponse);\r\n\r\n      expect(service.trades().length).toBe(1);\r\n\r\n      // Clear data\r\n      service.clearTradeHistory();\r\n\r\n      expect(service.trades().length).toBe(0);\r\n      expect(service.totalCount()).toBe(0);\r\n      expect(service.error()).toBeNull();\r\n    });\r\n\r\n    it('should clear error state', () => {\r\n      // Trigger an error\r\n      service.getTradeHistory().subscribe({ error: () => {} });\r\n      const req = httpMock.expectOne(buildApiUrl('/trading/history'));\r\n      req.flush({ message: 'Error' }, { status: 500, statusText: 'Error' });\r\n\r\n      expect(service.error()).not.toBeNull();\r\n\r\n      // Clear error\r\n      service.clearError();\r\n\r\n      expect(service.error()).toBeNull();\r\n    });\r\n  });\r\n\r\n  describe('Computed Signals', () => {\r\n    beforeEach(() => {\r\n      const response: TradeHistoryResponse = {\r\n        success: true,\r\n        data: [\r\n          { ...mockTradeRecord, status: 'OPEN', id: 'trade-1' },\r\n          { ...mockTradeRecord, status: 'CLOSED', id: 'trade-2' },\r\n          { ...mockTradeRecord, status: 'CLOSED', id: 'trade-3' }\r\n        ],\r\n        count: 3\r\n      };\r\n\r\n      service.getTradeHistory().subscribe();\r\n      const req = httpMock.expectOne(buildApiUrl('/trading/history'));\r\n      req.flush(response);\r\n    });\r\n\r\n    it('should compute hasTrades correctly', () => {\r\n      expect(service.hasTrades()).toBe(true);\r\n    });\r\n\r\n    it('should filter open trades', () => {\r\n      expect(service.openTrades().length).toBe(1);\r\n      expect(service.openTrades()[0].status).toBe('OPEN');\r\n    });\r\n\r\n    it('should filter closed trades', () => {\r\n      expect(service.closedTrades().length).toBe(2);\r\n      expect(service.closedTrades().every(t => t.status === 'CLOSED')).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe('Statistics Calculation', () => {\r\n    it('should calculate statistics correctly', () => {\r\n      const trades: TradeHistoryRecord[] = [\r\n        { ...mockTradeRecord, realizedPnl: 50, fundingEarned: 5, status: 'CLOSED', entryFee: 1, exitFee: 1 },\r\n        { ...mockTradeRecord, realizedPnl: -20, fundingEarned: 3, status: 'CLOSED', entryFee: 1, exitFee: 1 },\r\n        { ...mockTradeRecord, realizedPnl: 30, fundingEarned: 4, status: 'CLOSED', entryFee: 1, exitFee: 1 }\r\n      ];\r\n\r\n      const stats = service.calculateStatistics(trades);\r\n\r\n      expect(stats.totalTrades).toBe(3);\r\n      expect(stats.profitableTrades).toBe(2);\r\n      expect(stats.losingTrades).toBe(1);\r\n      expect(stats.winRate).toBeCloseTo(66.67, 1);\r\n      expect(stats.totalPnl).toBe(60);\r\n      expect(stats.totalFunding).toBe(12);\r\n      expect(stats.largestWin).toBe(50);\r\n      expect(stats.largestLoss).toBe(-20);\r\n      expect(stats.totalFees).toBe(6);\r\n      expect(stats.netProfit).toBe(54);\r\n    });\r\n\r\n    it('should return empty statistics for empty array', () => {\r\n      const stats = service.calculateStatistics([]);\r\n\r\n      expect(stats.totalTrades).toBe(0);\r\n      expect(stats.winRate).toBe(0);\r\n      expect(stats.totalPnl).toBe(0);\r\n    });\r\n  });\r\n\r\n  describe('Utility Methods', () => {\r\n    it('should format duration correctly', () => {\r\n      expect(service.formatDuration(7200)).toBe('2h 0m');\r\n      expect(service.formatDuration(3665)).toBe('1h 1m');\r\n      expect(service.formatDuration(90)).toBe('1m 30s');\r\n      expect(service.formatDuration(45)).toBe('45s');\r\n    });\r\n\r\n    it('should format PnL correctly', () => {\r\n      const positivePnl = service.formatPnl(25.5);\r\n      expect(positivePnl.value).toBe('+25.50');\r\n      expect(positivePnl.color).toBe('green');\r\n      expect(positivePnl.isPositive).toBe(true);\r\n\r\n      const negativePnl = service.formatPnl(-15.25);\r\n      expect(negativePnl.value).toBe('-15.25');\r\n      expect(negativePnl.color).toBe('red');\r\n      expect(negativePnl.isPositive).toBe(false);\r\n\r\n      const zeroPnl = service.formatPnl(0);\r\n      expect(zeroPnl.value).toBe('+0.00');\r\n      expect(zeroPnl.isPositive).toBe(true);\r\n    });\r\n\r\n    it('should get trade count', () => {\r\n      service.getTradeHistory().subscribe();\r\n      const req = httpMock.expectOne(buildApiUrl('/trading/history'));\r\n      req.flush(mockTradeResponse);\r\n\r\n      expect(service.getTradeCount()).toBe(1);\r\n    });\r\n\r\n    it('should check loading state', () => {\r\n      expect(service.isCurrentlyLoading()).toBe(false);\r\n    });\r\n  });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\services\\trade-history.service.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'HttpParams' is defined but never used.","line":2,"column":41,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":51},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'map' is defined but never used.","line":4,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":25},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .error on an `any` value.","line":465,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":465,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":466,"column":7,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":466,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .error on an `any` value.","line":466,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":466,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":469,"column":22,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":469,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":470,"column":7,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":470,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .message on an `any` value.","line":470,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":470,"endColumn":33}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Injectable, signal, computed } from '@angular/core';\r\nimport { HttpClient, HttpErrorResponse, HttpParams } from '@angular/common/http';\r\nimport { Observable, throwError, BehaviorSubject } from 'rxjs';\r\nimport { catchError, map, tap, finalize } from 'rxjs/operators';\r\nimport { buildApiUrl, buildUrlWithQuery } from '../config/app.config';\r\nimport {\r\n  TradeHistoryRecord,\r\n  TradeHistoryResponse,\r\n  TradeHistoryQueryParams,\r\n  TradeStatistics\r\n} from '../models/trade-history.model';\r\n\r\n/**\r\n * Trade History Service\r\n *\r\n * Manages trade history data retrieval, caching, and state management for the application.\r\n * This service provides:\r\n * - Fetching trade history from backend API\r\n * - Query parameter support for filtering and pagination\r\n * - Reactive state management with Angular signals\r\n * - Comprehensive error handling\r\n * - Trade statistics calculation\r\n * - Caching of fetched data\r\n *\r\n * @example\r\n * ```typescript\r\n * constructor(private tradeHistoryService: TradeHistoryService) {\r\n *   // Fetch trades for a specific symbol\r\n *   this.tradeHistoryService.getTradeHistory({ symbol: 'BTCUSDT', limit: 50 })\r\n *     .subscribe(response => {\r\n *       console.log('Trades:', response.data);\r\n *     });\r\n *\r\n *   // Access cached trades via signal\r\n *   const trades = this.tradeHistoryService.trades();\r\n *\r\n *   // Check loading state\r\n *   const isLoading = this.tradeHistoryService.isLoading();\r\n * }\r\n * ```\r\n */\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class TradeHistoryService {\r\n  // ============================================================================\r\n  // SIGNALS - Reactive State Management\r\n  // ============================================================================\r\n\r\n  private readonly _trades = signal<TradeHistoryRecord[]>([]);\r\n  public readonly trades = this._trades.asReadonly();\r\n\r\n  private readonly _loading = signal<boolean>(false);\r\n  public readonly isLoading = this._loading.asReadonly();\r\n\r\n  private readonly _error = signal<string | null>(null);\r\n  public readonly error = this._error.asReadonly();\r\n\r\n  private readonly _totalCount = signal<number>(0);\r\n  public readonly totalCount = this._totalCount.asReadonly();\r\n\r\n  // ============================================================================\r\n  // BEHAVIOR SUBJECTS - Observable State (for compatibility)\r\n  // ============================================================================\r\n\r\n  private tradesSubject = new BehaviorSubject<TradeHistoryRecord[]>([]);\r\n  private loadingSubject = new BehaviorSubject<boolean>(false);\r\n  private errorSubject = new BehaviorSubject<string | null>(null);\r\n\r\n  public readonly trades$ = this.tradesSubject.asObservable();\r\n  public readonly loading$ = this.loadingSubject.asObservable();\r\n  public readonly error$ = this.errorSubject.asObservable();\r\n\r\n  // ============================================================================\r\n  // COMPUTED SIGNALS - Derived State\r\n  // ============================================================================\r\n\r\n  /**\r\n   * Indicates whether any trade history data has been loaded\r\n   */\r\n  public readonly hasTrades = computed(() => this.trades().length > 0);\r\n\r\n  /**\r\n   * Filtered trades by status\r\n   */\r\n  public readonly openTrades = computed(() =>\r\n    this.trades().filter(trade => trade.status === 'OPEN')\r\n  );\r\n\r\n  public readonly closedTrades = computed(() =>\r\n    this.trades().filter(trade => trade.status === 'CLOSED')\r\n  );\r\n\r\n  /**\r\n   * Calculate trade statistics from loaded trades\r\n   */\r\n  public readonly statistics = computed(() =>\r\n    this.calculateStatistics(this.trades())\r\n  );\r\n\r\n  // ============================================================================\r\n  // CONSTRUCTOR\r\n  // ============================================================================\r\n\r\n  constructor(private http: HttpClient) {}\r\n\r\n  // ============================================================================\r\n  // PUBLIC METHODS - API Operations\r\n  // ============================================================================\r\n\r\n  /**\r\n   * Fetch trade history from the backend API\r\n   *\r\n   * This method fetches trade history based on the provided query parameters.\r\n   * The authentication token is automatically added by the auth interceptor.\r\n   *\r\n   * @param params - Query parameters for filtering and pagination\r\n   * @returns Observable<TradeHistoryResponse> - API response with trade records\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * // Fetch all trades for BTC on Bybit\r\n   * service.getTradeHistory({\r\n   *   symbol: 'BTCUSDT',\r\n   *   exchange: 'bybit',\r\n   *   limit: 100\r\n   * }).subscribe(response => {\r\n   *   console.log('Fetched trades:', response.data.length);\r\n   * });\r\n   * ```\r\n   */\r\n  getTradeHistory(params?: TradeHistoryQueryParams): Observable<TradeHistoryResponse> {\r\n    // Set loading state\r\n    this._loading.set(true);\r\n    this._error.set(null);\r\n    this.loadingSubject.next(true);\r\n    this.errorSubject.next(null);\r\n\r\n    // Build API URL\r\n    const baseUrl = buildApiUrl('/arbitrage/trade-history');\r\n    const url = params ? this.buildUrlWithParams(baseUrl, params) : baseUrl;\r\n\r\n    return this.http.get<TradeHistoryResponse>(url).pipe(\r\n      tap(response => {\r\n        console.log('[TradeHistoryService] Fetched trades:', response.count);\r\n\r\n        // Update state with fetched data\r\n        this._trades.set(response.data);\r\n        this._totalCount.set(response.count);\r\n        this.tradesSubject.next(response.data);\r\n      }),\r\n      catchError(error => {\r\n        const errorMessage = this.handleError(error);\r\n        this._error.set(errorMessage);\r\n        this.errorSubject.next(errorMessage);\r\n        return throwError(() => new Error(errorMessage));\r\n      }),\r\n      finalize(() => {\r\n        this._loading.set(false);\r\n        this.loadingSubject.next(false);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Fetch trade history for a specific symbol and exchange\r\n   *\r\n   * Convenience method for the most common use case.\r\n   *\r\n   * @param symbol - Trading pair symbol (e.g., 'BTCUSDT')\r\n   * @param exchange - Exchange name (e.g., 'bybit', 'bingx')\r\n   * @param limit - Maximum number of records to fetch (default: 100)\r\n   * @returns Observable<TradeHistoryResponse>\r\n   */\r\n  getTradeHistoryBySymbol(\r\n    symbol: string,\r\n    exchange: string,\r\n    limit = 100\r\n  ): Observable<TradeHistoryResponse> {\r\n    return this.getTradeHistory({ symbol, exchange, limit });\r\n  }\r\n\r\n  /**\r\n   * Fetch trade history by exchange only\r\n   *\r\n   * @param exchange - Exchange name\r\n   * @param limit - Maximum number of records to fetch\r\n   * @returns Observable<TradeHistoryResponse>\r\n   */\r\n  getTradeHistoryByExchange(\r\n    exchange: string,\r\n    limit?: number\r\n  ): Observable<TradeHistoryResponse> {\r\n    return this.getTradeHistory({ exchange, limit });\r\n  }\r\n\r\n  /**\r\n   * Fetch closed trades only\r\n   *\r\n   * @param limit - Maximum number of records to fetch\r\n   * @returns Observable<TradeHistoryResponse>\r\n   */\r\n  getClosedTrades(limit?: number): Observable<TradeHistoryResponse> {\r\n    return this.getTradeHistory({ status: 'CLOSED', limit });\r\n  }\r\n\r\n  /**\r\n   * Fetch open trades only\r\n   *\r\n   * @param limit - Maximum number of records to fetch\r\n   * @returns Observable<TradeHistoryResponse>\r\n   */\r\n  getOpenTrades(limit?: number): Observable<TradeHistoryResponse> {\r\n    return this.getTradeHistory({ status: 'OPEN', limit });\r\n  }\r\n\r\n  /**\r\n   * Fetch trades within a date range\r\n   *\r\n   * @param startDate - Start date (ISO 8601 string)\r\n   * @param endDate - End date (ISO 8601 string)\r\n   * @param limit - Maximum number of records to fetch\r\n   * @returns Observable<TradeHistoryResponse>\r\n   */\r\n  getTradeHistoryByDateRange(\r\n    startDate: string,\r\n    endDate: string,\r\n    limit?: number\r\n  ): Observable<TradeHistoryResponse> {\r\n    return this.getTradeHistory({ startDate, endDate, limit });\r\n  }\r\n\r\n  // ============================================================================\r\n  // PUBLIC METHODS - Utility Functions\r\n  // ============================================================================\r\n\r\n  /**\r\n   * Refresh the currently loaded trade history\r\n   *\r\n   * Re-fetches trade history using the last query parameters.\r\n   */\r\n  refreshTradeHistory(): Observable<TradeHistoryResponse> {\r\n    // For now, just fetch all trades\r\n    // In a production app, you might want to store the last query params\r\n    return this.getTradeHistory();\r\n  }\r\n\r\n  /**\r\n   * Clear all cached trade history data\r\n   */\r\n  clearTradeHistory(): void {\r\n    this._trades.set([]);\r\n    this._totalCount.set(0);\r\n    this._error.set(null);\r\n    this.tradesSubject.next([]);\r\n    this.errorSubject.next(null);\r\n  }\r\n\r\n  /**\r\n   * Clear error state\r\n   */\r\n  clearError(): void {\r\n    this._error.set(null);\r\n    this.errorSubject.next(null);\r\n  }\r\n\r\n  /**\r\n   * Get current error message (if any)\r\n   */\r\n  getCurrentError(): string | null {\r\n    return this._error();\r\n  }\r\n\r\n  /**\r\n   * Check if service is currently loading data\r\n   */\r\n  isCurrentlyLoading(): boolean {\r\n    return this._loading();\r\n  }\r\n\r\n  /**\r\n   * Get count of loaded trades\r\n   */\r\n  getTradeCount(): number {\r\n    return this.trades().length;\r\n  }\r\n\r\n  // ============================================================================\r\n  // STATISTICS CALCULATION\r\n  // ============================================================================\r\n\r\n  /**\r\n   * Calculate comprehensive statistics from a set of trades\r\n   *\r\n   * @param trades - Array of trade history records\r\n   * @returns TradeStatistics - Aggregated statistics\r\n   */\r\n  calculateStatistics(trades: TradeHistoryRecord[]): TradeStatistics {\r\n    if (trades.length === 0) {\r\n      return this.getEmptyStatistics();\r\n    }\r\n\r\n    const closedTrades = trades.filter(t => t.status === 'CLOSED');\r\n    const profitableTrades = closedTrades.filter(t => t.realizedPnl > 0);\r\n    const losingTrades = closedTrades.filter(t => t.realizedPnl < 0);\r\n\r\n    const totalPnl = closedTrades.reduce((sum, t) => sum + t.realizedPnl, 0);\r\n    const totalFunding = trades.reduce((sum, t) => sum + t.fundingEarned, 0);\r\n    const totalFees = trades.reduce((sum, t) => {\r\n      return sum + (t.entryFee || 0) + (t.exitFee || 0);\r\n    }, 0);\r\n\r\n    const largestWin = profitableTrades.length > 0\r\n      ? Math.max(...profitableTrades.map(t => t.realizedPnl))\r\n      : 0;\r\n\r\n    const largestLoss = losingTrades.length > 0\r\n      ? Math.min(...losingTrades.map(t => t.realizedPnl))\r\n      : 0;\r\n\r\n    const avgPnl = closedTrades.length > 0\r\n      ? totalPnl / closedTrades.length\r\n      : 0;\r\n\r\n    const avgRoi = trades.length > 0\r\n      ? trades.reduce((sum, t) => sum + (t.roi || 0), 0) / trades.length\r\n      : 0;\r\n\r\n    return {\r\n      totalTrades: trades.length,\r\n      profitableTrades: profitableTrades.length,\r\n      losingTrades: losingTrades.length,\r\n      winRate: closedTrades.length > 0\r\n        ? (profitableTrades.length / closedTrades.length) * 100\r\n        : 0,\r\n      totalPnl,\r\n      totalFunding,\r\n      averagePnl: avgPnl,\r\n      largestWin,\r\n      largestLoss,\r\n      totalFees,\r\n      netProfit: totalPnl - totalFees,\r\n      averageRoi: avgRoi\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Calculate statistics for a specific symbol\r\n   */\r\n  getStatisticsBySymbol(symbol: string): TradeStatistics {\r\n    const symbolTrades = this.trades().filter(t => t.symbol === symbol);\r\n    return this.calculateStatistics(symbolTrades);\r\n  }\r\n\r\n  /**\r\n   * Calculate statistics for a specific exchange\r\n   */\r\n  getStatisticsByExchange(exchange: string): TradeStatistics {\r\n    const exchangeTrades = this.trades().filter(t => t.exchange === exchange);\r\n    return this.calculateStatistics(exchangeTrades);\r\n  }\r\n\r\n  /**\r\n   * Format duration in seconds to human-readable string\r\n   *\r\n   * @param seconds - Duration in seconds\r\n   * @returns Formatted duration string (e.g., \"2h 15m\", \"45m 30s\")\r\n   */\r\n  formatDuration(seconds: number): string {\r\n    const hours = Math.floor(seconds / 3600);\r\n    const minutes = Math.floor((seconds % 3600) / 60);\r\n    const secs = seconds % 60;\r\n\r\n    if (hours > 0) {\r\n      return `${hours}h ${minutes}m`;\r\n    } else if (minutes > 0) {\r\n      return `${minutes}m ${secs}s`;\r\n    } else {\r\n      return `${secs}s`;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Format PnL with proper color coding indicator\r\n   *\r\n   * @param pnl - Profit/Loss value (can be null for open positions)\r\n   * @returns Object with formatted value and color\r\n   */\r\n  formatPnl(pnl: number | null): { value: string; color: string; isPositive: boolean } {\r\n    // Handle null/undefined values (for open positions without realized PnL)\r\n    if (pnl === null || pnl === undefined) {\r\n      return {\r\n        value: '0.00',\r\n        color: 'gray',\r\n        isPositive: true\r\n      };\r\n    }\r\n\r\n    const isPositive = pnl >= 0;\r\n    const formatted = isPositive ? `+${pnl.toFixed(2)}` : pnl.toFixed(2);\r\n\r\n    return {\r\n      value: formatted,\r\n      color: isPositive ? 'green' : 'red',\r\n      isPositive\r\n    };\r\n  }\r\n\r\n  // ============================================================================\r\n  // PRIVATE METHODS - Internal Helpers\r\n  // ============================================================================\r\n\r\n  /**\r\n   * Build URL with query parameters\r\n   */\r\n  private buildUrlWithParams(baseUrl: string, params: TradeHistoryQueryParams): string {\r\n    const queryParams: Record<string, string | number | boolean> = {};\r\n\r\n    if (params.symbol) queryParams['symbol'] = params.symbol;\r\n    if (params.exchange) queryParams['exchange'] = params.exchange;\r\n    if (params.limit) queryParams['limit'] = params.limit;\r\n    if (params.offset) queryParams['offset'] = params.offset;\r\n    if (params.status) queryParams['status'] = params.status;\r\n    if (params.startDate) queryParams['startDate'] = params.startDate;\r\n    if (params.endDate) queryParams['endDate'] = params.endDate;\r\n    if (params.sortBy) queryParams['sortBy'] = params.sortBy;\r\n    if (params.sortOrder) queryParams['sortOrder'] = params.sortOrder;\r\n\r\n    return buildUrlWithQuery(baseUrl, queryParams);\r\n  }\r\n\r\n  /**\r\n   * Get empty statistics object\r\n   */\r\n  private getEmptyStatistics(): TradeStatistics {\r\n    return {\r\n      totalTrades: 0,\r\n      profitableTrades: 0,\r\n      losingTrades: 0,\r\n      winRate: 0,\r\n      totalPnl: 0,\r\n      totalFunding: 0,\r\n      averagePnl: 0,\r\n      largestWin: 0,\r\n      largestLoss: 0,\r\n      totalFees: 0,\r\n      netProfit: 0,\r\n      averageRoi: 0\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Centralized error handling\r\n   *\r\n   * Transforms HTTP errors into user-friendly error messages\r\n   * and logs detailed error information for debugging.\r\n   *\r\n   * @param error - HTTP error response\r\n   * @returns User-friendly error message\r\n   */\r\n  private handleError(error: HttpErrorResponse): string {\r\n    console.error('[TradeHistoryService] Error:', error);\r\n\r\n    // Check for error message in response body\r\n    if (error.error?.error?.message) {\r\n      return error.error.error.message;\r\n    }\r\n\r\n    if (error.error?.message) {\r\n      return error.error.message;\r\n    }\r\n\r\n    // Handle specific HTTP status codes\r\n    if (error.status === 0) {\r\n      return 'Unable to connect to the server. Please check your internet connection.';\r\n    }\r\n\r\n    if (error.status === 401) {\r\n      return 'Unauthorized. Please log in again.';\r\n    }\r\n\r\n    if (error.status === 403) {\r\n      return 'Access forbidden. You do not have permission to view trade history.';\r\n    }\r\n\r\n    if (error.status === 404) {\r\n      return 'Trade history endpoint not found. Please contact support.';\r\n    }\r\n\r\n    if (error.status === 422) {\r\n      return 'Invalid query parameters. Please check your filters.';\r\n    }\r\n\r\n    if (error.status === 429) {\r\n      return 'Too many requests. Please try again later.';\r\n    }\r\n\r\n    if (error.status >= 500) {\r\n      return 'Server error. Please try again later.';\r\n    }\r\n\r\n    // Default error message\r\n    return error.message || 'An unexpected error occurred while fetching trade history.';\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\services\\trading.service.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":78,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1765,1768],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1765,1768],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":82,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1839,1842],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1839,1842],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":106,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":106,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":123,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":123,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":135,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":135,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":148,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":148,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":164,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":164,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":177,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":177,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":191,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":191,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":204,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":204,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":226,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":226,"endColumn":38}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Injectable, signal } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Observable, tap, catchError, throwError } from 'rxjs';\r\nimport { getEndpointUrl, buildApiUrl } from '../config/app.config';\r\nimport { ExchangeType } from '../models/exchange-credentials.model';\r\n\r\nexport interface TradingPlatform {\r\n  id: string;\r\n  name: string;\r\n  description: string;\r\n  logo: string;\r\n  connected: boolean;\r\n  apiKeyLast4?: string;\r\n  connectedAt?: Date;\r\n  lastSync?: Date;\r\n}\r\n\r\nexport interface ApiKeyRequest {\r\n  platformId: string;\r\n  apiKey: string;\r\n  secretKey: string;\r\n  passphrase?: string;\r\n}\r\n\r\nexport interface BalanceData {\r\n  totalBalance: number;\r\n  availableBalance: number;\r\n  tradingBalance: number;\r\n  pendingOrders: number;\r\n  balanceChange: number;\r\n  platforms: PlatformBalance[];\r\n}\r\n\r\nexport interface PlatformBalance {\r\n  platformId: string;\r\n  platformName: string;\r\n  balance: number;\r\n  currency: string;\r\n  lastSync: Date;\r\n}\r\n\r\nexport interface TradeOrder {\r\n  id: string;\r\n  platformId: string;\r\n  symbol: string;\r\n  side: 'buy' | 'sell';\r\n  type: 'market' | 'limit';\r\n  amount: number;\r\n  price?: number;\r\n  status: 'pending' | 'filled' | 'cancelled';\r\n  createdAt: Date;\r\n  filledAt?: Date;\r\n}\r\n\r\n/**\r\n * Exchange Order Request for API testing\r\n */\r\nexport interface ExchangeOrderRequest {\r\n  exchange: ExchangeType;\r\n  credentialId: string;\r\n  symbol: string;\r\n  side: 'BUY' | 'SELL';\r\n  positionSide: 'LONG' | 'SHORT';\r\n  type: 'MARKET' | 'LIMIT';\r\n  quantity: number;\r\n  price?: number;\r\n}\r\n\r\n/**\r\n * Exchange Order Response\r\n */\r\nexport interface ExchangeOrderResponse {\r\n  success: boolean;\r\n  orderId?: string;\r\n  clientOrderId?: string;\r\n  status?: string;\r\n  message?: string;\r\n  data?: any;\r\n  error?: {\r\n    code: string;\r\n    message: string;\r\n    details?: any;\r\n  };\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class TradingService {\r\n  private isLoadingBalance = signal<boolean>(false);\r\n  private isConnectingPlatform = signal<boolean>(false);\r\n\r\n  readonly isLoadingBalance$ = this.isLoadingBalance.asReadonly();\r\n  readonly isConnectingPlatform$ = this.isConnectingPlatform.asReadonly();\r\n\r\n  constructor(private http: HttpClient) {}\r\n\r\n\r\n  // Get available trading platforms\r\n  getPlatforms(): Observable<TradingPlatform[]> {\r\n    return this.http.get<TradingPlatform[]>(\r\n      getEndpointUrl('trading', 'platforms')\r\n    ).pipe(\r\n      catchError(error => {\r\n        console.error('Error fetching trading platforms:', error);\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n\r\n  // Connect trading platform with API key\r\n  connectPlatform(apiKeyData: ApiKeyRequest): Observable<TradingPlatform> {\r\n    this.isConnectingPlatform.set(true);\r\n\r\n    return this.http.post<TradingPlatform>(\r\n      getEndpointUrl('trading', 'apiKeys'),\r\n      apiKeyData\r\n    ).pipe(\r\n      tap(() => this.isConnectingPlatform.set(false)),\r\n      catchError(error => {\r\n        this.isConnectingPlatform.set(false);\r\n        console.error('Error connecting platform:', error);\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n\r\n  // Remove API key / disconnect platform\r\n  disconnectPlatform(platformId: string): Observable<void> {\r\n    return this.http.delete<void>(\r\n      `${getEndpointUrl('trading', 'apiKeys')}/${platformId}`\r\n    ).pipe(\r\n      catchError(error => {\r\n        console.error('Error disconnecting platform:', error);\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n\r\n  // Test API key connection\r\n  testConnection(platformId: string): Observable<{ success: boolean; message: string }> {\r\n    return this.http.post<{ success: boolean; message: string }>(\r\n      `${getEndpointUrl('trading', 'apiKeys')}/${platformId}/test`,\r\n      {}\r\n    ).pipe(\r\n      catchError(error => {\r\n        console.error('Error testing connection:', error);\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n\r\n  // Get balance data from all connected platforms\r\n  getBalance(): Observable<BalanceData> {\r\n    this.isLoadingBalance.set(true);\r\n\r\n    return this.http.get<BalanceData>(\r\n      getEndpointUrl('trading', 'balance')\r\n    ).pipe(\r\n      tap(() => this.isLoadingBalance.set(false)),\r\n      catchError(error => {\r\n        this.isLoadingBalance.set(false);\r\n        console.error('Error fetching balance:', error);\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n\r\n  // Refresh balance data\r\n  refreshBalance(): Observable<BalanceData> {\r\n    return this.http.post<BalanceData>(\r\n      `${getEndpointUrl('trading', 'balance')}/refresh`,\r\n      {}\r\n    ).pipe(\r\n      catchError(error => {\r\n        console.error('Error refreshing balance:', error);\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n\r\n  // Get trading orders\r\n  getOrders(platformId?: string): Observable<TradeOrder[]> {\r\n    const params = platformId ? `?platformId=${platformId}` : '';\r\n\r\n    return this.http.get<TradeOrder[]>(\r\n      `${getEndpointUrl('trading', 'orders')}${params}`\r\n    ).pipe(\r\n      catchError(error => {\r\n        console.error('Error fetching orders:', error);\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n\r\n  // Update API key\r\n  updateApiKey(platformId: string, apiKeyData: Partial<ApiKeyRequest>): Observable<TradingPlatform> {\r\n    return this.http.put<TradingPlatform>(\r\n      `${getEndpointUrl('trading', 'apiKeys')}/${platformId}`,\r\n      apiKeyData\r\n    ).pipe(\r\n      catchError(error => {\r\n        console.error('Error updating API key:', error);\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Place an exchange order (for API testing)\r\n   * This endpoint allows testing exchange order placement with detailed request/response logging\r\n   *\r\n   * @param orderRequest - The order request parameters\r\n   * @returns Observable of ExchangeOrderResponse\r\n   */\r\n  placeExchangeOrder(orderRequest: ExchangeOrderRequest): Observable<ExchangeOrderResponse> {\r\n    return this.http.post<ExchangeOrderResponse>(\r\n      buildApiUrl('/exchange-orders'),\r\n      orderRequest\r\n    ).pipe(\r\n      tap(response => {\r\n        console.log('Exchange order placed:', response);\r\n      }),\r\n      catchError(error => {\r\n        console.error('Error placing exchange order:', error);\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\unpoi\\WebstormProjects\\BOT\\frontend\\src\\app\\services\\user.service.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":32,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[869,872],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[869,872],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":39,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1006,1009],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1006,1009],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":82,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":82,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":99,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":99,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":116,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":116,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":129,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":129,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":142,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":142,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":154,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":154,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":166,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":166,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":179,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":179,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":192,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":192,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":208,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":208,"endColumn":38},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":214,"column":78,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":214,"endColumn":81,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6188,6191],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6188,6191],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":215,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":215,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6222,6225],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6222,6225],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":217,"column":32,"nodeType":"Property","messageId":"anyAssignment","endLine":217,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":221,"column":33,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":221,"endColumn":38}],"suppressedMessages":[],"errorCount":16,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Injectable, signal } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Observable, tap, catchError, throwError } from 'rxjs';\r\nimport { getEndpointUrl } from '../config/app.config';\r\nimport { Language } from './translation.service';\r\n\r\nexport interface UserPreferences {\r\n  language: Language;\r\n  theme: 'light' | 'dark';\r\n  currency: string;\r\n  notifications: {\r\n    email: boolean;\r\n    priceAlerts: boolean;\r\n    tradingAlerts: boolean;\r\n    push: boolean;\r\n  };\r\n  trading: {\r\n    defaultAmount: number;\r\n    riskLevel: 'low' | 'medium' | 'high';\r\n    autoTrade: boolean;\r\n  };\r\n}\r\n\r\nexport interface Message {\r\n  id: string;\r\n  type: 'info' | 'warning' | 'success' | 'error' | 'trade';\r\n  title: string;\r\n  content: string;\r\n  timestamp: Date;\r\n  read: boolean;\r\n  actions?: MessageAction[];\r\n  metadata?: Record<string, any>;\r\n}\r\n\r\nexport interface MessageAction {\r\n  label: string;\r\n  type: 'primary' | 'secondary' | 'danger';\r\n  action: string;\r\n  data?: any;\r\n}\r\n\r\nexport interface NotificationSettings {\r\n  email: boolean;\r\n  push: boolean;\r\n  priceAlerts: boolean;\r\n  tradingAlerts: boolean;\r\n  securityAlerts: boolean;\r\n  marketUpdates: boolean;\r\n  portfolioReports: boolean;\r\n}\r\n\r\nexport interface UserProfile {\r\n  firstName?: string;\r\n  lastName?: string;\r\n  email: string;\r\n  phone?: string;\r\n  timezone?: string;\r\n  avatar?: string;\r\n  preferences: UserPreferences;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class UserService {\r\n  private isUpdatingPreferences = signal<boolean>(false);\r\n  private isLoadingMessages = signal<boolean>(false);\r\n\r\n  readonly isUpdatingPreferences$ = this.isUpdatingPreferences.asReadonly();\r\n  readonly isLoadingMessages$ = this.isLoadingMessages.asReadonly();\r\n\r\n  constructor(private http: HttpClient) {}\r\n\r\n\r\n  // Get user preferences\r\n  getPreferences(): Observable<UserPreferences> {\r\n    return this.http.get<UserPreferences>(\r\n      getEndpointUrl('user', 'preferences')\r\n    ).pipe(\r\n      catchError(error => {\r\n        console.error('Error fetching preferences:', error);\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n\r\n  // Update user preferences\r\n  updatePreferences(preferences: Partial<UserPreferences>): Observable<UserPreferences> {\r\n    this.isUpdatingPreferences.set(true);\r\n\r\n    return this.http.put<UserPreferences>(\r\n      getEndpointUrl('user', 'preferences'),\r\n      preferences\r\n    ).pipe(\r\n      tap(() => this.isUpdatingPreferences.set(false)),\r\n      catchError(error => {\r\n        this.isUpdatingPreferences.set(false);\r\n        console.error('Error updating preferences:', error);\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n\r\n  // Get user messages\r\n  getMessages(page = 1, limit = 20, unreadOnly = false): Observable<{ messages: Message[]; total: number; unreadCount: number }> {\r\n    this.isLoadingMessages.set(true);\r\n    const params = `?page=${page}&limit=${limit}&unreadOnly=${unreadOnly}`;\r\n\r\n    return this.http.get<{ messages: Message[]; total: number; unreadCount: number }>(\r\n      `${getEndpointUrl('user', 'messages')}${params}`\r\n    ).pipe(\r\n      tap(() => this.isLoadingMessages.set(false)),\r\n      catchError(error => {\r\n        this.isLoadingMessages.set(false);\r\n        console.error('Error fetching messages:', error);\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n\r\n  // Mark message as read\r\n  markMessageAsRead(messageId: string): Observable<void> {\r\n    return this.http.patch<void>(\r\n      `${getEndpointUrl('user', 'messages')}/${messageId}/read`,\r\n      {}\r\n    ).pipe(\r\n      catchError(error => {\r\n        console.error('Error marking message as read:', error);\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n\r\n  // Mark all messages as read\r\n  markAllMessagesAsRead(): Observable<void> {\r\n    return this.http.patch<void>(\r\n      `${getEndpointUrl('user', 'messages')}/read-all`,\r\n      {}\r\n    ).pipe(\r\n      catchError(error => {\r\n        console.error('Error marking all messages as read:', error);\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n\r\n  // Delete message\r\n  deleteMessage(messageId: string): Observable<void> {\r\n    return this.http.delete<void>(\r\n      `${getEndpointUrl('user', 'messages')}/${messageId}`\r\n    ).pipe(\r\n      catchError(error => {\r\n        console.error('Error deleting message:', error);\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n\r\n  // Get notification settings\r\n  getNotificationSettings(): Observable<NotificationSettings> {\r\n    return this.http.get<NotificationSettings>(\r\n      getEndpointUrl('user', 'notifications')\r\n    ).pipe(\r\n      catchError(error => {\r\n        console.error('Error fetching notification settings:', error);\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n\r\n  // Update notification settings\r\n  updateNotificationSettings(settings: Partial<NotificationSettings>): Observable<NotificationSettings> {\r\n    return this.http.put<NotificationSettings>(\r\n      getEndpointUrl('user', 'notifications'),\r\n      settings\r\n    ).pipe(\r\n      catchError(error => {\r\n        console.error('Error updating notification settings:', error);\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n\r\n  // Update user profile\r\n  updateProfile(profileData: Partial<UserProfile>): Observable<UserProfile> {\r\n    return this.http.put<UserProfile>(\r\n      getEndpointUrl('user', 'profile'),\r\n      profileData\r\n    ).pipe(\r\n      catchError(error => {\r\n        console.error('Error updating profile:', error);\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n\r\n  // Upload avatar\r\n  uploadAvatar(file: File): Observable<{ avatarUrl: string }> {\r\n    const formData = new FormData();\r\n    formData.append('avatar', file);\r\n\r\n    return this.http.post<{ avatarUrl: string }>(\r\n      `${getEndpointUrl('user', 'profile')}/avatar`,\r\n      formData\r\n    ).pipe(\r\n      catchError(error => {\r\n        console.error('Error uploading avatar:', error);\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n\r\n  // Execute message action\r\n  executeMessageAction(messageId: string, action: MessageAction): Observable<any> {\r\n    return this.http.post<any>(\r\n      `${getEndpointUrl('user', 'messages')}/${messageId}/action`,\r\n      { action: action.action, data: action.data }\r\n    ).pipe(\r\n      catchError(error => {\r\n        console.error('Error executing message action:', error);\r\n        return throwError(() => error);\r\n      })\r\n    );\r\n  }\r\n}","usedDeprecatedRules":[]}]
[1m[31mLint errors found in the listed files.
[39m[22m
