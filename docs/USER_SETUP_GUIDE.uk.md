# Посібник з налаштування для користувача - Платформа для криптовалютного торгового бота

## Зміст

1. [Огляд](#огляд)
2. [Що це за додаток?](#що-це-за-додаток)
3. [Передумови](#передумови)
4. [Налаштування Backend](#налаштування-backend)
5. [Налаштування Frontend](#налаштування-frontend)
6. [Конфігурація біржі](#конфігурація-біржі)
7. [Запуск додатка](#запуск-додатка)
8. [Використання додатка](#використання-додатка)
9. [Усунення несправностей](#усунення-несправностей)
10. [Найкращі практики безпеки](#найкращі-практики-безпеки)

---

## Огляд

Це повнофункціональна платформа для криптовалютного торгового бота, яка забезпечує автоматизовані торгові стратегії, включаючи арбітраж ставок фінансування. Додаток складається з:

- **Backend**: Next.js API сервер з базою даних PostgreSQL
- **Frontend**: Веб-інтерфейс на базі Angular
- **Підтримувані біржі**: Bybit, Binance, BingX, OKX, Kraken, Coinbase

---

## Що це за додаток?

Ця платформа надає:

### Основні функції
- **Автентифікація**: Безпечна автентифікація користувачів з JWT та Google OAuth
- **Інтеграція з біржами**: Підключення кількох облікових записів криптовалютних бірж
- **Арбітраж фінансування**: Автоматизовані стратегії арбітражу ставок фінансування
- **Ботові сіткові торги**: Налаштовувані боти для сіткової торгівлі
- **Бектестинг**: Тестування торгових стратегій на історичних даних
- **Дані в реальному часі**: Ставки фінансування та графіки цін у реальному часі
- **Управління портфелем**: Відстежуйте свої позиції та P&L на біржах

### Стратегія арбітражу фінансування
Платформа спеціалізується на арбітражі ставок фінансування - заробітку на періодичних платежах за фінансування у безстрокових ф'ючерсних контрактах. Бот:
1. Відкриває позицію на одній біржі (основна)
2. Відкриває протилежну позицію на іншій біржі (хедж)
3. Збирає платежі за фінансування
4. Закриває обидві позиції після фінансування

---

## Передумови

### Необхідне програмне забезпечення

1. **Node.js** (v18 або вище)
   - Завантажити з: https://nodejs.org/
   - Перевірити встановлення: `node --version`

2. **PostgreSQL** (v14 або вище)
   - Завантажити з: https://www.postgresql.org/download/
   - Перевірити встановлення: `psql --version`

3. **Git**
   - Завантажити з: https://git-scm.com/
   - Перевірити встановлення: `git --version`

### Облікові записи бірж

Вам знадобляться API ключі принаймні з однієї підтримуваної біржі:
- **Bybit**: https://www.bybit.com/
- **BingX**: https://bingx.com/
- **Binance**: https://www.binance.com/
- **OKX**: https://www.okx.com/

**Важливо**: Починайте з тестових/демо-облікових записів, щоб не ризикувати реальними коштами під час навчання.

---

## Налаштування Backend

### 1. Встановлення залежностей

```bash
cd backend
npm install
```

### 2. Налаштування бази даних PostgreSQL

#### Варіант A: Локальна установка PostgreSQL

1. Створіть базу даних:
```bash
psql -U postgres
CREATE DATABASE auth_app_local;
\q
```

2. Перевірте з'єднання:
```bash
psql -U postgres -d auth_app_local -c "SELECT 1"
```

#### Варіант B: Хмарний PostgreSQL (Railway, Supabase тощо)

1. Створіть екземпляр бази даних у вашому обраному хмарному провайдері
2. Запишіть рядок підключення (формат: `postgresql://username:password@host:port/database`)

### 3. Налаштування змінних середовища

Створіть файл `.env` у директорії `backend`:

```bash
cp .env.local .env
```

Відредагуйте файл `.env` з вашою конфігурацією:

```env
# Environment
NODE_ENV=development
PORT=3000

# Database Connection
# Замініть на ваші фактичні облікові дані PostgreSQL
DATABASE_URL="postgresql://postgres:YOUR_PASSWORD@localhost:5432/auth_app_local"

# PostgreSQL Connection Details (якщо використовуєте окремі змінні)
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=auth_app_local
POSTGRES_USER=postgres
POSTGRES_PASSWORD=YOUR_PASSWORD

# JWT Configuration
# Згенеруйте безпечний випадковий рядок (принаймні 32 символи)
JWT_SECRET=your-super-secret-jwt-key-for-local-development-replace-this
JWT_EXPIRES_IN=1d

# Google OAuth (Опціонально)
# Отримайте облікові дані з: https://console.cloud.google.com/
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret

# Frontend URL
FRONTEND_URL=http://localhost:4200

# Encryption Key for API Keys Storage
# ВАЖЛИВО: Має бути рівно 32 символи або більше
# Згенеруйте за допомогою: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
ENCRYPTION_KEY=a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2w3x4y5z6a7b8c9d0e1f2
```

### 4. Генерація ключа шифрування

Виконайте цю команду для генерації безпечного ключа шифрування:

```bash
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

Скопіюйте вивід і замініть значення `ENCRYPTION_KEY` у вашому файлі `.env`.

### 5. Налаштування схеми бази даних

```bash
# Згенеруйте Prisma client
npx prisma generate

# Застосуйте схему до бази даних
npx prisma db push

# (Опціонально) Відкрийте Prisma Studio для перегляду вашої бази даних
npx prisma studio
```

### 6. Запуск Backend сервера

```bash
npm run dev
```

Backend тепер має працювати на `http://localhost:3000`

---

## Налаштування Frontend

### 1. Встановлення залежностей

```bash
cd frontend
npm install
```

### 2. Налаштування середовища

Відредагуйте `frontend/src/environments/environment.ts`:

```typescript
import { appConfig } from '../app/config/app.config';

export const environment = {
  production: false,
  apiUrl: 'http://localhost:3000/api',
  googleClientId: 'your-google-client-id', // Опціонально: для Google OAuth
  appName: 'Trading Bot - Development'
};
```

### 3. Запуск Frontend сервера

```bash
npm start
```

Frontend тепер має працювати на `http://localhost:4200`

---

## Конфігурація біржі

### 1. Створення API ключів біржі

#### Для Bybit:

1. Увійдіть у Bybit
2. Перейдіть до API Management: https://www.bybit.com/app/user/api-management
3. Створіть новий API ключ з такими дозволами:
   - **Read**: Position, Order, Wallet
   - **Write**: Trade, Position
4. **Важливо**: Увімкніть торгівлю "Derivatives"
5. Збережіть ваш API Key та Secret безпечно

#### Для BingX:

1. Увійдіть у BingX
2. Перейдіть до API Management: https://bingx.com/en-us/account/api/
3. Створіть новий API ключ з такими дозволами:
   - **Perpetual Futures**: Read + Write
4. Збережіть ваш API Key та Secret безпечно

#### Для Binance:

1. Увійдіть у Binance
2. Перейдіть до API Management: https://www.binance.com/en/my/settings/api-management
3. Створіть новий API ключ
4. Увімкніть торгівлю "Futures"
5. Збережіть ваш API Key та Secret безпечно

### 2. Додавання API ключів до додатка

1. Відкрийте додаток за адресою `http://localhost:4200`
2. Зареєструйтеся/Увійдіть у свій обліковий запис
3. Перейдіть до **Settings** → **Exchange Connections**
4. Натисніть **Add Exchange Credentials**
5. Заповніть форму:
   - **Exchange**: Виберіть вашу біржу (наприклад, BYBIT)
   - **Environment**: Виберіть TESTNET (рекомендовано) або MAINNET
   - **API Key**: Вставте ваш API ключ
   - **API Secret**: Вставте ваш API секрет
   - **Label**: Дайте зручну назву (наприклад, "Bybit Testnet Main")
   - **Active**: Позначте, щоб встановити як активний
6. Натисніть **Save**

**Важливі примітки з безпеки**:
- API ключі шифруються перед збереженням за допомогою AES-256-CBC
- Ніколи не діліться своїми API ключами ні з ким
- Використовуйте обмеження за IP-адресою на стороні біржі, коли це можливо
- Починайте з тестових облікових записів
- Увімкніть лише необхідні дозволи (не надавайте дозвіл на виведення коштів)

---

## Запуск додатка

### Режим розробки

#### Термінал 1: Backend
```bash
cd backend
npm run dev
```

#### Термінал 2: Frontend
```bash
cd frontend
npm start
```

### Режим продакшену

#### Збірка Backend
```bash
cd backend
npm run build
npm start
```

#### Збірка Frontend
```bash
cd frontend
npm run build
# Обслуговуйте папку dist за допомогою веб-сервера
```

---

## Використання додатка

### 1. Створення облікового запису

1. Відкрийте `http://localhost:4200`
2. Натисніть **Register**
3. Заповніть email та пароль
4. Підтвердіть ваш обліковий запис (якщо увімкнено перевірку email)

### 2. Підключення облікових записів бірж

Дотримуйтесь кроків у розділі [Конфігурація біржі](#конфігурація-біржі)

### 3. Налаштування арбітражу фінансування

1. Перейдіть до **Trading** → **Funding Rates**
2. Перегляньте доступні можливості ставок фінансування
3. Натисніть на символ, щоб побачити деталі
4. Натисніть **Subscribe**, щоб налаштувати арбітраж
5. Налаштуйте:
   - **Primary Exchange**: Де ви отримаєте платіж за фінансування
   - **Hedge Exchange**: Де ви візьмете протилежну позицію
   - **Quantity**: Скільки торгувати
   - **Leverage**: Множник (рекомендовано 1-20x, за замовчуванням 3x)
6. Натисніть **Confirm**

### 4. Моніторинг ваших позицій

1. Перейдіть до **Dashboard**
2. Перегляньте активні підписки
3. Відстежуйте P&L та зароблене фінансування
4. Перевіряйте статус позицій

### 5. Перегляд історії

1. Перейдіть до **Trading** → **History**
2. Переглядайте закриті позиції
3. Аналізуйте метрики продуктивності

---

## Усунення несправностей

### Проблеми з підключенням до бази даних

**Помилка**: `Connection refused` або `ECONNREFUSED`

**Рішення**:
1. Перевірте, що PostgreSQL працює:
   ```bash
   # macOS
   brew services list

   # Linux
   sudo systemctl status postgresql

   # Windows
   # Перевірте додаток Services для служби PostgreSQL
   ```

2. Перевірте з'єднання:
   ```bash
   psql -U postgres -d auth_app_local -c "SELECT 1"
   ```

3. Перевірте, що DATABASE_URL у `.env` відповідає вашій конфігурації PostgreSQL

### Backend не запускається

**Помилка**: `Port 3000 already in use`

**Рішення**:
1. Завершіть процес, що використовує порт 3000:
   ```bash
   # macOS/Linux
   lsof -ti:3000 | xargs kill -9

   # Windows
   netstat -ano | findstr :3000
   taskkill /PID <PID> /F
   ```

2. Або змініть порт у `.env`:
   ```env
   PORT=3001
   ```

### Помилки Exchange API

**Помилка**: `Invalid signature` або `Authentication failed`

**Рішення**:
1. Перевірте, що API ключі правильні (без зайвих пробілів)
2. Перевірте дозволи API ключа на біржі
3. Перевірте, що системний час синхронізований (біржі вимагають точного часу)
4. Перевірте, чи не обмежений API ключ за IP (додайте вашу IP-адресу до білого списку)

**Помилка**: `Insufficient balance`

**Рішення**:
1. Переконайтеся, що у вас є кошти на вашому біржовому рахунку
2. Перевірте, що ви використовуєте правильний тип облікового запису (Spot vs Futures)
3. Перевірте, що маржа доступна для торгівлі з кредитним плечем

**Помилка**: `Leverage cannot be changed when there are open positions`

**Рішення**:
1. Закрийте всі відкриті позиції для цього символу
2. Потім повторіть спробу підписки на арбітраж
3. Або використовуйте інший символ

### Помилки збірки Frontend

**Помилка**: `Module not found` або `Can't resolve...`

**Рішення**:
```bash
cd frontend
rm -rf node_modules package-lock.json
npm install
```

### Проблеми з Prisma

**Помилка**: `Prisma Client not generated`

**Рішення**:
```bash
cd backend
npx prisma generate
npx prisma db push
```

---

## Найкращі практики безпеки

### 1. Безпека API ключів

- Ніколи не комітьте файли `.env` до git
- Використовуйте `.env.local` для локальної розробки
- Періодично змінюйте API ключі
- Використовуйте окремі ключі для testnet та mainnet
- Увімкніть обмеження за IP-адресою на біржах
- Використовуйте ключі тільки для читання, де це можливо
- Ніколи не надавайте дозволи на виведення коштів

### 2. Безпека бази даних

- Використовуйте складні паролі PostgreSQL
- Не відкривайте порт бази даних в інтернет
- Регулярні резервні копії
- Використовуйте SSL з'єднання у продакшені

### 3. Безпека додатка

- Негайно змініть стандартний JWT_SECRET
- Використовуйте складні паролі
- Увімкніть двофакторну автентифікацію (коли доступна)
- Підтримуйте Node.js та залежності в актуальному стані
- Моніторте на вразливості безпеки: `npm audit`

### 4. Безпека торгівлі

- Починайте з невеликих сум
- Завжди спочатку тестуйте на testnet
- Встановлюйте ліміти стоп-лосс
- Регулярно моніторте позиції
- Ніколи не інвестуйте більше, ніж можете дозволити собі втратити

### 5. Змінні середовища

Ніколи не діліться і не комітьте:
- `JWT_SECRET`
- `ENCRYPTION_KEY`
- `DATABASE_URL`
- `GOOGLE_CLIENT_SECRET`
- Будь-які API ключі чи секрети

---

## Додаткові ресурси

### Документація

- **Prisma**: https://www.prisma.io/docs/
- **Next.js**: https://nextjs.org/docs
- **Angular**: https://angular.io/docs
- **Bybit API**: https://bybit-exchange.github.io/docs/v5/intro
- **BingX API**: https://bingx-api.github.io/docs/

### Підтримка

- Перевірте `LEVERAGE_SYNC_VERIFICATION.md` для деталей синхронізації кредитного плеча
- Перегляньте `LEVERAGE_SYNC_IMPLEMENTATION.md` для технічних деталей
- Дивіться README.md проєкту для API endpoints

### Розробка

- Frontend працює на порту 4200
- Backend працює на порту 3000
- База даних зазвичай на порту 5432
- У режимі розробки увімкнено гаряче перезавантаження

---

## Контрольний список швидкого старту

- [ ] Node.js встановлено (v18+)
- [ ] PostgreSQL встановлено та працює
- [ ] Базу даних створено (`auth_app_local`)
- [ ] Файл Backend `.env` налаштовано
- [ ] Ключ шифрування згенеровано
- [ ] Залежності Backend встановлено (`npm install`)
- [ ] Схему бази даних створено (`npx prisma db push`)
- [ ] Backend сервер працює (`npm run dev`)
- [ ] Залежності Frontend встановлено
- [ ] Середовище Frontend налаштовано
- [ ] Frontend сервер працює (`npm start`)
- [ ] Обліковий запис створено в додатку
- [ ] API ключі біржі отримано
- [ ] Облікові дані біржі додано до додатка
- [ ] Перший тестовий арбітраж на testnet
- [ ] Моніторинг результатів

---

**Вітаємо!** Ви тепер готові використовувати платформу криптовалютного торгового бота.

З питань чи проблем, будь ласка, перегляньте розділ усунення несправностей або перевірте документацію проєкту.

**Відмова від відповідальності**: Торгівля криптовалютами пов'язана з значним ризиком. Це програмне забезпечення надається як є, без будь-яких гарантій. Завжди ретельно тестуйте на testnet перед використанням реальних коштів.
